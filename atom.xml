<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>neoFelhz&#39;s Planet</title>
    <subtitle>neoFelhz 的伙伴星球</subtitle>
    <link href="https://planet.nfz.moe/atom.xml" rel="self" type="application/atom+xml" />
    <link href="https://planet.nfz.moe"/>
    <updated>2018-06-16T11:20:52+00:00</updated>
    <id>https://planet.nfz.moe</id>
    
    <author>
        <name>neoFelhz</name>
        <email>neoFelhz@gmail.com</email>
    </author>
    
    <generator uri="https://github.com/phoenixlzx/planet.js">Planet.js</generator>
    
    <entry>
        <title>闲聊·记录-2018年6月</title>
        <link href="https://liyin.date/2018/06/16/talk-2018-06/"/>
        <id>https://liyin.date/2018/06/16/talk-2018-06/</id>
        
        <published>2018-06-16T11:20:52+00:00</published>
        <updated>2018-06-16T11:20:52+00:00</updated>
        
        <content type="html"><![CDATA[<p>不知不觉又过去的一个月… 看了看上一次记录是在 2017年11月，已经过了半年了啊，所以也就写写这半年都干了些什么吧（x  </p>]]></content>
        
        <summary type="html">
            
            不知不觉又过去的一个月… 看了看上一次记录是在 2017年11月，已经过了半年了啊，所以也就写写这半年都干了些什么吧（x  
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Osu!Next Signature (Osu 个人签名) API接口</title>
        <link href="https://milkice.me/2018/06/14/osu-next-sig-api/"/>
        <id>https://milkice.me/2018/06/14/osu-next-sig-api/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2018-06-14T13:00:20+00:00</published>
        <updated>2018-06-14T13:00:20+00:00</updated>
        
        <content type="html"><![CDATA[本接口尚处于beta测试阶段，可能会有bug出没，Use at your own risk 前言 对于每个 Osu! 玩家来说，拥有一个自己的签名档应该是最棒的一件事情了吧。官方也曾发布过一个 Osu! 签名档生成器，不过样式已经不符合当下(2018年)的审美了。 目前看来最好的方案应该是 Lemmmy/osusig ，样式符合新一代的 ……]]></content>
        
        <summary type="html">
            
            本接口尚处于beta测试阶段，可能会有bug出没，Use at your own risk 前言 对于每个 Osu! 玩家来说，拥有一个自己的签名档应该是最棒的一件事情了吧。官方也曾发布过一个 Osu! 签名档生成器，不过样式已经不符合当下(2018年)的审美了。 目前看来最好
            
        </summary>
        
        <category term="Games"/>
        
        <category term="Tech"/>
        
        <category term="API"/>
        
        <category term="CDN"/>
        
        <category term="OSU!"/>
        
    </entry>
    
    <entry>
        <title>zdfans倒闭啦，王八蛋老板zd423黄治德带着会员费跑了</title>
        <link href="https://www.mokeyjay.com/archives/2240"/>
        <id>https://www.mokeyjay.com/archives/2240</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-06-11T09:04:05+00:00</published>
        <updated>2018-06-11T09:04:05+00:00</updated>
        
        <content type="html"><![CDATA[就是这个网站 → zd423 几年前不知道从哪里得知这个网站，这上面都是些绿色去广告的破解软件，很是喜欢，经常没事就去看看又有哪些软件发布了、哪些更新了。也常常向身边人安利，自己安装软件也是首选zd423 之前他有卖过机场，99元永久。我当然知道这是不可能的，但还是想着能用一年算回本了，结果不到一年就跑路了 前几个月开始卖会员，98永久，有些软件需要会员才能下载。好了伤疤忘了疼的我对此表示理解，并]]></content>
        
        <summary type="html">
            
            就是这个网站 → zd423 几年前不知道从哪里得知这个网站，这上面都是些绿色去广告的破解软件，很是喜欢，经常没事就去看看又有哪些软件发布了、哪些更新了。也常常向身边人安利，自己安装软件也是首选zd423 之前他有卖过机场，99元永久。我当然知道这是不可能的，但还是想着能用一年
            
        </summary>
        
        <category term="杂谈"/>
        
        <category term="行业新闻"/>
        
    </entry>
    
    <entry>
        <title>究竟是哪位大佬每天锲而不舍风雨无阻地往我支付宝二维码里打2笔0.01元呢……</title>
        <link href="https://www.mokeyjay.com/archives/2238"/>
        <id>https://www.mokeyjay.com/archives/2238</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-06-09T17:06:15+00:00</published>
        <updated>2018-06-09T17:06:15+00:00</updated>
        
        <content type="html"><![CDATA[究竟是哪位大佬每天锲而不舍风雨无阻地往我支付宝二维码里打2笔0.01元呢……]]></content>
        
        <summary type="html">
            
            究竟是哪位大佬每天锲而不舍风雨无阻地往我支付宝二维码里打2笔0.01元呢……
            
        </summary>
        
        <category term="杂谈"/>
        
    </entry>
    
    <entry>
        <title>使用 PGP/GPG 进行数字签名加密解密</title>
        <link href="https://blackyau.cc/9.html"/>
        <id>https://blackyau.cc/9.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2018-06-09T15:27:00+00:00</published>
        <updated>2018-06-09T15:27:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>PGP/GPG/GnuPG/OpenPGP 关系和区别</h2><p>PGP 是 Phil Zimmermann 于1991年开发的商业应用程序，1997年7月，PGP Inc.与齐默尔曼同意 IETF 制定一项公开的互联网标准，称作 OpenPGP，任何支持这一标准的程序也被允许称作 OpenPGP。GnuPG 则是支持了这一标准的开源应用程序。提个小故事：</p><blockquote><p>当年的 PGP 之父（Phil Zimmermann）因为发明了 PGP 这款文件/邮件加密工具，差点被美国政府抓去坐牢。当时（上世纪90年代初）的美国法律规定，“高强度加密技术”属于军用技术，不允许出口到海外。Phil Zimmermann 后来想了个妙计——通过 MIT 出版社出了一本书，把 PGP 的全部源代码放到书中，然后援引“美国宪法第一修正案”（出版物受“言论自由”的保护），才推翻了对他的指控。<a href="https://program-think.blogspot.com/2014/06/truecrypt-dead.html"><sup>来源</sup></a></p></blockquote><h2>PGP 加解密和数字签名简单介绍</h2><p>我们可以生成世界上唯一的一组公钥和密钥，公钥用于加密，密钥用于解密。我们一般只公开公钥，他人使用公钥加密后在通过任何方式发送给我。但是因为密钥只能解密<em>使用与自己配对的公钥加密后的数据</em>，这样就保证了使用了我公钥加密后的数据只能由我解密查看。这就是PGP加解密的基本原理。</p><p>数字签名则是用来校验文件完整性的它不具备加密功能，它在发送的信息末尾都会加上一个用于检验的字段（签名）。这个签名是基于发布者的信息和文件计算出来的，接收者使用发送者的公钥就可以核对信息是否遭到篡改。大部分支持OpenPGP协议的应用，都会在加密的同时默认开启这个特性。</p><h2>Windows 下使用 GnuPG 加密/解密/签名/校验</h2><p>Windows 环境下我选择 <a href="https://gpg4win.org">Gpg4win</a> 作为本次教程的对象，它使用 GnuPG 作为加解密后端、使用 Kleopatra 作为证书管理器和通用加密对话框。更多可查看<a href="https://gpg4win.org/about.html">关于</a>，并且它拥有可视化图形界面，最重要的是它以及它包含的工具都是<a href="https://gpg4win.org/about.html">开源应用</a>。</p><h3>下载安装 Gpg4win</h3><p>直接在 Gpg4win 主页 <a href="https://gpg4win.org">https://gpg4win.org</a> 下载并安装到你认为合适的路径即可</p><h3>使用 Gpg4win 加解密/签名检验文件</h3><p>打开桌面或开始中的 Kleopatra ，并点击「新建密钥对」</p><p><img src="https://st.blackyau.net/blog/9/1.png" /></p><p>在对话框中输入你所期望的信息(对任何人都是可见的)</p><p><img src="https://st.blackyau.net/blog/9/2.png" /></p><p>会让你输入一个密码，用来加密密钥</p><p><img src="https://st.blackyau.net/blog/9/3.png" /></p><p>「生成你的密钥对的副本」可以让你保存密钥和公钥到其他地方，「将公钥上传到目录服务」可以将你的公钥上传到服务器，这样的话别人就可以通过昵称/邮箱或指纹搜索到你的公钥(只有指纹具有唯一性)。注：将公钥上传到服务器是一种不可逆的行为，就算密钥到期了也不会被删除而是会被标记上「已过期」。</p><p>Kleopatra默认密钥服务器地址:<a href="http://pool.sks-keyservers.net/">http://pool.sks-keyservers.net/</a></p><p><img src="https://st.blackyau.net/blog/9/4.png" /></p><p>新建密钥对后就可以选择加密文件了，点击左上角的「签名/加密」。选择一个文件加密后，别人在没有你的私钥的情况下就无法解密你的文件了。当你需要使用别人的公钥加密文件时，要先导入他人的公钥。并在加密文件时勾选「为他人加密」，在输入他人的名字并选中即可。</p><p><img src="https://st.blackyau.net/blog/9/5.png" /></p><p>解密时你必须要先导入对应的密钥对，同时还需要提供密码，并点击「Save All」</p><p><img src="https://st.blackyau.net/blog/9/6.png" /></p><h3>使用 Gpg4win 加解密/签名检验文本</h3><p>点击工具栏最后一项「记事本」，可以对纯文本进行加解密和签名校验。</p><p><img src="https://st.blackyau.net/blog/9/7.png" /></p><p>在文本框中填入内容在「收件人」选项中选择加解密或签名检验密钥，点击上方的「签名/加密 Notepa」或「Decryep /Verify Notepa」可进行相应的操作。</p><p><img src="https://st.blackyau.net/blog/9/8.png" /></p><h3>导出密钥对</h3><p>选中你的密钥，右键「导出绝密密钥」即可</p><h2>来试试使用PGP解密以下纯文本吧</h2><p>密文:<a href="https://blackyau.b0.upaiyun.com/blog/file/Ciphertext.txt">https://blackyau.b0.upaiyun.com/blog/file/Ciphertext.txt</a> (你需要将里面的内容复制出来)</p><p>密钥对:<a href="https://blackyau.b0.upaiyun.com/blog/file/LetPGPFly.gpg">https://blackyau.b0.upaiyun.com/blog/file/LetPGPFly.gpg</a> (可加密/解密)</p><p>公钥:<a href="https://blackyau.b0.upaiyun.com/blog/file/LetPGPFly.asc">https://blackyau.b0.upaiyun.com/blog/file/LetPGPFly.asc</a> (仅可加密)</p><h2>其他平台</h2><p>Android: OpenKeychain: Easy PGP(加密时第一项「加密到」需要你手动输入加密密钥的昵称)</p><blockquote><p>Google Play:<a href="https://play.google.com/store/apps/details?id=org.sufficientlysecure.keychain">https://play.google.com/store/apps/details?id=org.sufficientlysecure.keychain</a><br />F-Droid:<a href="https://f-droid.org/packages/org.sufficientlysecure.keychain/">https://f-droid.org/packages/org.sufficientlysecure.keychain/</a></p></blockquote><p>Mac: GPG Suite</p><blockquote><p><a href="https://gpgtools.org/">https://gpgtools.org/</a></p></blockquote><p>Linux: GnuPG</p><blockquote><p><a href="https://www.gnupg.org/download/index.html">https://www.gnupg.org/download/index.html</a></p></blockquote><h2>外部链接</h2><p><a href="https://program-think.blogspot.com/2014/06/truecrypt-dead.html#head-2">分析一下 TrueCrypt 之死（自杀 or 他杀？），介绍一下应对措施 - 编程随想</a></p><p><a href="https://program-think.blogspot.com/2013/02/file-integrity-check.html#head-9">扫盲文件完整性校验——关于散列值和数字签名 - 编程随想</a></p><p><a href="https://program-think.blogspot.com/2017/03/Why-Linux-Is-More-Secure-Than-Windows-and-macOS.html#head-7">为什么桌面系统装 Linux 可以做到更好的安全性（相比 Windows &amp; macOS 而言） - 编程随想</a></p><p><a href="https://www.zhihu.com/question/60520344/answer/218561457">上传到公钥服务器的gpg公钥过期了会被删除吗？ 知乎@胡涵铭</a></p><p><a href="http://www.williamlong.info/archives/3439.html">使用GnuPG(PGP)加密信息及数字签名教程 - 月光博客</a></p><h2>版权声明</h2><p>本文中除引用自互联网内容外，其他内容均以<a href="https://creativecommons.org/publicdomain/zero/1.0/deed.zh">CC0 1.0 通用 (CC0 1.0) 公共领域贡献</a>方式授权。我已经将作品 贡献 至公共领域，在法律允许的范围，放弃所有我在全世界范围内基于著作权法对作品享有的权利，包括所有相关权利和邻接权利。 您可以复制、修改、发行和表演本作品，甚至可用于商业性目的，都无需同意和标出署名。<img src="https://licensebuttons.net/p/zero/1.0/88x15.png" /></p>]]></content>
        
        <summary type="html">
            
            PGP/GPG/GnuPG/OpenPGP 关系和区别PGP 是 Phil Zimmermann 于1991年开发的商业应用程序，1997年7月，PGP Inc.与齐默尔曼同意 IETF 制定一项公开的互联网标准，称作 OpenPGP，任何支持这一标准的程序也被允许称作 Ope
            
        </summary>
        
    </entry>
    
    <entry>
        <title>我是如何被小米打败的</title>
        <link href="https://www.isthnew.com/archives/beaten-by-xiaomi.html"/>
        <id>https://www.isthnew.com/archives/beaten-by-xiaomi.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-06-07T02:02:07+00:00</published>
        <updated>2018-06-07T02:02:07+00:00</updated>
        
        <content type="html"><![CDATA[<p>总共是两件事。我3月底购买的红米note5，电源键出现击现象，我两个朋友的此款手机出现同样的问题。我找售后维修，售后给我换了电源键。但是震动器压条在拆机的时候出现损坏，需要等几天配货回来才能换，这我都接受了，但是我回家发现后置主摄像头上面居然有类似脏污，这非常膈应人了，打电</p>]]></content>
        
        <summary type="html">
            
            总共是两件事。我3月底购买的红米note5，电源键出现击现象，我两个朋友的此款手机出现同样的问题。我找售后维修，售后给我换了电源键。但是震动器压条在拆机的时候出现损坏，需要等几天配货回来才能换，这我都接受了，但是我回家发现后置主摄像头上面居然有类似脏污，这非常膈应人了，打电
            
        </summary>
        
        <category term="吐槽"/>
        
        <category term="小米mix2s"/>
        
        <category term="小米"/>
        
        <category term="售后"/>
        
    </entry>
    
    <entry>
        <title>又是一年高考季，各位加油啊（来自一个后悔没有好好高考的社畜</title>
        <link href="https://www.mokeyjay.com/archives/2236"/>
        <id>https://www.mokeyjay.com/archives/2236</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-06-06T13:06:36+00:00</published>
        <updated>2018-06-06T13:06:36+00:00</updated>
        
        <content type="html"><![CDATA[又是一年高考季，各位加油啊（来自一个后悔没有好好高考的社畜]]></content>
        
        <summary type="html">
            
            又是一年高考季，各位加油啊（来自一个后悔没有好好高考的社畜
            
        </summary>
        
        <category term="杂谈"/>
        
    </entry>
    
    <entry>
        <title>明日之心，高考加油~</title>
        <link href="https://blog.lwl12.com/read/next-star-cee-encouraging.html"/>
        <id>https://blog.lwl12.com/read/next-star-cee-encouraging.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2018-06-06T13:00:13+00:00</published>
        <updated>2018-06-06T13:00:13+00:00</updated>
        
        <content type="html"><![CDATA[<p>如果结果不如你所愿，就在尘埃落定前奋力一搏。<br />
<span></span><br />
 <br />
现在是 2018 年高考前夕啦，去年差不多这个时候，lwl 也发了一篇贺文呢。<br />
 <br />
嘛，今年祝各位用明日之心成就明日之星！<br />
 <br />
本博主<a href="https://blog.lwl12.com/read/2017-university-exam.html">今年也有</a>考试啦_(:з」∠)_<br />
 <br />
<div></div></p>]]></content>
        
        <summary type="html">
            
            如果结果不如你所愿，就在尘埃落定前奋力一搏。    现在是 2018 年高考前夕啦，去年差不多这个时候，lwl 也发了一篇贺文呢。   嘛，今年祝各位用明日之心成就明日之星！   本博主今年也有考试啦_(:з」∠)_   
            
        </summary>
        
        <category term="时事"/>
        
    </entry>
    
    <entry>
        <title>谈谈性价比</title>
        <link href="https://www.isthnew.com/archives/cost-performance.html"/>
        <id>https://www.isthnew.com/archives/cost-performance.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-06-06T08:52:08+00:00</published>
        <updated>2018-06-06T08:52:08+00:00</updated>
        
        <content type="html"><![CDATA[<p>“性价比”这个词已经在手机上被用烂了，最早是小米玩出的标签，现在许多手机厂商似乎都喜欢告诉用户自己的产品是“性价比”的。但是，似乎性价比这个东西有点奇怪，从某种意义上说，它不存在。</p>
<p>我想先去除带有奢侈品性质的高溢价手机，然后给1000元以上2000元以下的手机</p>]]></content>
        
        <summary type="html">
            
            “性价比”这个词已经在手机上被用烂了，最早是小米玩出的标签，现在许多手机厂商似乎都喜欢告诉用户自己的产品是“性价比”的。但是，似乎性价比这个东西有点奇怪，从某种意义上说，它不存在。 我想先去除带有奢侈品性质的高溢价手机，然后给1000元以上2000元以下的手机
            
        </summary>
        
        <category term="吐槽"/>
        
    </entry>
    
    <entry>
        <title>村通网之也谈 HTTPS</title>
        <link href="https://flyhigher.top/develop/1093.html"/>
        <id>https://flyhigher.top/develop/1093.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2018-06-03T02:50:44+00:00</published>
        <updated>2018-06-03T02:50:44+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>这是一种能保证你花掉工资/零花钱时的愉悦感的技术</p></blockquote>
<h3>从咕果谈起</h3>
<p>就在不久之前，咕果宣布 Chrome 将在不久之后提前移除对于 <code>HTTPS</code> 网站的“安全”标识，同时对于 <code>HTTP</code> 网站强制显示“不安全”。虽然咕果表示目前 <code>HTTPS</code> 的普及已经达到他们认为足够的地步了，但是我看着国内的进展…啧。</p>
<blockquote><p>为什么要使用 <code>HTTPS</code>？HTTPS 提供的不只是加密功能。事实上，许多 Web 新技术，如 <code>HTTP/2</code>，<code>Service Worker</code> 等都需要依托 <code>HTTPS</code> 才能实现，相信这也会成为未来的趋势。</p></blockquote>
<h3>什么是 SSL？</h3>
<p>从网络模型来看，SSL 在 HTTP 应用层之下，TCP 传输层之上提供了一层传输安全层，确保了经过传输层的数据都是经过加密的。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/5.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/5.jpg" /></a></p>
<p>SSL 作为 <code>HTTPS</code> 的基础最早由网景于 1994 年提出。虽然 HTTP 协议本身提供了基本认证和摘要认证（后来提出）两种客户端认证方案，但是毕竟除了用户名和密码外的所有数据仍然是明文传输的（甚至基本认证只对密码信息做了 <code>Base64</code> 编码），要保证传输的安全性还得依靠 SSL。SSL 本身是一种二进制协议，避免了随随便便一个代理就能读取/修改数据的问题。</p>
<p>随着技术发展，SSL 本身也在不断改进。从 SSL 1.0、SSL 2.0 到 SSL 3.0，再到标准化后的 TLS（目前 TLS 1.3 刚刚定稿），这个协议本身也在完善当中。在本文中，我们按照一般惯例使用 SSL 一词同时指代 SSL 和 TLS 两种协议。</p>
<h3>翻开历史书</h3>
<p>加密方法离不开数学基础，为了更好地解释加密原理，我们先来了解一下加密的基础知识。当然，如果已经了解了就直接跳过吧。</p>
<p>人类使用加密已经有几千年的历史了。最初，人们使用特定的方法处理文本使其在被截获之后也不会泄露信息。我们通常把这种特定的方法叫做密码。传说凯撒曾使用过一种三位位移密码，也就是将文本中的所有字母替换为这个字母在字母表中后三位的字母。这种方法是一种密码。也就是说，密码 C 接受明文 R 一个参数，输出密文 E。</p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/1-300x76.jpg" /></p>
<hr />
<p>然而，使用单一密码的加密非常容易被破译，而且一旦被破译，<strong>以往和未来的所有密文也不再安全。</strong>为了解决这个问题，人们提出了新的方法也就是密钥。用同一种密码加密，输入不同的密钥就会产生不同的结果。比如上文中的三位位移密码，如果把 3 当做密钥，那么不同的密钥（1,2,3,4,5…）就会产生不同的输出。这种时候，就算密码被破译，<strong>只要密钥的可能值足够多</strong>，要得到明文还是相当困难的。也就是，密码 C 现在接受明文 R 和密钥 K 两个参数，产生密文 E。不同的 R 和 K 组合会产生不同的 E。</p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/2-300x60.jpg" /></p>
<p>然而这种方法仍然有问题。密文的接收方要解密得到明文，必须要得知密码和密钥两个信息。通常密码和密钥组合是变化的（不然就和没有密钥一样了），要正确解密，发送方和接收方每次都必须要交换密码和密钥信息，通常是只交换密钥而密码不变。但密钥存在被截获的可能，要确保安全必须对密钥进行加密，然后加密密钥也需要交换密钥，然后第二个密钥也需要加密…很快这就变成了一个鸡生蛋问题，很明显是不可能实现的。</p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/489de23e678fa184bf4b9f471140c827-300x226.jpg" /></p>
<hr />
<p>到目前为止，我们讨论的都是对称加密，也就是加密和解密用的是相同的密码和密钥。对于无限加密的问题，使用对称加密是无解了。此时，我们的救星非对称加密就登场了。</p>
<p>非对称加密可以使用不同的密钥来分别加密和解密文本，它们通常是配对的，我们叫它们公钥和私钥。使用相同的密码时，接受方只需生成一对公钥和私钥，然后保管好自己的私钥并公开公钥。发送方只需要用商定的密码和接收方的公钥作为密钥来加密文本即可。加密后的文本只有使用私钥才能解开，公钥本身是无法解开的。也就是说，密码 C 对于明文 R 和公钥 PK 产生的输出只能由与密码 C 对应的解码 D 和公钥 PK 对应的私钥 SK 才能解密回明文。</p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/3.jpg" /></p>
<blockquote><p>这里就不详述数学上的证明了，有兴趣的可以自行了解。</p></blockquote>
<p>通过这种方式，接收方可以保证密文只能由接受方进行解码，交换公钥并不会破坏加密的安全性。更棒的是，<strong>私钥和公钥是可以互换的</strong>，即是，使用公钥 PK 加密并使用私钥 SK 解密得到的结果和使用私钥 SK 加密并使用公钥 PK 解密得到的结果是一致的，<strong>都是原始明文。</strong></p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/4.jpg" /></p>
<p>这样的话，我们甚至可以使用非对称加密验证接收方的身份。毕竟只有接收方拥有私钥，可以要求接收方用私钥加密明文并试图用其公钥解密来确保对方就是拥有正确私钥的那一方。如此看来，有了非对称加密，似乎一切都完美了。</p>
<h3>等等！</h3>
<p>你可能会发现一些问题。如果有一个聪明的中间人（或者说网络中的某一台代理），<strong>他可能可以轻松破解非对称加密。</strong></p>
<p>对的！试想以下的场景： A 和 B <del>作为两位优秀的魔法少女</del>常常需要互通信件，然而不巧邪恶的 E 同学总是试图偷看 A 和 B 的对话，于是 A 和 B 决定使用非对称加密来加密信件以解决问题。</p>
<p>然而 E 同学想出了一个办法。A 向 B 发送信件时，B 会先向 A 发送她的公钥以便 A 加密文本，这时 E 将其截获，记下 B 的公钥然后自己生成一套公钥和私钥并将自己的公钥伪装成 B 的信件重新发送给 A。<strong>不知情</strong>的 A 会用 E 的公钥加密文本并发回给 B。E 可以再次截获信件，此时他利用自己的私钥便可以轻松读取信中的内容了。然后 E 将信件重新使用 B 的公钥加密并发送给 B，这样 B <strong>也不会发现异常</strong>，认为自己成功与 A 完成了一次沟通，殊不知 E 已经读取到了信的内容。当 B 要向 A 寄信时，E 可以如法炮制读取 A 和 B 的对话。</p>
<p>怎么办才能避免 E 读取内容呢？幸好，我们有一种方法可以在 E 偷偷摸摸更换密钥时就发现问题并及时停止。要使用这种方法，我们需要有请我们的下一位选手登场。</p>
<h3>欢迎，公正的第三方</h3>
<p>现在，作为第三方的 C 登场了。他会作为一个验证人帮助信件的接收方验证收到的信件有没有经过篡改以及是不是真的由 B 发出的。</p>
<p>整个过程这样进行。C 先生成一对公私钥，然后将公钥<strong>亲自告诉 A 和 B。</strong>A 发信给 B 时，C 会提前把 B 的公钥和一些 B 和 C 的基本信息放在一起，然后用自己的私钥加密这段信息并将密文交给 B。B 随后只需将这段密文交给 A 即可。A 随后会试着使用 C 的公钥解开密文，如果成功了，那就说明信件没有经过篡改，并且 A 也安全地获得了 B 的公钥。如果失败了，就说明有人篡改了这段密文，信件即作废。当 B 给 A 寄信时将整个过程反过来即可。看，这样我们就可以安全的交换密钥而不用担心内容被窃听了。可怜的 E 现在束手无策。</p>
<h3>说好的 HTTPS 去哪了？</h3>
<p>别激动，其实 A、B、C、E 的故事就是一次典型的 <code>HTTPS</code> 连接。</p>
<p>慢慢来，实际情况会比上面的故事稍稍复杂一些。我们把 A 看作客户端，通常情况下也就是浏览器，B 看作服务器，E 看作网络链路上某台邪恶的代理，C 是一位公正的第三方，顺便，我们把 C 交给 B 的那段含有一些基本信息和 B 的公钥的密文叫做数字证书。现在，我们可以把 C 叫做证书颁发机构。</p>
<p>在真实情况下，数字证书会包含一些加密的基本信息。毕竟数字证书并没有统一的标准，这些加密信息会用来告诉 A 如何解密数字证书。当然这些信息不会被加密，不然 A 完全无法解密数字证书。因此现实情况下，C 会对数字证书包含的所有内容建立一个摘要（你可以把它当做简介），然后只对这个摘要用自己的私钥进行加密。这个过程叫做签名。当 A 收到证书后，会解密这段摘要，然后自己通过相同的算法独立算出证书的摘要——如果是一样的，那就没问题了。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/snipaste.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/snipaste.jpg" /></a></p>
<hr />
<p>那么现在开始连接。A 向 B 发出了一个请求。在建立连接后，B 会将数字证书发送给 A。A 会验证数字证书（甚至会询问 C 确保这张证书没有作废）。如果成功，A 会利用从证书中取得的 B 的公钥在加密环境下协商出一个一致的临时密钥，接下来双方会用这个密钥<strong>进行对称加密</strong>来互相交流。</p>
<blockquote><p>等等！在这种情况下，B 没有 A 的公钥，他是怎么回答 A 来完成临时密钥的协商的呢？啊哈！实际上 B 并不需要回复 A 来完成协商。在整个过程中，只需要 A 向 B 发送一条加密信息，双方即可计算出相同的临时密钥。至于技术细节，我们稍后就谈。</p></blockquote>
<blockquote><p>那为什么需要临时密钥呢？那是因为非对称加密需要的计算量远大于对称加密。只需要保证密钥不泄露，对称加密是安全的。利用非对称加密来交换对称加密密钥完美解决了密钥交换问题，两种加密方法的混合使用也保证了安全和性能的平衡。</p></blockquote>
<p>这就完成了！现在 A 和 B 可以使用相同的密钥进行对称加密通信在这个基础上，A 和 B 可以使用标准的 HTTP 协议进行交流。同时由于没能截获密钥，可怜的 E 同学再次扑了个空。我们成功完成了一次加密的 HTTPS 通信。</p>
<h3>接下来就是技术细节！</h3>
<p>在加密建立的过程中，算法不同会导致实际实现的不同——尽管并没有太大差别。</p>
<p>简单来看，我们可以将其分为 <code>RSA</code> 算法和 <code>DH</code> 算法。两种算法建立加密的过程我们都会介绍。</p>
<hr />
<p>开始时两种加密算法的实现是一致的。浏览器准备发出一个请求到一台服务器。首先浏览器打开了到该服务器 <code>443</code> 端口的 TCP 连接，准备开始 SSL 握手。</p>
<p>随后，浏览器生成一串随机数并附上自己支持的协议版本和加密方法等一并发送给服务器。协议版本即指 SSL/TLS 协议版本，而加密方式是指实现加密使用的具体算法，也就是密码。这个过程被称为 <code>ClientHello</code>。</p>
<p>接着，服务器会发回确定下来的协议版本和加密方式，以及一串由服务器生成的随机数及数字证书。此时，如果双方没有共同支持的协议版本或加密方式，连接就会断开，浏览器显示错误信息。这个过程被称为 <code>SeverHello</code>。</p>
<p>浏览器会检查服务器证书。数字证书目前没有一个统一的标准，不过使用最广泛的标准是 <code>X.509</code>，版本 3。浏览器会解析证书，检查其签发者是否是可信的，并会试图使用该签发者的公钥来检查证书是否经过篡改。浏览器还会检查证书是否到期、证书包含的主机名和当前主机名是否匹配，甚至会向证书颁发机构的在线服务询问证书是否被注销。一旦有任何一条检查出现问题，浏览器就会中断连接并显示错误信息。</p>
<blockquote><p>浏览器是如何检查证书颁发机构是否可信的？基本上，在每一台联网设备里，都有一套可信机构列表。这些机构和它们的公钥被直接存储于每一台计算机中，因此不用担心被篡改（还记得上面的故事里 C 是亲自告诉 A 和 B 他的公钥的么？）。当然，用户可以添加自己的证书来让浏览器信任自己签发的证书，但这仅限于单台计算机。通常，这些在列表中的机构还会为其他机构签发证书。此时，这些其他机构签发的证书也会被系统所信任，这便构成了证书链。</p></blockquote>
<p>通常情况下，浏览器还会检查一些其他信息，如证书透明度信息等，就不再概述了。</p>
<hr />
<p><strong>不同算法的不同实现在这里开始出现分歧。</strong>我们先来介绍 <code>RSA</code> 算法的实现。</p>
<p>在这时，浏览器产生整个过程中的最后一个随机数，并将它使用服务器的公钥加密，发送给服务器，即 <code>Client Key Exchange</code>。</p>
<p>这时，双方会通过已有的 3 个随机数各自计算出临时密钥。如果没有差错，双方的计算结果应该是相同的。随后，双方会互发 <code>Change Cipher Spec</code> 消息确认接下来的数据传输已经可以切换到加密方式。</p>
<blockquote><p>为什么需要随机数？因为数字证书本身是静态的，要保障安全性，我们需要每次连接时都有不同的密钥，这个密钥便是由双方提出的随机数计算而得的，这种方式增强了连接的安全性。</p></blockquote>
<hr />
<p>对于 <code>DH</code> 算法，此时服务器会利用私钥将浏览器生成的随机数、服务器随机数和服务器 DH 参数签名，生成服务器签名，并随后发送服务器 DH 参数和服务器签名，这是 <code>Server Key Exchange</code>。</p>
<p>紧接着浏览器也会发送客户端 DH 参数（<code>Client Key Exchange</code>），随后双方即可独立计算出临时密钥，切换至加密协议（<code>Change Cipher Spec</code>）。</p>
<hr />
<p><strong>最后，两种加密算法的实现又变得一致。</strong>双方会互换这一轮握手过程中发送/接受到的信息的散列值以确保在握手过程中没有数据被恶意替换，这是 <code>Finished</code>。</p>
<p>通过抓包可以看出两种实现的不同。（图源网络）</p>
<p><code>RSA</code>：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/ssl_handshake_rsa_shake1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/ssl_handshake_rsa_shake1.jpg" /></a></p>
<p><code>DH</code>：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/ssl_handshake_dh_shake1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/ssl_handshake_dh_shake1.jpg" /></a></p>
<p>到这里，浏览器和服务器已经成功建立了安全的 SSL 连接。接下来，标准的 HTTP 协议就可以由 SSL 传输安全层负载进行传输了。从 TCP 传输层来看，这些数据是原始的二进制数据，即使有人截获也无法将其解密。</p>
<h3>还有一些小问题…</h3>
<p>通常情况下，你要访问一个网站，浏览器会在发给服务器的请求中附带一个 <code>host</code> 字段来告诉服务器要访问哪个网站。这对于一个服务器上托管了多个网站的情况（很常见）很有用，服务器可以立刻明白你要访问哪个网站并把对应的数据发回浏览器。</p>
<p>但是，在访问使用 <code>HTTPS</code> 的网站时，SSL 握手的过程中浏览器并不会告诉服务器要访问哪个网站（这是在 HTTP 协议下发出的，而 HTTP 通信会在 SSL 连接建立之后才开始）。这会导致服务器不知道你需要哪张证书且<strong>往往会将错误的证书发送给你。</strong>这通常会导致证书验证失败。</p>
<p>为了解决这一问题，人们提出了 <code>SNI</code>，一个 TLS 拓展协议。<code>SNI</code> 会在 SSL 握手时就向服务器发送要访问的主机名，以便服务器发回正确的证书。<strong>目前绝大部分服务器软件和客户端都支持这一拓展协议。</strong></p>
<hr />
<p>在 SSL 加密开始后，在 TCP 传输层上传输的就是完完全全的二进制数据。对于代理来说，这不是什么好事。对于这样的数据，它们完全不知道应该向哪里转发。</p>
<blockquote><p>当然，盲转发代理是不可取的。盲转发是指对数据包不做处理直接转发的行为。这会彻底地破坏 <code>HTTP/1.1</code> 中引入的长连接，在拖慢速度的同时还大大加重的服务器的负担。因此通常情况下代理会解析 HTTP 头以获得一些连接的基本信息。</p></blockquote>
<p>一种解决方案是使用 HTTPS SSL 隧道协议，这通常是使用 HTTP <code>CONNECT</code> 方法实现的，具体细节就不再详述了。除此之外也有很多方法，有兴趣可以自行了解。</p>
<h3>附录：HTTPS 部署指北</h3>
<p><del>活学活用了解一下。</del></p>
<p>现在，要为你的网站申请证书已经变得非常简单了。虽然上文描述的过程有些复杂，但所幸你不用亲自实现所有功能。主流的服务器软件只要经过一些简单的配置即可启用 <code>HTTPS</code>。通常，你只需要先申请，待证书签发后部署到服务器即可。</p>
<hr />
<p>部署 <code>HTTPS</code> 的第一步是挑选符合要求的证书签发机构和合适的证书种类。不同的签发机构之间，以及同一机构签发的不同种类的证书之间，所需的价格是不同的。</p>
<blockquote><p>证书种类是什么？真实的情况的确比上文提到的情况要再复杂一点。总的来说，证书分为 DV、OV、EV 三类。DV 证书只能提供最基本的加密功能，价格最低；而 OV 和 EV 证书会在签发前验证申请者的身份，流程更繁琐，价格也更高，但是这类证书可以提供验证网站身份的功能（比如浏览器会对不同种类的证书提供视觉上的差异，见下图），而且在出现安全问题时（比如签发机构的私钥泄露，虽然几率很小，但是有可能）的赔付金额也更高。</p></blockquote>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/snipaste_2.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/snipaste_2.jpg" /></a></p>
<p><span>上：Github 使用的 EV 证书   下：本站使用的 DV 证书</span></p>
<p>对于签发机构，我推荐个人博客类网站还是选择 Let’s Encrypt，这是由 Mozilla、思科、Akamai、IdenTrust 和 EFF 等组织发起的公共、免费的 SSL 项目。它所签发的 DV 证书完全免费，而且支持通配符和多域名。唯一的缺点是它只支持 3 个月的有效期，不过到期后可以免费续期。</p>
<blockquote><p>什么是通配符？浏览器在验证证书时，会确保证书中指定的域名和当前访问的域名相符，而根域名（a.com）和子域名（b.a.com）会被当做不同的域名来处理，不同的子域名（b.a.com 和 c.a.com）也会被当做不同的域名。通配符证书（*.a.com）可以同时匹配不同的子域名，减少了所需签发证书的数量。但是，根域名和通配符子域名不会匹配，都需要签发证书。同时，Let’s Encrypt 支持的多域名可以在同一张证书中包含多个域名，大大减少了所需证书的数量（如下图）。</p></blockquote>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/06/Snipaste_2018thbh.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/06/Snipaste_2018thbh.jpg" /></a></p>
<p><span>可以匹配 axton.cc 和 flyhigher.top 根域和所有二级域的证书</span></p>
<p>要使用 Let’s Encrypt 签发，我们可以使用 acme.sh，这是一个基于 Let’s Encrypt 接口封装的开源命令行工具，支持多域名/通配符的申请，也支持自动续期。使用 acme.sh，我们可以使用这样的命令来申请证书：</p>
<p></p><pre>~/.acme.sh/acme.sh --issue --dns dns_ali -d axton.cc -d flyhigher.top -d *.axton.cc -d *.flyhigher.top</pre><p></p>
<p>关于 acme.sh 的详细信息可以前往 Github 了解。</p>

	<div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com" target="_blank"><i></i></a>
		</div>
		<div>
		Neilpang / acme.sh
		</div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com%2FNeilpang%2Facme.sh" target="_blank"><i></i></a>
		</div>
	</div>
	
<hr />
<p>稍等片刻，当证书签发下来，我们往往会得到两个文件，一个是你的私钥，一个是证书。</p>
<blockquote><p>等等，这个私钥哪里来的？通常情况下，为了方便申请，用于申请证书的工具有时会自动为你生成一对私钥公钥，然后将私钥转交给你，而将公钥交给签发机构。当然大多数情况下你可以选择自己生成，然后将公钥提交给签发机构，自己保存好私钥。</p></blockquote>
<p>这时，我们就可以把证书放到服务器上了，然后配置服务器来开启 <code>HTTPS</code>。不同服务器的配置过程通常不同，我也不再赘述了。如果你使用 Nginx，可以使用如下配置。详细信息可以查阅我的另一篇文章：<a href="https://flyhigher.top/works/net/367.html">Nginx+SSL+HTTP2配置简明指南</a>。</p>
<p></p><pre>server{
listen 80;
listen 443 ssl http2;
# 其他配置...

# 如果是 HTTP 就跳转到 HTTPS
if ($server_port !~ 443){
rewrite ^(/.*)$ https://$host$1 permanent;
}

# 证书和私钥路径
ssl_certificate /path/to/fullchain.pem;
ssl_certificate_key /path/to/privkey.pem;

# SSL 参数
ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
ssl_ciphers TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4:!DH:!DHE;
ssl_prefer_server_ciphers on;
ssl_session_timeout 1d;
ssl_session_cache builtin:1000 shared:SSL:10m;
ssl_buffer_size 1400;
ssl_stapling on;
ssl_stapling_verify on;

# 其他配置...
}</pre><p></p>
<p>当然，如果是面板之类的…大多有 SSL 的管理入口，依照提示部署证书即可。</p>
<p>最后，我们还需要对网页文件进行修改，尤其是页面上所有引用的资源必须同样使用 <code>HTTPS</code>，否则浏览器就不会显示安全小绿锁。</p>
<p>此文是对我了解到的一些 <code>HTTPS</code> 相关知识的总结，难免会有纰漏，还请各位斧正。</p>]]></content>
        
        <summary type="html">
            
            这是一种能保证你花掉工资/零花钱时的愉悦感的技术 从咕果谈起 就在不久之前，咕果宣布 Chrome 将在不久之后提前移除对于 HTTPS 网站的“安全”标识，同时对于 HTTP 网站强制显示“不安全”。虽然咕果表示目前 HTTPS 的普及已经达到他们认为足够的地步了，但是我看着
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="HTTPS"/>
        
        <category term="SSL"/>
        
        <category term="TLS"/>
        
        <category term="密码学"/>
        
    </entry>
    
    <entry>
        <title>关于云平台用户鉴权管理（IAM）的一些总结和思考</title>
        <link href="https://ephen.me/2018/cloudplatform-iam/"/>
        <id>https://ephen.me/2018/cloudplatform-iam/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-05-21T03:00:04+00:00</published>
        <updated>2018-05-21T03:00:04+00:00</updated>
        
        <content type="html"><![CDATA[<p>AWS 作为云计算行业鼻祖，不论是什么功能，都做得非常完备，且一切可编程。它们能全方位的解决客户的各种问题，甚至想他人之未曾想，真的非常值得业内人士及机构尊敬。</p><p>但，完备的背后离不开大量的人力支持，又因为它的完备使得各业务都极其复杂。我最近才开始好好看一看 AWS ，才知道居然都有专门的 AWS 咨询师这样的职业。真是厉害了~</p><p>目前主要在看的模块是 IAM 以及周边功能，由于本喵的英文水平不太好，云计算行业术语又了解得太少，看得好费劲。不过通过借助谷歌翻译、上手操作以及咨询<a href="https://sb.sb/blog/" target="_blank">兽兽</a>等大咖，也算是了解了个大概。</p><a></a><hr /><h2><a href="https://ephen.me/2018/cloudplatform-iam/#IAM-非官方简介"></a>IAM 非官方简介</h2><p>IAM ，全称 Identity and Access Management ，字面意思就是识别用户身份和接入控制的管理，所以我将其翻译为“用户鉴权”。</p><p>整个 IAM 体系主要包括“谁可以使用我的资源”（who）、“如何使用我的资源”（how）和“对资源的使用程度”（Authority）三大方面。</p><p>既然都是和“我的资源”相关，所以我在理解时通常将 IAM 与“资源协作”业务场景结合起来看。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#账户、用户及角色（Who）"></a>账户、用户及角色（Who）</h3><p>姑且将“我”认为是账户实体，也就是对应 AWS 中的根帐户（Root）。“我”是金主，付钱买了一大堆资源，但是“我”一个人管理不过来，就派人来帮“我”分门别类的管理它们。</p><p>而“我”又不可能把自己的账号密码都公开给这些人，因为“我”的账号密码直接代表了整个系统的经济命脉和大佬权限。所以，“我”给他们每个人创建基于“我”的子账号，称之为用户。</p><p>既然是分散管理，那么就会对这些用户有不同的类别，就好比 A、B 是开发人员，C、D 是产品经理，各类人群关注点不同，于是给用户创建不同的分组。</p><p>然而，可以访问资源的，不仅仅是人，也可能是其他资源、外部应用，或者其他的根。于是，这些被统称为“角色”。</p><p>简单的用一个关系图来展示下：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877ely1frfyx7x5woj20u90khmyw.jpg" /></p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#接入方式（How）"></a>接入方式（How）</h3><p>用户可以控制台登陆，可以用私有 API 封装到程序连结，亦可以通过 CLI 命令行方式登陆，这个登陆相当于永久性密钥。</p><p>而对于各类不同的角色，它们会直接具备某些资源的访问及操作权限。那么每个资源可能需要开通接口，以提供给不同的角色做临时访问鉴权。</p><p>于是构成了云平台的接入体系。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877ely1frfxn3zl9rj20or0dgt9h.jpg" /></p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#权限（Authority）"></a>权限（Authority）</h3><p>可以说，权限是整个 IAM 的核心，控制着这个账户下所有的用户及角色对其资源的访问程度。允许还是拒绝？可访问？可管理？增删改查……对象是某个资源 or 某一类资源？</p><p>在 AWS 中，所有可能的权限都事先设计好，只需要绑定到用户、组或者角色就可以生效了。这些设计好的权限被称之为策略（Policy）。</p><p>AWS IAM 内置了一系列的 Policy ，已足够客户使用。万一不够，还可以创建属于自己的 Policy 。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877ely1frfwwlixkjj20b00dmt9b.jpg" /><font>（该图片系转载，侵删致歉。来源：<a href="https://www.jianshu.com/p/9ac6f557dd97" target="_blank"> Alchemist - AWS IAM 学习总结 </a>）</font></p><hr /><h2><a href="https://ephen.me/2018/cloudplatform-iam/#不同平台用户管理机制对比"></a>不同平台用户管理机制对比</h2><p>目前几乎所有的云平台都有基于资源协作的用户权限管理体系，国内的大厂像阿里云、腾讯云基本就是精简版的 AWS IAM ，而国外的产品倒是各有各的特色。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#Google-Cloud-Platform"></a>Google Cloud Platform</h3><p>GCP 在用户添加时便为其设定具备某种权限的角色，当然后期可编辑和更改。</p><p>角色即代表了权限 Map ，一个用户可以有多种角色，而角色策略本身内置不可编辑。</p><p>其他资源或应用需要接入时在第一次接入时自动创建基于 IAM 的成员，这样看来，应用获取的可能也是永久接入权限。</p><p>配置相对简单，但可扩展性一般。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1frekr14otnj21540dmdh9.jpg" /></p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#Azure"></a>Azure</h3><p>Azure 将客户按订阅方式划分不同的套餐，在每个订阅中配置用户角色和用户组。</p><p>和 GCP 类似，有一系列的资源控制内置权限。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877ely1frfw4kn7cnj218c0hstbi.jpg" /></p><p>值得一提的是，Azure 还有 Win Server 中的那套 Active Directory （活动目录）类似机制，使用域控制器将用户分域、分组并针对应用、控件、设备等（而非系统中的云资源）做一些安全权限配置。</p><p>但关于 Azure AD 我暂时理解得不够，未来可能还需要多花时间研究一下。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#IBM-Cloud-（BlueMix）"></a>IBM Cloud （BlueMix）</h3><p>BlueMix 在访问管理上看起来并没有使用统一的认证接口，它为资源创建服务标识以提供给内部其他资源或外部应用接入，同时亦可类似 GCP 那样直接为用户和组授权，也有直接为内部资源之间创建连结权限。</p><p>用户是邀请其他账号过来参与本账户的资源协作，没有子账号，不支持权限策略的编辑和制定。</p><p>不过，在其用户的管理配置界面，有提到“未来支持 IAM ”字样。</p><p>看来 AWS 行业鼻祖的地位影响还是很大的。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1frekr15j0lj21ga0dwmy9.jpg" /></p><p>BlueMix 给人的感觉，虽然除了子账号，其他各功能也都有，就是比较凌乱，没有统一管控起来。</p><hr /><h2><a href="https://ephen.me/2018/cloudplatform-iam/#基于-AWS-IAM-的一些思考"></a>基于 AWS IAM 的一些思考</h2><h3><a href="https://ephen.me/2018/cloudplatform-iam/#用户模型"></a>用户模型</h3><p>账户安全问题不容小觑，AWS 在 IAM 控制台首页就提示客户删除根密钥创建 IAM 管理员账户是最佳实践。</p><p>在 AWS IAM 用户管理体系中，它似乎与类 UNIX 操作系统的账户体系有着异曲同工之妙：只有 Root 掌握着最高权限，不同的类别服务使用各自的权限用户及用户组。</p><p>AWS 这样做，可以很好的防止账单信息被篡改、权限配置的错乱等各种安全和意外问题。</p><p>它把整个体系其实上升到了组织的结构，Root 不再是一个人，仅仅是代表了最高权限的集合，只有 IAM 子账号才是实实在在干活儿的人。就类似公司 or 企业，广大员工等价于这里的用户，Root 对应的就是公司。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#权限策略"></a>权限策略</h3><p>个人认为 AWS IAM 最厉害之处就是将 Policy 封装成了统一的框架，并提供了界面配置和适应专业人士的 json 配置模式，从而直接就形成了 AWS 的自有标准。</p><p>同时其内置策略特别多，想必已足够绝大部分用户的使用了。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#资源标识符-ARN"></a>资源标识符 ARN</h3><p>前面提到 BlueMix 有让用户为服务创建标识，而 AWS 中默认就是任何资源都有其标识。哪怕是一条服务策略、一个操作、一条配置也有自己的 ARN 。</p><p>所以在 AWS ，并不存在 BlueMix 中的那种为了建立连结而再给资源创建标识的需要。底层直接通过 ARN 连接就好。</p><hr /><h2><a href="https://ephen.me/2018/cloudplatform-iam/#关于-AWS-IAM-的周边功能体验"></a>关于 AWS IAM 的周边功能体验</h2><h3><a href="https://ephen.me/2018/cloudplatform-iam/#Organization"></a>Organization</h3><p>Organization ，其实就是一个基于树形结构的组织架构图的管理，里面也有涵盖了账户策略。不同的是，Organization 中的账户都是 Root 账户身份。</p><p>一开始，因为看到 IAM 用户组的存在，让人感觉有点晕头转向的，不知道作用如何。</p><p>经过一段时间的试用，我想，该功能大约是用于那种集团公司大架构下的管理吧。有很多很多子公司的存在，相互之间要独立又要有关联。</p><p>而 Organization 最大的作用大概就在于账单的合并与分离，其实跟接入权限控制关系不大。</p><p>有意思的是，在创建了 Organization 之后，IAM 会自动给这个 Organization 创建角色，从而在 Org 内部的用户可以通过 IAM 角色切换登陆。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#Cognito"></a>Cognito</h3><p>Cognito 是一个应用程序管理器，为你在 AWS 中创建的应用程序管理各种不同接入权限的用户池。</p><p>其实它跟 IAM 并没有什么特别的关系，IAM 是基于平台系统层次的，Cognito 基于某个具体的应用程序。假设 AWS 也有类似 ISO 网络模型的话，它们就不是同一层的概念了。</p><p>尽管我是偶然发现的这个模块功能，可其实在 Cognito 创建用户池的时候，发现它也会同步的创建一系列 IAM 管理角色。看起来，在应用程序的接入控制上，可能也调用了 IAM 体系中的某模块。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#CodeStar"></a>CodeStar</h3><p>CodeStar 在 AWS 中官方中文版译作“项目”，最先我也以为是以一种资源集合的形式存在（类似 GCP 的 Project ），实际看了之后也并不是。</p><p>CodeStar 其实是一个开发者平台，将开发者的项目直接发布到云。可通过连结本地 IDE （比如 VS Code）、代码共享平台（比如 GitHub）一站式管理和发布开发中的项目。当然 AWS 也提供自己的 IDE 和 代码共享平台并在这里推荐用户使用它们。</p><p>这样看来， CodeStar 其实类似一个多语言多平台的 GitHub Page 了，因而不仅仅是 Page 。</p><p>同样的， CodeStar 的创建也会向 IAM 中添加相应的各种角色。</p><p>其实在 AWS 中，真正的资源集合是顶栏标签上的“资源组”，虽然一贯的 AWS 风格，反倒资源组并没有惊艳到我，没有比较深入的体现协作管理关系。这点，我个人还是更喜欢 GCP 的项目风格。</p><h3><a href="https://ephen.me/2018/cloudplatform-iam/#……"></a>……</h3><p>其实上面那些严格来说也不算是 IAM 的周边功能吧。 AWS IAM 管理是全局的，很多功能模块使用时可能都会去创建个 IAM 角色接入到管理系统，以辅助完成该模块的身份认证和鉴权。</p><p>从这些试用中，可以发现 ARN 中的 “ Resource ” 一词，在整个体系中已不再是狭义的主机、数据库等用户申请创建的虚拟或硬件资源，而是平台中的每一个的功能包括账户管理、应用管理甚至 IAM 管理本身。</p><hr /><h2><a href="https://ephen.me/2018/cloudplatform-iam/#一点题外话"></a>一点题外话</h2><p>在看 IAM 这块内容时，不禁让我想起了多年前我在湖北省电信工作时的 BOSS 三户模型。那个体系因为业务的关系，比这个更复杂，在开发和实施过程中也是研究出了大量的通信标准。</p><p>印象中，那种完善的协议制定往往是多个专家经过了长达几个月的封闭式细节推敲和研究才完成，并且有着层层的质量审查。在我国互联网快速迭代的今天，这些真的是太难做到了。</p><p>而 AWS 一直坚持的标准和框架结构，想必在形成和迭代的过程中也是非常精密的。</p><p>技术复制可能容易，但精神和思想不易。</p>]]></content>
        
        <summary type="html">
            
            AWS 作为云计算行业鼻祖，不论是什么功能，都做得非常完备，且一切可编程。它们能全方位的解决客户的各种问题，甚至想他人之未曾想，真的非常值得业内人士及机构尊敬。但，完备的背后离不开大量的人力支持，又因为它的完备使得各业务都极其复杂。我最近才开始好好看一看 AWS ，才知道居然都
            
        </summary>
        
        <category term="工作笔记"/>
        
        <category term="用户鉴权"/>
        
        <category term="IAM"/>
        
        <category term="资源协作"/>
        
        <category term="AWS"/>
        
        <category term="Azure"/>
        
        <category term="GCP"/>
        
        <category term="BlueMix"/>
        
    </entry>
    
    <entry>
        <title>表情包在线生成–支持 TNT 模式(语音识别)</title>
        <link href="https://imiku.me/2018/05/17/1071.html"/>
        <id>https://imiku.me/2018/05/17/1071.html</id>
        
        <author>
            <name>Ice-Hazymoon</name>
        </author>
        
        <published>2018-05-17T14:44:45+00:00</published>
        <updated>2018-05-17T14:44:45+00:00</updated>
        
        <content type="html"><![CDATA[<p>5月15日 老罗发布了改变世界的 TNT, 虽然不是锤黑, 但看到价格和各种吐槽还是忍不住笑了</p>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/05/201805171344499.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/05/201805171344499.jpg" /></a></p>
<p>最近记仇的表情包挺火的, 所以也想做一个玩玩, 参考了 <a href="http://mdzz.space/" target="_blank">http://mdzz.space/</a> , 折腾了半天才把某些玄学 bug 解决了, 于是某位大佬发言了<span></span></p>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/05/2018051713510275.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/05/2018051713510275.png" /></a></p>
<p>嗯, 想法不错, 说弄就弄, 一开始准备用百度语音识别的 api 的, 发现流程有点复杂, 而且官方除了后端只有个 REST API 文档, 自己造轮子太麻烦了, 无意中发现了 Chrome 有语音识别的API, 有两种方法可以实现本地识别</p>
<h3>1. 在 input 标签上加一个 x-webkit-speech 属性</h3>
<p>方法虽然可行, 但我这死活都出不来, 而且是调用Google语音的接口, 如果没有科学上网还用不了, 暂时不会使用用, 使用方法:</p>
<pre><code>&lt;input x-webkit-speech /&gt;
</code></pre>
<h3>2. 使用 Web Speech API</h3>
<p>部分浏览器自带了 Web Speech API , 可以本地进行语音识别, 不需要网络, 只不过兼容性不是很好, 主要函数:</p>
<pre><code>recognition = new SpeechRecognition(); //创建一个 SpeechRecognition 对象
recognition.onresult = function (e) {}; //识别语音的函数
recognition.start(); //开始录音
</code></pre>
<p>其他API 可以参考 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API" target="_blank">Web Speech API - Web APIs | MDN</a></p>
<hr />
<p>对比了两个方法后毫无疑问选择第二个, 研究了半天终于成型了, 目前实现了</p>
<ul>
<li>本地语音识别, 不依赖任何网络服务</li>
<li>可自行上传图片, 也可使用模板的图片</li>
<li>可自行替换文字, 可设置样式(居中, 加粗)</li>
</ul>
<p>已知bug:</p>
<ul>
<li>语音识别的兼容性很差, 请使用现代浏览器(推荐 Chrome)</li>
<li>语音识别经常会不生效, 请刷新后重试</li>
</ul>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/05/2018051713374379.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/05/2018051713374379.png" /></a></p>
<p>网站: <a href="https://ice-hazymoon.github.io/bqb_tnt/dist/" target="_blank">https://ice-hazymoon.github.io/bqb_tnt/dist/</a></p>
<p>源代码: <a href="https://github.com/Ice-Hazymoon/bqb_tnt" target="_blank">Ice-Hazymoon/bqb_tnt</a></p>]]></content>
        
        <summary type="html">
            
            5月15日 老罗发布了改变世界的 TNT, 虽然不是锤黑, 但看到价格和各种吐槽还是忍不住笑了  最近记仇的表情包挺火的, 所以也想做一个玩玩, 参考了 http://mdzz.space/ , 折腾了半天才把某些玄学 bug 解决了, 于是某位大佬发言了  嗯, 想法不错, 
            
        </summary>
        
        <category term="代码向"/>
        
        <category term="小工具"/>
        
        <category term="表情包"/>
        
        <category term="语音识别"/>
        
    </entry>
    
    <entry>
        <title>妈个鸡配置在Windows环境变量里的http_proxy可能导致npm install一直报cb() never called</title>
        <link href="https://www.mokeyjay.com/archives/2232"/>
        <id>https://www.mokeyjay.com/archives/2232</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-05-17T10:03:45+00:00</published>
        <updated>2018-05-17T10:03:45+00:00</updated>
        
        <content type="html"><![CDATA[妈个鸡 配置在Windows环境变量里的http_proxy可能导致npm install一直报cb() never called。别问我为什么知道，我今天一下午就搭在这上面了]]></content>
        
        <summary type="html">
            
            妈个鸡 配置在Windows环境变量里的http_proxy可能导致npm install一直报cb() never called。别问我为什么知道，我今天一下午就搭在这上面了
            
        </summary>
        
        <category term="Javascript"/>
        
        <category term="技术"/>
        
        <category term="杂谈"/>
        
    </entry>
    
    <entry>
        <title>在 GNU/Linux 上使用 SSR</title>
        <link href="https://liyin.date/2018/05/02/use-ssr-on-gnu-linux/"/>
        <id>https://liyin.date/2018/05/02/use-ssr-on-gnu-linux/</id>
        
        <published>2018-05-02T17:39:45+00:00</published>
        <updated>2018-05-02T17:39:45+00:00</updated>
        
        <content type="html"><![CDATA[<h1><a href="https://liyin.date/2018/05/02/use-ssr-on-gnu-linux/#前言"></a>前言</h1><p>最近正好手里有了一些闲钱，于是就想着把现在电脑里装的双系统里的 openSuSE 单独找一台电脑装，于是翻了翻闲鱼收了一台 ThinkPad</p>]]></content>
        
        <summary type="html">
            
            前言最近正好手里有了一些闲钱，于是就想着把现在电脑里装的双系统里的 openSuSE 单独找一台电脑装，于是翻了翻闲鱼收了一台 ThinkPad
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Windows下查看全局快捷键被占用情况的方法</title>
        <link href="https://www.mokeyjay.com/archives/2166"/>
        <id>https://www.mokeyjay.com/archives/2166</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-04-28T08:32:59+00:00</published>
        <updated>2018-04-28T08:32:59+00:00</updated>
        
        <content type="html"><![CDATA[最近 Ctrl+R 刷新快捷键在浏览器里无效了，只能伸手按H5，很不方便 刚开始还忍着用，后来偶然一次火了，就非要找出全局注册这个快捷键的傻逼玩意儿 于是显示一通谷歌，找出来的软件要么太老不能用，要么网页打不开，要么就是这个年久失修的Windows Hotkey Explorer 但是这傻逼玩意儿一双击运行，就会弹出一堆软件窗口。据网友说是Win10某个版本之后，这软件一运行就会自动把快捷键全按一]]></content>
        
        <summary type="html">
            
            最近 Ctrl+R 刷新快捷键在浏览器里无效了，只能伸手按H5，很不方便 刚开始还忍着用，后来偶然一次火了，就非要找出全局注册这个快捷键的傻逼玩意儿 于是显示一通谷歌，找出来的软件要么太老不能用，要么网页打不开，要么就是这个年久失修的Windows Hotkey Explore
            
        </summary>
        
        <category term="技术"/>
        
    </entry>
    
    <entry>
        <title>服务器安装全新 Ubuntu 18.04</title>
        <link href="https://i-meto.com/netboot-ubuntu-18-04/"/>
        <id>https://i-meto.com/netboot-ubuntu-18-04/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2018-04-26T23:29:13+00:00</published>
        <updated>2018-04-26T23:29:13+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>Ubuntu 18.04 Bionic Beaver 已经在 2018 年 04 月 27 号发布，<s>而很多云厂商甚至都还没更新系统模板（被打死</s>，作为更新强迫症，决定亲自动手重新安装服务器的系统。</p>
<p>本教程在阿里云、腾讯云实测成功，下面拿阿里云来开刀。</p>
<h2>0、环境准备</h2>
<p>打开阿里云服务器管理控制台，在云主机实例列表中找到需要重装的主机，为避免出现各种奇怪的问题，建议重置系统为本文实验环境 ubuntu 16.04.4 LTS（或者 Debian 9）</p>
<p>然后点击远程连接</p>
<p><img src="https://i.loli.net/2018/04/25/5adfe0fd90909.png" /></p>
<p>使用 <code>ip route</code> 命令列出当前网卡信息，记录下来（专有网络大概可以忽略）</p>
<h2>1、下载系统安装文件</h2>
<p>新建文件夹 <code>/boot/netboot</code> 并且下载两个 <code>netboot</code> 文件</p>
<pre><code>mkdir /boot/netboot &amp;&amp; cd /boot/netboot
wget http://mirrors.aliyun.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/linux
wget http://mirrors.aliyun.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/initrd.gz
</code></pre>
<h2>2、更新 grub</h2>
<p>修改 <code>/etc/default/grub</code> 如下</p>
<pre><code># /etc/default/grub
GRUB_DEFAULT=0
GRUB_HIDDEN_TIMEOUT_QUIET=true
GRUB_TIMEOUT=10
GRUB_DISTRIBUTOR=Ubuntu
GRUB_CMDLINE_LINUX_DEFAULT=&quot;&quot;
GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 biosdevname=0 console=ttyS0,115200 console=tty0 panic=5 crashkernel=auto&quot;
GRUB_TERMINAL=&quot;console serial&quot;
GRUB_SERIAL_COMMAND=&quot;serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1&quot;
</code></pre>
<p>修改后执行 <code>update-grub</code> 生成新的 <code>/boot/grub/grub.cfg</code></p>
<pre><code>update-grub
</code></pre>
<p>然后加入 <code>netboot</code> 的引导项</p>
<pre><code>cat &gt;&gt; /boot/grub/grub.cfg &lt;&lt; EOF
menuentry 'Ubuntu 18.04 Installer' {
    insmod part_msdos
    insmod ext2
    set root='(hd0,msdos1)'
    linux /boot/netboot/linux
    initrd /boot/netboot/initrd.gz
}
EOF
</code></pre>
<h2>3、进入安装</h2>
<p>打开 vnc 页面，确保看到界面后，在 <code>ssh</code> 上运行 <code>reboot</code> 执行重启，当 vnc 界面显示启动项选择时，选择 <code>Ubuntu 18.04 Installer</code> 回车进入。</p>
<p><img src="https://i.loli.net/2018/04/24/5adf441b7ec04.png" /></p>
<p>选择语言，通常直接选择 <code>English</code></p>
<p><img src="https://i.loli.net/2018/04/24/5adf30cd34595.png" /></p>
<p>然后选择国家，因为这会关系到后面的时区设置，所以我们选择 <code>other</code> -&gt; <code>Asia</code> -&gt; <code>China</code></p>
<p><img src="https://i.loli.net/2018/04/24/5adf308993018.png" /></p>
<p>编码直接选择 <code>English</code> 即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf30bc57291.png" /></p>
<p>出现 <code>Detect keyboard layout</code> 界面，保持默认回车几次即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf31e985b8b.png" /></p>
<p>接下来会安装程序尝试获取 <code>DHCP</code></p>
<p><img src="https://i.loli.net/2018/04/24/5adf445eccef1.png" /></p>
<p>如果你是经典网络，很有可能会出现下面的错误，所以我们手工配置一下 IP 即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf3329783a4.png" /></p>
<p>填入之前 <code>ip route</code> 看到的 IP、网关地址即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf337f240fb.png" /></p>
<p>填写主机名，<s>起个萌萌的名字比如 <code>meto</code>、<code>lwl</code> 什么的</s></p>
<p><img src="https://i.loli.net/2018/04/24/5adf349d6c690.png" /></p>
<p>填写域名，通常不需要，直接回车</p>
<p><img src="https://i.loli.net/2018/04/24/5adf34b54b861.png" /></p>
<p>选择镜像地址，尽量选择服务器所在区域，不然后面你会为网速气得直跺脚的</p>
<p>当然也可以选择使用阿里云镜像 <code>mirrors.aliyun.com</code></p>
<p><img src="https://i.loli.net/2018/04/24/5adf3510e83da.png" /></p>
<p>接下来就看网速了</p>
<p><img src="https://i.loli.net/2018/04/24/5adf4aa077d69.png" /></p>
<p>填写用户名</p>
<p><img src="https://i.loli.net/2018/04/24/5adf3861ed8fb.png" /></p>
<p>填写密码</p>
<p><img src="https://i.loli.net/2018/04/24/5adf389c8bdce.png" /></p>
<p>接下来会尝试校准时间，然后确认即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf38e6755be.png" /></p>
<p>询问硬盘分区方案，没有特殊需求就选择整块硬盘吧，这一步千万别选错</p>
<p><img src="https://i.loli.net/2018/04/24/5adf4bc138aa8.png" /></p>
<p>看清楚后确认即可</p>
<p><img src="https://i.loli.net/2018/04/24/5adf4c1d6e085.png" /></p>
<p>接下来就是漫长的安装了</p>
<p>你可以选择出去外面玩、跑步、遛<s>METO</s>狗、或者。。不出去</p>
<p><img src="https://i.loli.net/2018/04/24/5adf4c73cd0da.png" /></p>
<p><img src="https://i.loli.net/2018/04/24/5adf4e8d46aba.png" /></p>
<p>安装完毕后会询问是否自动升级，这里选不</p>
<p><img src="https://i.loli.net/2018/04/24/5adf4f2c20d93.png" /></p>
<p>询问需要装哪些软件，这里只选择 <code>OpenSSH server</code></p>
<p><img src="https://i.loli.net/2018/04/24/5adf4fb8bd4d9.png" /></p>
<p>继续安装软件</p>
<p>同样，你可以选择出去外面玩、跑步、遛<s>METO</s>狗、或者。。不出去</p>
<p><img src="https://i.loli.net/2018/04/24/5adf5048c16ca.png" /></p>
<p>继续使用 grub，万一两年后的今天还要升级 ubuntu 20.04 呢？</p>
<p><img src="https://i.loli.net/2018/04/24/5adf50e87e514.png" /></p>
<p>确认硬件时间</p>
<p><img src="https://i.loli.net/2018/04/24/5adf511f6ea6b.png" /></p>
<p>完成安装</p>
<p><img src="https://i.loli.net/2018/04/24/5adf514f742ba.png" /></p>
<h2>4、大功告成</h2>
<p><img src="https://i.loli.net/2018/04/24/5adf521bcce65.png" /></p>
<h2>5、一些变化</h2>
<p>内核更新到了 Linux kernel 4.15，这就意味着新增了不少特性 <s>bbr什么的</s></p>
<p>网络管理工具 <code>ifupdown</code> 已经彻底废弃，建议全面拥抱 <code>ip</code> 命令</p>
<p>DNS 由 systemd 全面接管，接口监听在 <code>127.0.0.53:53</code>，配置文件在 <code>/etc/systemd/resolved.conf</code>，修改后重启服务即可 <code>systemctl restart systemd-resolved</code>。不要听网上那些奇怪的教程教你如何修改 <code>/etc/resolv.conf</code></p>
<p>由 swap 文件来替代 swap 分区</p>
<p>python2 不再默认安装，这也将是最后一个支持 python2 的 LTS 版本</p>
<h2>6、PPA</h2>
<p>这里附上一些常用的 PPA/源</p>
<table>
<thead>
<tr>
<th>name</th>
<th>url</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP</td>
<td><a href="https://launchpad.net/~ondrej/+archive/ubuntu/php">https://launchpad.net/~ondrej/+archive/ubuntu/php</a></td>
</tr>
<tr>
<td>nginx</td>
<td><a href="https://launchpad.net/~nginx/+archive/ubuntu/stable">https://launchpad.net/~nginx/+archive/ubuntu/stable</a></td>
</tr>
<tr>
<td>Redis</td>
<td><a href="https://launchpad.net/~chris-lea/+archive/ubuntu/redis-server">https://launchpad.net/~chris-lea/+archive/ubuntu/redis-server</a></td>
</tr>
<tr>
<td>MySQL</td>
<td><a href="https://dev.mysql.com/get/mysql-apt-config_0.8.10-1_all.deb">https://dev.mysql.com/get/mysql-apt-config_0.8.10-1_all.deb</a></td>
</tr>
</tbody>
</table>
<h2>参考资料</h2>
<ul>
<li><a href="https://sb.sb/blog/install-debian-alibabacloud/">阿里云通过网络安装全新 Debian 9 Stretch</a></li>
<li><a href="https://help.ubuntu.com/community/Installation/NetbootInstallFromInternet">Installation/NetbootInstallFromInternet</a></li>
</ul>
</div>]]></content>
        
        <summary type="html">
            
            Ubuntu 18.04 Bionic Beaver 已经在 2018 年 04 月 27 号发布，而很多云厂商甚至都还没更新系统模板（被打死，作为更新强迫症，决定亲自动手重新安装服务器的系统。 本教程在阿里云、腾讯云实测成功，下面拿阿里云来开刀。 0、环境准备 打开阿里云服务
            
        </summary>
        
        <category term="LINUX"/>
        
    </entry>
    
    <entry>
        <title>成人仪式</title>
        <link href="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/"/>
        <id>https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/</id>
        
        <published>2018-04-26T15:17:18+00:00</published>
        <updated>2018-04-26T15:17:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>嗯，已经过去一个月了</p>
<a></a>
<p><s>高三</s> 我真的很 <s>忙</s> 懒，懒得写文章记录我都干了啥，过了一个月还是觉得有必要写写技术方面的东西哈(不然博客都长草了!)</p>
<p>首先感谢 <a href="https://liyin.date/" target="_blank">神楽坂 立音</a> 告诉我 <a href="https://obsproject.com/" target="_blank">OBS</a> 有个叫<strong>工作室模式</strong>的东西，可以拿来当<strong>切换台</strong>用，再加上 <a href="https://obsproject.com/forum/resources/obs-ndi-newtek-ndi%E2%84%A2-integration-into-obs-studio.528/" target="_blank">obs-ndi插件</a> 和手机端的 <a href="https://play.google.com/store/apps/details?id=com.newtek.ndicamera" target="_blank">NewTek NDI Camera™</a>，就可以让手机变成无线摄像头，还是低延时的哟</p>
<p><img src="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/obs1.png" /><br />
<img src="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/obs2.png" /><br />
<img src="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/ndi.png" /></p>
<blockquote>
<p><strong>Network Device Interface (NDI)</strong> is a royalty free standard developed by NewTek to enable video-compatible products to communicate, deliver, and receive broadcast quality video in a high quality, low latency manner that is frame-accurate and suitable for switching in a live production environment. The protocol is designed to be highly robust and is used in many network-connected video devices.</p>
</blockquote>
<p>本次活动后台共使用了三台笔记本，一台放幻灯片，另一台用 OBS 处理视频信号并输出到大屏幕上，最后一台备用(然而并没有用上)</p>
<p>放幻灯片那台笔记本 -&gt; MiniDP -&gt; HDMI -&gt; 一个特 low 的采集卡 -&gt; OBS<br />
嗯，就这么简单</p>
<p>经过前期测试，NDI这个东西是真的烧带宽啊，2.4G基本带不起来，5G勉勉强强能带起来一个(或许是因为已有的路由器太烂?)，于是乎弄了个 <strong>LinkSYS EA6900</strong>，嗯，效果还不错，俩手机20米内基本不会卡顿.</p>
<p>声音呢？把家里的小混音台搬过去了，后台只负责视频的声音，那玩意大概没啥用。</p>
<p>技术上面嘛，大概就是这么多。</p>
<p><img src="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/photo_2018-04-27_00-14-37.jpg" /></p>
<p><img src="https://blog.asec01.net/bj54zx-coming-of-age-ceremony-2018/photo_2018-04-27_00-14-09-m.jpg" /></p>
<p>某个肥宅要求：“下次记得发照片把周围人的脸全打上码就留自己的”<br />
emmmm</p>]]></content>
        
        <summary type="html">
            
            嗯，已经过去一个月了  高三 我真的很 忙 懒，懒得写文章记录我都干了啥，过了一个月还是觉得有必要写写技术方面的东西哈(不然博客都长草了!) 首先感谢 神楽坂 立音 告诉我 OBS 有个叫工作室模式的东西，可以拿来当切换台用，再加上 obs-ndi插件 和手机端的 NewTek
            
        </summary>
        
    </entry>
    
    <entry>
        <title>关于兼容 IE8 浏览器的相关备份</title>
        <link href="https://imiku.me/2018/04/25/1062.html"/>
        <id>https://imiku.me/2018/04/25/1062.html</id>
        
        <author>
            <name>Ice-Hazymoon</name>
        </author>
        
        <published>2018-04-25T07:58:31+00:00</published>
        <updated>2018-04-25T07:58:31+00:00</updated>
        
        <content type="html"><![CDATA[<p>这几天做网站的时候遇到的恶心需求， 特此备份一下<span></span></p>
<h2>HTML5 标签的兼容</h2>
<p><a href="https://github.com/aFarkas/html5shiv" target="_blank">aFarkas/html5shiv</a>（巨坑， IE8 用 HTML5 的结构标签不解析样式。。。<span></span>）</p>
<h2>媒体查询器的兼容</h2>
<p><a href="https://github.com/scottjehl/Respond" target="_blank">scottjehl/Respond</a>（不能解析通过 @import 引用的 css）</p>
<h2>选择器兼容</h2>
<p><a href="https://github.com/keithclark/selectivizr" target="_blank">keithclark/selectivizr</a></p>
<h2>Flex 布局</h2>
<p><a href="https://github.com/jonathantneal/flexibility" target="_blank">jonathantneal/flexibility</a>（特好用， 有 postcss 的插件）</p>
<h2>css前缀</h2>
<p><a href="https://github.com/postcss/autoprefixer" target="_blank">postcss/autoprefixer</a></p>
<p>在线处理： <a href="https://autoprefixer.github.io/" target="_blank">https://autoprefixer.github.io/</a></p>
<h2>ES6处理</h2>
<p><a href="https://github.com/mishoo/UglifyJS2" target="_blank">UglifyJsPlugin</a>（虽然处理过了， 勉强能用， 但还是有些蜜汁报错）</p>
<h2>Promise</h2>
<p><a href="https://github.com/stefanpenner/es6-promise" target="_blank">stefanpenner/es6-promise</a></p>
<h2>canvas</h2>
<p><a href="https://github.com/arv/explorercanvas" target="_blank">arv/ExplorerCanvas</a> （没用过， 别人告诉我的）</p>
<h2>其他</h2>
<ul>
<li>不要使用 data URL</li>
<li>jQuery 有时候其实还挺好用的</li>
<li>可以用 <a href="https://github.com/burocratik/outdated-browser" target="_blank">outdated-browser</a> 如果甲方够人性化的话<span></span></li>
<li>实在不行就用fireworks切图， 然后用表格布局<span></span></li>
<li>Fuck IE！！！</li>
</ul>]]></content>
        
        <summary type="html">
            
            这几天做网站的时候遇到的恶心需求， 特此备份一下 HTML5 标签的兼容 aFarkas/html5shiv（巨坑， IE8 用 HTML5 的结构标签不解析样式。。。） 媒体查询器的兼容 scottjehl/Respond（不能解析通过 @import 引用的 css） 选择
            
        </summary>
        
        <category term="代码向"/>
        
        <category term="IE"/>
        
        <category term="兼容性"/>
        
        <category term="前端"/>
        
    </entry>
    
    <entry>
        <title>聊聊微信小程序开发框架及一些心得</title>
        <link href="https://www.mokeyjay.com/archives/2154"/>
        <id>https://www.mokeyjay.com/archives/2154</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-04-24T09:44:18+00:00</published>
        <updated>2018-04-24T09:44:18+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://www.mokeyjay.com/archives/2154"><img src="https://www.mokeyjay.com/wp-content/uploads/2016/06/wechat.png" /></a></p>这阵子因为某些原因又要开始写小程序了。其实写过小程序的人都知道，原生小程序在开发过程中到处都充斥着傻屌的气息 所以这次实在不想继续原生开发。正好时间不是很紧实际上紧得很，怎奈就是手痒 于是试用了3款算是大厂出品的小程序框架。最近比较有空，来简单写下感想 以下内容基于一个前端菜鸡一周多前的记忆整理而成，如有疏漏望友好指出 WePY 说到小程序的框架，第一反应就是这款腾讯出品的、大概是最老牌的框架。它]]></content>
        
        <summary type="html">
            
            这阵子因为某些原因又要开始写小程序了。其实写过小程序的人都知道，原生小程序在开发过程中到处都充斥着傻屌的气息 所以这次实在不想继续原生开发。正好时间不是很紧实际上紧得很，怎奈就是手痒 于是试用了3款算是大厂出品的小程序框架。最近比较有空，来简单写下感想 以下内容基于一个前端菜鸡
            
        </summary>
        
        <category term="微信小程序"/>
        
    </entry>
    
    <entry>
        <title>(非信仰)网易云x漫步者 W800X 耳机到手</title>
        <link href="https://imiku.me/2018/04/22/1054.html"/>
        <id>https://imiku.me/2018/04/22/1054.html</id>
        
        <author>
            <name>Ice-Hazymoon</name>
        </author>
        
        <published>2018-04-22T09:17:20+00:00</published>
        <updated>2018-04-22T09:17:20+00:00</updated>
        
        <content type="html"><![CDATA[<p>前几天用耳机听歌时, 不小心用耳机线扯到我的杯子了, 然后....嗯<span></span>, 碎了, 当场就下单了一个蓝牙耳机</p>
<p>搜了半天发现网易云和漫步者合作出了一款耳机, 看了下还行, 价格也挺便宜的, 于是下单了, 隔了三天才到货, 送了个鼠标垫(质量还不错, 挺大的), 耳机的话, 还行吧....</p>
<h2>包装</h2>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/04/201804220901511.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/04/201804220901511.jpg" /></a></p>
<h2>相关参数</h2>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015324.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015324.jpg" /></a></p>
<h2>包装内部</h2>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015628.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015628.jpg" /></a></p>
<h2>赠品鼠标垫</h2>
<p><a href="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015911.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2018/04/2018042209015911.jpg" /></a></p>
<h2>其他</h2>
<p>声音的话....非常糟糕, 蓝牙还时不时断一下, 声音经过QQ音乐的DTS神调教, 总体来说还能听得过去, 毕竟价格摆在这</p>
<p>对了, 鼠标垫挺好用的<span></span></p>]]></content>
        
        <summary type="html">
            
            前几天用耳机听歌时, 不小心用耳机线扯到我的杯子了, 然后....嗯, 碎了, 当场就下单了一个蓝牙耳机 搜了半天发现网易云和漫步者合作出了一款耳机, 看了下还行, 价格也挺便宜的, 于是下单了, 隔了三天才到货, 送了个鼠标垫(质量还不错, 挺大的), 耳机的话, 还行吧..
            
        </summary>
        
        <category term="日常"/>
        
        <category term="购物"/>
        
    </entry>
    
    <entry>
        <title>对博客分类进行了一些整理</title>
        <link href="https://liyin.date/2018/04/19/blog-categories-sort/"/>
        <id>https://liyin.date/2018/04/19/blog-categories-sort/</id>
        
        <published>2018-04-19T11:41:14+00:00</published>
        <updated>2018-04-19T11:41:14+00:00</updated>
        
        <content type="html"><![CDATA[<p>之前本博客的分类非常混乱，基本上就当作标签一样来用…. 导致根本无法正常的分类博文，于是最近对博文进行了重新分类。</p>
<table>
<thead>
<tr>
<th>类别</th>
</th></tr></thead>]]></content>
        
        <summary type="html">
            
            之前本博客的分类非常混乱，基本上就当作标签一样来用…. 导致根本无法正常的分类博文，于是最近对博文进行了重新分类。    类别 
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Google 分析 与 Do Not Track</title>
        <link href="https://liyin.date/2018/04/19/googleanalytic-dnt/"/>
        <id>https://liyin.date/2018/04/19/googleanalytic-dnt/</id>
        
        <published>2018-04-19T11:16:52+00:00</published>
        <updated>2018-04-19T11:16:52+00:00</updated>
        
        <content type="html"><![CDATA[<h1><a href="https://liyin.date/2018/04/19/googleanalytic-dnt/#Google-Analytics"></a>Google Analytics</h1><p></a>]]></content>
        
        <summary type="html">
            
            Google Analytics
            
        </summary>
        
    </entry>
    
    <entry>
        <title>熊猫都是树上长的.jpg</title>
        <link href="https://www.isthnew.com/archives/gungun.html"/>
        <id>https://www.isthnew.com/archives/gungun.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-04-15T12:13:22+00:00</published>
        <updated>2018-04-15T12:13:22+00:00</updated>
        
        <content type="html"><![CDATA[<p>这周，小赵童鞋说周末去拍照，然额本人那么宅的怎么知道哪里有好地方可以去。当然是打开高德地图看一眼</p>
<p></p>]]></content>
        
        <summary type="html">
            
            这周，小赵童鞋说周末去拍照，然额本人那么宅的怎么知道哪里有好地方可以去。当然是打开高德地图看一眼 
            
        </summary>
        
        <category term="世界在这里"/>
        
        <category term="熊猫"/>
        
        <category term="游记"/>
        
    </entry>
    
    <entry>
        <title>Web Font 123 - 再谈 WebFont 优化</title>
        <link href="https://blog.nfz.moe/archives/webfont-123.html"/>
        <id>https://blog.nfz.moe/archives/webfont-123.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-04-12T14:01:00+00:00</published>
        <updated>2018-04-12T14:01:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>众所周知，字体是实现良好的设计、品牌推广、可读性和无障碍功能的基础。如今，所有还在使用的浏览器都已经支持 WebFont。WebFont 除了体现了字体的作用，还是实现用户体验和性能的关键所在。<a></a>在 WebFont 推出以前，设计师的字体设计最终都是使用图片实现的。WebFont 的出现使设计师在可以达成所有上述目标的同时，还可以实现：文本可选取、可搜索、可缩放并支持高 DPI，无论屏幕尺寸和分辨率如何均可提供清晰锐利的文本渲染。</p><p>在我之前的一篇博客 <a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html">「Web 性能优化（6）——WebFont 字体优化」</a> 中，我简单介绍了一下针对 WebFont 在加载上的优化方案。现在随着姿势水平的提高，我现在打算来重新谈一下 WebFont。</p><h1><a href="https://blog.nfz.moe/archives/webfont-123.html# 浏览器如何渲染网页"></a>浏览器如何渲染网页</h1><blockquote><p>划重点（TL;DR）：当浏览器读取到 <code>@font-face</code> 时并不会立刻开始下载字体，而是在 DOM Tree 生成之后，浏览器发现 DOM Tree 中有非空的文本内容使用了 <code>font-face</code> 的字体才开始下载（IE9+ 会下载空节点）。</p></blockquote><p>虽然很多人都已经把整个流程背的快要烂熟了，但是为了给文章凑字数我还是有必要再来一遍，嗯。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000188.png" /></p><ul><li>浏览器请求 HTML 文档。</li><li>浏览器开始解析 HTML 响应和构建 DOM。</li><li>浏览器发现 CSS、JS 以及其他资源并分派请求。</li><li>浏览器在收到所有 CSS 内容后构建 CSSOM，然后将其与 DOM 树合并以构建渲染树。</li><li>在渲染树指示需要哪些字体变体在网页上渲染指定文本后，将分派字体请求。</li><li>浏览器执行布局并将内容绘制到屏幕上。</li><li>如果字体尚不可用，浏览器可能不会渲染任何文本像素。</li><li>字体可用之后，浏览器将绘制文本像素。</li></ul><p>如果当前字体不可用，浏览器就要去加载字体。在这个期间浏览器应该如何渲染文本，就有以下几种常见的方式：</p><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#FOUT-（Flash-of-Unstyled-Text）"></a>FOUT （Flash of Unstyled Text）</h2><p>当我们在 <code>@font-face</code> 中按优先级顺序定义了一系列字体（称之为 Font Stack）时，如果定义的最高优先级的字体在设备的字库中没有找到、或者引用了 WebFont 但是字体文件没有被加载，那么浏览器会继续轮询 Font Stack，直到找到可用的字体（这个过程就是寻找 fallback 字体）并先渲染出来；当自定义的字体文件被加载以后，浏览器会用这个字体文件重新渲染一遍画面。这有可能造成页面已经展示给用户以后页面的布局再次发生改动。而且，设计师并不喜欢 FOUT，因为这意味着有可能先让访客看到并不好看的备用字体、再看到好看的设计好的字体。但是 FOUT 不会因为字体文件无法加载而导致用户啥都看不到。IE 自从诞生之日起就在使用这种模式，现在 Edge 也在使用这种模式。</p><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#FOIT-（Flash-of-Invisible-Text）"></a>FOIT （Flash of Invisible Text）</h2><p>这是浏览器处理在设备的字库中没有找到、或者字体文件尚未被下载时的另一种方案。如果检测到设定了当前优先级下有设置自定义字体文件，那么浏览器就会不显示任何内容，直到字体显示出来。这有可能造成访客可能需要等待很长一段时间才能看见网页的内容；如果网络环境较为恶劣，甚至有可能会导致有的内容永久不可见。Safari 曾经在很长的一段时间内使用这种模式，并且 iOS WebKit 仍然在使用这种模式，Opera 也曾短暂使用过。</p><blockquote><p>FOIT 也有其优点，比如在显示 emoji 表情时，某些（大部分）emoji 表情在默认字体下会是一个方框，FOIT 避免了 fallback 字体时带来的不可预测的显示错误。</p><p>如果想要体验这两种方式的区别，你可以在 <a href="https://www.zachleat.com/foitfout/#4000,4000,4000,4000" target="_blank">这里 </a> 尝试一下。<br /> 对于是使用 FOIT 还是 FOUT 的效果更好一直众说纷纭。不同的渲染策略各有充分的支持和反对理由。一些人觉得重新渲染令人反感，而其他人则愿意立即看到结果，并且不介意在字体下载完成后网页的自动重排。我们暂且不会参与这一争论，至少我个人的看法是，FOUT 给人的感觉更快（即时渲染比延迟更快）。但是如果你可以保证字体在超时之前加载（然而你并不能），FOIT 会感觉更稳定。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#FOIT-3S"></a>FOIT 3S</h2><p>这应该是一个比较折中的解决方案，并且目前 Chrome、Firefox、Safari 都在使用。在 3s 内使用了自定义字体样式的使用 FOIT 模式，在一定时间内（1s，3-5s，也可能是 10s，具体看浏览器和版本）使用 FOIT，如果字体仍然没有加载出来就降级到 FOUT 以改善用户的浏览体验。</p><p>下面这个视频介绍了浏览器处理字体时方式演变的历史。</p>你的浏览器不支持 emmbed video。你可以试试 <a href="https://neofelhz.wodemo.com/down/20180412/477045/foit-fout-history.mp4" target="_blank">下载</a> 它。<h1><a href="https://blog.nfz.moe/archives/webfont-123.html#Magic-Trick"></a>Magic Trick</h1><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#Font-Loader"></a>Font Loader</h2><p>Font Loader 目的提供了一种脚本编程接口来定义和操纵 CSS 字体，追踪其下载进度，以及替换其默认延迟下载行为。常见的方案有 Google Font Loader，<a href="https://github.com/bramstein/fontfaceobserver" target="_blank">fontfaceobserver</a> 和 <a href="https://github.com/typekit/webfontloader" target="_blank">Web Font Loader</a>。这本是应对 2015 年以前的浏览器（那是 FOIT 3s 还是个梦的年代）而生的。但是现在我们依然可以使用它，作为表明我们比浏览器聪明（我经常这么觉得）的方式。原理是通过 Event API 检查字体文件是否加载完成，通过操作 class 的方式决定什么时候用什么 <code>font-family</code> 或者干脆直接操作 <code>display</code> 自己重新实现一个 FOIT（开个历史的倒车），从而改善字体显示效果。使用 Magic Trick 的好处是至少兼容一些比较老的浏览器。</p><blockquote><p><a href="https://drafts.csswg.org/css-font-loading/" target="_blank">CSS Font Loading API</a></p></blockquote><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#FOFT-（Flash-of-Faux-Text）"></a>FOFT （Flash of Faux Text）</h2><p>这是另外一个 Magic Trick。当你提供的自定义字体里没有粗体字重或者斜体时，浏览器会自己渲染一个“仿粗体”“仿斜体”（具体的相关细节可以阅读 <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/webfont-optimization" target="_blank">Google Web Foundations 的 Web Font Optimization 的相关章节</a>）。但是浏览器制作的“仿粗体”“仿斜体”显然比较的“粗劣”。所以 FOFT 就是在斜体和粗体的自定义字体文件加载之前先使用浏览器渲染的“仿粗体”“仿斜体”，直到自定义字体的粗体和斜体文件加载后再直接进入渲染代替“仿粗体”“仿斜体”。</p><h1><a href="https://blog.nfz.moe/archives/webfont-123.html#Font-Display"></a>Font Display</h1><p>目前绝大部分现代的浏览器都已经支持通过 CSS 控制字体渲染（查看 <a href="https://caniuse.com/#feat=css-font-rendering-controls" target="_blank">Can I Use</a>；查看 <a href="https://www.w3.org/TR/css-fonts-4/" target="_blank">W3C 草案</a>）。比如使用 <code>font-display</code></p><p><code>font-display: swap</code>：浏览器会直接使用 <code>font-family</code> 中最先匹配到的已经能够使用的字体，然后当 <code>font-family</code> 中更靠前的字体成功载入时，切换到更靠前的字体，相当于是 FOUT。<br /><code>font-display: fallback</code>：浏览器会先等待最靠前的字体加载，如果没加载到就不显示任何东西，这个过程大约持续 100ms，然后按照顺序显示已经成功载入的字体。在此之后有大约 3s 的时间来提供切换到加载完毕的更靠前的字体。<br /><code>font-display: optional</code>：浏览器会先等待最靠前的字体加载，如果没加载到就不显示任何东西，这个过程大约持续 100ms，但是字体就不会再更改了（一般第一次打开某页面的时候都会使用 fallabck 字体，字体被下载但是没被使用，之后打开时可以使用缓存中的字体）。</p><p>要点在于，无论是 FOIT 还是 FOUT，虽然延迟加载减少了字节数，但也可能会延迟文本渲染。</p><h1><a href="https://blog.nfz.moe/archives/webfont-123.html# 通过内联优化字体渲染"></a>通过内联优化字体渲染 </h1><p> 有一个简单的替代策略可以代替 Font Loading API 或者 Font Display 来避免页面上什么都不显示，就是将字体文件内联到 CSS 样式表内。这是因为：</p><ul><li>浏览器会使用高优先级自动下载具有匹配媒体查询的 CSS 样式表，因为需要使用它们来构建 CSSOM。</li><li>将字体数据内联到 CSS 样式表中会强制浏览器使用高优先级下载字体，而不等待渲染树。即它起到的是手动替换默认延迟加载行为的作用。</li></ul><p>在你把字体 inline 到 css 里之前先回想一下，<code>@font-face</code> 使用延迟加载行为来避免下载多余的字体变体和子集。此外，通过主动式内联增加 CSS 的大小将对您的关键渲染路径产生不良影响。浏览器必须下载所有 CSS，然后才能构造 CSSOM，构建渲染树，以及将页面内容渲染到屏幕上。而且内联策略不那么灵活，不允许您为不同的内容定义自定义超时或渲染策略（因为你的字体和 css 绑定在一起并且变得一样重要），但不失为是一种适用于绝大部分浏览器并且简单而又可靠的解决方案。</p><blockquote><p>详情可以参看我的「<a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html">Web 性能优化（3）——探讨 data URI 的性能 </a>」<br /> 另外，如果想要提高字体在加载时的权重，可以参考 <code>Recource Hint</code> 方案。我的博客也有专门讲述 <code>Recource Hint</code> 的文章：「<a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html">Web 性能优化（5）——Preload 和 Server Push</a>」。注意，在 preload webfont 时要注意设定 <code>crossorigin</code> 参数来避免 CORS 问题。</p></blockquote><p>Google 在 Web Foundations 中是这么介绍的：</p><blockquote><p>为获得最佳效果，请将内联字体分成独立的样式表，并为它们提供较长的 max-age。这样一来，在您更新 CSS 时，就不会强制访问者重新下载字体。</p></blockquote><p><a href="http://www.smashingmagazine.com/2014/09/08/improving-smashing-magazine-performance-case-study/" target="_blank">Smashing 杂志</a> 写了他们优化字体的方法，他们使用 <code>localStorage</code> 来缓存字体。这样在第一次加载时成为 FOUT（或者 FOIT 3s），后续加载时成为（快速的）FOIT。</p><p>但是 Google 在 Web Foundations 中也强调：</p><blockquote><p>您无需在 localStorage 中或通过其他机制存储字体，其中的每一种机制都有各自的性能缺陷。 浏览器的 HTTP 缓存与 Font Loading API 或 webfontloader 内容库相结合，实现了最佳并且最可靠的机制来向浏览器提供字体资源。</p></blockquote><p>关于 <code>localStorage</code> 的详情可以参看「<a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html">Web 性能优化（4）——localstorage 存储静态文件的意义</a>」，这里我仅仅摘录我对 localStorage 的观点：</p><blockquote><p>localStorage 作为一种持久性的存储容器，可以有效代替强缓存机制。浏览器缓存可能被清空，冷缓存可能会被热点文件挤出浏览器的缓存池，但是 localStorage 的存储毕竟是长久的，所以用来存储一些本身不需要经常更新的文件并不为过。<br />虽然有的人吐槽和质疑说手动实现一个操作 localStorage 的读写和更新机制不过是浪费时间，因为浏览器本身就已经有一整套 Cache Control 机制；但是你不得不承认，浏览器的 Cache 的操作就像一个黑盒，你不能控制它；如果你设置错了 cache control header，有可能会导致致命和后果。给 URI 添加 query 来控制缓存版本的方式不仅 dirty 而且是在浪费 CDN 和用户本地的存储空间。<br />虽然使用 Service Worker 操作 Cache Storage 解决了上述的问题，但是就目前来看，localStorage 的兼容性比 Service Worker 更好，而且缓存效果也更好。在已经有了相对成熟的 <code>lsloader</code> 和相关 API 来操作 localStorage 时，我倾向于在我的项目中使用 localStorage 作为缓存机制。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/webfont-123.html# 最高境界"></a>最高境界 </h1><p> 说了这么多，真正“一劳永逸”来处理 WebFont 优化的方案听起来就像开历史的倒车：不在任何主要渲染路径使用任何外部字体。<br />比如说以阅读类为主的网站，文本比设计效果的美观更重要，这类网站就是主要渲染路径以大段文本内容为主。故这类网站如果要避免 FOIT FOUT，可以优先使用设备内置的字体显示文本，可以在不同的设备上获得更加的显示效果。</p><p>这个时候轮到推荐阅读的时间：</p><ul><li><a href="https://segmentfault.com/a/1190000006110417" target="_blank">如何优雅的选择字体(font-family)</a>。这篇文章详细介绍了各个平台和系统的预装字体和渲染效果。</li><li><a href="http://devops-club.com/article/font-choice-for-chinese-website" target="_blank">中文网页最优字体选择</a></li><li><a href="https://www.smashingmagazine.com/2015/11/using-system-ui-fonts-practical-guide/" target="_blank">Using UI System Fonts In Web Design: A Quick Practical Guide</a></li></ul><p>接下来是我摘录了一些常用的 font-family 写法，确保在不引用外源字体的情况下获得最好的浏览体验。</p><h2><a href="https://blog.nfz.moe/archives/webfont-123.html# 小米"></a>小米</h2><pre><code>font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Microsoft Yahei&quot;, &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;</code></pre><h2><a href="https://blog.nfz.moe/archives/webfont-123.html# 简书"></a>简书</h2><pre><code>font-family: -apple-system, SF UI Text, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;</code></pre><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#Ant-Design"></a>Ant.Design</h2><pre><code>font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, sans-serif;</code></pre><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#SegmentFault"></a>SegmentFault</h2><pre><code>font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif</code></pre><h2><a href="https://blog.nfz.moe/archives/webfont-123.html#Spectre-css"></a>Spectre.css</h2><pre><code>font-family: -apple-system,system-ui,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,sans-serif</code></pre><h2><a href="https://blog.nfz.moe/archives/webfont-123.html# 其它写法"></a>其它写法</h2><pre><code>font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;</code></pre><pre><code>/* 来自 huaji8.top */font-family: -apple-system, system-ui, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;</code></pre><pre><code>/* 来自 imququ.com */font-family: &quot;-apple-system&quot;,&quot;Open Sans&quot;,&quot;HelveticaNeue-Light&quot;,&quot;Helvetica Neue Light&quot;,&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif</code></pre><h1><a href="https://blog.nfz.moe/archives/webfont-123.html# 小结和最佳实践"></a>小结和最佳实践 </h1><p> 结合 Google Web Foundations 的「<a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/webfont-optimization" target="_blank">Web Font Otimization</a>」总结一下使用 WebFont 的最佳实践。</p><ul><li><strong>审核并监控您的字体使用</strong>：不使用外源 WebFont 就是对 WebFont 最佳的优化。不要在网页上使用过多字体，并且对于每一种字体，最大限度减少使用的变体（粗体、斜体）数量，必要时向浏览器提供的“仿粗体”“仿斜体”妥协，这有助于为您的用户带来更加一致且快速的体验。</li><li><strong>向每个浏览器提供优化过的字体格式</strong>：每一种字体都应以 WOFF2、WOFF 提供（如果需要兼容较旧的浏览器，你还需要 EOT 和 TTF 格式，同时需要应用 gzip 压缩，因为默认情况下不会对它们进行压缩；而 WOFF2 字体已经内建压缩，即使不进行 gzip 也可以减少传输数据量）</li><li><strong>指定重新验证和最佳缓存策略</strong>：字体是不经常更新的静态资源，确保提供尽可能长的 Cache Control 响应头，以实现减少重新载入字体消耗的流量和载入字体延迟导致较差的显示效果。必要时可以使用 localStorage 和 Service Worker 改善缓存的效果。</li><li><strong>使用 Font Loading API 来优化关键渲染路径</strong>：默认延迟加载行为可能导致 FOIT FOUT。您可以通过 Font Loading API 为特定字体替换这一行为，以及为网页上的不同内容指定自定义渲染和超时策略。对于不支持该 API 的较旧浏览器，您可以使用网页字体加载程序 JavaScript 内容库。</li><li><strong>在必要时提高字体加载的优先级</strong>：对于关键渲染路径的外源字体，为了避免 FOIT 和 FOUT，需要提升字体加载的优先级。Resource Hint 和 inline data URI 都是很好的备选项。同时高效和强制的缓存也能改善字体的显示效果。</li></ul><hr /><p>顺便说一句，在接触和认识了一些涉及浏览器核心开发的 dalao 以后，我开始觉得前端的一些 Black Magic Trick 越来越有趣；我每隔一段时间都会重新阅读我曾经写过的 <a href="https://blog.nfz.moe/tags/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96/"> 关于前端优化的文章</a>；浏览器的行为是一种方式，然后我们欺骗它使用另一种方式，当它改变了这种方式时，我们欺骗它使用旧的方式。</p><hr /><blockquote><p><strong>本文作者：</strong><a href="https://nfz.moe" target="_blank">neoFelhz</a><br /><strong>本文链接：</strong><a href="https://blog.nfz.moe/archives/webfont-123.html">https://blog.nfz.moe/archives/webfont-123.html</a><br /><strong>本文采用 </strong> <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank">CC BY-NC-SA 3.0 Unported</a> <strong> 协议进行许可，阅读 </strong> <a href="http://blog.nfz.moe/creativecommons.html"> 相关说明</a>。</p></blockquote>]]></content>
        
        <summary type="html">
            
            众所周知，字体是实现良好的设计、品牌推广、可读性和无障碍功能的基础。如今，所有还在使用的浏览器都已经支持 WebFont。WebFont 除了体现了字体的作用，还是实现用户体验和性能的关键所在。在 WebFont 推出以前，设计师的字体设计最终都是使用图片实现的。WebFont
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="字体"/>
        
        <category term="WebFont"/>
        
        <category term="Resource Hint"/>
        
        <category term="Preload"/>
        
        <category term="localstorage"/>
        
        <category term="font-family"/>
        
        <category term="font-face"/>
        
        <category term="FOUT"/>
        
        <category term="FOIT"/>
        
        <category term="FOFT"/>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（4）——localstorage 存储静态文件的意义</title>
        <link href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html"/>
        <id>https://blog.nfz.moe/archives/wpo-localstorage-css-js.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-04-12T13:53:00+00:00</published>
        <updated>2018-04-12T13:53:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>localstorage 并不仅仅只是”狂拽酷炫吊炸天“的黑科技。在一些特殊场景下，甚至可能会有意想不到的收获。</p><a></a><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html# 缘由"></a>缘由 </h1><p> 之前阅读 JerryQu 的博客时，看到他在介绍他的博客的优化方案时提到说：</p><blockquote><p>我将常规外链转成了 inline 输出，同时存入 localStorage，之后不再输出。</p></blockquote><p>2015 年在知乎上时，localstorage 技术就已经被热烈地讨论过了（<a href="https://www.zhihu.com/question/28467444" target="_blank">静态资源（JS/CSS）存储在 localStorage 有什么缺点？为什么没有被广泛应用？</a>）。在知乎上，很多前端大牛都对 localstorage “颇有微词”。所以，我决定简单地研究这一方案，并表达一下我个人的看法。</p><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html#localstorage- 的优点"></a>localstorage 的优点 </h1><p> 在知乎对于该问题的回答中，最激烈的反对意见是这样的：</p><blockquote><p>浏览器都帮你缓存好了，干嘛多此一举缓存到 LS 里？</p></blockquote><p>很好，那就让我们从浏览器的缓存开始说起。</p><p>对于 css/js 传统的优化方法，最常见的便是将小的静态文件直接 inline 减少请求，大的文件、甚至全站都完整的接入 CDN，直接将文件就近推送以加快加载速度。</p><blockquote><p>相对于 inline，HTTP2 协议下的多路复用的特性和 Server Push 的支持（Server Push 即是将一些资源文件和 HTML 在同一请求内同时从服务端推送给浏览器），可以使 inline 变得不那么重要。</p></blockquote><p>CDN 除了可以就近分发，还可以设置缓存头提示浏览器缓存一些静态文件，这样当页面二次加载便不需要发起 HTTP 请求。但是，外链资源即使合理配置了强缓存头，<strong>浏览器依然会在用户主动刷新时发起协商请求（响应码通常是 304，虽无响应正文，但依然需要建立连接）</strong>；会在强刷时发起 <code>cache-control:no-cache</code> 和 <code>pragma:no-cache</code> 的 Request Header，忽略所有缓存，触发服务端的 200 响应。虽然用户不一定都会强制刷新，但在网络环境较差的环境下，使用 304 协商响应依然颇花费时间。</p><blockquote><p>微信内置的 X5 内核的 WebView 当中有其它的坑：WebView 退出 10 分钟后，js/css 缓存便会失效，触发 304；WebView 进程一旦退出和重新进入后，缓存便会作废，触发 200。</p></blockquote><p>所以，使用 localstorage 等效于无视用户主动刷新行为的本地强缓存，而且可以存储较大体积的数据（最小是 2M），而且永久有效。如果把 js 和 css 存储在 localstorage 中，可以省去发送 HTTP 请求从而改善用户的浏览体验。</p><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html#localstorage- 的缺点"></a>localstorage 的缺点 </h1><p> 前端大牛们当时主要关心的是 localstorage 方案的响应速度：网络环境优秀时，localstorage 的响应速度会超过 304 响应的速度么？</p><p>理论上，使用 localstorage 和使用 <code>from disk cache</code> 和 <code>from memory cache</code> 的速度应该是不相上下的（当然，这需要进一步的验证和测试）。在较差的网络环境下，读取 localstorage 至少要快于 304。而且移动端由于存储大小问题，手机浏览器的缓存经常会被清理，但 localstorage 被清理的几率会低一些。</p><p>当然，使用 localstorage 最大的问题，在于 XSS 的安全问题。一旦用户的 localstorage 被篡改，那么危险将会是持久的，即使漏洞已经被修复。这是由 localstorage 的生命周期决定的。</p><blockquote><p>关于保护 localstorage 内代码的安全，可以阅读 JerryQu 的<a href="https://imququ.com/post/enhance-security-for-ls-code.html" target="_blank">《使用 SRI 增强 localStorage 代码安全》</a></p></blockquote><p>除此以外，大面积使用 localstorage 还需要考虑其他的问题，比如版本控制。只要一个项目还在迭代开发，就难以避免需要更新资源文件。普通的资源请求，可以根据 md5 或者在资源链接后面加上后缀 query 做标识来判断是否需要更新资源。如果用 localStorage 做，则需要一套新的缓存更新机制。</p><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html# 我的观点"></a>我的观点 </h1><p>localStorage 作为一种持久性的存储容器，可以有效代替强缓存机制。浏览器缓存可能被清空，冷缓存可能会被热点文件挤出浏览器的缓存池，但是 localStorage 的存储毕竟是长久的，所以用来存储一些本身不需要经常更新的文件并不为过。<br /> 虽然有的人吐槽和质疑说手动实现一个操作 localStorage 的读写和更新机制不过是浪费时间，因为浏览器本身就已经有一整套 Cache Control 机制；但是你不得不承认，浏览器的 Cache 的操作就像一个黑盒，你不能控制它；如果你设置错了 cache control header，有可能会导致致命和后果。给 URI 添加 query 来控制缓存版本的方式不仅 dirty 而且是在浪费 CDN 和用户本地的存储空间。<br />虽然使用 Service Worker 操作 Cache Storage 解决了上述的问题，但是就目前来看，localStorage 的兼容性比 Service Worker 更好，而且缓存效果也更好。在已经有了相对成熟的 <code>lsloader</code> 和相关 API 来操作 localStorage 时，我倾向于在我的项目中使用 localStorage 作为缓存机制。</p><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html# 小结"></a>小结</h1><p>CDN 方案是加速静态文件访问的一种优秀方式，但是必须要面临缓存刷新和 CDN 的压力、回源的压力的问题。<br />localstorage 是优秀的强缓存方案，因为 localstorage 被清空的概率不大。但是要专门注意安全问题。SRI 和 CSP 都是不错的保护 localstorage 里的代码的方案。</p><p>所以，localstorage 的方案适合以下情况：</p><ul><li>同域下的每个页面都会用到的、频繁请求的文件</li><li>文件本身不需要经常更新，如 jQuery、一些字体</li><li>为移动端或较差网络环境下的特殊加载优化</li><li>降低源站和 CDN 的压力</li><li>用 base64 存储一些小的图片减少请求并缓存</li></ul><h1><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html#hexo-theme-material- 的应用方案"></a>hexo-theme-material 的应用方案 </h1><p> 在 hexo-theme-material 的开发过程中，我们参考了 <a href="https://github.com/sexdevil/LSLoader" target="_blank">LsLoader</a> 方案，设计了一套 localstorage 的使用方案，将项目的 css 和 js，以及 footer-sns-icon 的 svg 转换成 base64 储存在 localstorage 中，利用 localstorage 强缓存的特性加快页面加载速度，以及减少页面的 HTTP Request，达到页面优化的目的。<br />为了避免 css 加载先后出现页面抖动等问题，我们让页面默认 <code>display: none</code> 来阻止页面渲染，在 css 中写入 <code>display: block</code>，这样在 css 加载出来前，页面不会进行渲染，也不会抖动，改善了显示体验。不过在网络环境较差环境下 css 无法及时加载，就会导致页面持续白屏。</p>]]></content>
        
        <summary type="html">
            
            localstorage 并不仅仅只是”狂拽酷炫吊炸天“的黑科技。在一些特殊场景下，甚至可能会有意想不到的收获。缘由  之前阅读 JerryQu 的博客时，看到他在介绍他的博客的优化方案时提到说：我将常规外链转成了 inline 输出，同时存入 localStorage，之后不
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="localstorage"/>
        
    </entry>
    
    <entry>
        <title>LEDE 内网转发 IPv6</title>
        <link href="https://i-meto.com/lede-ipv6/"/>
        <id>https://i-meto.com/lede-ipv6/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2018-04-12T13:50:00+00:00</published>
        <updated>2018-04-12T13:50:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><img src="https://image.static.i-meto.com/uploads/2018/01/ipv6.jpeg" /><p>最近折腾 PT 发现了其他的转发方案，重新更新了文章</p>
<ul>
<li>2018.04.12 更新 Passthrough 方式</li>
<li>2017.10.19 更新 NAT6 方式</li>
</ul>
<p>想要让路由器下的设备获得 IPv6 地址通常有三种方式：relay（中继）、NAT（地址转换）、Passthrough（穿透）。下面分三个部分谈谈具体的配置方案。</p>
<h2>relay</h2>
<p>OpenWrt 早在 15.05 就内置了 relay 协议，具体是通过 odhcpd 来实现的。</p>
<p>这种方案可以让子网设备分到公网 IPv6 的地址，是最为科学的，然而 odhcpd 的实现有很多 bug，在实际使用中会经常掉线，需要手动重启服务才能解决，体验不佳。</p>
<p>具体操作如下</p>
<ol>
<li>
<p>进入路由器终端：<code>$ ssh root@192.168.1.1</code></p>
</li>
<li>
<p>编辑 dhcp 配置文件：<code>$ vi /etc/config/dhcp</code>，改动如下</p>
<pre><code>config dhcp 'lan'
    option interface 'lan'
    option start '100'
    option limit '150'
    option leasetime '12h'
    option ra 'relay'
    option ndp 'relay'
    option dhcpv6 'relay'
    option ra_management '1'

config dhcp 'wan'
    option interface 'wan'
    option ignore '1'

config dhcp 'wan6'
    option interface 'wan'
    option ra 'relay'
    option ndp 'relay'
    option dhcpv6 'relay'
    option master '1'
</code></pre>
</li>
<li>
<p>编辑 network 文件：<code>$ vi /etc/config/network</code>，将地址第一个字母 <code>f</code> 修改为 <code>d</code></p>
<pre><code>config globals 'globals'
    option ula_prefix 'dd53:abcd:abcd::/48'
</code></pre>
</li>
<li>
<p>重启即可</p>
</li>
</ol>
<p>参考资料</p>
<ul>
<li><a href="https://lede-project.org/docs/user-guide/basic-ipv6-configuration">https://lede-project.org/docs/user-guide/basic-ipv6-configuration</a></li>
</ul>
<h2>Passthrough</h2>
<p>Passthrough 的原理是将内外网进行桥接，然后对 IPv4 流量采用 NAT 方式进行转发，稳定性相当好，唯一的缺点就是路由器自身会失去 IPv6 的访问，因此如果想在路由器上做离线下载等功能就会非常麻烦。</p>
<p>配置如下</p>
<ol>
<li>
<p>安装 <code>ebtables</code> 和 <code>kmod-ebtables-ipv6</code> 模块</p>
<pre><code>$ opkg update
$ opkg install ebtables kmod-ebtables-ipv6
</code></pre>
</li>
<li>
<p>设置 IPv4 转发</p>
<pre><code>$ interface=`ip -6 route | grep &quot;default from&quot; | awk '{print $7}'`
$ ebtables -t broute -A BROUTING -p ! ipv6 -j DROP -i $interface
</code></pre>
</li>
<li>
<p>内外网桥接</p>
<pre><code>$ brctl addif br-lan $interface
</code></pre>
</li>
<li>
<p>杀死 odhcpd</p>
<pre><code>$ /etc/init.d/odhcpd stop
$ /etc/init.d/odhcpd disable
</code></pre>
</li>
</ol>
<p>做完这些步骤，稍等一会儿子网设备就会分到相应的公网 IPv6 地址了</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/04/IPv6-Passthrough.png" /></p>
<h2>NAT</h2>
<p>IPv6 的设计之初是没有 NAT（网络地址转换）这种东西的, 但 Linux 内核从 3.7 版本开始实现了 IPv6 的 NAT。因此这种方案实际上是「歪门邪道」，更要命的是路由器下的设备将会无法获得公网端口，BT/PT 的上传速度受到了很大影响。</p>
<p><strong>Padavan 的 Linux 内核原生不支持 NAT6，不到万不得已，尽量选用其它两种方案</strong></p>
<p>具体操作如下</p>
<ol>
<li>
<p>进入软件（soft）配置界面安装 <code>ip6tables</code> 和 <code>kmod-ipt-nat6</code> 模块</p>
</li>
<li>
<p>打开网络（Network）菜单下的接口（Interfaces），把最下面的 <code>IPv6 ULA-Prefix</code> 改为 <code>2fff::/64</code></p>
</li>
<li>
<p>点击 LAN 接口的 edit 按钮进入设置，在 <code>IPv6 Settings</code> 选项卡中勾上 <code>Always announce default router</code>.</p>
</li>
<li>
<p>进入启动项管理 ，把以下命令添加入启动配置（在 exit 0 前），实现开机启动，最后重启即可。</p>
</li>
</ol>
<pre><code>res=`ip -6 route | grep &quot;default from&quot;`
gateway=`echo $res | awk '{print $5}'`
interface=`echo $res | awk '{print $7}'`

if [ &quot;$ACTION&quot; = ifup ]; then
    ip -6 r add default via $gateway dev $interface
    if !(ip6tables-save -t nat | grep -q &quot;v6NAT&quot;); then
        ip6tables -t nat -A POSTROUTING -o $interface -m comment --comment &quot;v6NAT&quot; -j MASQUERADE
    fi
else
    ip6tables -t nat -D POSTROUTING -o $interface -m comment --comment &quot;v6NAT&quot; -j MASQUERADE
    ip -6 r del default via $gateway dev $interface
fi
</code></pre>
<p>参考资料</p>
<ul>
<li><a href="https://openwrt.org/docs/guide-user/network/ipv6/start">https://openwrt.org/docs/guide-user/network/ipv6/start</a></li>
<li><a href="https://lixingcong.github.io/2017/04/24/ipv6-nat-lede/">https://lixingcong.github.io/2017/04/24/ipv6-nat-lede/</a></li>
<li><a href="https://github.com/tuna/ipv6.tsinghua.edu.cn/issues/7">https://github.com/tuna/ipv6.tsinghua.edu.cn/issues/7</a></li>
</ul>
<hr />
<h2>端口映射</h2>
<p>以上方案除了 NAT 方案外，可以开启 UPnP 进行高位端口映射，优化 BT/PT 体验。</p>
<p>方案如下</p>
<ol>
<li>安装 <code>miniupnpd</code> 和 <code>luci-app-upnp</code> 两个软件包</li>
<li>在 <code>services</code> 下的 <code>upnp</code> 面板中开启即可</li>
</ol>
<p><img src="https://image.static.i-meto.com/uploads/2018/04/uTorrent.png" /></p>
<hr />
<p>方案测试通过机型，不保证其它版本可用</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>NETGEAR WNDR4300</td>
<td>LEDE 17.01.4</td>
</tr>
<tr>
<td>Hiwifi HC5661A</td>
<td>LEDE snapshots</td>
</tr>
<tr>
<td>psg1218(K2)</td>
<td>LEDE 17.01.3</td>
</tr>
<tr>
<td>Newifi mini Y1</td>
<td>LEDE 17.01.3</td>
</tr>
</tbody>
</table>
</div>]]></content>
        
        <summary type="html">
            
            最近折腾 PT 发现了其他的转发方案，重新更新了文章  2018.04.12 更新 Passthrough 方式 2017.10.19 更新 NAT6 方式  想要让路由器下的设备获得 IPv6 地址通常有三种方式：relay（中继）、NAT（地址转换）、Passthrough
            
        </summary>
        
        <category term="OpenWrt"/>
        
    </entry>
    
    <entry>
        <title>SSL证书颁发机构将对域名强制CAA检查，到底什么是CAA？CAA记录详解</title>
        <link href="https://ephen.me/2017/dnsrr-caa/"/>
        <id>https://ephen.me/2017/dnsrr-caa/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:30:18+00:00</published>
        <updated>2018-04-12T08:30:18+00:00</updated>
        
        <content type="html"><![CDATA[<h2><a href="https://ephen.me/2017/dnsrr-caa/#强制CAA检查的提议"></a>强制CAA检查的提议</h2><p>2017年3月7日，CA|B Forum （一个全球证书颁发机构与浏览器的技术论坛）发起了一项关于对域名强制检查CAA的一项提议的投票，获得187票支持，投票有效，提议通过。</p><p>提议通过后，将于<strong>2017年9月8日</strong>根据Mozilla的Gervase Markham提出的检查CAA记录作为基准要求来实施。</p><p>详情参见：<a href="https://cabforum.org/2017/03/08/ballot-187-make-caa-checking-mandatory/" target="_blank">Ballot 187 – Make CAA Checking Mandatory</a></p><h2><a href="https://ephen.me/2017/dnsrr-caa/#什么是CAA记录？"></a>什么是CAA记录？</h2><p>CAA，全称Certificate Authority Authorization，即证书颁发机构授权。它为了改善PKI（Public Key Infrastructure：公钥基础设施）生态系统强度、减少证书意外错误发布的风险，通过DNS机制创建CAA资源记录，从而限定了特定域名颁发的证书和CA（证书颁发机构）之间的联系。从此，再也不能是任意CA都可以为任意域名颁发证书了。</p><a></a><p>关于CAA记录，其实早在4年前便在<a href="https://datatracker.ietf.org/doc/rfc6844/" target="_blank">RFC 6844</a>中有定义，但由于种种原因配置该DNS资源记录的网站寥寥无几。如今，SSL证书在颁发之前对域名强制CAA检查，就对想要https访问的网站域名提出了解析配置的要求。</p><h2><a href="https://ephen.me/2017/dnsrr-caa/#CAA资源记录详解"></a>CAA资源记录详解</h2><p>CAA记录可以控制单域名SSL证书的发行，也可以控制通配符证书。当域名存在CAA记录时，则只允许在记录中列出的CA颁发针对该域名（或子域名）的证书。</p><p>在域名解析配置中，咱们可以为整个域（如example.com）或者特定的子域（如subzone.example.com）设置CAA策略。当为整域设置CAA资源记录时，该CAA策略将同时应用于该域名下的任一子域，除非被已设置的子域策略覆盖。</p><h3><a href="https://ephen.me/2017/dnsrr-caa/#CAA记录格式"></a>CAA记录格式</h3><p>根据规范（<a href="https://www.rfc-editor.org/rfc/rfc6844.txt" target="_blank">RFC 6844</a>），CAA记录格式由以下元素组成：</p><table><tr><td><pre><span>1</span><br /></pre></td><td><pre><span>CAA &lt;flags&gt; &lt;tag&gt; &lt;value&gt;</span><br /></pre></td></tr></table><p>释义：</p><table><thead><tr><th>元素</th><th>说明</th></tr></thead><tbody><tr><td>CAA</td><td>DNS资源记录类型</td></tr><tr><td><code>&lt;flags&gt;</code></td><td>认证机构限制标志</td></tr><tr><td><code>&lt;tag&gt;</code></td><td>证书属性标签</td></tr><tr><td><code>&lt;value&gt;</code></td><td>证书颁发机构、策略违规报告邮件地址等</td></tr></tbody></table><p><code>&lt;flags&gt;</code>定义为0~255无符号整型，取值：</p><blockquote><p>Issuer Critical Flag：0<br />1~7为保留标记</p></blockquote><p><code>&lt;tag&gt;</code>定义为US-ASCII和0~9，取值：</p><blockquote><p>CA授权任何类型的域名证书（Authorization Entry by Domain） : issue<br />CA授权通配符域名证书（Authorization Entry by Wildcard Domain） : issuewild<br />指定CA可报告策略违规（Report incident by IODEF report） : iodef<br />auth、path和policy为保留标签</p></blockquote><p><code>&lt;value&gt;</code>定义为八位字节序列的二进制编码字符串，一般填写格式为：</p><blockquote><p>[domain] [“;” * 参数]</p></blockquote><h3><a href="https://ephen.me/2017/dnsrr-caa/#CAA资源记录示例"></a>CAA资源记录示例</h3><p>当需要限制域名<code>example.com</code>及其子域名可由机构<code>letsencrypt</code>颁发不限类型的证书，同时可由<code>Comodo</code>颁发通配符证书，其他一律禁止，并且当违反配置规则时，发送通知邮件到<a href="mailto:`example@example.com" target="_blank">`example@example.com</a>`。</p><p>配置如下（为便于理解，二进制Value值已经过转码，下同）：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /></pre></td><td><pre><span>example.com.  CAA 0 issue &quot;letsencrypt.org&quot;</span><br /><span>example.com.  CAA 0 issuewild &quot;comodoca.com&quot;</span><br /><span>example.com.  CAA 0 iodef &quot;mailto:example@example.com&quot;</span><br /></pre></td></tr></table><p>如果子域名有单独列出证书颁发要求，例如：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /></pre></td><td><pre><span>example.com.  CAA 0 issue &quot;letsencrypt.org&quot;</span><br /><span>alpha.example.com.  CAA 0 issue &quot;comodoca.com&quot;</span><br /></pre></td></tr></table><p>那么，因子域策略优先，所以只有Comodo可以为域名<code>alpha.example.com.</code>颁发证书。</p><h3><a href="https://ephen.me/2017/dnsrr-caa/#CAA记录查询"></a>CAA记录查询</h3><p>CAA记录是一个相对较新的资源记录，目前很多工具并不支持。以<code>dig</code>为例，不能适用其标准语法。若需要查询CAA记录，<code>dig</code>时需要直接指定RR类型（type257）。</p><p>例如：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /></pre></td><td><pre><span>$ dig google.com type257</span><br /><span></span><br /><span>; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; google.com type257</span><br /><span>;; global options: +cmd</span><br /><span>;; Got answer:</span><br /><span>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 64266</span><br /><span>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br /><span></span><br /><span>;; QUESTION SECTION:</span><br /><span>;google.com.            IN  TYPE257</span><br /><span></span><br /><span>;; ANSWER SECTION:</span><br /><span>google.com.     86399   IN  TYPE257 \# 19 0005697373756573796D616E7465632E636F6D</span><br /><span></span><br /><span>;; Query time: 51 msec</span><br /><span>;; SERVER: 8.8.8.8#53(8.8.8.8)</span><br /><span>;; WHEN: Thu Dec 29 21:07:18 2016</span><br /><span>;; MSG SIZE  rcvd: 59</span><br /></pre></td></tr></table><p>该查询的输出是二进制编码记录，需要转码才能知道具体CAA策略。</p><h2><a href="https://ephen.me/2017/dnsrr-caa/#互联网证书环境前景剖析"></a>互联网证书环境前景剖析</h2><blockquote><p>以下所有言论仅代表个人观点。</p></blockquote><p>CAA记录规范的提出已4年之久，但从未被普及；如今 CA|B Forum 关于强制CAA检查的提议亦结束3月有余，支持检查CAA的证书颁发机构依旧寥寥无几，支持配置CAA记录的DNS厂商更是少之又少。因而个人认为，这项规范的实施进程预计还是会挺艰难的。</p><p>不过从互联网安全发展来看，互联网受众越来越大，概念、架构越来越复杂，社会的重视程度一直在稳步提高。全面https也推行有一段时间了，强制CAA的普及大概只是时间问题。</p>]]></content>
        
        <summary type="html">
            
            强制CAA检查的提议2017年3月7日，CA|B Forum （一个全球证书颁发机构与浏览器的技术论坛）发起了一项关于对域名强制检查CAA的一项提议的投票，获得187票支持，投票有效，提议通过。提议通过后，将于2017年9月8日根据Mozilla的Gervase Markham
            
        </summary>
        
        <category term="工作笔记"/>
        
        <category term="知识探索"/>
        
        <category term="DNS"/>
        
        <category term="https"/>
        
        <category term="SSL"/>
        
        <category term="CAA"/>
        
    </entry>
    
    <entry>
        <title>谈谈上月Dyn遭受的DDoS攻击</title>
        <link href="https://ephen.me/2016/dyn-crashed/"/>
        <id>https://ephen.me/2016/dyn-crashed/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:30:07+00:00</published>
        <updated>2018-04-12T08:30:07+00:00</updated>
        
        <content type="html"><![CDATA[<p>这件事情发森在美国时间的2016年10月21日，到今天大约已经过去了半个多月。</p><p>那几天，新闻铺天盖地，季风从墙外刮过长城，吹到中原，拂过我的耳朵。</p><p>当时看到这个消息时本想立即写一篇蹭它一波热度，一来是时间问题，二来想想我就一小博客也没必要跟风，也就作罢。</p><p>今天我整个回顾了下所有看过的新闻及各类文章分析，还是决定来谈一谈。</p><a></a><h2><a href="https://ephen.me/2016/dyn-crashed/#事件概述"></a>事件概述</h2><p>想必很多人已经了解过了，不过为了看到这里的小伙伴不用再去翻看回忆，我简单描述一下。</p><p>最早刮来的是标题为《北美大半个网络瘫痪 原因竟和中国厂商有关》的新闻，事件当天大量北美用户发现Twitter、Netflix、Paypal、GitHub等常用网站无法访问，随后经过一系列的调查，发现是Dyn这家权威域名解析遭受DDoS攻击致NS节点挂掉。</p><p>本来这事Dyn公告一个事件处理情况就算告一段落了，谁知却被人揪出黑客是通过智能摄像头、DVR等物联网设备做肉鸡发起攻击的。</p><p>参考：<a href="https://zh.wikipedia.org/wiki/2016年Dyn网络攻击" target="_blank"> 维基百科 - 2016年Dyn网络攻击 </a></p><h2><a href="https://ephen.me/2016/dyn-crashed/#DDoS攻击手段"></a>DDoS攻击手段</h2><p>DDos攻击，全称“Distributed Denial of Service Attack”，即分布式拒绝服务攻击。</p><p>拒绝服务攻击（亦称洪水攻击）作为一种常见的网络攻击手法，其目的在于使目标电脑的网络或系统资源耗尽，使服务暂时中断或停止，导致其正常用户无法访问。当黑客使用网络上两个或以上被攻陷的电脑作为“僵尸”向特定的目标发动“拒绝服务”式攻击时，便称为分布式拒绝服务攻击了。</p><p>去年我刚接触<a href="https://www.newdefend.com/" target="_blank">牛盾</a>产品时，曾经有了解到有些黑客专门花钱买流量和肉鸡去D其竞争对手，黑市上的流量叫卖价格极低。</p><p>如今科技日渐发达，黑客们也与时俱进，用上了物联网设备，这下连攻击流量都不需要了。只需要其生产时植入后门或是生产程序漏洞就能达到目的。</p><h2><a href="https://ephen.me/2016/dyn-crashed/#一些思考"></a>一些思考</h2><h3><a href="https://ephen.me/2016/dyn-crashed/#安全问题不容小觑"></a>安全问题不容小觑</h3><p>据称，事件中的物联网设备由一个叫雄迈科技的公司生产，是由于默认密码被破解而被人利用植入了被公开源码的Mirai程序，于是这个公司莫名其妙被第三者了。</p><p>人间处处有深坑，只缺一个不留神。</p><p>网络安全问题是老生常谈了，我就问一句，你有没有哪个地方的密码是<code>123456</code>？</p><h3><a href="https://ephen.me/2016/dyn-crashed/#要销量还是要质量？"></a>要销量还是要质量？</h3><p>物联网设备被利用，总的来说，还是隐射一个质量问题。这事让我不禁联想到年初盗版Xcode事件，就算是优秀的开发者用的是这样的软件来工作也会莫名被第三者……</p><p>现在科技发展尤为迅速，一不小心就跟不上时代的步伐。这个社会已经变得浮躁了起来，企业为追求性价比，招来能力修为不够的员工、用上了被植入后门的软硬件，即便产品成型后跟上了市场，那么质量呢？</p><p>反过来，扪心自问，作为消费者，是不是也没有那么在乎质量？</p><h3><a href="https://ephen.me/2016/dyn-crashed/#权威DNS的扛D攻击能力"></a>权威DNS的扛D攻击能力</h3><p>DNS 是网络中非常脆弱的一环， CloudXNS 也是攻击不断。犹记得去年 CloudXNS 刚刚被站长们熟悉不久，便引来超大规模的竞争对手恶意攻击，致使我们不得不删除了硬件能力较差的几个海外节点的 Glue Record 配置。此后便是不断的优化运维架构、提升硬件加固防火墙之路。</p><p>不论是 Dyn 也好，CloudXNS 也好，我们作为专业提供解析服务的产品都有些吃力，那些小注册商甚至个人商家提供的自带DNS解析的扛D能力又如何保证呢？</p><h2><a href="https://ephen.me/2016/dyn-crashed/#DDoS攻击应对"></a>DDoS攻击应对</h2><p>这个不废话，DDoS攻击防范请从以下几点做起：</p><ol><li>选择靠谱的域名注册商和域名解析商</li><li>接入主机的选择也需要慎重，并且配置好ACL</li><li>必要时选择一个适合自己的安全CDN产品</li><li>对域名、主机、CDN进行全方位专业的IT维护</li></ol><h2><a href="https://ephen.me/2016/dyn-crashed/#希望未来有更祥和的网络环境，DDoS坏蛋们见鬼去吧！"></a>希望未来有更祥和的网络环境，DDoS坏蛋们见鬼去吧！</h2>]]></content>
        
        <summary type="html">
            
            这件事情发森在美国时间的2016年10月21日，到今天大约已经过去了半个多月。那几天，新闻铺天盖地，季风从墙外刮过长城，吹到中原，拂过我的耳朵。当时看到这个消息时本想立即写一篇蹭它一波热度，一来是时间问题，二来想想我就一小博客也没必要跟风，也就作罢。今天我整个回顾了下所有看过的
            
        </summary>
        
        <category term="当时就被震惊"/>
        
        <category term="知识探索"/>
        
        <category term="心情驿站"/>
        
        <category term="DYN"/>
        
        <category term="DDoS"/>
        
        <category term="域名攻击"/>
        
    </entry>
    
    <entry>
        <title>记生平第一次手术经历</title>
        <link href="https://ephen.me/2018/First-Surgery/"/>
        <id>https://ephen.me/2018/First-Surgery/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:29:58+00:00</published>
        <updated>2018-04-12T08:29:58+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><a></a><hr /><p>2018 年春节来得比以往晚了很多。这一年的春天第一次尝试自己在家做腊鱼腊肉和腊肠，做得很成功，吃得也很开心。</p><p>于是埋下了一颗意外的种子。</p><hr /><p>正月初四的晚上，正开心的用餐呢，突然被鱼刺卡到喉咙。可能因为刺比较短小，感觉时疼时不疼的，我咳嗽和呕吐都弄不出，想着可能只是划伤了而已，无碍。</p><p>随后的几天也一直都是时疼时不疼的状态，自我感觉有好转的迹象，竟安慰自己大概是身体免疫力下降了才拖了那么久吧。</p><p>春节假期休毕照常回公司上班，不知道是从第几天开始竟然觉得喉咙刺疼得厉害难忍，遂下定决心周末去医院看看。（侧面反应我真的是一个严重拖延症患者，死到临头了还想再拖几天）</p><hr /><p>周末上医院，医生拿灯照着并压住我的舌头简单看了下，并没有看到鱼刺。心里一阵窃喜，想来估计是没有吧，以后可要好好锻炼提高自身免疫力。</p><p>谁曾想，医生出其不意的给我开了个单子，让我去缴费，说需要做喉镜看看。</p><p>口腔和鼻子被喷了麻醉后躺手术台，医生拿着一根长长的管子过来，我赶紧张大了嘴巴，竟然将管子从我鼻孔中伸进去了。。（枉我这么配合的做好准备……</p><p>果然发现了鱼刺，同时医生赶紧叫来家属，说我急需住院手术。</p><p>会厌舌面长了多个菜花样的囊肿，需要切除，拖久了会影响呼吸。</p><p>于是当天就匆匆忙忙办理住院，签各种知情同意书预约了次日手术，接着就是做各种术前检查，买生活用品啥的忙一整天。</p><hr /><p>其实只是个小手术而已，但还是搞得我特别紧张。</p><p>由于周五下班大雨电动车没有骑回家，周日一早就赶紧让老公去公司把车骑回来。</p><p>结果独自一人在医院打着术前点滴，看着身边的人都有人陪护帮病人忙出忙进，心里竟感觉一阵酸楚，又赶紧打电话让老公回来。</p><p>其实医院的环境还是真的很能影响情绪的，到我要进手术室的时候护士问陪同家属在哪，我打他电话一直都没有人接，忍不住哭了起来。</p><p>直到等他匆匆忙忙赶到手术室门口，我说了婚后的第一次“离婚”。（听说每个人婚后都会有几百次想离婚的念头，我这个算吗？</p><hr /><p>进手术室，心电监护、打针、吸麻醉剂，一下子就毫无意识了，直到手术完毕被医生拍醒。</p><p>我依稀记得入睡前，打完麻醉没一会儿就听见监护仪的报警声，显示“呼吸暂停”，硕大的红字。我很害怕，拼命的想呼吸却影响不了仪器上的显示。</p><p>而后又听到了另一种急促的报警声，但是再也没有力气偏头看仪器了，甚至觉得自己就这么死掉了。</p><p>医生拍醒我的时候，让我千万不要闭眼睛睡觉，但是那眼皮似乎有千斤重。直到自己慢慢清醒，这才有种劫后余生的感觉，如释重负。</p><hr /><p>挺搞笑的是，术前因为家属一直没到，胡思乱想到哭着睡着。</p><p>医生说做手术的时候没哭了，但是一醒来，那眼泪又吧嗒吧嗒的自己往下掉。</p><p>其实刚醒来的时候，我自己还是没有什么意识的，感觉不太可能是我自己突然要哭，我估计大概是接着术前的眼泪流下来的吧。</p><p>有点意思。</p><hr /><p>果然是个小手术，术后休息了一天打了一天针就基本生龙活虎了，周二敬业的我戴着留置针去公司上班。</p><p>然后按时吃药打针，直到一周后复查出院。</p><p>挺不错的，除了喉咙里面感觉像有个小椰果堵着，再没什么其他不适。</p><hr /><p>这场手术，最大的收获就是体验了全麻，让我想到了很多。</p><p>麻醉真的会有意外的，感觉自己真的还没活够，特别特别害怕意外。</p><p>原本从去年年底到过年的时候，感觉心理毫无由来的特别抑郁，手术过后莫名没了，虽然不排除气候原因；</p><p>原本自己扣扣索索的不愿意出去旅游花钱，打算把婚假留着盯装修的，当晚就在途牛上下了订单；</p><p>原本觉得自己就安安心心待公司打酱油，却下决心了一定要找工作机会；</p><p>我开玩笑的对自己说：如果不拼搏，我拿什么证明自己存在过？</p><hr /><p>一切尘埃落定，最重要的，保持身体健康，再来实现自己的存在。</p><p>春天到了，该锻炼了哦~</p><hr /><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
        
        <summary type="html">
            
            各位看官请注意：此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。2018 年春节来得比以往晚了很多。这一年的春天第一次尝试自己在家做腊鱼腊肉和腊肠，做得很成功，吃得也很开心。于是埋下了一颗意外的种子。正月初四的晚上，正开心的用餐呢，突然被鱼刺卡
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="生活"/>
        
    </entry>
    
    <entry>
        <title>给网站添加备案号展示</title>
        <link href="https://ephen.me/2017/beian/"/>
        <id>https://ephen.me/2017/beian/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:29:31+00:00</published>
        <updated>2018-04-12T08:29:31+00:00</updated>
        
        <content type="html"><![CDATA[<h2><a href="https://ephen.me/2017/beian/#折腾原因"></a>折腾原因</h2><p>由于在公司折腾<a href="https://www.cloudxns.net" target="_blank">CloudXNS</a>和<a href="https://www.newdefend.com" target="_blank">牛盾</a>，有个备案比较好开展工作。正好上次公司CDN网监来查，要求我把备案展示出来。想想这事情也该办了，搞起……</p><p>唔，还是提一嘴，姐无任何前端知识储备，大牛路过请点右上红叉关闭。</p><h2><a href="https://ephen.me/2017/beian/#目标"></a>目标</h2><ol><li>备案号放至左侧边栏下方，链接到工信部网站；</li><li>备案号可进入主题<code>_config.yml</code>中配置修改；</li><li>文章页显示目录时不做展示；</li><li>放弃适配移动端。</li></ol><a></a><h2><a href="https://ephen.me/2017/beian/#折腾过程"></a>折腾过程</h2><h3><a href="https://ephen.me/2017/beian/#添加备案号并写入配置文件"></a>添加备案号并写入配置文件</h3><p>这部分比我想象中简单多了。照配置文件的<code>AboutMe</code>抄一抄居然就完成了。</p><p><code>left-col.ejs</code>文件中添加以下代码：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /></pre></td><td><pre><span>&lt;% <span>if</span> (theme.beian){ %&gt;</span><br /><span>    &lt;a <span><span>class</span></span>=<span>&quot;beian&quot;</span> href=<span>&quot;http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action&quot;</span> target=<span>&quot;_blank&quot;</span>&gt;&lt;%=theme.beian%&gt;&lt;/a&gt;</span><br /><span>&lt;%}%&gt;</span><br /></pre></td></tr></table><p><code>_config.yml</code>中添加：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /></pre></td><td><pre><span><span>## 是否展示备案号</span></span><br /><span><span>### beian: false# 不开启</span></span><br /><span><span>beian:</span> <span>鄂ICP备15003996号</span></span><br /></pre></td></tr></table><p>功能测试通过！</p><h3><a href="https://ephen.me/2017/beian/#备案号模块样式"></a>备案号模块样式</h3><p>样式主体是照抄的博客说明模块，以下是样式代码，续写到<code>main.styl</code>文件中的<code>#header</code>部分：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /><span>19</span><br /><span>20</span><br /></pre></td><td><pre><span><span>.beian</span>{</span><br /><span><span>position</span>: relative;</span><br /><span><span>bottom</span>: <span>15px</span>;</span><br /><span><span>font-weight</span>: <span>300</span>;</span><br /><span><span>cursor</span>: pointer;</span><br /><span><span>text-transform</span>: uppercase;</span><br /><span><span>float</span>:none;</span><br /><span><span>text-align</span>: center;</span><br /><span><span>display</span>: -webkit-box;</span><br /><span><span>-webkit-box-orient</span>: horizontal;</span><br /><span><span>-webkit-box-pack</span>: center;</span><br /><span><span>-webkit-box-align</span>: center;</span><br /><span>li{</span><br /><span><span>cursor</span>: <span>default</span>;</span><br /><span><span>a</span>{</span><br /><span><span>font-size</span>: <span>14px</span>;</span><br /><span><span>min-width</span>: <span>300px</span>;</span><br /><span>}</span><br /><span>}</span><br /><span>}</span><br /></pre></td></tr></table><p><code>bottom</code>表示在页面底端保留的高度，配合<code>position: relative;</code>以保持在页面底端。</p><h3><a href="https://ephen.me/2017/beian/#显示目录时隐藏备案号"></a>显示目录时隐藏备案号</h3><p>本来不想做这个的，后来发现目录在时摆不好这个位置，同时如果目录过长过多会影响页面的美观，因此还是隐藏比较好。</p><p>目录是否显示的原本样式是在<code>toc.ejs</code>里面添加的<code>&lt;style&gt;&lt;/style&gt;</code>标签，在标签中添加：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /></pre></td><td><pre><span><span>#header</span> <span>.beian</span> {</span><br /><span><span>display</span>: none;</span><br /><span>}</span><br /></pre></td></tr></table><p>就可以了。</p><h3><a href="https://ephen.me/2017/beian/#点击“显示目录”和“隐藏目录”时切换动画"></a>点击“显示目录”和“隐藏目录”时切换动画</h3><p>侧边栏目录初始状态动画展现在<code>pc.js</code>文件中，把<code>.beian</code>元素加进去：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /></pre></td><td><pre><span><span>var</span> miniArchives = <span><span>function</span>(<span></span>)</span>{</span><br /><span>        $(<span>&quot;.post-list&quot;</span>).addClass(<span>&quot;toc-article&quot;</span>);</span><br /><span>        $(<span>&quot;#post-nav-button &gt; a:nth-child(2)&quot;</span>).click(<span><span>function</span>(<span></span>) </span>{</span><br /><span>            $(<span>&quot;#post-nav-button .fa-bars,#post-nav-button .fa-times&quot;</span>).toggle();</span><br /><span>            $(<span>&quot;.post-list&quot;</span>).toggle(<span>300</span>);</span><br /><span>            <span>if</span> ($(<span>&quot;.toc&quot;</span>).length &gt; <span>0</span>) {</span><br /><span>                $(<span>&quot;#toc, #tocButton&quot;</span>).toggle(<span>200</span>, <span><span>function</span>(<span></span>) </span>{</span><br /><span>                    <span>if</span> ($(<span>&quot;.switch-area&quot;</span>).is(<span>&quot;:visible&quot;</span>)) {</span><br /><span>                        $(<span>&quot;#toc, .switch-btn, .switch-area, .beian&quot;</span>).toggle();</span><br /><span>                        $(<span>&quot;#tocButton&quot;</span>).attr(<span>&quot;value&quot;</span>, yiliaConfig.toc[<span>0</span>]);</span><br /><span>                        }</span><br /><span>                    });</span><br /><span>            }</span><br /><span>            <span>else</span> {</span><br /><span>                $(<span>&quot;.switch-btn, .switch-area, .beian&quot;</span>).fadeToggle(<span>300</span>);</span><br /><span>            }</span><br /><span>        });</span><br /><span>}()</span><br /></pre></td></tr></table><p>然后<code>toc.js</code>文件中有原本就有其他元素的切换动画，同样加个<code>.beian</code>即可：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /></pre></td><td><pre><span>$(<span>&quot;#tocButton&quot;</span>).click(<span><span>function</span>(<span></span>) </span>{</span><br /><span>    <span>if</span> ($(<span>&quot;#toc&quot;</span>).is(<span>&quot;:hidden&quot;</span>)) {</span><br /><span>        $(<span>&quot;#tocButton&quot;</span>).attr(<span>&quot;value&quot;</span>, valueHide);</span><br /><span>        $(<span>&quot;#toc&quot;</span>).slideDown(<span>320</span>);</span><br /><span>        $(<span>&quot;.switch-btn, .switch-area, .beian&quot;</span>).fadeOut(<span>300</span>);</span><br /><span>    }</span><br /><span>    <span>else</span> {</span><br /><span>        $(<span>&quot;#tocButton&quot;</span>).attr(<span>&quot;value&quot;</span>, valueShow);</span><br /><span>        $(<span>&quot;#toc&quot;</span>).slideUp(<span>350</span>);</span><br /><span>        $(<span>&quot;.switch-btn, .switch-area, .beian&quot;</span>).fadeIn(<span>500</span>);</span><br /><span>    }</span><br /><span>})</span><br /></pre></td></tr></table><h3><a href="https://ephen.me/2017/beian/#测试成功"></a>测试成功</h3><p>测试时chrome调试外还特地拿移动设备也试了下，并没有备案号，符合预期。</p><p>简单分析看了下，发现移动端的功能基本集中于<code>mobile.js</code>文件中，这个文件我并没有添加备案的相关信息。</p><h2><a href="https://ephen.me/2017/beian/#总结"></a>总结</h2><p>蛮早就想搞这个备案号展示的，可是因为害怕搞不定拖了两三个月，可真正做起来不到半天就搞完了。所以，哪有那么难？</p><p>总的来说，只要有想法，瞎抄都能抄到答案，差别只在于愿不愿意去做。</p><p>很多其他事情大概也是一样的：<strong>没做的时候以为是大山，做了才发现很简单。</strong></p>]]></content>
        
        <summary type="html">
            
            折腾原因由于在公司折腾CloudXNS和牛盾，有个备案比较好开展工作。正好上次公司CDN网监来查，要求我把备案展示出来。想想这事情也该办了，搞起……唔，还是提一嘴，姐无任何前端知识储备，大牛路过请点右上红叉关闭。目标备案号放至左侧边栏下方，链接到工信部网站；备案号可进入主题_c
            
        </summary>
        
        <category term="博客折腾"/>
        
        <category term="hexo"/>
        
        <category term="备案"/>
        
    </entry>
    
    <entry>
        <title>全新出发，正式启用Hexo！</title>
        <link href="https://ephen.me/2016/hello-hexo/"/>
        <id>https://ephen.me/2016/hello-hexo/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:29:08+00:00</published>
        <updated>2018-04-12T08:29:08+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>郑重声明：原网站<a href="http://www.chinatesters.com" target="_blank">http://www.chinatesters.com</a>已正式停止更新，内容已全部转移至这里，未来所有的更新也都在这里。新的站点，新的开始，新的旅程！~</strong><br /><a></a></p><hr /><h2><a href="https://ephen.me/2016/hello-hexo/#缘起"></a>缘起</h2><p>最早看到有人推荐Hexo已经是很久以前甚至不太记得是什么时候的事了，印象中那会儿才弄懂什么静态网站、动态网站之类的词语，只听说Hexo是个基于node.js开发的静态博客框架。当时有点感兴趣，但因为没有时间又担心技术不足就没有再去做过多了解。</p><p>今年5月，公司内部测试尝试量子加速的加速效果时，其产品经理告诉我量子加速对静态资源的加速效果是尤其明显的，可以搭建个静态博客比如Hexo什么的和Wordpress对比试试看。至此，我开启了Hexo折腾模式，但因为没接触过git又不了解node.js，等我搭建好时已经浪费了很多时间。而我依然很忙，加之又想换域名又想导入原博客的内容还想找个看得顺眼的主题，觉得折腾起来实在有些麻烦就先搁着，等什么时候有空了在做。</p><p>直到有一天……</p><blockquote><p>卧槽！CloudXNS监控提醒我网站宕掉了……<br />-“运维兄弟，我的虚拟机咋了？ip是xxx.xxx.xxx.xxx”<br />-“我问了没人回应我就下架了呢，这个是你的啊？”<br />-“对呀对呀，我不在你们群里，可以恢复么？我都没备份……”<br />-“……”</p></blockquote><p>最后，公司运维小哥费了很大劲周末加班给我恢复了数据。为了避免未来数据备份的麻烦，我决定开始正式整理好Hexo并启用Github page服务了。</p><h2><a href="https://ephen.me/2016/hello-hexo/#环境准备（折腾前必须掌握的）"></a>环境准备（折腾前必须掌握的）</h2><p>有一些知识和条件是需要准备的，我这里简单说下，具体可依赖搜索引擎在不会的时候轻松完成。<del>其实我能说是快忘掉了好吗？</del></p><h3><a href="https://ephen.me/2016/hello-hexo/#开通Github-Page服务"></a>开通Github Page服务</h3><p>在自己的github主页中创建一个名为<code>用户名.github.io</code>的 Repository 即可。</p><h3><a href="https://ephen.me/2016/hello-hexo/#本地安装Git并了解一些常用git命令"></a>本地安装Git并了解一些常用git命令</h3><p>到<a href="https://git-scm.com/downloads" target="_blank">Git官网</a>下载Git并安装，windows安装过程中记得勾选 git bash，这个是执行git命令的入口。</p><p>安装好后，启动 git bash 通过执行命令<code>ssh-keygen -t rsa -C &quot;github账号邮箱&quot;</code>生成ssh密钥用来关联github账号。</p><p>到系统用户文档页（Linux系统请去<code>~/.ssh</code>目录找）找到id_rsa文件，打开将内容复制，登陆github账号设置中添加SSH Key并复制进去。</p><h3><a href="https://ephen.me/2016/hello-hexo/#安装node-js"></a>安装node.js</h3><p>Hexo就是基于node.js的，所以这个必须得安装了，安装了它才能执行后面的npm命令。<br />可以自行到<a href="https://nodejs.org" target="_blank">Node.js官网</a>下载自己需要的版本，Windows建议下载最多用户使用的稳定版，我试过最新版好像有点问题。</p><h3><a href="https://ephen.me/2016/hello-hexo/#安装Hexo"></a>安装Hexo</h3><p>Git和node.js安装好后，在本地创建一个文件夹例如<code>E:\Hexo</code>。<br />进入该文件夹，打开git bash，执行命令<code>npm install -g hexo-cli</code> 即可将Hexo安装到该目录。</p><blockquote><p>Linux安装过程请直接参考<a href="https://hexo.io/docs/" target="_blank">Hexo官方操作文档</a>，照给出的命令执行就好了。当然，如果要放到 github page 上同样需要生成 ssh key 与github账号关联并创建一个github主页。</p></blockquote><p>然后用如下命令启动博客：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /></pre></td><td><pre><span>$ hexo init</span><br /><span>$ npm install</span><br /><span>$ hexo server</span><br /></pre></td></tr></table><p>启动后就可以在本机通过<code>http://loaclhost:4000</code>查看效果了。</p><h2><a href="https://ephen.me/2016/hello-hexo/#折腾模式开启"></a>折腾模式开启</h2><p>本次折腾，主要做了以下事情：</p><ol><li>主题安装，选用了<a href="https://github.com/litten/hexo-theme-yilia" target="_blank">yilia</a>主题，但又根据<a href="https://github.com/MOxFIVE/hexo-theme-yelee.git" target="_blank">yelee</a>主题代码做了微量调整；</li><li>导入原来Wordpress博客中的文章、页面和评论；</li><li>github、coding、云主机多点部署并对新购买的域名做分区解析；</li><li>生成RSS订阅、站点地图并将链接主动提交到百度站长平台等利于搜索引擎的优化工作。</li></ol><h3><a href="https://ephen.me/2016/hello-hexo/#主题安装"></a>主题安装</h3><p>执行命令<code>git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia</code>和<code>git clone https://github.com/MOxFIVE/hexo-theme-yelee.git</code>下载上述两个主题，然后复制yilia创建名为ephen的主题副本，修改Hexo博客根目录（我的是<code>E:\Hexo</code>）的_config.xml文件将theme修改为ephen。</p><p>修改完工后删掉下载的两个主题目录。<del>诶诶，怎么有种卸磨杀驴的感觉？</del></p><p>本主题的主要修改点：</p><ol><li>增加Telegram图标，和Telegram配置；</li><li>增加显示和隐藏文章目录的支持；</li><li>原来的评论框代码不够整齐好看，把yelee的评论框移植了过来；</li><li>增加文章搜索的支持（需要安装插件：<code>npm install hexo-generator-search --save</code>，并添加插件设置）；</li><li>增加文章左右边栏按钮；</li><li>其他看起来不太整齐的小部分代码；</li></ol><p>另外，我还想收藏下这个：<a href="http://www.tuicool.com/articles/fYZ7Zrj" target="_blank">http://www.tuicool.com/articles/fYZ7Zrj</a> 什么时候有空了再改。</p><blockquote><p>如果有人喜欢我改后的主题，可以在下面留言</p></blockquote><h3><a href="https://ephen.me/2016/hello-hexo/#导入WordPress的页面-文章和评论"></a>导入WordPress的页面/文章和评论</h3><p>导入文章和页面需要安装这个插件：<code>npm install hexo-migrator-wordpress --save</code></p><p>登陆Wordpress管理控制台，导出WXR文件，如下图所示：</p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egw1f6iwxbmcguj20pt0bzt9y.jpg" /></p><p>将导出的文件保存为<code>wordpress.xml</code>，执行命令<code>hexo migrate wordpress wordpress.xml</code>即可完成文章导入。</p><blockquote><p>注意：</p></blockquote><blockquote><ol><li>如果新站和老站的域名和链接不同，导入之前需要先修改xml文件中类似<code>&lt;link&gt;</code>和<code>&lt;...url&gt;</code>之类的Label内容，以保持和预期站点一致</li><li>导入文件如果是中文标题，可能会出现文件乱码，只能手工去修改了。完成导入后插件的光荣任务结束，处女座星人可以选择卸载它了：<code>npm remove hexo-migrator-wordpress</code></li><li>这个操作并不会导入评论，导入评论请继续往下看</li></ol></blockquote><p>由于Hexo的评论都是使用的社会化评论框，所以评论需要往社会化评论框（我用的是Disqus）中导入才能显示。这类工具一般都是支持转移的，向Disqus导入评论的操作如下：</p><ol><li>登陆WP控制台，导出时选择“文章”，导出文件命名为<code>comments.xml</code>，注意检查下文件中每篇文章的URL是不是和预期的URL一致（不一致会导致评论无法显示！）</li><li>登陆Disqus后台，进入这个页面：<code>https://用户名.disqus.com/admin/discussions/import/platform/wordpress/</code></li><li>选择刚才编辑好的文件导入</li></ol><p>这样，就完成了文章和评论的迁移了。</p><blockquote><p>不过有点小遗憾，评论者头像都丢失，变更为默认头像了。</p></blockquote><h3><a href="https://ephen.me/2016/hello-hexo/#多点部署和分区解析"></a>多点部署和分区解析</h3><p>博客发布到github page和coding page需要安装这个插件：<code>npm install hexo-deployer-git --save</code></p><p>然后到博客根目录找到<code>_config.yml</code>文件打开，将以下代码添加到最后：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /></pre></td><td><pre><span># Deployment</span><br /><span>## Docs: https://hexo.io/docs/deployment.html</span><br /><span>deploy:</span><br /><span>  type: git</span><br /><span>  repo:</span><br /><span>    github: https://github.com/用户名/用户名.github.io.git</span><br /><span>    coding: https://git.coding.net/用户名/用户名.git</span><br /><span>  branch: master</span><br /></pre></td></tr></table><p>设置好后，只需要在Hexo根目录执行<code>hexo g</code>后再执行<code>hexo d</code>便可完成页面的部署。</p><p>和Github上一样，Coding上也要预先安装 SSH Key 并开通 Page 服务。SSH Key 不需要重新生成，将之前在github上用的内容复制过去即可；开通Page服务时注意将部署分支修改成master（默认分支是Coding-page）。</p><p>然后去Github和Coding相应Page项目设置中绑定自己的域名，如图所示：</p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egw1f6iy6moilmj20l10c9ab7.jpg" /></p><p><img src="https://ww2.sinaimg.cn/large/5ebd877egw1f6iy6mm23vj20xw0icq4u.jpg" /></p><p>如果希望在自己的云主机中也部署一份，那么可登陆主机生成 SSH Key，将Key添加到Github或者Coding中（我添加到了Github），到网站文件根目录关联项目链接后执行<code>git pull origin master</code>即可完成站点部署。</p><p>最后，登陆<a href="https://www.cloudxns.net" target="_blank">CloudXNS</a>做<a href="https://www.cloudxns.net/Index/dns.html" target="_blank">域名解析</a>，我的解析设置如下图：</p><p><img src="https://ww4.sinaimg.cn/large/5ebd877egw1f6iyh92u3yj20tm0axt9t.jpg" /></p><h3><a href="https://ephen.me/2016/hello-hexo/#RSS、站点地图及搜索引擎优化"></a>RSS、站点地图及搜索引擎优化</h3><p>这里不用多说，就是几个插件的安装和设置了。它们分别是：<code>hexo-generator-feed</code>，<code>hexo-generator-sitemap</code>和<code>hexo-generator-baidu-sitemap</code>。（两个sitemap一个是谷歌格式，一个是百度格式）</p><p>RSS不需要做其他的操作，插件安装好后每次<code>hexo g</code>就会生成对应的RSS文件，需要时引用这个文件路径即可（比如主题设置中）。</p><p>针对Sitemap，需要到博客根目录去修改<code>_config.yml</code>文件，在<code>plugins：</code>下添加以下内容：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /></pre></td><td><pre><span>#sitemap</span><br /><span>sitemap:</span><br /><span>path: sitemap.xml</span><br /><span>baidusitemap:</span><br /><span>path: baidusitemap.xml</span><br /></pre></td></tr></table><p>分别登陆谷歌站长平台和百度站长平台添加自己的新域名和站点地图。</p><p>按照百度站长平台的指引添加站点地图的位置：</p><p><img src="https://ww3.sinaimg.cn/large/5ebd877egw1f6iyztk985j20ru0npq5m.jpg" /></p><p>也可以到自己的云主机平台上执行命令手动提交，这种提交方式百度响应是最快的了。</p><p>因此我在我的云主机上写了个脚本，用于每次同步网站内容后将新链接提交到百度：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /></pre></td><td><pre><span><span>#!/bin/sh</span></span><br /><span></span><br /><span>DIR=<span>'/var/www/html'</span></span><br /><span>SITE=<span>'http://ephen.me/'</span></span><br /><span></span><br /><span><span>cd</span> <span>${DIR}</span>/</span><br /><span>git pull origin master &gt; <span>${DIR}</span>/.gitpull.log</span><br /><span><span>cd</span> ..</span><br /><span>cat /dev/null &gt; <span>${DIR}</span>/freshurls.txt </span><br /><span>grep <span>'/index.html'</span> .gitpull.log | grep -v <span>'\&quot;'</span> | awk <span>'{print $1}'</span> |<span>while</span> <span>read</span> line</span><br /><span><span>do</span></span><br /><span><span>echo</span>  <span>&quot;<span>${SITE}</span><span>${line}</span>&quot;</span> &gt;&gt; <span>${DIR}</span>/freshurls.txt </span><br /><span><span>done</span></span><br /><span></span><br /><span>curl -H <span>'Content-Type:text/plain'</span> --data-binary @freshurls.txt <span>&quot;http://data.zz.baidu.com/urls?site=ephen.me&amp;token=xxxxxxxxxx&quot;</span></span><br /><span></span><br /><span><span>exit</span></span><br /></pre></td></tr></table><p>如果有人也想使用此脚本，替换自己的目录、站点链接以及百度站长TokenID即可。</p><blockquote><p>注意：该脚本不支持URL链接为中文的情况！！</p></blockquote><h2><a href="https://ephen.me/2016/hello-hexo/#结束语"></a>结束语</h2><p>这次折腾花了不小的精力，毕竟是自己的事情，所以为不占用工作时间多次加班到很晚才走。</p><p>本来不想记录的，担心下次出什么状况又要花大力气折腾，所以趁热记录下，同时也希望我的折腾过程能帮助到其他的新手。</p>]]></content>
        
        <summary type="html">
            
            郑重声明：原网站http://www.chinatesters.com已正式停止更新，内容已全部转移至这里，未来所有的更新也都在这里。新的站点，新的开始，新的旅程！~缘起最早看到有人推荐Hexo已经是很久以前甚至不太记得是什么时候的事了，印象中那会儿才弄懂什么静态网站、动态网站
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="博客折腾"/>
        
        <category term="hexo"/>
        
        <category term="sitemap"/>
        
    </entry>
    
    <entry>
        <title>隔壁粗事了！朝鲜顶级域.kp域名DNS数据配置可被转移</title>
        <link href="https://ephen.me/2016/dotkp-zone-dns-remove/"/>
        <id>https://ephen.me/2016/dotkp-zone-dns-remove/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:28:48+00:00</published>
        <updated>2018-04-12T08:28:48+00:00</updated>
        
        <content type="html"><![CDATA[<p>9月20日上午10点左右，朝鲜的一台顶级域名服务器ns2.kptc.kp不小心配置<a href="https://github.com/mandatoryprogrammer/NorthKoreaDNSLeak" target="_blank">允许全球DNS区域转移</a>，任何人都可以向这台域名服务器发出区域转移请求，获取到一份朝鲜的顶级DNS数据拷贝。朝鲜泄漏的DNS数据显示，它的互联网/局域网规模确实非常小，域名寥寥无几。</p><a></a><p>DNS数据披露了28个可访问的.KP域名：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /><span>19</span><br /><span>20</span><br /><span>21</span><br /><span>22</span><br /><span>23</span><br /><span>24</span><br /><span>25</span><br /><span>26</span><br /><span>27</span><br /><span>28</span><br /></pre></td><td><pre><span>airkoryo.com.kp.</span><br /><span>cooks.org.kp.</span><br /><span>friend.com.kp.</span><br /><span>gnu.rep.kp.</span><br /><span>kass.org.kp.</span><br /><span>kcna.kp.</span><br /><span>kiyctc.com.kp.</span><br /><span>knic.com.kp.</span><br /><span>koredufund.org.kp.</span><br /><span>korelcfund.org.kp.</span><br /><span>korfilm.com.kp.</span><br /><span>ma.gov.kp.</span><br /><span>masikryong.com.kp.</span><br /><span>naenara.com.kp.</span><br /><span>nta.gov.kp.</span><br /><span>portal.net.kp.</span><br /><span>rcc.net.kp.</span><br /><span>rep.kp.</span><br /><span>rodong.rep.kp.</span><br /><span>ryongnamsan.edu.kp.</span><br /><span>sdprk.org.kp.</span><br /><span>silibank.net.kp.</span><br /><span>star-co.net.kp.</span><br /><span>star-di.net.kp.</span><br /><span>star.co.kp.</span><br /><span>star.edu.kp.</span><br /><span>star.net.kp.</span><br /><span>vok.rep.kp.</span><br /></pre></td></tr></table><p>嗯，三胖家的域名果然有够少。（至于他们国家的那些“机密信息”，本宝宝着实不感兴趣</p><p>各位一定要警惕DNS数据安全，配置的严谨性不能忽视。</p><hr /><p>下面分享一点相关知识。</p><h2><a href="https://ephen.me/2016/dotkp-zone-dns-remove/#关于DNS区域传送（DNS-zone-transfer）"></a>关于DNS区域传送（DNS zone transfer）</h2><p>它指的是一台备用服务器使用来自主服务器的数据刷新自己的域（zone）数据库。</p><p>这为运行中的DNS服务提供了一定的冗余度，其目的是为了防止主的域名服务器因意外故障变得不可用时影响到整个域名的解析。</p><p>一般来说，DNS区域传送操作只在网络里真的有备用域名DNS服务器时才有必要用到，但许多DNS服务器却被错误地配置成只要有client发出请求，就会向对方提供一个zone数据库的详细信息，所以说<strong>允许不受信任的因特网用户执行DNS区域传送（zone transfer）操作是后果最为严重的错误配置之一</strong>。</p><p>区域传送漏洞的危害：</p><blockquote><p>黑客可以快速的判定出某个特定zone的所有主机，收集域信息，选择攻击目标，找出未使用的IP地址，黑客可以绕过基于网络的访问控制。</p></blockquote><h2><a href="https://ephen.me/2016/dotkp-zone-dns-remove/#DNS-zone-transfer-的正确配置"></a>DNS zone transfer 的正确配置</h2><p>要知道，区域传送是DNS常用的功能，只有正确的配置才将发挥有利的作用。</p><p>为避免被利用该漏洞，一般常用两种方法：</p><h3><a href="https://ephen.me/2016/dotkp-zone-dns-remove/#方法一：严格限制允许区域传送（zone-transfer）的主机IP"></a>方法一：严格限制允许区域传送（zone transfer）的主机IP</h3><blockquote><p>针对bind，可以在 Global 选项或 zone 选项中增加<code>allow-transfer</code>参数来控制</p></blockquote><blockquote><p>例如：</p></blockquote><table><tr><td><pre><span>1</span><br /></pre></td><td><pre><span>allow-transfer ｛192.168.1.1; 202.103.24.68;｝;</span><br /></pre></td></tr></table><h3><a href="https://ephen.me/2016/dotkp-zone-dns-remove/#方法二：使用-TSIG-key-来严格定义区域传送的关系"></a>方法二：使用 TSIG key 来严格定义区域传送的关系</h3><blockquote><p>使用基于IP地址的访问控制列表可能会被某些“意志坚定”黑客绕过，最好加上 TSIG key 的配置</p></blockquote><blockquote><p>例如：</p></blockquote><table><tr><td><pre><span>1</span><br /></pre></td><td><pre><span>allow-transfer ｛key &quot;dns1-slave1&quot;; key &quot;dns1-slave2&quot;;｝;</span><br /></pre></td></tr></table><h2><a href="https://ephen.me/2016/dotkp-zone-dns-remove/#结语"></a>结语</h2><blockquote><p>每次事件都是一次学习的机会，我有所学习，相信其他人也是。</p></blockquote>]]></content>
        
        <summary type="html">
            
            9月20日上午10点左右，朝鲜的一台顶级域名服务器ns2.kptc.kp不小心配置允许全球DNS区域转移，任何人都可以向这台域名服务器发出区域转移请求，获取到一份朝鲜的顶级DNS数据拷贝。朝鲜泄漏的DNS数据显示，它的互联网/局域网规模确实非常小，域名寥寥无几。DNS数据披露了
            
        </summary>
        
        <category term="当时就被震惊"/>
        
        <category term="知识探索"/>
        
        <category term="朝鲜"/>
        
        <category term="顶级域"/>
        
        <category term="DNS域转移"/>
        
        <category term="bind"/>
        
    </entry>
    
    <entry>
        <title>我又领证了！~</title>
        <link href="https://ephen.me/2016/GetDriverLicense/"/>
        <id>https://ephen.me/2016/GetDriverLicense/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:28:38+00:00</published>
        <updated>2018-04-12T08:28:38+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><a></a><hr /><p>学车真是历经千辛万苦，拿驾照也算是千钧一发。</p><p>科目二排我前面的妹纸坡起半个多钟头，我踩离合的左脚都等酸了，最后妹纸的车还是被考官带走，可怜的我还未进入考试区域就被误判坡起失败。无奈之下悻悻然考完全程再来一次上坡起步，还好定点停的位置神准加上处变不惊临危不乱的心，上坡熄火+后溜竟然被我通过。连教练也称我是个奇迹……</p><p>科目三也是被前面一帅哥坑，他第一遍不及格第二遍没有停在我练习的那段路上，轮到我便一阵慌神，不巧又突然下雨，我不知道雨刷怎么开，朦胧中操作加减挡差点冲向涵洞桥下行人。还好没有啥其他问题可抠，教官勉为其难让我合格了。</p><p>科目四定的考场太遥远，中途在武昌火车站转车时，发现背包开了个大口子，里面的东西都不见了（包括有钱包、身份证之类的）。我到处找，最后居然找到了。包包并不是被别人拉开的，是我们赶车赶得太慌，拉链可能被什么东西勾开了，幸好东西都在。也幸好，在距离考场下班的20分钟前赶到。更幸运的是，我最后十题全对了，这10个题我只要再错一个就拿不到证了，好险！！</p><p>作为一个感性的妹纸，宣誓的时候居然不知为何哽咽……</p><p>女司机上路，请让一让……</p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egy1fcx6s9lcwij20v40io7iz" /></p><hr /><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
        
        <summary type="html">
            
            各位看官请注意：此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。学车真是历经千辛万苦，拿驾照也算是千钧一发。科目二排我前面的妹纸坡起半个多钟头，我踩离合的左脚都等酸了，最后妹纸的车还是被考官带走，可怜的我还未进入考试区域就被误判坡起失败。无奈之
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="生活"/>
        
    </entry>
    
    <entry>
        <title>我又换工作~~内容~~了！</title>
        <link href="https://ephen.me/2016/change-duty/"/>
        <id>https://ephen.me/2016/change-duty/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:28:23+00:00</published>
        <updated>2018-04-12T08:28:23+00:00</updated>
        
        <content type="html"><![CDATA[<p>继在上家公司身兼测试、实施、运维、客服、配置管理、质量管理、培训讲师等多职之后，如今在现任也开启了角色变更模式。</p><p>这次改得更彻底，连公司名也变啦。咱以后是『光载无限（北京）科技有限公司』的人了，不再属于『北京快网科技有限公司』了。</p><p>尽管我还是『武汉快网云计算有限公司』的。</p><p>哈哈，理不清关系吗？其实我也理不太清，不晓得是怎么搞的，反正还是『世纪互联』旗下的。</p><p>『光载无限』要成为『世纪互联』旗下重点品牌了，听说公司正在筹备品牌发布会，也不知道啥时候开。</p><a></a><hr /><p>在武汉快网，我是以软件测试岗在14年中入职的，负责CloudXNS产品测试。</p><p>3个月后，当时的CloudXNS老大“福娃”推荐我转运营，起初测试和运营兼职。</p><p>15年初转运营岗，升做运营主管，专门运营CloudXNS。</p><p>15年中，福娃离职，接着公司组织架构变化，成立产品运营部专门做CloudXNS的产品、开发和运营，然后我又负责产品和运营了。</p><p>现在，团队及组织架构又变化了。技术运维和产品市场完全分开，并不再按产品项目划分部门。</p><p>如今，所有产品、市场、售前管理都直属『光载无限』管辖，公司副总裁找我沟通后，我决定只做产品管理了。</p><hr /><p>压力好大。做的实事越来越少，压力却越来越大。</p><p>角色变了，不再搞运营了，于是咱大VP又新给了两个产品我。</p><p>一年多快两年没摸技术，理解起产品来也比以前吃力了好多。</p><p>然后公司新的组织架构，使我又变成了孤身一人奋斗。产品大牛们都在北京，而又因为客户群的不同，似乎也很难跟他们交流学习到什么。</p><p>没人可讨论、全都要靠自己想，然后各种汇报、汇报、还是汇报。</p><p>不得不承认，我也算一个追求完美的人吧。我真的好怕我的想法是错误的，然后把产品带沟里去。</p><p>我同时也是一个非常在意别人看法的人，怕我的想法遭到实现者的抵触，怕我的表现不得VP认可达不到他的要求，于是左右不能愉快的共事下去。</p><hr /><p>而且还迷茫了。我到底是进化成了IT界的全才，还是一步一步走成IT界的废材呢？</p><p>啥都做过，可能别人很多觉得我做得很不错，但是并没有哪一行达到我心理预期的精通。</p><p>对团队管理又停留于概念，几乎没有获得过好的系统的实施机会。</p><p>一遍又一遍的被问啥时候要孩子，真的有种身心俱疲的感觉。</p><hr /><p>我希望我一如既往还是那个热爱塑造产品、期待改变世界的我。</p><p>这也是我选择转岗到产品的初衷。</p><p><del>我想了好多年了。</del></p>]]></content>
        
        <summary type="html">
            
            继在上家公司身兼测试、实施、运维、客服、配置管理、质量管理、培训讲师等多职之后，如今在现任也开启了角色变更模式。这次改得更彻底，连公司名也变啦。咱以后是『光载无限（北京）科技有限公司』的人了，不再属于『北京快网科技有限公司』了。尽管我还是『武汉快网云计算有限公司』的。哈哈，理不
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="产品运营"/>
        
        <category term="产品管理"/>
        
    </entry>
    
    <entry>
        <title>成功取得项目管理专业人士资格认证</title>
        <link href="https://ephen.me/2017/GetPMPCertificate/"/>
        <id>https://ephen.me/2017/GetPMPCertificate/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:28:00+00:00</published>
        <updated>2018-04-12T08:28:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><a></a><hr /><p>其实就是个 PMP 考试。</p><p>PMP ，全称 Project Management Professional，由美国项目管理协会（Project Management Institute(PMI)）发起的，严格评估项目管理人员知识技能是否具有高品质的资格认证考试。</p><p>这年头，考 PMP 的通过率真的蛮高。但，持续学习是一种精神。要问自己从备考过程中学到了什么，通过考试只是附加值而已。</p><p>当然，没有通过会是很桑心的，毕竟花了好几千大洋呀。虽说不花钱照样能学到东西，但是花钱了没花钱那学习态度肯定是不一样的。花钱报考，只是个学习的助推剂罢了。</p><hr /><p>所谓项目管理，是把一件事情做好的统筹方法。这件事情就是个项目，譬如开发一个产品卖到客户手上，又譬如考个 PMP 证书。</p><p>在这个知识体系中，主要可通俗理解到如下几个方面：</p><ol><li>在项目的初始，作为 PM 要认识到为什么要做这个项目，以及如果要做这个项目要与哪些人搭上关系；</li><li>接着，梳理需求、划定范围，并为项目创建关于时间进度、人力、成本、质量、风险、采购、沟通等方方面面的计划；</li><li>按计划执行项目的时候，合理管理人员做好团队建设，制定一系列的工作质量标准 SOP 流程；</li><li>各角度反复监控执行过程，让项目的进程不偏离既定的计划轨道；</li><li>最终完成项目，交付给客户，并形成经验教训。</li></ol><p>也就是 PMP 管理体系中的<code>启动</code>、<code>规划</code>、<code>执行</code>、<code>监控</code>和<code>收尾</code>五大过程组。</p><p>由于它并不局限于某个行业或某一类行业，所以其内容非常繁杂，并且以人为本的因素很多。因而对于整个体系的理解，并结合项目经验显得尤为重要。</p><hr /><p>在这次备考过程中，我在理解知识体系的时候代入的是我在上家公司的工作经验。</p><p>上家公司我就是身在一个软件实施项目组，参与并负责完成了项目中的很多事情，加之公司的工作流程非常标准（不记得是 CMMI4 还是 CMMI5 级别），学习过程中的所有活动我都能找到工作原型。所以尽管备考过程也比较辛苦，但是相对来说，我还是比较轻松的。</p><p>我想了下，如果我从没有上家公司的工作经历，仅仅是在武汉快网的环境下，也许会吃力得多。武汉快网的管理是互联网扁平化风格，工作中与大部分管理知识没有交集。</p><p>不过像 PMBOK 开篇就提出的，任何管理都是要基于企业文化的，并不是说符合书中就是最好的，不符合就不好。<strong>适合的才是最好的。</strong></p><hr /><p>要参加 PMP 考试是必须要报培训班的，我在武汉报的是“世纪卓越”，有人也想报名的话可以找我推荐。好像推荐可以少交点培训费吧，不过我并得不到好处的唷~</p><p>周末班上课，压力是挺大的。从早上 9 点除了中午约一小时吃饭时间外连续上到下午 5:30 ，上午下一次课，下午下两次课，时间仅够排队去上厕所的。讲课内容很多很满，上起课来可能会觉得脑容量不太够。</p><p>为什么压力这么大呢？</p><ol><li>PMP 一年考试 4 次，每季度一次，然后这些培训讲师会到多个地方授课，带很多很多的学生；</li><li>PMP 考试 pmi 不会提供原题和答案，这些培训公司和老师们要组织和整理每一次刚考完的考生记题并讨论出标准的权威的答案；</li><li>老师要写书、写讲义，之后再根据讲义讲课；</li><li>一般学生要先预习后再上课，内容很多，大家又都是上班族。</li></ol><p>所以上课时间就压缩到考前一个月了。总共上 5 天课，安排一天模拟考，3个周末搞定这些。</p><p>马上 2018 年就要换 PMP 教材了，建议有考虑考 PMP 并且还没开始行动的童鞋最早报明年 9 月份的吧。一来是错峰（今年的报考人数井喷得不行），二来让前面俩季度的学生试试水、讲师再积累下新版本经验，再来就是刚换教材可能不会有较大的难度。</p><p>我们今年的考试很难。听说还有些新版中的超纲内容，大概今年的几次考试都是为版本过渡而生的。</p><hr /><p>这次考试，除了我要学的知识，还收获了很多。</p><p>一开始刚报名的时候没进入状态，后来发现群里的小伙伴们都有很多人书看完了还梳理了各种心得，我就慌了。</p><p>我把书放在公司，每天晚上在公司加班看书学习，并且一有时间就泡在群里尝试着给同学们解答问题。</p><p>因为我经常回答问题，所以收获了很多朋友。我在武汉组织了一个学习小组，然后深圳也有一些小伙伴组了个<code>学霸</code>群。</p><p>哈，其实<code>学霸</code>群就是备考累了歇息用的吹水群辣。。看起来大家都在争自己怎样怠慢学习，又暗暗较劲的要考个好成绩，再去攻其他的证书。</p><p>最终我两个群的小伙伴全数通过考试。</p><hr /><p>证书证书，这肯定是要晒的咯！</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fncyqevo2jj20tb0mnq7h.jpg" /></p><hr /><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
        
        <summary type="html">
            
            各位看官请注意：此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。其实就是个 PMP 考试。PMP ，全称 Project Management Professional，由美国项目管理协会（Project Management Institut
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="项目"/>
        
        <category term="管理"/>
        
    </entry>
    
    <entry>
        <title>告别“牙套妹”称号</title>
        <link href="https://ephen.me/2017/Goodbye-Orthodontic/"/>
        <id>https://ephen.me/2017/Goodbye-Orthodontic/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:26:55+00:00</published>
        <updated>2018-04-12T08:26:55+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><a></a><hr /><p>我小时候牙换好之后就一直挺乱的。那会儿听说过整牙这个词，说是要花大几千，就任由牙齿野蛮生长。</p><p>成年后，有一颗牙齿越龅越厉害，于是越来越期冀于整牙这个行为，希望自己挣了钱能完成心愿。</p><p>当年实习找工作，一口牙被面试官也鄙视了，说希望我入职公司有钱之后能把牙整整。</p><p>提前了解到整牙一般是分期支付的，所以 2012 年当我把大学贷款还完之后就到武汉大学口腔医院咨询正畸的事宜。</p><hr /><p>2012 年 7 月初挂号拍片定方案，当听说要拔掉 8 颗牙（4 颗智齿都已长齐，外加上下左右各一颗双尖牙）之后，我犹豫了很久。</p><p>长到 23 岁那么大，一口牙长得不好看但好在一直都很健康，从来没有龋坏过也没有发炎疼痛过，一下子要拔掉 8 颗让我特别难以接受。</p><p>我经过了漫长的思想斗争，2012 年 8 月 29 日，我开始去拔牙了，从此踏上了正畸这条不归路。</p><hr /><p>8 颗牙分了 3 次拔完，每次间隔 2 到 3 周，直到 2012 年 11 月 4 日，上颌牙粘上了牙套。</p><p>自锁牙套，开始 2 个月复诊一次，复诊两次后（ 4 个月）改为一个半月复诊一次，2013 年 8 月 22 日，下颌牙才粘上牙套，之后一个月复诊一次。</p><p>一开始混迹“牙套之家”了解各种正畸知识，和他人对比，似乎我的进程永远都是最慢的，就像最终我花了 5 年时间实在等不及了才将一口并不算很满意的牙齿解放一样。</p><p>牙齿解放的那一天，是今年的七夕， 2017 年 8 月 28 日。那一天，本来以为上午可以搞完，下午就去领证，却没想到各种意外直到晚上才看完牙齿。</p><hr /><p>牙套妹的这整整 5 年，实在是牺牲了太多太多，不止是 Money 。</p><p>5 年来，从不敢开口笑，导致我牙套拆除后笑容特别僵硬，已经不会了；</p><p>屈指可数的照片，哪里还会去研究过怎样自拍的角度更光彩照人？</p><p>被耽误的结婚生子，如果早知道要 5 年这么久，孩子可能早就生了，一切都是因为怕卸牙套的那一天会拍 CT 会因为拔除钉子要用消炎药。</p><p>之前预定的婚纱摄影两年期也过了……</p><p>从 2015 年 8 月复诊以来就被告知可能很快就结束正畸了，可最后硬生生又拖了两年，而且还是在我的强烈要求下结束的。</p><hr /><p>正畸治疗感受，一点都不好！</p><p>武汉大学口腔医院从总部到武胜路门诊到中南路门诊，我辗转了 3 个地方，尽是折腾；</p><p>每次复诊必须是工作日，排队排得人想死，排三四个小时最后 5 分钟看完是常态，甚至都有多次排完三四个小时最后连号都没挂上让次日再去的情况；</p><p>折腾、排队也就罢了，最让人不爽的就是，全院服务人员的态度都非常差！！说话恨不得鼻子朝天的。</p><p>各医生（拔牙、麻醉、正畸、洁牙、影像等各科医生）的待人态度虽都还可以，但是工作都极度不认真！！</p><p>我有一颗没有掉的小乳牙，在我治疗了 2 年后找个私人牙科诊所洁牙的时候才被发现（这颗牙就是导致我外面那颗恒牙越来越龅的罪魁祸首）；</p><p>粘完托槽出门坐个公交刚到家托槽就又掉；经常被缠绕得不太好的铁丝刮到粘膜导致发炎；治疗结束做洁牙大块的牙结石还在牙齿上，找他们扯皮做了二次洁牙回家后发现还是没有弄干净……</p><p>真的，如果有朋友想正畸，千万不要去这种大的专科医院找专家医生了，血泪教训！！</p><p>收费明细又多又贵，服务态度不行，工作态度不认真，关键你挂号的那个专家每次都是匆匆一瞥，操作都是实习生完成的。</p><p>如果想正畸，重点关注医生的资质和正畸案例，以及诊所操作消毒清洁就好。</p><hr /><p>所以我到底花了多少钱？</p><p>已知的较大项：治疗费 7800 元；材料费 3300 元；种植钉 900 元；术前（CT、取模、照相、方案） 1480 元；术后（CT、取模、洁牙、照相、保持器） 860 元；拔掉8颗牙（带麻醉） 1800+ 元</p><p>另外所有的细项例如粘件、弓丝、皮圈、蓝胶、平导、托槽…… 都要收费，而且还不便宜。比如托槽掉了一颗要换新的话就是 200 元，然后粘结费另收。</p><p>正畸挂号费，2012 年 ~ 2017 年 3 月，每次 11.5 元，最后的几次每次 23.5 元；其他服务的挂号费每次 6.5 元。（对，你没看错，有可能一天要挂多个号，因为要找不同的医生）</p><p>我准备有时间的时候去打印我的消费清单，估计总数得有 3w+ 。然后再算上请假和交通费用，呵呵哒……</p><p>后面每 3 个月的保持器复诊估计还有大把的钱要交。。</p><p>还有最关键最关键的一点：正！畸！是！不！能！刷！医！保！卡！的！！只有拔牙和洁牙有部分内容可以医保结算（也不是全额能用哦）。</p><hr /><p>正畸治疗效果，一般般。</p><p>最后的几个瑕疵在经过了 1 年多的坚持复诊后依然完全看不到能调整好的希望，实在受不了了我便严正要求结束。</p><p>各种复诊、缠绕、拍片，不知觉间我居然已经 28 了，小时候想着 28 岁前要两个小宝宝的愿望，至此已经丢进了坟墓。</p><p>尽管日常恐孕，但这两年的身体素质下滑感觉特别明显，是该考虑下生育问题了。（<del>要不去冻个卵？求推荐机构</del>）</p><p>5 年前我梦想着两三年弄好变成大美女美美哒嫁人，5 年后自己不堪忍受结束治疗的时候已然一个黄脸婆。</p><p>对了，要求结束治疗的时候还被逼签署免责书，生怕我找他们麻烦似的。他们脸这么大，我哪里找得起哦~</p><hr /><p>正畸对脸型的改变确实也是有的。</p><p>尤其我这种拔牙多的，脸变长、颧骨变高、太阳穴深陷，这些都有，尤其在拔牙粘上牙套之初。</p><p>不过好在牙套卸下后，这种变化已经能够接受，不算太坏，甚至可能有一点点较之前更美好一点。</p><p>这大概是唯一的优势了。</p><hr /><p>正畸的后遗症。</p><p>颞下颌关节弹响比术前频繁，有一点点不舒服；</p><p>在剔除蓝胶后，咬合关系比较怪异，咀嚼不是很顺利，不知道时间久一点会不会好了；</p><p>牙齿内收但舌头没有随之平滑退后，导致说话偶尔有点点大舌头（据说这个是成人正畸的通病，时间长了之后可能会好点，儿童一般没这个问题）；</p><p>至于牙齿是不是变松，暂时还没发现。</p><hr /><p>恩，要说的差不多说完了。上照片。</p><p>先来一张拆掉牙套次日的灰姑娘美照镇楼：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fkmnb46tcpj20k00zkju9.jpg" /></p><p>牙套前后脸型对比：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fkmn8xi6tkj20m80fnkjg.jpg" /></p><p>我不太喜欢拍照（所以我某种意义上不太像个女生），也没写过什么牙套日记，找张照片还挺难，凑合着看吧。希望没吓到路过的你。</p><hr /><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
        
        <summary type="html">
            
            各位看官请注意：此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。我小时候牙换好之后就一直挺乱的。那会儿听说过整牙这个词，说是要花大几千，就任由牙齿野蛮生长。成年后，有一颗牙齿越龅越厉害，于是越来越期冀于整牙这个行为，希望自己挣了钱能完成心愿。当
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="生活"/>
        
    </entry>
    
    <entry>
        <title>几乎花了一个下午的时间参观了风河博客</title>
        <link href="https://ephen.me/2016/fenghe-blog/"/>
        <id>https://ephen.me/2016/fenghe-blog/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:26:18+00:00</published>
        <updated>2018-04-12T08:26:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>2015 年 CloudXNS “重出江湖”的时候，我们做了个让用户写体验文章的活动，风河博客的一篇《<a href="http://oldstory.fenghe.org/archives/1497" target="_blank">谈谈CloudXNS</a>》吸引了我的眼球。</p><a></a><p>和其他人通篇描述智能DNS功能不同，这篇文章着重分析了底层NS服务的问题，并提了一些建议。于是我很感兴趣，翻看起这个博客来。</p><p>也许我并不是一个专业研究DNS的人，但是我却挺乐意学习这样的内容以丰富自己的工作。翻看风河博客发现，该主人也是做DNS的，并且对NS的研究还是蛮多的。所以对CloudXNS来讲，他们也是竞争对手，不过那又有什么关系呢？</p><p>博客内容很丰富，我看了很久，也学到了不少东西。很赞哦！</p><p>Mark几篇不错的内容（希望作者不会删，我偶尔还能再去看看）：</p><ol><li><a href="http://oldstory.fenghe.org/archives/129" target="_blank">为什么 com 和 net 使用一组相同的名字服务器</a></li><li><a href="http://oldstory.fenghe.org/archives/101" target="_blank">记一次DNS故障：更新NS服务器要随之更新Glue</a></li><li><a href="http://oldstory.fenghe.org/archives/91" target="_blank">为什么名字服务器必须注册？</a></li><li><a href="http://oldstory.fenghe.org/archives/479" target="_blank">尽量少用泛域名</a></li><li><a href="http://oldstory.fenghe.org/archives/1820" target="_blank">顶级域名启用泛记录的危害性</a></li><li><a href="http://oldstory.fenghe.org/archives/442" target="_blank">一个域名使用多家DNS</a></li><li><a href="http://oldstory.fenghe.org/archives/1922" target="_blank"> DNS branding 设置示例</a></li></ol>]]></content>
        
        <summary type="html">
            
            2015 年 CloudXNS “重出江湖”的时候，我们做了个让用户写体验文章的活动，风河博客的一篇《谈谈CloudXNS》吸引了我的眼球。和其他人通篇描述智能DNS功能不同，这篇文章着重分析了底层NS服务的问题，并提了一些建议。于是我很感兴趣，翻看起这个博客来。也许我并不是一
            
        </summary>
        
        <category term="心情驿站"/>
        
        <category term="知识探索"/>
        
        <category term="DNS"/>
        
        <category term="泛域名"/>
        
    </entry>
    
    <entry>
        <title>使用网页工具 DNSViz 检查域名 DNSSEC 配置</title>
        <link href="https://ephen.me/2016/dnssec-dnsviz/"/>
        <id>https://ephen.me/2016/dnssec-dnsviz/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:23:32+00:00</published>
        <updated>2018-04-12T08:23:32+00:00</updated>
        
        <content type="html"><![CDATA[<h2><a href="https://ephen.me/2016/dnssec-dnsviz/#关于-DNSSEC"></a>关于 DNSSEC</h2><p>DNSSEC 全称 Domain Name System Security Extensions，即 DNS安全扩展，是由Internet工程任务组 （IETF）提供的一系列DNS安全认证的机制（可参考<a href="https://tools.ietf.org/html/rfc2535" target="_blank">RFC2535</a>）。</p><p>它是对DNS提供给DNS客户端（解析器）的DNS数据来源进行认证，并验证不存在性和校验数据完整性验证，但不提供或机密性和可用性。<a href="https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%89%A9%E5%B1%95" target="_blank">来源：域名系统安全扩展 - 维基百科，自由的百科全书</a></p><p>一些基础的相关介绍可参考我在 CloudXNS 官网发的文章：</p><ol><li><a href="https://www.cloudxns.net/Support/detail/id/1309.html" target="_blank">什么是DNSSEC？DNSSEC的概念及作用</a></li><li><a href="https://www.cloudxns.net/Support/detail/id/1311.html" target="_blank">如何验证DNS服务器是否支持DNSSEC？</a></li></ol><p>通俗点讲， DNSSEC 的主要作用就是防止 DNS劫持，从而保证 DNS安全。</p><p>但在这个保证安全的过程中，DNSSEC 的 RR 和 RRSIG 的传输过程都是未加密的（即：不提供机密性），我们通过一些嗅探工具可以读取 RRSIG记录 以及由 DS记录 建立的信任链。</p><p>今天我们就来聊聊 DNSSEC 信任链的那些事。</p><a></a><h2><a href="https://ephen.me/2016/dnssec-dnsviz/#DNSSEC-相关的资源记录"></a>DNSSEC 相关的资源记录</h2><p>以国际知名的支付平台Paypal为例。</p><p>Paypal.com 域名配置了 DNSSEC 签名，以下是使用支持 DNSSEC 的 DNS服务器 4.2.2.4 查询 A记录 的解析结果：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /></pre></td><td><pre><span>~ dig paypal.com +dnssec @4.2.2.4</span><br /><span></span><br /><span>;; QUESTION SECTION:</span><br /><span>;paypal.com.INA</span><br /><span></span><br /><span>;; ANSWER SECTION:</span><br /><span>paypal.com.204INA64.4.250.23</span><br /><span>paypal.com.204INA64.4.250.24</span><br /><span>paypal.com.204INRRSIGA 5 2 300 20161023213752 20160923205517 11811 paypal.com. lHYZ/5xp9uCfUKGVbvLWr3dA3Ri8X3G1O9fdi6ludo1qYDbYFFyyAdWp szGoszxSRE0jT1ggUOXufBv7nEF++ODkzXB4U4QmKt6ooqQRG8TMDsGw WbJtAgMq0ul8PRPZz8MvkZGxucB2pC4+HwtQaJ/g43sxP9ouHsCePnU7 +H4=</span><br /></pre></td></tr></table><h3><a href="https://ephen.me/2016/dnssec-dnsviz/#RRSIG："></a>RRSIG：</h3><p>RRSIG 资源记录值很长，乍一看是一堆乱码，咱们还是对照格式来看：</p><blockquote><p><code>A</code> - 记录类型</p><p><code>5</code> - 算法类型 (参考附录「算法类型列表」)</p><p><code>2</code> - 标签 (泛解析中原先 RRSIG 记录的名称)</p><p><code>300</code> - 原 TTL 大小</p><p><code>20161023213752</code> - 签名失效时间</p><p><code>20160923205517</code> - 签名签署时间</p><p><code>11811</code> - Key 标签 (一个简短的数值，用来迅速判断应该用那个 DNSKEY 记录来验证)</p><p><code>paypal.com.</code> - 签名名称 (用于验证该签名的 DNSKEY 名称)</p><p>“…太长了就不写了…” - 加密签名</p></blockquote><hr /><p>DNSKEY 和 DS （Delegation Signer）记录也都看下。</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /></pre></td><td><pre><span>~ dig paypal.com +dnssec @4.2.2.4 DNSkey</span><br /><span></span><br /><span>;; QUESTION SECTION:</span><br /><span>;paypal.com.INDNSKEY</span><br /><span></span><br /><span>;; ANSWER SECTION:</span><br /><span>paypal.com.25INDNSKEY256 3 5 AwEAAc/7r7w6qEg59vzyfcKgIm7K3h43tglKOJjoFyK5lxhl2e7vh8Cw vj3cwKQHccsvWuvAK0ummTSysxZT0JJgw8gkhIGGiZ63MJTcbocDezgZ iA/q4ejpjdrj27gs5mCHAsyC9BAVZiysfIwqtRFsP0GjivNYzIc6qGWA XcAJKLLX</span><br /><span>paypal.com.25INDNSKEY257 3 5 AwEAAdVtmC6yOQb0+5MT5ezC9GJsCb10WkVE1qMAbilAN5KZ0/wJD+4P 1/WB7ctXC0RnEjHzVrKmLsFzRb3mpI9wm0cf5pN8BHMSVfdDpycjNyGb My7EKJ77POD7lSimJouMx5Tp+HQaJZeU0MnXJkR4qaAvShr5iNtVaopO uIXQfRDnLdDoxETw9XplIL9wkpe1gW5uQNk+Fhy4PRyf+e5yhgiZjemm RiEDJH+FxCUAf8ZV+xHSuucWKY3V1tEheptdUaIAbnCGDWGTbi9ziai6 SrLzRrrDeImwm42PkxD5cURMWqHQIBfEJlDB+koqWPm73sDPMlPgoBUy xb/w5JFLV+c=</span><br /><span>paypal.com.25INRRSIGDNSKEY 5 2 600 20161030075650 20160930070223 11811 paypal.com. botQ3ANf+tWS4AFxKF+xITOkAOfMaMlwSz7lucnzSKl2XUHKMCOgk3yn ux0VwzGITuwFyg61f6qlwAbKEgVZHjVq+ERwEIiUzyKMi7NUDKbTQbB/ w2+dsTwKX5A7oCOQR3gJytfw4eFbrKKXfCvkTk/WVFjdaCnh+MNDn/x+ 37Y=</span><br /><span>paypal.com.25INRRSIGDNSKEY 5 2 600 20161030075650 20160930070223 21037 paypal.com. H3Ms6s//q4actymLzj5xLh+ficbqet6iyzwc/eA1/KUxpQISydXTVmuT jLcn+nbILH6QXHiNZiMmkIZm2YsxYBAEa+V9botN0HqFz5iBgcaBmIAk L5xp66SZdQQyJTfWbi1ILYCiDeJmS5mkvqwdFbjIW4Cxouj8WRBPYHL2 r0k+icmq0fSI/m0ujdK0tstodc2jd2nb9Vvj1q19DooE6jcWN6KwEa3k p2pe8/nNSeCfsqqxPb0wzvj14YTpOHq3R6y1Y84T2/dOdoAKsMhKJddK l30nQOuodh7FV7AvO4uf/ewDMlMB65hEH8zwBaxhpPyGHzeWj1t/YzOW PzMWOQ==</span><br /></pre></td></tr></table><h3><a href="https://ephen.me/2016/dnssec-dnsviz/#DNSKEY："></a>DNSKEY：</h3><blockquote><p><code>256</code> - 标识符 (Zone Key (DNSSEC密钥集) 以及 Secure Entry Point (KSK和简单密钥集))</p><p><code>3</code> - 协议 (固定值3 向下兼容)</p><p><code>5</code> - 算法类型 (参考附录「算法类型列表」)</p><p>“…最后的…” - 公钥内容</p></blockquote><hr /><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /></pre></td><td><pre><span>~ dig paypal.com +dnssec @4.2.2.4 DS</span><br /><span></span><br /><span>;; QUESTION SECTION:</span><br /><span>;paypal.com.INDS</span><br /><span></span><br /><span>;; ANSWER SECTION:</span><br /><span>paypal.com.3553INDS21037 5 2 0DF17B28554954D819E0CEEAB98FCFCD56572A4CF4F551F0A9BE6D04 DB2F65C3</span><br /><span>paypal.com.3553INRRSIGDS 8 2 86400 20161017041535 20161010030535 27452 com. cDatvEwBK3yOTI2QTyX/xZBxGQMKg006mT2kzNy+olS751dbWlyETgpz gv2RyaSY9eoHVXAE+2DBD/BzKV1lV3sp1Pwgqb3PCYuJx6TAvAs7YkK6 B5uZ+prCUEKf8pHF325FLzXs7S23cZe7k1PmTfkepMTH4r0lcRYJFlP1 sog=</span><br /></pre></td></tr></table><h3><a href="https://ephen.me/2016/dnssec-dnsviz/#DS："></a>DS：</h3><blockquote><p><code>21037</code> - Key 标签 (一个简短的数值，用来迅速判断应该用那个 DNSKEY 记录来验证)</p><p><code>5</code> - 算法类型 (参考附录「算法类型列表」)</p><p><code>2</code> - 摘要类型 (创建摘要值的加密散列算法)(参考附录「摘要类型列表」)</p><p>“…最后的…” - 摘要：引用的 DNSKEY记录 的加密哈希值。</p></blockquote><h2><a href="https://ephen.me/2016/dnssec-dnsviz/#DS记录-建立的-DNSSEC-信任链"></a>DS记录 建立的 DNSSEC 信任链</h2><p>DS，是 Delegation Signer 的缩写，即“委派签名者”，用于构建到子 zone 的身份验证链。</p><p>对于 Paypal.com 来说，其 DS记录值 是上一级 .com 的私钥对其 DNSKEY 进行加密后得到的。</p><p>而如果 Paypal.com 存在独立的子域时，又将利用其私钥对其子 zone 的 DNSKEY 执行加密从而生成子域的 DS记录值 。</p><p>下图是用 DNSViz 查询到的 Paypal.com 的信任链：</p><p><img src="https://ww2.sinaimg.cn/large/5ebd877egw1f8qj6q2owkj20mk0zidjj.jpg" /></p><p>图中展示的三个框，从上至下依次代表域名<code>.</code>、<code>com.</code>和<code>paypal.com.</code>，每个框中间的内容分别对应这三个 zone 的 DNSKey 和 DS 的传递关系。</p><p>可以通过点击<a href="http://dnsviz.net/d/paypal.com/dnssec/" target="_blank">http://dnsviz.net/d/paypal.com/dnssec/</a>查看更多细节。</p><h2><a href="https://ephen.me/2016/dnssec-dnsviz/#DNSSEC-配置检查神器：DNSViz"></a>DNSSEC 配置检查神器：DNSViz</h2><p>点开上面的网站，可以看到 DNSViz 是一个很强大的工具。</p><p>它是由 美国Sandia国家实验室 和 Verisign,Inc. 联合推出的专门用于分析域名的 DNSSEC 配置检查的一款分析工具。</p><p>在上图中，鼠标移到上述生成的信任链中的每个椭圆标记的元素上，都能看到很多详细内容。除了包括上面我通过 dig 命令查询到的信息之外，还有服务器信息以及状态是否安全。</p><blockquote><p>点击上方的<code>Response</code>可以查看到各种 DNSSEC 资源记录类型的查询记录以及和根域、NS服务器之间的关系；</p><p>点击切换到<code>Servers</code>可以查看到 Paypal.com 的4个权威域名服务器（NameServer）的信息；</p><p>最后的<code>Analyze</code>用于简洁的展示查询分析过程：</p></blockquote><blockquote><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /></pre></td><td><pre><span>Analyzing paypal.com</span><br /><span>  Querying paypal.com/NS (referral)...</span><br /><span>  Querying paypal.com/NS (auth)...</span><br /><span>  Querying paypal.com/A...</span><br /><span>  Preparing query jld3x6hmi0.paypal.com/A (NXDOMAIN)...</span><br /><span>  Preparing query paypal.com/CNAME (No data)...</span><br /><span>  Preparing query paypal.com/MX...</span><br /><span>  Preparing query paypal.com/TXT...</span><br /><span>  Preparing query paypal.com/SOA...</span><br /><span>  Preparing query paypal.com/DNSKEY...</span><br /><span>  Preparing query paypal.com/DS...</span><br /><span>  Preparing query paypal.com/AAAA...</span><br /><span>  Executing queries...</span><br /><span>Success!</span><br /></pre></td></tr></table></blockquote><blockquote><p>左侧的树形标签可展开，查看各个点的状态汇总及图例。</p><p>更多的图例解释，可点击左侧下方的<a href="http://dnsviz.net/doc/dnssec/" target="_blank">Full legend</a>。英文太渣，我就不做半调子翻译官了，感兴趣的话自己去看。</p></blockquote><p>既然是配置检查，当存在不正确的配置时，也会根据影响做 Error 或 Warning 的标记。例如我的博客域名 ephen.me，没有配置DNSSEC，查询出来是这样的：</p><p><img src="https://ww2.sinaimg.cn/large/5ebd877egw1f8qml8gpx3j20qj0usn0m.jpg" /></p><p>除了上图中最下一排的各种感叹号外，左边还有一大排的 Error 和 Warning ，描述了我的域名具体的配置出错的地方。</p><blockquote><p>如果以后要给域名部署配置DNSSEC，我会记得再来这个网站查查看。 </p></blockquote><h2><a href="https://ephen.me/2016/dnssec-dnsviz/#附录"></a>附录</h2><h3><a href="https://ephen.me/2016/dnssec-dnsviz/#算法类型列表"></a>算法类型列表</h3><ul><li>1: RSA/MD5</li><li>2: Diffie-Hellman</li><li>3: DSA/SHA-1</li><li>4: Elliptic Curve</li><li>5: RSA/SHA-1</li><li>6: DSA-NSEC3-SHA1</li><li>7: RSASHA1-NSEC3-SHA1</li><li>8: RSA/SHA-256</li><li>10: RSA/SHA-512</li><li>12: RSA/SHA-512</li><li>13: ECDSA Curve P-256 with SHA-256</li><li>14: ECDSA Curve P-384 with SHA-384</li><li>252: Indirect</li><li>253: Private DNS</li><li>254: Private OID</li></ul><h3><a href="https://ephen.me/2016/dnssec-dnsviz/#摘要类型列表"></a>摘要类型列表</h3><ul><li>1: SHA-1</li><li>2: SHA-256</li><li>3: GOST R 34.11-94</li><li>4: SHA-384 </li></ul><h2><a href="https://ephen.me/2016/dnssec-dnsviz/#参考资料及其他"></a>参考资料及其他</h2><ol><li><a href="http://support.simpledns.com/kb/a173/check-dnssec-signatures-tool.aspx" target="_blank">Check DNSSEC Signatures tool</a>（这个也是一DNSSEC配置检查工具，由于看介绍没有DNSViz看起来直观，就没有进一步了解。附：<a href="http://www.simpledns.com/outbox/chksig.zip" target="_blank">下载链接</a>）</li><li><a href="https://msdn.microsoft.com/zh-cn/library/jj200221%28v=ws.11%29.aspx" target="_blank">Microsoft MSDN - DNSSEC 概述 </a></li><li><a href="https://www.cc.ntu.edu.tw/chinese/epaper/0022/20120920_2206.html" target="_blank">台湾大学电子报 - DNSSEC安全技術簡介</a></li><li><a href="https://imlonghao.com/41.html" target="_blank">imlonghao - 我所理解的DNSSEC</a></li><li><a href="http://netsec.ccert.edu.cn/duanhx/?p=1479" target="_blank">DNSSEC 原理、配置与布署简介 | 段海新( Haixin Duan ) @ Tsinghua University</a></li><li><a href="https://www.verisign.com/zh_CN/domain-names/dnssec/index.xhtml" target="_blank">Verisign - DNSSEC</a></li></ol>]]></content>
        
        <summary type="html">
            
            关于 DNSSECDNSSEC 全称 Domain Name System Security Extensions，即 DNS安全扩展，是由Internet工程任务组 （IETF）提供的一系列DNS安全认证的机制（可参考RFC2535）。它是对DNS提供给DNS客户端（解析器）
            
        </summary>
        
        <category term="工具介绍"/>
        
        <category term="知识探索"/>
        
        <category term="DNSViz"/>
        
        <category term="DNSSEC"/>
        
        <category term="DNS劫持"/>
        
        <category term="DNS安全"/>
        
    </entry>
    
    <entry>
        <title>使用公共 DNS 上网的弊端（二）</title>
        <link href="https://ephen.me/2017/PublicDns_2/"/>
        <id>https://ephen.me/2017/PublicDns_2/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:23:17+00:00</published>
        <updated>2018-04-12T08:23:17+00:00</updated>
        
        <content type="html"><![CDATA[<p>上一篇文章《<a href="https://ephen.me/2017/PublicDns_1/">使用公共 DNS 上网的弊端（一）</a>》我讲到当我们使用公共 DNS 上网时可能会因为该 DNS 的出口与本地实际网络所属区域和运营商不一致而导致调度不准，进而影响连接速度可能变慢。这篇文章同时发到了咱们 CloudXNS 的微信公众号上，不少小伙伴与我们产生了互动。</p><p>有的小伙伴就问到：“如果是支持 Edns-Client-Subnet 的公共 DNS，还会存在我说的问题吗？”</p><p>不得不佩服小伙伴们的学识！（比灰姑娘可厉害多了……</p><a></a><h2><a href="https://ephen.me/2017/PublicDns_2/#什么是-Edns-Client-Subnet-？"></a>什么是 Edns-Client-Subnet ？</h2><p>Edns-Client-Subnet，简称 ECS，是由 Google 提交的一份 DNS 扩展协议，主要作用是允许 DNS resolver 传递用户的 IP 地址给权威 DNS 服务器。</p><p>关于 ECS 的 RFC 草案提出了很多年，直到 2016 年 5 月才被纳入正式 <a href="https://tools.ietf.org/html/rfc7871" target="_blank">RFC 7871</a>。</p><p>过去我曾在 CloudXNS 官方文章 《<a href="https://www.cloudxns.net/Support/detail/id/116.html" target="_blank">【CloudXNS 教您几招】如何让多 ip 域名配置游刃有余？[1]</a>》中侧面提到过关于 ECS 的概念及测试示例，感兴趣的小伙伴可以先去看看。</p><h3><a href="https://ephen.me/2017/PublicDns_2/#ECS-支持现状"></a>ECS 支持现状</h3><p>过去 ECS 一直作为一个 RFC 草案存在，真正成为规范至今也仅仅一年。</p><p>如果要让域名的来访用户真正能访问到正确的区域和运营商站点，不仅仅用户使用的本地 DNS 要支持 ECS，同时域名使用的权威 DNS 也要支持。</p><p>而事实上，ECS 的普及程度并不高。目前市场上支持 ECS 的权威 DNS 不多，支持 ECS 的递归 DNS 更是少之又少。像在中国，就并没有哪个运营商的本地 DNS 支持。 </p><p>同时，更多的网站主并不很了解 DNS 相关业务知识。大多数站主随便找个注册商购买了一个域名然后填写几条记录并完事，懂得多点的知道找个智能 DNS 做分区解析。仅此而已。</p><p>那么，假设域名使用了支持 ECS 的智能 DNS 和 CDN，访问的用户也使用支持 ECS 的公共 DNS，这中间还会不会有什么问题呢？</p><h2><a href="https://ephen.me/2017/PublicDns_2/#ECS-的弊端"></a>ECS 的弊端</h2><h3><a href="https://ephen.me/2017/PublicDns_2/#访问网站时的解析时间将可能增加"></a>访问网站时的解析时间将可能增加</h3><p>我们知道，DNS 是有逐级缓存的。我们常常访问的网站大多可以直接从本地 DNS 缓存中读取解析结果，只有当我们是整个区域及运营商中访问某个冷门站点的第一个用户，才会最终到权威 DNS 上去查询站点的解析结果。这时候解析时间会远高于访问热门站点。（不懂的话，再去温习一下《<a href="https://www.cloudxns.net/Support/detail/id/737.html" target="_blank">从理论到实践，全方位认识DNS（理论篇）</a>》</p><p>如果 DNS 查询请求使用包含 ECS 信息（比如 192.168.1.0/24 ），那么 DNS 响应会返回一个 /0，即为每个人缓存。这代表每个子网的缓存结果都是独立的，如果你的子网中过去从未有人使用支持 EDNS 的本地 DNS 访问过某个网站，这意味着你将从头走一遍域名解析。</p><h3><a href="https://ephen.me/2017/PublicDns_2/#ECS-可能也并不能解决网络归属问题"></a>ECS 可能也并不能解决网络归属问题</h3><p>在 <a href="https://tools.ietf.org/html/rfc7871" target="_blank">RFC 7871</a> 中有提到，当增加 ECS 信息后将可能带来生日攻击（章节 11.2）。为了解决这个问题，当响应包中的 ECS 选项不够完整时，则应该被丢弃该 ECS 回复，即使请求中有 ECS 信息。</p><p>那么一旦这种例外的情况在用户的一般使用中出现，这个 DNS 便依然解决不了用户网络归属的问题。</p><h2><a href="https://ephen.me/2017/PublicDns_2/#结语"></a>结语</h2><p>事实上，网络延迟和 DNS 解析是网站访问中很重要但可能并不会明显拖慢速度的环节。我们仍可以综合考虑访问速度和安全等多方面来选择使用本地递归 DNS：净网大使选个优质的公共 DNS，懒癌患者就自动获取 DNS，某 DNS 的钟情粉丝就继续抱住你那家那位去吧。</p><p>要是你是个仅仅只追求速度的 Windows PC 用户，CloudXNS 提供的“<em><strong>一键优化 DNS 设置</strong></em>”（<a href="http://tools.cloudxns.net/DNS一键优化v1.0.16.919.zip" target="_blank">点击下载</a>）工具可以一用。</p>]]></content>
        
        <summary type="html">
            
            上一篇文章《使用公共 DNS 上网的弊端（一）》我讲到当我们使用公共 DNS 上网时可能会因为该 DNS 的出口与本地实际网络所属区域和运营商不一致而导致调度不准，进而影响连接速度可能变慢。这篇文章同时发到了咱们 CloudXNS 的微信公众号上，不少小伙伴与我们产生了互动。有
            
        </summary>
        
        <category term="知识探索"/>
        
        <category term="公共DNS"/>
        
        <category term="Public DNS"/>
        
        <category term="本地DNS"/>
        
        <category term="递归DNS"/>
        
        <category term="edns-client-subnet"/>
        
    </entry>
    
    <entry>
        <title>使用公共 DNS 上网的弊端（一）</title>
        <link href="https://ephen.me/2017/PublicDns_1/"/>
        <id>https://ephen.me/2017/PublicDns_1/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:23:09+00:00</published>
        <updated>2018-04-12T08:23:09+00:00</updated>
        
        <content type="html"><![CDATA[<p>作为资深网民的我们都知道，本地 DNS 是非常重要的，它能决定你到底能不能上网。</p><p>由于本地运营商 DNS 常常被大家诟病容易遭到劫持等风险，使得很多人选用公共 DNS 来作为本地上网用的 DNS ，例如 114DNS 、阿里 DNS 等。</p><p>但是，喜欢用公共 DNS 的你，知道公共 DNS 在上网时会有什么弊端吗？</p><a></a><h2><a href="https://ephen.me/2017/PublicDns_1/#智能-DNS-和-CDN-简介"></a>智能 DNS 和 CDN 简介</h2><p>中国国内的互联网环境复杂，跨地区跨运营商之间的网络延迟较大，所以出现有智能 DNS 和 CDN 来解决这个问题。我所在的公司，北京快网就是咱们国内一家老牌的 CDN 服务提供商；<a href="https://www.cloudxns.net" target="_blank">CloudXNS</a> 是一款智能 DNS 域名解析产品。</p><p>如果互联网站主财大气粗技术牛，在全国各地各运营商乃至全球都专门独立部署了站点，那么他可以通过智能 DNS 分区分运营商分别将域名解析到对应的站点；如果站主不具备这样多点部署的条件，那么他可以通过我们公司完成 CDN 的需求。</p><p>这就是智能 DNS 和 CDN 的最初的应用。</p><p>没错，就是【加速】。让北京联通的网民能访问到北京联通（或附近同运营商）的站点，广东电信访问到广东电信（或附近同运营商）的站点，从而达到加速的目的。</p><p>而智能 DNS 或 CDN 在调度判断网民归属时，是通过网民的本地 DNS 所属 IP 段来的。</p><p>所以，今天我要讨论到的公共 DNS 上网的弊端就是：<strong>它一定程度上违背了智能 DNS 和 CDN 加速的规则</strong>，变得不快了。</p><h2><a href="https://ephen.me/2017/PublicDns_1/#本地-DNS-和公共-DNS"></a>本地 DNS 和公共 DNS</h2><p>网民在访问网站时，其本地 DNS 会去请求网站地址，如果本地 DNS 没有，它会再向上级 DNS 请求查询。</p><p>公共 DNS 是由一些企业提供的本地 DNS 服务，通常会给用户提供一个或多个 Anycast IP ，但实际背后有多个集群服务。</p><p>当用户上网时，客户端会向这个集群中的 A 地址请求解析，这个 A 地址被称为 DNS 入口；智能 DNS 在判断网民用户来源时，会使用 DNS 集群中的 B 地址与 IP 库进行比对，这个 B 地址被称为 DNS 出口。</p><p>所以上网过程中，用户将从 DNS 入口获取解析，NS 服务器会向 DNS 出口分配智能解析。如果用户的 DNS 入口没有请求的解析缓存时，将向上级 DNS 请求查询，最终会请求到 NS 服务器，然后用户才获取到解析结果。</p><p>那么当用户的 DNS 入口和 DNS 出口和用户的实际网络不一致时，就可能导致智能 DNS 提供的解析结果并不是最优的。</p><h2><a href="https://ephen.me/2017/PublicDns_1/#测试示例"></a>测试示例</h2><p>北京快网官方门户网站<a href="http://www.fastweb.com.cn" target="_blank">www.fastweb.com.cn</a>使用了<a href="https://www.newdefend.com" target="_blank">牛盾云安全</a>作了页面加速和安全防护，正常情况下使用运营商 DNS 在全国各地的解析情况如下图所示：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6jg6knaoj20so1kiamt.jpg" /></p><p>这是通过智能 DNS 和 CDN 双剑合璧的最优解析结果。</p><p>例如灰姑娘所在地是湖北武汉，当使用本地运营商 DNS 并存在缓存时，<code>ping www.fastweb.com.cn</code>时延如下：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6k14va5wj20e408m753.jpg" /></p><p>而我在本地模拟<code>ping</code>浙江台州的牛盾节点<code>122.226.182.43</code>，会看到时延稍微长一些：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6khpng3wj20cr08bmxy.jpg" /></p><p>那么公共 DNS 的出入口会不会跟实际网络不一致呢？</p><h3><a href="https://ephen.me/2017/PublicDns_1/#公共-DNS-的入口"></a>公共 DNS 的入口</h3><p>以阿里 DNS 223.5.5.5 为例。</p><p>我在本地对阿里 DNS 的做了一个路由跟踪：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6kmxd3ocj20hz07k74x.jpg" /></p><p>可以发现，阿里 DNS 的入口在浙江杭州，而我本地网络是湖北电信。</p><h3><a href="https://ephen.me/2017/PublicDns_1/#公共-DNS-的出口"></a>公共 DNS 的出口</h3><p>刚刚和北京同事进行远程会议时提到这个议题，正好他的 PC 配置的是阿里公共 DNS ，我们让他访问<a href="http://tools.cloudxns.net/index/diag" target="_blank"> CloudXNS 运维工具 - 本地DNS优化诊断</a>获取其出口 DNS ，得到的反馈如下：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6o7hyn5qj20o80c9tbv.jpg" /></p><p>本地网络北京联通，出口 DNS 竟是广东电信，这远远比我前述举例的湖北电信和浙江电信的差距大得多。</p><h3><a href="https://ephen.me/2017/PublicDns_1/#解析影响验证"></a>解析影响验证</h3><p>该同事分别用阿里和运营商 DNS 对网易域名做了测试对比。</p><p><em>使用阿里 DNS 测试结果：</em></p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6ncoct3ej20hv0c8aec.jpg" /></p><p><em>使用运营商 DNS测试结果：</em></p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fi6o8uqn7bj20hc0cotd0.jpg" /></p><p>使用运营商 DNS 时，<code>ping</code>值快得多。</p>]]></content>
        
        <summary type="html">
            
            作为资深网民的我们都知道，本地 DNS 是非常重要的，它能决定你到底能不能上网。由于本地运营商 DNS 常常被大家诟病容易遭到劫持等风险，使得很多人选用公共 DNS 来作为本地上网用的 DNS ，例如 114DNS 、阿里 DNS 等。但是，喜欢用公共 DNS 的你，知道公共 
            
        </summary>
        
        <category term="知识探索"/>
        
        <category term="公共DNS"/>
        
        <category term="Public DNS"/>
        
        <category term="本地DNS"/>
        
        <category term="递归DNS"/>
        
    </entry>
    
    <entry>
        <title>什么情况下DNS会使用TCP传输协议？</title>
        <link href="https://ephen.me/2017/dns_tcp/"/>
        <id>https://ephen.me/2017/dns_tcp/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:22:45+00:00</published>
        <updated>2018-04-12T08:22:45+00:00</updated>
        
        <content type="html"><![CDATA[<p>我们知道， DNS 是同时占用 UDP 和 TCP 的 53 端口传输数据的，这种单个应用协议同时使用两种传输协议的情况，在 TCP/IP 栈中也算是个异类。</p><p>当我们在使用 tcpdump 、 WireShark 等抓包工具分析时，会发现几乎所有的 DNS 应用都是在使用 UDP 传输。</p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egy1fhmzsuvjvkj20x50gydjo.jpg" /></p><p>那么，为什么 DNS 还要占用 TCP 的端口，到底什么情况下才会用到 TCP 呢？</p><a></a><hr /><h2><a href="https://ephen.me/2017/dns_tcp/#一点基础知识"></a>一点基础知识</h2><p>TCP 全称 Transmission Control Protocol （传输控制协议）， UDP 全称 User Data Protocol （用户数据报协议），它们都是 OSI 七层模型中的传输层协议。灰姑娘大学时是网络工程专业的学渣，虽没学到个啥，但好巧不巧，就记得某些考题逢考必有。比如：</p><h3><a href="https://ephen.me/2017/dns_tcp/#TCP-和-UDP-的区别"></a>TCP 和 UDP 的区别</h3><table><thead><tr><th>特性</th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td>连接性</td><td>三次握手</td><td>不需要建立连接</td></tr><tr><td>可靠性</td><td>可靠，丢包会自动重传</td><td>不可靠</td></tr><tr><td>有序性</td><td>会对传输乱序的消息重新排列</td><td>可能乱序</td></tr><tr><td>传输速度</td><td>慢，因为要建立连接并保证可靠和有序</td><td>快</td></tr><tr><td>传输及控制</td><td>通过字节流传输，无界，有拥塞控制机制（慢开始、拥塞避免、快重传、快恢复）</td><td>数据包都是单独的，有界，不作拥塞控制</td></tr><tr><td>资源消耗</td><td>需要更多资源以传递更多信息，包头比较大（需要20字节）</td><td>头部只需8个字节</td></tr></tbody></table><p>通过上述区别，我们不难看出， TCP 主要应用在对可靠性比较高的场合，比如 Telnet 、 FTP 等；而 UDP 主要应用于实时性较高的场合，例如即时聊天。</p><h2><a href="https://ephen.me/2017/dns_tcp/#DNS-查询用的传输协议"></a>DNS 查询用的传输协议</h2><p>前面提到，一般我们看到的绝大多数 DNS 查询是用的 UDP 传输。</p><h3><a href="https://ephen.me/2017/dns_tcp/#域名解析时大多使用-UDP-协议"></a>域名解析时大多使用 UDP 协议</h3><p>客户端在请求一个域名的解析结果时，实际上需要经过重重 DNS 查询。（对 DNS 不太了解的童鞋可以先学下这个：<a href="https://www.cloudxns.net/Support/detail/id/737.html" target="_blank">从理论到实践，全方位认识DNS（理论篇）</a>）</p><p>一方面，要保证用户端的快速响应， TCP 的三次握手则过于繁冗；另一方面， DNS 解析查询即使出现异常，网民用户大不了重新申请一次查询，因而对可靠性的要求并没有那么高。</p><p>所以日常的域名解析需求使用 UDP 传输即可。</p><h3><a href="https://ephen.me/2017/dns_tcp/#具备特殊要求的域名解析使用-TCP-协议"></a>具备特殊要求的域名解析使用 TCP 协议</h3><p>由于UDP是按照数据包来传输的，整个包最大只能 512 字节。一般正常情况下，用来 DNS 查询是绰绰有余的。但当解析配置过于复杂，或者记录值过长（如： TXT 、 RRSIG 记录）使得 UDP 无法承载的情况下，就有必要转换 TCP 查询。</p><p>由于基于 TCP 的域名解析非常少见，大多数域名厂商是不支持的， <a href="https://www.cloudxns.net" target="_blank">CloudXNS</a> 也不例外。然而同域名同主机同线路的同类型解析将会封装到一个 UDP 包传输，如果内容过多（超过 512 字节），该数据包可能会承载不下。</p><p>这也是为什么 CloudXNS 中即使 A 、 TXT 、 MX 等类型记录尽管不与自身互斥，我们仍然会对同域名下同一主机同一线路限制解析记录条数的原因。</p><p>当然，国外的一些域名解析商这方面可能比我们严谨些，还是有一部分厂家是支持当数据过长时转用 TCP 传输的。比如：<a href="https://dns.he.net" target="_blank">He.Net</a></p><blockquote><p>我们来做个测试：</p></blockquote><ol><li>将<code>chinatesters.com</code>配置一个子域名<code>test</code>， NS 指向 He.net 的域名服务器。如图所示：<br /><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fho1ynuqb9j20tf0c1gmz.jpg" /></li><li>将<code>test.chinatesters.com</code>添加到 He.net 的域名控制面板，并添加一条 TXT 记录，值为<code>11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</code>（长度： 768 ）。如下图：<br /><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fho1yo40w8j20t70fgn18.jpg" /></li><li>配置生效后，使用<code>tcpdump</code>跟踪本地网卡的 53 端口，同时新开窗口用<code>dig</code>命令直接向<code>ns1.he.net</code>请求查询该 TXT 记录。</li></ol><p><em>DNS 查询记录：</em></p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /><span>19</span><br /><span>20</span><br /></pre></td><td><pre><span>#dig aaaaaaaaaa.test.chinatesters.com TXT @ns1.he.net</span><br /><span>;; Truncated, retrying in TCP mode.</span><br /><span></span><br /><span>; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6 &lt;&lt;&gt;&gt; aaaaaaaaaa.test.chinatesters.com TXT @ns1.he.net</span><br /><span>;; global options: +cmd</span><br /><span>;; Got answer:</span><br /><span>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 56555</span><br /><span>;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br /><span>;; WARNING: recursion requested but not available</span><br /><span></span><br /><span>;; QUESTION SECTION:</span><br /><span>;aaaaaaaaaa.test.chinatesters.com. INTXT</span><br /><span></span><br /><span>;; ANSWER SECTION:</span><br /><span>aaaaaaaaaa.test.chinatesters.com. 300 IN TXT&quot;111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;11&quot;</span><br /><span></span><br /><span>;; Query time: 221 msec</span><br /><span>;; SERVER: 216.218.130.2#53(216.218.130.2)</span><br /><span>;; WHEN: Tue Jul 18 13:58:50 2017</span><br /><span>;; MSG SIZE  rcvd: 833</span><br /></pre></td></tr></table><p><em>tcpdump 网卡跟踪记录：</em></p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fho1yoa28jj20l00dyq8f.jpg" /></p><p>查询记录结果的第一句便提示了<code>Truncated, retrying in TCP mode.</code>，表示启用了 TCP 协议查询。</p><p>网卡抓包也展示了<code>seq</code>、<code>ack</code>等 TCP 协议中的三次握手过程，最后返回了域名<code>aaaaaaaaaa.test.chinatesters.com.</code>的 TXT 记录值。</p><p>事实上，根据 <a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a> 章节 4.2 ，<strong>DNS 解析查询优先使用 UDP ，当 UDP 完成不了的情况下，则转换 TCP 查询</strong>。上述展示的就是这样的实例。</p><p>当看完 RFC 的这一章节，我们会发现，基于 TCP 协议的 DNS 应用还有一个更重要的作用。</p><h2><a href="https://ephen.me/2017/dns_tcp/#DNS-区域传送（zone-transfer）"></a>DNS 区域传送（zone-transfer）</h2><p>由于 DNS 服务器作为互联网基础设施，一般都会分布式的设置多台冗余备份，各个域名的配置在多个服务器之间的同步过程便被称之为区域传送。我在过去的文章《<a href="https://ephen.me/2016/dotkp-zone-dns-remove/">隔壁粗事了！朝鲜顶级域.kp域名DNS数据配置可被转移</a>》中提到过“区域传送”的概念，不太了解的童鞋可先查看下。</p><p>区域传送时，辅域名服务器将向主服务器拉取数据。该数据同步传送的量往往比较大且不容有失，该操作没有较高的时效性要求只需要隔段时间定时执行一遍即可。所以<strong>必须采用可靠性高的 TCP 传输协议</strong>。</p><p>CloudXNS 的 NS 服务器间的区域同步技术是公司自研的一套机制，虽然亦是使用的 TCP 传输，但由于专利技术保密，不便提供示例。下次咱们大概可以在搭建一套开源的 DNS 服务器的折腾过程中再引申下关于区域传送时应用 TCP 协议的知识。</p><h2><a href="https://ephen.me/2017/dns_tcp/#参考资料"></a>参考资料</h2><ol><li>《计算机网络（第五版）》.谢希仁</li><li><a href="https://tools.ietf.org/html/rfc1034" target="_blank">RFC 1034</a></li><li><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></li></ol>]]></content>
        
        <summary type="html">
            
            我们知道， DNS 是同时占用 UDP 和 TCP 的 53 端口传输数据的，这种单个应用协议同时使用两种传输协议的情况，在 TCP/IP 栈中也算是个异类。当我们在使用 tcpdump 、 WireShark 等抓包工具分析时，会发现几乎所有的 DNS 应用都是在使用 UDP
            
        </summary>
        
        <category term="知识探索"/>
        
        <category term="DNS"/>
        
        <category term="TCP"/>
        
        <category term="UDP"/>
        
        <category term="协议"/>
        
    </entry>
    
    <entry>
        <title>不会 A/B 测试的 Web 设计师不是好程序员</title>
        <link href="https://ephen.me/2015/AB-test/"/>
        <id>https://ephen.me/2015/AB-test/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:22:21+00:00</published>
        <updated>2018-04-12T08:22:21+00:00</updated>
        
        <content type="html"><![CDATA[<p>英文原文：<a href="https://shopifypartnerblog.myshopify.com/blogs/blog/74161923-how-a-b-testing-will-make-you-a-better-web-designer" target="_blank">How A/B Testing Will Make You a Better Web Designer</a></p><hr /><p>设计一个网站无论对设计者还是业主都是一个浩大的工程。但是，不管你是创建一个新的网站，还是对已有网站做重新设计，有一个至关重要的点，你的决定要基于数据而不是基于感觉。对客户和设计来说，在设计过程中做出的决定，可以决定创意，可以决定商业的成败。</p><p>为了避免你下一个作品中潜在的缺陷，你应该将 A/B 测试做为你设计工具的标准配置。对客户网站做简单的 A/B 测试可以让你交付之前避免设计，导航，功能上的任何缺陷。这样可以让你交出最终产品，不仅视觉效果极佳，还有优化的交互 – 他们会爱上你的。</p><p>听起来很有趣？继续阅读，看看 A/B 测试如果让你成为更好的 web 设计师。</p><a></a><h2><a href="https://ephen.me/2015/AB-test/#A-B-测试-101"></a>A/B 测试 101</h2><p>A/B 测试（又称分割测试），允许你在一个网站测试两个不同的测试元素，测试目的是判断哪种设计对完成特定目标是最有效的。</p><p>做 A/B 测试时，进入网站的用户会被随机分配到两个组：一半在“A 组”，另外一半在“B 组”。随后每组显示你选定的不同设计元素<strong> — </strong>例如，登录页面，商铺主题，响应按钮，或者结帐流程。</p><p><img src="https://static.oschina.net/uploads/img/201511/03163625_pzJH.jpg" /></p><p>通过对真实用户实时测试两组不同的设计元素，你可以收集成有意义的数据用来确定每个组的设计元素对访客行为的影响。这会给你更来设计洞察力，帮助你为客户创建最佳在线商业方案。</p><p><strong>从本质上讲，A/B 测试帮助你在每一个项目上设计出最好的网站。 </strong></p><h3><a href="https://ephen.me/2015/AB-test/#为什么-Web-设计者应该做-A-B-测试"></a>为什么 Web 设计者应该做 A/B 测试</h3><p>创建最好的网站应该就是你开始在设计项目中把 A/B 测试作为标准服务来提供的充分理由。不过如果你还不服气的话，下面也是你可以预见到的其它好处：</p><p><strong>1. 增加收入 </strong>— 通过将 A/B 测试当做一项服务涵盖到你的自由职业项目中，就能为你带来更多的项目收益。你既可以将其作为标准化服务包含到你的 web 设计包中，也可以利用其在网站优化方面的好处将其作为加钱项。你的客户会花费一个体面的金额以让他们的网站建设专业起来 — 把 A/B 测试作为一项后续服务来做出明智的设计修改，这样做将帮助他们获得收入的最大爆发(而你自己也能赚更多一点)。</p><p><strong>2. 减少客户纠纷 </strong>— 当扯到要为一个网站做出设计决定的时候，看起来房间里的每个人都对于网站应该怎么怎么样持有各自的观点 — 特别是为此花了钱的客户。幸运的是，A/B 测试为你提供了具体的数据来指导设计决定，并且无需得罪客户就能化解掉不必要的纠纷。</p><p><strong>3. 心满意足的客户 </strong>— 将所有精力集中到网站的视觉设计上而忽略其功能性目标这种事情是很容易发生的。然而大多数客户确实想要一个好看的最终产品，每个客户其实更关心那个网站的转化。运行 A/B 测试能向你的客户说明你是真正在关心他们业务的在线目标的，并且也希望尽力帮他们完成预期。</p><h3><a href="https://ephen.me/2015/AB-test/#如何设计一个简单-A-B-测试"></a>如何设计一个简单 A/B 测试</h3><p>如果之前从来没有运作过一次 web 优化实验，第一次的 A/B 测试看起来就会相当令人为难。但是不要担心，创造一个简单的 A/B 测试其实还是相当简单的。下面我会概述一种你可以开始尝试运作你的首次 A/B 测试的策略性方法。</p><h3><a href="https://ephen.me/2015/AB-test/#定义你的目标"></a>定义你的目标</h3><p>在你开始测试一些东西的时候，你需要去理解网站的目的。理解了网站的目的就能让你确定在量化的指标方面成功对于你的客户意味着什么。这些指标，也叫做转换，代表了你所期望的访问者将会在网站上进行的动作。通过及早定义目标和成功指标，你就为 A/B 测试将要执行的操作划定了一个框框。</p><p>你的转换指标将根据你所设计的网站的类型而有所不同。下面的表格概述了不同网站类型的常见转换指标：</p><p><img src="https://static.oschina.net/uploads/img/201511/03163625_wt9T.png" /></p><h3><a href="https://ephen.me/2015/AB-test/#识别瓶颈"></a>识别瓶颈</h3><p>为了让你的测试得到最好的结果，你需要识别过程通道中用户失去访问兴趣或者脱离通向转换路程的区域。这些障碍被称为瓶颈。就是这些瓶颈对你的网站的表现产生了消极的影响，也就是你想要运作 A/B 测试的地方。</p><p><img src="https://static.oschina.net/uploads/img/201511/03163625_dHcG.jpg" /></p><p>如果你在客户的商店中设置了 Google Analytics，其内置的转换跟踪可以提供相对简单的方式来识别用户体验中潜在的瓶颈，可以在分析管理界面中设定你的转换目标，通过定义一些用户走向转换的过程中的事件和页面就可以简单地创建一个转换通道。</p><p>电子商务网站上常见的一个简单转换通道示例应该是这样的: “放到购物车” 到 “查看购物车”到“下单” 到 “选择支付方式” 到最后 “订单确认”。这里有一个 <a href="https://support.google.com/analytics/answer/1032415?hl=en" target="_blank">很棒的指南</a> 能帮助你开始在 Analytics 上进行转换跟踪，另外还有一个能帮助你进行更多 <a href="https://docs.shopify.com/support/other/general-information/google-analytics-goals-and-funnels" target="_blank">高级的通道转换跟踪</a> 的设置。</p><p>一旦你设置好了转换目标和通道，你就能够使用 Google Analytics 的“Goals“找到的“Goal Flow”报告来识别瓶颈了。通过对造成最多门槛和用户退出的事件和页面进行高亮显示，这份报告能够帮助你着力于对测试最有益的区域。</p><p><strong><img src="https://static.oschina.net/uploads/img/201511/03163626_Q0qY.jpg" /></strong></p><h3><a href="https://ephen.me/2015/AB-test/#创建一个假设"></a>创建一个假设</h3><p>一旦你确认了目标并识别除了瓶颈，你就应该创建一个你确信的假设，有关于对站点的设计修改会改变访问者行为的。这会使得你的测试更具价值，因为它想过程中加入了一层目的，确保你仍在保持对于整个测试目标实现过程的跟踪。</p><p><strong>例如，假设你的客户的最终目标是降低网站的购物车放弃率。你已经完成了调查并识别出影响现有比率的瓶颈在于出现在”结算信息“页面之后而在”确认“页面之前的”传递信息“页面。在这种情况下，你的假设可以像下面这样：</strong></p><p><strong>“如果我们通过将计费和传递信息页面整合成一个页面来缩短结账流程，那么整体的购物车放弃率将会降低。”</strong></p><p>如果你在没有创建一个假设的情况下去尝试运作一次测试，你还是会收集到关于访问者有价值的数据。不过不幸的是，你会错过对于诸如为什么结果是他们这样做了这种问题的更深层次的分析和验证。即使你的测试失败了，你还是能够从实验中得出一些结论。实验的妙处在于，在整个站点上的实现之前放弃那些不起作用的想法。</p><h3><a href="https://ephen.me/2015/AB-test/#设计一些修改版本"></a>设计一些修改版本</h3><p>在你可以去实践你的实验之前，你需要针对你所测试的特定的设计元素创建修改版本。元素原来的版本是控制版本，而新的版本都是这个控制版本的变化版本。</p><p><img src="https://static.oschina.net/uploads/img/201511/03163626_7iGu.jpg" /></p><p>为了开发出最准确和公正的 A/B 测试，要确保新的版本中只有控制变量其中之一被修改了。例如，你可以测试一个号召性按钮(如前所述)的颜色，或者其在页面上的位置，但不能同时测试。将你的测试限制于单一变量确保了你可以放心地将行为所发生的变化归因于做出了设计修改的变量<strong>。</strong></p><h3><a href="https://ephen.me/2015/AB-test/#开始测试"></a>开始测试</h3><p>瓶颈确认而且构建了设计变量，你几乎就已经准备好运作你的A/B测试了。为了确保你的测试能提供最精确的结果，你会想要确保下面两件事情发生在实现期：</p><p>1. 向一组随机选择的站点访问者分组同时展示你的变量和控制版本的元素.</p><p>2. 将你的测试运行足够长的时间，那样它就能展示尽可能最大数量的样本.</p><p>遵循这两项准则将有助于确保实验提供了统计上最显著的可能结果。那样，你就可以对你所使用的数据放心了，因为你所做出的最终设计决定的基础是可靠和精确的。</p><p>对于初学者要在他们的站点——不管它是不是在 Shopify 上 ——上开始实现一次 A/B 测试最容易的方法就是使用 A/B 实验工具. 有各种工具可以供你用来在网站上进行 A/B 测试, 而我建议你先从 <a href="https://optimizely.com/" target="_blank">Optimizely</a>, <a href="https://unbounce.com/" target="_blank">unbounce</a>, 或者 <a href="https://www.google.com/analytics/standard/features/" target="_blank">Google Analytics Content Experiments</a> 开始.</p><p><strong>还有如果你在找一些额外的资源作为入门资料, 可以看看这些综合指南:</strong></p><ul><li><a href="https://www.shopify.ca/blog/12385217-the-beginners-guide-to-simple-a-b-testing" target="_blank">简单的 A/B 测试入门指南</a></li><li><a href="https://blog.optimizely.com/2013/03/08/ab-testing-and-website-redesigns/" target="_blank">A/B 测试和网站重新设计</a></li><li><a href="https://blog.optimizely.com/2013/04/30/71-things-to-ab-test/" target="_blank">A/B 测试有关的71件事</a></li></ul><h2><a href="https://ephen.me/2015/AB-test/#成为一名更好的web设计者"></a>成为一名更好的web设计者</h2><p>最成功的网站设计者知道网站的交接仅仅只是开始而已. 每一个单独的项目都能带来几乎无穷尽的实践和优化的机会. 通过把 A/B 测试当做你的标准设计包中提供的一项服务, 就将能够提高收入，帮助你的客户达成更好的商务业绩, 并构建出一个你可以真正为之骄傲的网站.</p><p>你还在等什么呢? 马上开始测试踏上你成为更好的 web 设计者的征途吧。</p><p>此文为转载，原文链接：<a href="https://www.oschina.net/translate/how-a-b-testing-will-make-you-a-better-web-designer" target="_blank">https://www.oschina.net/translate/how-a-b-testing-will-make-you-a-better-web-designer</a></p>]]></content>
        
        <summary type="html">
            
            英文原文：How A/B Testing Will Make You a Better Web Designer设计一个网站无论对设计者还是业主都是一个浩大的工程。但是，不管你是创建一个新的网站，还是对已有网站做重新设计，有一个至关重要的点，你的决定要基于数据而不是基于感觉。对
            
        </summary>
        
        <category term="知识探索"/>
        
        <category term="测试"/>
        
        <category term="程序员"/>
        
        <category term="设计师"/>
        
    </entry>
    
    <entry>
        <title>VSCode 中使用 PlantUML 插件生成 UML</title>
        <link href="https://ephen.me/2017/VSCode_PlantUML/"/>
        <id>https://ephen.me/2017/VSCode_PlantUML/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:21:57+00:00</published>
        <updated>2018-04-12T08:21:57+00:00</updated>
        
        <content type="html"><![CDATA[<p>作为一个伪技术人员，灰姑娘用的 IDE 大概是不那么流行的 <a href="https://code.visualstudio.com/" target="_blank">VSCode</a>。全称 Visual Studio Code ，微软家近两年才推出来的一个产品。</p><p>这个 IDE 的整个软件界面以及使用都和 <a href="https://atom.io/" target="_blank">Atom</a> 非常相像，它本身比较轻量，但又可以安装很多扩展插件以满足使用者的需要。虽然对过去使用老古董 <a href="https://www.ultraedit.com/" target="_blank">Ultra Edit</a> 的我来说，刚上手着实有些不习惯，但是用久了之后还是觉得不错的。（尽管我用 IDE 的频率不高。。</p><p>最近，同事希望我给 DNS 解析流程画个 UML 图，并推荐了一个通过脚本语言生成 UML 图的开源项目： <a href="http://plantuml.com/" target="_blank">PlantUML</a> 。</p><p>上网搜索后发现，可以不需要下载这个项目的 APP ，很多编辑器都有它的插件。但是我翻了好久，并没有看到基于 VSCode 的实际应用示例。</p><p>我在 VSCode 上搜到这个扩展插件之后，环境部署还很折腾了一会儿。遂将一些经验在此分享给大家，希望能对其他路过的人有所帮助。</p><a></a><h2><a href="https://ephen.me/2017/VSCode_PlantUML/#环境配置"></a>环境配置</h2><p>PlantUML 本身只是一个脚本语言，如果要生成图片，是基于 <a href="http://www.graphviz.org/" target="_blank">GraphViz</a> 绘图的。而 GraphViz 又是基于 dot 脚本生成图片，它依赖于 Java 和 Dot 脚本环境的配置。</p><p>所以，使用 PlantUML 有如下基本环境要求：</p><h3><a href="https://ephen.me/2017/VSCode_PlantUML/#1-安装-Java-环境"></a>1.安装 Java 环境</h3><p>上官网下载后安装：<a href="https://www.java.com/zh_CN/" target="_blank">https://www.java.com/zh_CN/</a></p><p>注意配置 <code>$JAVA_HOME</code> 环境变量。</p><p>配置完毕后启动 Windows Shell 执行 <code>java -showversion</code> 命令查看 Java 版本，以确定 Java 环境是否准备成功。</p><h3><a href="https://ephen.me/2017/VSCode_PlantUML/#2-安装-GraphViz-程序"></a>2.安装 GraphViz 程序</h3><p>下载地址：<a href="http://www.graphviz.org/Download_windows.php" target="_blank">http://www.graphviz.org/Download_windows.php</a></p><p>下载安装完后（灰姑娘将其安装到了 D 盘路径：<code>D:/program files/Graphviz/</code>下），也要配置环境变量。</p><p>将 GraphViz 可执行程序路径配置到 <code>$path</code>：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fivz9yuncfj20tc0g1gmq.jpg" /></p><p><strong>后面的所有配置（ dot 配置和 VSCode 插件配置）都是基于 GraphViz 的安装路径，需要参照的小伙伴请注意。</strong></p><h3><a href="https://ephen.me/2017/VSCode_PlantUML/#3-配置-Dot-脚本环境"></a>3.配置 Dot 脚本环境</h3><p>添加环境变量 <code>$GRAPHVIZ_DOT</code>。如下图所示：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fivz9yr0vkj20ij05aq33.jpg" /></p><p>配置完毕后启动 Windows Shell 执行 <code>dot -v</code> 命令查看 Dot 版本，以确定 GraphViz 和 Dot 环境是否准备成功。</p><h3><a href="https://ephen.me/2017/VSCode_PlantUML/#4-安装-VSCode-插件并配置"></a>4.安装 VSCode 插件并配置</h3><p>VSCode 需要安装两个插件： <code>PlantUML</code> 和  <code>Graphviz Preview</code></p><p>打开 VSCode 切换到左侧扩展商店，搜索并安装他们，安装完毕后分别激活。</p><p>点击 VSCode 左下角齿轮按钮进入设置，在用户设置脚本中添加 <code>&quot;graphviz-preview.dotPath&quot;: &quot;D:/program files/Graphviz/bin/dot.exe&quot;</code> 并保存设置：</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fivz9yzs9uj218m0ea0ub.jpg" /></p><h3><a href="https://ephen.me/2017/VSCode_PlantUML/#5-环境配置测试"></a>5.环境配置测试</h3><p><strong>重启 VSCode 。</strong></p><p>新建文档输入以下测试代码：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /></pre></td><td><pre><span>@startuml</span><br /><span></span><br /><span>[*] --&gt; State1</span><br /><span>State1 --&gt; [*]</span><br /><span>State1 : this is a string</span><br /><span>State1 : this is another string</span><br /><span></span><br /><span>State1 -&gt; State2</span><br /><span>State2 --&gt; [*]</span><br /><span></span><br /><span>@enduml</span><br /></pre></td></tr></table><p>同时按下 <code>Alt</code> 键和字母 <code>D</code> 键，预览生成的 UML 状态图。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fivzlgvfi1j208c07nglj.jpg" /></p><p>如果出现如图所示的错误，检查下是不是前面 GraphViz 安装和配置没做好。</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fivz9yx1ejj208o067jst.jpg" /></p><h2><a href="https://ephen.me/2017/VSCode_PlantUML/#分享：-DNS-解析流程图"></a>分享： DNS 解析流程图</h2><p>为了画这个图，灰姑娘专门去学了下这个脚本语言。如果小伙伴们也想学习，官方中文指导手册在这里：<a href="http://translate.plantuml.com/zh/PlantUML_Language_Reference_Guide_ZH.pdf" target="_blank">点击下载</a>。除此之外，<a href="http://www.jianshu.com/p/e92a52770832" target="_blank">这里</a> 还有网友分享的快速入门教程。</p><p>回到正题，我的目的是要画个 DNS 解析流程图。</p><p>最后图是勉强画出来了，看看画得咋样？</p><p><img src="https://ws1.sinaimg.cn/large/5ebd877egy1fochhkdvcsj20nx0pmq51.jpg" /></p><p>上图源代码分享如下：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /><span>7</span><br /><span>8</span><br /><span>9</span><br /><span>10</span><br /><span>11</span><br /><span>12</span><br /><span>13</span><br /><span>14</span><br /><span>15</span><br /><span>16</span><br /><span>17</span><br /><span>18</span><br /><span>19</span><br /><span>20</span><br /><span>21</span><br /><span>22</span><br /><span>23</span><br /><span>24</span><br /><span>25</span><br /><span>26</span><br /><span>27</span><br /><span>28</span><br /><span>29</span><br /><span>30</span><br /><span>31</span><br /><span>32</span><br /><span>33</span><br /><span>34</span><br /><span>35</span><br /><span>36</span><br /><span>37</span><br /><span>38</span><br /><span>39</span><br /><span>40</span><br /><span>41</span><br /><span>42</span><br /><span>43</span><br /><span>44</span><br /><span>45</span><br /><span>46</span><br /><span>47</span><br /><span>48</span><br /><span>49</span><br /><span>50</span><br /><span>51</span><br /><span>52</span><br /><span>53</span><br /><span>54</span><br /></pre></td><td><pre><span>@startuml</span><br /><span>title 域名解析流程图</span><br /><span>skinparam <span>state</span> {</span><br /><span>  StartColor MediumBlue</span><br /><span>  EndColor Red</span><br /><span>  BorderColor Gray</span><br /><span>  ArrowColor Gray</span><br /><span>  ArrowFontColor Indigo</span><br /><span>  BackgroundColor&lt;&lt;Request&gt;&gt; AliceBlue</span><br /><span>  BackgroundColor&lt;&lt;Answer&gt;&gt; HotPink</span><br /><span>}</span><br /><span></span><br /><span><span>state</span> UserClient {</span><br /><span>    [*] --&gt; 请求访问域名</span><br /><span>    请求访问域名 --&gt; 本机host</span><br /><span>    本机host -right-&gt; 成功访问域名 : 有映射</span><br /><span>    本机host --&gt; 本机DNS解析器 : 没有映射</span><br /><span>    本机DNS解析器 -up-&gt; 成功访问域名 : 有缓存</span><br /><span>    成功访问域名 --&gt; 本机DNS解析器 : 缓存更新</span><br /><span>    本机DNS解析器 --&gt; [*]</span><br /><span>    note left : 本图展示正常解析流程\n未成功访问域名不能结束\n（最左支路径无效）</span><br /><span>    </span><br /><span>    <span>state</span> 请求访问域名 : ephen.me.</span><br /><span>    <span>state</span> 请求访问域名&lt;&lt;Request&gt;&gt;</span><br /><span>    <span>state</span> 本机host : Windows 目录：</span><br /><span>    <span>state</span> 本机host : C:\Windows\System32\drivers\etc</span><br /><span>    <span>state</span> 成功访问域名 : ephen.me.</span><br /><span>    <span>state</span> 成功访问域名&lt;&lt;Answer&gt;&gt;</span><br /><span>    <span>state</span> 本机DNS解析器 : Windows 查看命令：</span><br /><span>    <span>state</span> 本机DNS解析器 : ipconfig /displaydns</span><br /><span>}</span><br /><span></span><br /><span><span>state</span> DNSServer {</span><br /><span>    本机DNS解析器 -right-&gt; 本地DNS : 没有缓存</span><br /><span>    本地DNS -right-&gt; 根域名服务器 : 没有解析</span><br /><span>    本地DNS -left-&gt; 成功访问域名 : 有解析</span><br /><span>    根域名服务器 --&gt; 顶级域名服务器</span><br /><span>    顶级域名服务器 --&gt; 域名服务器</span><br /><span>    域名服务器 --&gt; 本地DNS : 获取结果并缓存</span><br /><span></span><br /><span>    <span>state</span> 本地DNS : 用户配置（<span>8.8</span>.<span>8.8</span>）</span><br /><span>    <span>state</span> 根域名服务器 : a.root-servers.net.</span><br /><span>    <span>state</span> 根域名服务器 : b.root-servers.net.</span><br /><span>    <span>state</span> 根域名服务器 : ...</span><br /><span>    <span>state</span> 根域名服务器 : m.root-servers.net.</span><br /><span>    <span>state</span> 顶级域名服务器 : a<span>0</span>.nic.me.</span><br /><span>    <span>state</span> 顶级域名服务器 : b<span>0</span>.nic.me.</span><br /><span>    <span>state</span> 顶级域名服务器 : ...</span><br /><span>    <span>state</span> 域名服务器 : lv3ns1.ffdns.net.</span><br /><span>    <span>state</span> 域名服务器 : lv3ns2.ffdns.net.</span><br /><span>    <span>state</span> 域名服务器 : lv3ns3.ffdns.net.</span><br /><span>    <span>state</span> 域名服务器 : lv3ns4.ffdns.net.</span><br /><span>}</span><br /><span>@enduml</span><br /></pre></td></tr></table><p>希望我的分享能对路过这儿的你能有所帮助。</p>]]></content>
        
        <summary type="html">
            
            作为一个伪技术人员，灰姑娘用的 IDE 大概是不那么流行的 VSCode。全称 Visual Studio Code ，微软家近两年才推出来的一个产品。这个 IDE 的整个软件界面以及使用都和 Atom 非常相像，它本身比较轻量，但又可以安装很多扩展插件以满足使用者的需要。虽然
            
        </summary>
        
        <category term="工具介绍"/>
        
        <category term="VSCode"/>
        
        <category term="UML"/>
        
        <category term="解析流程"/>
        
    </entry>
    
    <entry>
        <title>Jmeter以non-gui模式进行分布式测试</title>
        <link href="https://ephen.me/2016/Jmeter-NonGUI-Test/"/>
        <id>https://ephen.me/2016/Jmeter-NonGUI-Test/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:21:22+00:00</published>
        <updated>2018-04-12T08:21:22+00:00</updated>
        
        <content type="html"><![CDATA[<p>由于Jmeter是一个纯JAVA的应用，用GUI模式运行压力测试时，对客户端的资源消耗是相当惊人的，所以在进行正式的压测时一定要使用non-gui模式运行，如果并发数很高或者客户端的硬件资源比较一般的话，还可以以server模式用多个client进行分布式测试。</p><p>下面以武汉快网CMCC项目为例，结合官方文档和自己的实际经验来谈一谈，Jmeter如何以non-gui模式进行分布式测试。</p><a></a><h2><a href="https://ephen.me/2016/Jmeter-NonGUI-Test/#前置工作"></a>前置工作</h2><h3><a href="https://ephen.me/2016/Jmeter-NonGUI-Test/#linux下安装jdk1-7"></a>linux下安装jdk1.7</h3><p>负载机使用的是CentOS 6.7版本的linux系统， 自带有OpenJDK runtime environment (openjdk),它是一个在linux上实现开源的java 平台。</p><p>1 . <strong>查看CentOs自带的JDK是否已安装</strong>，输入：<code>yum list installed |grep java</code></p><p><img src="https://ww2.sinaimg.cn/large/5ebd877egw1f62ifp6gm4j20h902p3ze.jpg" /></p><p>2 . 若有自带安装的JDK，则表示JAVA环境已经安装成功，可以<strong>查看安装的java版本信息</strong></p><p>输入：<code>java -version</code>可查看Java版本；</p><p><img src="https://ww4.sinaimg.cn/large/5ebd877egw1f62ifpdpr1j20f602sdgl.jpg" /></p><p>3 . 如果想<strong>卸载CentOS系统自带Java环境</strong>，可输入：<code>yum -y remove java1.7.0-openjdk*</code> （*表示卸载掉java1.7.0的所有openjdk相关文件）</p><p>4 . <strong>卸载tzdata-java</strong>输入：<code>yum -y remove tzdatajava.noarch</code>，当结果显示为Complete,即卸载完毕。</p><p>5 . <strong>检查CentOS系统网络连接是否正常</strong>。</p><p>使用yum方式安装需要连接网络下载相应安装文件，故需要使用ping命令测试网络，如<code>ping www.baidu.com</code></p><p><img src="https://ww2.sinaimg.cn/large/5ebd877egw1f62ifpkty0j20gm06j0vw.jpg" /></p><p>6 . <strong>查看yum库中的java安装包</strong>，输入：<code>yum -y list java*</code></p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egw1f62ifpajjyj20ea0c3jv6.jpg" /></p><p>7 . <strong>使用yum安装java环境</strong>，输入：<code>yum -y install java1.7.0-openjdk*</code>，当结果显示为Complete，即安装完毕。</p><h3><a href="https://ephen.me/2016/Jmeter-NonGUI-Test/#安装JMeter"></a>安装JMeter</h3><p>安装好java环境，就可以在此基础之上安装jmeter。</p><p>1 . <strong>将jmeter安装包上传到服务器指定目录</strong>，比如：<code>/root/mobile/</code></p><p>2 . <strong>解压zip安装包</strong>，输入：<code>unzip apache-jmeter-2.13.zip</code></p><p><img src="https://ww4.sinaimg.cn/large/5ebd877egw1f62ifp9xi2j20g803pt9r.jpg" /></p><h2><a href="https://ephen.me/2016/Jmeter-NonGUI-Test/#非GUI模式下运行Jmeter"></a>非GUI模式下运行Jmeter</h2><p>JMeter远程测试原理图如下：</p><p><img src="https://ww4.sinaimg.cn/large/5ebd877egw1f62ifpgkhfj20ba078glt.jpg" /></p><p>如果运行JMeter客户端的机器性能不能满足测试需要，那么测试人员可以通过单个JMeter客户端来控制多个远程JMeter服务器，以便对服务器进行压力测试，模拟足够多的并发用户。通过远程运行JMeter，测试人员可以跨越多台低端计算机复制测试，这样就可以模拟一个比较大的服务器压力。</p><p>用一台机器（称为JMeter客户端）上的jmeter同时启动另外几台机器（称为JMeter远程服务器）上的jmeter。</p><p>1 . 保证jmeter客户端和jmeter远程服务器采用相同版本的jmeter和JVM。<br />2 . jmeter客户端和jmeter远程服务器最好在同一个网段内。<br />3 . 在jmeter远程服务器上运行<code>root/mobile/apache/jmeter-2.13/bin/jmeter-servere</code>脚本。指定server的ip，如：<code>./jmeter-server -Djava.rmi.server.hostname=118.192.6.15</code>，jmeter-server正常启动会提示”创建远程服务”<br />4 . 在jmeter客户端上修改<code>/bin/jmeter.properties</code>文件，找到属性<code>&quot;remote_hosts&quot;</code>，使用JMeter远程服务器的IP地址作为其属性值。可以添加多个服务器的IP地址，以逗号作为分隔。</p><p><img src="https://ww1.sinaimg.cn/large/5ebd877egw1f62ifpzoddj20nu0nydsv.jpg" /></p><p>例如：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /></pre></td><td><pre><span>remote_hosts=118.192.6.15:1099,118.192.6.16:1099   #RMI port to be used by the server (must start rmiregistry with same port)</span><br /><span>server_port=1099</span><br /></pre></td></tr></table><p><img src="https://ww1.sinaimg.cn/large/5ebd877egw1f62ifpjpbyj20ic05bta6.jpg" /></p><p>5 . 在jmeter客户端上启动jmeter。</p><table><tr><td><pre><span>1</span><br /></pre></td><td><pre><span>./jmeter -n -t plan.jmx -l result.jtl -r</span><br /></pre></td></tr></table><p><code>plan.jmx</code>测试计划可以在windows环境下先创建，最好不要添加监听器，应为命令行启动的话监听器可能会占用资源而且有没有任何视图效果。</p><blockquote><p>参数说明 :</p><p>-n  告诉jmeter使用nogui模式运行测试</p><p>-t  执行的测试脚本名</p><p>-l  后面跟着测试结果记录的路径与文件名 </p><p>-r  表示远程启动 (remote) </p><p>jmeter客户端会自动向jmeter远程服务器上分发测试计划。<br />最后，可以将result.jtl结果文件下载到windows机上在不同的监听器上分析测试结果。</p></blockquote>]]></content>
        
        <summary type="html">
            
            由于Jmeter是一个纯JAVA的应用，用GUI模式运行压力测试时，对客户端的资源消耗是相当惊人的，所以在进行正式的压测时一定要使用non-gui模式运行，如果并发数很高或者客户端的硬件资源比较一般的话，还可以以server模式用多个client进行分布式测试。下面以武汉快网C
            
        </summary>
        
        <category term="工作笔记"/>
        
        <category term="测试"/>
        
        <category term="Jmeter"/>
        
    </entry>
    
    <entry>
        <title>DNS资源记录（Resource Record，简称RR）介绍</title>
        <link href="https://ephen.me/2016/dns-rr/"/>
        <id>https://ephen.me/2016/dns-rr/</id>
        
        <author>
            <name>Ephen</name>
        </author>
        
        <published>2018-04-12T08:21:11+00:00</published>
        <updated>2018-04-12T08:21:11+00:00</updated>
        
        <content type="html"><![CDATA[<h2><a href="https://ephen.me/2016/dns-rr/#DNS-资源记录简介"></a>DNS 资源记录简介</h2><p>DNS server 内的每一个域名都有自己的域文件(zone file)，zone file 是由多个记录组成的，每一个记录就被称为资源记录(Resource Record，简称RR)。</p><p>当在设定 DNS 域名解析、反向解析及其他的管理目的时，往往需要使用不同类型的RR，也就是我们常说的<a href="https://www.cloudxns.net/Support/detail/id/54.html" target="_blank">记录类型</a>。</p><p>上述CloudXNS的记录类型列表中，除AX、CNAMEX、LINK、DR301X（301跳转）、DR302X（302跳转）以及DRHIDX（隐式跳转）为CloudXNS自研的<a href="https://www.cloudxns.net/Index/Extend.html" target="_blank">扩展解析记录类型</a>之外，其余都是 DNS 体系中常见的标准RR类型。</p><p>但除了我们系统中支持的这些类型外，事实上还有一些不太常用的目前CloudXNS暂不支持的其他RR类型，感兴趣的朋友可以和灰姑娘一起学习下。</p><a></a><h2><a href="https://ephen.me/2016/dns-rr/#DNS-体系中的标准RR类型及表示法集合"></a>DNS 体系中的标准RR类型及表示法集合</h2><table><thead><tr><th>类型</th><th>RFC来源</th><th>描述</th><th>功能</th></tr></thead><tbody><tr><td>A</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>IP 地址记录</td><td>传回一个 32 比特的 IPv4 地址，最常用于映射主机名称到IP地址，但也用于 DNSBL（<a href="https://tools.ietf.org/html/rfc1101" target="_blank">RFC 1101</a>）等。</td></tr><tr><td>AAAA</td><td><a href="https://tools.ietf.org/html/rfc3596" target="_blank">RFC 3596</a></td><td>IPv6 IP 地址记录</td><td>传回一个 128 比特的 IPv6 地址，最常用于映射主机名称到 IP 地址。</td></tr><tr><td>AFSDB</td><td><a href="https://tools.ietf.org/html/rfc1183" target="_blank">RFC 1183</a></td><td>AFS文件系统</td><td>（Andrew File System）数据库核心的位置，于域名以外的 AFS 客户端常用来联系 AFS 核心。这个记录的子类型是被过时的<a href="https://zh.wikipedia.org/wiki/DCE/DFS" target="_blank">DCE/DFS</a>（DCE Distributed File System）所使用。</td></tr><tr><td>APL</td><td><a href="https://tools.ietf.org/html/rfc3123" target="_blank">RFC 3123</a></td><td>地址前缀列表</td><td>指定地址列表的范围，例如：CIDR 格式为各个类型的地址（试验性）。</td></tr><tr><td>CERT</td><td><a href="https://tools.ietf.org/html/rfc4398" target="_blank">RFC 4398</a></td><td>证书记录</td><td>存储 PKIX、SPKI、PGP等。</td></tr><tr><td>CNAME</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>规范名称记录</td><td>一个主机名字的别名：域名系统将会继续尝试查找新的名字。</td></tr><tr><td>DHCID</td><td><a href="https://tools.ietf.org/html/rfc4701" target="_blank">RFC 4701</a></td><td>DHCP（动态主机设置协议）识别码</td><td>用于将 FQDN 选项结合至 DHCP。</td></tr><tr><td>DLV</td><td><a href="https://tools.ietf.org/html/rfc4431" target="_blank">RFC 4431</a></td><td>DNSSEC（域名系统安全扩展）来源验证记录</td><td>为不在DNS委托者内发布DNSSEC的信任锚点，与 DS 记录使用相同的格式，<a href="https://tools.ietf.org/html/rfc5074" target="_blank">RFC 5074</a>介绍了如何使用这些记录。</td></tr><tr><td>DNAME</td><td><a href="https://tools.ietf.org/html/rfc2672" target="_blank">RFC 2672</a></td><td>代表名称</td><td>DNAME 会为名称和其子名称产生别名，与 CNAME 不同，在其标签别名不会重复。但与 CNAME 记录相同的是，DNS将会继续尝试查找新的名字。</td></tr><tr><td>DNSKEY</td><td><a href="https://tools.ietf.org/html/rfc4034" target="_blank">RFC 4034</a></td><td>DNS 关键记录</td><td>于DNSSEC内使用的关键记录，与 KEY 使用相同格式。</td></tr><tr><td>DS</td><td><a href="https://tools.ietf.org/html/rfc4034" target="_blank">RFC 4034</a></td><td>委托签发者</td><td>此记录用于鉴定DNSSEC已授权区域的签名密钥。</td></tr><tr><td>HIP</td><td><a href="https://tools.ietf.org/html/rfc5205" target="_blank">RFC 5205</a></td><td>主机鉴定协议</td><td>将端点标识符及IP 地址定位的分开的方法。</td></tr><tr><td>IPSECKEY</td><td><a href="https://tools.ietf.org/html/rfc4025" target="_blank">RFC 4025</a></td><td>IPSEC 密钥</td><td>与 IPSEC 同时使用的密钥记录。</td></tr><tr><td>KEY</td><td><a href="https://tools.ietf.org/html/rfc2535" target="_blank">RFC 2535</a> 和 <a href="https://tools.ietf.org/html/rfc2930" target="_blank">RFC 2930</a></td><td>关键记录</td><td>只用于 SIG(0)（<a href="https://tools.ietf.org/html/rfc2931" target="_blank">RFC 2931</a>）及 TKEY（<a href="https://tools.ietf.org/html/rfc2930" target="_blank">RFC 2930</a>。<a href="https://tools.ietf.org/html/rfc3455" target="_blank">RFC 3455</a> 否定其作为应用程序键及限制DNSSEC的使用。<a href="https://tools.ietf.org/html/rfc3755" target="_blank">RFC 3755</a> 指定了 DNSKEY 作为DNSSEC的代替。</td></tr><tr><td>LOC</td><td><a href="https://tools.ietf.org/html/rfc1876" target="_blank">RFC 1876</a></td><td>位置记录</td><td>将一个域名指定地理位置。</td></tr><tr><td>MX</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>电邮交互记录</td><td>引导域名到该域名的邮件传输代理（MTA, Message Transfer Agents）列表。</td></tr><tr><td>NAPTR</td><td><a href="https://tools.ietf.org/html/rfc3403" target="_blank">RFC 3403</a></td><td>命名管理指针</td><td>允许基于正则表达式的域名重写使其能够作为 URI 、进一步域名查找等。</td></tr><tr><td>NS</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>名称服务器记录</td><td>委托 DNS 域（DNS zone）使用已提供的权威域名服务器。</td></tr><tr><td>NSEC</td><td><a href="https://tools.ietf.org/html/rfc4034" target="_blank">RFC 4034</a></td><td>下一代安全记录</td><td>DNSSEC 的一部分; 用来验证一个未存在的服务器，使用与 NXT（已过时）记录的格式。</td></tr><tr><td>NSEC3</td><td><a href="https://tools.ietf.org/html/rfc5155" target="_blank">RFC 5155</a></td><td>NSEC 记录第三版</td><td>用作允许未经允许的区域行走以证明名称不存在性的 DNSSEC 扩展。</td></tr><tr><td>NSEC3PARAM</td><td><a href="https://tools.ietf.org/html/rfc5155" target="_blank">RFC 5155</a></td><td>NSEC3 参数</td><td>与 NSEC3 同时使用的参数记录。</td></tr><tr><td>PTR</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>指针记录</td><td>引导至一个规范名称（Canonical Name）。与 CNAME 记录不同，DNS“不会”进行进程，只会传回名称。最常用来运行反向 DNS 查找，其他用途包括引作DNS-SD。</td></tr><tr><td>RRSIG</td><td><a href="https://tools.ietf.org/html/rfc4034" target="_blank">RFC 4034</a></td><td>DNSSEC 证书</td><td>DNSSEC 安全记录集证书，与 SIG 记录使用相同的格式。</td></tr><tr><td>RP</td><td><a href="https://tools.ietf.org/html/rfc1183" target="_blank">RFC 1183</a></td><td>负责人</td><td>有关域名负责人的信息，电邮地址的 <strong>@</strong> 通常写为 <strong>a</strong>。</td></tr><tr><td>SIG</td><td><a href="https://tools.ietf.org/html/rfc2535" target="_blank">RFC 2535</a></td><td>证书</td><td>SIG(0)（<a href="https://tools.ietf.org/html/rfc2931" target="_blank">RFC 2931</a>）及 TKEY（<a href="https://tools.ietf.org/html/rfc2930" target="_blank">RFC 2930</a>）使用的证书。<a href="https://tools.ietf.org/html/rfc3755" target="_blank">RFC 3755</a> designated RRSIG as the replacement for SIG for use within DNSSEC.</td></tr><tr><td>SOA</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>权威记录的起始</td><td>指定有关DNS区域的权威性信息，包含主要名称服务器、域名管理员的电邮地址、域名的流水式编号、和几个有关刷新区域的定时器。</td></tr><tr><td>SPF</td><td><a href="https://tools.ietf.org/html/rfc4408" target="_blank">RFC 4408</a></td><td>SPF 记录</td><td>作为 SPF 协议的一部分，优先作为先前在 TXT 存储 SPF 数据的临时做法，使用与先前在 TXT 存储的格式。</td></tr><tr><td>SRV</td><td><a href="https://tools.ietf.org/html/rfc2782" target="_blank">RFC 2782</a></td><td>服务定位器</td><td>广义为服务定位记录，被新式协议使用而避免产生特定协议的记录，例如：MX 记录。</td></tr><tr><td>SSHFP</td><td><a href="https://tools.ietf.org/html/rfc4255" target="_blank">RFC 4255</a></td><td>SSH 公共密钥指纹</td><td>DNS 系统用来发布SSH公共密钥指纹的资源记录，以用作辅助验证服务器的真实性。</td></tr><tr><td>TA</td><td>无</td><td>DNSSEC 信任当局</td><td>DNSSEC 一部分无签订 DNS 根目录的部署提案，，使用与 DS 记录相同的格式。</td></tr><tr><td>TKEY</td><td><a href="https://tools.ietf.org/html/rfc2930" target="_blank">RFC 2930</a></td><td>秘密密钥记录</td><td>为 TSIG 提供密钥材料的其中一类方法，that is 在公共密钥下加密的 accompanying KEY RR。</td></tr><tr><td>TSIG</td><td><a href="https://tools.ietf.org/html/rfc2845" target="_blank">RFC 2845</a></td><td>交易证书</td><td>用以认证动态更新（Dynamic DNS）是来自合法的客户端，或与 DNSSEC 一样是验证回应是否来自合法的递归名称服务器。</td></tr><tr><td>TXT</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>文本记录</td><td>最初是为任意可读的文本 DNS 记录。自1990年起，些记录更经常地带有机读数据，以 <a href="https://tools.ietf.org/html/rfc1464" target="_blank">RFC 1464</a>指定：opportunistic encryption、Sender Policy Framework（虽然这个临时使用的 TXT 记录在 SPF 记录推出后不被推荐）、DomainKeys、DNS-SD等。</td></tr></tbody></table><h2><a href="https://ephen.me/2016/dns-rr/#其他伪资源记录类型"></a>其他伪资源记录类型</h2><table><thead><tr><th>类型</th><th>RFC来源</th><th>描述</th><th>功能</th></tr></thead><tbody><tr><td>*</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>所有缓存的记录</td><td>传回所有服务器已知类型的记录。如果服务器未有任何关于名称的记录，该请求将被转发。而传回的记录未必完全完成，例如：当一个名称有 A 及 MX 类型的记录时，但服务器已缓存了 A 记录，就只有 A 记录会被传回。</td></tr><tr><td>AXFR</td><td><a href="https://tools.ietf.org/html/rfc1035" target="_blank">RFC 1035</a></td><td>全域转移</td><td>由主域名服务器转移整个区域文件至二级域名服务器。</td></tr><tr><td>IXFR</td><td><a href="https://tools.ietf.org/html/rfc1995" target="_blank">RFC 1995</a></td><td>增量区域转移</td><td>请求只有与先前流水式编号不同的特定区域的区域转移。此请求有机会被拒绝，如果权威服务器由于配置或缺乏必要的数据而无法履行请求，一个完整的（AXFR）会被发送以作回应。</td></tr><tr><td>OPT</td><td><a href="https://tools.ietf.org/html/rfc2671" target="_blank">RFC 2671</a></td><td>选项</td><td>这是一个“伪 DNS 记录类型”以支持EDNS。</td></tr></tbody></table><h2><a href="https://ephen.me/2016/dns-rr/#什么是SOA？"></a>什么是SOA？</h2><p>SOA，即Start Of Authority，放在 zone file 中，用于描述这个 zone 负责的 name server，version number…等资料，以及当 slave server 要备份这个 zone 时的一些参数。</p><p>每个 zone file 中必须有且仅有一条 SOARR ，并在 zone file 中作为第一条资源记录保存。</p><p>举个栗子：</p><table><tr><td><pre><span>1</span><br /><span>2</span><br /><span>3</span><br /><span>4</span><br /><span>5</span><br /><span>6</span><br /></pre></td><td><pre><span>@ IN SOA lv3ns1.ffdns.net. webmaster.ffdns.net. (</span><br /><span>    2009092868 ; Serial</span><br /><span>    604800 ; Refresh</span><br /><span>    3600 ; Retry</span><br /><span>    2419200 ; Expire</span><br /><span>    3600 ) ; Minimum</span><br /></pre></td></tr></table><blockquote><p><strong>第一行：</strong><code>@</code>指代该 zone ； <code>lv3ns1.ffdns.net.</code>是该 zone 的授权主机；<code>webmaster.ffdns.net.</code>代表<a href="mailto:`webmaster@ffdns.net" target="_blank">`webmaster@ffdns.net</a>`，即该 zone 的管理者信箱。</p><p><strong>Serial：</strong>代表 zone file 的版本，每当 zone file 内容有变动，name server 管理者就应该增加这个号码，因为 slave 会将这个号码与其 copy 的那份比对以便决定是否要再 copy 一次（即进行 zone transfer ）。</p><p><strong>Refresh：</strong> slave server 每隔这段时间(秒)，就去检查 master server 上的 serial number 。</p><p><strong>Retry：</strong>当 slave server 无法和 master 进行 serial check 时，要每隔这段时间（秒） retry 一次。</p><p><strong>Expire：</strong>当时间超过 Expire 所定的秒数而 slave server 都无法和 master 取得连络，那么 slave 会删除自己的这份 copy 。</p><p><strong>Minimum：</strong>代表这个 zone file 中所有 record 的内定的 TTL 值，也就是其它的 DNS server cache 这笔 record 时，最长不应该超过这个时间。</p></blockquote><h2><a href="https://ephen.me/2016/dns-rr/#参考资料"></a>参考资料</h2><ol><li><a href="http://dns-learning.twnic.net.tw/index.html" target="_blank"> DNS 線上教學研究計畫 </a></li><li><a href="http://www.simpledns.com/help" target="_blank"> SimpleDNS.com - Help </a></li><li><a href="https://www.cnblogs.com/sddai/p/5703394.html" target="_blank"> DNS 资源记录( Resource Record )介绍 </a></li></ol>]]></content>
        
        <summary type="html">
            
            DNS 资源记录简介DNS server 内的每一个域名都有自己的域文件(zone file)，zone file 是由多个记录组成的，每一个记录就被称为资源记录(Resource Record，简称RR)。当在设定 DNS 域名解析、反向解析及其他的管理目的时，往往需要使用不
            
        </summary>
        
        <category term="工作笔记"/>
        
        <category term="知识探索"/>
        
        <category term="DNS"/>
        
        <category term="记录类型"/>
        
        <category term="SOA"/>
        
        <category term="参考资料"/>
        
    </entry>
    
    <entry>
        <title>使用OpenSSL-Dev分支开启TLSv1.3</title>
        <link href="https://www.isthnew.com/archives/openssl-dev-tls1_3-support.html"/>
        <id>https://www.isthnew.com/archives/openssl-dev-tls1_3-support.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-04-11T01:36:01+00:00</published>
        <updated>2018-04-11T01:36:01+00:00</updated>
        
        <content type="html"><![CDATA[<p>OpenSSL 将在4月初发布 OpenSSL-1.1.1 版本，届时 OpenSSL 将支持最新的 TLS1.3，关于 TLS1.3 的优点我已经在</p>]]></content>
        
        <summary type="html">
            
            OpenSSL 将在4月初发布 OpenSSL-1.1.1 版本，届时 OpenSSL 将支持最新的 TLS1.3，关于 TLS1.3 的优点我已经在
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="nginx"/>
        
        <category term="openssl"/>
        
        <category term="TLS1.3"/>
        
    </entry>
    
    <entry>
        <title>红米Note5使用简评</title>
        <link href="https://www.isthnew.com/archives/redmi-note5.html"/>
        <id>https://www.isthnew.com/archives/redmi-note5.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-04-11T01:35:11+00:00</published>
        <updated>2018-04-11T01:35:11+00:00</updated>
        
        <content type="html"><![CDATA[<h3><a href="https://www.isthnew.com/archives/redmi-note5.html#系统："></a>系统：</h3><p>出厂Android</p>]]></content>
        
        <summary type="html">
            
            系统：出厂Android
            
        </summary>
        
        <category term="不能无聊"/>
        
        <category term="小米"/>
        
        <category term="红米 note 5"/>
        
    </entry>
    
    <entry>
        <title>搭建自己的 PT 盒子</title>
        <link href="https://dcc.cat/pt-box.html"/>
        <id>https://dcc.cat/pt-box.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-04-09T16:00:00+00:00</published>
        <updated>2018-04-09T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><blockquote>前些日子，兽兽大佬发了<a href="https://sb.sb/blog/debian-install-rtorrent-rutorrent-nginx/">一篇文章</a>介绍了 <strong>Debian 9 安装 rTorrent + ruTorrent + Nginx 搭建自己的 PT / BT 盒子</strong>，作为国服大刷子（上传量很大很大的人），他的文章是非常有学习价值的了，我正好也想玩玩 PT，正好某个 PT 站公开发邀请，买了几台独服开始玩玩，作为纯新手，记录一下自己学习的过程吧。<strong>本文很多都抄自兽兽大佬的文章</strong>。<p></p><p><code>Private Tracker</code>，简称 PT，即私用种子服务器。Private Tracker 可以统计用户的上传和下载量，计算用户的分享率。可以简单将它理解为 BT 的升级版，在拥有 BT 所有功能的同时，需要达到一定的分享率才能不被删除帐号。PT 下载其实也是 BT 下载的一种，但有两个明显的改进：<strong>一是私密的小范围下载，二是进行流量统计，根据上载量决定你的权限</strong>。</p></blockquote><h2>安装 rTorrent</h2><p>业内用来刷 PT/BT 的有很多种软件，比如 <code>Transmission</code>、<code>Deluge</code>、<code>uTorrent</code>等等，这边选择了 <code>rTorrent</code>，至于原因，据兽兽大佬所说，<code>rTorrent</code> 上传量最高，适合大刷子使用，其他的特点还有占用内存小、频宽利用率高等等。</p><p><strong>本次安装使用 Debian 9.4</strong></p><h3>安装必备软件</h3><p>这边的介绍非常简单，详细的设置可以参考 <a href="https://dcc.cat/lemp.html">LEMP 安装教程</a></p><pre><code>apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install sudo nano curl vim wget rtorrent apt-transport-https lsb-release ca-certificates git subversion python-pip python-dev build-essential unrar-free unzip sqlite3 apache2-utils mediainfo -y

pip install -U pip &amp;&amp; pip install supervisor

curl -sL https://deb.nodesource.com/setup_8.x | bash - &amp;&amp; apt install nodejs -y
sudo npm i npm -g &amp;&amp; sudo npm i pm2 -g &amp;&amp; sudo npm i node-gyp -g

wget -O /etc/apt/trusted.gpg.d/nginx-mainline.gpg https://packages.sury.org/nginx-mainline/apt.gpg
sh -c 'echo &quot;deb https://packages.sury.org/nginx-mainline/ $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/nginx.list'
apt update &amp;&amp; apt install nginx-extras -y </code></pre><h3>后台运行 <code>rTorrent</code></h3><p>为了简化步骤，我们假设在 root 用户下运行 <code>rTorrent</code>，并且设置下载目录在 <code>/var/www/downloads</code>，虽然这样并不是特别的安全。</p><pre><code>sudo mkdir -p /var/www/downloads/{.session,~watch}</code></pre><p>创建配置文件：</p><pre><code>nano ~/.rtorrent.rc</code></pre><p><strong>参考配置内容如下：</strong></p><pre><code># Maximum and minimum number of peers to connect to per torrent.
min_peers = 40
max_peers = 100

# Same as above but for seeding completed torrents (-1 = same as downloading)
min_peers_seed = 40
max_peers_seed = 100

# Maximum number of simultanious uploads per torrent.
max_uploads = 50

# Global upload and download rate in KiB. &quot;0&quot; for unlimited.
download_rate = 0
upload_rate = 0

# Default directory to save the downloaded torrents.
directory = /var/www/downloads

# Default session directory. Make sure you don't run multiple instance of rtorrent using the same session directory. Perhaps using a relative path?
session = /var/www/downloads/.session

# Watch a directory for new torrents, and stop those that have been deleted.
schedule = watch_directory,5,5,load_start=/var/www/downloads/.watch/*.torrent
schedule = untied_directory,5,5,stop_untied=

# Close torrents when diskspace is low.
schedule = low_diskspace,5,60,close_low_diskspace=10240M

# The ip address reported to the tracker.
# ip = 127.0.0.1
# ip = rakshasa.no

# The ip address the listening socket and outgoing connections is bound to.
# bind = 127.0.0.1
# bind = rakshasa.no

# Port range to use for listening.
port_range = 55950-56000

# Start opening ports at a random position within the port range.
port_random = yes

# Check hash for finished torrents. Might be usefull until the bug is fixed that causes lack of diskspace not to be properly reported.
check_hash = no

# Set whether the client should try to connect to UDP trackers.
use_udp_trackers = yes

# Alternative calls to bind and ip that should handle dynamic ip's.
# schedule = ip_tick,0,1800,ip=rakshasa
# schedule = bind_tick,0,1800,bind=rakshasa

# Encryption options, set to none (default) or any combination of the following: allow_incoming, try_outgoing, require, require_RC4, enable_retry,prefer_plaintext
# The example value allows incoming encrypted connections, starts unencrypted outgoing connections but retries with encryption if they fail, preferring plaintext to RC4 encryption after the encrypted handshake

encryption = allow_incoming,enable_retry,prefer_plaintext

# Enable DHT support for trackerless torrents or when all trackers are down.
# May be set to &quot;disable&quot; (completely disable DHT), &quot;off&quot; (do not start DHT), &quot;auto&quot; (start and stop DHT as needed), or &quot;on&quot; (start DHT immediately). The default is &quot;off&quot;. For DHT to work, a session directory must be defined.
dht = disable
# UDP port to use for DHT.
# dht_port = 6881

# Enable peer exchange (for torrents not marked private)
peer_exchange = no

scgi_port = 127.0.0.1:5000

network.xmlrpc.size_limit.set = 2000000</code></pre><p><strong>编辑完成后按 <code>ctrl + x</code> 保存退出，再按 <code>y</code> 确认即可：</strong></p><p><strong>使用 <code>Supervisor</code> 后台运行 <code>rTorrent</code></strong></p><pre><code>echo_supervisord_conf &gt; /etc/supervisord.conf
mkdir -p /var/log/supervisor
nano /etc/supervisord.conf</code></pre><p><strong>在文件末尾加入如下内容：</strong></p><pre><code>[program:rtorrent]
command = /usr/bin/rtorrent
user = root
autostart = true
autorestart = true
stdout_logfile = /var/log/supervisor/rtorrent.log
stderr_logfile = /var/log/supervisor/rtorrent.error.log</code></pre><p>后台运行：</p><pre><code>supervisord -c /etc/supervisord.conf</code></pre><p>管理命令：</p><pre><code>supervisorctl status
supervisorctl [stop|start|reread] xxx
supervisorctl update xxx</code></pre><h2>使用 <code>Flood</code> 管理 PT 下载</h2><p>Flood 是一个基于 nodejs 的现代化管理 rtorrent 的 GUI 界面，整体设计较为美观，使用也比较方便。</p><h3>安装配置 <code>Flood</code></h3><pre><code>cd /var/www &amp;&amp; git clone https://github.com/jfurrow/flood.git &amp;&amp; cd flood &amp;&amp; cp config.template.js config.js
sudo npm i --unsafe-perm &amp;&amp; sudo npm run build &amp;&amp; pm2 start npm -- start</code></pre><p>然后 Flood 就会运行在 <code>127.0.0.1:3000</code> 端口，这个端口可以在 <code>config.js</code> 中修改。</p><h3>Nginx 整合</h3><p>如果修改 <code>config.js</code> 中端口监听 <code>0.0.0.0</code> 那么就直接可以公网访问，当然更好的办法是使用 <code>Nginx</code> 转发一下，参考配置如下：</p><pre><code>location / {
    proxy_connect_timeout 10;
    proxy_send_timeout 60;
    proxy_read_timeout 60;
    proxy_buffer_size 64k;
    proxy_buffers 16 32k;
    proxy_busy_buffers_size 128k;
    proxy_temp_file_write_size 64k;
    proxy_pass_header Set-Cookie;
    proxy_redirect off;
    proxy_set_header Referer $http_referer;
    proxy_set_header Host $host;
    proxy_http_version 1.1;
    proxy_hide_header X-Powered-By;
    proxy_set_header Cookie $http_cookie;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Server $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_no_cache $http_pragma $http_authorization;
    proxy_cache_bypass $http_pragma $http_authorization;
    proxy_pass http://127.0.0.1:3000;
    client_max_body_size 10m;
    client_body_buffer_size 1m;
}</code></pre><p><strong>目前 flood 可能会出现上传种子出现失败，选择通过链接添加种子即可。</strong></p>]]></content>
        
        <summary type="html">
            
            前言前些日子，兽兽大佬发了一篇文章介绍了 Debian 9 安装 rTorrent + ruTorrent + Nginx 搭建自己的 PT / BT 盒子，作为国服大刷子（上传量很大很大的人），他的文章是非常有学习价值的了，我正好也想玩玩 PT，正好某个 PT 站公开发邀请，
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Windows 10 字体渲染优化</title>
        <link href="https://www.isthnew.com/archives/win10-font-optimization.html"/>
        <id>https://www.isthnew.com/archives/win10-font-optimization.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-04-08T05:47:10+00:00</published>
        <updated>2018-04-08T05:47:10+00:00</updated>
        
        <content type="html"><![CDATA[<p>2018-4-8</p>
<p>很遗憾，Windows 10 v1903也就是2018春季更新并未搭载全新字体，但是可以自行下载Noble Scarlet字体安装并使用 Microangelo OnDisplay</p>]]></content>
        
        <summary type="html">
            
            2018-4-8 很遗憾，Windows 10 v1903也就是2018春季更新并未搭载全新字体，但是可以自行下载Noble Scarlet字体安装并使用 Microangelo OnDisplay
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="windows 10"/>
        
        <category term="mactype"/>
        
        <category term="字体优化"/>
        
        <category term="Creators Update"/>
        
    </entry>
    
    <entry>
        <title>中国的互联网</title>
        <link href="https://blog.nfz.moe/archives/network-in-china.html"/>
        <id>https://blog.nfz.moe/archives/network-in-china.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-04-07T11:07:00+00:00</published>
        <updated>2018-04-07T11:07:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>外交部发言人华春莹称“中国的互联网是 <strong>自由、开放、有序</strong> 的”。尽管中国互联网相比世界其他地方的互联网也存在许多相似之处，但还有很大不同。</p><a></a><blockquote><p>本文中关于“中国”的论述仅适用于中国大陆地区、即 <code>Mainland China</code>；本文介绍的内容与香港、澳门和中华民国（中华人民共和国台湾省）无关。本文中若提到“中国”，一律仅指代中国大陆地区。</p></blockquote><p>中国和其它国家的互联网的不同，主要可以从这几个方面介绍：</p><h1><a href="https://blog.nfz.moe/archives/network-in-china.html# 基础设施"></a>基础设施 </h1><p> 与世界其它大多数地方网络不同，中国的路由是不开放的。中国的核心互联网接入在很大程度上是由两个互联网服务提供商提供：中国电信和中国联通。除此以外，中国的互联网服务提供商还有中国移动、鹏博士和长城宽带、教育网、科技网、华数、世纪互联、光环新网。大大小小运营商分治了中国的互联网。互联网服务提供商当中的巨头建设并控制了整个国家的互联网基础设施建设、IP 地址的分配和内部路由的管理。这些运营商使用自己的方式、自己的规定，独立管理和运营自己旗下的网络。就算是中国互联网巨头，也仅仅最多拥有自己的 IP 地址分配（如阿里云、腾讯云等）</p><p>与此同时，在中国境内，各个互联网服务提供商之间也存在瓶颈；即使是同一个服务商，他们内部之间也存在瓶颈。例如，中国电信在中国很多省份建立了很多分公司来经营很多不同地区的网络，其中许多分公司都是独立运作的。这些网络之间的路由，互联网服务提供商本身，都因为太多的流量与太少的容量之间的矛盾变得拥堵。在中国，流量在不同地区之间就会遇到瓶颈、甚至流量在同一个地区里的不同运营商之间中转都会拥堵。<br />以中国几家公共 DNS 服务为例，阿里和腾讯在全国不同地区的各个运营商累计上百个节点均部署了 DNS 服务，借助 <code>IP Anycast</code> 服务中国所有地区的网民；南京信风科技在他们位于南京的机房接入了中国电信、中国联通、中国移动运营商的骨干网、以及其它 10 家运营商的线路，用来确保中国各个地区、各个运营商的网民都能以最快的速度请求 114 的 DNS（实际上，这意味着南京信风科技拥有中国最好、也是最昂贵的 BGP 多线机房）。</p><h1><a href="https://blog.nfz.moe/archives/network-in-china.html# 费用成本"></a>费用成本 </h1><p> 在这样畸形的基础设施建设的结果下为了获得合适的性能、降低延时，就只有两种选择：大量的分布在中国各地的数据中心、亦或者是一个拥有多线 BGP 的数据中心。<br />如果选择运营 BGP 多线机房，就需要同时和数十家运营商签署协议使用他们的带宽，意味着使原本高昂的成本继续翻倍。<br />如果选择使用大量数据中心构建 CDN，就需要在中国各地建设数据中心、有时还需要租借当地运营商的机房。在中国建设能够各地能快速访问的 CDN，至少需要 50 个数据中心；而如果要建设覆盖中国的 CDN，至少需要 100-200 个节点，成本可想而知。</p><p>中国互联网的技术挑战也抬高了做生意的成本。由于互联网服务供应商之间在当地的市场动态、带宽的成本，中国的宽带已然成为是世界上费用最昂贵的宽带之一。在中国，带宽的价格堪比黄金，能在海外购买到百兆 VPS 的费用在国内的云服务商不一定能购买到独享 1M 带宽的云主机。一些非中国本土的云计算供应商都表示，在中国提供高质量的服务并不像在北京建立一个单点定位那么简单。无论是大量的数据中心还是昂贵的 BGP 多线，都使得在中国境内提供服务非常昂贵。</p><h1><a href="https://blog.nfz.moe/archives/network-in-china.html# 法律监管"></a>法律监管 </h1><p> 和许多国家一样，中国法律禁止某些类型的内容在中国的互联网上传播。在中国，购买和使用服务器需要实名认证、域名用于服务也需要实名；任何一个想要在国内经营一个网站的组织或者个人都需要一个由中国工业和信息化部颁发的互联网内容提供商（ICP）许可证，为了获取 ICP 许可证需要网站确实存在、备案期间又禁止网站开放。为了避免违反中国法律、确定只存在中国可以用的内容、不存在中国不可以用的内容，在中国，云服务商也主动成为一个互联网审查者——推进云服务购买时的实名认证、机房设置备案阻断机制、云服务商在云主机的系统里内置监控进程、以及配合公安部开展“网站一键关停”。</p><p>在中国，以下内容均不允许在中国的互联网上进行传播。</p><ul><li>危害国家统一和领土完整的</li><li>煽动抗拒破坏宪法和法律实施</li><li>危害国家安全或者损害国家荣誉和利益的</li><li>破坏民族团结</li><li>扰乱社会秩序破坏社会稳定的</li><li>宣传淫秽赌博暴力或者教唆犯罪的、</li><li>危害社会公德或者民族优秀文化传统</li><li>以非法民间组织名义活动</li><li>含有法律、行政法规禁止的其他内容</li></ul><p>为了实现对上述内容的监管、维护中国互联网的稳定，中国的有关部门会对网络进行 24 小时不间断的监控、政府及网评员引导网上舆论、谴责与处罚海外公司、对社交媒体更加严格的控制、拘捕审问一些尝试突破网络限制的开发者。<br />一旦出现不适合在中国互联网上传播的内容、而中国政府无能为力的（如服务器在境外），就会采取一定的措施解决——</p><h1><a href="https://blog.nfz.moe/archives/network-in-china.html# 封锁拦截"></a>封锁拦截 </h1><p> 位于中国的网络审查技术在世界上具有独特性。中国互联网通过多手段、多途径、多层次、分布式的处理，阻止大多数网民接触到违反相关政策、涉及黄赌毒和其它各类敏感内容进入中国。</p><p>中国著名的防火长城，其作用主要是监控国际网关上的通讯，对认为不匹配中共官方要求的传输内容，进行干扰、阻断、屏蔽。目前常见的封锁措施包括 IP 或端口封锁、DNS 污染、连接重置、动态路由转发、干扰加密连接、关键字阻断、SSL 伪造和劫持、劣化服务等。在十九大前后，中国短暂关闭了位于广东的互联网国际出口、并对中国华北地区进行了骨干网阻断。<br />中国境内曾经部署了 F I J 三组根域名服务器，由于中国多次恶意在根域名服务器投毒、影响全球互联网，被断开与世界互联网的连接，后 F I J 更换至海外服务商、不再由中国提供服务。</p><p>在中国国内的省与省之间，也存在各自独立的信息审查。比如中国著名的网络文件存储和分享服务百度网盘在新疆地区遭到完全屏蔽，在新疆遭到屏蔽的还有在中国沿海地区早已经解封的网站如 GitHub、谷歌翻译、谷歌开发者等；在新疆使用虚拟专用网（VPN）的用户会被停止服务，并需到当地派出所登记以进行解锁；新疆在 2009 - 2010 年更是进行了为期将近一年的断网；又例如中国著名的天涯论坛的服务器位于海南省海口市，当有不利于其它地方的地方官员的信息出现在该论坛时，可能会要求海口市网警向论坛提出信息删除，甚至有为此而出现的网警之间的相互贿赂等。</p><p>除了不同地区的封锁，还有运营商自行进行的封锁和审查。以中国移动为例，其网络在中国防火长城的基础上，额外封锁“不良”网站累计超 60 万个，即在使用由中国移动提供的互联网接入服务时将会有更多的网站无法直接访问，但是在其它互联网服务提供商的网络下则能正常访问。<br />某种意义上，防火长城其实早已实现了分布式，改变了过去北京、天津、哈尔滨、上海、深圳部署多个集群的做法、转变为由运营商自行开展封锁，所以出现了中国网民口中常称的 “墙高 墙矮” “墙中墙”。</p>]]></content>
        
        <summary type="html">
            
            外交部发言人华春莹称“中国的互联网是 自由、开放、有序 的”。尽管中国互联网相比世界其他地方的互联网也存在许多相似之处，但还有很大不同。本文中关于“中国”的论述仅适用于中国大陆地区、即 Mainland China；本文介绍的内容与香港、澳门和中华民国（中华人民共和国台湾省）无
            
        </summary>
        
        <category term="自言语"/>
        
        <category term="互联网"/>
        
        <category term="网络"/>
        
        <category term="运营商"/>
        
        <category term="封锁"/>
        
        <category term="BGP"/>
        
    </entry>
    
    <entry>
        <title>Floating/Sinking - 漂浮/沉溺</title>
        <link href="https://milkice.me/2018/04/02/music-floating-sinking/"/>
        <id>https://milkice.me/2018/04/02/music-floating-sinking/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2018-04-02T12:15:16+00:00</published>
        <updated>2018-04-02T12:15:16+00:00</updated>
        
        <content type="html"><![CDATA[建议边听边阅读 这是一个夏日的初晨 阳光还未顾及森林的每一片尘土 万籁俱寂 只听得鸟儿在四处啼叫 一切都显得祥和宁静 你拨开灌木丛 漫无目的地走着 能听到你走过潮湿的沼泽地时 泥草发出的窸窣声 能听到你走过干枯的独木桥时 木头发出的叹息声 太阳还未完全升起 即便是再勤劳勇敢的猎人 也不会在此时探索沼泽 为什么 你会在这里呢 你就像只迷路的……]]></content>
        
        <summary type="html">
            
            建议边听边阅读 这是一个夏日的初晨 阳光还未顾及森林的每一片尘土 万籁俱寂 只听得鸟儿在四处啼叫 一切都显得祥和宁静 你拨开灌木丛 漫无目的地走着 能听到你走过潮湿的沼泽地时 泥草发出的窸窣声 能听到你走过干枯的独木桥时 木头发出的叹息声 太阳还未完全升起 即便是再勤劳勇敢的猎
            
        </summary>
        
        <category term="Music"/>
        
        <category term="Personal"/>
        
    </entry>
    
    <entry>
        <title>不记得是谁给我推荐了 [更纱黑体](https://github.com/be5invis/Sarasa-Gothic)  在命令行里用了几天，爱不释手，也安利一下</title>
        <link href="https://www.mokeyjay.com/archives/2150"/>
        <id>https://www.mokeyjay.com/archives/2150</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-04-02T07:10:57+00:00</published>
        <updated>2018-04-02T07:10:57+00:00</updated>
        
        <content type="html"><![CDATA[不记得是谁给我推荐了 更纱黑体 在命令行里用了几天，爱不释手，也安利一下]]></content>
        
        <summary type="html">
            
            不记得是谁给我推荐了 更纱黑体 在命令行里用了几天，爱不释手，也安利一下
            
        </summary>
        
        <category term="杂谈"/>
        
        <category term="资源"/>
        
    </entry>
    
    <entry>
        <title>Nginx Unit 与 LEMUR 新架构</title>
        <link href="https://dcc.cat/lemur.html"/>
        <id>https://dcc.cat/lemur.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-04-01T08:01:00+00:00</published>
        <updated>2018-04-01T08:01:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>从 LAMP、LEMP 到 LEMUR</h2><p>从 20 世纪 90 年代开始，<code>LAMP</code> 架构成为了部署 Web 应用程序最有名和最值得信赖的方法。LAMP 是 Linux，Apache，MySQL和 PHP 的首字母缩写。直至今日，Apache 经过不断迭代，依旧作为一个成熟、稳定、强大的 Web 架构被广为使用。</p><p>然而随着用于开发和交付现代 Web 应用程序的架构不断地追求轻便和简化。NGINX 横空出世，由于其简单性，高性能和可扩展性而成为大多数热门网站的首选网络服务器。这导致了 <code>LEMP 堆栈</code> 的广泛使用，NGINX（Engine-X）取代了 Apache。</p><p>时至今日，Web 开发的语言、框架越发多样化，以至于 LAMP、LNMP 中的关键一项 <code>PHP</code> 逐渐无法满足市场的需求，GO、Python、Ruby、NodeJS、JAVA 等越来越多的语言被用于 Web 开发与生产实践。虽然你依旧可以单纯的使用 Nginx 作为反向代理的工具处理 Python、NodeJS、JAVA 等 Web 程序，但是对应的部署难度和维护复杂性随着时间的推进变得越来越高。运维人员希望能够有一个统一的平台，高效、简单地处理各种各样的 Web 程序。</p><p>那么这个时候，一个全新的 Web 架构来到了我们眼前，那就是 <code>LEMUR</code>，即 <code>Linux，NGINX，MariaDB，Unit 和 Redis</code>。</p><h2>LEMUR 架构的安装</h2><p><strong>本次安装以 <code>Debian 9.4</code> 为例</strong></p><h3>基本库安装</h3><pre><code>apt update &amp;&amp; apt upgrade -y
apt install curl vim nano wget git sudo unzip apt-transport-https screen lsb-release ca-certificates dialog software-properties-common gnupg2 apparmor dirmngr -y</code></pre><h3>Redis</h3><blockquote>关系型数据库是数据存储的基石。但是，许多轻量级应用程序使用的重量级复杂数据存储工具都不实用，或者速度不够快。2009年，Redis 实验室推出了开源、支持网络、基于内存、可选持久性的键值对存储数据库。今天，Redis 可能是最流行的键值对存储数据库，数百万个 Web 应用程序使用它。其轻巧简单的设计使其成为 LEMUR 架构的关键和非关系型数据库的首选。</blockquote><p>很多人都说系统源打包的 redis 很老，谁能想到 <code>stretch-backports</code> 的版本直接是 <code>4.0+</code> 新版呢。</p><pre><code>apt install redis-server -t stretch-backports</code></pre><h3>MariaDB</h3><blockquote>在 Oracle 于 2010 年收购 Sun Microsystems 后，MySQL 的原始作者之一马上创建了 MariaDB。其开放式设计和协作开发确保世界上最流行的数据库保持开源并可供任何项目的工程师使用。此外，它与 MySQL 向后兼容。所有这些特征使 MariaDB 成为 LEMUR 架构中的关系数据库的首选。</blockquote><pre><code>sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
sudo add-apt-repository 'deb [arch=amd64] https://mirror.rackspace.com/mariadb/repo/10.3/debian stretch main'
sudo apt update &amp;&amp; sudo apt install mariadb-server -y</code></pre><h3>Nginx &amp; Unit</h3><blockquote>最初于 1997 年发布的 PHP 已成为 Web 应用程序最流行的语言之一。PHP 进入门槛非常低，并且易于新手网站开发人员，但现代应用程序变得越来越复杂 - 它们以多种语言开发，并且通常在同一时间以多种不同语言版本交付。  <p></p><p>为了应对这些新挑战，<code>Nginx Unit</code> 横空出世，专为现代应用设计。Unit 同时支持多种语言和语言版本，包括多个 PHP 版本，并作为 LEMUR 架构中应用服务器的核心角色。</p></blockquote><p><strong>Nginx 和 Unit 的部署可以有非常多的玩法，先介绍如何通过预编译包来安装，后面会补充介绍更高级的玩法。</strong></p><pre><code>curl -C - https://nginx.org/keys/nginx_signing.key | sudo apt-key add -

cat &gt;&gt; /etc/apt/sources.list.d/nginx.list &lt;&lt; EOF
deb https://packages.nginx.org/unit/debian/ $(lsb_release -sc) unit
deb https://nginx.org/packages/mainline/debian/ $(lsb_release -sc) nginx
EOF</code></pre><p>这边写了安装 <code>unit-php</code> <code>unit-python</code> 和 <code>unit-go</code>，实际上 <code>Unit</code> 可以做到支持 <code>Python、PHP、Go、Perl、Ruby、JavaScript/Node.js (coming soon)、Java (coming soon)</code>，我这边也将第一时间跟进。</p><pre><code>apt update &amp;&amp; apt install nginx unit-php unit-python2.7 unit-python3.5 unit-go1.7 unit-perl unit-ruby golang -y
apt install python-dev python3-dev libphp-embed php7.0-{bz2,bcmath,common,curl,dba,dev,gd,json,mcrypt,mbstring,mysql,intl,opcache,redis,sqlite3,xml,xmlrpc,zip} -t stretch-backports -y</code></pre><h2>Unit——LEMUR 架构的核心</h2><blockquote>2018 年 4 月 12 日，在首次公开发布大约六个月后，<code>NGINX Unit</code> 正式发布了 <code>1.0</code> 版本。  <p></p><p><code>Nginx Unit</code> 使用 <code>REST API</code> 进行动态配置；没有静态配置文件。所有配置更改直接在内存中发生。配置更改无需重新加载配置或重启服务即可生效。</p></blockquote><p><strong>毫无疑问，<code>Unit</code> 是整个 <code>LEMUR</code> 架构的核心组件，也是 Nginx 未来主推的 Web 动态应用部署新形式，它具有以下特征：</strong></p><ul><li>使用 JSON API 进行动态配置管理</li><li>同时支持多语言、多版本 Web 开发语言</li></ul><p><strong>即将支持的特性有：</strong></p><ul><li>动态语言的进程管理功能</li><li>TLS 支持</li><li>TCP, HTTP, HTTPS, HTTP/2 路由和代理</li></ul><h3>案例介绍</h3><p><strong>下面我们用一个典型的 PHP 应用 <code>wordpress</code> 为例介绍 <code>Unit</code> 以及 <code>LEMUR</code> 的应用：</strong></p><h4>数据库配置</h4><p>创建一个数据库以及对应用户：</p><pre><code>mysql_secure_installation</code></pre><pre><code>mysql -u root -p
mysql&gt; CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci; 
mysql&gt; CREATE USER wp_user@localhost IDENTIFIED BY 'secure_password';
mysql&gt; GRANT ALL PRIVILEGES ON wordpress.* TO user@localhost;
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; exit</code></pre><h4>应用下载与配置</h4><pre><code>mkdir -p /var/www &amp;&amp; cd /var/www &amp;&amp; wget http://wordpress.org/latest.tar.gz &amp;&amp; tar xzvf latest.tar.gz &amp;&amp; rm latest.tar.gz &amp;&amp; cd wordpress &amp;&amp; cp wp-config-sample.php wp-config.php </code></pre><ul><li><strong>简单的<code>安全加固</code>，记录下返回的结果，之后要用到：</strong></li></ul><pre><code>curl -s https://api.wordpress.org/secret-key/1.1/salt/</code></pre><ul><li><strong>编辑配置：</strong></li></ul><pre><code>nano wp-config.php</code></pre><p>找到如下部分并修改成<strong>对应数据库信息</strong>：</p><pre><code>/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'wp_user@localhost');

/** MySQL database password */
define('DB_PASSWORD', 'secure_password');</code></pre><p>找到如下内容并修改为之前<strong>安全加固</strong>产生的内容：</p><pre><code>define('AUTH_KEY',         'value generated by salt');
define('SECURE_AUTH_KEY',  'value generated by salt');
define('LOGGED_IN_KEY',    'value generated by salt');
define('NONCE_KEY',        'value generated by salt');
define('AUTH_SALT',        'value generated by salt');
define('SECURE_AUTH_SALT', 'value generated by salt');
define('LOGGED_IN_SALT',   'value generated by salt');
define('NONCE_SALT',       'value generated by salt');</code></pre><p><strong>编辑完成后按 <code>ctrl + x</code> 保存退出，再按 <code>y</code> 然后按<code>回车</code>确认即可：</strong></p><ul><li><strong>修改文件及目录权限：</strong></li></ul><pre><code>sudo chown -R www-data:www-data /var/www/wordpress
sudo find /var/www/wordpress -type d -exec chmod g+s {} \;
sudo chmod g+w /var/www/wordpress/wp-content
sudo chmod -R g+w /var/www/wordpress/wp-content/themes
sudo chmod -R g+w /var/www/wordpress/wp-content/plugins</code></pre><h4><code>Unit</code> 配置</h4><ul><li><strong>修改 <code>Unit</code> 配置文件：</strong></li></ul><pre><code>nano /var/www/wordpress/wordpress.config</code></pre><p>指定 <code>wordpress.config</code> 是 这个 <code>Unit</code> 应用的配置文件，我们写入如下内容：</p><pre><code>{
    &quot;listeners&quot;: {
        &quot;127.0.0.1:8090&quot;: {
            &quot;application&quot;: &quot;script_index_php&quot;
        },
        &quot;127.0.0.1:8091&quot;: {
            &quot;application&quot;: &quot;direct_php&quot;
        }
    },

    &quot;applications&quot;: {
        &quot;script_index_php&quot;: {
            &quot;type&quot;: &quot;php&quot;,
            &quot;processes&quot;: {
                &quot;max&quot;: 20,
                &quot;spare&quot;: 5
            },
            &quot;user&quot;: &quot;www-data&quot;,
            &quot;group&quot;: &quot;www-data&quot;,
            &quot;root&quot;: &quot;/var/www/wordpress&quot;,
            &quot;script&quot;: &quot;index.php&quot;
        },
        &quot;direct_php&quot;: {
            &quot;type&quot;: &quot;php&quot;,
            &quot;processes&quot;: {
                &quot;max&quot;: 5,
                &quot;spare&quot;: 0
            },
            &quot;user&quot;: &quot;www-data&quot;,
            &quot;group&quot;: &quot;www-data&quot;,
            &quot;root&quot;: &quot;/var/www/wordpress&quot;,
            &quot;index&quot;: &quot;index.php&quot;
        }
    }
}</code></pre><ul><li><strong>提交配置文件：</strong></li></ul><p>这边只是介绍了最基本的 API 用法，实际上基于 <code>Unit API</code> 可以完成很多工作，具体参考 <strong><a href="https://unit.nginx.org/configuration/">Unit 官方文档</a></strong></p><pre><code>curl -X PUT -d @/var/www/wordpress.config --unix-socket /run/control.unit.sock http://localhost/config</code></pre><ul><li><strong><code>Unit</code> 操作：</strong></li></ul><pre><code>service unit [start|status|stop|restart|reload|force-reload|saveconfig|loadconfig]</code></pre><blockquote>对应的操作分别为：开始、状态、关闭、重启、重载所有配置、强制载入所有配置、保存应用配置、载入应用配置。</blockquote><h4><code>Nginx</code> 整合 <code>Unit</code>：</h4><p><strong>以上面的 <code>Wordpress</code> 应用为例，给出一个 <code>Nginx</code> 配置：</strong></p><pre><code>upstream index_php_upstream {
    server 127.0.0.1:8090;
}
upstream direct_php_upstream {
    server 127.0.0.1:8091;
}
server {
    listen      80;
    server_name localhost;
    root        /var/www/wordpress/;
    location / {
        try_files $uri @index_php;
    }
    location @index_php {
        proxy_pass       http://index_php_upstream;
        proxy_set_header Host $host;
    }
    location /wp-admin {
        index index.php;
    }
    location ~* \.php$ {
        try_files        $uri =404;
        proxy_pass       http://direct_php_upstream;
        proxy_set_header Host $host;
    }
}</code></pre><p>编辑完成以后开启 Nginx 即可访问：</p><pre><code>nginx -t &amp;&amp; nginx -s reload</code></pre><h3>个人看法</h3><p>Nginx 作为一段时间内流行的 Web Server，被广为使用，这次推出新的 Web 架构设想，以及 Unit 这一自我革命性质的产品，瞄准的就是未来可能十年的 Web 部署方案，实际体验下来，还是有很多问题的，首先就是兼容性问题，尝试了多款 Web 程序，<code>Unit</code> 对于<code>单入口程序</code>的兼容还算不错，但是对于复杂的<code>多入口程序</code>目前存在或多或少的兼容性问题；性能方面，对于 PHP 的性能相比 <code>PHP-FPM</code> 并没有很大提高，反而由于没有 <code>Cache</code> 支持，实际使用时表现远不如传统部署方案。</p><p>在 Unit 推崇的自动化部署方面，Unit 推行的 <code>Api 配置</code>方式为 <code>GUI 动态部署</code>创造了基础，<code>多版本、多语言兼容</code>更是为其未来创造了无限可能。然而，<code>Nginx + Unit</code> 的组合与传统的 <code>静态+反代</code> 模式并没有本质的区别，在自动化应用部署领域，Unit 落后于 <code>Docker</code> <code>Kubernetes</code> 不是一点点。当然总的来说，我对 Unit 的前景还是充满信心的，也会不断关注其开发进程。</p>]]></content>
        
        <summary type="html">
            
            从 LAMP、LEMP 到 LEMUR从 20 世纪 90 年代开始，LAMP 架构成为了部署 Web 应用程序最有名和最值得信赖的方法。LAMP 是 Linux，Apache，MySQL和 PHP 的首字母缩写。直至今日，Apache 经过不断迭代，依旧作为一个成熟、稳定、强
            
        </summary>
        
    </entry>
    
    <entry>
        <title>常用免费前端公共库 CDN 服务收集</title>
        <link href="https://blog.nfz.moe/archives/public-static-cdn-service.html"/>
        <id>https://blog.nfz.moe/archives/public-static-cdn-service.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-03-31T12:32:00+00:00</published>
        <updated>2018-03-31T12:32:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>前端公共库 CDN 服务是指一些服务商将我们常用的前端开发用到的库存放到网上，方便开发者直接调用，并且提供 CDN 加速。<a></a>与将前端库存放在自己的服务器上相比，公共库的 CDN 更加稳定、高速，一来可以方便开发者的开发，二来可以让用户加速访问这些资源。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#BootCDN"></a>BootCDN</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000144.jpg" /></p><ul><li>CDN 提供商：又拍云</li><li>节点：全球</li><li>HTTPS：支持</li><li>HTTP2：支持 HTTP2 和 SPDY3.1</li><li>官网：<a href="http://www.bootcdn.cn" target="_blank">www.bootcdn.cn</a></li><li>CDN 资源域名：<code>cdn.bootcss.com</code></li></ul><p>BootCDN 是 Bootstrap 中文网和又拍云合作提供的前端公共库服务。BootCDN 每天同步一次 CDNJS 的 GitHub。又拍云的 CDN 嘛没的说，国内 150+ 节点，在香港和美国也都有节点，整体速度都很不错。偶尔会遭遇 CC 攻击，所以不是太稳。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#75CDN"></a>75CDN</h1><ul><li>CDN 提供商：奇虎 360</li><li>节点：全球</li><li>HTTPS：支持</li><li>HTTP2：支持</li><li>官网：<a href="https://cdn.baomitu.com/" target="_blank">cdn.baomitu.com</a></li><li>CDN 资源域名：<code>lib.baomitu.com</code></li></ul><p><del>BaomituCDN</del> 75CDN 是奇虎 360 最大的前端团队奇舞团维护的前端开源公共库，也是每天同步 CDNJS。奇虎的 CDN 节点在国内数量很可观，但是在海外就有些差强人意（没有东南亚地区节点，只有一个北美节点），亚太地区访客都会被解析回国内节点。不过 BaomituCDN 还同步了谷歌字体库（不是反代），所以还是可以看看的。最近他们 <a href="https://75team.com/post/75cdn-sri.html" target="_blank">为 75CDN 公共库加上了 SRI 支持</a>，这应该是公共库中可以算是独树一帜的（在这之前，只有 jsDelivr 提供了 SRI 支持）。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#CSS-NET"></a>CSS.NET</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000142.jpg" /></p><ul><li>CDN 提供商：Sucuri CDN 和 阿里云 CDN</li><li>节点：双节点</li><li>HTTPS：支持</li><li>HTTP2：支持</li><li>官网：<a href="https://css.net" target="_blank">css.net</a></li><li>CDN 资源域名：<del><code>cdnjs.cat.net</code></del> <code>cdnjs.loli.net</code> 等</li><li>介绍：<a href="https://sb.sb/css-cdn/" target="_blank">SB.SB/css-cdn/</a></li></ul><p>CSS.NET 是土豪 Showfom 提供的公益前端 CDN 服务，每天同步 CDNJS<del>和 jsDeliver</del>的 GitHub。jsDelivr 由于有国内和网宿合作的节点，css.net 已经不再同步。</p><blockquote><p>兽兽 dalao 亲自来博客评论区了(⁄ ⁄•⁄ω⁄•⁄ ⁄)，现在 css.net 的架构改成了国内是阿里云 CDN，海外是 <del>SUCURI CDN</del> CloudFlare（Pro Plan），全球路由畅通。CSS.NET 的整体速度和延迟都很不赖。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#Staticfile"></a>Staticfile</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000146.jpg" /></p><ul><li>CDN 提供商：七牛</li><li>节点：全球</li><li>HTTPS：支持</li><li>HTTP2：不支持</li><li>官网：<a href="https://www.staticfile.org" target="_blank">www.staticfile.org</a></li><li>CDN 资源域名：<code>cdn.staticfile.org</code></li></ul><p>Staticfile 是七牛提供的公共 CDN 服务，由掘金提供的技术支持。Staticfile 的库是自己维护的，开源在 GitHub 上。不过已经将近一年没有更新了，里面的库都不是最新的。不过七牛毕竟和国内多家 CDN 厂商合作，在国内节点和线路优秀，在海外也有韩国、日本、香港、台湾、北美多地的节点。不过七牛一直不支持 HTTP2，大家需要权衡一下。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#CDNJS"></a>CDNJS</h1><ul><li>CDN 提供商：CloudFlare</li><li>节点：海外</li><li>HTTPS：支持</li><li>HTTP2：支持</li><li>官网：<a href="https://cdnjs.com" target="_blank">cdnjs.com</a></li><li>CDN 资源域名：<code>cdnjs.cloudflare.com</code></li></ul><p>公共 CDN 库的老大，基本上国内大部分公共 CDN 都是从它这里同步的。支持多资源合并。CDN 服务商是大名鼎鼎的 CloudFlare，IP 任播走遍全球节点，还支持 IPv6。在国外速度没话说，不过在国内的路由就因为某些大家都懂的原因就基本呵呵了。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#jsDeliver"></a>jsDeliver</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000148.jpg" /></p><ul><li>CDN 提供商：CloudFlare、MaxCDN、Fastly 和网宿等</li><li>节点：全球</li><li>HTTPS：支持</li><li>HTTP2：<del>国内不支持、海外支持</del> 现在国内节点也已经支持了 HTTP2。</li><li>官网：<a href="https://www.jsdelivr.com/" target="_blank">www.jsdeliver.com</a></li><li>CDN 资源域名：<code>cdn.jsdelivr.net</code></li></ul><p>也是一家公共 CDN 巨头，除了拥有自有库、支持文件合并以外，还支持从 NPM 上获得资源。jsDeliver 域名还在国内备了案。提供海外 CDN 服务的是 CloudFlare，提供国内 CDN 服务的是 <del>CloudFlare 国内版 </del> 网宿。<del> 虽然有国内节点，但是我还是推荐使用国内同步 jsDeliver 的公共库，因为 jsDeliver 用的域名解析不够智能，还是偶尔会有国内一些地区被解析到 CloudFlare 海外节点上 </del> 现在 jsDelivr 换了负载均衡提供商，目前的解析还是挺正确的。除此之外，网宿 CDN 曾经被曝出浙江节点遭遇了 MITM，受到影响的 jsDelivr 也随即停止解析国内节点直到问题解决。</p><h1><a href="https://blog.nfz.moe/archives/public-static-cdn-service.html#UNPKG"></a>UNPKG</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000147.jpg" /></p><ul><li>CDN 提供商：CloudFlare</li><li>节点：海外</li><li>HTTPS：支持</li><li>HTTP2：支持</li><li>官网：<a href="https://unpkg.com/#/" target="_blank">unpkg.com</a></li><li>CDN 资源域名：<code>unpkg.com</code></li></ul><p>UNPKG CDN 是和 jsDeliver 类似的、但是只从 NPM 上获取资源的公共 CDN 库。虽然是 CloudFlare 国内速度较为不理想，但是比较推荐在开发时使用，因为 NPM 上的资源是最新的和实时的。不过部署在国内的生产环境上，还是不建议使用 UNPKG、或者可以部署反代。</p>]]></content>
        
        <summary type="html">
            
            前端公共库 CDN 服务是指一些服务商将我们常用的前端开发用到的库存放到网上，方便开发者直接调用，并且提供 CDN 加速。与将前端库存放在自己的服务器上相比，公共库的 CDN 更加稳定、高速，一来可以方便开发者的开发，二来可以让用户加速访问这些资源。BootCDNCDN 提供商
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="免费资源"/>
        
        <category term="Web"/>
        
        <category term="公共 CDN"/>
        
    </entry>
    
    <entry>
        <title>收集常见的公共图床</title>
        <link href="https://blog.nfz.moe/archives/collection-of-image-hosting.html"/>
        <id>https://blog.nfz.moe/archives/collection-of-image-hosting.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-03-31T12:02:00+00:00</published>
        <updated>2018-03-31T12:02:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>为了节省带宽和流量、减少自己服务器的负载、加速网站图片的加载，站长一般会使用专门的图床或者 CDN 服务加载图片。本文就汇总介绍一下我所知道的公共图床，以及我对它们的评价。</p><a></a><p>如果你想查看一下以下图床是否适合你当地的网络环境，你可以访问这个 <a href="https://lab.nfz.moe/image-hosting.html" target="_blank"> 测试页面</a></p><h1><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html# 公共图床"></a>公共图床</h1><blockquote><p>注意！在使用这些公共图床之前，强烈建议阅读这些网站的 TOS（如果有的话）。公共服务运营不易，希望大家珍惜。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html# 微博图床"></a>微博图床 </h2><p> 微博图床堪称国内图床的中流砥柱，很多站长都在用。各种插件和在线上传都层出不穷，使用起来很方便。</p><ul><li>速度：国内国外都非常快</li><li>CDN：国内分别接入使用了蓝汛、网宿、阿里云 CDN、加速乐等，在国外使用了 Akamai CDN、Tierra.Net 的 CDN 等</li><li>HTTPS：支持（不完全支持 HTTP2，得看你被解析到了哪个服务商的节点）</li><li>域名：<ul><li><code>ww1.sinaimg.cn</code> <code>ww2.sinaimg.cn</code> <code>ww3.sinaimg.cn</code> <code>ww4.sinaimg.cn</code></li><li><code>wx1.sinaimg.cn</code> <code>wx2.sinaimg.cn</code> <code>wx3.sinaimg.cn</code> <code>wx4.sinaimg.cn</code></li><li><code>ws1.sinaimg.cn</code> <code>ws2.sinaimg.cn</code> <code>ws3.sinaimg.cn</code> <code>ws4.sinaimg.cn</code></li><li>等等等等。。。</li></ul></li></ul><ul><li><a href="http://photo.weibo.com/photos/upload" target="_blank">上传地址</a></li><li><a href="https://chrome.google.com/webstore/detail/%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A%E5%9B%BE%E5%BA%8A/fdfdnfpdplfbbnemmmoklbfjbhecpnhf/related" target="_blank">Chrome 插件</a></li></ul><blockquote><p>微博图床会把你上传的图片转码成 jpg 格式；会提供三种 缩略图、中等大小、接近原图 三种尺寸的图片；通过 Chrome 插件方式上传需要用户登录才能上传；另外，渣浪微博也曝出过 <strong> 在图片上加新浪 logo 水印的行为 </strong>（不过现在已经去除，但不排除使用了肉眼难以辨别的水印）；另外渣浪的图片鉴定服务容易让你上传的图片消失，所以使用起来还是需要谨慎一些<del> 比如不要上传什么维尼熊之类的图片</del>。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#imgur"></a>imgur</h2><p>这是一家著名的老牌国外图床，2009 年就开始运行了。图片存储稳定可靠。</p><ul><li>速度：国外真的挺快，不过国内半墙</li><li>CDN：FastlyCDN（这家 CDN 的很多节点都被墙了）</li><li>HTTPS：支持（不支持 HTTP2）</li><li>域名：<code>i.imgur.com</code></li><li><a href="https://imgur.com" target="_blank">上传地址</a></li></ul><blockquote><p>追求国内访问速度的还是别用了吧，不过这家图床是真的足够稳定可靠。开放有 API（还有支持免费匿名上传图片的 ClientKey 可以申请），也有很多第三方插件可以用。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#sm-ms- 图床"></a>sm.ms 图床 </h2><p> 这是土豪兽兽建的图床，2015 年开始正式运营。</p><ul><li>速度：<del>现在估计是被滥用了没那么快了 </del> 烧风购买了更多节点、修改了服务架构，现在全球速度还是不错的。</li><li>CDN：烧风自建的 CDN，有香港阿里云、DigitalOcean 欧洲和 Linode 北美等节点</li><li>HTTPS：HTTP 会被 301 跳转 HTTPS（支持 HTTP2）</li><li>域名：<code>ooo.0o0.ooo</code> <code>i.loli.net</code></li><li><a href="https://sm.ms" target="_blank">上传地址</a></li></ul><blockquote><p>支持 API 操作，图片存储非常可靠，V2EX 钦点的图床。iOS 和 Android 应用 <del> 即将开发完毕</del> 已经分别上架 <a href="https://itunes.apple.com/app/sm-ms/id1268411917" target="_blank">iTunes</a> 和 <a href="https://play.google.com/store/apps/details?id=sm.ms" target="_blank">Play Store</a>，甚至有第三方做的 Telegram Bot。在众多公共图床中最看好它和 imgur。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#V2EX- 图床"></a>V2EX 图床 </h2><p> 这是 V2EX 推出的图床服务，需要付费才能使用。</p><ul><li>速度：全球的速度都还挺不错</li><li>CDN：V2 自建的 CDN，东亚地区会解析到台湾节点、国内速度不错。</li><li>HTTPS：支持（支持 HTTP2）</li><li>域名：<code>i.v2ex.co</code></li><li><a href="https://www.v2ex.com/i" target="_blank">上传地址</a></li></ul><blockquote><p>V2 图床需要付费才能解锁使用可能会使一些人望而却步，不过这样可以避免被滥用，所以 V2 图床质量还是挺高的。<br />我把必须保证高度可靠外链的图片托管在上面，比如我的友链信息提供的供大家调用的头像和 favicon，都托管在 V2 图床。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html# 贴图库（不推荐）"></a>贴图库（不推荐）</h2><p>这个图床曾经被严重滥用，几年前还承诺免费，如今想要长期保存图片已经需要付费了。</p><ul><li>速度：<del>国内还是足够快的，国外速度很一般</del> 现在只剩下 CloudFlare，还能说什么呢？</li><li>CDN：<del>之前用过百度云加速 CDN，现在接入了 CloudXNS 牛盾 CDN 和五五互联的 CDN 服务 </del> <del> 现在又重新启用百度云加速了</del> 现在穷的都开始用 CLoudFlare 了</li><li>HTTPS：<del>现在重新接入了百度云加速以后没有启用 HTTPS，怕是为了降低运营成本。</del> 又重新支持了 HTTPS 和 HTTP2，不过是 CloudFlare 的功劳。</li></ul><blockquote><p>免费套餐上传图片只能保存 <del>6 个月</del> 7 天（应国家上级有关部门要求），上传任何图片都需要登录，而且需要付费才能长时间保存。</p></blockquote><p>贴图库接入的 CDN 很不咋地，天天换域名到处各种蹭云加速，我估计只有傻子才会去买他们的服务。祝愿贴图库早日倒闭。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#ONJI- 图床"></a><del>ONJI 图床 </del></h2><p> 图床已经停止运营。</p><ul><li><del>速度：国内速度可以，国外就不行了</del></li><li><del>CDN：百度云加速</del></li><li><del>HTTPS：支持（不支持 HTTP2）</del></li><li><del>域名：<code>cdn.onji.cn</code> <code>api.onji.cn</code></del>~</li></ul><p><del>ONJI 图床的架构很特殊。这个图床有两种使用方式现在只剩下一种了。</del></p><ul><li><del>在 <a href="https://pic.onji.cn" target="_blank">pic.onji.cn</a> 上上传图片，获得链接</del></li><li><del>事先将图片上传到安全可靠的位置，然后使用 API URI：<code>https://api.onji.cn/img/?url=&lt; 原图片的 URL&gt;</code> 加载图片。</del></li></ul><blockquote><p><del>这个图床的架构是，将用户的图片上传到贴吧或者新浪微博的图床（指第一种使用方法）、或者 </del> 用户自己将图片存储在安全可靠、外网可直接访问的地方，并把原图地址填入 API URL；后端会将图片抓取下来分发、缓存到 CDN 上。~~<br /><del>由于第一种方法相当于将图片交到百度或者渣浪手里，所以也需要谨慎。</del></p></blockquote><p><del>由于这个图床被滥用，站长把第一种使用方式关闭了。目前图片抓取和分发的 API 还可以继续使用，大家且用且珍惜吧。</del></p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#VIM-CN- 图床（elimage）"></a>VIM-CN 图床（elimage）</h2><ul><li>速度：国外速度挺快，国内就不行了</li><li>CDN：CloudFlare</li><li>HTTPS：支持（支持 HTTP2）</li><li>域名：<code>img.vim-cn.com</code></li></ul><p>这是 <a href="http://vim-cn.com" target="_blank">vim-cn</a> 提供的图床服务，支持 API 和在线上传，所用程序开源。不过由于使用了 CloudFlare，国内速度就慢多了。图床官网颇有一些年久失修的历史沧桑感，希望不要挂掉。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#OOXX"></a>OOXX</h2><p>V2EX 上找到的一家老牌图床，2013 年就开始运营了，不过 2017 年年初才在 V2EX 上发帖。</p><ul><li>速度：CloudFlare 的网络特点，大家都懂</li><li>CDN：CloudFlare</li><li>HTTPS：支持（支持 HTTP2）</li><li>域名：<code>i.ooxx.ooo</code></li><li><a href="https://ooxx.ooo/" target="_blank">上传地址</a></li></ul><p>V2EX 上的介绍说最早是为了收集一些网络图片作为大数据分析和机器学习用的，所以借用机器闲置的带宽搞了这个图床。运营了四年，看起来还会继续运营下去。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#PostImage"></a>PostImage</h2><ul><li>速度：国外速度杠杠的，国内别被墙就好</li><li>CDN：AdvancedHosted CDN</li><li>HTTPS：支持</li><li>域名：<code>s1.postimg.org</code> <code>s2.postimg.org</code> 等。</li><li><a href="https://postimages.org" target="_blank">上传地址</a></li></ul><p>PostImage 图床的介绍说是为了方便用户在 Facebook 和 Twitter 上传图。这个图床用的 CDN 服务商不太有名。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#UPLOAD-CC"></a>UPLOAD.CC</h2><ul><li>速度：看下面一条用的 CDN</li><li>CDN：CloudFlare</li><li>HTTPS：支持</li><li>域名：<code>upload.cc</code>。</li><li><a href="https://upload.cc" target="_blank">上传地址</a></li></ul><p>这个图床是香港人开的，TOS 写的挺详细的。提供了 Android 版 APP（Google Play 上可下载），还提供有 Chrome 和 Firefox 的插件，挺方便的。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#ImgSafe"></a>ImgSafe</h2><ul><li>速度：看下面一条用的 CDN</li><li>CDN：CloudFlare</li><li>HTTPS：支持</li><li>域名：<code>i.imgsafe.org</code>。</li><li><a href="https://imgsafe.org" target="_blank">上传地址</a></li></ul><p>国外一家图床，网站首页有写着累计有图片托管在这个图床。不过 <em>据说</em> 偶尔会发生图片丢失的情况；大家自己权衡一下吧。还有要注意的就是这个图床仅能通过拖动的方式上传图片，所以手机上就没法传图了。</p><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#ImgBox"></a>ImgBox</h2><ul><li>速度：实在不敢恭维，估计只有在北美地区的访客才能保证最快的速度</li><li>CDN：两台位于美国的 Leaseweb 的服务器</li><li>HTTPS：支持</li><li>域名：<code>i.imgbox.com</code>。</li><li><a href="https://imgbox.com" target="_blank">上传地址</a></li></ul><p>虽然用的服务器挺一般，但是毕竟也是一家国外老牌图床了。自 2010 年起开始运营以来，已经托管了上百万张图片，看起来还是令人放心的。</p><h1><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html# 非“公共”的图床"></a>非“公共”的图床</h1><blockquote><p>由于是“非公共”图床，被滥用的可能性比公共图床要小很多，服务质量自然也相对较高。不过正因为这种灰色地带，让你上传的图片的安全和稳定性得不到保证。自行权衡一下吧。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html# 奇虎图床"></a>奇虎图床 </h2><p> 发现这个“图床”纯属偶然，我打开 <code>firekylin.org</code> 以后习惯性的按下 F12。然后我发现页面的背景图片所在的域名是 <code>p3.ssl.qhimg.com</code><br />我知道 FireKylin 是奇虎 360 最大的前端团队 奇舞团 开发的博客系统，所以这可能是他们内部有的图床接口。<br />不过后来，我在 360 的其它网站，都看到了类似的域名，说明这个图床是也有对外接口的。</p><ul><li>速度：全球的速度都很好</li><li>CDN：奇虎自己的 CDN，部分节点和网宿合作</li><li>HTTPS：支持（支持 HTTP2）</li><li>域名：<ul><li><code>p1.qhimg.com</code> <code>p2.qhimg.com</code> <code>p3.qhimg.com</code> 等等</li><li><code>p1.qhmsg.com</code> <code>p2.qhmsg.com</code> <code>p3.qhmsg.com</code> 等等</li></ul></li></ul><blockquote><p>在这些域名的前端散列符和根域名之间加上 <code>ssl</code>，如 <code>p1.ssl.qhmsg.com</code>，即可支持 HTTPS 和 HTTP2。</p></blockquote><p>公开上传接口：位于 <code>wenda.so.com</code> <code>bbs.360.cn</code>。建议通过后者上传图片，一天只能上传 20 张图片，上传图片的方法就是在 360 论坛（Discuz 驱动）的发帖页面上传图片并插入帖子中，然后右键获得图片地址。</p><blockquote><p>你如果是坚持抵制奇虎 360，你大可以不用这个图床。奇虎的这个图床并不公开，没有像微博图床一样被滥用，所以无需担心有过于严格的审查；图片托管在奇虎图床的风险相比微博图床是要低的，也没有发生过图片丢失的情况。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/collection-of-image-hosting.html#GitHub"></a>GitHub</h2><p>GitHub 一直拥有各种奇怪的用途，被发掘出来当图床也见怪不怪了。</p><ul><li>速度：国内可以接受，海外速度很快</li><li>CDN：Fastly CDN，几个节点在国内都解禁了的</li><li>HTTPS：支持（似乎不支持 HTTP2）</li><li>域名：<code>user-images.githubusercontent.com</code></li></ul><p>上传方式是新建一个 Repo，然后在 Issue 中传图（直接将图片拖动到 issue 输入框即可），GitHub 会将你的图片分发到 GitHub 用的 CDN 中。</p><blockquote><p>这和使用 GitHub Raw 需要 GitHub 的服务器动态生成文件不同，user-image 这个子域名是 GitHub 专门为静态文件准备的，不会让当年某某抢票助手 CC GitHub 的事情重现的。<br />当然，这个接口不是公开的。还有，请善待 GitHub。</p></blockquote>]]></content>
        
        <summary type="html">
            
            为了节省带宽和流量、减少自己服务器的负载、加速网站图片的加载，站长一般会使用专门的图床或者 CDN 服务加载图片。本文就汇总介绍一下我所知道的公共图床，以及我对它们的评价。如果你想查看一下以下图床是否适合你当地的网络环境，你可以访问这个  测试页面公共图床注意！在使用这些公共图
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="博客"/>
        
        <category term="图床"/>
        
        <category term="公共图床"/>
        
        <category term="免费资源"/>
        
    </entry>
    
    <entry>
        <title>在Arch Linux下安装NGINX Amplify</title>
        <link href="https://www.iwch.me/archives/670.html"/>
        <id>https://www.iwch.me/archives/670.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2018-03-29T15:52:00+00:00</published>
        <updated>2018-03-29T15:52:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p><a href="https://www.nginx.com/products/nginx-amplify/" target="_blank">NGINX Amplify</a>是一个很强大的NGINX监控工具。</p><p>官方提供的安装脚本目前只支持在Ubuntu / Debian / CentOS / RHEL环境下运行，在Arch Linux下运行会报错「arch is currently unsupported, apologies!」</p><p><img src="https://static.yecdn.com/static/blog/post/670/amplify-install-script.png" /></p><p>AUR里面的<code>nginx-amplify-agent</code>依赖官方仓库内的Nginx，这对于自己编译Nginx的小朋友们来说不太友好，此外也缺少一些依赖，导致安装后运行不起来，不能拿来直接用。</p><h2>开始安装</h2><p>首先使用yaourt安装<code>nginx-amplify-agent</code>。</p><p>如果你没有安装过yaourt，可以参考<a href="https://www.iwch.me/archives/649.html" target="_blank">这篇文章</a>中的「安装yaourt」部分内容。</p><pre><code>yaourt -S nginx-amplify-agent
</code></pre><p>如果你使用的不是官方仓库内的Nginx，请在这一步选择「编辑PKGBUILD」并删除掉依赖项中的Nginx后再继续安装。</p><p>安装完成后继续安装缺少的依赖。</p><pre><code>pacman -Syu python2-pip python2-scandir
pip2 install crossplane pymysql supervisor daemon_runner daemon
</code></pre><p>全部安装完成后，编辑<code>nginx.conf</code>，加入以下内容到<code>http</code>段落中。</p><pre><code>log_format  main_ext  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; '
                      '&quot;$host&quot; sn=&quot;$server_name&quot; '
                      'rt=$request_time '
                      'ua=&quot;$upstream_addr&quot; us=&quot;$upstream_status&quot; '
                      'ut=&quot;$upstream_response_time&quot; ul=&quot;$upstream_response_length&quot; '
                      'cs=$upstream_cache_status' ;
access_log  /path/to/access.log  main_ext;
error_log  /path/to/error.log warn;
</code></pre><p>新建一个<code>server</code>段落。</p><pre><code>server {
	listen 127.0.0.1:80;
	server_name 127.0.0.1;
	location /nginx_status {
		stub_status on;
		allow 127.0.0.1;
		deny all;
	}
}
</code></pre><p>保存后不要忘了重启Nginx来让这些配置生效。</p><pre><code>nginx -s reload
</code></pre><h2>扩展</h2><p>Amplify除了可以监控Nginx之外，还可以监控PHP-FPM以及MySQL的状态，而且配置起来也十分简单。</p><h3>PHP-FPM</h3><p>编辑<code>/etc/php/php-fpm.d/www.conf</code>，取消注释以下内容。</p><pre><code>listen.owner = http
listen.group = http
listen.mode = 0660
pm.status_path = /status
</code></pre><p>重启PHP-FPM。</p><pre><code>systemctl restart php-fpm
</code></pre><h3>MySQL</h3><p>首先连接到数据库。</p><pre><code>mysql -u root -p
</code></pre><p>新建一个名为<code>amplify-agent</code>的用户。</p><pre><code> CREATE USER 'amplify-agent'@'localhost' IDENTIFIED BY 'xxxxxx';
</code></pre><h2>运行</h2><p>编辑<code>/etc/amplify-agent/agent.conf</code>。</p><pre><code>[credentials]
api_key = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
hostname =
uuid =
imagename =

[nginx]
user = http
configfile = /path/to/nginx.conf
stub_status = http://127.0.0.1/nginx_status
#plus_status = /status
#exclude_logs =

[extensions]
phpfpm = True
mysql = True

[mysql]
host = 127.0.0.1
port = 3306
unix_socket = /var/run/mysqld/mysqld.sock
user = amplify-agent
password = xxxxxx
</code></pre><p>配置好API Key和其他配置项后即可运行Amplify。</p><pre><code>systemctl start amplify-agent
systemctl enable amplify-agent
</code></pre><p><img src="https://static.yecdn.com/static/blog/post/670/amplify-overview.png" /></p></div>]]></content>
        
        <summary type="html">
            
             NGINX Amplify是一个很强大的NGINX监控工具。官方提供的安装脚本目前只支持在Ubuntu / Debian / CentOS / RHEL环境下运行，在Arch Linux下运行会报错「arch is currently unsupported, apologi
            
        </summary>
        
    </entry>
    
    <entry>
        <title>关于 xmapp Apache 访问 localhost/icons 下的文件时返回404的解决方案</title>
        <link href="https://imiku.me/2018/03/29/1022.html"/>
        <id>https://imiku.me/2018/03/29/1022.html</id>
        
        <author>
            <name>Ice-Hazymoon</name>
        </author>
        
        <published>2018-03-29T10:35:13+00:00</published>
        <updated>2018-03-29T10:35:13+00:00</updated>
        
        <content type="html"><![CDATA[<p>今天在使用 xmapp 时, 遇到个很迷的问题, 就是无论怎么访问 localhost/icons 下的文件, 都返回404的错误, 这就很尴尬了, 纠结了半天的配置文件, 最后找到了解决办法</p>
<p>见 <a href="https://stackoverflow.com/questions/4433631/apache-how-to-override-index-of-icons" target="_blank">xampp - apache - how to override index of /icons? - Stack Overflow</a></p>
<p>大概原因就是, 当访问 localhost/icons 下的资源时, Apache会直接读取 /icons 下的图标资源</p>
<p>打开<code>%XAMPP_PATH%\apache\conf\extra\httpd-autoindex.conf</code>文件可以看到:</p>
<pre><code>Alias /icons/ &quot;D:/xampp/apache/icons/&quot;

&lt;Directory &quot;D:/xampp/apache/icons&quot;&gt;
 Options Indexes MultiViews
 AllowOverride None
&lt;/Directory&gt;
</code></pre>
<p>将其注释即可</p>
<pre><code># Alias /icons/ &quot;D:/xampp/apache/icons/&quot;
# 
# &lt;Directory &quot;D:/xampp/apache/icons&quot;&gt;
#     Options Indexes MultiViews
#     AllowOverride None
#     Require all granted
# &lt;/Directory&gt;
</code></pre>
<p>至今没明白为什么会有这么反人类的设计</p>]]></content>
        
        <summary type="html">
            
            今天在使用 xmapp 时, 遇到个很迷的问题, 就是无论怎么访问 localhost/icons 下的文件, 都返回404的错误, 这就很尴尬了, 纠结了半天的配置文件, 最后找到了解决办法 见 xampp - apache - how to override index o
            
        </summary>
        
        <category term="喵喵喵"/>
        
    </entry>
    
    <entry>
        <title>在 Ryzen 平台上安装 macOS High Sierra</title>
        <link href="https://ikk.me/archives/default/install-hackintosh-high-sierra-on-ryzen.html"/>
        <id>https://ikk.me/archives/default/install-hackintosh-high-sierra-on-ryzen.html</id>
        
        <author>
            <name>kookxiang</name>
        </author>
        
        <published>2018-03-28T16:30:00+00:00</published>
        <updated>2018-03-28T16:30:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>首先简单扔下目前电脑配置吧：</p>

<blockquote>
  <p>CPU：<a href="https://www.amd.com/en/products/cpu/amd-ryzen-5-1600x" target="_blank">AMD Ryzen 5 1600X Processor</a></p>
  
  <p>主板：<a href="https://www.asus.com/Motherboards/PRIME-B350M-A/" target="_blank">ASUS PRIME B350M-A</a></p>
  
  <p>内存：<a href="https://www.gskill.com/en/product/f4-3000c16d-16grrb" target="_blank">G.SKILL Ripjaws V Series 16GB (2 x 8GB) DDR4 Memory</a></p>
  
  <p>硬盘：<a href="http://www.samsung.com/semiconductor/ssd/client-ssd/MZVLW256HEHP/" target="_blank">Samsung MZVLW256HEHP (PM961) 256GB SSD</a></p>
  
  <p>硬盘：<a href="https://www.sandisk.com/home/ssd/ultra-3d-ssd" target="_blank">SanDisk 250GB Ultra 3D NAND SATA3 SSD</a></p>
  
  <p>显卡：<a href="https://www.asus.com/Graphics-Cards/STRIXGTX970DC2OC4GD5/" target="_blank">ASUS Strix GEFORCE GTX 970</a></p>
</blockquote>

<p>基本配置就是这些，当然，SanDisk 的 SSD 是为了这次安装黑苹果系统新买的。因为不想影响原有的 Windows 的分区结构。</p>

<p>首先第一步是下载最新的 High Sierra 镜像，并写入到 U 盘（我用的是 SanDisk CZ80，现在最新升级款是 <a href="https://www.sandisk.com/home/usb-flash/extremepro-usb" target="_blank">CZ880</a>）。</p>

<p> &lt; 访问完整版以查看此播放器 &gt; </p>

<p>其实装黑苹果并不是没有苹果设备，相反我手边就有一台 MacBook Pro。黑苹果最诱惑的地方在于它的性能，比如我的 Ryzen 如果拿来日常开发的话构建编译速度绝对比 Intel 的移动 CPU 好得多。</p>

<p>而且，装 High Sierra 首先你需要一台 Mac。</p>



<p>先下载最新的系统镜像：打开 App Store，搜索 High Sierra；等到下载完成后不要点击继续，直接 <kbd><kbd>cmd</kbd> + <kbd>Q</kbd></kbd> 退出安装程序。</p>

<p>首先将 U 盘改成 GPT 格式并格式化成 HFS+：</p>

<p><img src="https://static.ikk.me/uploads/2018/03/3184085165.png" /></p>

<p>然后打开终端，使用命令将安装程序写入 U 盘：</p>

<pre><code>sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --applicationpath /Applications/Install\ macOS\ High\ Sierra.app  --volume /Volumes/kookxiang/
</code></pre>

<p>U 盘写好了以后不要急着推出，下载 <a href="https://mega.nz/#!5DhyEIyB!7gsIIySHfxpsv43YrM8Dp_5mw_Gi6qjzliO1yH01hIg" target="_blank">Ryzen 内核补丁</a> 解压</p>

<p>用 Finder 打开 U 盘，按下 <kbd><kbd>cmd</kbd> + <kbd>shift</kbd> + <kbd>.</kbd></kbd> 显示隐藏文件。</p>

<p>复制压缩包中的 <code>Ryzen_Kernel_10.13/PreInstall/Prelinkedkernel/prelinkedkernel</code> <strong>文件</strong> 到下面的两个目录覆盖：</p>

<ul>
<li>/Volumes/Install macOS High Sierra/.IABootFiles/</li>
<li>/Volumes/Install macOS High Sierra/System/Library/PrelinkedKernels/</li>
</ul>

<p>顺便将 <code>PreInstall</code> 和 <code>PostInstall</code> 两个文件夹放进 U 盘备用。</p>

<p>下载 <a href="http://mackie100projects.altervista.org/download-clover-configurator/" target="_blank">Clover 配置工具</a> 运行，找到左侧的 Mount EFI，挂载 U 盘的 EFI 分区，使用 <a href="//static.ikk.me/uploads/2018/03/496059669.zip">Ryzen_High_Sierra_10.13_EFI.zip</a> 解压覆盖。</p>

<p>确定你的 BIOS 没有开启奇怪的配置，或者直接重置一下，关闭 CSM 模块，这样 Clover 和 Windows 10 开机画面分辨率可以变成 native 的。开启 EHCI 和 XHCI Hands-off，确保 USB 能够正常工作。串口并口这种 20 年前的端口顺便就关了吧，就算开了你也没有对应设备的… HPET 建议打开，由于早期 Ryzen 官方超频软件依赖这个功能我就提前打开了。</p>

<p>需要注意的是直到 Clover 安装完成前硬盘都是没办法启动的，建议在 BIOS 中选择首选启动方式为 U 盘，使用 U 盘中的 Clover 启动安装程序或安装好的系统。</p>

<p>如果你像我这样比较慌，可以把 M.2 SSD 拆了，拔掉其他硬盘的 SATA 线，避免手滑一时爽。</p>

<p>接下来就可以使用 U 盘启动了，在 Clover 画面中选择 U 盘，稍等片刻就可以进入安装界面。如果出现禁止符号，别慌，这是玄学问题，洗洗脸重启几次就好了。</p>

<p>进入安装界面以后，点击上面的实用工具 - 磁盘工具。分区并格式化这里应该就不用说了，<strong>但是需要记住磁盘的名字</strong>，比如我这里用的 <code>Hackintosh</code>，中间不要空格。完成后退出回到主界面，接下来就跟白苹果一样一路下一步了。</p>

<p>安装完成后会自动重启，但是不要进入系统！</p>

<p>还记得我们的 PreInstall 和 PostInstall 吗？选择从安装 U 盘启动，打开终端，执行 <code>/Volumes/Image\ Volume/PreInstall/pre</code>，填写上一步中的磁盘名称。如果磁盘名称有空格或者其他特殊字符的，自己改脚本吧…</p>

<p>这一步的主要目的是复制补丁文件并替换系统内核为 Ryzen 修改版。</p>

<p>如果没有报错，重启电脑，选择从 Hackintosh 启动，会开始走进度条，其实这才是真正的系统安装过程。</p>

<p>等待进度条走完后再次选择从安装盘启动，打开终端，执行 <code>/Volumes/Image\ Volume/PostInstall/post</code> 替换内核。</p>

<p>替换好后重启，选择从 Hackintosh 盘启动，配置系统并创建账号。<br />
这里不推荐绑定 iCloud，进了系统在绑都不迟。</p>

<p>系统部分基本就 OK 了，接下来需要安装 Clover，可以下载之前提到的 <a href="http://mackie100projects.altervista.org/download-clover-configurator/" target="_blank">Clover 配置工具</a>，同时挂载 U 盘和系统盘的 EFI 分区，将 U 盘的 EFI 文件夹复制到系统盘上，出现覆盖提示时选择”合并“。</p>

<p>接下来可以删除一些安装程序用的兼容组件，推出 U 盘，打开 <code>/Volumes/EFI/EFI/Clover/kexts/Other</code> 文件夹，删除 <code>DummyUSBXHCIPCI.kext</code>、<code>DummyUSBEHCIPCI.kext</code>、<code>GenericUSBXHCI.kext</code> 三个补丁。</p>

<p>为了让 Ryzen 在 macOS 下全速运行，使用 Clover 配置工具 打开 clover.plist，在启动参数中增加 <code>busratio=xx</code>，其中 xx 为倍频。例如我这块 1600X 日常超频到了 3.8G，那么这里就写成 <code>busratio=38</code>，因为 Ryzen 超频基本都是超倍频，外频默认都是 100MHz，如果你改了外频的自己慢慢算吧。</p>

<p>GTX 970 驱动还是比较简单的，首先到 Clover 配置工具 中点击安装驱动，点击安装 <code>EmuVariableUefi</code>，到 NVIDIA 下载 <a href="https://images.nvidia.com/mac/pkg/387/WebDriver-387.10.10.10.25.156.pkg" target="_blank">最新的 Web Driver</a> 安装即可。</p>

<p>由于苹果本身配的显卡就是 ATI 的，所以 A 卡用户基本可以免驱动跑，有问题再搜吧。</p>

<p>确认基本 OK 后，重启，这回终于可以脱离 U 盘开机了，确认各功能都正常就告一段落了。</p>

<p>最后晒图：</p>

<p><img src="https://static.ikk.me/uploads/2018/03/4065874831.png" /></p>

<p><img src="https://static.ikk.me/uploads/2018/03/1364660378.png" /></p>]]></content>
        
        <summary type="html">
            
            首先简单扔下目前电脑配置吧：     CPU：AMD Ryzen 5 1600X Processor      主板：ASUS PRIME B350M-A      内存：G.SKILL Ripjaws V Series 16GB (2 x 8GB) DDR4 Memory  
            
        </summary>
        
    </entry>
    
    <entry>
        <title>ModSecurity 3.0 —— 强大的 WAF 工具</title>
        <link href="https://dcc.cat/modsecurity.html"/>
        <id>https://dcc.cat/modsecurity.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-03-26T05:19:00+00:00</published>
        <updated>2018-03-26T05:19:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>关于 ModSecurity 3.0</h2><p>ModSecurity 其实也有很久的历史了，原本是 Apache 上的一款开源 WAF 模块，可以有效的增强 Web 安全性。然后逐渐支持Nginx 和 IIS，配合 Nginx 的灵活和高效可以打造成生产级的 WAF，是保护和审核 Web 安全的利器。</p><p>在 <code>ModSecurity 2.0</code> 时代，ModSecurity 对于 Nginx 的支持一直很不完善，性能损耗比较大，还有内存泄漏的 bug 一直没有很好的解决，所以使用 <code>Naxsi</code> 会相对更好一些。然而到了 <code>ModSecurity 3.0</code> 时代，情况反转了，得益于 <code>libmodsecurity</code> 的引入，ModSecurity 与 Nginx 兼容性、性能方面都大大提升。于此同时，ModSecurity 3.0 还作为 <code>Nginx-Plus</code> 官方钦定 WAF 引入了商业市场，有官方背书，可靠性自然得以保证。反观 Naxsi，在诸如 <code>HTTP/2</code> 等新特性支持方面一直慢半拍。</p><p><code>Nginx-Plus</code> 的 WAF 是作为一个商业产品售卖的，然而实际上就是官方帮你编译好了一个 <code>libmodsecurity</code>，普通用户无需购买几千刀一年的 <code>Nginx-Plus</code>，也可以享受到 <code>ModSecurity 3.0</code> 这款优秀的防火墙。</p><h2>安装 ModSecurity 3.0</h2><h3>编译 libmodsecurity</h3><blockquote>编译 <code>libmodsecurity</code> 需要的硬件配置其实是蛮高的，性能低一些的机器（1U 512M 那种）基本是很难编译成功的。</blockquote><ul><li><strong>首先安装必备软件包：</strong></li></ul><pre><code>apt install -y apt-utils autoconf automake build-essential git libcurl4-openssl-dev libgeoip-dev liblmdb-dev libpcre++-dev libtool python-dev libxml2-dev libyajl-dev pkgconf wget zlib1g-dev screen liblua5.3-dev</code></pre><ul><li><strong>下载并编译 libmodsecurity：</strong></li></ul><pre><code>git clone --depth 1 -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity.git &amp;&amp; cd ModSecurity
git submodule init &amp;&amp; git submodule update
./build.sh &amp;&amp; ./configure
screen make &amp;&amp; make install</code></pre><p>make 花费的时间应该比较久，可以耐心的喝杯茶等待</p><h3>编译 <code>Modsecurity-Nginx</code>：</h3><pre><code>git clone --depth 1 https://github.com/SpiderLabs/ModSecurity-nginx.git</code></pre><p><strong>在编译 Nginx 时加上参数 <code>--with-compat --add-module=../ModSecurity-nginx</code> 即可。</strong></p><p>带上这个模块的话，Nginx 的编译也要用上不少时间。</p><h2>配置 ModSecurity 和 <code>OWASP-CRS</code> 规则：</h2><p>这部分的设置其实比较复杂，首先解释一下什么是 <code>OWASP-CRS</code>，OWASP 是一个安全社区，开发和维护着一套免费的应用程序保护规则，这就是所谓 OWASP 的 ModSecurity 的核心规则集(即CRS)。ModSecurity 之所以强大就在于 OWASP 提供的规则，我们可以根据自己的需求选择不同的规则，也可以通过 ModSecurit y手工创建安全过滤器、定义攻击并实现主动的安全输入验证。</p><p>ModSecurity CRS 提供以下类别的保护来防止攻击：</p><blockquote>HTTP Protection(HTTP防御)；<br />Real-time Blacklist Lookups(实时黑名单查询)；<br />HTTP Denial of Service Protections(HTTP的拒绝服务保护)；<br />Common Web Attacks Protection(常见的Web攻击防护)；<br />Automation Detection(自动化检测)；<br />Integration with AV Scanning for File Uploads(文件上传防病毒扫描)；<br />Tracking Sensitive Data(跟踪敏感数据)；<br />Trojan Protection(木马防护)；<br />Identification of Application Defects(应用程序缺陷的鉴定)；<br />Error Detection and Hiding(错误检测和隐藏)</blockquote><h3>安装配置 <code>ModSecurity CRS</code></h3><ul><li><strong>创建配置和规则文件</strong></li></ul><pre><code>cd /etc/nginx &amp;&amp; git clone --depth 1 -b v3.0/master https://github.com/SpiderLabs/owasp-modsecurity-crs.git modsec &amp;&amp; cd modsec

wget https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended &amp;&amp; mv modsecurity.conf-recommended modsecurity.conf &amp;&amp; mv crs-setup.conf.example crs-setup.conf &amp;&amp; cd rules &amp;&amp; mv RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.example RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf &amp;&amp; mv REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf &amp;&amp; cd ..

sed -i 's/SecRuleEngine DetectionOnly/SecRuleEngine On/' /etc/nginx/modsec/modsecurity.conf

cat &gt;&gt; /etc/nginx/modsec/main.conf &lt;&lt; EOF
# Include the recommended configuration
Include /etc/nginx/modsec/modsecurity.conf
# OWASP CRS v3 rules
Include /etc/nginx/modsec/crs-setup.conf
Include /etc/nginx/modsec/rules/*.conf
EOF</code></pre><ul><li><strong>在 Nginx <code>vhost 配置中</code>引入</strong></li></ul><p>我的配置直接写在了 Typecho 全局 location 的位置：</p><pre><code>location / {
    try_files $uri $uri/ /index.php$is_args$args;
    modsecurity on;
    modsecurity_rules_file /etc/nginx/modsec/main.conf;
}</code></pre><h4>进一步修改和增强 <code>crs-setup.conf</code></h4><p><strong>修改被屏蔽的措施</strong></p><p>找到 <code>SecDefaultAction</code> 配置项，默认的情况是 <code>phase:1,log,auditlog,pass</code> 将其<strong>用 <code>#</code> 注释</strong>，然后找到 <code>SecDefaultAction &quot;phase:1,log,auditlog,deny,status:403&quot;</code> 这对应两行，取消注释，然后将 <code>status</code> 设置为 <code>444</code>，即如果触犯规则直接拒绝相应，或者你也可以选择 <code>SecDefaultAction &quot;phase:1,log,auditlog,redirect:'http://%{request_headers.host}/',tag:'Host: %{request_headers.host}'&quot;</code>，并且设置跳转页面，即如果触犯规则就跳转到某个页面。</p><p><strong><code>HTTP Policy Settings</code></strong></p><pre><code>SecAction \
 &quot;id:900200,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.allowed_methods=GET HEAD POST OPTIONS'&quot;</code></pre><p>找到这一块设置，并且取消注释，即只允许特定的 HTTP 访问方式。</p><p><strong><code>Project Honey Pot HTTP Blacklist</code></strong></p><p><code>Honey Pot</code> 即俗称的“蜜罐”，由专业公司维护，通过公开蜜罐的方式采集了一大批从事网络攻击的 <code>Bad IP</code>。<br />在 <a href="https://www.projecthoneypot.org/httpbl_configure.php">官网</a> 注册并获取 <code>API KEY</code>，然后修改如下配置：</p><pre><code>SecHttpBlKey xxxxxxxxx (填你的API KEY)
SecAction &quot;id:900500,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.block_search_ip=1,\
  setvar:tx.block_suspicious_ip=1,\
  setvar:tx.block_harvester_ip=1,\
  setvar:tx.block_spammer_ip=1&quot;</code></pre><p><strong><code>GEO IP</code></strong><br />如果你想屏蔽特定国家的 IP，可以修改如下配置：</p><pre><code>SecGeoLookupDB util/geo-location/GeoIP.dat

SecAction \
 &quot;id:900600,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.high_risk_country_codes='UA ID YU LT EG RO BG TR RU PK MY CN&quot;</code></pre><p>更新 GEO IP 库需要在 <code>/etc/nginx/modsec/util</code> 下执行 <code>python upgrade.py --geoip</code>。<br />然后在 <code>tx.high_risk_country_codes</code> 中填写要屏蔽的国别缩写即可。</p><p><strong><code>DDoS Protection</code></strong></p><p>这边的防护属于 L7 防御，单个 IP 在某指定段时间访问过于频繁就予以屏蔽。<br />有个优点是这边的屏蔽只计算动态访问而不考虑静态文件，因为 Nginx 处理静态文件非常高效一般不是瓶颈。</p><pre><code>SecAction \
 &quot;id:900700,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.dos_burst_time_slice=10',\
  setvar:'tx.dos_counter_threshold=20',\
  setvar:'tx.dos_block_timeout=86400'&quot;</code></pre><p>基本的介绍就这么多，还有更高级的配置这边就不多介绍了。</p><p>接下来 <code>service nginx restart</code> 然后享受 <code>ModSecurity 3.0</code> 带来的防护吧。</p>]]></content>
        
        <summary type="html">
            
            关于 ModSecurity 3.0ModSecurity 其实也有很久的历史了，原本是 Apache 上的一款开源 WAF 模块，可以有效的增强 Web 安全性。然后逐渐支持Nginx 和 IIS，配合 Nginx 的灵活和高效可以打造成生产级的 WAF，是保护和审核 Web
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Amplify —— 深度整合的全方位监控</title>
        <link href="https://dcc.cat/amplify.html"/>
        <id>https://dcc.cat/amplify.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-03-25T14:07:00+00:00</published>
        <updated>2018-03-25T14:07:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>关于 Amplify</h2><p><strong>首先来一段官方的介绍：</strong></p><blockquote><p>Nginx Amplify 是全面的系统监测工具。借助 Nginx Amplify，您可以轻松分析和解决与运行 NGINX 的 Web 应用程序相关的问题。<br />Nginx Amplify 可以让您：</p><ul><li>可视化并识别 NGINX 性能瓶颈，服务器过载或潜在的DDoS攻击</li><li>通过智能建议改进和优化 NGINX 性能</li><li>在应用程序基础出现问题时收到通知</li><li>规划 Web 应用程序的容量和性能</li><li>跟踪运行 NGINX 的系统</li></ul></blockquote><p>实际上 <code>Amplify</code> 不仅能监控 Nginx 的运行情况，还能监控 <code>php-fpm</code> <code>MySQL</code> 和操作系统本身的运行状况，我大致统计了一下它的监控内容：</p><pre><code>Nginx：连接数、请求数、HTTP 状态、文件读写、缓存状态、系统 CPU、IO、内存占用、后段负载均衡状态等等
PHP-FPM：连接数、请求队列、占用线程状态、慢请求状态等
MySQL：连接数、请求数、读、写、增、删状态、慢查询、连接状态、线程占用等
系统资源：CPU、IO、RAM、SWAP、网络、硬盘状态等</code></pre><p><strong>几乎是所有能想象到的监控项目，都是以直观的图表显示，而且能自定义监控项目进行提醒。</strong></p><p>市面上有非常多的服务器运行状态监控的程序，但是 <code>Amplify</code> 的优点在于：</p><ul><li>由 Nginx 官方团队开发，而且完全开源，可信度方面要相对高于其他第三方监控程序</li><li>和 Nginx 深度整合，直接读取 Nginx 状态，对 Web 的监控来说更加准确可靠</li><li>资源占用非常低，几乎 0 CPU 和内存占用</li><li>后台比较美观，自定义状态提醒和预警功能非常好用</li></ul><p>这边有一些截图可以参考：</p><p><img src="https://i.loli.net/2018/03/25/5ab7bb3754cac.png" /><br /><img src="https://i.loli.net/2018/03/25/5ab7bb3754c47.png" /><br /><img src="https://i.loli.net/2018/03/25/5ab7bb36f37ab.png" /></p><h2>Amplify 的安装和使用</h2><h3>安装 python 2.7</h3><pre><code>apt install python-dev -y &amp;&amp; pip install -U pip setuptools</code></pre><h3>安装并开启 Amplify</h3><p><strong>首先需要给 Nginx 安装 <code>stub_status</code> 模块</strong></p><p>编译 Nginx 时添加参数 <code>--with-http_stub_status_module</code> 即可<br />具体的编译过程可以参考 <strong><a href="https://dcc.cat/nginx.html">之前的教程</a></strong></p><h3><a href="https://amplify.nginx.com/signup/">点击注册 Amplify</a></h3><p><strong>选择 <code>New System</code> 开始安装</strong><br /><strong>以 <code>root</code> 用户执行：</strong></p><pre><code>curl -L -O https://github.com/nginxinc/nginx-amplify-agent/raw/master/packages/install.sh
API_KEY='xxxxxxxxxxxxxxxxxxxx' sh ./install.sh</code></pre><p><strong>注意填写自己的 <code>API KEY</code></strong></p><h3>配置 Amplify</h3><h4>Nginx 配置</h4><p><strong> 在 <code>nginx.conf</code>的<code>http</code> 中添加修改如下配置：</strong></p><pre><code>log_format  main_ext
    '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
    '$status $body_bytes_sent &quot;$http_referer&quot; '
    '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; '
    '&quot;$host&quot; sn=&quot;$server_name&quot; '
    'rt=$request_time '
    'ua=&quot;$upstream_addr&quot; us=&quot;$upstream_status&quot; '
    'ut=&quot;$upstream_response_time&quot; ul=&quot;$upstream_response_length&quot; '
    'cs=$upstream_cache_status' ;
                      
access_log  /var/log/nginx/access.log  main_ext;
error_log  /var/log/nginx/error.log warn;
############################################################################
server {
    listen 127.0.0.1:80;
    server_name 127.0.0.1;
    location /nginx_status {
        stub_status on;
        allow 127.0.0.1;
        deny all;
    }
}
############################################################################</code></pre><h4>php-fpm 配置</h4><p>这个配置的位置可能有些不一样，具体需要找一下，修改的内容为：</p><pre><code>listen.owner = www-data
listen.group = www-data
listen.mode = 0660

pm.status_path = /php_status</code></pre><h4>MySQL 配置</h4><p>就是在数据库中创建一个对应的用户：</p><pre><code>mysql -u root -p
[..]
mysql&gt; CREATE USER 'amplify-agent'@'localhost' IDENTIFIED BY 'xxxxxx';

mysql -u amplify-agent -p
..
mysql&gt; show global status;</code></pre><h4>修改 Amplify 配置</h4><pre><code>vi /etc/amplify-agent/agent.conf</code></pre><p>基本上只需修改如下部分就可以啦：</p><pre><code>[nginx]
user = www-data
configfile = /etc/nginx/nginx.conf
stub_status = /nginx_status
#plus_status = /status
#exclude_logs =

[extensions]
phpfpm = True
mysql = True

[mysql]
host = 127.0.0.1
port = 3306
unix_socket = /var/run/mysqld/mysqld.sock
user = amplify-agent
password = xxxxxxxxxxxxxxxxx</code></pre><h4>重启服务</h4><pre><code>service nginx restart &amp;&amp; service php-fpm restart
service amplify-agent restart</code></pre><p>等待一会就可以看到图表完全显示啦！</p>]]></content>
        
        <summary type="html">
            
            关于 Amplify首先来一段官方的介绍：Nginx Amplify 是全面的系统监测工具。借助 Nginx Amplify，您可以轻松分析和解决与运行 NGINX 的 Web 应用程序相关的问题。Nginx Amplify 可以让您：可视化并识别 NGINX 性能瓶颈，服务器
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Google 用什么 Nginx?</title>
        <link href="https://dcc.cat/nginx-google.html"/>
        <id>https://dcc.cat/nginx-google.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-03-22T09:18:00+00:00</published>
        <updated>2018-03-22T09:18:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>简单介绍</h2><p>Nginx 是一个异步框架的 Web服务器，也可以用作反向代理，负载平衡器 和 HTTP缓存，由于其开源和高性能高并发的特点，被多种网站广泛使用，其中自然也少不了 Google。显然 Google 不会直接使用官方版的 Nginx 或是 Nginx-Plus，而是自己维护一个 Nginx 分支，据称有显著提升了性能，今天就拿 <code>Google-Nginx</code> 来测试了一下。</p><h2>编译安装 <code>Nginx-Google</code></h2><blockquote>操作环境：Debian 9.4</blockquote><h3>安装 Bazel</h3><p>与一般使用 <code>GCC / Clang</code> 编译不同，Google 推荐使用 <code>Bazel</code> 来编译 Nginx，首先安装 <code>Bazel</code>：</p><pre><code>sudo apt -y install openjdk-8-jdk

echo &quot;deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8&quot; | sudo tee /etc/apt/sources.list.d/bazel.list
curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -

sudo apt update &amp;&amp; sudo apt install bazel pkg-config zip g++ zlib1g-dev unzip python-dev cmake build-essential autoconf automake libjemalloc-dev libssl-dev git software-properties-common -y </code></pre><h3>编译安装 Nginx</h3><pre><code>cd /usr/local/src
git clone https://nginx.googlesource.com/nginx
cd nginx
bazel build :nginx-google.deb</code></pre><p>编译速度提升非常明显，而且编译过程也非常快速，编译完成后会生成一些  <code>bazel</code> 开头的文件夹指向编译目录 <code>/root/.cache/bazel/</code> 下的中间文件和生成文件。一般我们会去执行 <code>make install</code> 来进行安装，这边也有一些不同。</p><p>进入<strong>生成文件目录 <code>bazel_bin</code> </strong>，可以看到有编译生成的  <code>deb</code> 文件  <strong><code>ngbinx-google.deb</code></strong>，直接安装即可：</p><pre><code>sudo dpkg -i nginx-google.deb</code></pre><p>你甚至可以拷贝该文件到其他机器上来安装。</p><h2>一些特有的配置</h2><p>上面说到 Google 对 Nginx 做了一些强化，配置显然也会有所不同，选择最有特点的两项介绍一下：</p><h3>Brotli</h3><pre><code>gzip on;
gunzip on;
gzip_vary on;
gzip_comp_level 6;
gzip_buffers 1024 8k;
gzip_min_length 512;
gzip_proxied any;
gzip_disable &quot;msie6&quot;;
gzip_http_version 1.1;
gzip_types text/xml text/plain text/css text/x-component application/json text/javascript application/xml application/xml+rss application/font-woff application/vnd.ms-fontobject application/vnd.apple.mpegurl application/javascript application/x-javascript image/svg+xml image/x-icon font/truetype font/opentype;

brotli on;
brotli_static on;
brotli_min_length 20;
brotli_buffers 1024 8k;
brotli_comp_level 6;
brotli_types text/xml text/plain text/css text/x-component application/json text/javascript application/xml application/xml+rss application/font-woff application/vnd.ms-fontobject application/vnd.apple.mpegurl application/javascript application/x-javascript image/svg+xml image/x-icon font/truetype font/opentype;</code></pre><h3>BoringSSL</h3><p>BoringSSL 是 Google 从 OpenSSL 拉出来的一个独立发展的分支，目前跟 OpenSSL 相比已经有很多不同之处了。BoringSSL 支持了一种名为「等价加密算法组（Equal preference cipher groups）」的配置，会被自动选择不同的加密算法应用于最合适的场景（支持 AES-NI 优先使用 AES-GCM，否则优先使用 ChaCha20）</p><h3>补充 <code>Nginx-Google</code> 的完整编译参数</h3><pre><code>nginx version: nginx/1.13.12
built by Bazel
built by gcc 6.3.0 20170516 (Debian 6.3.0-18+deb9u1) 
built with OpenSSL 1.1.0 (compatible; BoringSSL) (running with BoringSSL)
TLS SNI support enabled
configure arguments: --prefix=/etc/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --user=nginx --group=nginx --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/cache/nginx/client_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --with-compat --with-threads --with-poll_module --with-select_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-openssl=//external:boringssl --with-pcre=//external:pcre --with-pcre-jit --with-zlib=//external:zlib --add-module=//ngx_brotli:http_brotli_filter --add-module=//ngx_brotli:http_brotli_static</code></pre><h2>自行实现 <code>nginx-google</code> 部分功能</h2><p>不考虑 Google 自行实现的一些 patch 以外，<code>nginx-google</code> 最特别的就是他的 <code>BoringSSL</code> 了，Cloudflare 也使用了 <code>BoringSSL</code> 作为钦定的 SSL 模块，下面就来示范编译，并支持 <code>TLSv1.3</code>：</p><p><strong>具体编译部分请参考 <a href="https://dcc.cat/nginx.html">Nginx 编译安装教程</a></strong></p><h3>安装编译必备软件</h3><p>这边都是选择的都是包安装的方式，如果条件允许，<strong>尽量编译安装相应最新版本</strong>。</p><pre><code>apt install golang cmake clang build-essential -y</code></pre><h3>下载 <code>BoringSSL</code> 并预编译</h3><pre><code>git clone -b master https://github.com/S8Cloud/boringssl &amp;&amp; cd boringssl

mkdir build &amp;&amp; cd build
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_POSITION_INDEPENDENT_CODE:BOOL=true -DOPENSSL_NO_ASM=1 -DOPENSSL_SMALL=1 .. &amp;&amp; make -j2
cd .. &amp;&amp; mkdir -p .openssl/lib &amp;&amp; cd .openssl &amp;&amp; ln -s ../include .
cd .. &amp;&amp; cp build/crypto/libcrypto.* build/ssl/libssl.* .openssl/lib &amp;&amp; cd ..</code></pre><p>上面的过程看起来还是非常繁琐的，实际上也是。</p><h3>其他 Nginx 模块</h3><h4>Brotli 模块</h4><blockquote>选择了 Google 员工维护的最新版 Brotli</blockquote><pre><code>git clone https://github.com/eustas/ngx_brotli
cd ngx_brotli &amp;&amp; git submodule update --init &amp;&amp; cd ../</code></pre><h4>zlib 库</h4><blockquote>选择了 Cloudflare 魔改版的 zlib，显著提高了性能，仅仅适用于 Nginx 相关的应用，不适合替换系统的 zlib 库</blockquote><pre><code>git clone https://github.com/cloudflare/zlib
cd zlib &amp;&amp; ./configure &amp;&amp; cd ../</code></pre><h4>pcre 库</h4><blockquote>当然是选择最新版啦</blockquote><pre><code>wget -c https://ftp.pcre.org/pub/pcre/pcre-8.42.zip &amp;&amp; unzip pcre-8.42.zip &amp;&amp; rm pcre-8.42.zip
cd pcre-8.42 &amp;&amp; ./configure &amp;&amp; cd .. &amp;&amp; mv pcre-8.42 pcre</code></pre><h4>pagespeed 模块</h4><pre><code>wget -c https://github.com/apache/incubator-pagespeed-ngx/archive/v1.13.35.2-stable.zip &amp;&amp; unzip v1.13.35.2-stable.zip &amp;&amp; rm v1.13.35.2-stable.zip &amp;&amp; cd incubator-pagespeed-ngx-1.13.35.2-stable
wget -c https://dl.google.com/dl/page-speed/psol/1.13.35.2-x64.tar.gz &amp;&amp; tar -xzvf 1.13.35.2-x64.tar.gz &amp;&amp; rm 1.13.35.2-x64.tar.gz &amp;&amp; cd .. &amp;&amp; mv incubator-pagespeed-ngx-1.13.35.2-stable pagespeed </code></pre><h4>Headers-more 模块</h4><pre><code>wget https://github.com/openresty/headers-more-nginx-module/archive/v0.33.zip &amp;&amp; unzip v0.33.zip &amp;&amp; rm v0.33.zip &amp;&amp; mv headers-more-nginx-module-0.33 headers-more-nginx-module</code></pre><h4>其他模块</h4><p><strong>已知 <code>Nginx-ct 模块</code>存在不兼容情况，<code>Lua 模块</code>理论上也是不兼容的。</strong></p><h3>编译 Nginx</h3><pre><code>git clone https://github.com/S8Cloud/sslpatch
wget -c https://nginx.org/download/nginx-1.15.0.tar.gz &amp;&amp; tar zxf nginx-1.15.0.tar.gz &amp;&amp; rm nginx-1.15.0.tar.gz &amp;&amp; cd nginx-1.15.0
patch -p1 &lt; ../sslpatch/Nginx-cloudflare-combined-dcc.patch
patch -p1 &lt; ../sslpatch/BoringSSL-enable-OCSP.patch</code></pre><p>编译参数调整如下：</p><pre><code>./configure --build=nginx-dcc --with-cc-opt='-m64 -march=native -DTCP_FASTOPEN=23 -g -O3 -fstack-protector-strong -flto -fuse-ld=gold --param=ssp-buffer-size=4 -Wformat -Wno-error -fPIC -D_FORTIFY_SOURCE=2' --with-ld-opt='-lrt -ljemalloc -Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -fPIC' \
--prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \
--user=www-data --group=www-data \
--with-compat --with-file-aio --with-threads --with-poll_module --with-select_module --with-http_ssl_module --with-http_spdy_module --with-http_v2_module --with-http_v2_hpack_enc \
--with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_sub_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_degradation_module --with-http_secure_link_module --with-http_slice_module --with-http_stub_status_module \
--with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_ssl_preread_module \
--with-libatomic --with-zlib=../zlib --with-pcre=../pcre --with-pcre-jit \
--with-openssl=../boringssl --add-module=../ngx_brotli --add-dynamic-module=../pagespeed --add-dynamic-module=../headers-more-nginx-module --add-dynamic-module=../ModSecurity-nginx</code></pre><p><strong>参数跑完成功以后一定要改一下 <code>BoringSSL</code> 的时间戳再编译</strong></p><pre><code>touch ../boringssl/.openssl/include/openssl/ssl.h
make -j2 &amp;&amp; make install</code></pre><h3>开启 <code>TLSv1.3 draft-23 &amp;&amp; draft-28</code></h3><p><strong>参数调整为如下即可：</strong></p><pre><code>ssl_protocols TLSv1.3 TLSv1.2 TLSv1.1 TLSv1;
ssl_ciphers '[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305]:[ECDHE-RSA-AES128-GCM-SHA256|ECDHE-RSA-CHACHA20-POLY1305]:ECDHE-ECDSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:AES128-SHA:DES-CBC3-SHA';
ssl_ecdh_curve X25519:P-256;
ssl_prefer_server_ciphers on;</code></pre><blockquote>你会发现上面并没有 <code>TLSv1.3</code> 的 <code>ciphers</code>，是的你没有看错！就是有这样的操作。</blockquote><h3>开启 OCSP Staping</h3><blockquote>以本站 comodo 证书为例</blockquote><pre><code>openssl ocsp -no_nonce \
    -respout /etc/ssl/ocsp.resp \
    -issuer  intermediate.pem \
    -cert    website.pem \
    -CAfile  ca-bundle.pem \
    -VAfile  ca-bundle.pem \
    -url     http://ocsp.comodoca.com/ </code></pre><p><code>website.pem</code> 为站点证书，<code>intermediate.pem</code> 为<strong>中间证书+根证书</strong>，如果执行成功可以看到有 <code>/etc/ssl/ocsp.resp</code> 文件出现，即缓存的 <code>ocsp_stapling_file</code>。</p><p>在 nginx 站点配置文件中添加如下内容即可：</p><pre><code>ssl_stapling on;
ssl_stapling_file /etc/ssl/ocsp.resp;</code></pre><p><strong>注意 <code>ocsp_stapling_file</code> 7 天要更新一次</strong></p><p>查看 SSLLABS 的测试吧：</p><p><strong>注意目前需要在最新版 <a href="https://dev.ssllabs.com">SSLLABS</a> 上进行测试：</strong></p><p><img src="https://www.dcc.yecdn.com/img/boringssl.png" /></p>]]></content>
        
        <summary type="html">
            
            简单介绍Nginx 是一个异步框架的 Web服务器，也可以用作反向代理，负载平衡器 和 HTTP缓存，由于其开源和高性能高并发的特点，被多种网站广泛使用，其中自然也少不了 Google。显然 Google 不会直接使用官方版的 Nginx 或是 Nginx-Plus，而是自己维
            
        </summary>
        
    </entry>
    
    <entry>
        <title>下一部手机想买华为Mate系旗舰了，不刷机好好用</title>
        <link href="https://www.mokeyjay.com/archives/2148"/>
        <id>https://www.mokeyjay.com/archives/2148</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-03-22T01:14:27+00:00</published>
        <updated>2018-03-22T01:14:27+00:00</updated>
        
        <content type="html"><![CDATA[下一部手机想买华为Mate系旗舰了，不刷机好好用]]></content>
        
        <summary type="html">
            
            下一部手机想买华为Mate系旗舰了，不刷机好好用
            
        </summary>
        
        <category term="杂谈"/>
        
    </entry>
    
    <entry>
        <title>吃我一发人体工程学鼠标的安利啦！</title>
        <link href="https://www.mokeyjay.com/archives/2145"/>
        <id>https://www.mokeyjay.com/archives/2145</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-03-21T01:59:08+00:00</published>
        <updated>2018-03-21T01:59:08+00:00</updated>
        
        <content type="html"><![CDATA[起初刚读信息技术系没多久，就听说鼠标手厉害。于是买了 微软人体工程学键盘 4000 和 多彩人体工程学鼠标 刚开始呢，我觉得人体工程学鼠标是反人类的，用着非常别扭。毕竟我当时也用了快 10 年的普通鼠标了，一下子没习惯过来 后来我把鼠标腕托拆掉了，顿时感觉好了很多。约一星期后就能比较自如地日常使用鼠标了 坚持使用，大概一个月后 FPS 游戏水平基本和普通鼠标一样了 然而还是很菜 回头来看，不知不觉]]></content>
        
        <summary type="html">
            
            起初刚读信息技术系没多久，就听说鼠标手厉害。于是买了 微软人体工程学键盘 4000 和 多彩人体工程学鼠标 刚开始呢，我觉得人体工程学鼠标是反人类的，用着非常别扭。毕竟我当时也用了快 10 年的普通鼠标了，一下子没习惯过来 后来我把鼠标腕托拆掉了，顿时感觉好了很多。约一星期后就
            
        </summary>
        
        <category term="分享"/>
        
        <category term="杂谈"/>
        
    </entry>
    
    <entry>
        <title>一分钟吃完「谷阿莫凤梨酥」</title>
        <link href="https://i-meto.com/amogood-pineapple-cakes/"/>
        <id>https://i-meto.com/amogood-pineapple-cakes/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2018-03-19T14:07:39+00:00</published>
        <updated>2018-03-19T14:07:39+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>大家好，今天要说一个快递怎么那么慢但吃起来超好吃的「谷阿莫凤梨酥」的故事。</p>

<p>半个月前，故事中的男主角爱犬男，在网上闲逛的时候突然就发现了这个看起来怎么这么贵的凤梨酥，然后就被视频中的大魔王忽悠掏钱买了这个怎么这么贵但看起来超好吃的「谷阿莫凤梨酥」。</p>
<p>紧接着半个月过去了，正当爱犬男在路上闲逛的时候收到了一条勒索讯息：「你的哄梨酥现在在偶手上，马上带上你的证件到天桥找偶，晚了后果自负……」，爱犬男二话不说马上拿着为什么长得这么帅的证件赎回了凤梨酥。</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/03/IMG_1070.JPG" /></p>
<p>拆开这么那么黑但包装超结实的黑底烫金之淘金礼盒后，果然露出了十颗亮闪闪超霸气超冷酷的「谷阿莫凤梨酥」</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/03/IMG_1072.JPG" /></p>
<p>为什么刚好是十颗不用我介绍吧，刚好代表人的十根手指头啊，这就表示着你再不识数也能用你的手指头数得过来，用心良苦啊。</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/03/IMG_1073.jpg" /></p>
<p>撕开包装后，闻起来超香看起来超诱人的「谷阿莫凤梨酥」就出现在你眼前啦，真是妖娆的小贱人啊。爱犬男拿起来尝了一口这个怎么就这么贵的凤梨酥后被内里超粘牙的菠萝果酱狂甩嘴唇，觉得这个怎么就这么贵的凤梨酥味道真的就怎么这么贵。</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/03/IMG_1074.jpg" /></p>
<p>和外面那些妖艳贱货不一样，这款「谷阿莫凤梨酥」因为完全没有放任何冬瓜酱和任何防腐剂所以寿命怎么就这么短，用了从环境优良没污染的纽西兰原装进口的奶粉和乳酪粉，吃起来超香，物超所值，绝对好吃啊！还不快买个十几盒尝尝，科科！</p>
<ul>
<li>大陆淘宝：<a href="https://shop274820905.taobao.com">https://shop274820905.taobao.com</a></li>
<li>台灣蝦皮：<a href="https://shopee.tw/amogoodfood">https://shopee.tw/amogoodfood</a></li>
</ul>
</div>]]></content>
        
        <summary type="html">
            
            大家好，今天要说一个快递怎么那么慢但吃起来超好吃的「谷阿莫凤梨酥」的故事。  半个月前，故事中的男主角爱犬男，在网上闲逛的时候突然就发现了这个看起来怎么这么贵的凤梨酥，然后就被视频中的大魔王忽悠掏钱买了这个怎么这么贵但看起来超好吃的「谷阿莫凤梨酥」。 紧接着半个月过去了，正当爱
            
        </summary>
        
    </entry>
    
    <entry>
        <title>成年了</title>
        <link href="https://blog.asec01.net/18-years-old/"/>
        <id>https://blog.asec01.net/18-years-old/</id>
        
        <published>2018-03-17T15:05:45+00:00</published>
        <updated>2018-03-17T15:05:45+00:00</updated>
        
        <content type="html"><![CDATA[<p>时间过的挺快，18年一晃就过去了，终于能干一些原来干不了的事了。。。。<br />
今天生日，过得挺无聊的。。<br />
上午英语听力高考，到现在也不知道那个 tomato 到底要不要加 es 。。。<br />
回家吃饭，因为周一要体检，不敢大鱼大肉。。。<br />
下午不知道该干啥，GTAV 快玩腻了，懒得开，趴了一会儿，睡不着，起来收拾学校照片，折腾视频。。。各种无聊。。。<br />
收到的生日祝福似乎比去年多了挺多。。。</p>
<hr />
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-26.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-28.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-30.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-32.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-33.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-34.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-35.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-36.jpg" /></h2>
<h2><img src="https://blog.asec01.net/photo_2018-03-17_23-14-38.jpg" /></h2>
<p>某个小咸鱼半个多月没理我。。略激动，不造该说啥了都。。<br />
某人说我情商低。。。Emmm低又能怎样啊。。也就这样吧。。<br />
嗯。。我还小</p>]]></content>
        
        <summary type="html">
            
            时间过的挺快，18年一晃就过去了，终于能干一些原来干不了的事了。。。。 今天生日，过得挺无聊的。。 上午英语听力高考，到现在也不知道那个 tomato 到底要不要加 es 。。。 回家吃饭，因为周一要体检，不敢大鱼大肉。。。 下午不知道该干啥，GTAV 快玩腻了，懒得开，趴了一
            
        </summary>
        
    </entry>
    
    <entry>
        <title>手动编译 Nginx 并安装 VeryNginx</title>
        <link href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/"/>
        <id>https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2018-03-16T20:15:10+00:00</published>
        <updated>2018-03-16T20:15:10+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://github.com/alexazhou/VeryNginx" target="_blank">VeryNginx</a> 是个非常有意思且便捷的 Nginx 扩展程序。最近新开了台 VPS，便想体验一下它带来的快感。</p>
<a></a>
<p>VeryNginx 有个不超过 5 行的安装方法，但作为强迫症我更喜欢使用自己编译的 Nginx。</p>
<h2><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#基础依赖"></a>基础依赖</h2><ul>
<li>PCRE （一个正则表达式库，nginx 伪静态可以用到）</li>
<li>OpenSSL（https 连接需要）</li>
<li>zlib（开启 gzip 需要，一个提供数据压缩用的函式库）</li>
</ul>
<p>首先进入 <code>/usr/local/src</code> 目录：</p>
<pre><code>cd /usr/local/src
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#编译器安装"></a>编译器安装</h3><pre><code>apt-get install build-essential libtool
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#PCRE-8-41"></a>PCRE (8.41)</h3><p>下载并解压 <a href="https://ftp.pcre.org/pub/pcre/" target="_blank">PCRE</a>：</p>
<pre><code>wget https://ftp.pcre.org/pub/pcre/pcre-8.41.tar.gz
tar -xzvf pcre-8.41.tar.gz
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#zlib-1-2-11"></a>zlib (1.2.11)</h3><p>下载并解压 <a href="http://www.zlib.net/" target="_blank">zlib</a>：</p>
<pre><code>wget http://www.zlib.net/zlib-1.2.11.tar.gz
tar -xzvf zlib-1.2.11.tar.gz
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#OpenSSL-1-0-2l"></a>OpenSSL (1.0.2l)</h3><p>下载并解压 <a href="https://www.openssl.org/source/" target="_blank">OpenSSL</a>：</p>
<blockquote>
<p><code>lua-nginx-module</code> 不支持 1.1.0</p>
</blockquote>
<pre><code>wget https://www.openssl.org/source/openssl-1.0.2l.tar.gz
tar -xzvf openssl-1.0.2l.tar.gz
</code></pre>
<h2><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#ngx-lua-依赖"></a>ngx_lua 依赖</h2><p>VeryNginx 使用到了以下模块，自己编译 Nginx 时，需要包含以下模块才能正常使用。</p>
<ul>
<li>http_ssl_module</li>
<li>http_stub_status_module</li>
<li>lua-nginx-module</li>
</ul>
<blockquote>
<p><code>ngx_lua</code> 即为 <code>lua-nginx-module</code></p>
</blockquote>
<p><code>http_stub_status_module</code> 和 <code>http_ssl_module</code> 只需要在 <code>./configure</code> 时加上两行即可。<code>lua-nginx-module</code> 稍微麻烦一点，它需要以下依赖：</p>
<ul>
<li>LuaJIT 2.0 或 LuaJIT 2.1（推荐）或 Lua 5.1（5.2 目前不支持）</li>
<li>ngx_devel_kit（NDK）</li>
<li>ngx_lua</li>
</ul>
<p>同样进入 <code>/usr/local/src</code> 目录：</p>
<pre><code>cd /usr/local/src
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#LuaJIT-2-1-0-beta3"></a>LuaJIT (2.1.0-beta3)</h3><p>下载并安装 <a href="http://luajit.org/download.html" target="_blank">LuaJIT</a>：</p>
<pre><code>wget http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz
tar -xzvf LuaJIT-2.1.0-beta3.tar.gz

cd LuaJIT-2.1.0-beta3

make &amp;&amp; sudo make install
</code></pre>
<blockquote>
<p>它会自动将 LuaJIT 安装到 <code>/usr/local/</code></p>
</blockquote>
<p>设置环境变量：</p>
<pre><code>export LUAJIT_LIB=/usr/local/lib
export LUAJIT_INC=/usr/local/include/luajit-2.1/
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#ngx-devel-kit-0-3-0"></a>ngx_devel_kit (0.3.0)</h3><p>下载并解压 <a href="https://github.com/simpl/ngx_devel_kit/releases" target="_blank">ngx_devel_kit</a>：</p>
<pre><code>wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz
tar -xzvf v0.3.0.tar.gz
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#ngx-lua-0-10-11rc2"></a>ngx_lua (0.10.11rc2)</h3><p>下载并解压 <a href="https://github.com/openresty/lua-nginx-module/releases" target="_blank">ngx_lua</a>：</p>
<pre><code>wget https://github.com/openresty/lua-nginx-module/archive/v0.10.11rc2.tar.gz
tar -xzvf v0.10.11rc2.tar.gz
</code></pre>
<p>删除所有下载的压缩包：</p>
<pre><code>rm ./*.tar.gz
</code></pre>
<h2><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#编译安装-Nginx"></a>编译安装 Nginx</h2><h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#Nginx-1-12-1"></a>Nginx (1.12.1)</h3><p>下载并解压 <a href="https://nginx.org/en/download.html" target="_blank">Nginx</a>：</p>
<pre><code>wget https://nginx.org/download/nginx-1.12.1.tar.gz
tar -xzvf nginx-1.12.1.tar.gz
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#配置与编译"></a>配置与编译</h3><pre><code>cd nginx-1.12.1.tar.gz

./configure --prefix=/usr/local/nginx \
            --sbin-path=/usr/local/sbin/nginx \
            --pid-path=/usr/local/nginx/logs/nginx.pid \
            --error-log-path=/usr/local/nginx/logs/error.log \
            --http-log-path=/usr/local/nginx/logs/access.log \
            --with-ld-opt=-Wl,-rpath,/usr/local/lib/ \
            --with-http_ssl_module \
            --with-http_stub_status_module \
            --with-pcre=../pcre-8.41 \
            --with-zlib=../zlib-1.2.11 \
            --with-openssl=../openssl-1.0.2l \
            --add-module=../ngx_devel_kit-0.3.0 \
            --add-module=../lua-nginx-module-0.10.11rc2

make 
sudo make install
</code></pre>
<h2><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#安装-VeryNginx"></a>安装 VeryNginx</h2><h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#下载与安装-VeryNginx"></a>下载与安装 VeryNginx</h3><pre><code>git clone https://github.com/alexazhou/VeryNginx.git

cd VeryNginx

python install.py install verynginx
</code></pre>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#更新-Nginx-配置文件"></a>更新 Nginx 配置文件</h3><p>有两种方式：</p>
<ol>
<li><p>将 VeryNginx 的 <a href="https://github.com/alexazhou/VeryNginx/blob/master/nginx.conf" target="_blank">nginx.conf</a> 替换 <code>/usr/local/nginx/conf</code> 目录下的文件。</p>
</li>
<li><p>使用自己的配置文件，方法如下：</p>
</li>
</ol>
<ul>
<li>在 <code>http</code> 配置块外部，加入：<pre><code>include /opt/verynginx/verynginx/nginx_conf/in_external.conf;
</code></pre></li>
<li>在 <code>http</code> 配置块内部，加入：<pre><code>nclude /opt/verynginx/verynginx/nginx_conf/in_http_block.conf;
</code></pre></li>
<li>在 <code>server</code> 配置块内部，加入：<pre><code>include /opt/verynginx/verynginx/nginx_conf/in_server_block.conf;
</code></pre></li>
</ul>
<h3><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#登录-VeryNginx"></a>登录 VeryNginx</h3><p>访问 <code>http://yourdomain.com/verynginx/index.html</code> 就可以见到 VeryNginx 的控制面板。<br />默认用户名和密码都是 verynginx，登录后请务必修改。</p>
<h2><a href="https://blog.viosey.com/2017/10/12/compile-nginx-and-install-verynginx/#参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.vultr.com/docs/how-to-compile-nginx-from-source-on-ubuntu-16-04" target="_blank">How to Compile Nginx From Source on Ubuntu 16.04</a></li>
<li><a href="https://github.com/alexazhou/VeryNginx/wiki/Use-own-nginx" target="_blank">VeryNginx - Use own nginx</a></li>
<li><a href="https://github.com/openresty/lua-nginx-module#installation" target="_blank">ngx_lua - installation</a></li>
<li><a href="https://www.howtoforge.com/community/threads/adding-ngx_lua-to-nginx.61890/" target="_blank">Adding ngx_lua to nginx</a></li>
<li><a href="https://github.com/openresty/lua-nginx-module/issues/852" target="_blank">ngx_http_lua_module.c SSL_CTX_sess_set_get_cb incompatible argument</a></li>
<li><a href="https://imququ.com/post/use-verynginx.html" target="_blank">开始使用 VeryNginx</a></li>
</ul>
<hr />


]]></content>
        
        <summary type="html">
            
            VeryNginx 是个非常有意思且便捷的 Nginx 扩展程序。最近新开了台 VPS，便想体验一下它带来的快感。  VeryNginx 有个不超过 5 行的安装方法，但作为强迫症我更喜欢使用自己编译的 Nginx。 基础依赖 PCRE （一个正则表达式库，nginx 伪静态可
            
        </summary>
        
        <category term="技术向"/>
        
        <category term="Nginx"/>
        
        <category term="VeryNginx"/>
        
        <category term="Linux"/>
        
    </entry>
    
    <entry>
        <title>CFPMP - Cloudflare Partner CNAME接入管理面板</title>
        <link href="https://131.re/marchives/120"/>
        <id>https://131.re/marchives/120</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2018-03-16T04:00:00+00:00</published>
        <updated>2018-03-16T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[
<p>当前版本：V0.1.0 (2018-02-16)<br />
Github：<a href="https://github.com/Netrvin/CFPMP">https://github.com/Netrvin/CFPMP</a><br />
可用实例：<a href="https://cf.131.re">https://cf.131.re</a><br />
优点（相比WeiUZ）：</p>
<ul>
<li>界面更加美观</li>
<li>使用Session存储用户信息而非Cookie</li>
<li>可以设置<strong>@</strong>记录</li>
</ul>]]></content>
        
        <summary type="html">
            
             当前版本：V0.1.0 (2018-02-16) Github：https://github.com/Netrvin/CFPMP 可用实例：https://cf.131.re 优点（相比WeiUZ）：  界面更加美观 使用Session存储用户信息而非Cookie 可以设置@
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Cloudflare Partner 申请成功</title>
        <link href="https://131.re/marchives/118"/>
        <id>https://131.re/marchives/118</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2018-03-16T04:00:00+00:00</published>
        <updated>2018-03-16T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[
<p><img src="https://131.re/usr/uploads/2018/03/1954912016.png" /></p>]]></content>
        
        <summary type="html">
            
             
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Angular Package Format 简介</title>
        <link href="https://blog.poi.cat/introduce-angular-package-format"/>
        <id>https://blog.poi.cat/introduce-angular-package-format</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2018-03-15T15:21:28+00:00</published>
        <updated>2018-03-15T15:21:28+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://docs.google.com/document/d/1CZC2rcpxffTDfRDs6p1cfbmKNLA6x5O-NtkJglDaBVs/preview#">Angular Package Format（APF）</a> 指的是 Angular 框架中的包的结构和规范。该规范的作者是 <a href="https://github.com/IgorMinar">IgorMinar</a> 和 <a href="https://github.com/jasonaden">Jason Aden</a>，两者都是 Angular 的 Contributor。</p><p>它详细地介绍了 Angular 的核心库，例如 <code>@angular/core</code> 和 <code>@angular/common</code> 的 npm 包的结构和原因，同时还涉及到了在开发自己的库的时候如何优化编译结果，适配各种的优化工具等等。了解这方面的内容不仅有助于我们在写自己的 Angular 库，同时也可以我们了解 Angular 的编译器是如何工作的。</p><p>目前知道和了解这个文档的人还不多，而且恰巧今天（2018-3-15）该文档也更新到了 v6 版本（虽然目前看起来和 v5 长得一模一样）。于是我萌生了写一遍简单的关于 APF 的介绍，内容基本沿袭自上述的文档和<a href="https://youtu.be/QfvwQEJVOig">这个视频</a>。</p><h1>为什么需要 APF？</h1><p>最大的因为就是需要兼容各种各样的运行环境和工具。</p><p>在 Angular 4 中加入了 <code>@angular/platform-server</code> 被并入 Angular 的核心 repo，说明 Angular 的 Sever-side rending 得到越来越多的重视，所以 Angular 的库不仅要兼容浏览器环境，还要能兼容 Nodejs 的服务器环境。</p><p>此外，不是所有的 Angular 项目都是基于 Angular CLI 的，Angular 的用户有可能使用各式各样的编译器和优化工具，例如 Webpack，Rollup，Uglify 和 Google Closure 等等，而且每种编译器和优化工具都有不同的需求。</p><p>所以仅仅只提供一种编译格式是不可能满足上述所有的需求，所以我们就需要一个包的规范来实现上述需求，这就是 APF。</p><h1>APF 中规定了什么？</h1><p><strong>JavaScript 的模块规范</strong></p><p>要能过完美的兼容各种运行环境，第一个需要考虑的问题是使用 JavaScript 模块规范。例如，很多打包工具和优化工具基本只针对 ECMAScript Module (ESM) 有效（例如 Angular AoT 就只对 ESM 有效，而不能用于 CommonJS）。而在服务器端 Nodejs 上运行的时候需要对符合 CommonJS 规范的。</p><blockquote><p>在最新的 nodejs 中已经支持了 ESM，但是这个功能目前处在实验阶段，需要单独的 <code>--experimental-modules</code> flag。而且也并非每个人都能用上最新的 nodejs。所以这个让 nodejs 使用 ESM 还不是目前最佳的解决方法。</p></blockquote><p>APF 使用的是更加通用的 UMD 的模块规范，该规范可以同时满足 CommonJS 和 AMD 的规范。这样该模块就既可在 Nodejs 使用，也可以在浏览器中通过 script tag 使用。</p><p>此外，APF 还推荐在打包的时候还打包 Flat ES Module (FESM)，即将所有的独立的 Module 打包成一个文件。这样可以降低用户使用独立 Module 时的所需体积。</p><p>根据上面的描述，似乎只要提供 ESM，FESM 和 UMD 三种格式的编译后的文件就行了吗？其实不止，另外一个重要的要素是编译后的 JavaScript 的版本。</p><p><strong>JavaScript 的版本</strong></p><p>虽然目前很多打包工具默认都是输出 ECMAScript 5 (ES5)。但是考虑到所有的 evergreen browsers （一般来说，指可以脱离系统独立更新的浏览器）都已经提供原生的 ES2015(ES6) 支持。所以 APF 推荐提供 ES2015 版本的编译结果，这样可以满足部分不需要支持旧浏览器的用户。</p><p>另外一个原因就是不同的优化工具对不同语言版本支持情况也不一样。例如 Uglify 目前只支持 ES5。</p><p><strong>其他</strong></p><p>最后，因为 Angular 官方支持的第一开发语言为 TypeScript，所以提供 TypeScript 需要的 <code>.d.ts</code> (Type Declaration File) 也是有必要的。同时，因为 <code>.d.ts</code> 提供的信息不足以给 Angular 的编译器使用，还需要一个提供额外的包含每个 decorator 中 元数据的 <code>metadata.json</code>。</p><blockquote><p>目前，Angular AoT 模式中会将所有的元数据编译成类的静态类型，所以也就不需要像以前那样通过 Metadata Reflection API 获取元数据了。</p></blockquote><h1>APF 的具体实现</h1><p>下面我们以一个具体的遵循 APF 的包 <code>@angular/material</code> 为例子，描述具体的文件结构。</p><p>首先是整体的文件结构, 主要分成了 <code>esm2015/</code>，<code>esm5/</code>，<code>bundles/</code> 和其他各自的独立的 module 的文件夹。其中 <code>esm2015/</code>，<code>esm5/</code> 和 <code>bundles/</code> 就分别表示了 esm+es2015，esm+es5 和 umd+es5 的编译结果。</p><pre><code>.
├── esm2015
├── esm5
├── bundles
├── autocomplete
└── ...others
</code></pre><p>而在 <code>esm2015</code>，<code>esm5</code> 和 <code>bundles</code> 中则包括了该库中所有编译结果：每个独立的 module 的编译结果和整个库的 module 的都在其中。而每一个独立的 module 而编译结果都是一个 Flat Module。</p><pre><code>.
├── material-tooltip.umd.js
├── material-tooltip.umd.min.js
├── ...others
├── material.umd.js
└── material.umd.min.js
</code></pre><p>而在每个独立的 module 中都包含的各自该 module 的 <code>package.json</code>，<code>metadata.json</code> 和 <code>.d.ts</code> 文件：</p><pre><code>.
├── index.d.ts
├── index.metadata.json
├── package.json
└── typings
    ├── button.d.ts
    ├── button-module.d.ts
    ├── index.d.ts
    ├── index.metadata.json
    └── public-api.d.ts
</code></pre><p>最后，在每个 <code>package.json</code> 中，无论是根层级的，还是独立的 module 中的，都含有以下几个字段：</p><pre><code>&quot;main&quot;: &quot;./bundles/material.umd.js&quot;,
&quot;module&quot;: &quot;./esm5/material.es5.js&quot;,
&quot;es2015&quot;: &quot;./esm2015/material.js&quot;,
&quot;typings&quot;: &quot;./material.d.ts&quot;,
</code></pre><p><code>main</code> 字段指向 UMD+ES5 的编译结果，主要用于 Nodejs 的环境；<code>module</code> 字段指向 ESM+ES5 的编译结果，主要用于 Webpack 等；<code>es2015</code> 字段指向 ESM+ES2015 的编译结果，主要用于配置过的 Webpack 和 Google Closure 等；最后 <code>typings</code> 指向 <code>.d.ts</code> 文件，用于 TypeScript。</p><p>最后，在包的根目录里还有根整个 module 和每个独立的 module 的 <code>metadata.json</code> 和 <code>.d.ts</code> 文件。</p><h1>更多</h1><p>这篇文章只是对 APF 的一个简单的介绍和一个典型的例子的分析，还有更多的细节没有提及：例如，如何提供多个 entry point 这样可与成让用户只导入需要的模块，降低编译后的体积。如果感兴趣的话可以查看<a href="https://docs.google.com/document/d/1CZC2rcpxffTDfRDs6p1cfbmKNLA6x5O-NtkJglDaBVs/preview#">原文档</a>，以及 Juri Strumpflohner 在 ng-be 上的<a href="https://youtu.be/K4YMmwxGKjY">发言视频</a>。</p>]]></content>
        
        <summary type="html">
            
            Angular Package Format（APF） 指的是 Angular 框架中的包的结构和规范。该规范的作者是 IgorMinar 和 Jason Aden，两者都是 Angular 的 Contributor。它详细地介绍了 Angular 的核心库，例如 @angu
            
        </summary>
        
        <category term="angular"/>
        
    </entry>
    
    <entry>
        <title>腾龙 SP 90mm F/2.8 Di MACRO 1:1 VC USD</title>
        <link href="https://www.isthnew.com/archives/tamron-sp-90.html"/>
        <id>https://www.isthnew.com/archives/tamron-sp-90.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-03-11T14:32:55+00:00</published>
        <updated>2018-03-11T14:32:55+00:00</updated>
        
        <content type="html"><![CDATA[<p>昨天去数码广场买了一只腾龙90微，拿来拍点小东西，比如花花草草之类的，同时还可以兼顾一下人像。这只镜头没有像新款 85mm f1.4 一样配备电磁光圈，我也是拿到镜头之后才发现镜头卡口上有光圈拨杆，最大光圈 f2.8 在微距模式的时候无法全开，1：1倍率的时候是 f5.6</p>]]></content>
        
        <summary type="html">
            
            昨天去数码广场买了一只腾龙90微，拿来拍点小东西，比如花花草草之类的，同时还可以兼顾一下人像。这只镜头没有像新款 85mm f1.4 一样配备电磁光圈，我也是拿到镜头之后才发现镜头卡口上有光圈拨杆，最大光圈 f2.8 在微距模式的时候无法全开，1：1倍率的时候是 f5.6
            
        </summary>
        
        <category term="不能无聊"/>
        
        <category term="腾龙"/>
        
        <category term="90微"/>
        
    </entry>
    
    <entry>
        <title>腾讯云又出优惠活动了，云服务器3至6年仅需360元！</title>
        <link href="https://www.mokeyjay.com/archives/2134"/>
        <id>https://www.mokeyjay.com/archives/2134</id>
        
        <author>
            <name>mokeyjay</name>
        </author>
        
        <published>2018-03-06T05:11:00+00:00</published>
        <updated>2018-03-06T05:11:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://www.mokeyjay.com/archives/2134"><img src="https://www.mokeyjay.com/wp-content/uploads/2018/03/2018030603502719.jpg" /></a></p>腾讯云还是比套路云良心不少，活动幅度都很大，而且实打实。这不，又来一个大活动（据说是在刷KPI） 建议先通读全文再进行操作 所需条件 没有在腾讯云消费过的新账号（可以新注册一个Q号） 实名认证（一个身份证号可实名多个账号，认证秒过） 学生认证（已经毕业的也行，只要信息能在学信网查到，认证秒过） 据说学生信息乱填也可以。但不排除后期会被腾讯云抓出来销毁掉你的机器，尽量填真实的吧 操作步骤 点击参团]]></content>
        
        <summary type="html">
            
            腾讯云还是比套路云良心不少，活动幅度都很大，而且实打实。这不，又来一个大活动（据说是在刷KPI） 建议先通读全文再进行操作 所需条件 没有在腾讯云消费过的新账号（可以新注册一个Q号） 实名认证（一个身份证号可实名多个账号，认证秒过） 学生认证（已经毕业的也行，只要信息能在学信网
            
        </summary>
        
        <category term="行业新闻"/>
        
        <category term="资源"/>
        
    </entry>
    
    <entry>
        <title>国家队 ED1 发售了吗</title>
        <link href="https://ikk.me/archives/default/does_torikago_release.html"/>
        <id>https://ikk.me/archives/default/does_torikago_release.html</id>
        
        <author>
            <name>kookxiang</name>
        </author>
        
        <published>2018-03-05T05:12:00+00:00</published>
        <updated>2018-03-05T05:12:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="//static.ikk.me/uploads/2018/03/2786672407.jpg" /></p>

<p>没有完整版的《トリカゴ》听，我要死了</p>

<p>发了 magnet:?xt=urn:btih:0E60761122A15F7AECE58E9BF61B653553785110</p>

<p> &lt; 访问完整版以查看此播放器 &gt; </p>]]></content>
        
        <summary type="html">
            
              没有完整版的《トリカゴ》听，我要死了  发了 magnet:?xt=urn:btih:0E60761122A15F7AECE58E9BF61B653553785110   &amp;lt; 访问完整版以查看此播放器 &amp;gt; 
            
        </summary>
        
    </entry>
    
    <entry>
        <title>What’s so new in EH Forwarder Bot 2 (and its modules)</title>
        <link href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/"/>
        <id>https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2018-02-27T22:06:54+00:00</published>
        <updated>2018-02-27T22:06:54+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://steemitimages.com/0x0/https://images.1a23.com/di/XOEE/EFB_v2.png" /></p>
<blockquote>
<p>EH Forwarder Bot is an extensible chat tunneling framework that allow users to send and receive messages from multiple IM platforms at one stop, and ultimately manage their accounts remotely.<br /><a href="https://github.com/blueset/ehForwarderBot" target="_blank">https://github.com/blueset/ehForwarderBot</a> </p>
</blockquote>
<p>After almost a whole year, EH Forwarder Bot 2 has finally more or less finalized its features and structures. Most of the modules have also entered beta stage together with the framework. This update will be a lot different from the previous version, and as suggested by the semantic versioning, it will not be compatible with the previous version.</p>
<p>So, I think it should be the time to introduce about the new features in EFB v2.</p>
<h2><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#The-framework"></a>The framework</h2><p>The EFB framework has been completely redesigned in a more reasonable and open fashion. Now, instead of having everything at one repository, all modules can be and should be installed separately from the framework, as to keep every module “Simple and Stupid” (although it might not always be the case). This is also to encourage more developers to make their own modules and doesn’t look being excluded. </p>
<p>Every piece of information delivered between channels are abstracted to objects, and being verified before sent to the other channel. The verification process checks the minimum amount of information required by each message type and ensure that they are correctly filled by the sending channel. Features like message editing and removal has been included in the messaging protocol as well. </p>
<p>We also introduced the status as an alternative type of information that is delivered between channels. It is usually used to inform the master channel about changes happened in the chat list and about group members</p>
<p>Regarding permanent storages, 2.0 uses a standard to store all configurations and necessary data. The storage is specific to the profile it’s running on, which will be introduced later, and each module has dedicated place for its own data. In this way, the data storage is separated from the modules, which made profiles possible.</p>
<p>In EFB v2, separate profiles can be used to run different instances of EFB. As their data are stored separately, those instances runs independent from each other. If you want to have multiple accounts from the same service that you want to manage, that’s not a problem as well. EFB v2 allow users to identify each instance with an instance ID, which can be used to identify different accounts from the same platform/channel.</p>
<p>While running, the framework itself exists as an <code>coordinator</code>, which maintains all instances and polling threads of channels enabled, and manages the delivery of information between channels.</p>
<p>Besides that, the coordinator also manages all enabled middlewares, which is another new component introduced in version 2. Middlewares are designed to intercept messages and statuses sent between channels. They can make changes to messages or even block messages from delivery. Furthermore, as middlewares are easier to implement and has rather less restrictions than channels, it also can be used for other purposes such as automated messaging, chat bot, analysis, monkey patching, etc. </p>
<p>With all the new features of the framework, the project is also better documented with explanations and API docs in more detail. The new documentation is written with Sphinx, the de facto standard of Python documentations. Also, all modules maintained by me are well commented to serve as examples.</p>
<p>Furthermore, the docs, together with the prompts of the framework, is translated into multiple languages by the community.</p>
<h2><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#Modules"></a>Modules</h2><p>Apart from refactored to adapt to the new framework, all modules maintained by me were separated from the frameworks repository. Besides, the 2 modules with large code volume are refactored for better clearity. Those modules have also joined the community localization project. </p>
<h3><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#EFB-Telegram-Master"></a>EFB Telegram Master</h3><p>New features:</p>
<ul>
<li>Message editing, and indicate removal with special prefix.</li>
<li>‎Manual chat linking to groups and channels.</li>
<li>‎Update chat name and profile picture to the group/channel linked</li>
<li>‎Truncation of long messages and send full messages as file</li>
<li>Better processing of Telegram exceptions.</li>
</ul>
<h3><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#EFB-WeChat-Slave"></a>EFB WeChat Slave</h3><ul>
<li>Better prompt when certain messages or message types are not supported by the Web WeChat API.</li>
<li>‎Migration to <code>wxpy</code> for an OO API wrapping with (supposedly) better fake permanent ID mechanism. </li>
<li>Further minor changes that improves </li>
</ul>
<h3><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#EFB-Facebook-Messenger-Slave"></a>EFB Facebook Messenger Slave</h3><p>EFMS is a newly written slave channel that provides a good preview of what EFB aims to do to power users that are not familiar with WeChat. This channel was based on the Facebook Messenger Web client, and offers a basic support to chats and messages.</p>
<h3><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#EFB-GPG-Middleware"></a>EFB GPG Middleware</h3><p>Encrypt and decrypt all text messages if applicated. Although it might seem that useful, it is made as an example of middleware.</p>
<h2><a href="https://blog.1a23.com/2018/02/28/What%E2%80%99s-so-new-in-EH-Forwarder-Bot-2-and-its-modules/#In-the-end…"></a>In the end…</h2><p>EFB framework and most of its frameworks are still in beta stage. If you are a poweruser and finds any module that meeds your need, we welcome you to be a beta tester. Or if your are good at Python, you are also welcomed to write your own modules. Documentation is available <a href="https://ehforwarderbot.readthedocs.io/en/latest/" target="_blank">here</a>. If you have any question, feel free to comment here.</p>]]></content>
        
        <summary type="html">
            
              EH Forwarder Bot is an extensible chat tunneling framework that allow users to send and receive messages from multiple IM platforms at on
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="EH Forwarder Bot"/>
        
    </entry>
    
    <entry>
        <title>絮叨 | 2018年2月</title>
        <link href="https://blog.asec01.net/talk-2018-02/"/>
        <id>https://blog.asec01.net/talk-2018-02/</id>
        
        <published>2018-02-24T16:46:01+00:00</published>
        <updated>2018-02-24T16:46:01+00:00</updated>
        
        <content type="html"><![CDATA[
<p>最近各种不顺啊…刚放假，就发烧了一个星期…摊在床上边搞事情边被英语老师崔作业…不过最后作业还是写的差不多了[捂脸]</p>
<hr />
<p>也有点略开心的事<br />
从 XDA 上找到了个 LineageOS UNOFFICIAL 15.1 for Libra/Aqua<br />
我这凑活用了半年4c系统的4s终于能用指纹啦</p>
<hr />
<p>过完了一个无聊的寒假…又双叒叕开学了……<br />
高三了，也许该听听话好好学习，但本人很反感这种教育制度，于是所以把学习的时间都扔到兴趣上了……<br />
没了某主任的支持……靠自己却玩的更high了…也许天生不适合学习吧…<br />
天朝的制度…不上大学就没有好工作…没有好工作就没钱搞事情…<br />
啊啊啊啊啊</p>
<hr />
<p>把某人重新加了回来，希望这个不知道咋就蹦出来的想法是对的吧…<br />
然后就是我的社交障碍估计没得治了，唉…圈子小还清净呢，但xxx对我这么冷淡我！很！不！开！心！不想凭直觉判断什么…但我这直觉只要不用在考试上每次都 <s>TMD</s> 挺准啊！</p>
<hr />
<p>就这样吧… 发个博文证明自己还活着… <s>我大概没有自杀倾向…</s> 有小伙伴陪着自杀个锤子</p>]]></content>
        
        <summary type="html">
            
             最近各种不顺啊…刚放假，就发烧了一个星期…摊在床上边搞事情边被英语老师崔作业…不过最后作业还是写的差不多了[捂脸]  也有点略开心的事 从 XDA 上找到了个 LineageOS UNOFFICIAL 15.1 for Libra/Aqua 我这凑活用了半年4c系统的4s终于
            
        </summary>
        
    </entry>
    
    <entry>
        <title>关于新的 Hexo 主题「Spectre」</title>
        <link href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html"/>
        <id>https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-02-23T04:44:00+00:00</published>
        <updated>2018-02-23T04:44:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>终于用了快一个寒假的所有空闲时间，写完了「Spectre」主题。</p><blockquote><p>Yet the begin of a new story.</p></blockquote><a></a><h1><a href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html# 缘起"></a>缘起 </h1><p> 我最早接触博客时使用的是 Typecho，因为我看中了这款 PHP 驱动的博客程序的简洁。当时在选主题时就看到了 <a href="https://www.viosey.com" target="_blank">Viosey</a> 的 <a href="https://github.com/viosey/typecho-theme-material" target="_blank">typecho-theme-material</a>，当时着实被惊艳到了。那时候我高一，从用户到开始提 issue，然后自己一点点学习，开始为主题贡献了一些代码。后来 viosey 弃坑以后开始写 <a href="https://github.com/viosey/hexo-theme-material" target="_blank">hexo-theme-material</a>，我也迁移到了 Hexo，然后很自豪地成为了 hexo-theme-material 的 Contributor。</p><p>Material 主题一开始的起源只有一个 <a href="https://getmdl.io/templates/blog/index.html" target="_blank">Material Design Lite Blog Demo</a>，最后经过几番周折和魔改，从几个 HTML 到 typecho-theme-material 到 hexo-theme-material。</p><p>但是随着我开始为 hexo-theme-material 贡献代码，我发现，hexo-theme-material 主题太过于笨重：css 即使压缩和优化过仍然加起来有 146k，js 更是达到了 181k（Spectre 主题的 css 和 js 加起来是 180k，包括 inline 了的 Material Icons）；hexo-theme-material 的很多后期添加的功能都是侵入性的改造。加上我不满意 Material 主题的部分 UI 布局，于是我决定重写一个主题。</p><p>碰巧最近完成的几个坑中，有一个我使用了 Hexo。这个坑让我熟悉了如何从头写一个 Hexo 主题。</p><h1><a href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html# 选型"></a>选型 </h1><p> 之前我热衷于使用 <a href="https://www.mdui.org" target="_blank">MDUI</a> 框架，因为 MDUI 框架轻便易上手。然而碰巧 <a href="https://blog.indexyz.me/" target="_blank">Indexyz</a> 把我拉进了另外一个坑里，那个坑使用的 CSS Framework 是 <a href="https://picturepan2.github.io/spectre/" target="_blank">Spectre.CSS</a>。当我看见了 Spectre CSS 的简洁和轻量，我一下子被这个框架吸引住了。这个框架不仅轻量，还使用了不少 CSS Hack 代替了 JS（比如可收放的侧边栏、弹窗和 dropdown 菜单都不依赖 JS），于是我决定就使用这个框架。<br />由于 hexo-theme-material 使用的 EJS，我之前的几个关于 Hexo 的项目也是使用的 EJS，所以我决定 Spectre 主题也是使用的 EJS。</p><h1><a href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html#UI"></a>UI</h1><p>UI 方面，我参考了很多博客主题的设计，但是最后首页的 UI 我依然几乎是复刻了一个 Material 主题（但是有做了不少的微调）；侧边栏则是修改为模仿 Google Plus 的设计，仅在较小屏幕上收起，在桌面端展开。</p><p>文章页面的 Markdown 样式全盘照抄 Material 主题的，不过引来了相同的 PrismJS 代码高亮的 Bug。我的解决方案就是使用自己 patch 过的 <code>prism.css</code>。<br />友链和标签云页面基本也是直接照搬的 Material，只做了一点微调；映像页面则是基本完全照抄的。。以后有空了上 Codepen 上找个新的图库的模板重写一个吧；归档页面则是学了 NexT 主题做了一个时间轴样式。</p><h1><a href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html# 最后"></a>最后 </h1><p> 这玩意还处于 canary 阶段没有 Release；很多东西的实现方法很 dirty，写死了不少东西，很多功能（比如 TOC）都没有动，所以大家还是别想着换这个主题就行了（反正又不好看），以后有机会得从头再写一遍。</p><hr /><blockquote><p><strong>本文作者：</strong><a href="https://nfz.moe" target="_blank">neoFelhz</a><br /><strong>本文链接：</strong><a href="https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html">https://blog.nfz.moe/archives/hexo-theme-spectre-story-begin.html</a><br /><strong>本文采用 </strong> <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank">CC BY-NC-SA 3.0 Unported</a> <strong> 协议进行许可，阅读 </strong> <a href="http://blog.nfz.moe/creativecommons.html"> 相关说明</a>。</p></blockquote>]]></content>
        
        <summary type="html">
            
            终于用了快一个寒假的所有空闲时间，写完了「Spectre」主题。Yet the begin of a new story.缘起  我最早接触博客时使用的是 Typecho，因为我看中了这款 PHP 驱动的博客程序的简洁。当时在选主题时就看到了 Viosey 的 typecho-
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="博客"/>
        
        <category term="Hexo"/>
        
        <category term="Spectre"/>
        
    </entry>
    
    <entry>
        <title>新的个人页以及对 Nginx 启用 Brotli、TLS 1.3和 Server Push</title>
        <link href="https://flyhigher.top/develop/1042.html"/>
        <id>https://flyhigher.top/develop/1042.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2018-02-22T10:37:14+00:00</published>
        <updated>2018-02-22T10:37:14+00:00</updated>
        
        <content type="html"><![CDATA[<p>趁着春节假期，<del>作业一点没做</del>，倒是抽空写了一个新的个人页。</p>
<p><a href="https://axton.cc" target="_blank">Axton: About Me</a></p>
<p>到现在 axton.cc 这个域名的根域总算是启用了，之前一直在用二级域根域扔着没管。</p>
<p>个人页算是个假 shell，支持少数常用命令及历史命令和 <kbd>Tab</kbd> 补全。几乎所有操作都在前端完成，只有在获取博客最新文章时会和后台交互。用的是 WordPress 的 RESTful API，真的是一个超好玩的 API。<code>CORS</code> 靠反代解决，反代加了一层缓存减轻源站压力。</p>
<p>至于为啥不直接连后端而是去写1k+行的 js…</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/snipast4e.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/snipast4e.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/201708021736428973982.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/201708021736428973982.jpg" /></a></p>
<p>说到 WordPress，WordPress 最近被发现一个 Dos 漏洞，开发团队拒绝修复，于是自己补了一下。</p>
<p>然后突然 Nginx 1.13.9 就释出了，添加了 Server Push。在发现 <a href="https://flyhigher.top/go/?url=https%3A%2F%2Fhg.nginx.org%2Fnginx%2Frev%2F641306096f5b" target="_blank">Server Push 相关的提交</a>之后就一直眼馋地盯着 1.13.9，在释出之后一些认识的大佬陆续升级了 Nginx，我盯着自己万年没升级 Stable 版本，最后还是下定决心升个级，顺便添加了 Brotli 支持和 TLS 1.3 的支持。</p>
<h3>以下是正文</h3>
<p>首先添加 Brotli 支持。</p><pre>$ git clone https://github.com/google/ngx_brotli.git
$ cd ngx_brotli
$ git submodule update --init</pre><p>由于系统自带的 OpenSSL 版本普遍偏低，需要自行下载一份 OpenSSL 给 Nginx 用。目前浏览器支持的大多是 Draft 18，所以 <code>clone</code> 的也是 Draft 18 版本。</p><pre>$ git clone -b tls1.3-draft-18 --single-branch https://github.com/openssl/openssl.git openssl</pre><p>接下来安装 Nginx。先下载最新版本。</p><pre>$ wget http://nginx.org/download/nginx-1.13.9.tar.gz
$ tar zxvf nginx-1.13.9.tar.gz
$ cd nginx-1.13.9</pre><p>然后执行 <code>nginx -V</code> 获取旧版本 Nginx 的编译参数，再输入：</p><pre>$ ./configure --add-module=../ngx_brotli --with-openssl=../openssl --with-openssl-opt='enable-tls1_3 enable-weak-ssl-ciphers'</pre><p>引用屈哥的说法：</p>
<blockquote><p><code>enable-tls1_3</code> 是让 OpenSSL 支持 TLS 1.3 的关键选项；而 <code>enable-weak-ssl-ciphers</code> 的作用是让 OpenSSL 继续支持 3DES 等不安全的 Cipher Suite，如果你打算继续支持 IE8，才需要加上这个选项。</p></blockquote>
<p>再加上之前的编译参数，然后 <code>make</code>。</p>
<p>由于之前我启用了旧版本 <code>lua-nginx-module</code>，编译会出错，换用新版本编译即可，不再赘述。</p>
<p>为了平滑升级，先备份旧版 Nginx。</p><pre>$ mv /path/to/nginx/sbin/nginx /path/to/nginx/sbin/nginx.old</pre><p>再把编译好的版本拷过去。</p><pre>$cp objs/nginx /path/to/nginx/sbin/</pre><p>接着测试一下有没有问题。</p><pre>$ /path/to/nginx/sbin/nginx -t</pre><p>没问题的话会输出：</p><pre>nginx: the configuration file /path/to/nginx.conf syntax is ok
nginx: configuration file /path/to/nginx.conf test is successful</pre><p>那么接下来要平滑重启 Nginx。首先找一下 <code>nginx.pid</code> 在哪（如果你忘了的话）。</p><pre>$ find / -name &quot;nginx.pid&quot; -print</pre><p>then</p><pre>$ kill -USR2 `cat /path/to/nginx.pid`
$ kill -WINCH `cat /path/to/nginx.pid`
$ kill -QUIT `cat /path/to/nginx.pid`</pre><p>没问题的话就可以用 <code>nginx -V</code> 测试一下了。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/snip.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/snip.jpg" /></a></p>
<p>Done!</p>
<p>然后编辑 Nginx 配置文件。在 <code>nginx.conf</code> 里加上：</p><pre>brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml;</pre><p>这样就启用了 Brotli 支持。接着修改站点配置文件来支持 TLS 1.3。</p><pre>ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
ssl_ciphers TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4:!DH:!DHE;</pre><p><code>TLS13</code> 开头的为 TLS 1.3 新增的 Cipher Suite。</p>
<p>到此为止 Nginx 已经支持了 Brotli 和 TLS 1.3。至于 Server Push 的用法，最简单的用法是在站点配置文件中加入：</p>
<p></p><pre>http2_push /path/to/file1;
http2_push /path/to/file2;</pre><p></p>
<p>进阶用法可以参考 Nginx 官方的 <a href="https://flyhigher.top/go/?url=https%3A%2F%2Fwww.nginx.com%2Fblog%2Fnginx-1-13-9-http2-server-push%2F" target="_blank">这篇博文</a>。</p>
<h3>那么来检查一下吧</h3>
<p>要检查 Brotli 支持，只要使用 Chrome，然后在开发者面板检查响应头。如果成功地启用了 Brotli，就可以看到：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/snipas10.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/snipas10.jpg" /></a></p>
<p>这说明 Brotli 已经启用。再检查 TLS 1.3。Chrome 需将 chrome://flags/ 中的 <code>TLS 1.3</code> 改为 <code>Enabled (Draft)</code>；Firefox 需将 about:config 中的 <code>security.tls.version.max</code> 改为 <code>4</code>。Firefox Developer Edition 已经默认启用。然后检查连接的安全信息即可看到：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/snipastue.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/snipastue.jpg" /></a></p>
<p>或者使用 <a href="https://flyhigher.top/go/?url=https%3A%2F%2Fwww.ssllabs.com" target="_blank">SSLLabs</a> 也可以检查：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/sni.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/sni.jpg" /></a></p>
<p>对于 Server Push，可以在浏览器的开发者面板中检查。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2018/02/http2-server-push-chrome-dev-tools.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2018/02/http2-server-push-chrome-dev-tools.jpg" /></a></p>
<p>（本图来自 nginx.com，版权属于 NGINX Inc. 因为不知道为啥我没有在自己的博客页面上找到标记为来自 Server Push 的资源，尽管我已经正确（但愿）配置了 Nginx）</p>
<p>（逃</p>]]></content>
        
        <summary type="html">
            
            趁着春节假期，作业一点没做，倒是抽空写了一个新的个人页。 Axton: About Me 到现在 axton.cc 这个域名的根域总算是启用了，之前一直在用二级域根域扔着没管。 个人页算是个假 shell，支持少数常用命令及历史命令和 Tab 补全。几乎所有操作都在前端完成，只
            
        </summary>
        
        <category term="开发"/>
        
        <category term="Brotli"/>
        
        <category term="Nginx"/>
        
        <category term="SSL"/>
        
        <category term="TLS 1.3"/>
        
    </entry>
    
    <entry>
        <title>Nginx 已支持 Server Push</title>
        <link href="https://www.isthnew.com/archives/nginx-server-push.html"/>
        <id>https://www.isthnew.com/archives/nginx-server-push.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-02-22T03:33:53+00:00</published>
        <updated>2018-02-22T03:33:53+00:00</updated>
        
        <content type="html"><![CDATA[<p>2018-02-20 刚刚更新的 nginx-1.13.9 已支持 HTTP/2 的特性 Server Push ，这个特性目的是让服务端将部分资源主动推送给浏览器，节约浏览器需要使用这些资源时再次发送 Get 请求的时间。很长的一段时间内 Nginx</p>]]></content>
        
        <summary type="html">
            
            2018-02-20 刚刚更新的 nginx-1.13.9 已支持 HTTP/2 的特性 Server Push ，这个特性目的是让服务端将部分资源主动推送给浏览器，节约浏览器需要使用这些资源时再次发送 Get 请求的时间。很长的一段时间内 Nginx
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="http2"/>
        
        <category term="nginx"/>
        
        <category term="server push"/>
        
    </entry>
    
    <entry>
        <title>Happy Chinese New Year 2018</title>
        <link href="https://www.isthnew.com/archives/happy-chinese-new-year-2018.html"/>
        <id>https://www.isthnew.com/archives/happy-chinese-new-year-2018.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-02-16T14:51:12+00:00</published>
        <updated>2018-02-16T14:51:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>农历新年到来，祝大家新年快乐，顺便放了几张除夕12点整放烟花鞭炮的照片</p>
<p></p>]]></content>
        
        <summary type="html">
            
            农历新年到来，祝大家新年快乐，顺便放了几张除夕12点整放烟花鞭炮的照片 
            
        </summary>
        
        <category term="世界在这里"/>
        
        <category term="2018"/>
        
        <category term="新年"/>
        
    </entry>
    
    <entry>
        <title>再见 YY，你好 Discord</title>
        <link href="https://blog.kejun.me//living/2018/02/13/goodbey-yy-fuck-yy.html"/>
        <id>https://blog.kejun.me//living/2018/02/13/goodbey-yy-fuck-yy.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2018-02-13T05:26:16+00:00</published>
        <updated>2018-02-13T05:26:16+00:00</updated>
        
        <content type="html"><![CDATA[<p>为什么要使用流氓 YY ？</p>

<p>首先，<a href="https://discordapp.com/">点击这里</a>下载 Discord 。</p>

<p>吃鸡盛行，不得不使用靠谱的连麦软件，但是为什么还是 YY ？</p>

<h2>YY 优点</h2>

<p>我想了一个晚上，没想到任何优势，要硬说优点，可能只有：</p>

<ul>
  <li>用户习惯</li>
  <li>本地化</li>
  <li>服务器在国内</li>
</ul>

<h2>对比</h2>

<p>为什么不直接说 YY 的缺点？这样可能缺少说服力。</p>

<h3>正面功能：</h3>

<table>
  <thead>
    <tr>
      <th>功能</th>
      <th>YY 语音</th>
      <th>Discord</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>免费使用</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>IP&amp;DDoS保护</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>浏览器支持</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>移动应用</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>好友功能</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>游戏内覆盖</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>低延迟</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>最小的CPU使用率</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>自定义热键</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>智能推送通知</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>权限</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>多个频道</td>
      <td>√</td>
      <td>√</td>
    </tr>
    <tr>
      <td>markdown文本聊天</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>个别音量控制</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>Bot</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>自制插件</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>自制主题</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>自定义CSS</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>国际化</td>
      <td> </td>
      <td>√</td>
    </tr>
    <tr>
      <td>开发指南</td>
      <td> </td>
      <td>√</td>
    </tr>
  </tbody>
</table>

<h3>负面功能</h3>

<table>
  <thead>
    <tr>
      <th>功能</th>
      <th>YY 语音</th>
      <th>Discord</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>广告</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>捆绑安装</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>弹窗</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>实名</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>会员</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>账号等级</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>新闻</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>低俗直播</strong></td>
      <td>√</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2>总结</h2>

<p>Discord 专注于游戏语音，从<a href="https://discordapp.com/">官网</a>下载页，我们就可以看到非常的简洁。</p>

<p>而 YY7 下载页，介绍了一堆鸡肋功能，最后一个极速体验简直笑死人，YY 待机情况cpu使用率和内存占用不忍直视。</p>

<p><strong>广告</strong>，我最想吐槽，记得有一次，YY 伪装成 Steam 图标闪烁，点开发现尽然是 YY ，真是服气。</p>

<p>用 Google 搜 <code>YY 流氓</code> 关键字可以看到超多的吐槽，有甚者说 360 都治不住。</p>

<p>当然，discord 也并不是没有短板，很直观的一点就是注册验证邮箱时要 番羽 土蔷 。最近的服务器在香港，大陆没有。</p>

<p>以上对比如有错误，希望能留言指出。</p>

<h2>其他</h2>

<p>这里以后想到了就来补充。</p>]]></content>
        
        <summary type="html">
            
            为什么要使用流氓 YY ？  首先，点击这里下载 Discord 。  吃鸡盛行，不得不使用靠谱的连麦软件，但是为什么还是 YY ？  YY 优点  我想了一个晚上，没想到任何优势，要硬说优点，可能只有：     用户习惯   本地化   服务器在国内   对比  为什么不直接
            
        </summary>
        
        <category term="discord"/>
        
        <category term="game"/>
        
        <category term="yy"/>
        
    </entry>
    
    <entry>
        <title>小米降噪耳机（3.5mm）评测</title>
        <link href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html"/>
        <id>https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-02-03T12:46:00+00:00</published>
        <updated>2018-02-03T12:46:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>之前在同学的安利之下，我剁手了一副小米降噪耳机 Type-C 版（评测可以看 <a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html">这里</a>）。但是 Type-C 版的音质并不好，而且听歌时手机不能充电。于是，我就手痒，又买了小米降噪耳机 3.5mm 版（完了，没钱了）</p><a></a><hr /><p>这次买降噪耳机时我特地做了比较，初步选择了 Nubia、华为和小米。Nubia 和华为的海报中对于续航只说实验室条件下 6 小时，但小米的海报说的是实验室条件下 12 小时（就算实验室条件下，小米敢比华为和 Nubia 的续航多标一倍嘛），加上 mokeyjay dalao 的 <a href="https://www.mokeyjay.com/archives/2017" target="_blank">华为主动降噪耳机 2 的简评</a>，我就更加坚定地剁手了小米的 3.5mm 版主动降噪耳机（然而我不是米粉！）。</p><p>包装盒里的配件包括：</p><ul><li>耳机本身</li><li>3 对硅胶套</li></ul><blockquote><p>是的，配件缩水了。</p></blockquote><p>忘了拍开箱了。。。我就放一下这张图吧，右边是一加银耳，左边是 Nubia 律音 Pro（Nubia 圈铁和 Nubia 红魔被我收起来了）；而中间的就是今天的主角——小米 3.5mm 版主动降噪耳机。</p><p><img src="https://i.loli.net/2018/02/03/5a75bfc0cd413.jpg" /></p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 不同"></a>不同 </h1><p> 小米 3.5mm 版主动降噪耳机依然是上部使用塑胶线，下部使用编织线。耳机从高光抛光修改成了暗黑，显得没有 Type-C 版那么高调。由于使用电池盒供电，中央控制盒变得较重和大，小米和其他厂商一样都带了背夹。除此以外，小米的这款 3.5mm 版主动降噪耳机的改动还有：多增加了一个动铁，双动铁 + 动圈组合，耳机明显要略大一圈；降噪设置了三挡（关闭、基本降噪、深度降噪），可以根据环境选择档位以达到省电的目的。</p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 参数"></a>参数</h1><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>声学架构</td><td>双动圈 + 动铁</td></tr><tr><td>连接线长</td><td>1.35m</td></tr><tr><td>接口类型</td><td>3.5mm 音频接口</td></tr><tr><td>频响范围</td><td>20 - 40000Hz</td></tr><tr><td>频响范围</td><td>55mAh</td></tr><tr><td>主动降噪</td><td>模拟前馈</td></tr></tbody></table><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 体验"></a>体验 </h1><h2><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 使用体验"></a> 使用体验 </h2><p> 和 Type-C 版不同，由于 3.5mm 线控的兼容性较好，音量加减、切歌和播放暂停等所有功能都可以正常使用。</p><h2><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 降噪效果"></a>降噪效果 </h2><p> 和 Type-C 版接近，开启线控上的开关之后说话声和其它比较尖锐的声音的降噪效果仍然不明显，但是其它常见噪声削除效果并不坏。<br />个人认为，小米 3.5mm 版降噪耳机的降噪能力和 Type-C 版相比并没有明显提高。</p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 测试曲目"></a>测试曲目 </h1><p> 光说感觉无益，还是老规矩，上几个测试曲目。</p><h3><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 人声测试"></a>人声测试 </h3><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 笨鸟先飞（天朝从众效应）"></a> 笨鸟先飞（天朝从众效应）</h4><div></div><p>可以明显听出，小米耳机在这首歌的表现接近 Nubia 律音 Pro，在人声的表现很不赖；一加银耳的声音更加浑厚，后劲明显足。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 冷光"></a>冷光</h4><div></div><p>在《冷光》当中一加银耳和小米降噪耳机对人声的表现力都很不错，小米在副歌中的高音有明显改善；但是 Nubia 律音 Pro 在间奏的解析度更好。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html#Freya"></a>Freya</h4><div></div><p>在《Freya》上，Nubia 律音 Pro 和一加银耳的还原效果都很清晰，但一加银耳相对厚重一些，Nubia 律音 Pro 相对圆润一些。而小米降噪耳机的相比之下音量明显小一些、因而显得有一丝压抑。</p><h3><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 纯音乐测试"></a>纯音乐测试 </h3><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 冬季"></a> 冬季</h4><div></div><p>小米降噪耳机对节拍和鼓点的效果依然不如一加银耳，而且显得偏清亮，但是不再飘。Nubia 律音 Pro 的表现并不出彩，但是也在应有的水平，而一加银耳的解析度和音色都表现得很好。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html#Storm"></a>Storm</h4><div></div><p>这首曲目以节奏和鼓点为主，小米降噪耳机的推力不足在这首曲目里暴露的更加明显，明显鼓点轻多了。而一加银耳和 Nubia 的律音 Pro 表现都不错，还原度和解析度都不错。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 葬花（Original-Mix）"></a>葬花（Original Mix）</h4><div></div><p>Nubia 律音 Pro 在这首曲目上表现依然不赖，但是对于这首曲目而言音色偏厚重了；而一加银耳把握得就好多了，和之前的曲目有明显的对比，应该是有做了适应性设计。小米降噪耳机的解析力是足够的，音色相对偏轻和清亮又不显得刺耳。</p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html# 总结"></a>总结 </h1><p> 小米 3.5mm 版降噪耳机相对 Type-C 版，无论是解析度和音色上都有改观，声音变得相对圆润不再粗糙，高音失真有明显改善但依然会有些削音，应该是得益于 双动铁 + 动圈 的声学架构。低音表现虽然推力提升而有所改观，但依然可圈可点。音质上，小米降噪耳机依然不如一加银耳，在听觉感受上依然不如 Nubia 圈铁、Nubia 律音 Pro 有优势，但是差距明显缩小了。</p><p>个人觉得小米 3.5mm 版降噪耳机，声音表现相对改观，价格还是不变，做工没有缩水。如果需要一款在通勤中降低噪音的耳机，小米 3.5mm 版降噪耳机依然是个可以接受的选择。如果对音质要求不高又需要关心续航和耳机重量，那么也可以选择 Type-C 版。结尾还是那句话，如果你对音质有更高的要求、或者不满意小米降噪耳机的音色，那么你完全可以去选择其它耳机。</p><blockquote><p>以上评测完全基于个人，不保证完全公正、客观。玄学的东西，都应该大喊「索尼大法好！八千以下听个响！」</p></blockquote><hr /><blockquote><p><strong>本文作者：</strong><a href="https://nfz.moe" target="_blank">neoFelhz</a><br /><strong>本文链接：</strong><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html">https://blog.nfz.moe/archives/xiaomi-anc-earphone-3-5.html</a><br /><strong>本文采用 </strong> <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank">CC BY-NC-SA 3.0 Unported</a> <strong> 协议进行许可，阅读 </strong> <a href="http://blog.nfz.moe/creativecommons.html"> 相关说明</a>。</p></blockquote>]]></content>
        
        <summary type="html">
            
            之前在同学的安利之下，我剁手了一副小米降噪耳机 Type-C 版（评测可以看 这里）。但是 Type-C 版的音质并不好，而且听歌时手机不能充电。于是，我就手痒，又买了小米降噪耳机 3.5mm 版（完了，没钱了）这次买降噪耳机时我特地做了比较，初步选择了 Nubia、华为和小米
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="耳机"/>
        
        <category term="评测"/>
        
        <category term="小米降噪耳机"/>
        
    </entry>
    
    <entry>
        <title>再见 2017， 你好 2018</title>
        <link href="https://blog.kejun.me//living/2018/01/31/bye-2017-hi-2018.html"/>
        <id>https://blog.kejun.me//living/2018/01/31/bye-2017-hi-2018.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2018-01-31T11:26:16+00:00</published>
        <updated>2018-01-31T11:26:16+00:00</updated>
        
        <content type="html"><![CDATA[<p>很早就在本地写了这个文件,马上就要到除夕了,才决定是时候总结一波了.</p>

<hr />

<p>说实话,2017 的很多事情已经忘记,唯一清晰的就是 Jekyll Theme MDUI.</p>

<p>2017 的二月份,了解了 Jekyll 、 Materializecss ,尝试去撸一个 Jekyll 主题,当然是以失败告终.</p>

<p>三月份,了解到 MDUI ,首先感谢一波开发者开发出如此易用使用的 Material 风格的 UI 库.</p>

<p>开始使用 MDUI 去写新的主题,磕磕碰碰算是完成了 V1 的开发.</p>

<p>前几天去关闭最后的 issue 的时候,还是蛮开心的. 但是回头看看,写的很一般.</p>

<p>V2 不出意外应该会写.</p>

<hr />

<p>2017 过的挺踏实的:</p>

<ul>
  <li>两个域名,分别是 kejun.me 和 kejun.space 也不知到能养到什么时候.</li>
  <li>Material 群认识了一堆大佬,虽然大多都转 Telegram 了.</li>
  <li>Kiwi 后宫,嗯,很开心.</li>
  <li>吃鸡.</li>
  <li>从 WP 转 Typecho 转 Jekyll ,并尝试造 Jekyll 主题.</li>
  <li>过去一年至今(少的可怜QwQ):
    <ul>
      <li>博客:用户数 6,085 ,网页浏览量 13,622;</li>
      <li>首页: 用户数 1,523 ,网页浏览量 4,034.</li>
    </ul>
  </li>
  <li>开始重视 https.</li>
  <li>与女朋友分手,并决定不再轻易接触感情.</li>
  <li>在学校成立了 COSF ,不知道能不能坚持住,大家水平真的很一般.</li>
  <li>224 宿舍遇到了很多有趣的人.</li>
  <li>氪了 MacBook Pro ,一个感觉,爽.</li>
  <li>思科成绩 97.9 ,大概信息系最高分.</li>
</ul>

<hr />

<p>说说计划:</p>

<ul>
  <li>学习,一切尽在不言之中.</li>
  <li>主题的 V2.</li>
  <li>GlowCraft 发展起来.</li>
  <li>COSF 发展起来.</li>
  <li>少打游戏,多睡觉.</li>
  <li>挣钱.</li>
</ul>

<p>好了,学习去了,溜了.</p>]]></content>
        
        <summary type="html">
            
            很早就在本地写了这个文件,马上就要到除夕了,才决定是时候总结一波了.    说实话,2017 的很多事情已经忘记,唯一清晰的就是 Jekyll Theme MDUI.  2017 的二月份,了解了 Jekyll 、 Materializecss ,尝试去撸一个 Jekyll 主
            
        </summary>
        
        <category term="newyear"/>
        
    </entry>
    
    <entry>
        <title>测评：海淀、西城区高三期末语文试卷对比</title>
        <link href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html"/>
        <id>https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-01-30T05:10:00+00:00</published>
        <updated>2018-01-30T05:10:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>2018 年是北京市高考改革前的倒数第二年。在新课标改革前夕，高考的变革在试卷上如何体现成为大家关心的重点。通过高三期末试题的分析，可以看到今年高考的一个走向和趋势。</p><a></a><p>总体来说，西城和海淀的高三期末试题依然延续了往年的风格——海淀追求创新、西城追求稳定和紧跟高考。这在语文试卷上，主要体现在题目和选材上。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 多文本材料阅读"></a>多文本材料阅读 </h1><p> 在第一大题的多文本材料阅读当中，海淀的试题选取了“中国天眼”（FAST 射电望远镜）的介绍材料以及报纸的采访和报道作为材料，主打高新科技路线；而西城的试题选取了景德镇瓷器发展历程和创新作为材料，主打传统文化路线。在试题上，海淀的题目要求考生在阅读材料的基础上考察考生对材料更深层次的理解（比如为材料选取标题、比如选择一个词形容“中国天眼”的调试历程、比如为科学家写一副对联）；而西城的题目主要考察考生对材料的阅读和信息的提取（考察下述选项中的说法是否与材料相符）。<br />对于简答题，海淀特意给了一个图表和一些报道作为链接材料，要求考生将三则材料和链接材料对比获取信息；而西城仍然考察从材料中提取和概括信息。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 文言文阅读"></a>文言文阅读 </h1><p> 海淀选取的文言文材料是袁中道的《听雨堂记》，主题是对官场的反思和对隐居生活、兄弟团聚的向往；西城选取的文言文材料是《虞初新志》中的《换心记》。除了客观题考察文言文基本知识意外，主观题上海淀和西城的命题方向相同，都是考察在理解文言文主要内容的基础上，获取主题、情感和其他信息。而且海淀和西城对于这道主观题都要求使用考生自己的话进行答题，更加考察考生的理解和表达能力。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 诗歌阅读和理解性默写"></a>诗歌阅读和理解性默写 </h1><p> 海淀的诗歌选择的是李贺的《开愁歌》，主要抒发了诗人失意不得志的愁苦；而西城选择的杜甫的《崔氏东山草堂》，表达了诗人对官场的厌倦和对田园生活的向往、对王维放弃田园生活的不解和惋惜。<br />在题目的组织上，除了考察考生的诗歌的理解，主观题出人意料的相似——都是提供考生熟悉的诗句、要求考生对比辨析，从中考察考生的诗歌主题的理解。这基本沿袭了往年北京高考的命题趋势，而且也降低了难度、易于考生把握题目所给诗人情感。</p><p>理解性默写紧跟诗歌，主题也是相似的。海淀的理解性默写围绕“愁”展开，西城的理解性默写围绕《崔氏东山草堂》中“田园生活”、“秋景”、“渔樵”三个关键词展开。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 现代文阅读"></a>现代文阅读 </h1><p> 现代文阅读是语文考察的大头，对考生的阅读理解能力进行了综合多方面的考察。海淀选取的文章是《把他送到树上去》是一篇对意大利小说家卡尔维诺《树上的男爵》的书评，从选材的形式上来讲较为新颖；西城选取的是《一股液体流过西海固》，是一篇在贫困乡西海固支教的老师写的纪实，较为接地气。</p><p>在命题上，海淀虽然选材新颖，但是主观题的答案大部分都可以从原文中找到，只需要考生稍作概括即可；而西城的主观题除了考察对文章语句含义的理解，还设置了一道开放性试题“从你个人角度谈谈看法”，让考生有话可说。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 微写作"></a>微写作 </h1><p> 海淀区的微写作的三个题目分别是：</p><ol><li>从香菱被拐（《红楼梦》）、孙兰花嫁给王满银（《平凡的世界》）、桑迪亚哥八十四天没有捕到一条鱼（《老人与好》）中选取一例，谈谈对现代文阅读中“作家就是统治一个人物的暴君”这句话的理解。</li><li>从 “德不孤、必有邻”和“君子和而不同”挑选一句写入“孔子学院”宣传册并说明理由。</li><li>从单四嫂子（《呐喊·明天》）、傩送（《边城》）、华子良（《红岩》）中选取一个人物以他的身份讲述人物经历过的一个难忘的情景。</li></ol><p>西城区的微写作的三个题目则分别是：</p><ol><li>从《红岩》中的江姐、《老人与海》中的桑迪亚哥、《平凡的世界》中的孙少平中农任选一人，叙述其“不甘心”的情节并做简要点评。</li><li>从林黛玉葬花《红楼梦》、陈士成看榜《呐喊·白光》、傩送月夜为翠翠唱歌《边城》中描述他们当时的内心感受。</li><li>从下面六句论语（本文中从略）挑选一句作为高三黑板报的寄语。</li></ol><p>2017 年高考是北京市第一年考察名著阅读，所以在今年的高考肯定会更加重点考察。在考察形式上，仍然以微写作的形式为主，以客观题为辅。由于期末考试重点考察名著，所以西城和海淀的微写作选题全部围绕名著和传统文化（《论语》）展开。但是北京在今年高考时应该不会改变 描写 - 议论 - 抒情 三选一的格局，最多把场景描写更换为名著有关；因为考察考生对社会热点、社会现象的议论一直切合着北京市高考大纲。</p><p>在考察名著时，除了海淀和西城挑选的名著篇目惊人的相似，在考察点方面上也颇有相同之处——不是考察名著中有关情节的复述、就是考察对名著情节的理解，再或者就是对人物心理的揣摩。当然，海淀的题目仍然是新颖的，间接考察考生对名著的掌握。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 作文"></a>作文 </h1><p> 北京市高考的作文很早就转变为二选一，不过最近不再“文体不限”，而是限定记叙文和议论文二选一。在形式上，仍然以材料作文和给定题目为主。</p><p>海淀区的记叙文题目是根据材料，猜测材料中人物十年后的状态并写一篇记叙文；根据当下“诗歌节”“诗歌热”的现象写一篇议论文。西城区的题目是根据一则社会时事探讨“对与好”的关系写一篇议论文；根据一段统计数字的材料写一篇关于“数字的故事”作为记叙文。</p><p>从记叙文的命题来看，海淀的记叙文创新性地设置了一个人物的情景，并要求预测他的生活；而西城的题目虽然给了各方面的统计数据可以作为考生命题的方向，但是又不限于材料，“数字的故事”的题目也很宽泛，容易让考生有话可说、有东西可写。<br />从议论文所给的材料来看，都是从社会热点或事件入手，然而西城的议论文形式是当下北京的一种议论文尝试——关系型议论文，从一种对立关系中做出选择或寻找统一、或是从一种并不矛盾的关系中寻找联系。除此以外，西城的材料中还给予了考生一些写作方向，防止考生跑题或者不知道从何下手。</p><h1><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html# 总结"></a>总结 </h1><p> 在考察形式上，海淀的题目较为新颖、考察考生的能力；而西城的题目更加贴合高考，并且更加“人性化”。但是无论考察形式和题目风格如何，从两张试卷中可以看到当下北京语文高考的趋势。</p><hr /><blockquote><p><strong>本文作者：</strong><a href="https://nfz.moe" target="_blank">neoFelhz</a><br /><strong>本文链接：</strong><a href="https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html">https://blog.nfz.moe/archives/haidian-xicheng-chinese-paper.html</a><br /><strong>本文采用 </strong> <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank">CC BY-NC-SA 3.0 Unported</a> <strong> 协议进行许可，阅读 </strong> <a href="http://blog.nfz.moe/creativecommons.html"> 相关说明</a>。</p></blockquote>]]></content>
        
        <summary type="html">
            
            2018 年是北京市高考改革前的倒数第二年。在新课标改革前夕，高考的变革在试卷上如何体现成为大家关心的重点。通过高三期末试题的分析，可以看到今年高考的一个走向和趋势。总体来说，西城和海淀的高三期末试题依然延续了往年的风格——海淀追求创新、西城追求稳定和紧跟高考。这在语文试卷上，
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>深圳风图</title>
        <link href="https://131.re/marchives/113"/>
        <id>https://131.re/marchives/113</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2018-01-28T04:00:00+00:00</published>
        <updated>2018-01-28T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>如下图，基本的功能是已经完成了的，但还有一些细节需要完善</p>

<p>链接：<a href="https://shenzhen.windmap.net/">shenzhen.windmap.net</a></p>
<p><img src="https://131.re/usr/uploads/2018/01/1082492399.jpg" /></p>
<p>本项目修改自开源项目：<a href="https://github.com/cambecc/air">github.com/cambecc/air</a></p>]]></content>
        
        <summary type="html">
            
            如下图，基本的功能是已经完成了的，但还有一些细节需要完善  链接：shenzhen.windmap.net  本项目修改自开源项目：github.com/cambecc/air
            
        </summary>
        
    </entry>
    
    <entry>
        <title>网易云音乐手机壳 - 西西</title>
        <link href="https://i-meto.com/netease-iphone-case/"/>
        <id>https://i-meto.com/netease-iphone-case/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2018-01-20T09:34:44+00:00</published>
        <updated>2018-01-20T09:34:44+00:00</updated>
        
        <content type="html"><![CDATA[<div><blockquote>
<p>有一份宅急送的快递给您放在顺丰了（</p>
</blockquote>
<div></div>
<p>今天收到 <a href="https://www.genteure.com/">宅急送队长</a> 送的手机壳，不得不说顺丰快递真的良心 <s>一箱快递半箱空气</s>，包装经过一路的颠簸没有收到半点损伤</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/netease_cup.png" /></p>
<p>手机壳的背面中心是网易云音乐的吉祥物西西，除了一对红色鹿角外全身黝黑，透着古灵精怪的味道，治愈感满满 <s>胖胖的想捏</s>，可以说是相当萌系了</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/iphone7_with_cup.jpg" /></p>
<p>相比以前用过的一些深水宝地摊货，网易云音乐的这款手机壳做工相当精致，材质柔软、工艺优良（念广告），切边圆滑过渡没有毛刺，<s>很适合大冬天套着搓手游</s></p>
<p>不过注意到这款手机壳是 TPU 材质的，这种材料本身就容易黄变，在手汗、紫外线的干扰下，不知道能撑多久，希望厂家有做一些「抗黄」处理</p>
<p>防摔这个问题，emmmmc... 你们赞助我去摔</p>
<p>什么时候出黑色款我再买几个</p>
<p>又水了一篇，捏气泡去了～</p>
</div>]]></content>
        
        <summary type="html">
            
             有一份宅急送的快递给您放在顺丰了（   今天收到 宅急送队长 送的手机壳，不得不说顺丰快递真的良心 一箱快递半箱空气，包装经过一路的颠簸没有收到半点损伤  手机壳的背面中心是网易云音乐的吉祥物西西，除了一对红色鹿角外全身黝黑，透着古灵精怪的味道，治愈感满满 胖胖的想捏，可以说
            
        </summary>
        
    </entry>
    
    <entry>
        <title>选择一个评论系统</title>
        <link href="https://www.isthnew.com/archives/choose-comment-system.html"/>
        <id>https://www.isthnew.com/archives/choose-comment-system.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-01-17T15:28:35+00:00</published>
        <updated>2018-01-17T15:28:35+00:00</updated>
        
        <content type="html"><![CDATA[<p>不要选择静态博客，直接用 WordPress 或者 Typecho 等动态博客的自带评论系统，完。之前想过，要是有 Hexo 转 Typecho 的轮子，我就换回去了，可惜没有。</p>
<p>实际上之前用 WordPress</p>]]></content>
        
        <summary type="html">
            
            不要选择静态博客，直接用 WordPress 或者 Typecho 等动态博客的自带评论系统，完。之前想过，要是有 Hexo 转 Typecho 的轮子，我就换回去了，可惜没有。 实际上之前用 WordPress
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="disqus"/>
        
        <category term="valine"/>
        
        <category term="评论"/>
        
    </entry>
    
    <entry>
        <title>Kratos-M 原生Kratos主题优化版</title>
        <link href="https://milkice.me/2018/01/15/kratos-m/"/>
        <id>https://milkice.me/2018/01/15/kratos-m/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2018-01-15T14:37:19+00:00</published>
        <updated>2018-01-15T14:37:19+00:00</updated>
        
        <content type="html"><![CDATA[Kratos 是一款免费开源的两栏结构并且拥有自适应效果的主题，她能够在任何浏览器下进行友好体验的访问。Kratos 秉持了专心写作专心阅读的特点，简单大方的主页构造并采用了2：1的完美比例，使得博客能在臃肿杂乱的环境中脱颖而出。Kratos 主题内置了强大的主题后台控制平台，可以轻松设置关键字及站点描述，自定义的顶部样式（背景图 or ……]]></content>
        
        <summary type="html">
            
            Kratos 是一款免费开源的两栏结构并且拥有自适应效果的主题，她能够在任何浏览器下进行友好体验的访问。Kratos 秉持了专心写作专心阅读的特点，简单大方的主页构造并采用了2：1的完美比例，使得博客能在臃肿杂乱的环境中脱颖而出。Kratos 主题内置了强大的主题后台控制平台，
            
        </summary>
        
        <category term="Develop"/>
        
        <category term="Tech"/>
        
        <category term="WordPress"/>
        
        <category term="Kratos"/>
        
    </entry>
    
    <entry>
        <title>动态范围 宽容度 RAW Log 都是什么</title>
        <link href="https://www.isthnew.com/archives/dynamic-range-latitude-raw-log.html"/>
        <id>https://www.isthnew.com/archives/dynamic-range-latitude-raw-log.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2018-01-11T14:05:57+00:00</published>
        <updated>2018-01-11T14:05:57+00:00</updated>
        
        <content type="html"><![CDATA[<p>写这个主要是因为昨天B站视频评论，里面有个人在自己也不懂“动态范围”“宽容度”的情况下强行给别人科普。他认为照片能拉回多少高光和暗部信息叫宽容度，而在视频中这个概念叫动态范围，在视频中使用 Log 模式拍摄能提高动态范围。</p>
<h3></h3>]]></content>
        
        <summary type="html">
            
            写这个主要是因为昨天B站视频评论，里面有个人在自己也不懂“动态范围”“宽容度”的情况下强行给别人科普。他认为照片能拉回多少高光和暗部信息叫宽容度，而在视频中这个概念叫动态范围，在视频中使用 Log 模式拍摄能提高动态范围。 
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="动态范围"/>
        
        <category term="宽容度"/>
        
        <category term="RAW"/>
        
        <category term="Log"/>
        
    </entry>
    
    <entry>
        <title>CNAME 接入 Cloudflare 使用免费 Railgun</title>
        <link href="https://dcc.cat/cloudflare.html"/>
        <id>https://dcc.cat/cloudflare.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2018-01-11T02:11:00+00:00</published>
        <updated>2018-01-11T02:11:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>CNAME 接入 Cloudflare</h2><h3>为何选择 CNAME 接入 Cloudflare</h3><p>Cloudflare 是国外 CDN 厂商，提供免备案无限流量 CDN，免费的 HTTPS 证书和无限量的 DDOS 防御，深受中小站长的喜爱，海外线路非常不错，国内的话移动线路也很棒。可惜的是默认免费版只能进行 NS 记录，这意味着还需要更改域名的 NS，实在是麻烦。CNAME 接入方式只支持 200 美元/月以上的 Business 或 Enterprise plan，这对于很多人来说都太贵了。同时 CNAME 接入可以完成一些骚操作，比如利用 GEO DNS 实现分区解析，国内 CDN + 海外 CDN 实现全球加速。</p><p>作为 Cloudflare 的 Partner 也就是所谓“合作伙伴”，我可以提供免费的 CNAME 接入方案，只需在 <strong><a href="https://cdn.dcc.cat">我的面板</a></strong> 登录 Cloudflare 账户即可，完全利用 Cloudflare 官方的 API，不涉及任何安全问题。</p><h3>接入步骤</h3><ul><li><strong>在 <a href="https://cdn.dcc.cat">https://cdn.dcc.cat</a> 上登录 Cloudflare 账户</strong></li></ul><p>注意您输入的用户名和密码对 Partner 不可见，面板也不会获取您的 Global API Key，您的隐私安全可以得到保障。</p><ul><li>添加域名（注意域名不能在 Cloudflare 官方，百度云加速或其他 Cloudflare Partner 接入）</li></ul><p><img src="https://i.yecdn.com/images/2018/05/31/7ab63d09c1f6b81e01c8f2ab5d37619d.png" /></p><ul><li><strong>查看域名，并修改解析</strong></li></ul><p><img src="https://i.yecdn.com/images/2018/05/31/1f6a80c360a708741ef3bdad119055bc.png" /></p><p>最重要的是要修改的是源站地址，在修改界面，填写源站的 CNAME 地址，注意是 CNAME 地址不是 IP 地址，如果源站服务器不提供域名的话怎么办呢，那就自行添加一条记录就 OK 啦。</p><p>然后我们需要在 DNS 管理商那边按需添加自己的 DNS，将 <code>example.com</code> 和 <code>www.example.com</code> 分别解析到 <code>example.com.cdn.cloudflare.net</code> 和 <code>www.example.com.cdn.cloudflare.net</code> 即可实现 CNAME 接入 Cloudflare.</p><p>当然如果你想要薅羊毛的话，可以直接解析到 <code>www.cloudflare.com</code> 享受 Cloudflare 5000 刀节点。</p><h2>免费使用 Cloudflare Railgun</h2><h3>Railgun：一切皆可缓存</h3><blockquote>Cloudflare 的 Railgun 使用高级网络优化，确保尽快交付客户内容。过去，大多数 Web 内容无法缓存是因为它们是动<br />态的。然而，即便动态内容的变化速度十分缓慢也无法缓存。Railgun 会跟踪页面变化，一直向下跟踪至字节，并仅发<br />送整个网络上实际变化的字节。<br />Railgun 实现了 99.6% 的压缩率，这意味着，过去需要 200 个数据包才能发送的内容现在只需单个数据包即可发送。<br />这样一来，便为网站访问者带来 140% 的性能提升。<br />Railgun 可以与 Cloudflare 的其他性能优化技术结合使用，其中包括自动网络路由优化、SPDY 支持、Polish™ 和<br />Mirage™ 图像优化以及 Rocket Loader™。通过这套工具，Cloudflare 可确保您的主机托管服务在世界各地都尽可能快<br />地运行。</blockquote><p>简单来说，Railgun 能让源站的动态内容几乎全部静态化，进而大大加快加载的速度，也能<strong>一定程度上缓解</strong>对于动态页面的 CC 攻击，当然正常的用户需要付出 200 刀才可以享受这一特性，那么作为 Partner 用户，也可以免费享受这一特性。</p><h3>在源站安装 Railgun</h3><ul><li><strong>CentOS 7</strong></li></ul><pre><code>sudo rpm -ivh http://pkg.cloudflare.com/cloudflare-release-latest.el7.rpm
sudo yum update &amp;&amp; yum install railgun-stable -y</code></pre><ul><li><strong>Ubuntu 16 / Debian 9</strong></li></ul><pre><code># Ubuntu 16
echo 'deb http://pkg.cloudflare.com/ xenial main' | sudo tee /etc/apt/sources.list.d/cloudflare-main.list
# Debian 9
echo 'deb http://pkg.cloudflare.com/ stretch main' | sudo tee /etc/apt/sources.list.d/cloudflare-main.list
# 安装过程一致
curl -C - https://pkg.cloudflare.com/pubkey.gpg | sudo apt-key add -
sudo apt-get update &amp;&amp; sudo apt-get install railgun-stable -y</code></pre><p>会自动安装 Railgun Server 和 memcached，其中 memcached 的版本一般非常老，如果需要的话可以自行编译安装新版。</p><h3>修改配置并启动</h3><pre><code>vi /etc/railgun/railgun.conf</code></pre><p>找到如下两行进行修改：</p><pre><code>activation.token = &lt;这里填写 Railgun 的 Token&gt;
activation.railgun_host = &lt;这里填写服务器的公网 ip&gt;</code></pre><p>然后启动 Railgun</p><pre><code>service railgun start</code></pre><p>成功的话可以看到面板上已经显示开通。</p><h2>关于 Cloudflare 的一些设置</h2><p>Cloudflare 有很多可选择的配置这边简单的列出一些，包括源站和 CF 面板上的配置。</p><h3>Real-IP</h3><p>加了 CDN 以后如何获取访客真实 IP 是一个问题，特别是加了 Railgun 以后，日志里所有的访问 IP 都是本机这就很尴尬了<br />我们建立一个 <code>cloudflare.conf</code> 放在 <code>conf.d</code> 中，在 <code>http</code> 块或者 <code>server</code> 块中引入即可。</p><pre><code>proxy_set_header X-Real-IP $remote_addr;
proxy_set_header Host $host;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
real_ip_header CF-Connecting-IP;
set_real_ip_from 103.21.244.0/22;
set_real_ip_from 103.22.200.0/22;
set_real_ip_from 103.31.4.0/22;
set_real_ip_from 104.16.0.0/12;
set_real_ip_from 108.162.192.0/18;
set_real_ip_from 131.0.72.0/22;
set_real_ip_from 141.101.64.0/18;
set_real_ip_from 162.158.0.0/15;
set_real_ip_from 172.64.0.0/13;
set_real_ip_from 173.245.48.0/20;
set_real_ip_from 188.114.96.0/20;
set_real_ip_from 190.93.240.0/20;
set_real_ip_from 197.234.240.0/22;
set_real_ip_from 198.41.128.0/17;
real_ip_recursive on;
# V6 部分可以自行决定是否选择</code></pre><h3>防止泄漏源站 IP</h3><p><strong>在 nginx <code>http</code> 块中添加：</strong></p><pre><code># 禁止外网访问
allow 127.0.0.1/8;
allow 10.0.0.0/8;
allow 192.168.0.0/16;
# allow railgun server ip
deny all;</code></pre><p><strong>在 nginx <code>server</code> 模块中写 <code>listen 127.0.0.1:80</code>，然后对外网开启 <code>2408 Railgun</code> 端口。</strong></p><h3>如何修利用 API 修改源站地址</h3><p>有同学觉得源站设置为 CNAME 地址很麻烦，而且有泄露源 IP 的风险，当然 Cloudflare 默认的 Partner API 就是这样的，当然这边有个利用 API 手动设置源站的办法。</p><ul><li>获取 <code>Global API Key</code></li></ul><p>首先要说明，<code>Global API Key</code> 非常重要，相当于你的账户邮箱和密码，普通的 CNAME 接入不需要获取 <code>Global API Key</code> 就可以修改，但是部分面板会有获取该密钥，请务必注意账户安全。</p><p>在 <a href="https://dash.cloudflare.com/profile">个人信息页面</a> 最下方获取 <code>Global API Key</code>，最好用小本本记下来。下面我们会用 <code>your_cloudflare_global_api_key</code> 来代替该密钥。</p><ul><li>获取 <code>Domain ID</code></li></ul><p><code>Domain ID</code> 就是你需要更改源站的标志，假设你的域名为 <code>example.com</code>，Cloudflare 账户邮箱为<code>mail@example.com</code> 执行如下代码：</p><pre><code>curl -X GET &quot;https://api.cloudflare.com/client/v4/zones?name=example.com&amp;status=active&amp;page=1&amp;per_page=20&amp;order=status&amp;direction=desc&amp;match=all&quot; \
     -H &quot;X-Auth-Email: mail@example.com&quot; \
     -H &quot;X-Auth-Key: your_cloudflare_global_api_key&quot; \
     -H &quot;Content-Type: application/json&quot;</code></pre><p>返回记录里找到 <code>&quot;id&quot;:&quot;your_account_domain_id&quot;,&quot;name&quot;:&quot;example.com&quot;</code> 内容，记录为 <code>your_account_domain_id</code></p><ul><li>获取 <code>DNS Record ID</code></li></ul><p>这边是你需要修改的某个域名的记录，假设已经存在的，要修改的记录为 <code>CNAME www cf.www.example.com</code>，我们这样操作：</p><pre><code>curl -X GET &quot;https://api.cloudflare.com/client/v4/zones/your_account_domain_id/dns_records?type=CNAME&amp;name=www.example.com&amp;content=cf.www.example.com&amp;page=1&amp;per_page=20&amp;order=type&amp;direction=desc&amp;match=all&quot; \
     -H &quot;X-Auth-Email: mail@example.com&quot; \
     -H &quot;X-Auth-Key: your_cloudflare_global_api_key&quot; \
     -H &quot;Content-Type: application/json&quot;</code></pre><p>返回记录里找到 <code>&quot;id&quot;:&quot;your_account_dns_record_id&quot;,&quot;type&quot;:&quot;CNAME&quot;</code> 内容，记录为 <code>your_account_dns_record_id</code></p><ul><li>修改该 DNS 记录</li></ul><p>终于到了修改源站的部分了，利用之前获得的 <code>your_account_domain_id</code> <code>your_account_dns_record_id</code> 我们进行如下操作：</p><pre><code>curl -X PUT &quot;https://api.cloudflare.com/client/v4/zones/your_account_domain_id/dns_records/your_account_dns_record_id&quot; \
     -H &quot;X-Auth-Email: mail@example.com&quot; \
     -H &quot;X-Auth-Key: your_cloudflare_global_api_key&quot; \
     -H &quot;Content-Type: application/json&quot; \
     --data '{&quot;type&quot;:&quot;A&quot;,&quot;name&quot;:&quot;www.example.com&quot;,&quot;content&quot;:&quot;8.8.8.8&quot;,&quot;ttl&quot;:120,&quot;proxied&quot;:false}'</code></pre><p>就完成了对源站的修改，新源站记录为 <code>A www 8.8.8.8</code>，一旦修改完毕源站地址，在管理面板上就看不到该条记录了。所以推荐在之前配置已经生效的情况下操作。</p>]]></content>
        
        <summary type="html">
            
            CNAME 接入 Cloudflare为何选择 CNAME 接入 CloudflareCloudflare 是国外 CDN 厂商，提供免备案无限流量 CDN，免费的 HTTPS 证书和无限量的 DDOS 防御，深受中小站长的喜爱，海外线路非常不错，国内的话移动线路也很棒。可惜的
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Typecho主题：Cactus</title>
        <link href="https://www.iwch.me/archives/668.html"/>
        <id>https://www.iwch.me/archives/668.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2018-01-06T17:20:00+00:00</published>
        <updated>2018-01-06T17:20:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>Cactus：一个简约的Typecho响应式主题。</p><h2>下载</h2><p>GitHub：<a href="https://github.com/ZoharWang/typecho-theme-Cactus" target="_blank">ZoharWang/typecho-theme-Cactus</a><del>（无耻求Star</del></p><h2>安装</h2><ol>
<li>下载压缩包并解压</li>
<li>修改文件夹名为Cactus</li>
<li>上传文件夹至Typecho的/usr/themes目录下</li>
<li>在控制台的网站外观中启用主题</li>
</ol><h2>效果</h2><p><img src="https://static.yecdn.com/static/blog/post/668/screenshot.png" /></p><p>Demo：<a href="https://typecho.iwch.me/?theme=Cactus" target="_blank">https://typecho.iwch.me</a></p><h2>相关</h2><p><a href="https://github.com/digitalcraftsman/hugo-cactus-theme" target="_blank">https://github.com/digitalcraftsman/hugo-cactus-theme</a></p></div>]]></content>
        
        <summary type="html">
            
             Cactus：一个简约的Typecho响应式主题。下载GitHub：ZoharWang/typecho-theme-Cactus（无耻求Star安装  下载压缩包并解压  修改文件夹名为Cactus  上传文件夹至Typecho的/usr/themes目录下  在控制台的网站
            
        </summary>
        
    </entry>
    
    <entry>
        <title>再见 2017， 你好 2018</title>
        <link href="https://liyin.date/2018/01/02/bye_2017_hello_2018/"/>
        <id>https://liyin.date/2018/01/02/bye_2017_hello_2018/</id>
        
        <published>2018-01-02T16:34:30+00:00</published>
        <updated>2018-01-02T16:34:30+00:00</updated>
        
        <content type="html"><![CDATA[<p>新年和圣诞都过去了，随着圣诞节过去，这个博客也已经建立了1年，最近手边的事情太多没赶上年底写完总结，于是推迟到了现在，真是怠惰啊….</p>]]></content>
        
        <summary type="html">
            
            新年和圣诞都过去了，随着圣诞节过去，这个博客也已经建立了1年，最近手边的事情太多没赶上年底写完总结，于是推迟到了现在，真是怠惰啊….
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Goodbye 2017</title>
        <link href="https://blog.nfz.moe/archives/good-bye-2017.html"/>
        <id>https://blog.nfz.moe/archives/good-bye-2017.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2018-01-02T05:43:00+00:00</published>
        <updated>2018-01-02T05:43:00+00:00</updated>
        
        <content type="html"><![CDATA[<p> 不知不觉，一年的时间过去了, 又该写几笔来回忆过去这一年了。。</p><a></a><hr /><p> 我的博客自成立以来已经一年有余了。所以先从我的博客开始写起吧。。<br /> 还记得一年多前，使用 Hostinger 免费虚拟主机，使用 Typecho 搭建我的博客开始，到现在几次辗转迁移、更换程序。在这个过程中，我认识了许多的小伙伴，了解了许多原来不知道的知识，并且主动去学习了更多有关的知识。在这过去一年中我写了 39 篇博客，得到了 398 条评论，交换了 35 条友链。<br /> 我是从今年 7 月 2 日开始启用 Google Analytics 的。之前一年使用 Piwik 统计的数据可以在 <a href="https://blog.nfz.moe/archives/2016-blog-analytics.html"> 博客统计报告（2016.11.26-2017.07.02）</a> 这篇文章看到。<br /> 不过还是直接放访问统计数据吧。过去的半年中，累计有 16027 人到访了我的博客，页面访问量为 53666 次（虽然是半年的数据，但是这个数据看起来还是有点可怜啊）<br /> 不过还偶然发现自己的域名 <code>nfz.moe</code> 今年七月时被 Alexa 收录了，现在 Alexa 指数已经是 60W 了。</p><hr /><p> 今年认识了不少 dalao 和菊苣（基本都是在 Telegram 上认识的），嗯让我数一数（以下排名不分先后）</p><p>LWL12、Ephen、kn007、milkice、DIYgod、ZeroClover、芸枫、KookXiang、NeverBehave、Anankke、Kugelblitz、mokeyjay、静静、jq(x10)、Elepover、Indexyz、DCC、kotomei、TYPCN、METO、Zohar、呆瓜瓜~、iijboom、stneng，以及 91Yun 大佬群、某治疗中心 的各路大佬们 (</p><p> 不管怎么说，认识一堆 dalao 是很有用的 (</p><hr /><p> 今年过得还算挺充实的，数数过来的话大概可以这么概括一下：</p><ul><li> 离开了酷安 </li><li> 和 LetITFly 一起重建了 <del>MAT BBS</del> <a href="https://bbs.letitfly.me" target="_blank">LetITFly BBS</a></li><li> 认识了一大堆菊苣和 dalao，也怼了不少人 </li><li> 开始使用 Telegram（@neoFelhz），并创建了一个自己的频道 <a href="https://t.me/neoFelhzW" target="_blank">neoFelhz’s Channel</a></li><li> 抛弃了所有的国内社交方式——包括但不限于微博、QQ、微信 </li><li> 赞助了 <code>cdn.geekzu.org</code> 公共库部分 CDN</li><li> 在 GitHub 上面加了一堆 organization（然而大部分并没有什么卵用）</li><li> 造了几个轮子、写了一些简单的练手的项目和页面 </li></ul><p>2017 年是忙碌充实的一年。但是接下来的一年对我来说也许会更为繁忙——又有不少轮子要造，高考也已经临近了，至少未来半年的文章数量应该不会太多了。</p><hr /><p> 说到轮子，我今年造了几个轮子，不过勉强能拿得上台面的应该只有这几个：</p><ul><li> 自己维护的一个去广告 Hosts 项目—— <a href="https://github.com/neko-dev/neohosts" target="_blank">neoHosts</a></li><li> 实现了用 Travis CI 持续集成 <a href="https://github.com/phoenixlzx/planet.js" target="_blank"><code>Planet.js</code></a>，并且想法子了解决了因防盗链丢图的问题 <a href="https://planet.nfz.moe" target="_blank">https://planet.nfz.moe</a></li><li> 在 METO <a href="https://i-meto.com/chrome-binary/" target="_blank"> 这篇文章 </a> 的启发下，用 shell 写了一个 <a href="https://github.com/neoFelhz/ChromeChecker" target="_blank">ChromeChecker</a>，每 24 小时检查一次 Chrome 离线包的更新，也是用的 Travis CI。 <a href="https://chrome.nfz.moe" target="_blank">https://chrome.nfz.moe</a></li><li> 帮 Trumeet 写了 Dir 的主页： <a href="https://dir.trumeet.top" target="_blank">https://dir.trumeet.top</a></li><li> 帮 BAIDNS 项目写了主页： <a href="https://baidns.cn" target="_blank">https://baidns.cn</a></li></ul><hr /><p> 突然又变成碎碎念了。。。不过无论怎么说，希望在新的一年学到更多的技术，然后折腾出一些好玩的东西来，和一些小伙伴一起造更多的轮子 (oﾟ▽ﾟ)o</p><blockquote><p> 知其白，守其黑，为天下式——《道德经》</p></blockquote>]]></content>
        
        <summary type="html">
            
             不知不觉，一年的时间过去了, 又该写几笔来回忆过去这一年了。。 我的博客自成立以来已经一年有余了。所以先从我的博客开始写起吧。。 还记得一年多前，使用 Hostinger 免费虚拟主机，使用 Typecho 搭建我的博客开始，到现在几次辗转迁移、更换程序。在这个过程中，我认识
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>再见 2017 ，你好 2018</title>
        <link href="https://blog.asec01.net/hello-2018/"/>
        <id>https://blog.asec01.net/hello-2018/</id>
        
        <published>2018-01-01T15:06:11+00:00</published>
        <updated>2018-01-01T15:06:11+00:00</updated>
        
        <content type="html"><![CDATA[
<p>时光飞逝，转眼间博主快18咯<br />
这一年发生了许多许多<br />
记性不好，这些能记住的都算印象深刻了吧。。。<br />
这是我的第一篇“年终总结”</p>
<hr />
<h4>年初</h4>
<p>刚开完一个令我印象深刻的联欢会，</p>
<blockquote>
<p>为啥印象深刻呢？校级联欢，老师托我搞了个微信墙。。。Exciting</p>
<p>&lt;-- 这行记录的事情被我隐藏了，知道这些事的人并不多。。 --&gt;</p>
</blockquote>
<p>就被主任托给各个会考科目的老师折腾会考去了。。。一个元旦折腾过去，会考过了。</p>
<p>入坑Ingress，成了北绿一个小小的特工。</p>
<hr />
<h4>寒假</h4>
<p>参与了北京南站的志愿者活动，在一个小团体过得挺舒服，也看到了一些社会上的不良现象。</p>
<hr />
<h4>三月</h4>
<p>上一届的高三成人礼，再次在后台干活。<br />
急脾气该改改了，我坚持自己的方案，差点与某个没理解我思路的老师吵起来。。。<br />
成人礼最后，想用奶油整一下某个学长，最后却被他按在地上抹了一脸[捂脸]</p>
<p>生日那天，明明送了我一组 USB充电的AA电池 ，之前一直念叨让学校买点试试，结果他先买了（似乎现在学校还没买。。。），现在一个在鼠标里，两个在包里备着，还有一个在家里吃灰。。。</p>
<hr />
<h4>四月</h4>
<p>游学，去西安，各种折腾，晚上睡觉前要收手机，第一天交了一个，第二天年级组长看我在接近收手机时发了个朋友圈，于是断定我有俩手机，于是晚上交了俩（我带了四个哈哈哈）<br />
&lt;-- 感情问题。。。继续隐藏。。。 --&gt;</p>
<hr />
<h4>接近夏天</h4>
<p>和明明一起参加了个 <a href="https://blog.asec01.net/robot-competition-2017/">机器人足球比赛</a> ，非常懵逼的干趴下好几队。。。在最后一轮输给了冠军。。。然后似乎全校老师都认识我和明明了。。。</p>
<p>放假前和明明<a href="https://blog.asec01.net/bj54zx-2017-summer/">帮学校弄视频</a>，第一次用 AE 做动画（套模板）</p>
<hr />
<h4>暑假</h4>
<p>刚放假就去石家庄“玩”，被老姐按在她屋里学了两周，回京继续被她按着学。。。</p>
<p>老妈收走了我的显示器。。于是我这个熊孩子找了个废笔记本屏幕<a href="https://blog.asec01.net/how-to-modified-laptop-screen-to-monitor/">组装了个显示器</a>。。。</p>
<hr />
<h4>秋季开学</h4>
<p>没啥好说的，学吧（我这重度电子依赖症终于能一整天离开手机了）<br />
搬到 分校后基本没得玩了。。。<br />
班里电脑 没有网，于是接了无线网卡，后来觉得无线网卡不好使又换了路由器。。。</p>
<hr />
<h4>年末</h4>
<p>新年联欢，主任出差，设备靠自己，照样玩得挺High</p>
<hr />
<p>其他事件等我想起来再加吧 。。。。</p>
<hr />
<h4>最后</h4>
<p>希望自己在高考前少碰点电子设备吧。。。</p>]]></content>
        
        <summary type="html">
            
             时光飞逝，转眼间博主快18咯 这一年发生了许多许多 记性不好，这些能记住的都算印象深刻了吧。。。 这是我的第一篇“年终总结”  年初 刚开完一个令我印象深刻的联欢会，  为啥印象深刻呢？校级联欢，老师托我搞了个微信墙。。。Exciting &amp;lt;-- 这行记录的事情被我隐藏
            
        </summary>
        
    </entry>
    
    <entry>
        <title>以程序员的角度玩微信跳一跳</title>
        <link href="https://i-meto.com/wechat-jump-game/"/>
        <id>https://i-meto.com/wechat-jump-game/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2018-01-01T12:57:42+00:00</published>
        <updated>2018-01-01T12:57:42+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>前些日子微信推出了一款小游戏「跳一跳」，游戏中玩家需要扮演一个「黑色」小人，在不同颜色、形状的跳板方块间进行跳跃。操作也很容易，按压屏幕越久，小人会跳得越远。</p>
<p>显然这游戏对我这样的手残党非常不友好</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/fail.png" /></p>
<p>若干次徘徊在十位数后，决定好好研究这个游戏，用程序员的思路去解决它。</p>
<p>外挂无非两种：内存修改、物理辅助。这里研究后者，也就是识别出跳跃距离后，换算成时间后模拟真实触碰操作。这种方式最保险，而且不容易被后台察觉 XD</p>
<p>观察棋子，不难发现棋子的颜色始终是没有变化的，因此可以根据颜色识别出棋子中最宽的部分，取中心即可</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/02/chess.png" /></p>
<p>棋盘部分比较难识别，忽略掉背景色后会有阴影等因素的干扰，还有前后两个棋子紧挨的特殊情况。</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/chess_scan.png" /></p>
<p>考虑从上到下做行扫描，提取出所有连续的颜色块，排除掉中心点与棋子过于靠近的情况，这样就避免识别到棋子头部，取最上面且长度大于棋子宽度的切片，就得到目标点横坐标。</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/chess_scan_1.png" /></p>
<p>对于纵坐标可以只考虑棋盘右侧，这样就不需要和阴影打交道。棋盘只有圆盘、方块两种类型，边缘的锯齿状如下</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/chess_scan_2.png" /></p>
<p>容易发现规律，方块的中心线位于边缘峰值处，圆盘的中心线在峰值处偏下。可以设定一个计数器，当边缘连续 4-5 次没有增加时停止，将此处确定为纵坐标。</p>
<p>有时候两个方块相邻会出现识别失败，可以通过角度的方式来重新确定纵坐标。</p>
<p>$$T_x = S_x - \frac{|T_y-S_y|}{\sqrt{3}}$$</p>
<p>通过以上步骤就可以精准识别坐标点了，接下去需要将坐标距离转成按压时间。</p>
<p>我们先使用命令 <code>adb shell input swipe &lt;x&gt; &lt;y&gt; &lt;x&gt; &lt;y&gt; &lt;time&gt;</code> 测出几组数据</p>
<table>
<thead>
<tr>
<th>#</th>
<th>dist</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>278</td>
<td>444</td>
</tr>
<tr>
<td>2</td>
<td>301</td>
<td>493</td>
</tr>
<tr>
<td>3</td>
<td>403</td>
<td>608</td>
</tr>
<tr>
<td>4</td>
<td>154</td>
<td>273</td>
</tr>
<tr>
<td>5</td>
<td>496</td>
<td>775</td>
</tr>
<tr>
<td>6</td>
<td>304</td>
<td>501</td>
</tr>
<tr>
<td>7</td>
<td>397</td>
<td>632</td>
</tr>
<tr>
<td>8</td>
<td>260</td>
<td>445</td>
</tr>
<tr>
<td>9</td>
<td>473</td>
<td>709</td>
</tr>
<tr>
<td>10</td>
<td>143</td>
<td>257</td>
</tr>
<tr>
<td>11</td>
<td>543</td>
<td>802</td>
</tr>
<tr>
<td>12</td>
<td>666</td>
<td>953</td>
</tr>
<tr>
<td>13</td>
<td>618</td>
<td>884</td>
</tr>
<tr>
<td>14</td>
<td>507</td>
<td>794</td>
</tr>
</tbody>
</table>
<p>使用指数模型进行拟合</p>
<p>$$time = k \cdot dist^{p}$$</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/mathematica.png?v=2" /></p>
<p>随便写个 PHP 脚本跑一下看看</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/jump.png" /></p>
<p>微调参数后还没有出现失败的情况，最高连击 72 次！完美！</p>
<p>脚本地址：<a href="https://github.com/metowolf/JumpJumpHelper">https://github.com/metowolf/JumpJumpHelper</a></p>
<hr />
<p><strong>最后感谢一下把我文章抄走的网站</strong></p>
<pre><code>http://www.sohu.com/a/214275441_309070
搜狐网，删除作者署名，删除 GitHub 链接，删除原文链接
</code></pre>
</div>]]></content>
        
        <summary type="html">
            
            前些日子微信推出了一款小游戏「跳一跳」，游戏中玩家需要扮演一个「黑色」小人，在不同颜色、形状的跳板方块间进行跳跃。操作也很容易，按压屏幕越久，小人会跳得越远。 显然这游戏对我这样的手残党非常不友好  若干次徘徊在十位数后，决定好好研究这个游戏，用程序员的思路去解决它。 外挂无非
            
        </summary>
        
    </entry>
    
    <entry>
        <title>再见 2017！你好 2018！</title>
        <link href="https://131.re/marchives/112"/>
        <id>https://131.re/marchives/112</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2018-01-01T04:00:00+00:00</published>
        <updated>2018-01-01T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[
<p>请启用Javascript</p>
<p>再见 2017！你好 2018！</p>
<p>再見 2017！你好 2018！</p>
<p>Goodbye 2017! Hello 2018!</p>
<p>さよなら2017！こんにちは2018！</p>
<p>Au revoir 2017! Bonjour 2018!</p>
<p>До свидания 2017! Привет 2018!</p>
<p>Auf Wiedersehen 2017! Hallo 2018!</p>
<p>وداعا 2017! مرحبا 2018!</p>
<p>Adiós 2017! ¡Hola 2018!</p>
]]></content>
        
        <summary type="html">
            
             请启用Javascript 再见 2017！你好 2018！ 再見 2017！你好 2018！ Goodbye 2017! Hello 2018! さよなら2017！こんにちは2018！ Au revoir 2017! Bonjour 2018! До свидания 20
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Bye 2017, Hi 2018</title>
        <link href="https://blog.lwl12.com/read/bye-2017-hi-2018.html"/>
        <id>https://blog.lwl12.com/read/bye-2017-hi-2018.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-12-31T16:00:20+00:00</published>
        <updated>2017-12-31T16:00:20+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/bye-2017-hi-2018.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/12/2018-700x180.jpeg" /></a></p><p>CE2018，LWL 的自由天空，雷达已识别，上升到高度层 1514736000。<br />
<span></span><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/12/2018.jpg" /><br />
<div></div><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2018/01/1514634917819.jpeg" /><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2018/01/1514634920655.jpeg" /><br />
<br />
- EOF -</p>]]></content>
        
        <summary type="html">
            
            CE2018，LWL 的自由天空，雷达已识别，上升到高度层 1514736000。       - EOF -
            
        </summary>
        
        <category term="记录"/>
        
    </entry>
    
    <entry>
        <title>点亮2018：无垠2017年度总结</title>
        <link href="https://flyhigher.top/diary/903.html"/>
        <id>https://flyhigher.top/diary/903.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-12-31T15:59:46+00:00</published>
        <updated>2017-12-31T15:59:46+00:00</updated>
        
        <content type="html"><![CDATA[<p>随着 Telegram 换上了小红帽，2017也即将要过去。在2017年的最后一段时间，我终于开始写这篇拖了很久的总结。</p>
<blockquote><p>That the powerful play goes on, and you may contribute a verse.</p></blockquote>
<h3>2017大事记</h3>
<p>1月：博客重新上线并启用新域名</p>
<p>4月：参加 TEDxYouth@Ningbo</p>
<p>4月：博客启用 <code>HTTPS</code> 和 <code>HTTP/2</code></p>
<p>7月：参加 hack.init()，靠着队员的 Carry 水了一波</p>
<p>7月：博客启用新的 Datacenter – Singapore B</p>
<p>7月：去北京参加机器人比赛，关键时刻小车炸了，气死</p>
<p>8月：博客上线1000天</p>
<p>11月：自行开发的 WordPress 主题 MDx 正式发布</p>
<p>12月：参加了浙江省普通高中学业水平考试</p>
<p>12月：去 TEDxNingbo 2017 大会玩</p>
<h3>总了个结</h3>
<p>2017是还算充实的一年，很开心，也谢谢所有帮助了我的人。</p>
<p>2017，认识了很多大佬，也在努力学习新技术。之前沉迷学习了一段时间，然后发现自己已经完全跟不上前端发展的脚步了（前端发展真快2333），所以还在努力学习（同时还有 Docker）。</p>
<p>2017，看着 TGCN 搞事情，但并不想在 TGCN 里有什么很强的存在感。。</p>
<p>2017，真真切切感受到了新高考的压力，还是要努力啊。</p>
<p>2017，还是期待更好的2018。</p>
<h3><del> 一些数据 </del>并没有</h3>
<p>悄咪咪部署了统计系统，访问量不出意外的少。不过流量在11月左右开始增长（因为发布主题啦），但还是不能跟那些大佬们比。无所谓啦，反正不在乎流量（逃</p>
<p>没有去年的数据所以没有比较，不过明年的总结应该会有了（雾</p>
<h3>一些<del> 辣鸡 </del>海报</h3>
<p>自己做了一些跨年海报（emmm其实是我的习惯），虽然辣鸡但还是不要脸地放上来了。</p>
<p>多图预警</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/71.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/71.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/68.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/68.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/35.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/35.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/05.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/05.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/0.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/0.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/43.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/43.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/12/b0000.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/12/b0000.jpg" /></a></p>
<p>那么，最后，还是祝各位新年快乐啦！</p>
<blockquote><p>
The question, Oh me! so sad, recurring—What good amid these, Oh me, Oh life?</p>
<p>Answer:<br />
That you are here—that life exists and identity,<br />
That the powerful play goes on, and you may contribute a verse.</p>
BY Walt Whitman
</blockquote>]]></content>
        
        <summary type="html">
            
            随着 Telegram 换上了小红帽，2017也即将要过去。在2017年的最后一段时间，我终于开始写这篇拖了很久的总结。 That the powerful play goes on, and you may contribute a verse. 2017大事记 1月：博客重
            
        </summary>
        
        <category term="其他"/>
        
        <category term="2017"/>
        
        <category term="2018"/>
        
        <category term="总结"/>
        
        <category term="新年"/>
        
    </entry>
    
    <entry>
        <title>关于校园网HTTP劫持的分析</title>
        <link href="https://i-meto.com/scut-hijack-internet-traffic/"/>
        <id>https://i-meto.com/scut-hijack-internet-traffic/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-12-24T06:31:40+00:00</published>
        <updated>2017-12-24T06:31:40+00:00</updated>
        
        <content type="html"><![CDATA[<div><img src="https://images.unsplash.com/photo-1523372102243-c9426fc31b88?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ&amp;s=7f2cecc9ae4fce0cdabcf2cc4f0473e7" /><p>接上文 <a href="https://i-meto.com/shit-scutweb/">https://i-meto.com/shit-scutweb/</a></p>
<p>最近发现不少应用的联网异常，尤其是网易云音乐的播放时常请求失败，怀疑是垃圾校园网搞的鬼，于是做了一些分析。</p>
<p>通过抓包不难发现有不少类似 <code>http://202.38.196.91/cache/5/05/music.126.net/**.mp3</code> 的请求。通过查询 IP 发现这台服务器位于校内，开放了 80 端口，初步判断是一台缓存服务器。</p>
<p>使用 wireshark 进行抓包，得到更详细的请求过程</p>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/5a3f377adb8dc.png" /></p>
<ul>
<li>18,19,20: TCP 三次握手</li>
<li>21: GET 请求下载 QQ 安装包</li>
<li><strong>22: （抢答）302 跳转，同时关闭连接 [FIN]</strong></li>
<li>27: 真正的应答包，[Out-Of-Order]</li>
</ul>
<p>可以看出这是经典的单向中断访问型劫持，其原理就是通过旁路设备监听数据包，一旦发现特征（如存在相应缓存）就伪造服务器向用户发送 RST 阻止后续 TCP 连接（很像 DNS 污染的原理</p>
<p><img src="https://image.static.i-meto.com/uploads/2018/01/network.png" /></p>
<p>既然只是抢答包，那么直接在路由器上丢弃就可以了。一种最简单的方式就是通过匹配字符串丢弃，详情见前文。由于效率问题，本文介绍一种基于 TTL/ID 的拦截手段。</p>
<p>劫持包<br />
<img src="https://image.static.i-meto.com/uploads/2017/12/hijack1.png" /></p>
<p>正常应答包<br />
<img src="https://image.static.i-meto.com/uploads/2017/12/hijack2.png" /></p>
<p>根据 RFC 的规定，identification 应该是公差为 1 的单调递增数列，TTL 则是每经过一个路由递减。而上图中劫持包的 RST 与握手时不一致，并且 ID 永远都是 <code>0x0080</code>，这是不正常的。</p>
<p><img src="https://i.loli.net/2017/12/25/5a40bfbf6f163.png" /></p>
<ul>
<li>更新：经大牛提醒，这套系统在 ISP 中非常常见，返回的 302 数据包带有 <code>[FIN, PSH, ACK]</code>, 而正常的 302 数据包是不会同时带有上面标志位的。</li>
</ul>
<p>抓到特征后，可以编写规则进行拦截，这里介绍 iptables 的 u32 匹配模式。</p>
<blockquote>
<p>u32 允许你从数据包中提取 4 个字节，然后通过指定的掩码，偏移一定数量的单位到某个位置然后比对这个数值是否为某个值或者是否在某个区间中。(man iptables)</p>
</blockquote>
<p>u32 的语法其实很简单 <code>iptables -m u32 --u32 &quot;Start&amp;Mask=Range&quot;</code></p>
<ul>
<li>start: 表示开始取值的位置 / 字节</li>
<li>Mask: 表示掩码</li>
<li>Range: 表示匹配的范围，可以是一个使用 <code>:</code> 分割开的区间，也可以只是一个数</li>
</ul>
<p>为了示范，这里贴出劫持包的 IP 报文</p>
<pre><code>0000  45 00 00 e3 00 80 00 00  3a 06 c5 28 70 5a 87 eb
0010  c0 a8 01 7f                                     
</code></pre>
<p>TCP 报文</p>
<pre><code>0000  00 50 d7 14 93 f0 17 72  fd 04 3b 71 50 19 39 08
0010  3a 5c 00 00                                     
</code></pre>
<p>我们关心的位置是 <code>identification(0x0080), TTL(0x3A), Flag(5019)</code>, 也就是 IP 报文中的第 05, 08 位置，TCP 报文的第 10 位置。</p>
<p>对应 u32 规则就是 <code>2&amp;0xFFFF=0x0080</code>, <code>5&amp;0xFF=0x3A</code>, <code>0&gt;&gt;22&amp;0x3C@10&amp;25=25</code>.</p>
<p>参考 iptables 文档可以编写出如下规则</p>
<pre><code>iptables -I FORWARD -p tcp --sport 80 -m u32 --u32 &quot;0&gt;&gt;22&amp;0x3C@10&amp;25=25 &amp;&amp; 2&amp;0xFFFF=0x0080 &amp;&amp; 5&amp;0xFF=0x3A&quot; -j DROP
</code></pre>
<p>以上三个规则可以根据需要自行组合，然后配置到路由器上（需要安装 iptables-mod-u32 模块）重启防火墙生效。和之前 string 的方案对比测试，u32 几乎感受不到效率的影响。</p>
<h2>参考资料</h2>
<ul>
<li><a href="http://www.stearns.org/doc/iptables-u32.current.html">iptables u32 Match Tutorial</a></li>
<li><a href="https://imlonghao.com/30.html">我所理解的 iptables u32 匹配</a></li>
<li><a href="https://security.tencent.com/index.php/blog/msg/10">链路劫持攻击一二三</a></li>
<li><a href="https://serverfault.com/questions/231880/how-to-match-port-range-using-u32-filter">How to match port range using u32 filter</a></li>
</ul>
<h2>胡思乱想</h2>
<p>如果能把抢答包加个延迟转发就好了，还不用担心误拦截 XD<br />
每次投诉完都要喝点酒，气！</p>
</div>]]></content>
        
        <summary type="html">
            
            接上文 https://i-meto.com/shit-scutweb/ 最近发现不少应用的联网异常，尤其是网易云音乐的播放时常请求失败，怀疑是垃圾校园网搞的鬼，于是做了一些分析。 通过抓包不难发现有不少类似 http://202.38.196.91/cache/5/05/mu
            
        </summary>
        
        <category term="OpenWrt"/>
        
    </entry>
    
    <entry>
        <title>I&#39;m Still Alive</title>
        <link href="https://ikk.me/archives/default/winter-2017.html"/>
        <id>https://ikk.me/archives/default/winter-2017.html</id>
        
        <author>
            <name>kookxiang</name>
        </author>
        
        <published>2017-12-23T18:00:32+00:00</published>
        <updated>2017-12-23T18:00:32+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="//static.ikk.me/uploads/2017/12/1638425579.jpg" /></p>

<p> &lt; 访问完整版以查看此播放器 &gt; </p>]]></content>
        
        <summary type="html">
            
               &amp;lt; 访问完整版以查看此播放器 &amp;gt; 
            
        </summary>
        
    </entry>
    
    <entry>
        <title>延时摄影入门</title>
        <link href="https://www.isthnew.com/archives/introduction-to-timelapse-photography.html"/>
        <id>https://www.isthnew.com/archives/introduction-to-timelapse-photography.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-12-17T09:35:36+00:00</published>
        <updated>2017-12-17T09:35:36+00:00</updated>
        
        <content type="html"><![CDATA[<p>需要的软件: Premiere Pro、Lightroom Classic、LRTimelapse<br />需要的设备:</p>]]></content>
        
        <summary type="html">
            
            需要的软件: Premiere Pro、Lightroom Classic、LRTimelapse需要的设备:
            
        </summary>
        
        <category term="不能无聊"/>
        
        <category term="延时摄影"/>
        
        <category term="LRTimelapse"/>
        
    </entry>
    
    <entry>
        <title>Bitextor 双语爬虫</title>
        <link href="https://dcc.cat/bitextor.html"/>
        <id>https://dcc.cat/bitextor.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2017-12-15T08:37:00+00:00</published>
        <updated>2017-12-15T08:37:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>配置 Bitextor 环境</h2><p>以下操作均在 <code>Ubuntu 16.04</code> 下完成，运行环境 <code>Azure B2MS</code> 型机器</p><ul><li>首先配置相关的环境（GCC &amp; Python）</li></ul><pre><code>apt-get update &amp;&amp; apt-get upgrade -y
apt-get install automake cmake build-essential autoconf gawk python-pip python-dev python-magic httrack libtidy-0.99-0 libtidy-dev libxml2 libxml2-dev libenca0 libenca-dev screen git sudo wget curl software-properties-common -y
sudo pip install pip --upgrade
sudo pip install scipy numpy python-Levenshtein keras tensorflow h5py langid nltk regex

wget https://apertium.projectjj.com/apt/install-release.sh -O - | sudo bash
sudo apt-get -f install apertium-all-dev</code></pre><ul><li>Java 环境</li></ul><pre><code>sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update -y
sudo apt-get install oracle-java8-installer -y
sudo apt-get install oracle-java8-set-default -y</code></pre><p>记得添加环境变量：</p><pre><code>cat &gt;&gt; /etc/environment &lt;&lt;EOL
JAVA_HOME=/usr/lib/jvm/java-8-oracle
JRE_HOME=/usr/lib/jvm/java-8-oracle/jre
EOL</code></pre><h2>编译安装 Bitextor</h2><pre><code>wget https://sourceforge.net/projects/bitextor/files/bitextor/bitextor-4.1/bitextor-4.1.3.tar.gz
tar zxf bitextor-4.1.3.tar.gz &amp;&amp; rm bitextor-4.1.3.tar.gz &amp;&amp; cd bitextor-4.1.3
./configure
screen make -j2 &amp;&amp; make install</code></pre><h2>Bitextor 的使用</h2><ul><li>输入 <code>bitextor</code> 可得如下使用参数：</li></ul><pre><code>USAGE: bitextor [OPTIONS] -u URL -d DIRECTORY    -v VOCABULARY LANG1 LANG2
USAGE: bitextor [OPTIONS] -d DIRECTORY           -v VOCABULARY LANG1 LANG2
USAGE: bitextor [OPTIONS] -U FILE                -v VOCABULARY LANG1 LANG2
USAGE: bitextor [OPTIONS] -D FILE                -v VOCABULARY LANG1 LANG2
USAGE: bitextor [OPTIONS] -e FILE                -v VOCABULARY LANG1 LANG2

WHERE:
  -u URL          URL of a website to crawl (one per line); if option -d is also
                  enabled, the website is downloaded to the directory specified,
                  if not, it is downloaded in a temporal directory in '/tmp' (or
                  a different directory if -t option is used).
  -U FILE         tab-separated file containing a list of URLs to crawl and their
                  corresponding destination path (one per line).
  -d DIRECTORY    folder containing a crawled website (if option -u is enabled,
                  the website is first downloaded and then processed).
  -D FILE         file containing a list of URIs to folders containing crawled
                  websites.
  -e FILE         uses as an imput the output of the module bitextor-webdir2ett
  LANG1           selected language with two letters code (ISO 639-1): en, es, fr, de ...
  LANG2           selected language with two letters code (ISO 639-1): en, es, fr, de ...

OPTIONS:
  -L PATH           custom path where the directory containing the logs of the
                    different modules of bitextor will be stored
  -l LETTR          custom path where the file with extension .lettr (language
                    encoded and typed data with 'raspa') will be created
                    (/lettr.XXXXXX by default).
  -I PATH           custom path where the output of the intermediate files produced
                    by the modules of bitextor will be stored.
  -b NUM            if this option is enabled, the document alignment process is
                    run in both directions and only the first NUM candidates in
                    every direction will be taken into account. With this, the list
                    of final candidates will be obtained computing the average of
                    every pair of candidates in both directions. This option should
                    improve precision and drop recall, since those candidates in a
                    position lower than NUM will be discarded for the alignment
                    (NUM must be in [1,10])
  -v VOCABULARY     option for using a custom multilingual vocabulary for preliminar
                    document alignment. The vocabulary must be a tab-separated file,
                    in which the first line contains the names of the languages
                    corresponding to each column, and the rest of the lines must
                    contain the same word translated to all these languages.
  -m MAX_LINES      maximum number or wrong segment alignments tolerated to accept a
                    pair of documents as a valid document alignment. If this number
                    is reached, the whole document pair is discarded (5 by default).
  -q MIN_QUALITY    threshold for Hunalign confidence score; those pairs of segments
                    with a score
                    lower than MIN_QUALITY will be considered wrong and they will be
                    removed (0 by default).
  -t TMP-DIR        alternative tmp directory (/tmp by default).
  -x                if this option is enabled, the output of the tool will be.
                    formated in the standard XML-based format TMX.
  -a                if this option is enabled, Bitextor will perform the alignment only
                    at the level of documents. The output will be tab-sepparated, with
                    three fields: two with the name of the documents aligned and one with
                    the score provided by hunalign for the pair of documents.
  -M                morphological analyser in the Apertium platform for source language
                    that will allow to apply word matching directly on lemmas; this is an
                    important tool for aglutinant languages in order to obtain a good
                    coverage with the bilingual lexicon approach.
  -N                morphological analyser in the Apertium platform for target language
                    that will allow to apply word matching directly on lemmas; this is an
                    important tool for aglutinant languages in order to obtain a good
                    coverage with the bilingual lexicon approach.
  -O FILE           if this option is enabled, the otput of bitextor will be redirected
                    to file FILE, if not it is redirected to the standard output.</code></pre><h2>进行双语爬虫</h2><pre><code>bitextor [OPTIONS] -d DIRECTORY LANG1 LANG2
# 对文件进行系列操作，得到结果可以分为：

bitextor-webdir2ett webpath &gt; ett.txt 
# 将html5文件转化为 base64 格式的全部存在一个文本中

bitextor-ett2lett ett.txt &gt; lett.txt 
# langid.py 识别每个页面的语言

bitextor-lett2lettr lett.txt &gt; lettr.txt 
# 产生每个文档的结构信息，用string格式保留

bitextor-lett2idx --lang1 en --lang2 fr lettr.txt &gt; idx.txt
# 为单词产生索引 语言|单词|出现在文档的id，依据之前的lettr

bitextor-idx2ridx -d en-fr.dic --lang1 en --lang2 fr idx.txt &gt; ridx.txt 
# 根据idx选出每个文档对应最可能的平行文档,依据字典的对应关系，判断可能性

bitextor-distancefilter -l lettr.txt ridx.txt &gt; dis.txt 
# 再次利用之前产生的 html5 结构信息来加强评估可能性

bitextor-align-documents -l lettr.txt dis.txt &gt; aligndocs.txt
# 根据 distance 生成对齐文档

bitextor-align-segments --lang1 en --lang2 fr aligndocs.txt &gt; alignsegs.txt 
# 文档的句子对齐

bitextor-cleantextalign -q 0.3 -m 5 alignsegs.txt &gt; cleanedsegs.txt 
# 文档中错误超过m个就放弃文档 -q 得分低于 [-1,1] 间的某个数 q 就放弃 alignsegs

bitextor-buildTMX --lang1 en --lang2 fr cleanedsegs.txt &gt; res.tmx
# 得到最终结果</code></pre><h2>一键方案</h2><ul><li>只爬网页不处理</li></ul><pre><code>httrack –depth 3 &quot;https://www.apple.com/&quot; -O ./apple -sN 0 -p1</code></pre><ul><li>爬网页加处理</li></ul><pre><code>bitextor -u &quot;https://www.apple.com/&quot; -b 1 -v en-zh.dic -x en zh</code></pre><h2>个人体会</h2><p>这个工具的实用性较低，首先对于动态页面的兼容性较差（现在基本都是动态网页），其次直接带着 <code>bitextor</code> 的 header 爬，随便什么防火墙都拦截掉了，还有就是并行效率太低，8 核的机器永远只用 1 核，单线程爬虫速度太慢，不使用 <code>screen</code>之类的挂在后台怕是要一直守着机器，总之绝大多时间花在找能爬的网站了(x)。</p>]]></content>
        
        <summary type="html">
            
            配置 Bitextor 环境以下操作均在 Ubuntu 16.04 下完成，运行环境 Azure B2MS 型机器首先配置相关的环境（GCC &amp;amp; Python）apt-get update &amp;amp;&amp;amp; apt-get upgrade -y apt-get in
            
        </summary>
        
    </entry>
    
    <entry>
        <title>2017 HTTPS 调查</title>
        <link href="https://blog.poi.cat/https-in-2017"/>
        <id>https://blog.poi.cat/https-in-2017</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-12-07T07:42:27+00:00</published>
        <updated>2017-12-07T07:42:27+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>这篇文章改写自 poi 的计算机网络课论文。</p></blockquote><h2>前言</h2><p>自 1991 年，第一个带有文档的 HTTP ── <a href="https://www.w3.org/Protocols/HTTP/AsImplemented.html">HTTP V0.9</a> 问世以来，HTTP 协议得到了广泛的运用。</p><blockquote><p>据 <a href="https://www.cisco.com/c/en/us/solutions/collateral/service-provider/visual-networking-index-vni/vni-hyperconnectivity-wp.html#_Toc484556816">Cisco 统计</a>，在 2016 年，全球的的网络流量达到了惊人的 <strong>1.2 ZB</strong> 流量，其中视频的流量就达到了 73%。而目前的视频传输协议中最常用的分别是 Apple 的 <a href="https://en.wikipedia.org/wiki/HTTP_Live_Streaming">HLS（HTTP Live Stream）</a> 和 Google 的 <a href="https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP">DASH（Dynamic Adaptive Streaming over HTTP）</a>，而两者都是基于 HTTP 的协议。</p></blockquote><p>随着互联网的发展，网络通信中的安全性也得到了重视。在 1995 年，<a href="https://web.archive.org/web/19970614020952/http://home.netscape.com/newsref/std/SSL.html">TLS 协议的前身 SSL 协议应运而生</a>。而我们今天要讨论的就是在 SSL 诞生的 22 年之后，互联网上的 HTTPS 运用到达了什么程度。</p><h2>总览</h2><p>我收集了目前 Alexa 排名前 1,000 的网站，虽然数量不多但是都是无疑占据了互联网上大多数的流量，通过来一窥互联网当前 HTTPS 的普及程度。部分的数据来自于 <a href="https://www.ssllabs.com">ssllibs</a>。</p><blockquote><p>实际上，我有 Alexa 前 1,000,000 的网站的名单。但是 ssllib 的 API 调用起来极其费时，对一个网站 ssl 配置的查询需要 2~3 分钟的时间，所以只能退而求其次。只考察前 1,000 个网站。</p></blockquote><p>首先，在这 1,000 个网站中，目前有效的网站只有 981 个，其他的网站都无法成功解析其域名，可能是网站己经下线或者迁移到别的域名了，所以其是否支持 HTTPS 就不得而知了。</p><p>然后，在这 981 个网站中，支持 HTTPS 的恰好有 800 个，占比约有 81.5%。而在前 100 的网站中，只有 10 个网站不支持 HTTPS。</p><p>虽然这 800 个网站都支持 HTTPS 协议，但是他们在协议的实现上的不同也会产生安全性的差异。例如 RC4 加密曾经是 TLS 所采用的加密算法之一，但是在 2015 年遭到了<a href="https://blog.qualys.com/ssllabs/2013/03/19/rc4-in-tls-is-broken-now-what">破解</a>，因此已经禁止在 TLS 中使用了。可目前仍然有网站使用 RC4 加密，甚至作为唯一的加密手段，那其 HTTPS 就形同虚设了。</p><h2>TLS 版本</h2><p>我统计了这 800 个网站所支持的最高的 TLS 协议的版本：</p><p><img src="https://c1.staticflickr.com/5/4572/38856004632_ca534df3e3_b.jpg" /></p><p>绝大多数的网站（98 %）的网站支持了 TLS 1.2 标准。比较遗憾的是，没有看到网站使用了最新的 TLS 1.3 标准，不过考虑到 TLS 1.3 还处在草案阶段，不使用也是合情合理的。此外，我也发现了还有 37 个网站仍在使用已经被认为是<a href="https://www.openssl.org/~bodo/ssl-poodle.pdf">不安全</a>的 SSL 3.0。</p><h2>TLS 握手</h2><p>TLS 中最常见的握手方式两种：一种是基于 RSA 算法的；另外一种是基于 DH（Diffie-Hellman） 算法。RSA 算法历史悠久，兼容性好；DH 算法在加密速度上更有优势，而且拥有前向安全性。 TLS 握手的一个目的就是保证安全性。DH 握手可以使用除了 RSA 以外的证书来提高性能，例如 ECC。ECC 证书内置了 ECDSA 公钥，使用了 ECC（Elliptic curve cryptography）算法，它的密钥更短 ── 256 bit 的 ECC 算法强度和 3072 bit 的 RSA 算法安全性相当 ── 而加密速度更快。在 800 个支持 HTTPS 的网站中，大多数的网站还是选择了传统的 RSA 证书，只有少量的网站（35 个）选择了 ECC 证书：</p><p><img src="https://c1.staticflickr.com/5/4541/38856004042_0214bd8a9f_b.jpg" /></p><p>TLS 握手的另外一个目的就是可以验证网站的身份，即需要数字签名。目前主要的签名方式有两者，分别是 RSA 和 ECDSA（Elliptic Curve Digital Signature Algorithms）。在这 800 个网站中，有 21 个网站使用了 ECDSA 签名：</p><p><img src="https://c1.staticflickr.com/5/4574/38856004432_91b2e63f77_b.jpg" /></p><h2>从 HTTPS 到 HSTS￼</h2><p>当一个网站部署了 HTTPS 后，当用户再发起 HTTP 请求时，应该主动将用户引导到更安全的 HTTPS。目前有两种方法引导：一是当用户发起 HTTP 请求时，直接将其重定向到 HTTPS；二是设置 HSTS 响应头。</p><p>在这 800 个网站中，当我们直接发起 HTTP 请求时，HTTP 的状态码分布为：</p><p><img src="https://c1.staticflickr.com/5/4550/38856004212_6bd501fd5d_b.jpg" /></p><p>我们知道在 HTTP 的状态码中，20X 的状态码表示资源已经找到；30X 表示重定向；40X 的状态码表示资源不存在；50X 表示服务器发生了错误；因此，我们的粗略的统计为 573 个网站会将用户重定向到安全的 HTTPS 页面。其余的不会。</p><p>和直接重定向到 HTTPS 相比，HSTS 的方法要好得多：网站在 HTTP 应答头中加入 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">HSTS（Strict-Transport-Security）</a>的信息。它指定了一个有效时间，在有效时间内，当浏览器下次访问该域名时将直接使用 HTTPS 协议访问。</p><p><img src="https://c1.staticflickr.com/5/4584/38856006462_870de0f664_b.jpg" /></p><p>上述两种办法都有一个缺陷：都需要先经过一次 HTTP 请求后，才能过渡到 HTTPS 请求。如果第一次的 HTTP 请求就遭到了劫持，那就无能为力了。所以，相比简单的设置 HSTS 应答头，加入 HSTS Preloading List 的意义更大。</p><p>HSTS Preloading List 的原理就是在浏览器中内置一张支持 HSTS 网站的列表，当用户访问当中的网站时，如果在有效期内的话，浏览器会直接使用 HTTPS 链接，不会再发起 HTTP 请求。</p><p>目前的 HSTS Preloading List 主要由 <a href="https://www.chromium.org/hsts">Chrome</a> 维护，<a href="https://blog.mozilla.org/security/2012/11/01/preloading-hsts/">Firefox</a> 和 <a href="https://blogs.msdn.microsoft.com/ie/2015/02/16/http-strict-transport-security-comes-to-internet-explorer/">IE/Edge</a> 都在使用。截至 2017 年 11 月 30 号，Chrome 的 <a href="https://cs.chromium.org/chromium/src/net/http/transport_security_state_static.json">HSTS Preloading List</a> 中一共有 41312 个域名。而在这 800 个支持 HTTPS 的域名中，有 124 个网站也在其中。</p><p><img src="https://c1.staticflickr.com/5/4526/38856002962_44c14293b4_o.png" /></p><p>Chrome 的 HSTS Preloading List 支持<a href="https://hstspreload.org/">申请</a>，所以可以见这个列表来的域名将会越来越多，最后覆盖到我们常用的域名。</p><h2>维护证书安全</h2><p>HTTPS 链接中，另一个容易受到攻击的地方就是证书。证书是由 CA（证书颁发机构）颁布的，而受信任的 CA 多达上百个。我们先来看看这 800 个网站的证书是由哪些 CA 颁发的：</p><p><img src="https://c1.staticflickr.com/5/4575/38856002802_16d910a73f_b.jpg" /></p><p>现有的证书信任链还有一个问题就是任意一个受信任的 CA 都可以给任意一个域名颁发证书。所以如果出现了中间证书甚至是根证书被盗签时，对于浏览器来说是无法分辨的。</p><p>一种解决办法就是在应答头中加入 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Public_Key_Pinning">HPKP （HTTP Public Key Pinning）</a>信息：即将自己的证书指纹放在 HTTP 的应答头里，让浏览器记录这些信息。当浏览器下次访问时都会验证该指纹，如果指纹不对的话，即使证书合法，浏览器也会直接断开链接。</p><p><img src="https://c1.staticflickr.com/5/4564/24021301637_3fa4ec01ee_b.jpg" /></p><p>显然，HPKP 和 HSTS 一样也有 HTTP 被劫持的危险。所以也有相应的 <a href="https://dxr.mozilla.org/mozilla-central/source/security/manager/tools/PreloadedHPKPins.json">HPKP Preloading List</a>。但是和 HSTS Preloading List 不同，个人用户<a href="https://tools.ietf.org/html/rfc7469#section-2.7">无法申请</a>将自己的网站加入其中。所以目前的 HPKP Preloading List 的规模还比较小，而在这 800 个网站中也只有 2 个网站设置了 HPKP 的应答头。</p><p>此外， Chrome 提出了另外一种解决办法，那就是 <a href="https://www.certificate-transparency.org">Certificate Transparency</a>：即将整个证书签名的过程透明化，任何证书持有者和 CA 都可以将自己证书的记录提交到相应的 Certificate Logs 服务器中，而这整个记录都是受到审计和监控的；浏览器在访问网站时就会对证书进行校验，进而做出不同的反应。</p><p>下面就是一个支持 Certificate Transparency 的页面的例子：</p><p><img src="https://c1.staticflickr.com/5/4534/38856006142_ecdbb8cec0_b.jpg" /></p><p>但是，Certificate Transparency 目前只有 Chrome 支持。而 Chrome 知道其利用率还太低，所以即使在 Certificate Logs 服务器中查不到相应的证书也不会有太大影响。</p><h2>结论</h2><p>从上面的分析我们可以得出：尽管大多数的网站都已经支持 HTTPS 协议了，但是实现还是参差不齐。而面对一些新型的攻击，例如首次 HTTP 协议遭到劫持，证书被盗签等问题准备得还是不够充分。</p><h2>P.S.</h2><p>很可惜，没有收集到所有 1,000,000 个域名的 HTTPS 信息，不过还是可以统计一下其他的信息。例如，域名的长度：</p><p><img src="https://c1.staticflickr.com/5/4564/38856003902_ca4fe89508_b.jpg" /></p><p>和顶级域名的分布：</p><p><img src="https://c1.staticflickr.com/5/4542/38856003072_4b411401b8_b.jpg" /></p>]]></content>
        
        <summary type="html">
            
            这篇文章改写自 poi 的计算机网络课论文。前言自 1991 年，第一个带有文档的 HTTP ── HTTP V0.9 问世以来，HTTP 协议得到了广泛的运用。据 Cisco 统计，在 2016 年，全球的的网络流量达到了惊人的 1.2 ZB 流量，其中视频的流量就达到了 7
            
        </summary>
        
        <category term="https"/>
        
    </entry>
    
    <entry>
        <title>[LWL的自由天空 年度简报] – 云起</title>
        <link href="https://blog.lwl12.com/read/2017-annual-briefing.html"/>
        <id>https://blog.lwl12.com/read/2017-annual-briefing.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-12-03T08:47:57+00:00</published>
        <updated>2017-12-03T08:47:57+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/2017-annual-briefing.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/12/snipaste20171228_234501.jpg" /></a></p><p>2017 年，转瞬而过。<br />
知世故而不世故，处江湖而远江湖。人情冷暖已看透，赤子之心永不丢。</p>
<p>这是自由天空的 2017 年年度简报，你好。<br />
<span></span></p>
<h1>序言</h1>
<p>　坐在回家的车上，总算是开始敲起了今年的简报。<br />
　今年 lwl 做的事似乎也不多，挺平淡的一年，以至于这篇简报也险些因为没东西可写跳票了。不过作为对一整年的回溯和记录，当然还是不能随意弃坑啦。<del>（有种在写 LWL Networks 企业年报的感觉，大雾）</del></p>
<h1>一些数据</h1>
<p>　按照惯例，先来看看自由天空今年（报告期 2017 年 1 月 1 日 至 12 月 28 日）的统计数据吧。</p>
<ul>
<li>总访问量 99,792 次，同比增长 74.20%</li>
<li>独立访客 24,498 位，同比增长 68.73%</li>
<li>有效新文章数 2 篇 （咸鱼如我</li>
<li>博客总评论 3,290 条</li>
</ul>
<p>　感谢所有读者能在 17 年与我相伴，也期待在未来我们能一起前行！</p>
<h1>一群人</h1>
<p>　也许是由于日益增大的压力，今年我并未过多的扩展社交圈子。不过，仍有好多好多小伙伴在今年与我相识。kn007、milkice、ZeroClover、neoFelhz、GuoGuo、LetITFly、芸枫、NeverBehave、MDHD、小黄蜂、Eana Hufwe、Anankke、滕灰灰、Kugelblitz、PeaShooter、鹌鹑蛋君、mokeyjay、静静、jq(x10)、Elepo(x5)ver、Indexyz、duang suse、DCC、kotomei、Mirro Chou、CubeSky … 谢谢你们能与我共度一次次风云，一段段时光。</p>
<p>　同时，我要感谢在本年度中相随的几群人。他们是 <a href="https://github.com/LWL-Networks">LWL Networks</a>（电报群组 – LWL 的众议院）、<a href="https://mc.lwl.moe/">Ph Craft</a> 以及两个不便透露的社群。</p>
<p>　说到社交圈，也许在后年，这里的内容会有一次巨大的变更。我很期待，不过现在就不去想啦！</p>
<h1>几件事</h1>
<h2>电报</h2>
<p>　今年我主要活跃在 Telegram 中文圈里。这个圈子今年出的两件大事，或多或少的和我有一些关联。通信录（电报群组）和<a href="http://telegra.ph/%E5%85%B3%E4%BA%8E-LWL-%E7%9A%84%E9%80%9A%E7%9F%A5%E6%A0%8F-12-28">通知栏</a>（电报频道）相继因为这两件事解散，并由众议院和<a href="https://t.me/lwlbase">基地台</a>接替。目前，众议院和基地台都应用了邀请和定时开放制度。其目的是为了保密、提供更好的交流环境（群）以及主动降低影响力（频道）。</p>
<p>　也许你会好奇，为什么要降低影响力呢？通知栏最多的时候有 1.2K 关注者，也算是小有影响力吧。但是过高的影响力，会给我和周围的人带来风险，而且更重要的是，它是一把双刃剑。通知栏的关注者提升最快的几次，可以说都是对热点事件跟风产生的。通知栏创立的本意，并非是去做一些煽风点火的事。但是最终，在某次事件里，这种影响力终于是闯祸了。对于基地台，也许只有在我觉得我有能力控制其内容，并且这些内容无法再对我造成网络或是现实中影响的时候，才会重新开放了。</p>
<p>　关于群组，通讯录的做法也是绝对的开放，甚至希望越多人加入越好。在我当时的想法里，这样就能有很多很多的人来互相交流讨论，谈天说地<del>（也就能有一个像网红 DIYgod 那样活跃的女装群啦）</del>。但是事与愿违，开放的群并没有多少人真正在讨论，反倒有一些恶意成员暗中蛰伏。在众议院，我限制了群成员的加入，但是讨论数量和质量却不降反升。</p>
<p>　说了这么多，也就是我个人的一些想法吧，并不是说要写成什么社群管理金科玉律啊（笑）。也许是我的管理能力还不够格，无法承担太大的组织。不过，现在这样就很好了。</p>
<h2>Minecraft</h2>
<p>　在几个月前，我和 zariba 重启了我们的 Minecraft 社区。（当时暂时关服的时候在博客也有过文章，不过因为质量太差目前被我撤下了）<br />
　新的周目有了相对完善的设定和管理，但我们仍需更多富有创造力的玩家加入。在上文里，有我们的社区链接，欢迎您的加入。</p>
<p>　除了我们的自有社区，在今年，我个人非常喜欢（甚至可以说是敬仰）的社区 <a href="https://nyaa.cat/">NyaaCat</a>，遭遇了一次停服危机。当时我本来还想写篇文章纪念一下，好在最终<del>在9个女装大佬成为明星后</del>，喵窝还是恢复了正常运行。<br />
　喵窝的各种项目在 Ph Craft 里也有大量的应用。在此感谢喵窝的开发者们。</p>
<h2>天上的东西</h2>
<p>　在本月，LWL 开始对民航和无线电感兴趣了。兴许明年你就能看到我在这一领域发生的好玩的事情啦！</p>
<h2>关于你，我，每一个人</h2>
<p>　在这一点里，我并不想说太多。正在阅读这篇文章的你，可能知道，今年发生过不少涉及个人安全的重大事件。在这个时代，个人信息和隐私保护也许是最重要却又最难实现的。无论是何种原因，泄漏他人隐私，恶意人身攻击，都是决不可接受的行为。</p>
<p>　另外，博客在前几周上线了一个功能。这个功能说起来其实挺好笑，因为基本不可能被触发 ——如果你在本博客的搜索框内输入“自杀”等字眼，就能看到一段小提示。<br />
　在本年度，我曾遇到过几个危险的案例。既然有缘能在这里遇见，我希望，如果屏幕前的你在某一刻面临类似的情况，这个小功能可以帮到你吧。</p>
<blockquote><p>
  仍是要时时刻刻对美好满怀期待，对未来充满渴望。——<a href="https://zhuanlan.zhihu.com/p/31956362">《优秀的女孩是没有性生活的》</a>
</p></blockquote>
<h1>尾声</h1>
<p>　在去年的简报中，我提到过，近几年我也许会很忙。因此在 18 年，博客的更新可能还是会偏少。</p>
<p>　明天要考试的 LWL，此时在屏幕前写出了这篇，可以说是很奇怪的年度简报。<br />
　这篇简报所阐述的内容更像是对事件的总结和记录了，也包含了大量的个人想法与价值观念。我并不常在博客谈论这些内容，更多的是想输出更多技术性的文章。似乎也就只有每年一次的年度简报和 lwl <del>不定期抽风</del>时候写出来的文章会有这样的内容啦。</p>
<p>　无论如何，感谢你能读到最后。新的一年，让我们继续加油吧！</p>
<p>　凛风起，白云涌。LWL 的自由天空，三周岁，生日快乐。</p>
<div></div>
<p><br />
- EOF -</p>]]></content>
        
        <summary type="html">
            
            2017 年，转瞬而过。 知世故而不世故，处江湖而远江湖。人情冷暖已看透，赤子之心永不丢。 这是自由天空的 2017 年年度简报，你好。  序言  坐在回家的车上，总算是开始敲起了今年的简报。  今年 lwl 做的事似乎也不多，挺平淡的一年，以至于这篇简报也险些因为没东西可写跳
            
        </summary>
        
        <category term="网站"/>
        
        <category term="LWL 的自由天空"/>
        
        <category term="常务"/>
        
        <category term="年度简报"/>
        
    </entry>
    
    <entry>
        <title>转移到 Let&#39;s Encrypt</title>
        <link href="https://www.isthnew.com/archives/lets-encrypt.html"/>
        <id>https://www.isthnew.com/archives/lets-encrypt.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-12-02T15:00:00+00:00</published>
        <updated>2017-12-02T15:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>去年是用非正常手段签的免费 AlphaSSL 野卡，12月27号就过期。正好今天没事就用 Let’s Encrypt 替换原来的证书。我的博客问题在于部分资源是缓存到又拍云上面的，所以自己的服务器上要签一次证书，又拍云上要签一次。好在又拍云自己可以签发续签 Let’s</p>]]></content>
        
        <summary type="html">
            
            去年是用非正常手段签的免费 AlphaSSL 野卡，12月27号就过期。正好今天没事就用 Let’s Encrypt 替换原来的证书。我的博客问题在于部分资源是缓存到又拍云上面的，所以自己的服务器上要签一次证书，又拍云上要签一次。好在又拍云自己可以签发续签 Let’s
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="证书"/>
        
        <category term="https"/>
        
        <category term="Let’s Encrypt"/>
        
    </entry>
    
    <entry>
        <title>你好，早晨</title>
        <link href="https://www.isthnew.com/archives/hello-morning.html"/>
        <id>https://www.isthnew.com/archives/hello-morning.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-12-02T10:35:44+00:00</published>
        <updated>2017-12-02T10:35:44+00:00</updated>
        
        <content type="html"><![CDATA[<p>我最近有点懒了，可能是早上太冷的缘故，不太想起床。周四好容易起来一回，发现太阳很给面子啊，索性拿相机出去拍几张。</p>
<p></a>]]></content>
        
        <summary type="html">
            
            我最近有点懒了，可能是早上太冷的缘故，不太想起床。周四好容易起来一回，发现太阳很给面子啊，索性拿相机出去拍几张。 
            
        </summary>
        
        <category term="世界在这里"/>
        
        <category term="摄影"/>
        
        <category term="阳光"/>
        
        <category term="冬日"/>
        
    </entry>
    
    <entry>
        <title>中国大陆使用reCAPTCHA</title>
        <link href="https://131.re/marchives/110"/>
        <id>https://131.re/marchives/110</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-12-02T04:00:00+00:00</published>
        <updated>2017-12-02T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>很久以前就想用reCAPTCHA了，怎奈国内不存在这个服务（雾），只好用了Luosimao的人机验证<br />
前几天在洛谷上发现它可以正常使用reCAPTCHA，于是这周末就查了一下然后给自己的小站换上了reCAPTCHA</p>

<blockquote>
<p>方法：</p>
</blockquote>
<p>将前端中JS的<strong>src</strong>从</p>
<pre><code>https://www.google.com/recaptcha/api.js
</code></pre>
<p>修改为</p>
<pre><code>https://www.recaptcha.net/recaptcha/api.js
</code></pre>
<p>将后端的<strong>API</strong>地址从</p>
<pre><code>https://www.google.com/recaptcha/api/siteverify
</code></pre>
<p>换为</p>
<pre><code>https://www.recaptcha.net/recaptcha/api/siteverify
</code></pre>
<p>实例：<a href="https://131.re/admin/login.php">https://131.re/admin/login.php</a></p>]]></content>
        
        <summary type="html">
            
            很久以前就想用reCAPTCHA了，怎奈国内不存在这个服务（雾），只好用了Luosimao的人机验证 前几天在洛谷上发现它可以正常使用reCAPTCHA，于是这周末就查了一下然后给自己的小站换上了reCAPTCHA   方法：  将前端中JS的src从 https://www.
            
        </summary>
        
    </entry>
    
    <entry>
        <title>失踪人口回归系列之增强站点SSL安全性</title>
        <link href="https://blog.halyul.cc/2017/03/22/imporve-ssl/"/>
        <id>https://blog.halyul.cc/2017/03/22/imporve-ssl/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-12-02T03:16:42+00:00</published>
        <updated>2017-12-02T03:16:42+00:00</updated>
        
        <content type="html"><![CDATA[<p>失踪人口回归系列之第二篇<br /><a></a></p><p>经过这篇文章后，我的SSL Lab的测试也是A+了。</p><ul><li>原文地址：<a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html" target="_blank">https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html</a></li><li>原文作者：<a href="https://raymii.org/" target="_blank">Remy van Elst</a></li><li>译者与校对：<a href="https://github.com/wxy" target="_blank">wxy</a></li><li>本文由<a href="https://github.com/LCTT/TranslateProject" target="_blank">LCTT</a>原创翻译，<a href="http://linux.cn/" target="_blank">Linux中国</a> 荣誉推出</li><li>此为原文重排版</li></ul><p>本文向你介绍如何在 nginx 服务器上设置健壮的 SSL 安全机制。我们通过禁用 SSL 压缩来降低 CRIME 攻击威胁；禁用协议上存在安全缺陷的 SSLv3 及更低版本，并设置更健壮的加密套件（cipher suite）来尽可能启用前向安全性（Forward Secrecy）；此外，我们还启用了 HSTS 和 HPKP。这样我们就拥有了一个健壮而可经受考验的 SSL 配置，并可以在 Qually Labs 的 SSL 测试中得到 A 级评分。</p><p>本教程可以通过<a href="http://blog.ivanristic.com/2014/01/ssl-labs-stricter-security-requirements-for-2014.html" target="_blank">发布于 2014/1/21 的 SSL 实验室测试的严格要求</a>（我之前就通过了测试，如果你按照本文操作就可以得到一个 A+ 评分）。</p><ul><li>本教程也可用于 Apache</li><li>本教程也可用于 Lighttpd</li><li><p>本教程也可用于 FreeBSD, NetBSD 和 OpenBSD 上的 nginx ，放在<a href="http://www.bsdnow.tv/tutorials/nginx" target="_blank">BSD Now 播客上</a><br />你可以从下列链接中找到这方面的进一步内容：</p></li><li><p><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#BEAST_attack" target="_blank">野兽攻击（BEAST）</a></p></li><li><a href="https://en.wikipedia.org/wiki/CRIME_%28security_exploit%29" target="_blank">罪恶攻击（CRIME）</a></li><li><a href="http://blog.cryptographyengineering.com/2015/03/attack-of-week-freak-or-factoring-nsa.html" target="_blank">怪物攻击（FREAK ）</a></li><li><a href="http://heartbleed.com/" target="_blank">心血漏洞（Heartbleed）</a></li><li><a href="https://en.wikipedia.org/wiki/Perfect_forward_secrecy" target="_blank">完备的前向安全性（Perfect Forward Secrecy）</a></li><li><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Dealing_with_RC4_and_BEAST" target="_blank">RC4 和 BEAST 的处理</a></li></ul><p><strong>在编辑之前切记备份一下配置文件！</strong></p><h3><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#我是懒人"></a>我是懒人</h3><p>那你直接看我从<a href="https://cipherli.st/" target="_blank">Cipherli.st</a>上得到的内容复制粘贴到你的站点配置就好了。</p><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#Apache"></a>Apache</h4><pre><code>SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDHSSLProtocol All -SSLv2 -SSLv3SSLHonorCipherOrder On# HSTSHeader always set Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;Header always set X-Frame-Options DENYHeader always set X-Content-Type-Options nosniff# Apache版本 &gt;= 2.4SSLCompression offSSLUseStapling onSSLStaplingCache &quot;shmcb:logs/stapling-cache(150000)&quot;# Apache版本 &gt;= 2.4.11SSLSessionTickets Off</code></pre><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#nginx"></a>nginx</h4><pre><code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;ssl_prefer_server_ciphers on;ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;ssl_ecdh_curve secp384r1; # nginx版本 &gt;= 1.1.0ssl_session_cache shared:SSL:10m;ssl_session_tickets off; # nginx版本 &gt;= 1.5.9ssl_stapling on; # Requires nginx &gt;= 1.3.7ssl_stapling_verify on; # nginx版本 =&gt; 1.3.7resolver $DNS-IP-1 $DNS-IP-2 valid=300s; # 此处将$DNS-IP-1和$DNS-IP-2更换为DNS服务商的IPresolver_timeout 5s;add_header Strict-Transport-Security &quot;max-age=63072000; #HSTS includeSubDomains; preload&quot;;add_header X-Frame-Options DENY;add_header X-Content-Type-Options nosniff;</code></pre><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#Lighttpd"></a>Lighttpd</h4><pre><code>ssl.honor-cipher-order = &quot;enable&quot;ssl.cipher-list = &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;ssl.use-compression = &quot;disable&quot;setenv.add-response-header = (    &quot;Strict-Transport-Security&quot; =&gt; &quot;max-age=63072000; includeSubDomains; preload&quot;,    &quot;X-Frame-Options&quot; =&gt; &quot;DENY&quot;,    &quot;X-Content-Type-Options&quot; =&gt; &quot;nosniff&quot;)ssl.use-sslv2 = &quot;disable&quot;ssl.use-sslv3 = &quot;disable&quot;</code></pre><h3><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#我不是懒人"></a>我不是懒人</h3><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#方便快捷修改站点配置文件"></a>方便快捷修改站点配置文件</h4><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#SSLv2-和-SSLv3"></a>SSLv2 和 SSLv3</h5><p>SSLv2 是不安全的，所以我们需要禁用它。我们也禁用 SSLv3，因为 TLS 1.0 在遭受到降级攻击时，会允许攻击者强制连接使用 SSLv3，从而禁用了前向安全性（forward secrecy）。</p><p>编辑站点配置文件：</p><pre><code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</code></pre><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#加密套件（cipher-suite）"></a>加密套件（cipher suite）</h5><p>前向安全性（Forward Secrecy）用于在长期密钥被破解时确保会话密钥的完整性。PFS（完备的前向安全性）是指强制在每个/每次会话中推导新的密钥。</p><p>这就是说，泄露的私钥并不能用来解密（之前）记录下来的 SSL 通讯。</p><p>提供PFS（完备的前向安全性）功能的是那些使用了一种 Diffie-Hellman 密钥交换的短暂形式的加密套件。它们的缺点是系统开销较大，不过可以使用椭圆曲线的变体来改进。</p><p>以下两个加密套件是我推荐的，之后<a href="https://wiki.mozilla.org/Security/Server_Side_TLS" target="_blank">Mozilla 基金会</a>也推荐了。</p><p>推荐的加密套件：</p><pre><code>ssl_ciphers 'AES128+EECDH:AES128+EDH';</code></pre><p>向后兼容的推荐的加密套件（IE6/WinXP）：</p><pre><code>ssl_ciphers &quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&quot;;</code></pre><p>如果你的 OpenSSL 版本比较旧，不可用的加密算法会自动丢弃。应该一直使用上述的完整套件，让 OpenSSL 选择一个它所支持的。</p><p>加密套件的顺序是非常重要的，因为其决定了优先选择哪个算法。上述优先推荐的算法中提供了PFS（完备的前向安全性）。</p><p>较旧版本的 OpenSSL 也许不能支持这个算法的完整列表，AES-GCM 和一些 ECDHE 算法是相当新的，在 Ubuntu 和 RHEL 中所带的绝大多数 OpenSSL 版本中不支持。</p><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#更多设置"></a>更多设置</h5><p>确保你也添加了如下行：</p><pre><code>ssl_prefer_server_ciphers on;ssl_session_cache shared:SSL:10m;</code></pre><p>在一个 SSLv3 或 TLSv1 握手过程中选择一个加密算法时，一般使用客户端的首选算法。如果设置了上述配置，则会替代地使用服务器端的首选算法。</p><ul><li><a href="http://wiki.nginx.org/HttpSslModule#ssl_prefer_server_ciphers" target="_blank">关于 ssl_prefer_server_ciphers 的更多信息</a></li><li><a href="http://wiki.nginx.org/HttpSslModule#ssl_ciphers" target="_blank">关于 ssl_ciphers 的更多信息</a></li></ul><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#前向安全性和-Diffie-Hellman-Ephemeral-（DHE）参数"></a>前向安全性和 Diffie Hellman Ephemeral （DHE）参数</h5><p>前向安全性（Forward Secrecy）的概念很简单：客户端和服务器协商一个永不重用的密钥，并在会话结束时销毁它。服务器上的 RSA 私钥用于客户端和服务器之间的 Diffie-Hellman 密钥交换签名。从 Diffie-Hellman 握手中获取的预主密钥会用于之后的编码。因为预主密钥是特定于客户端和服务器之间建立的某个连接，并且只用在一个限定的时间内，所以称作短暂模式（Ephemeral）。</p><p>使用了前向安全性，如果一个攻击者取得了一个服务器的私钥，他是不能解码之前的通讯信息的。这个私钥仅用于 Diffie Hellman 握手签名，并不会泄露预主密钥。Diffie Hellman 算法会确保预主密钥绝不会离开客户端和服务器，而且不能被中间人攻击所拦截。</p><p>所有版本的 nginx（如1.4.4）都依赖于 OpenSSL 给 Diffie-Hellman （DH）的输入参数。不幸的是，这意味着 Diffie-Hellman Ephemeral（DHE）将使用 OpenSSL 的默认设置，包括一个用于密钥交换的1024位密钥。因为我们正在使用2048位证书，DHE 客户端就会使用一个要比非 DHE 客户端更弱的密钥交换。</p><p>我们需要生成一个更强壮的 DHE 参数：</p><pre><code>$ <span>cd</span> /etc/ssl/certs$ openssl dhparam -out dhparam.pem 4096<span><span></span><span></span></span></code></pre><p>然后告诉 nginx 将其用作 DHE 密钥交换：</p><pre><code>ssl_dhparam /etc/ssl/certs/dhparam.pem;</code></pre><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#OCSP-装订（Stapling）"></a>OCSP 装订（Stapling）</h5><p>当连接到一个服务器时，客户端应该使用证书吊销列表（CRL）或在线证书状态协议（OCSP）记录来校验服务器证书的有效性。CRL 的问题是它已经增长的太大了，永远也下载不完了。</p><p>OCSP 更轻量级一些，因为我们每次只请求一条记录。但是副作用是当连接到一个服务器时必须对第三方 OCSP 响应器发起 OCSP 请求，这就增加了延迟和带来了潜在隐患。事实上，CA 所运营的 OCSP 响应器非常不可靠，浏览器如果不能及时收到答复，就会静默失败。攻击者通过 DoS 攻击一个 OCSP 响应器可以禁用其校验功能，这样就降低了安全性。</p><p>解决方法是允许服务器在 TLS 握手中发送缓存的 OCSP 记录，以绕开 OCSP 响应器。这个机制节省了客户端和 OCSP 响应器之间的通讯，称作 OCSP 装订。</p><p>客户端会在它的 CLIENT HELLO 中告知其支持 status_request TLS 扩展，服务器仅在客户端请求它的时候才发送缓存的 OCSP 响应。</p><p>大多数服务器最多会缓存 OCSP 响应48小时。服务器会按照常规的间隔连接到 CA 的 OCSP 响应器来获取刷新的 OCSP 记录。OCSP 响应器的位置可以从签名的证书中的授权信息访问（Authority Information Access）字段中获得。</p><ul><li><a href="https://raymii.org/s/tutorials/OCSP_Stapling_on_nginx.html" target="_blank">阅读我的教程：在 NGINX 中启用 OCSP 装订</a></li></ul><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#HTTP-严格传输安全（HSTS）"></a>HTTP 严格传输安全（HSTS）</h5><p>如有可能，你应该启用<a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security" target="_blank">HTTP 严格传输安全（HSTS）</a>，它会引导浏览器和你的站点之间的通讯仅通过 HTTPS。</p><ul><li><a href="https://linux.cn/article-5266-1.html" target="_blank">阅读我关于 HSTS 的文章，了解如何配置它</a></li></ul><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#HTTP-公钥固定扩展（HPKP）"></a>HTTP 公钥固定扩展（HPKP）</h5><p>你也应该启用<a href="https://wiki.mozilla.org/SecurityEngineering/Public_Key_Pinning" target="_blank">HTTP 公钥固定扩展（HPKP）</a>。</p><p>公钥固定的意思是一个证书链必须包括一个白名单中的公钥。它确保仅有白名单中的 CA 才能够为某个域名签署证书，而不是你的浏览器中存储的任何 CA。</p><p>我已经写了一篇<a href="https://linux.cn/article-5282-1.html" target="_blank">]关于 HPKP 的背景理论及在 Apache、Lighttpd 和 NGINX 中配置例子的文章</a>。</p><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#调整服务器"></a>调整服务器</h4><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#野兽攻击（BEAST）和-RC4"></a>野兽攻击（BEAST）和 RC4</h5><p>简单的说，野兽攻击（BEAST）就是通过篡改一个加密算法的 CBC（密码块链）的模式，从而可以对部分编码流量悄悄解码。更多信息参照上面的链接。</p><p>针对野兽攻击（BEAST），较新的浏览器已经启用了客户端缓解方案。推荐方案是禁用 TLS 1.0 的所有加密算法，仅允许 RC4 算法。然而，<a href="http://www.isg.rhul.ac.uk/tls/" target="_blank">]针对 RC4 算法的攻击也越来越多</a> ，很多已经从理论上逐步发展为实际可行的攻击方式。此外，有理由相信 NSA 已经实现了他们所谓的“大突破”——攻破 RC4 。</p><p>禁用 RC4 会有几个后果。其一，当用户使用老旧的浏览器时，比如 Windows XP 上的 IE 会用 3DES 来替代 RC4。3DES 要比 RC4 更安全，但是它的计算成本更高，你的服务器就需要为这些用户付出更多的处理成本。其二，RC4 算法能减轻 野兽攻击（BEAST）的危害，如果禁用 RC4 会导致 TLS 1.0 用户会换到更容易受攻击的 AES-CBC 算法上（通常服务器端的对野兽攻击（BEAST）的“修复方法”是让 RC4 优先于其它算法）。我认为 RC4 的风险要高于野兽攻击（BEAST）的风险。事实上，有了客户端缓解方案（Chrome 和 Firefox 提供了缓解方案），野兽攻击（BEAST）就不是什么大问题了。而 RC4 的风险却在增长：随着时间推移，对加密算法的破解会越来越多。</p><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#怪物攻击（FREAK）"></a>怪物攻击（FREAK）</h5><p>怪物攻击（FREAK）是一种中间人攻击，它是由来自<a href="https://www.smacktls.com/" target="_blank">INRIA、微软研究院和 IMDEA</a>的密码学家们所发现的。怪物攻击（FREAK）的缩写来自“Factoring RSA-EXPORT Keys（RSA 出口密钥因子分解）”</p><p>这个漏洞可上溯到上世纪九十年代，当时美国政府禁止出口加密软件，除非其使用编码密钥长度不超过512位的出口加密套件。</p><p>这造成了一些现在的 TLS 客户端存在一个缺陷，这些客户端包括： 苹果的 SecureTransport 、OpenSSL。这个缺陷会导致它们会接受出口降级 RSA 密钥，即便客户端并没有要求使用出口降级 RSA 密钥。这个缺陷带来的影响很讨厌：在客户端存在缺陷，且服务器支持出口降级 RSA 密钥时，会发生中间人攻击，从而导致连接的强度降低。</p><p>攻击分为两个组成部分：首先是服务器必须接受“出口降级 RSA 密钥”。</p><p>中间人攻击可以按如下流程：</p><p>在客户端的 Hello 消息中，要求标准的 RSA 加密套件。<br />中间人攻击者修改该消息为‘export RSA’（输出级 RSA 密钥）。<br />服务器回应一个512位的输出级 RSA 密钥，并以其长期密钥签名。<br />由于 OpenSSL/SecureTransport 的缺陷，客户端会接受这个弱密钥。<br />攻击者根据 RSA 模数分解因子来恢复相应的 RSA 解密密钥。<br />当客户端编码‘pre-master secret’（预主密码）给服务器时，攻击者现在就可以解码它并恢复 TLS 的‘master secret’（主密码）。<br />从这里开始，攻击者就能看到了传输的明文并注入任何东西了。<br />本文所提供的加密套件不启用输出降级加密，请确认你的 OpenSSL 是最新的，也强烈建议你将客户端也升级到新的版本。</p><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#SSL-压缩（罪恶攻击-CRIME）"></a>SSL 压缩（罪恶攻击 CRIME）</h5><p>罪恶攻击（CRIME）使用 SSL 压缩来完成它的魔法，SSL 压缩在下述版本是默认关闭的： nginx 1.1.6及更高/1.0.9及更高（如果使用了 OpenSSL 1.0.0及更高）， nginx 1.3.2及更高/1.2.2及更高（如果使用较旧版本的 OpenSSL）。</p><p>如果你使用一个早期版本的 nginx 或 OpenSSL，而且你的发行版没有向后移植该选项，那么你需要重新编译没有一个 ZLIB 支持的 OpenSSL。这会禁止 OpenSSL 使用 DEFLATE 压缩方式。如果你禁用了这个，你仍然可以使用常规的 HTML DEFLATE 压缩。</p><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#卷毛狗攻击（POODLE）和-TLS-FALLBACK-SCSV"></a>卷毛狗攻击（POODLE）和 TLS-FALLBACK-SCSV</h5><p>SSLv3 会受到<a href="https://raymii.org/s/articles/Check_servers_for_the_Poodle_bug.html" target="_blank">卷毛狗漏洞（POODLE）</a>的攻击。这是禁用 SSLv3 的主要原因之一。</p><p>Google 提出了一个名为<a href="https://tools.ietf.org/html/draft-ietf-tls-downgrade-scsv-00" target="_blank">TLSFALLBACKSCSV</a>的SSL/TLS 扩展，它用于防止强制 SSL 降级。如果你升级 到下述的 OpenSSL 版本会自动启用它。</p><ul><li>OpenSSL 1.0.1 带有 TLS_FALLBACK_SCSV 1.0.1j 及更高。</li><li>OpenSSL 1.0.0 带有 TLS_FALLBACK_SCSV 1.0.0o 及更高。</li><li>OpenSSL 0.9.8 带有 TLS_FALLBACK_SCSV 0.9.8zc 及更高。<br /><a href="http://wiki.nginx.org/HttpSslModule#ssl_protocols" target="_blank">更多信息请参照 NGINX 文档</a></li></ul><h4><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#其他"></a>其他</h4><h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#优先顺序的逻辑"></a>优先顺序的逻辑</h5><ul><li>ECDHE+AESGCM 加密是首选的。它们是 TLS 1.2 加密算法，现在还没有广泛支持。当前还没有对它们的已知攻击。</li><li>PFS 加密套件好一些，首选 ECDHE，然后是 DHE。</li><li>AES 128 要好于 AES 256。有一个关于 AES256 带来的安全提升程度是否值回成本的讨论，结果是显而易见的。目前，AES128 要更值一些，因为它提供了不错的安全水准，确实很快，而且看起来对时序攻击更有抵抗力。</li><li>在向后兼容的加密套件里面，AES 要优于 3DES。在 TLS 1.1及其以上，减轻了针对 AES 的野兽攻击（BEAST）的威胁，而在 TLS 1.0上则难以实现该攻击。在非向后兼容的加密套件里面，不支持 3DES。</li><li>RC4 整个不支持了。3DES 用于向后兼容。参看<a href="https://wiki.mozilla.org/Security/Server_Side_TLS#RC4_weaknesses" target="_blank">#RC4_weaknesses</a>中的讨论。<h5><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#强制丢弃的算法"></a>强制丢弃的算法</h5></li><li>aNULL 包含了非验证的 Diffie-Hellman 密钥交换，这会受到中间人（MITM）攻击</li><li>eNULL 包含了无加密的算法（明文）</li><li>EXPORT 是老旧的弱加密算法，是被美国法律标示为可出口的</li><li>RC4 包含的加密算法使用了已弃用的 ARCFOUR 算法</li><li>DES 包含的加密算法使用了弃用的数据加密标准（DES）</li><li>SSLv2 包含了定义在旧版本 SSL 标准中的所有算法，现已弃用</li><li>MD5 包含了使用已弃用的 MD5 作为哈希算法的所有算法</li></ul><h3><a href="https://blog.halyul.cc/2017/03/22/imporve-ssl/#配置范例"></a>配置范例</h3><pre><code>server {  listen [::]:443 default_server;  ssl on;  ssl_certificate_key /etc/ssl/cert/raymii_org.pem;  ssl_certificate /etc/ssl/cert/ca-bundle.pem;  ssl_ciphers 'AES128+EECDH:AES128+EDH:!aNULL';  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  ssl_session_cache shared:SSL:10m;  ssl_stapling on;  ssl_stapling_verify on;  resolver 8.8.4.4 8.8.8.8 valid=300s;  resolver_timeout 10s;  ssl_prefer_server_ciphers on;  ssl_dhparam /etc/ssl/certs/dhparam.pem;  add_header Strict-Transport-Security max-age=63072000;  add_header X-Frame-Options DENY;  add_header X-Content-Type-Options nosniff;  root /var/www/;  index index.html index.htm;  server_name raymii.org;}</code></pre>]]></content>
        
        <summary type="html">
            
            失踪人口回归系列之第二篇经过这篇文章后，我的SSL Lab的测试也是A+了。原文地址：https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html原文作者：Remy van Elst译者与校对：wxy本文由LC
            
        </summary>
        
        <category term="技术"/>
        
        <category term="教程"/>
        
    </entry>
    
    <entry>
        <title>失踪人口回归系列之在VPS上搭建HEXO的GIT部署环境</title>
        <link href="https://blog.halyul.cc/2017/03/22/vps-hexo/"/>
        <id>https://blog.halyul.cc/2017/03/22/vps-hexo/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-12-02T03:16:42+00:00</published>
        <updated>2017-12-02T03:16:42+00:00</updated>
        
        <content type="html"><![CDATA[<p>失踪人口回归系列的第一篇文章<br /><a></a></p><h2><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#写在开头"></a>写在开头</h2><p>由于HEXO是静态博客，越来越多的人选择在GitHub, Coding等Pages服务提供商处搭建自己的博客，从而省下买网页空间或VPS的钱。</p><p>然而有部分人会选择在VPS上使用HEXO，但是却发现远不如使用Pages服务方便，但看完这篇文章，你就会发现，这并没有想象中那么<del>方便</del>难。</p><h2><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#准备工作"></a>准备工作</h2><ul><li><del>一台电脑</del></li><li><del>一台VPS</del></li><li><del>一个打开本页面的浏览器</del></li></ul><h3><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#本地环境"></a>本地环境</h3><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#现在本地上安装Node-js和git"></a>现在本地上安装Node.js和git</h4><p>请访问<a href="https://nodejs.org/en/download/package-manager/" target="_blank">Installing Node.js via package manager</a>，安装你系统的对应版本。</p><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#安装Hexo"></a>安装Hexo</h4><pre><code>$ <span>npm</span> i -g hexo-cli<span><span></span></span></code></pre><blockquote><p>如果你有<code>cnpm</code>, 只需要将<code>npm</code>替换成<code>cnpm</code></p></blockquote><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#创建Hexo"></a>创建Hexo</h4><pre><code>$ <span>mkdir</span> /path/to/hexo$ <span>cd</span> /path/to/hexo$ hexo init$ hexo s<span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中<code>/path/to/hexo</code>为你想要存放Hexo数据的地方</p></blockquote><p>如果<code>hexo init</code>过程中安装终端，请执行</p><pre><code>$ <span>cd</span> /path/to/hexo$ <span>npm</span> i<span><span></span><span></span></span></code></pre><p>打开<a target="_blank">localhost:4000</a>, 如若看见Hexo初始页面则Hexo安装成功。</p><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#生成SSH公钥密钥"></a>生成SSH公钥密钥</h4><blockquote><p>由于我曾经进过此步发现并没有什么用，故而以下内容皆为引用自<a href="https://blog.viosey.com/2016/10/05/hexo-vps-git/#生成-SSH-公钥密钥" target="_blank">Viosey</a>。<br />经实测此步可忽略，区别在于<code>hexo d</code>过程是否需要输入密码。</p></blockquote><pre><code>$ <span>cd</span> ~/.ssh$ ssh-keygen<span><span></span><span></span></span></code></pre><p>它先要求你确认保存公钥的位置（.ssh/id_rsa），然后它会让你重复一个密码两次，如果不想在使用公钥的时候输入密码，可以留空。</p><p><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank">GitHub Help - Generating a new SSH key and adding it to the ssh-agent</a></p><h3><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#服务器环境"></a>服务器环境</h3><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#安装Git-amp-Node-js"></a>安装Git &amp; Node.js</h4><h5><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#Ubuntu"></a>Ubuntu</h5><pre><code>$ <span>apt-get</span> <span>install</span> <span>git</span>$ curl -sL https://deb.nodesource.com/setup_6.x <span>|</span> <span>sudo</span> -E <span>bash</span> -$ <span>apt-get</span> <span>install</span> -y nodejs<span><span></span><span></span><span></span></span></code></pre><p>此为 Node.js v6</p><p>若想安装其他版本，请更改为<br />Node.js v7</p><pre><code>$ curl -sL https://deb.nodesource.com/setup_7.x <span>|</span> <span>sudo</span> -E <span>bash</span> -<span><span></span></span></code></pre><h5><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#CentOS"></a>CentOS</h5><pre><code>$ curl -sL https://rpm.nodesource.com/setup <span>|</span> <span>bash</span> -$ yum <span>install</span> -y nodejs<span><span></span><span></span></span></code></pre><p>此为 Node.js 0.10</p><p>若想安装其他版本，请更改为<br />Node.js v7</p><pre><code>$ curl --silent --location https://rpm.nodesource.com/setup_7.x <span>|</span> <span>bash</span> -<span><span></span></span></code></pre><p>Node.js v6 LTS</p><pre><code>$ curl --silent --location https://rpm.nodesource.com/setup_6.x <span>|</span> <span>bash</span> -<span><span></span></span></code></pre><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#创建-git-用户-amp-禁用-git-用户的-shell-登录权限"></a>创建 git 用户 &amp; 禁用 git 用户的 shell 登录权限</h4><pre><code>$ adduser <span>git</span>$ vim /etc/passwd<span><span></span><span></span></span></code></pre><p>将</p><pre><code>git:x:1001:1001:,,,:/home/git:/bin/bash<span><span></span></span></code></pre><p>改为</p><pre><code>git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell<span><span></span></span></code></pre><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#添加证书登录"></a>添加证书登录</h4><h5><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#已生成公钥"></a>已生成公钥</h5><p>把<code>.pub</code>公钥里的内容添加到服务器的<code>/home/git/.ssh/authorized_keys</code>文件中</p><h5><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#未生成公钥"></a>未生成公钥</h5><p>请执行在服务器端执行</p><pre><code>$ <span>passwd</span> <span>git</span><span><span></span></span></code></pre><p>更改git的密码。</p><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#建立git仓库"></a>建立git仓库</h4><pre><code>$ <span>mkdir</span> /path/to/repo$ <span>cd</span> /path/to/repo$ <span>git</span> init --bare hexo.git<span><span></span><span></span><span></span></span></code></pre><p>目录可自行选择。<br />eg.</p><pre><code>$ <span>mkdir</span> /home/git/repos$ <span>cd</span> /home/git/repos$ <span>git</span> init --bare hexo.git<span><span></span><span></span><span></span></span></code></pre><p>然后在<code>/home/git/repos</code>下会有一个<code>hexo.git</code>的文件夹</p><blockquote><p>使用 –bare 参数，Git 就会创建一个裸仓库，裸仓库没有工作区，我们不会在裸仓库上进行操作，它只为共享而存在。</p></blockquote><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#配置git-hooks"></a>配置git hooks</h4><p>在<code>hexo.git/hooks</code>目录下，执行</p><pre><code>$ <span>cd</span> /path/to/hexo.git/hooks$ <span>nano</span> post-receive<span><span></span><span></span></span></code></pre><blockquote><p>你可以选择自己熟手的编辑器新建这个<code>post-receive</code></p></blockquote><p>在<code>post-receive</code>中写入如下内容:</p><pre><code><span>#!/bin/sh</span><span>git</span> --work-tree<span>=</span>/path/to/your/site --git-dir<span>=</span>/path/to/hexo.git checkout -f<span><span></span><span></span></span></code></pre><p>其中<code>/path/to/your/site</code>为你的站点文件夹，<code>/path/to/hexo.git</code>为你所建立<code>hexo.git</code>的完整路径</p><p>eg.</p><pre><code><span>#!/bin/sh</span><span>git</span> --work-tree<span>=</span>/var/www/blog.halyul.com --git-dir<span>=</span>/home/git/repos/hexo.git checkout -f<span><span></span><span></span></span></code></pre><p>设置<code>post-receive</code>的可执行权限</p><pre><code>$ <span>chmod</span> +x post-receive<span><span></span></span></code></pre><h4><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#设置目录拥有者"></a>设置目录拥有者</h4><pre><code>$ <span>chown</span> -hR git:git /path/to/hexo.git$ <span>chown</span> -hR git:git /path/to/your/site<span><span></span><span></span></span></code></pre><h2><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#本地Hexo配置"></a>本地Hexo配置</h2><p>先安装<code>hexo-deployer-git</code>以执行hexo的git部署</p><pre><code>$ <span>npm</span> i --save hexo-deployer-git<span><span></span></span></code></pre><p>打开hexo目录下的<code>_config.yml</code>，找到<code>deploy</code>进行修改</p><pre><code><span>deploy</span><span>:</span>    <span>type</span><span>:</span> git    <span>repo</span><span>:</span> git@example.com<span>:</span>hexo.git    <span>branch</span><span>:</span> master<span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中<code>example.com</code>为你的站点地址或IP</p></blockquote><h2><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#开始使用"></a>开始使用</h2><p>当你需要生成以及部署hexo时，运行</p><pre><code>$ hexo clean <span>&amp;&amp;</span> hexo d<span><span></span></span></code></pre><p><strong>大功告成~</strong></p><h2><a href="https://blog.halyul.cc/2017/03/22/vps-hexo/#参考"></a>参考</h2><p><a href="https://blog.viosey.com/2016/10/05/hexo-vps-git/" target="_blank">在 VPS 上搭建 Hexo 博客，使用 Git 部署</a></p>]]></content>
        
        <summary type="html">
            
            失踪人口回归系列的第一篇文章写在开头由于HEXO是静态博客，越来越多的人选择在GitHub, Coding等Pages服务提供商处搭建自己的博客，从而省下买网页空间或VPS的钱。然而有部分人会选择在VPS上使用HEXO，但是却发现远不如使用Pages服务方便，但看完这篇文章，你
            
        </summary>
        
        <category term="技术"/>
        
        <category term="Hexo"/>
        
        <category term="教程"/>
        
    </entry>
    
    <entry>
        <title>『转』真正的自由？——从杨舒平的演讲来谈中国和言论自由</title>
        <link href="https://blog.halyul.cc/2017/06/05/my-view-of-freedom/"/>
        <id>https://blog.halyul.cc/2017/06/05/my-view-of-freedom/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-12-02T03:16:42+00:00</published>
        <updated>2017-12-02T03:16:42+00:00</updated>
        
        <content type="html"><![CDATA[<p>原文地址: <a href="https://blog.nfz.moe/archives/my-view-of-freedom.html" target="_blank">neoFelhz’s Blog</a></p><p>在前天，也就是那个特殊的日子的前一天晚上，我和几个同学彻夜长谈。我们谈了很多东西，我思绪万千，所以我决定写点东西出来。</p><a></a><p><a href="https://blog.halyul.com/2017/06/05/my-view-of-freedom" target="_blank">请点击这里查看</a></p>]]></content>
        
        <summary type="html">
            
            原文地址: neoFelhz’s Blog在前天，也就是那个特殊的日子的前一天晚上，我和几个同学彻夜长谈。我们谈了很多东西，我思绪万千，所以我决定写点东西出来。请点击这里查看
            
        </summary>
        
    </entry>
    
    <entry>
        <title>解决Hexo MODULE NOT FOUND问题</title>
        <link href="https://blog.halyul.cc/2017/03/22/hexo-module-not-found/"/>
        <id>https://blog.halyul.cc/2017/03/22/hexo-module-not-found/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-12-02T03:16:42+00:00</published>
        <updated>2017-12-02T03:16:42+00:00</updated>
        
        <content type="html"><![CDATA[<p>Hexo上最玄学的问题，没有之一<br /><a></a></p><h2><a href="https://blog.halyul.cc/2017/03/22/hexo-module-not-found/#原油缘由"></a><del>原油</del>缘由</h2><p>之前给电脑上了Hackintosh， 然后就要开始准备Hexo来写博客和主题，然而，我却遇到了这个玄学问题。</p><p>在执行一切<code>hexo</code>命令时，均出现</p><pre><code><span>{</span> <span>[</span>Error: Cannot <span>find</span> module <span>'./build/Release/DTraceProviderBindings'</span><span>]</span> code: <span>'MODULE_NOT_FOUND'</span> <span>}</span><span>{</span> <span>[</span>Error: Cannot <span>find</span> module <span>'./build/default/DTraceProviderBindings'</span><span>]</span> code: <span>'MODULE_NOT_FOUND'</span> <span>}</span><span>{</span> <span>[</span>Error: Cannot <span>find</span> module <span>'./build/Debug/DTraceProviderBindings'</span><span>]</span> code: <span>'MODULE_NOT_FOUND'</span> <span>}</span><span><span></span><span></span><span></span></span></code></pre><p>Google了一下，发现hexo的issues里面有<a href="https://github.com/hexojs/hexo/issues/1055" target="_blank">这个</a>.他们都用</p><pre><code>$ <span>npm</span> <span>install</span> hexo --no-optional<span><span></span></span></code></pre><p>解决了，不幸的是，我这里解决不了这个问题。。。。</p><p>各种搜寻后，终于发现了解决方法。</p><h2><a href="https://blog.halyul.cc/2017/03/22/hexo-module-not-found/#解决"></a>解决</h2><p>我发现在<code>node_modules</code>中，<code>dtrace-provider</code>这个模块是存在的，然而hexo是报错，想必某些玄学原因没有读取到这货，我就<del>大胆的</del>机智的运行了</p><pre><code>$ <span>npm</span> uninstall dtrace-provider<span><span></span></span></code></pre><p>然后再运行</p><pre><code><span>npm</span> <span>install</span> dtrace-provider<span><span></span></span></code></pre><p><strong>终于没有这该死的错误了！</strong></p>]]></content>
        
        <summary type="html">
            
            Hexo上最玄学的问题，没有之一原油缘由之前给电脑上了Hackintosh， 然后就要开始准备Hexo来写博客和主题，然而，我却遇到了这个玄学问题。在执行一切hexo命令时，均出现{ [Error: Cannot find module &#39;./build/Release/DTr
            
        </summary>
        
        <category term="杂"/>
        
        <category term="Hexo"/>
        
    </entry>
    
    <entry>
        <title>记Piwik统计中西藏、台湾被视为独立的国家一事</title>
        <link href="https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/"/>
        <id>https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-12-01T22:23:00+00:00</published>
        <updated>2017-12-01T22:23:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>说实话，我还真的不知道怎么给这篇文章写标签和分类。垃圾Piwik！<br /><a></a></p><h2><a href="https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/#更新"></a>更新</h2><p>2017年8月3日，西藏终于在Piwik中“回归”中国，可喜可贺。<br /><a href="https://github.com/piwik/piwik/pull/11930" target="_blank">PR#11930</a><br />但不管怎样，我也不会用它了。</p><h2><a href="https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/#西藏"></a>西藏</h2><p>我的网站之前都是由<code>Piwik</code>来提供访客统计服务，昨晚看了一下自己的访客数据，沾沾自喜地将地区截图发到了朋友圈，然后就有朋友发现：<strong>西藏不属于中国</strong></p><p><img src="https://blog.halyul.cc/img/piwik-tibet-taiwan-not-in-china/3.png" /></p><p><strong>通过我进一步确认，发现在Piwik的地图中，西藏还真的不在中国里！</strong></p><p><img src="https://blog.halyul.cc/img/piwik-tibet-taiwan-not-in-china/1.png" /><img src="https://blog.halyul.cc/img/piwik-tibet-taiwan-not-in-china/2.png" /></p><p>我第一念头就是Piwik的地图提供商有问题，然后通过查询网页代码，<strong>发现地图是他们自己的！</strong></p><p>然后我就想去他们的Github上提issue，发现这个问题在<strong>2014年</strong>便有人提出！</p><p>我顿时懵了。</p><p>我查看了他们的issues, pull requests，发现这个问题在Piwik发布3.0版本时就被commit<a href="https://github.com/piwik/piwik/commit/4e47c8aba3bf146292f6e9d38aa0151c383e6c33" target="_blank">4e47c8a</a>引入了，而这个commit的名称还非常的直白，<strong>free tibet</strong>!</p><p>所以当时就有中国用户提出了<a href="https://github.com/piwik/piwik/issues/6006" target="_blank">issue#6006</a>，然而很可惜的是，Owner说出了以下话语</p><blockquote><p>but in our case, we are not even a single country… we are the Internet. We are the human community! It will be a challenge to find status quo when learning to live together, but challenging our world view is important. We are not a country, we are the Internets the network that unifies us all, brothers of the earth!</p></blockquote><p>这段话能看出，Owner自己是支持网络上的某些观点的，然后fengkaijia在楼下贴出了当时CNN上关于<code>西藏是否应该成为一个独立的国家</code>的投票，上面显示了仅有10%的票数支持独立，剩下90%都是不赞成的，或许Owner就是那10%的一员吧。</p><p>为什么他认为10%的人能够代表剩下的90%？</p><p>这个issue还被贴上了<code>Lower priority（低优先级）</code>标签，一个关乎于国家主权问题的东西居然是低优先级？？？？？？？</p><p>无话可说。</p><p>这个issue下最后两个回复是来自他们的的一个成员，倒数第二个是</p><blockquote><p>If you would like to have any change in Piwik feel free to create a Pull Request.</p></blockquote><p>说想要一些改变的话就去提PR，然而<a href="https://github.com/piwik/piwik/pull/6749" target="_blank">PR#6749</a>是有了，不过 <strong>Owner并不同意</strong>，还说</p><blockquote><p>Please feel free to apply the patch to your local instance if you want to hide Tibet from the map. this is the beauty of free software that you can automatically customise it</p></blockquote><p>开源软件能不尊重一个国家的主权了吗？？？？</p><p>最终这个PR被打上了<code>wontfix（永不修复）</code>的标签并被关闭。</p><p><strong>我不知道在1950年西藏与中国之间到底发生了什么，我只知道现在，西藏属于中国！</strong></p><p>而issue#6006最后的回复是</p><blockquote><p>NO PULL REQUEST CAN CHANGE A BIASED MIND.</p></blockquote><p>没有PR能够改变一个有偏见的思想。</p><h2><a href="https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/#台湾"></a>台湾</h2><p>台湾这个我没有仔细看，因为在地图上的区域太小了，我并没有分辨出来<del>怪我</del>，等我删除了Piwik之后才发现，原来台湾也被分割了出来。不过台湾问题太复杂，这个我也不适宜作太多评论。我坚持 <strong>一个中国原则</strong>。</p><h2><a href="https://blog.halyul.cc/2017/07/16/piwik-tibet-taiwan-not-in-china/#行动"></a>行动</h2><p>现在我已经停用了Piwik统计服务，转用Google Analytic了。我也希望各位站长不要再使用这个垃圾统计服务了。</p>]]></content>
        
        <summary type="html">
            
            说实话，我还真的不知道怎么给这篇文章写标签和分类。垃圾Piwik！更新2017年8月3日，西藏终于在Piwik中“回归”中国，可喜可贺。PR#11930但不管怎样，我也不会用它了。西藏我的网站之前都是由Piwik来提供访客统计服务，昨晚看了一下自己的访客数据，沾沾自喜地将地区截
            
        </summary>
        
        <category term="键盘侠"/>
        
    </entry>
    
    <entry>
        <title>CentOS 7 下 LEMP 的配置</title>
        <link href="https://dcc.cat/cent7.html"/>
        <id>https://dcc.cat/cent7.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2017-12-01T07:22:00+00:00</published>
        <updated>2017-12-01T07:22:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><code>CentOS</code> 是 <code>RHEL (Red Hat Enterprise Linux)</code> 的免费版，由于红帽的大力推广，在国内外很是流行。因为众多企业和开发者使用，首先要求的是保证稳定，所以 CentOS 下的软件从不追求最新版本。</p><p>而很多时候我们不得不用到最新的版本进行一些操作，本文就介绍在 CentOS / RHEL 7.x 下使用 EPEL 以及官网仓库安装较新版本的 LEMP。</p><p>本文所有操作均在 root 用户下进行，请自行切换至 root 用户或者赋予 sudo 权限。</p><h2>初始化配置</h2><h3>关闭 <code>SELinux</code></h3><pre><code>sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config &amp;&amp; setenforce 0</code></pre><h3>增加 epel 和 php 仓库</h3><pre><code>rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
rpm -Uvh https://centos7.iuscommunity.org/ius-release.rpm
rpm -Uvh http://rpms.remirepo.net/enterprise/remi-release-7.rpm</code></pre><h3>卸载无用软件及升级系统</h3><pre><code>yum upgrade -y
yum groupinstall &quot;Development Tools&quot; -y
yum install -y centos-release centos-release-scl centos-release-xen
yum install -y kernel kernel-devel kernel-headers
yum install -y aspell-devel atk autoconf automake bash bash-completion bash-completion-extras bc bind-utils bison bluez-libs-devel boost-program-options bzip2 bzip2-devel ca-certificates clang clang-devel cmake coreutils cronie cronie-anacron crontabs cups-libs curl curl-devel cyrus-imapd cyrus-sasl cyrus-sasl-devel cyrus-sasl-md5 cyrus-sasl-plain deltarpm dh-autoreconf dialog diffutils dos2unix doxygen e2fsprogs e2fsprogs-devel enchant enchant-devel expect expect-devel fftw-libs-double figlet file firewalld flex freetype freetype-devel fribidi gawk gcc gcc-c++ gd gd-devel gdbm-devel gdk-pixbuf2 gettext gettext-devel ghostscript-devel ghostscript-fonts git gl-manpages glances glib2 glib2-devel gmp gmp-devel gperftools gperftools-devel graphviz gtk2 hdparm hicolor-icon-theme htop iftop ilmbase ilmbase-devel imake iotop ipset iptables* jasper-devel jasper-libs jbigkit-devel jbigkit-libs jemalloc jemalloc-devel jpegoptim jq krb5-devel lcms2 lcms2-devel libICE-devel libSM-devel libXaw libXcomposite libXcursor libXdamage-devel libXfixes-devel libXfont libXi libXinerama libXmu libXpm-devel libXrandr libXt-devel libXxf86vm-devel libaio libaio-devel libatomic_ops-devel libc-client libc-client-devel libbsd libbsd-devel libidn2 libidn2-devel libopendkim libopendkim-devel libcurl libcurl-devel libdrm libyaml libyaml-devel libdrm-devel libedit libedit-devel libevent libevent-devel libffi-devel libfontenc libidn libidn-devel libjpeg libjpeg-devel libmcrypt libmcrypt-devel libnghttp2 libnghttp2-devel libpng libpng-devel libraqm librsvg2 libtidy libtidy-devel libtiff libtiff-devel libtool libtool-libs libtool-ltdl-devel libuuid-devel libvpx libvpx-devel libwebp libwebp-devel libwmf-lite libxml2 libxml2-devel libxslt libxslt-devel libxslt-python libzip libzip-devel lsof lua lua-devel lynx lz4 m2crypto mailx make mesa-libGL-devel mesa-libGLU mesa-libGLU-devel mlocate moreutils mtr nano nc ncurses ncurses-devel net-snmp net-snmp-devel net-snmp-libs net-snmp-utils net-tools nghttp2 nload nmap-ncat ntpdate numactl openldap openldap-devel openssh openssl openssl-devel optipng pam pam-devel patch pbzip2 pcre pcre-devel perl-Crypt-SSLeay perl-ExtUtils-Embed perl-ExtUtils-MakeMaker perl-LWP-Protocol-https perl-Net-SSLeay perl-Test-Simple perl-Time-HiRes perl-XML-LibXML perl-XML-LibXSLT perl-libwww-perl pigz pkgconfig pngquant poppler-data pwgen pxz python-devel python2-pip python36u python36u-pip re2c readline readline-devel recode recode-devel rrdtool rsyslog screen strace subversion sudo sysstat t1lib t1lib-devel time tk-devel unzip urw-fonts uuid-devel uw-imap-devel vim vim-minimal virt-what wget which xorg-x11-font-utils xz yum-plugin-fastestmirror yum-plugin-security yum-plugin-versionlock yum-axelget yum-utils zlib zlib-devel GeoIP GeoIP-devel ImageMagick ImageMagick-c++ ImageMagick-c++-devel ImageMagick-devel OpenEXR-devel OpenEXR-libs
yum install -y devtoolset-7-* llvm-toolset-7-* 
yum update &amp;&amp; yum upgrade -y</code></pre><h3>更改系统时间（可选）</h3><pre><code>sudo timedatectl set-timezone Asia/Shanghai</code></pre><h2>安装 Nginx</h2><h3>使用 Nginx 官方的仓库，导入 Nginx 的 key</h3><pre><code>rpm --import http://nginx.org/keys/nginx_signing.key</code></pre><h3>新建 Nginx 源</h3><pre><code>cat &gt;&gt; /etc/yum.repos.d/nginx.repo &lt;&lt; EOF
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/mainline/centos/7/\$basearch/
gpgcheck=0
enabled=1
EOF</code></pre><h3>安装 Nginx</h3><pre><code>yum update -y
yum install nginx -y
nginx -V</code></pre><h3>为 Nginx 放行防火墙端口（以 <code>firewall</code> 为例）</h3><pre><code>firewall-cmd --zone=public --permanent --add-service=https
firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --reload </code></pre><h2>安装 PHP</h2><h3>从 <code>webtatic</code> 源安装 PHP</h3><p>我们并不会从官方源拉取 PHP，因为官方版本太过于古老，于是我们选择 <code>webtatic</code> 维护的 PHP，安装较新的 <code>PHP7.1</code></p><pre><code>yum install mod_php72w php72w-{cli,bcmath,common,devel,fpm,gd,intl,mbstring,mysqlnd,odbc,opcache,pdo,xml,xmlrpc} -y</code></pre><p><strong>修改一下 <code>/etc/php.ini</code> 防止跨站攻击：</strong></p><pre><code>sed -i 's/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/' /etc/php.ini </code></pre><h3>开启 <code>php-fpm</code> 服务：</h3><pre><code>systemctl start php-fpm
systemctl enable php-fpm</code></pre><h3>创建 <code>php info</code> 测试文件</h3><pre><code>rm -rf /etc/nginx/conf.d/*
vi /etc/nginx/conf.d/example.conf</code></pre><p>写入如下内容：</p><pre><code>server {
        listen 80;
        root /usr/share/nginx/html;
        server_name _;
        index index.php index.html index.htm;
        location ~ \.php$ {
            try_files $uri =404;
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include fastcgi_params;
        }
}</code></pre><p>PHP 测试文件写入为：</p><pre><code>cat &gt;&gt; /usr/share/nginx/html/phpinfo.php &lt;&lt; EOF
&lt;?php phpinfo(); ?&gt;
EOF</code></pre><h3>重启 Nginx 并查看 PHP 参数</h3><pre><code>systemctl restart nginx
systemctl enable nginx</code></pre><p>浏览器中打开 <code>http://&lt;YOURIP&gt;/phpinfo.php</code> 即可查看。如果能够打开的话证明之前的安装是成功的。</p><h2>安装 MySQL</h2><p>再次安利大家用 <code>Percona Server</code> 代替 <code>MySQL</code> 或 <code>Mariadb</code></p><h3>增加 Percona Server 的仓库</h3><pre><code>yum install https://www.percona.com/redir/downloads/percona-release/redhat/latest/percona-release-0.1-6.noarch.rpm</code></pre><h3>然后安装</h3><pre><code>yum install Percona-Server-server-57 -y</code></pre><p><strong>为了安全考虑，安装过程中是不需要输入 MySQL root 密码的</strong>，我们直接启动 MySQL：</p><pre><code>systemctl start mysql</code></pre><p>然后 root 密码就会放在日志里了</p><pre><code>cat /var/log/mysqld.log | grep &quot;temporary password&quot;</code></pre><p>返回的结果大致如下：</p><pre><code>A temporary password is generated for root@localhost: 123456</code></pre><p>最后的那一串就是你的 root 密码啦</p><h3>重置密码并增强安全性</h3><pre><code>mysql_secure_installation  </code></pre><p>设置如下</p><pre><code>[root@cent7]# mysql_secure_installation  

Securing the MySQL server deployment.

Enter password for user root: 

The existing password for the user account root has expired. Please set a new password.

New password: 

Re-enter new password: 

The 'validate_password' plugin is installed on the server.
The subsequent steps will run with the existing configuration
of the plugin.
Using existing password for root.

Estimated strength of the password: 100 
Change the password for root ? ((Press y|Y for Yes, any other key for No) : n

 ... skipping.
By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.

Remove anonymous users? (Press y|Y for Yes, any other key for No) : y
Success.

Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y
Success.

By default, MySQL comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment.

Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y
 - Dropping test database...
Success.

 - Removing privileges on test database...
Success.

Reloading the privilege tables will ensure that all changes made so far will take effect immediately.

Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
Success.

All done!  </code></pre><p>做好初始安全设置后，我们就可以进行创建数据库操作。</p><h3>新建数据库和用户</h3><ul><li>首先使用 <code>root</code> 登录 MySQL</li></ul><pre><code>mysql -u root -p  </code></pre><ul><li>会提示输入密码，输入密码登陆后，创建一个名为 <code>example</code> 的数据库</li></ul><pre><code>CREATE DATABASE example DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;  </code></pre><p>由于手机端的流行，我们已经不再使用 <code>utf-8</code> 编码，而改用 <code>utf8mb4</code> 这样我们就可以在 MySQL 数据库里储存 emoji 表情了。你甚至可以尝试使用 emoji 作为用户名或者密码。</p><ul><li>接着我们创建一个叫做 <code>example_user</code> 的用户，使用强大的密码并且赋予 <code>example_database</code> 数据库权限</li></ul><pre><code>GRANT ALL ON example.* TO 'example_user'@'localhost' IDENTIFIED BY '这里改成你要设置的强大的没人能猜出来的随机的密码'; </code></pre><p>终端会提示类似 <code>Query OK, 0 rows affected, 1 warning</code> 不用去管它</p><ul><li>然后刷新权限，没问题就可以退出结束安装了</li></ul><pre><code>FLUSH PRIVILEGES;
EXIT;    </code></pre>]]></content>
        
        <summary type="html">
            
            CentOS 是 RHEL (Red Hat Enterprise Linux) 的免费版，由于红帽的大力推广，在国内外很是流行。因为众多企业和开发者使用，首先要求的是保证稳定，所以 CentOS 下的软件从不追求最新版本。而很多时候我们不得不用到最新的版本进行一些操作，本文就
            
        </summary>
        
    </entry>
    
    <entry>
        <title>通过CNAME方式接入Cloudflare</title>
        <link href="https://www.iwch.me/archives/666.html"/>
        <id>https://www.iwch.me/archives/666.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-12-01T05:00:00+00:00</published>
        <updated>2017-12-01T05:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>Cloudflare（以下简称CF）是一家非常优秀的CDN服务商，它所提供的免费服务功能非常丰富，足以应付绝大多数中小型网站的需求，可以说是业界良心。</p><p>通常来说，免费版CF只能通过NS方式接入，这意味着你需要修改域名的NS才可以免费的使用CF所提供的众多服务。</p><p>如果你需要通过CNAME方式接入CF，那么你需要每月200美元以上的Business/Enterprise Plan才可以使用，这对于很多站长来说都太贵了。</p><p>所以说，欢迎使用我的Partner帐户，免费的以CNAME方式接入CF。</p><p>首先打开控制面板：<a href="https://cf.iwch.me/" target="_blank">传送门</a></p><p>输入你CF帐户的邮箱和密码进行登录，我们不会存储你的任何CF数据，登录成功后直接添加域名。</p><p><strong>注意：请确定你所添加的域名不存在于你的CF或其他的Partner帐户中，否则在添加域名这一步会报错。</strong></p><p>域名添加成功后，请解析表格中蓝色高亮的那一行用于签发SSL证书。</p><p><img src="https://static.yecdn.com/static/blog/post/666/cf-0.png" /></p><p>如图，将<code>_16d2770d465d3a933e87d2954e3de00d.iwch.tk</code>通过CNAME解析到<code>8494ca9c307236cfb863d6880735a826.62310feac674b1e671001f6d74315a53.c2353171eac70e338371.comodoca.com</code>即可。</p><p>点击上方Edit即可管理回源地址：</p><p><img src="https://static.yecdn.com/static/blog/post/666/cf-1.png" /></p><p>在第一个输入框中直接输入裸域的回源地址，在第二个输入框中请务必严格按照「一行一个子域名，和源站之间空格隔开」格式填写：</p><pre><code>SubDomain1 Origin1
SubDomain2 Origin2
SubDomain3 Origin3
</code></pre><p>提交成功后，根据提示信息解析后即可使用。</p></div>]]></content>
        
        <summary type="html">
            
             Cloudflare（以下简称CF）是一家非常优秀的CDN服务商，它所提供的免费服务功能非常丰富，足以应付绝大多数中小型网站的需求，可以说是业界良心。通常来说，免费版CF只能通过NS方式接入，这意味着你需要修改域名的NS才可以免费的使用CF所提供的众多服务。如果你需要通过CN
            
        </summary>
        
    </entry>
    
    <entry>
        <title>记(水)一件趣事</title>
        <link href="https://imiku.me/2017/11/30/985.html"/>
        <id>https://imiku.me/2017/11/30/985.html</id>
        
        <author>
            <name>Ice-Hazymoon</name>
        </author>
        
        <published>2017-11-29T16:41:04+00:00</published>
        <updated>2017-11-29T16:41:04+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>
  好久没<del>水</del>写博客了....
</p></blockquote>
<p>因为英语的词汇量出奇的少，于是自己嘴贱立的flag，说是要在一个月内背完开心词场的新一词书，如果背不玩的话就内啥，词书的内容都很基础，没什么难度，但由于自己实在是太懒了，于是......当然是不可能背完的啦23333，但是我不想被内啥，所有就有了这次奇葩的记录...</p>
<h2>使用 GameGuardian 修改数据和加速器快速通关</h2>
<p>离到月底还有2天，80关的单词还剩60关没过，认真的背是肯定不可能的，就算照着答案抄也得很长时间才能刷完，于是想到了第一个方法: 使用 GameGuardian 修改单词数据快速刷关，不过试了很久最后只能修改每关的可错误次数(就是那个红色的小心心，如果变为0将闯关失败)</p>
<p><a href="https://myblogpic.b0.upaiyun.com/2017/11/2017112916012329.jpg" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/2017112916012329.jpg" /></a></p>
<p>接着配合加速器和修改数据花了二十多分钟刷了大概10多关左右，还是感觉太慢了，于是试了第二个方法</p>
<h2>直接修改软件的数据库进行进度的修改</h2>
<p>既然不会用 GameGuardian 修改，那么直接修改数据库岂不是更直接2333.<br />
先使用 RootExplorer 自带的 SQLite 浏览器查看词场的数据，经过不断的筛选，最终锁定了 <strong>iWord_user_69189193</strong> 这个文件，里面存储了用户的所有信息(单词记录，星星数，PK记录等)</p>
<p><a href="https://myblogpic.b0.upaiyun.com/2017/11/2017112916081280.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/2017112916081280.png" /></a><br />
<a href="https://myblogpic.b0.upaiyun.com/2017/11/2017112916080025.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/2017112916080025.png" /></a><br />
<a href="https://myblogpic.b0.upaiyun.com/2017/11/2017112916082542.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/2017112916082542.png" /></a></p>
<p>之后再将该文件发送到 PC 端使用 <a href="https://github.com/sqlitebrowser/sqlitebrowser/releases" target="_blank">DB Browser for SQLite</a>进行编辑，按照以下表格进行修改</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_book</td>
<td>用户的所有词书，可通过 recited_word_num(单词通关数量) 等值进行判断</td>
</tr>
<tr>
<td>user_book_unit</td>
<td>所有词书的记录，根据在 user_book 得到的编号进行修改相关值</td>
</tr>
<tr>
<td>user_book_unit_log</td>
<td>当前所背词书的日志记录</td>
</tr>
<tr>
<td>user_config</td>
<td>用户的配置文件，修改关卡数量即可</td>
</tr>
</tbody>
</table>
<p><a href="https://myblogpic.b0.upaiyun.com/2017/11/2017112916292312.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/2017112916292312.png" /></a></p>
<p>修改完保存后再导入到手机覆盖原来的文件，建议备份一下，之后就全部三星通关了~，可以不用被内啥了</p>
<p><a href="https://myblogpic.b0.upaiyun.com/2017/11/201711291632086.png" target="_blank"><img src="https://myblogpic.b0.upaiyun.com/2017/11/201711291632086.png" /></a></p>
<p><strong>总的来说没什么技术含量，就是吐槽一下自己2333，这个故事告诉我们千万不要嘴贱的立各种 flag.</strong></p>
<blockquote><p>
  以上内容仅供娱乐，请勿模仿(逃~
</p></blockquote>]]></content>
        
        <summary type="html">
            
               好久没水写博客了....  因为英语的词汇量出奇的少，于是自己嘴贱立的flag，说是要在一个月内背完开心词场的新一词书，如果背不玩的话就内啥，词书的内容都很基础，没什么难度，但由于自己实在是太懒了，于是......当然是不可能背完的啦23333，但是我不想被内啥，所有就有
            
        </summary>
        
        <category term="喵喵喵"/>
        
        <category term="奇淫技巧"/>
        
        <category term="日常"/>
        
    </entry>
    
    <entry>
        <title>Android 的优化软件们</title>
        <link href="https://liyin.date/2017/11/29/android-optimize-app/"/>
        <id>https://liyin.date/2017/11/29/android-optimize-app/</id>
        
        <published>2017-11-29T16:13:02+00:00</published>
        <updated>2017-11-29T16:13:02+00:00</updated>
        
        <content type="html"><![CDATA[<p>昨天晚上跟同学聊天的时候脑洞大开，于是各种编段子，后来整理了下发到了我的 <a href="https://t.me/lynote" target="_blank">Telegram 频道</a> 上，经过其他人转发之后……… 开启了编段子的夜</p>]]></content>
        
        <summary type="html">
            
            昨天晚上跟同学聊天的时候脑洞大开，于是各种编段子，后来整理了下发到了我的 Telegram 频道 上，经过其他人转发之后……… 开启了编段子的夜
            
        </summary>
        
    </entry>
    
    <entry>
        <title>如何为 ThinkJS 3 网站优化 TTFB 时间</title>
        <link href="https://imququ.com/post/reduce-ttfb-on-thinkjs3-website.html"/>
        <id>https://imququ.com/post/reduce-ttfb-on-thinkjs3-website.html</id>
        
        <published>2017-11-28T05:40:19+00:00</published>
        <updated>2017-11-28T05:40:19+00:00</updated>
        
        <content type="html"><![CDATA[<p>今年早些时候，奇舞团开源的 Node.js 框架 ── <a href="https://thinkjs.org/">ThinkJS</a> 迎来了她的 3.0 版本。尽管今年我很少更新博客，但「每次 ThinkJS 发布大版本，我都要更新博客程序」的老传统还是不能丢。所以，你现在看到的这个博客，已经是基于 ThinkJS 3 全面重构后的新版。</p>
<p>ThinkJS 3 基于 <a href="http://koajs.com">Koa</a> 2.x 开发，内核实现得非常小巧，框架通过 Middleware（兼容 Koa）、Adapter、Extend 等机制来扩展出强大而丰富的功能。按照惯例，ThinkJS 大版本之间无法平滑进行，但这次升级带来的工作量不算太大，本站的升级工作花了一下午全部完成。</p>
<p>基于 ThinkJS 开发的网站普遍都很快，这篇文章我打算聊聊如何为 ThinkJS 3 网站优化 TTFB 时间，使之变得更快。</p>
<p>Time to first byte（简称 TTFB）时间，又称首字节时间，是 WEB 性能优化中非常重要的指标。它代表着从浏览器发起 HTTP 请求到收到 HTTP 响应第一个字节的这段时间，包含了 DNS 解析、建立 TCP 连接、建立 SSL 连接、发送 HTTP 请求、网络传输、服务端处理、30X 重定向等阶段。在影响 TTFB 所有因素中，服务端程序何时输出响应决定了服务端处理时间的长短，也是本文关注的优化目标。</p>
<p>优化 WEB 页面的 TTFB 时间除了要尽可能优化业务逻辑之外，还有两个常用技巧：</p>
<ul>
<li>多个 HTTP 请求响应（动静拆分）；</li>
<li>一个 HTTP 请求多次响应（分块传输）；</li>
</ul>
<p>前者无非就是先尽快输出一个无服务端复杂逻辑的空壳页面，再发起 ajax、jsonp 等异步请求填充内容。这种方案不利于 SEO，比较适用于单页应用。</p>
<p>像本站这种以内容为主的 Web 页面，非常适合采用第二个技巧来优化 TTFB 时间。本文重点介绍它。</p>
<p>分块传输响应需要用到我之前介绍过的 <a href="https://imququ.com/post/transfer-encoding-header-in-http.html">HTTP Transfer-Encoding: chunked</a> 机制。有了这个机制，服务端可以随时将已经完成的部分响应发送给给客户端，而不必等待全部完成后再一次发送。浏览器拿到部分响应，就能解析并执行其中的 HTML、CSS 和 JS 代码，还能加载其中引用的子资源，最终让用户更快看到部分页面内容。分块传输也是 Facebook 在 2009 年实现的 Bigpipe 方案的理论基础，这里不再赘述。</p>
<p>再来说说 ThinkJS。</p>
<p>在 ThinkJS 之前几个版本中，我们可以通过 <code>http.write(content)</code> 发送多个 chunk，再通过 <code>http.end(content)</code> 发送最后一个 chunk，非常方便。</p>
<p>而 ThinkJS 3 使用的 Koa 2.x，只能通过 <code>ctx.body</code> 设置并结束响应，意味着通常情况下响应只能发送一次，还得放在整个 Controller 流程的最后。</p>
<p>通过分析代码，我找到在 ThinkJS 3 中多次发送响应的两种方案：</p>
<ul>
<li><code>ctx.body</code> 支持传入 Stream，创建 Readable 流 <code>rs</code> 并多次调用 <code>rs.push(content)</code> 可以多次发送 chunk，调用 <code>rs.push(null)</code> 可以结束响应；</li>
<li>Koa 代码层面上并没有禁止我们使用 <code>ctx.res</code>，通过 <code>res</code> 对象可以完全控制响应；</li>
</ul>
<p>方案一比较正统；方案二则危险得多，官方都说要后果自负：</p>
<blockquote>
<p>Bypassing Koa's response handling is not supported. Avoid using the following node properties: res.statusCode, res.writeHead(), res.write(), res.end(). <a href="http://koajs.com/#ctx-res">via</a></p>
</blockquote>
<p>所以，本站最终采用了方案二。Koa 总共就几个文件，出啥奇怪的问题都不怕。</p>
<p>下面开始贴代码。</p>
<p>1）创建 Controller 的 Extend 文件 <code>src/extend/controller.js</code>：</p>
<pre><code><span>const</span> firstChunkMinLength = <span>4096</span>;

<span>module</span>.exports = {
    <span>async</span> renderAndFlush(tpl) {
        <span>let</span> content = <span>await</span> <span>this</span>.render(tpl);

        <span>//first chunk</span>
        <span>if</span>(!<span>this</span>.ctx.headerSent) {
            <span>this</span>.ctx.type = <span>'html'</span>;
            <span>this</span>.ctx.flushHeaders();

            <span>let</span> length = content.length;
            <span>if</span>(length &lt; firstChunkMinLength) {
                content += <span>`&lt;s&gt;<span>${' '.repeat(firstChunkLength - length)}</span>&lt;/s&gt;`</span>;
            }
        }

        <span>this</span>.ctx.res.write(content);
    }
};
</code></pre>
<p>输出第一个 chunk 之前，需要通过 ctx 的 <code>type</code> setter 和 <code>flushHeaders</code> 方法来输出响应起始行和头部。</p>
<p>第一个 chunk 不能太小，否则会被某些浏览器缓存起来，不会马上显示，达不到我们想要的效果。更多细节可以点开这个 <a href="https://stackoverflow.com/questions/16909227/using-transfer-encoding-chunked-how-much-data-must-be-sent-before-browsers-s">stackoverflow 的链接</a>自己看。另外，我在实际测试中发现，只补空格 iOS Safari 依然不会立刻渲染，把空格放在标签里就没问题。也可能是我的幻觉，欢迎大家测试并指正。</p>
<p>2）在 Controller 里将原本渲染模板的逻辑根据实际情况拆分为多步：</p>
<pre><code><span>async</span> indexAction() {
    <span>let</span> pageName = <span>'blog-home'</span>;
    <span>let</span> title = <span>'JerryQu 的小站'</span>;
    <span>this</span>.assign({ pageName, title});

    <span>//输出头部和边栏 HTML</span>
    <span>await</span> <span>this</span>.renderAndFlush(<span>'home/inc/header'</span>);

    <span>//查询数据库（耗时操作）</span>
    <span>let</span> pn = <span>this</span>.get(<span>'pn'</span>);
    <span>let</span> data = <span>await</span> <span>this</span>.model(<span>'post'</span>).getPostList(pn, <span>10</span>);
    data.pagerPath = getPagerPath(<span>this</span>.ctx, <span>'pn'</span>);
    <span>this</span>.assign(data);

    <span>//输出剩余 HTML</span>
    <span>return</span> <span>this</span>.display(<span>'home/index_post_list'</span>);
}
</code></pre>
<p>也就是说需要提前发送的模板通过 renderAndFlush 来渲染并发送，剩余模板还是走原有的 display 逻辑。</p>
<p>至此，本文要介绍的优化工作已经完成，赶紧打开浏览器验证一下吧。</p>
<p>但是如果你照着我的代码改造，肯定会遇到不少坑，下面列举几个：</p>
<p>1）原本的异常逻辑重定向到错误页不好用，直接提示 <code>Can't set headers after they are sent.</code> 错误。</p>
<p>这个错误信息已经把原因描述得很明白，HTTP/1 的响应需要严格按照起始行、头部和正文的顺序发送，已经发送了正文，就不能再通过 30X 状态码和 <code>Location</code> 头部来跳转页面。</p>
<p>解决方案：有一些会产生跳转的逻辑例如参数合法性检查，可以挪到发送第一个分块之前来进行。另一些异常跳转逻辑则无法提前，例如查询数据库后发现不存在对应的文章，这种情况可以输出一段 JS 代码在浏览器中跳转，或者直接渲染错误页面。</p>
<p>2）提前输出的模板中部分变量取不到值。</p>
<p>例如本站第一个分块输出了左侧内容，这个分块对应的模板中，有很多字段原本来自数据库查询后的结果，提前渲染必然取不到值。</p>
<p>解决方案：这些需要用到数据库字段的逻辑，有一些可以挪到后续分块中；有一些则不好后移，例如需要动态赋值的页面 <code>&lt;title&gt;</code>，只能放在 <code>&lt;head&gt;</code> 里。一种方案是继续使用万能的 JS，通过后续分块中的 <code>docuemnt.title</code> 来给页面 title 赋值。对于不支持 JS 的 Spider，可以禁用提前输出响应策略。</p>
<p>我使用了另外一套方案：由于文章数量不多，我索性在程序启动时，把全部文章 ID 和标题对应关系从数据库取出来，存在配置中。这样，后续第一个分块获取标题时无需查询数据库。</p>
<p>下面这段代码需要放在 <code>src/bootstrap/worker.js</code>：</p>
<pre><code><span>//HTTP 服务启动前执行</span>
think.beforeStartServer(<span>async</span> () =&gt; {
    <span>let</span> postTitle = {};
    (<span>await</span> think.model(<span>'post'</span>).field([<span>'slug'</span>, <span>'title'</span>]).select()).forEach(item =&gt; {
        postTitle[item.slug] = item.title;
    });
    think.config(<span>'postTitle'</span>, postTitle);
});
</code></pre>
<p>3）Middleware 中获取到的 <code>ctx.body</code> 不是完整页面。</p>
<p>本方案只有最后一个分块内容才会赋值给 <code>ctx.body</code>，前面分块的输出则完全绕过了 Middleware，出现这种情况是正常的。如果你不能接受，还是老老实实用 Readable Stream 吧。</p>
<p>最后，看完本文，相信你对如何优化 ThinkJS 3 网站的 TTFB 时间有了足够了解，赶紧动手试试吧。遇到任何问题，欢迎留言讨论。</p>
<p>本文链接：<a href="https://imququ.com/post/reduce-ttfb-on-thinkjs3-website.html">https://imququ.com/post/reduce-ttfb-on-thinkjs3-website.html</a>，<a href="https://imququ.com/post/reduce-ttfb-on-thinkjs3-website.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            今年早些时候，奇舞团开源的 Node.js 框架 ── ThinkJS 迎来了她的 3.0 版本。尽管今年我很少更新博客，但「每次 ThinkJS 发布大版本，我都要更新博客程序」的老传统还是不能丢。所以，你现在看到的这个博客，已经是基于 ThinkJS 3 全面重构后的新版。
            
        </summary>
        
    </entry>
    
    <entry>
        <title>对「穷逼VIP」事件的一些个人看法</title>
        <link href="https://www.iwch.me/archives/665.html"/>
        <id>https://www.iwch.me/archives/665.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-11-20T16:30:00+00:00</published>
        <updated>2017-11-20T16:30:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>开门见山：</p><p><strong>你们啊，不要总想着弄个大新闻！</strong></p><p>那只是一段注释而已，又不是展现给用户看的。</p><p>有些人是真的厉害，把这样一段注释，直接给上升到了一个相当高的高度上，甚至还扯到“阿里的优越感”什么的。</p><p>我觉得，一个团队内部如何定义自己的用户群体，应该是他们最基本的自由吧，人家无论怎么说，最终也是以盈利为目的的，觉得OK就充个VIP，觉得不行卸载就好，何必把原本很活跃的讨论氛围突然搞得火药味十足呢。</p><p>更何况，很有可能只是某个程序员抖个机灵，或者单纯的吐槽下VIP体系太乱而已。</p><p>至少，我不希望在将来的某一天，我在写代码的时候，变量名只能使用ABC，写注释之前还要向同事请教语法和修辞。</p><p>以上内容仅代表本穷逼个人观点。</p><p>传送门：<a href="https://www.v2ex.com/t/407653" target="_blank">虾米 mac 客户端发现个好玩的注释</a></p></div>]]></content>
        
        <summary type="html">
            
             开门见山：你们啊，不要总想着弄个大新闻！那只是一段注释而已，又不是展现给用户看的。有些人是真的厉害，把这样一段注释，直接给上升到了一个相当高的高度上，甚至还扯到“阿里的优越感”什么的。我觉得，一个团队内部如何定义自己的用户群体，应该是他们最基本的自由吧，人家无论怎么说，最终也
            
        </summary>
        
    </entry>
    
    <entry>
        <title>闲聊·记录 | 2017年11月</title>
        <link href="https://liyin.date/2017/11/18/talk-2017-11/"/>
        <id>https://liyin.date/2017/11/18/talk-2017-11/</id>
        
        <published>2017-11-18T14:33:17+00:00</published>
        <updated>2017-11-18T14:33:17+00:00</updated>
        
        <content type="html"><![CDATA[<p>时间往往过得很快，这个月似乎发生了不少事情，梳理下思路来想想这个到现在都干了什么…..</p>
<p><br /></p>
<p>上月底我受同学邀请去了一家手游公司工作，主要从事手游 SDK 的相关开发（所以我也不知道手游的策划们是怎么干活的），对于我来说，难度属于并不是很难，</p>]]></content>
        
        <summary type="html">
            
            时间往往过得很快，这个月似乎发生了不少事情，梳理下思路来想想这个到现在都干了什么…..  上月底我受同学邀请去了一家手游公司工作，主要从事手游 SDK 的相关开发（所以我也不知道手游的策划们是怎么干活的），对于我来说，难度属于并不是很难，
            
        </summary>
        
    </entry>
    
    <entry>
        <title>bPlayer</title>
        <link href="https://liyin.date/2017/11/18/bplayer/"/>
        <id>https://liyin.date/2017/11/18/bplayer/</id>
        
        <published>2017-11-18T14:12:12+00:00</published>
        <updated>2017-11-18T14:12:12+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote>
<p>说起来很久都没写博客了呢，估计这两天会写一篇博文记录下最近的事情~</p>
</blockquote>
<h1><a href="https://liyin.date/2017/11/18/bplayer/#引"></a>引</h1><p>2017 年</p>]]></content>
        
        <summary type="html">
            
             说起来很久都没写博客了呢，估计这两天会写一篇博文记录下最近的事情~  引2017 年
            
        </summary>
        
    </entry>
    
    <entry>
        <title>MacBook Pro</title>
        <link href="https://www.iwch.me/archives/662.html"/>
        <id>https://www.iwch.me/archives/662.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-11-14T15:55:00+00:00</published>
        <updated>2017-11-14T15:55:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>在今年的苹果返校活动开始后的第一天，入了一台盼望已久的MacBook Pro，弃掉了陪伴了我好多好多好多年的联想。</p><p>7号下单，前前后后一共收到了4个EMS的快递，14号的下午终于拿到了电脑，心急的我还没来得及拍照留念，电脑就已经沾上了我的指纹。</p><p><img src="https://static.yecdn.com/static/blog/post/662/order-0.png" /></p><p>当我发布这篇文章的时候，我已经拿到电脑整整三个月的时间了。</p><p>在我拿到电脑之前，我还担心过，从Windows平台切换到macOS会不会不习惯，会不会找不到常用的软件，但事实上是我多虑了。总体来说，macOS的逻辑很简单，操作界面也非常直观，常用的软件也很容易找得到替代品，所以对我来说并不需要很高的学习成本。</p><p>在我今年生日的那一天晚上，姐姐和姐夫送给我一个Magic Mouse 2作为生日礼物，但是我却很少用它——除了要做一些比较精密的操作外，内建的触控板比鼠标不知道高到哪里去了|ω・）</p><p>在我刚刚拿到电脑的时候，用惯了机械键盘的我表示，电脑内建键盘的手感真的很差——键程太短，声音还很大，有一种在按公牛插线板电子微动开关的感觉。所以，我前期基本上使用的是外接的键盘。后来，慢慢习惯了用这个键盘打字，感觉其实也不是那么糟糕，而且在前些天没有暖气的时候，这个自带发热属性的键盘简直是个冬天里暖手的神器。</p><p>很早之前就听说过MacBook的续航能力很强，所以我对于它续航的期望值可能有些高了。在比较重度的使用场景下，续航能力基本上也就是三四个小时，而我又经常需要带着电脑出门，所以对于续航方面有一些小失望。</p><p>这三个月里，经历了一次macOS系统升级，从Sierra升级到了High Sierra，然后...我在系统升级过程中手贱关掉了电源...虽然重新启动之后可以继续之前的安装进程，并且也顺利地完成了系统升级，但是心里从此留下了阴影，所以最近正在纠结要不要重装一下系统。如果重装系统的话，好多数据都要备份，好麻烦啊QAQ</p><p>零乱的桌面：</p><p><img src="https://static.yecdn.com/static/blog/post/662/desktop-0.jpg" /></p></div>]]></content>
        
        <summary type="html">
            
             在今年的苹果返校活动开始后的第一天，入了一台盼望已久的MacBook Pro，弃掉了陪伴了我好多好多好多年的联想。7号下单，前前后后一共收到了4个EMS的快递，14号的下午终于拿到了电脑，心急的我还没来得及拍照留念，电脑就已经沾上了我的指纹。当我发布这篇文章的时候，我已经拿到
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Chrome 离线包查询</title>
        <link href="https://blog.nfz.moe/archives/chrome-binary-download.html"/>
        <id>https://blog.nfz.moe/archives/chrome-binary-download.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-11-12T08:48:17+00:00</published>
        <updated>2017-11-12T08:48:17+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>DEMO：<a href="https://chrome.nfz.moe" target="_blank">chrome.nfz.moe</a></p></blockquote><a></a><p> 在 METO 的 <a href="https://i-meto.com/chrome-binary/" target="_blank"> 这篇文章 </a> 的启发下，我也自己做了一套 Chrome 离线包下载页面，如下图所示：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000185.png" /></p><p> 我也写了一个 bash 脚本用来自动查询 Chrome 离线包数据，并丢在 Travis CI 上运行：</p><p>GitHub Repo: <a href="https://github.com/neoFelhz/ChromeChecker" target="_blank">ChromeChecker</a><br />Travis CI: <a href="https://travis-ci.org/neoFelhz/ChromeChecker" target="_blank">Build Status</a></p><hr /><p> 在本文的主要内容开始之前，我不得不放置一张和 Chrome 离线包查询无关的图片。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000186.png" /></p><p> 上面这张图片是 <a href="https://i-meto.com/chrome-binary/" target="_blank">METO 的那篇文章 </a> 下面的评论，和这个人和我的邮件交流过程。</p><p> 为了防止再有伸手党过来烦人，而且我的脾气也非常差。所以，<strong> 本文拒绝提供任何技术细节 </strong>，任何相关问题的咨询一律一个问题 150RMB，十个问题以上八折，多不退少补。我的 Repo 都以 <code>Unlicense</code> 协议开源了，别来烦我了。</p><hr /><p> 简单地说，Chrome 内部的更新检查机制是对 <code>https://tools.google.com</code> 发起一个 POST 请求，Form data 的格式为 </p><pre><code><span>&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span><span><span><span>&lt;</span>request</span> <span>protocol</span><span><span>=</span><span>'</span>3.0<span>'</span></span> <span>version</span><span><span>=</span><span>'</span>1.3.23.9<span>'</span></span> <span>shell_version</span><span><span>=</span><span>'</span>1.3.21.103<span>'</span></span> <span>ismachine</span><span><span>=</span><span>'</span>0<span>'</span></span>         <span>sessionid</span><span><span>=</span><span>'</span>{3597644B-2952-4F92-AE55-D315F45F80A5}<span>'</span></span> <span>installsource</span><span><span>=</span><span>'</span>ondemandcheckforupdate<span>'</span></span>         <span>requestid</span><span><span>=</span><span>'</span>{CD7523AD-A40D-49F4-AEEF-8C114B804658}<span>'</span></span> <span>dedup</span><span><span>=</span><span>'</span>cr<span>'</span></span><span>&gt;</span></span><span><span><span>&lt;</span>hw</span> <span>sse</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>sse2</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>sse3</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>ssse3</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>sse41</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>sse42</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>avx</span><span><span>=</span><span>'</span>1<span>'</span></span> <span>physmemory</span><span><span>=</span><span>'</span>12582912<span>'</span></span> <span>/&gt;</span></span><span><span><span>&lt;</span>os</span> <span>platform</span><span><span>=</span><span>'</span>win<span>'</span></span> <span>version</span><span><span>=</span><span>'</span>6.3<span>'</span></span> <span>arch</span><span><span>=</span><span>'</span>{{arch}}<span>'</span></span><span>/&gt;</span></span><span><span><span>&lt;</span>app</span> <span>appid</span><span><span>=</span><span>'</span>{{appid}}<span>'</span></span> <span>ap</span><span><span>=</span><span>'</span>{{ap}}<span>'</span></span> <span>version</span><span><span>=</span><span>'</span><span>'</span></span> <span>nextversion</span><span><span>=</span><span>'</span><span>'</span></span> <span>lang</span><span><span>=</span><span>'</span><span>'</span></span> <span>brand</span><span><span>=</span><span>'</span>GGLS<span>'</span></span> <span>client</span><span><span>=</span><span>'</span><span>'</span></span><span>&gt;</span></span><span><span><span>&lt;</span>updatecheck</span><span>/&gt;</span></span><span><span><span>&lt;/</span>app</span><span>&gt;</span></span><span><span><span>&lt;/</span>request</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>METO 在他的文章中提供了一系列可以用的 <code>appid</code> <code>ap</code> 参数的值：</p><pre><code>{{appid}}Stable: 8A69D345-D564-463C-AFF1-A69D9E530F96,Beta: 8A69D345-D564-463C-AFF1-A69D9E530F96&quot;,Dev: 8A69D345-D564-463C-AFF1-A69D9E530F96&quot;,Canary: 4EA16AC7-FD5A-47C3-875B-DBF4A2008C20</code></pre><pre><code>{{arch}}x64, x86</code></pre><pre><code>{{ap}}Stable    &quot;x86&quot;: &quot;-multi-chrome&quot;,    &quot;x64&quot;: &quot;x64-stable-multi-chrome&quot;Beta    &quot;x86&quot;: &quot;1.1-beta&quot;,    &quot;x64&quot;: &quot;x64-beta-multi-chrome&quot;Dev    &quot;x86&quot;: &quot;2.0-dev&quot;,    &quot;x64&quot;: &quot;x64-dev-multi-chrome&quot;Canary    &quot;x86&quot;: &quot;&quot;,    &quot;x64&quot;: &quot;x64-canary&quot;</code></pre><p> 通过发起一个 POST 请求，带上 APPID 和 Key，就可以得到 Google 返回的 XML 的数据，格式化一下就像这样：</p><pre><code><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span><span><span>&lt;</span>response</span> <span>protocol</span><span><span>=</span><span>&quot;</span>3.0<span>&quot;</span></span> <span>server</span><span><span>=</span><span>&quot;</span>prod<span>&quot;</span></span><span>&gt;</span></span>  <span><span><span>&lt;</span>daystart</span> <span>elapsed_days</span><span><span>=</span><span>&quot;</span>3967<span>&quot;</span></span> <span>elapsed_seconds</span><span><span>=</span><span>&quot;</span>83981<span>&quot;</span></span><span>/&gt;</span></span>  <span><span><span>&lt;</span>app</span> <span>appid</span><span><span>=</span><span>&quot;</span>{8A69D345-D564-463C-AFF1-A69D9E530F96}<span>&quot;</span></span> <span>cohort</span><span><span>=</span><span>&quot;</span>1:gu/lur:<span>&quot;</span></span> <span>cohortname</span><span><span>=</span><span>&quot;</span>62_89_win<span>&quot;</span></span> <span>status</span><span><span>=</span><span>&quot;</span>ok<span>&quot;</span></span><span>&gt;</span></span>    <span><span><span>&lt;</span>updatecheck</span> <span>status</span><span><span>=</span><span>&quot;</span>ok<span>&quot;</span></span><span>&gt;</span></span>      <span><span><span>&lt;</span>urls</span><span>&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>http://redirector.gvt1.com/edgedl/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>https://redirector.gvt1.com/edgedl/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>http://dl.google.com/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>https://dl.google.com/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>http://www.google.com/dl/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;</span>url</span> <span>codebase</span><span><span>=</span><span>&quot;</span>https://www.google.com/dl/release2/chrome/eyeaRM1a5ls_62.0.3202.89/<span>&quot;</span></span><span>/&gt;</span></span>      <span><span><span>&lt;/</span>urls</span><span>&gt;</span></span>      <span><span><span>&lt;</span>manifest</span> <span>version</span><span><span>=</span><span>&quot;</span>62.0.3202.89<span>&quot;</span></span><span>&gt;</span></span>        <span><span><span>&lt;</span>actions</span><span>&gt;</span></span>          <span><span><span>&lt;</span>action</span> <span>arguments</span><span><span>=</span><span>&quot;</span>--verbose-logging --do-not-launch-chrome<span>&quot;</span></span> <span>event</span><span><span>=</span><span>&quot;</span>install<span>&quot;</span></span> <span>run</span><span><span>=</span><span>&quot;</span>62.0.3202.89_chrome_installer.exe<span>&quot;</span></span><span>/&gt;</span></span>          <span><span><span>&lt;</span>action</span> <span>Version</span><span><span>=</span><span>&quot;</span>62.0.3202.89<span>&quot;</span></span> <span>event</span><span><span>=</span><span>&quot;</span>postinstall<span>&quot;</span></span> <span>onsuccess</span><span><span>=</span><span>&quot;</span>exitsilentlyonlaunchcmd<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;/</span>actions</span><span>&gt;</span></span>        <span><span><span>&lt;</span>packages</span><span>&gt;</span></span>          <span><span><span>&lt;</span>package</span> <span>fp</span><span><span>=</span><span>&quot;</span>1.2e363460a769f36f691210de5293506bb545654a0a3967a5c3fbcb1d9c582343<span>&quot;</span></span> <span>hash</span><span><span>=</span><span>&quot;</span>62+NhjmNmmu/IItr6bxA2FE0FQY<span>=</span><span>&quot;</span></span> <span>hash_sha256</span><span><span>=</span><span>&quot;</span>2e363460a769f36f691210de5293506bb545654a0a3967a5c3fbcb1d9c582343<span>&quot;</span></span> <span>name</span><span><span>=</span><span>&quot;</span>62.0.3202.89_chrome_installer.exe<span>&quot;</span></span> <span>required</span><span><span>=</span><span>&quot;</span>true<span>&quot;</span></span> <span>size</span><span><span>=</span><span>&quot;</span>45365352<span>&quot;</span></span><span>/&gt;</span></span>        <span><span><span>&lt;/</span>packages</span><span>&gt;</span></span>      <span><span><span>&lt;/</span>manifest</span><span>&gt;</span></span>    <span><span><span>&lt;/</span>updatecheck</span><span>&gt;</span></span>  <span><span><span>&lt;/</span>app</span><span>&gt;</span></span><span><span><span>&lt;/</span>response</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 其中可以看到返回的数据中包括了 6 个可用的 URL、文件名、版本号、文件大小、SHA_256 和 HASH。自行拼凑 URL、正则提取有关数据，就可以很容易实现一个查询器了。<br /> 我开源了的 ChromeChecker 写了几个简单粗暴的脚本，使用 <code>xmllint</code> <code>cat</code> <code>grep</code> <code>echo</code> <code>sed</code> 这几个指令简单粗暴地就完成了数据提取和合并。</p><p>Python 版可以看 <a href="https://github.com/unnamed5719/chrome-checker" target="_blank">chrome-checker</a>。</p><hr /><p> 另外开放一个 “API”，可以拿来造一些轮子。</p><ul><li> 请求地址：<code>https://neofelhz.github.io/ChromeChecker</code> （仅支持 HTTPS，HTTP 请求将会 301 强制跳转 HTTPS）</li><li> 请求方式：GET</li><li> 请求参数：<code>chrome.xml</code> <code>chrome.min.xml</code></li></ul><p> 请求 <code>https://neofelhz.github.io/ChromeChecker/chrome.xml</code> 会返回格式化了的 XML 结果，用于阅读；请求 <code>https://neofelhz.github.io/ChromeChecker/chrome.xml</code> 会返回压缩后的 XML 文件。定时查询这一部分丢在 Travis CI 上跑，每 24 小时会查询一次（反正对于 Chrome 离线包查询，不需要 5 分钟就查询一次）。XML 中包括整理好的查询的时间、版本号、下载 URL 和文件名、SHA_256 等数据。</p>]]></content>
        
        <summary type="html">
            
            DEMO：chrome.nfz.moe 在 METO 的  这篇文章  的启发下，我也自己做了一套 Chrome 离线包下载页面，如下图所示： 我也写了一个 bash 脚本用来自动查询 Chrome 离线包数据，并丢在 Travis CI 上运行：GitHub Repo: Ch
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Chrome"/>
        
    </entry>
    
    <entry>
        <title>Nginx 的编译安装</title>
        <link href="https://dcc.cat/nginx.html"/>
        <id>https://dcc.cat/nginx.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2017-11-10T20:11:00+00:00</published>
        <updated>2017-11-10T20:11:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>默认安装的 Nginx 在大部分情况下都是足够使用的，但有的时候我们还需要其他一些高级的东西，这个时候就需要编译安装啦。这个部分比较繁琐，纯小白不看也没关系。东西比较多，我们创建一个文件夹单独存放，所有的操作都在该文件夹下操作。</p><h2>首先安装必备的模块</h2><pre><code>apt update &amp;&amp; apt dist-upgrade -y &amp;&amp; apt install cmake build-essential autoconf libtool automake libpcre3-dev libssl-dev zlib1g-dev libxml2-dev libbz2-dev libxslt1-dev libgd-dev libcurl4-openssl-dev libperl-dev libatomic-ops-dev libreadline-dev libncurses5-dev flex bison doxygen libffi-dev python-dev python-pip python-openssl libfuzzy-dev libyajl-dev dh-autoreconf libpcre++-dev uuid-dev liblua5.3-dev ssl-cert libluajit-5.1-dev -y</code></pre><h2>OPENSSL 库的选择</h2><h3>选用 OpenSSL 1.1.1 Draft 23 &amp; 28 版本</h3><blockquote><code>OpenSSL 1.1.1-pre8</code> 版已经支持 <code>TLSv1.3-Draft-28</code>，目前编译通过。</blockquote><p>打的补丁的作用为：<em>启用 boringSSL 等价组，同时支持 TLSv1.3 Draft 23 &amp; 28 版本，允许手动指定 TLSv1.3 ciphers</em></p><pre><code>git clone https://github.com/S8Cloud/sslpatch.git
wget https://www.openssl.org/source/openssl-1.1.1-pre8.tar.gz &amp;&amp; tar zxf openssl-1.1.1-pre8.tar.gz &amp;&amp; rm openssl-1.1.1-pre8.tar.gz &amp;&amp; cd openssl-1.1.1-pre8
patch -p1 &lt; ../sslpatch/OpenSSL1.1.1pre8-equal-ciphers-draft23_28.patch</code></pre><p>在 Nginx 配置中类似如下的写法：</p><pre><code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;                                          
ssl_ciphers [TLS_AES_128_GCM_SHA256|TLS_CHACHA20_POLY1305_SHA256]:[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305]:ECDHE-ECDSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:[ECDHE-RSA-AES128-GCM-SHA256|ECDHE-RSA-CHACHA20-POLY1305]:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:AES128-SHA;
ssl_ecdh_curve X25519:P-256:P-384;                                                                                                                                                          
ssl_prefer_server_ciphers on;  </code></pre><h3>选用 Patched OpenSSL 1.1.0h 版本</h3><pre><code>git clone https://github.com/S8Cloud/sslpatch.git
wget https://www.openssl.org/source/openssl-1.1.0h.tar.gz &amp;&amp; tar zxf openssl-1.1.0h.tar.gz &amp;&amp; rm openssl-1.1.0h.tar.gz &amp;&amp; cd openssl-1.1.0h
patch -p1 &lt; ../sslpatch/OpenSSL1.1.0h-double-performance-ecdhx-25519.patch
patch -p1 &lt; ../sslpatch/OpenSSL1.1.0h-improve-ECDSA-sign-30-40%.patch
patch -p1 &lt; ../sslpatch/OpenSSL1.1.0h-cache-timing-rsa-key-gen.patch
patch -p1 &lt; ../sslpatch/OpenSSL1.1.0h-equal-preference-cipher-groups.patch</code></pre><p>这边 patch 的作用分别是：<strong>优化 X25519 的效率，优化 ECDSA 效率，修复安全漏洞，启用 boringSSL 等价组</strong>。</p><p>打了补丁以后可以在 Nginx 配置中类似如下的写法，根据浏览器的优先情况启用合适的加密算法，达到性能和安全性的统一：</p><pre><code>ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
ssl_ciphers '[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305]:[ECDHE-RSA-AES128-GCM-SHA256|ECDHE-RSA-CHACHA20-POLY1305]:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:AES128-SHA';
ssl_ecdh_curve X25519:prime256v1:secp384r1;
ssl_prefer_server_ciphers on;</code></pre><h3>选用 Patched OpenSSL 1.0.2n</h3><pre><code>git clone https://github.com/S8Cloud/sslpatch.git
wget https://www.openssl.org/source/openssl-1.0.2o.tar.gz &amp;&amp; tar zxf openssl-1.0.2o.tar.gz &amp;&amp; rm openssl-1.0.2o.tar.gz &amp;&amp; cd openssl-1.0.2o
patch -p1 &lt; ../sslpatch/OpenSSL1.0.2o-chacha20-poly1305-draft.patch
patch -p1 &lt; ../sslpatch/OpenSSL1.0.2o-cache-timing-rsa-key-gen.patch
./config &amp;&amp; cd ..</code></pre><p>这边 patch 的作用是添加了 <code>draft-chacha20</code> 加密方式，因为主流的 ssl 库都取消了 <code>draft-chacha20</code> 的支持，然而很多安卓浏览器（版本低于 Android 7）都只支持 <code>draft-chacha20</code> 加密，为了兼容这类浏览器，建议使用此 patch。</p><p>必须要注意的是，<code>openssl 1.0.2o</code> 不支持 <code>TLSv1.3</code> 与 <code>x25519</code>。同时如果你需要使用 <code>lua-nginx</code> 的话，兼容最好的就是 <code>OpenSSL 1.0.2o</code>。</p><p>打了补丁以后可以在 Nginx 配置中类似如下的写法：</p><pre><code>ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers                 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-draft-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:AES128-SHA';
ssl_ecdh_curve              prime256v1:secp384r1;
ssl_prefer_server_ciphers   on;</code></pre><h2>Nginx 的一些模块</h2><h3>Zlib 库</h3><blockquote>这里选择了 Cloudflare 魔改版的 zlib，显著提高了性能，仅仅适用于 Nginx/PHP 相关的应用，不适合替换系统的 zlib 库</blockquote><pre><code>git clone https://github.com/cloudflare/zlib &amp;&amp; cd zlib &amp;&amp; ./configure --64</code></pre><h3>Pcre 库</h3><pre><code>wget -c https://ftp.pcre.org/pub/pcre/pcre-8.42.zip &amp;&amp; unzip pcre-8.42.zip &amp;&amp; rm pcre-8.42.zip &amp;&amp; cd pcre-8.42
./configure --enable-utf8 --enable-unicode-properties --enable-pcre16 --enable-pcre32 --enable-pcregrep-libz --enable-pcregrep-libbz2 --enable-pcretest-libreadline --enable-jit
make &amp;&amp; make install</code></pre><h3>Brotli 模块</h3><blockquote>Google 开发的网页压缩模块，相比 Gzip 提升显著，选取 Google 员工维护的最新版</blockquote><pre><code>git clone https://github.com/eustas/ngx_brotli.git
cd ngx_brotli &amp;&amp; git submodule update --init --recursive &amp;&amp; cd ../</code></pre><h3>Pagespeed 模块</h3><blockquote>Google 推出的网站加速模块，主要做了 html、js、css 合并压缩，图片压缩懒加载等等功能，如果你纯单机部署不对静态文件使用 cdn 等话用处还是蛮大的。</blockquote><pre><code>wget -c https://github.com/apache/incubator-pagespeed-ngx/archive/v1.13.35.2-stable.zip &amp;&amp; unzip v1.13.35.2-stable.zip &amp;&amp; rm v1.13.35.2-stable.zip &amp;&amp; cd incubator-pagespeed-ngx-1.13.35.2-stable
wget -c https://dl.google.com/dl/page-speed/psol/1.13.35.2-x64.tar.gz &amp;&amp; tar -xzvf 1.13.35.2-x64.tar.gz &amp;&amp; rm 1.13.35.2-x64.tar.gz &amp;&amp; cd ../ &amp;&amp; mv incubator-pagespeed-ngx-1.13.35.2-stable pagespeed </code></pre><h3>Jemalloc 内存压缩模块</h3><blockquote>选取 <code>5.1.0</code> 最新版本显著增强性能</blockquote><pre><code>wget -c https://github.com/jemalloc/jemalloc/releases/download/5.1.0/jemalloc-5.1.0.tar.bz2 &amp;&amp; tar xjf jemalloc-5.1.0.tar.bz2 &amp;&amp; rm jemalloc-5.1.0.tar.bz2 &amp;&amp; cd jemalloc-5.1.0 &amp;&amp; ./configure 
make -j2 &amp;&amp; make install
echo '/usr/local/lib' &gt; /etc/ld.so.conf.d/local.conf 
ldconfig &amp;&amp; cd ../</code></pre><h3>CT 模块</h3><p><strong>如果你的证书支持 <code>Certificate Transparency</code> 那么就不需要编译该模块</strong></p><blockquote>选用 <code>master</code> 最新版以支持 TLSv1.3</blockquote><pre><code>git clone https://github.com/grahamedgecombe/nginx-ct.git</code></pre><blockquote>选用 <code>v1.3.2</code> 如果你不需要 TLSv1.3</blockquote><pre><code>wget https://github.com/grahamedgecombe/nginx-ct/archive/v1.3.2.tar.gz &amp;&amp; tar zxf v1.3.2.tar.gz &amp;&amp; rm v1.3.2.tar.gz</code></pre><h3>Devel Kit 模块</h3><blockquote>扩展了 nginx 的模块引擎，一些模块基于此开发</blockquote><pre><code>git clone https://github.com/simplresty/ngx_devel_kit.git</code></pre><h3>Headers More 模块</h3><blockquote>用于隐藏和修改各种服务端标识，推荐安装</blockquote><pre><code>git clone https://github.com/openresty/headers-more-nginx-module.git</code></pre><h3>Cache Purge 模块</h3><blockquote>清理服务端缓存，原版已经很久没有更新，这里选择 <code>nginx-modules</code> 接手的版本</blockquote><pre><code>git clone https://github.com/nginx-modules/ngx_cache_purge.git</code></pre><h3>Substitutions Filter 模块</h3><blockquote>反代网站必备</blockquote><pre><code>git clone https://github.com/yaoweibin/ngx_http_substitutions_filter_module.git</code></pre><h3>ModSecurity 模块</h3><blockquote>WAF 防火墙模块，编译时间很长，运行也会消耗一些性能。<p></p><p>更新到 V3 正式版，安装方法和 V2 版有所不同。</p></blockquote><pre><code>pip install pip -U &amp;&amp; pip install ssdeep
git clone -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity.git
git clone https://github.com/SpiderLabs/ModSecurity-nginx.git
cd ModSecurity &amp;&amp; git submodule update --init --recursive
./build.sh &amp;&amp; ./configure
make &amp;&amp; make install</code></pre><h3>NJS 模块</h3><blockquote>Nginx 开发的基于 <code>ECMAScript 5.1</code> 的 JavaScript 脚本模块</blockquote><pre><code>git clone https://github.com/nginx/njs.git</code></pre><h3>LUA 模块</h3><blockquote>用 lua 脚本扩展 nginx，非常强大的模块，如果重度依赖 lua-nginx 不妨使用 <strong><a href="https://openresty.org/cn/linux-packages.html">openresty</a></strong></blockquote><pre><code>https://github.com/openresty/luajit2.git &amp;&amp; cd luajit2
make &amp;&amp; make install &amp;&amp; cd ..
wget https://github.com/openresty/lua-nginx-module/archive/v0.10.13.tar.gz &amp;&amp; tar zxf v0.10.13.tar.gz &amp;&amp; rm v0.10.13.tar.gz
export LUAJIT_LIB=/usr/local/lib
export LUAJIT_INC=/usr/local/include/luajit-2.1/</code></pre><h3>Echo 模块</h3><blockquote>用于在网页输出一些简单信息，调试比较实用</blockquote><pre><code>git clone https://github.com/openresty/echo-nginx-module.git</code></pre><h3>GeoIP2 模块</h3><blockquote>Nginx 包中自带了比较老的 GeoIP 模块，在编译参数中添加 <code>--with-http_geoip_module=dynamic --with-stream_geoip_module=dynamic</code> 即可。<br />但是这个老的 MaxMind GeoIP 库即将停止维护，新的库对应的模块即为 GeoIP2</blockquote><pre><code>add-apt-repository ppa:maxmind/ppa
apt update &amp;&amp; apt install -y libmaxminddb0 libmaxminddb-dev mmdb-bin
git clone https://github.com/leev/ngx_http_geoip2_module.git</code></pre><h3>Auth PAM 模块</h3><blockquote>将 PAM 用做 nginx <code>simple http authentication</code> 增强安全性</blockquote><pre><code>git clone https://github.com/sto/ngx_http_auth_pam_module.git</code></pre><h3>VTS 模块</h3><blockquote>更加详细的 nginx 统计与分析模块</blockquote><pre><code>git clone https://github.com/vozlt/nginx-module-vts.git </code></pre><h3>Upstream Fair 模块</h3><blockquote>非常古老的模块，用于负载均衡的，现在基本上用处不大了，不建议安装</blockquote><pre><code>git clone https://github.com/nginx-modules/nginx-upstream-fair.git</code></pre><h3>Upload Progress 模块</h3><blockquote>用于标示与 Upstrem post 上传状态的模块</blockquote><pre><code>git clone https://github.com/masterzen/nginx-upload-progress-module.git</code></pre><h3>DavExt 模块</h3><blockquote>用于强化 nginx 自带 <code>WebDAV</code> 组件的模块</blockquote><pre><code>git clone https://github.com/arut/nginx-dav-ext-module.git</code></pre><h3>RTMP 模块</h3><blockquote>做流媒体播放必备模块</blockquote><pre><code>git clone https://github.com/arut/nginx-rtmp-module.git</code></pre><h3>FancyIndex 模块</h3><blockquote>实现比较好看的目录索引功能，实际上也不算多好看</blockquote><pre><code>git clone https://github.com/aperezdc/ngx-fancyindex.git</code></pre><h2>编译安装 Nginx</h2><h3>下载 Nginx 包并打上 Cloudflare 的 patch</h3><pre><code>wget https://codeload.github.com/nginx/nginx/legacy.zip/master -O nginx.zip &amp;&amp; unzip nginx.zip &amp;&amp; mv nginx-nginx-* nginx-latest &amp;&amp; rm nginx.zip &amp;&amp; cd nginx-latest &amp;&amp; cp auto/configure .
patch -p1 &lt; ../sslpatch/Nginx-cloudflare-combined-dcc.patch</code></pre><h3>隐藏 Nginx 版本号（可选）</h3><pre><code>sed -i 's@#define NGINX_VERSION.*$@#define NGINX_VERSION &quot;2.4.33&quot;@' src/core/nginx.h
sed -i &quot;s#\&quot;NGINX\&quot;#\&quot;Apache\&quot;#&quot; src/core/nginx.h
sed -i &quot;s#\&quot;nginx/\&quot;#\&quot;Apache/\&quot;#&quot; src/core/nginx.h
sed -i 's@#define NGINX_VER.*NGINX_VERSION$@#define NGINX_VER &quot;Apache/&quot; NGINX_VERSION@' src/core/nginx.h
sed -i 's@Server: nginx@Server: Apache@' src/http/ngx_http_header_filter_module.c
sed -i &quot;s#\&quot;&lt;hr&gt;&lt;center&gt;nginx&lt;\/center&gt;\&quot;#\&quot;&lt;hr&gt;&lt;center&gt;Apache&lt;\/center&gt;\&quot;#&quot; src/http/ngx_http_special_response.c
sed -i &quot;s#\&quot;server\&quot;, \&quot;nginx\&quot;#\&quot;server\&quot;, \&quot;Apache\&quot;#&quot; src/http/v2/ngx_http_v2_filter_module.c</code></pre><h3>根据需求修改 Nginx 编译参数，然后编译安装</h3><p><strong>这边将大部分模块安装成 <code>dynamic module</code> 的形式，在调用的时候在 <code>nginx.conf</code> 中添加 <code>load_module modules/xxx-module.so</code> 即可</strong></p><pre><code>./configure --build=nginx-dcc --with-cc-opt='-I/usr/local/include -m64 -march=native -DTCP_FASTOPEN=23 -g -O3 -fstack-protector-strong -flto -fuse-ld=gold --param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wno-unused-parameter -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -gsplit-dwarf' \
--with-ld-opt='-L/usr/local/lib -ljemalloc -Wl,-z,relro -Wl,-rpath,/usr/local/lib -Wl,-z,now -fPIC' \
--prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \
--user=www-data --group=www-data \
--with-compat --with-file-aio --with-threads --with-poll_module --with-select_module --with-http_ssl_module --with-http_v2_module --with-http_v2_hpack_enc --with-http_spdy_module \
--with-http_realip_module --with-http_addition_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_sub_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_degradation_module --with-http_secure_link_module --with-http_slice_module --with-http_stub_status_module --with-http_dav_module --with-http_mp4_module --with-http_random_index_module \
--with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_ssl_preread_module \
--with-mail=dynamic --with-mail_ssl_module \
--with-libatomic --with-zlib --with-pcre --with-pcre-jit \
--with-openssl=../openssl-1.1.1-pre8 --with-openssl-opt='enable-tls13downgrade enable-ec_nistp_64_gcc_128 enable-weak-ssl-ciphers no-ssl3 zlib -march=native -ljemalloc -Wl,-flto' --add-module=../ngx_brotli --add-dynamic-module=../njs/nginx --add-dynamic-module=../ngx_cache_purge --add-dynamic-module=../headers-more-nginx-module --add-dynamic-module=../ModSecurity-nginx --add-dynamic-module=../pagespeed --add-dynamic-module=../ngx_http_substitutions_filter_module 

screen make -j2 &amp;&amp; make install</code></pre><h3>查看 Nginx 版本和参数和安装目录</h3><pre><code>nginx -V
whereis nginx</code></pre><h2>创建 Nginx 系统服务</h2><pre><code>mkdir -p /var/lib/nginx/body
vi /lib/systemd/system/nginx.service</code></pre><p>如下填写：</p><pre><code>[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'
ExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload
ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid
TimeoutStopSec=5
KillMode=mixed

[Install]
WantedBy=multi-user.target</code></pre><p>开启 Nginx 服务</p><pre><code>sudo systemctl enable nginx.service
sudo systemctl start nginx.service</code></pre>]]></content>
        
        <summary type="html">
            
            默认安装的 Nginx 在大部分情况下都是足够使用的，但有的时候我们还需要其他一些高级的东西，这个时候就需要编译安装啦。这个部分比较繁琐，纯小白不看也没关系。东西比较多，我们创建一个文件夹单独存放，所有的操作都在该文件夹下操作。首先安装必备的模块apt update &amp;amp;
            
        </summary>
        
    </entry>
    
    <entry>
        <title>办到了年轻人的第一张 VISA 卡</title>
        <link href="https://blog.lwl12.com/read/too-young-visa.html"/>
        <id>https://blog.lwl12.com/read/too-young-visa.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-11-10T10:05:37+00:00</published>
        <updated>2017-11-10T10:05:37+00:00</updated>
        
        <content type="html"><![CDATA[<p>办到了年轻人的第一张 VISA 卡🌚</p>]]></content>
        
        <summary type="html">
            
            办到了年轻人的第一张 VISA 卡🌚
            
        </summary>
        
        <category term="记录"/>
        
        <category term="VISA"/>
        
        <category term="借记卡"/>
        
        <category term="银行"/>
        
    </entry>
    
    <entry>
        <title>MDx：轻于形，悦于心</title>
        <link href="https://flyhigher.top/develop/788.html"/>
        <id>https://flyhigher.top/develop/788.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-11-06T12:56:58+00:00</published>
        <updated>2017-11-06T12:56:58+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>MDx，一款轻快、优雅且强大的 Material Design 风格 WordPress 主题</p></blockquote>
<p>欢迎来到 MDx 的世界。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/11/top.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/11/top.jpg" /></a></p>
<p>English Version &amp; English Docs are being translated.</p>
<blockquote><p>目前 MDx 最新版本 v1.7.10。<br />
请从 <a href="https://mdx.flyhigher.top" target="_blank">这里</a> 下载 MDx 的最新版本。</p></blockquote>
<blockquote><p>MDx QQ 交流群687577787，欢迎来水~</p></blockquote>
<h3>Feature 特性</h3>
<ul>
<li>完全的 Material Design 风格，每一个像素都赏心悦目</li>
<li>2种首页样式, 4种文章列表样式 &amp; 3种文章页样式随意切换，未来还可能增加更多</li>
<li>19种主题颜色 &amp; 16种强调色随心搭配，还有夜间模式</li>
<li>SEO 友好，支持 Facebook / Twitter 结构化卡片分享</li>
<li>丰富的设置选项</li>
<li>一键生成分享图片，分享文章更美观</li>
<li>内置4种短代码，与主题样式完美契合</li>
<li><strong>独家功能</strong> 实时搜索，搜索栏会随用户输入实时反馈搜索结果</li>
<li><strong>独家功能</strong> 不仅可以生成当前页面二维码，方便地转移到其他设备上阅读，还可以在转移时同步阅读进度</li>
<li>多语言支持<br />
<blockquote><p>英语翻译已在进行中</p></blockquote>
</li>
<li>完全响应式</li>
<li>自带简单的 ImgBox</li>
<li>…</li>
</ul>
<h3>Demo 演示</h3>
<p>此博客即使用了 MDx 主题。要了解 MDx 对于文章内容的展示情况，请查看 <a href="https://flyhigher.top/how-mdx-show-posts" target="_blank">这个页面</a> 。</p>
<h3>Render 渲染</h3>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2017/11/det.jpg" /></p>
<h3>License 许可证</h3>
<p>Open sourced under the GPL v3.0 license.</p>
<p>根据 GPL V3.0 许可证开源。</p>
<h3>Docs 文档</h3>
<p><a href="https://mdxdoc.flyhigher.top/" target="_blank">中文文档（为国内网络优化）</a><br />
<a href="https://mdxdocs.flyhigher.top/" target="_blank">MDx Docs(Translating)</a><br />
English Docs are being translated.</p>
<h3>Download 下载</h3>
<p>You can download MDx <a href="https://mdx.flyhigher.top" target="_blank">here</a>.</p>
<p>你可以前往 <a href="https://mdx.flyhigher.top" target="_blank">此处</a> 下载MDx。</p>
<h3>Github</h3>
<p>
	<div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com" target="_blank"><i></i></a>
		</div>
		<div>
		yrccondor / mdx
		</div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com%2Fyrccondor%2Fmdx" target="_blank"><i></i></a>
		</div>
	</div>
	<br />
当然，求Star!</p>
<h3>About 关于</h3>
<p>感谢你对于 MDx 的兴趣。无论如何，我都诚挚地邀请你试试这款主题。MDx 是免费发布的，你不需要为此付出任何费用。<strong>但是，你必须保留底部的“Theme: MDx By AxtonYao”标识。</strong></p>
<p>然而，需要注意的是，这款主题才公开发布不久，尽管我已经做了详尽的测试，但它可能仍有问题。请不要担心，遇到主题问题请联系我，一旦确认我会尽快修复。</p>
<p>我仅仅只是一名在校高中生，开发了 MDx 主题之后已经没有精力与时间开发新的主题，因此在接下来较长的一段时间内，我会持续地维护并更新 MDx 主题。</p>
<p>很抱歉的是，由于这是我第一次尝试完成如此庞大的项目，我很没有经验地使用了一些错误的开发方法——比如，变量命名，或者 CSS 选择器 的命名，都没有统一的标准。在接下来的更新中，我会不断地优化代码。</p>
<p>Anyway, keep learning.</p>
<p>作为一名高中生，我一人难以支撑服务器的运营费用。如果你有兴趣，不妨赞助我一下，以支持我完成更好的开发。</p>
<p><img src="https://img.flyhigher.top/wp-content/uploads/2017/11/wxx-300x300.jpg" /><br />
<img src="https://img.flyhigher.top/wp-content/uploads/2017/11/4-226x300.jpg" /></p>
<p>感谢！</p>
<blockquote><p>捐助者列表展示于 <a href="https://flyhigher.top/about">关于</a>。</p></blockquote>]]></content>
        
        <summary type="html">
            
            MDx，一款轻快、优雅且强大的 Material Design 风格 WordPress 主题 欢迎来到 MDx 的世界。  English Version &amp;amp; English Docs are being translated. 目前 MDx 最新版本 v1.7.10
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="Material Design"/>
        
        <category term="MDx"/>
        
        <category term="主题"/>
        
    </entry>
    
    <entry>
        <title>开一个飞利浦的妖刀</title>
        <link href="https://www.isthnew.com/archives/245C7QJSB.html"/>
        <id>https://www.isthnew.com/archives/245C7QJSB.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-11-06T11:23:57+00:00</published>
        <updated>2017-11-06T11:23:57+00:00</updated>
        
        <content type="html"><![CDATA[<p>由于某些众所周知的原因(qong)，我的笔记本显示器是TN屏的，不过大多数的笔记本IPS屏幕也是辣鸡。所以有些时候用Lr、Ps这些处理个照片非常恼火，和在手机上看的色差太大了，手机屏幕毕竟是小而贵，再差也差不到哪里去。所以又迫于穷，买了费力浦的妖刀245C7QJSB，可以说</p>]]></content>
        
        <summary type="html">
            
            由于某些众所周知的原因(qong)，我的笔记本显示器是TN屏的，不过大多数的笔记本IPS屏幕也是辣鸡。所以有些时候用Lr、Ps这些处理个照片非常恼火，和在手机上看的色差太大了，手机屏幕毕竟是小而贵，再差也差不到哪里去。所以又迫于穷，买了费力浦的妖刀245C7QJSB，可以说
            
        </summary>
        
        <category term="不能无聊"/>
        
        <category term="买买买"/>
        
    </entry>
    
    <entry>
        <title>震惊！天翼校园客户端被植入病毒</title>
        <link href="https://dcc.cat/f-young.html"/>
        <id>https://dcc.cat/f-young.html</id>
        
        <author>
            <name>DCC</name>
        </author>
        
        <published>2017-11-02T08:30:00+00:00</published>
        <updated>2017-11-02T08:30:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>天翼校园客户端被植入病毒!</strong><br /><strong>中毒电脑被用来“挖矿”</strong></p><p>金山毒霸安全实验室监测发现，“天翼校园客户端”被植入后门病毒......<br />​​​今天上午，金山毒霸安全实验室监测发现，中国电信江苏分公司校园门户网站（pre.f-young.cn）提供下载的“天翼校园客户端”被植入后门病毒，该后门病毒接受黑客远程指令，利用中毒电脑刷广告流量和挖矿生产“门罗币”。</p><p><img src="https://wx3.sinaimg.cn/large/0068hA7Dgy1fl2pr16u5tj30jx0bo0vd.jpg" /></p><p>“天翼校园客户端”安装包运行后，后门病毒即被植入电脑。该病毒会访问远程C&amp;C服务器存放的广告配置文件，然后构造隐藏IE浏览器窗口执行暗刷流量，同时也会释放门罗币挖矿者病毒进行挖矿。</p><p>安装包整体逻辑如下图所示：</p><p><img src="https://wx2.sinaimg.cn/large/0068hA7Dgy1fl2pra2u28j30fa0aswes.jpg" /></p><p>天翼校园客户端安装后，安装目录中会释放speedtest.dll文件，speedtest.dll扮演病毒“母体”角色。执行下载、释放其他病毒模块，最终完成刷广告流量和实现挖矿。</p><p><img src="https://wx1.sinaimg.cn/large/0068hA7Dgy1fl2prj12pjj30pj04omxf.jpg" /></p><p>解密后的广告刷量模块被执行后，它会创建一个隐藏的IE窗口，读取云端指令，后台模拟用户操作鼠标、键盘点击广告，同时“屏蔽”声卡播放广告页面中的声音，防止刷广告流量时用户只闻其声不见其形而感到奇怪。</p><p>金山毒霸安全实验室监测发现该病毒下载的广告链接约400余个，由于广告页面被病毒隐藏，并没有在用户电脑端展示出来，广告主白白增加了流量成本。受该病毒点击欺诈影响的广告主不乏腾讯、百度、搜狗、淘宝、IT168、风行网等等。</p><p>通过分析病毒的挖矿模块，工程师们发现天翼校园客户端挖的是“门罗币”。门罗币，是一种模仿“比特币”出现的数字虚拟币，利用电脑硬件资源挖虚拟币一般被称为“挖矿”。</p><p>目前，一枚比特币的价格已达4万元人民币，一枚门罗币的价格接近500元。受利益驱动，众多病毒黑产从业人员制作挖矿病毒广泛传播，让众多受害者电脑沦为不法分子的“矿工”。</p><p>当病毒开始“挖矿”时，用户能观察到计算机CPU资源占用飙升，电脑性能变差，发热量上升。电脑风扇此时会高速运行，电脑噪音也会随之增加。</p><p><img src="https://wx4.sinaimg.cn/large/0068hA7Dgy1fl2pryrhnyj30m80go77t.jpg" /></p><p>​金山毒霸安全实验室对病毒进行溯源分析，发现带有该后门病毒的安装包并不只有“天翼校园客户端”，排查之后，还发现签名为“中国电信股份有限公司”的一款农历日历（Chinese Calendar），同样存在该后门病毒。</p><p>分析结果令人震惊，安全厂商们普遍认为大型互联网公司签名的程序是安全的。中国电信江苏分公司的官方程序是如何被植入病毒，目前尚不得而知。</p><h2>防范措施</h2><p><strong>建议江苏省电信校园客户删除 <code>“天翼校园客户端”</code> 安装目录中的 <code>speedtest.dll</code> 文件，也呼吁中国电信江苏省分公司尽快检查所涉软件，替换网上存在的带毒版本。</strong></p><blockquote>本文来源：金山安全实验室，火绒安全实验室报道</blockquote>]]></content>
        
        <summary type="html">
            
            天翼校园客户端被植入病毒!中毒电脑被用来“挖矿”金山毒霸安全实验室监测发现，“天翼校园客户端”被植入后门病毒......​​​今天上午，金山毒霸安全实验室监测发现，中国电信江苏分公司校园门户网站（pre.f-young.cn）提供下载的“天翼校园客户端”被植入后门病毒，该后门病
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Camera Raw 10.0 更新</title>
        <link href="https://www.isthnew.com/archives/camera-raw-10.html"/>
        <id>https://www.isthnew.com/archives/camera-raw-10.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-11-02T05:09:12+00:00</published>
        <updated>2017-11-02T05:09:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>Adobe 家的瑞士军刀更新到了2018版本，原来的 Lightroom CC 改名为 Lightroom Classic CC 。而 Lightroom CC 的名字给了一个新工具，可以认为是 Lr 的简化版本，突出的云同步的理念。 Lightroom Classic</p>]]></content>
        
        <summary type="html">
            
            Adobe 家的瑞士军刀更新到了2018版本，原来的 Lightroom CC 改名为 Lightroom Classic CC 。而 Lightroom CC 的名字给了一个新工具，可以认为是 Lr 的简化版本，突出的云同步的理念。 Lightroom Classic
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="Adobe"/>
        
        <category term="Camera Raw"/>
        
        <category term="PS"/>
        
    </entry>
    
    <entry>
        <title>一键点亮你的网易云音乐</title>
        <link href="https://i-meto.com/lighten-netease-music/"/>
        <id>https://i-meto.com/lighten-netease-music/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-11-01T16:00:00+00:00</published>
        <updated>2017-11-01T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>网易云音乐是很好用，但禁不住一直丢版权音乐。</p>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/netease_music.png" /></p>
<p>眼看着歌单一片一片地灰掉，用 PHP 写了一个搬运脚本，妈妈再也不用担心我的网易云音乐变灰了。</p>
<p>脚本地址：<a href="https://github.com/metowolf/script/tree/master/neteasemusic">https://github.com/metowolf/script/tree/master/neteasemusic</a><br />
里面那个 Meting 有点旧，自己换个新的就行了</p>
<h2>食用指南</h2>
<p>下载 <a href="https://github.com/metowolf/script/tree/master/neteasemusic">GitHub</a> 目录下的所有文件</p>
<p>在终端执行 <code>php run.php</code>，没错就是这么简单。</p>
<p>最后把 <code>download</code> 目录下的音乐文件扔到音乐云盘上去就大功告成了。</p>
<h2>效果图</h2>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/music_terminal.png" /><br />
<img src="https://image.static.i-meto.com/uploads/2017/12/music_download.png" /></p>
<h2>相关项目</h2>
<ul>
<li><a href="https://github.com/metowolf/Meting">Meting FrameWork</a></li>
</ul>
</div>]]></content>
        
        <summary type="html">
            
            网易云音乐是很好用，但禁不住一直丢版权音乐。  眼看着歌单一片一片地灰掉，用 PHP 写了一个搬运脚本，妈妈再也不用担心我的网易云音乐变灰了。 脚本地址：https://github.com/metowolf/script/tree/master/neteasemusic 里面
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Typecho插件：Comment2Telegram</title>
        <link href="https://www.iwch.me/archives/661.html"/>
        <id>https://www.iwch.me/archives/661.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-10-30T06:30:00+00:00</published>
        <updated>2017-10-30T06:30:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>Comment2Telegram：一个通过Telegram推送评论通知的Typecho插件。</p><h2>下载</h2><p>GitHub：<a href="https://github.com/Vrzl/typecho-plugin-Comment2Telegram" target="_blank">Vrzl/typecho-plugin-Comment2Telegram</a><del>（无耻求Star</del></p><h2>安装</h2><ol>
<li>下载压缩包并解压</li>
<li>修改文件夹名为Comment2Telegram</li>
<li>上传文件夹至Typecho的/usr/plugins目录下</li>
<li>在控制台的插件管理中启用插件</li>
</ol><h2>使用方法</h2><p>在Telegram中找到<a href="https://t.me/kannakamui_bot" target="_blank">@kannakamui_bot</a>这个Bot，发送命令：<code>/setnotice</code></p><p>Bot将会返回一个token，请将这个token复制到本插件设置页面的输入框中，然后保存设置即可使用。</p><h2>效果图</h2><p><img src="https://static.yecdn.com/static/blog/post/661/screenshot-0.png" /></p><h2>感谢</h2><p>感谢<a href="https://t.me/VolioLiu" target="_blank">Volio</a>大佬提供的Bot支持OωO</p></div>]]></content>
        
        <summary type="html">
            
             Comment2Telegram：一个通过Telegram推送评论通知的Typecho插件。下载GitHub：Vrzl/typecho-plugin-Comment2Telegram（无耻求Star安装  下载压缩包并解压  修改文件夹名为Comment2Telegram  
            
        </summary>
        
    </entry>
    
    <entry>
        <title>为 Windows 颜色管理正名</title>
        <link href="https://www.isthnew.com/archives/windows-color-management.html"/>
        <id>https://www.isthnew.com/archives/windows-color-management.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-10-20T12:46:15+00:00</published>
        <updated>2017-10-20T12:46:15+00:00</updated>
        
        <content type="html"><![CDATA[<p>通常会听到一种声音，专业设计师使用 macOS 是因为 macOS 的颜色管理比 Windows 强很多，直到 iOS 拍摄的照片默认使用 Display P3 色域保存之后，很多人也惯性的认为 Windows 在显示 P3</p>]]></content>
        
        <summary type="html">
            
            通常会听到一种声音，专业设计师使用 macOS 是因为 macOS 的颜色管理比 Windows 强很多，直到 iOS 拍摄的照片默认使用 Display P3 色域保存之后，很多人也惯性的认为 Windows 在显示 P3
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="色彩管理"/>
        
        <category term="srgb"/>
        
        <category term="macos"/>
        
        <category term="windows"/>
        
    </entry>
    
    <entry>
        <title>1024 天成就达成！</title>
        <link href="https://blog.lwl12.com/read/1024-days.html"/>
        <id>https://blog.lwl12.com/read/1024-days.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-10-16T10:27:04+00:00</published>
        <updated>2017-10-16T10:27:04+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/1024-days.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/10/Screenshot_20171018104738-1024x165.jpg" /></a></p><p><span><strong>LWL 的自由天空</strong></span></p>
<p><strong>2014.12.28 – 2017.10.16</strong></p>
<p>Made with <span>♥</span> by lwl12</p>
<p><span></span></p>
<p><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/10/Screenshot_20171018104738-1024x165.jpg" /></p>
<p> </p>
<div></div>]]></content>
        
        <summary type="html">
            
            LWL 的自由天空 2014.12.28 – 2017.10.16 Made with ♥ by lwl12     
            
        </summary>
        
        <category term="网站"/>
        
        <category term="LWL 的自由天空"/>
        
        <category term="纪念日"/>
        
    </entry>
    
    <entry>
        <title>NgModule 的作用域</title>
        <link href="https://blog.poi.cat/ngmodule-and-its-scope"/>
        <id>https://blog.poi.cat/ngmodule-and-its-scope</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-10-16T06:10:47+00:00</published>
        <updated>2017-10-16T06:10:47+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><p>在开始聊这个话题之前，先提一个我遇到过问题：假设有一个 <code>SpinnerService</code>，这是一个可以在进行发送 HTTP 请求等异步操作的显示一个加载动画的 Service 。</p><p>这样看来，它应该是每个 Module 和 Component 中都可能用到的一个 Service，那么我们把放到 <code>SharedModule</code> 的 <code>providers</code> 当中。然后在需要这个 <code>SpinnerService</code> 的 Module 中导入这个 <code>SharedModule</code> 即可。代码看起来大概是这样的：</p><pre><code><span>// app/shared/spinner.service.ts</span>
<span>@Injectable</span>()
<span>export</span> <span>class</span> SpinnerService {
  show () { <span>/* code logic */</span> }
  hide () { <span>/* code logic */</span> }
}

<span>// app/shared/shared.module.st</span>
<span>@NgModule</span>({
  providers: [SpinnerService]，
  <span>//other staffs</span>
})
<span>export</span> <span>class</span> SharedModule {}

<span>// app/some/some.module.ts</span>
<span>@NgModule</span>({
  imports: [SharedModule],
  <span>// other staffs</span>
})
<span>export</span> <span>class</span> SomeModule {}
</code></pre><p>代码看起来没什么问题，而且也能正常运行。但是如果你在两个不同的 Component 中分别调用 <code>SpinnerService</code> 中的 <code>show()</code> 和 <code>hide()</code> 函数，你会发现加载动画没有如愿的消失；更近一步，如果在 Service 中有共用的数据的，你会发现两个不同的 Component 中对数据的修改也无法同步。 Component 中的 Service 是由 Module 提供的，所以问题就出在 Module 上。</p><p>有的读者的可能已经猜到了：虽然两个 Module 中会提供一个 <code>SpinnerService</code> ，但是他们不是同一个实例。</p><h2>Dependency Injection</h2><p>在继续解释为什么不是同一个实例的之前，我想先粗略地说一下为什么应该会是同一个实例。这就涉及到一个概念： Dependency Injection ，动态注入。</p><p>以 angular.io 上的例子为例：假设有一个 <code>Car</code> 类，其依赖一个 <code>Engine</code> 类。</p><p>于是你可以这么写（不使用 Dependency Injection ）：</p><pre><code><span>export</span> <span>class</span> Car {
  <span>public</span> engine: Engine;
  <span>constructor</span>() {
    <span>this</span>.engine = <span>new</span> Engine();
  }
}
</code></pre><p>当然也可以这么写（使用 Dependency Injection ）：</p><pre><code><span>export</span> <span>class</span> Car {
  <span>constructor</span>(<span><span>public</span> engine: Engine</span>) {}
}
</code></pre><p>两者看起来区别不大，而且当需要调用 <code>engine</code> 的时候，用法也是相同的。但是后者的好处却有不少：</p><ol><li><p><code>Engine</code> 和 <code>Car</code> 的结构是完全独立的：传入 <code>Car</code> 中的是 <code>Engine</code> 的一个实例而不是在 <code>Car</code> 的新建这个实例。所以如果 <code>Engine</code> 的构造函数发生变化的时候也不需要修改 <code>Car</code> 中的构造函数。</p></li><li><p>因为传入 <code>Car</code> 中的是一个实例，所以可以复用这个实例，减少内存占用。</p></li><li><p>因为传入的只是一个实例，所以甚至可以传入一个虚假用于单元测试的 <code>Engine</code> 。</p></li></ol><p>Angular 通过 Hierarchical Dependency Injectors 实现了上述的 Dependency Injection 。 Hierarchical Dependency Injectors 具体的实现，例如 Service 的复用， Component 的 Injectors 等都是很值得一说的，不过和本文相关性不大，这里按下不表。</p><h2>Providers &amp; Declarations</h2><p>我们知道一个 Module 中可以有 Components ， Directives ， 和 Pipes ，还有 Services 。前三者都是与 HTML 模板相关的，需要放在在 Module 的 <code>declarations</code> 中；后者一般用来处理数据，放在 <code>providers</code> 中。</p><p>那么 <code>providers</code> 和 <code>declarations</code> 的区别是什么呢？其中一个就是两者的作用域不同： <code>providers</code> 中是全局的；而 <code>declarations</code> 则是本地的，只有该 Module 中可以使用。</p><blockquote><p>Services 为什么会是全局的呢？其实很好理解，因为 Services 经过编译之后最后都是生成一个类，在导入或是导出它们的时候都会限定在命名空间内。</p></blockquote><p>所以， Services 应该只在 <code>providers</code> 中出现一次；而其他三者则是在需要的 Module 的 <code>declarations</code> 地方都出现。</p><blockquote><p>当然，在所有出现的地方都需要写一遍也是非常烦杂。这时我们就可以把他们放到一个 <code>SharedModule</code> 的 <code>declarations</code> 和 <code>exports</code> ，最后在需要的 Module 中导入该 <code>SharedModule</code> 即可。</p></blockquote><p>对应到上面的问题，你会发现确实也只有在 <code>SharedModule</code> 的 <code>providers</code> 中出现了 <code>SpinnerService</code> 呀，但是问题还是存在啊。</p><p>其实不止 <code>SharedModule</code> ，导入了 <code>SharedModule</code> 的 <code>SomeModule</code> 相当于也提供了 <code>SpinnerService</code> 。所以在两个 Module 中就会有两个由不同的 Module 提供的，两个不同的 <code>SpinnerService</code>。</p><p>导入拥有提供了 Services 的 Module ，相当与自己提供了相同的 Services 。这样的例子这样的情况你可能早就接触过了：当你在 <code>AppModule</code> 中导入了 <code>HttpModule</code> 之后，你就可以使用 <code>Http</code> 这个全局 Service 来发送 HTTP 请求了。</p><blockquote><p>这里的 <code>AppModule</code> 指 Root Module ，下同。</p></blockquote><p>另一方面，如果一个 Module 既有 Components 也有 Services 时则需要分别对待了：在 <code>AppModule</code> 中导入这个 Module 的时候需要调用 <code>forRoot()</code> ，它返回的是一个 <code>ModuleWithProviders</code>；而在其他的 Module 则是直接导入这个 Module 或者调用 <code>forChild()</code>。例如 <code>RouterModule</code> 就既有 Component <code>&lt;router-outlet&gt;</code> 和 Directive <code>routerLink</code> ，也有 Service <code>ActivatedRoute</code>。</p><h2>Best Practice</h2><p>至此，要解决文章开头的问题可以很简单：将 <code>SpinnerService</code> 放到 <code>AppModule</code> 的 <code>providers</code> 里即可。</p><p>但是，这样的简单粗暴地将每一个 Service 都交由 <code>AppModule</code> 提供的解决方法违反了我们一贯的原则：尽可能保持每个 Moudle 的功能和结构简单。</p><p>所以，我们确实应该将 <code>SpinnerService</code> 移出 <code>SharedModule</code> ，然而也不应该放进 <code>AppModule</code> 而是可以考虑放进一个新建的 <code>CoreModule</code> 中。而这个 <code>CoreModule</code> 也应该作为一个纯粹的只提供 Services 的 Module ，而只在 <code>AppModule</code> 中导入它。</p><blockquote><p>当然，因为只在 <code>AppModule</code> 中导入，所以如果有一些只需要在 <code>AppComponent</code> 中使用的 Component ，如 <code>NavComponent</code> 和 <code>FooterComponent</code> 等也可以考虑放到其中。</p></blockquote><h2>References</h2><ol><li><p>文章中提到了可以使用一个虚假的 Service 用于 Component 的单元测试， <a href="https://angular.io/guide/testing#test-a-component-with-a-dependency">这里</a> 介绍了具体应该怎么做。</p></li><li><p>Angular 的 Hierarchical Dependency Injectors 系统，这是一个很有趣的系统，每一个 Component 都有一个与之对应的可编辑的 Injector 。具体可以查看的 Angular 的官方文档： <a href="https://angular.io/guide/hierarchical-dependency-injection">Hierarchical Dependency Injectors</a> 。</p></li><li><p>写 Angular 应用的一个原则都是保持每一个 Module 的功能和结构的简单和统一，这一点和 Unix 的哲学不谋而合：<strong>Write programs that do one thing and do it well.</strong> 那么我们怎么应该这么设计一个好的 Module 呢？Angular 官方的 NgModule FAQs 中其实给出了 <a href="https://angular.io/guide/ngmodule-faq#feature-modules">答案</a> 。从中我们可以看出，<code>CoreModule</code> 这种只提供 Service 和 <code>SharedModule</code> 这种只提供 Components ，Directives 和 Pipes 的 Module 是目前来说官方认为最好的设计。</p></li></ol>]]></content>
        
        <summary type="html">
            
            前言在开始聊这个话题之前，先提一个我遇到过问题：假设有一个 SpinnerService，这是一个可以在进行发送 HTTP 请求等异步操作的显示一个加载动画的 Service 。这样看来，它应该是每个 Module 和 Component 中都可能用到的一个 Service，那
            
        </summary>
        
        <category term="angular"/>
        
    </entry>
    
    <entry>
        <title>这是最好的时代 这是最坏的时代</title>
        <link href="https://blog.nfz.moe/archives/the-prosperous-china-as-you-wish.html"/>
        <id>https://blog.nfz.moe/archives/the-prosperous-china-as-you-wish.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-10-16T03:29:00+00:00</published>
        <updated>2017-10-16T03:29:00+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>于是他只好保持着沉默，默默地与同样面无表情的她擦肩而过，继续向前走去。他的身影逐渐融入同样安静的灰色人群之中，整个城市都显得寂静极了。——<a href="https://blog.nfz.moe/archives/the-silence-city.html">《寂静之城》</a></p></blockquote><p>——谨以此文献礼十九大。</p><a></a><hr /><ul><li>杨永信电击治疗网瘾</li><li>柴静雾霾调查被封杀</li><li>百度魏则西事件</li><li>巫山童养媳事件</li><li>明经国抗强拆杀人案</li><li>北影性侵事件</li><li>刘国梁事件</li><li>杭州保姆纵火案</li><li>豆瓣关于家庭暴力和自杀的讨论小组被迫雪藏</li><li>广电总局审查同性恋和性有关的视听媒体</li><li>在西安拥有三万粉丝以上的个人微博要备案</li><li>B 站番剧类视频被文化部要求进行内容审查</li><li>某 Hosts 维护人员被刑事拘留</li><li>淘宝被禁止出售日文游戏</li><li>公安在全国范围内开展 “网站一键关停” 演练</li><li>国内各大互联网企业开展党建工作</li><li>唐山收费站阿訇率穆斯林打人事件被封锁</li><li>AcFun 的视听服务被叫停</li><li>袁腾飞《铿锵三人行》被封禁</li><li>Pixiv 遭遇 DNS 污染</li><li><strong>. . . . . .</strong></li><li>山东辱母杀人案</li><li>苏享茂自杀事件</li><li>豫章书院自杀</li><li>暴走大事件因说真话被封</li><li>上海携程亲子园虐童事件</li><li>北京深圳和广州大清理低端人口</li><li>北京红黄蓝幼儿园性侵事件</li></ul><hr /><p>墙最可怕的，并不是我们不再能够访问被封锁的网站，而是它能让几乎一整代的人不再愿意访问被封锁的网站。</p><blockquote><p>XX 被墙前的日子：还好这次 XX 没有被墙 / XX 怎么可能被墙 / 要是 XX 被墙了我就肉身翻墙了<br />XX 被墙时的几天：不要慌是 XX 服务器炸了 / 我这里能上一定是 XX 的问题 / 明明是 XX 主动屏蔽大陆 IP<br />XX 被墙后的一年：没事墙内已经有替代品了现在上起来很方便 / 你不会翻墙吗？ / 抱怨个 P 有本事你肉身翻墙啊</p></blockquote><p>本应是我们应有的权利，却变成了某些人幸免于难的“侥幸”。</p><p>我的同学告诉我，他在 App Store 购买过 <code>Surge</code>，但是他如今已经不愿意再费心了，因为他觉得“没有必要”。<br />实体的墙并不可怕，人心的墙才让人生畏。</p><p>GitHub 因为程序员的抗议，在 2015 年解封了；V2EX 备案后接受国内的规定，在 2015 年解封了。其它的网站呢？<br />魏则西因为被迫只能使用百度搜索而被莆田系医院害死。或许，还会有下一个？</p><hr /><blockquote><p>不需要政府造墙，网民也会自发造墙。这尼玛连做个翻墙软件都要造墙，真是令人叹为观止。这是一个造了几千年墙的保守的农耕民族，缺乏对别人的基本尊重，不愿意分享，喜欢遮遮掩掩，喜欢小圈子抱团，大概这些传统是改不掉了吧。<br />—— <a href="https://github.com/shadowsocks/shadowsocks-windows/issues/293#issuecomment-132253168" target="_blank">shadowsocks 作者 clowwindy 发表于 2015 年</a></p></blockquote><p>“深圳 SS 大规模精准识别” 的消息在算不上很久的之前震动了翻墙圈，虽然没有多久就被证实 <strong>不过是 SSR TG 群内的造谣 </strong>；BreakWa11 和 Madeye 互相编写探测工具 <code>sssniff</code> 的风波还没有停息之时，BreakWa11 便已然成为了网络暴力的目标。这场荒唐的闹剧最终以 SSR 删库收场。<br /> 造谣传谣、相互攻击、网络暴力。这是一场暴民的盛宴。</p><p>你国翻墙圈根本不会死于 GFW。你国翻墙圈会死于内讧。</p><hr /><p>在国内论坛和博客需要备案的规定、和今年七月《网络安全法》的基础上，网信办颁布的新法令，要求国内的评论、跟帖系统必须备案、实名使用，并加以严格监督。就在法令颁布之前，多说 和 网易云跟帖 先后停止了运营。<br />毕竟这是一个 <code>JavaScript</code> 和 <code>RIP</code> 都能触发 “微博反垃圾”、小熊维尼都能影射国家领导人的国度。因实名举报学校而险些被开除、因抱怨食堂饭菜难吃而被行政拘留，言论的口就像绝地求生的毒圈一样越缩越紧。</p><p>无理由、无厘头的审查已经理直气壮。人们随时都可能成为破坏社会和谐气氛的罪人。</p><hr /><p>暴走大事件这一次事件告诉我们，无论是杨永信还是豫章书院，哪怕强大的舆论站在他们的对立面，他们依然能够很滋润的存在着，只是因为他们背后有政府做强大的靠山，强大到能够无视人民的呼声，哪怕国家的政府似乎一直是在“为人民服务”</p><p>——neoFelhz Channel, 17.11.11</p><hr /><p>乌云关闭以后，部分白客开始转黑；更多的黑客也有更多机会入侵更多互联网系统和服务、亦或者是根据发现的 0day 进行勒索。<br />当然，在国内，就算有乌云，上述一切也不会改善太多。在中国畸形的互联网里，网络安全这一块简直就是在搞笑的。<br />网络安全并不是靠公安部强制给服务器安装“安骑士”、中国电信在骨干网封端口、国家建一道全国范围的防火墙就能解决的。</p><p>——neoFelhz Channel, 17.11.16</p><hr /><p>损坏的硬盘永远不能被修复，监控永远在需要它的时候坏掉，警察永远不会公布一针两片是什么，法警永远不会发现幼童有什么异常，媒体的报道永远是造谣，警察永远只会把站出来发声的人关起来，而如今连硬盘都会成为社交平台的违禁词。<br />是的，这盛世如你所愿。<br />救救孩子！</p><p>——neoFelhz Channel, 17.11.29</p><hr /><blockquote><p>中华立国数千年，礼义纲纪，云为得失，皆奉孔子之经，若一弃之，则人皆无主，是非不 止所定，进退不知所守，家无以为家，是大乱之道也。<br />「冒万死以保旧俗，存礼教而护国魂。」</p></blockquote><p>这是最好的时代，这是最坏的时代。<br />这盛世，如你所愿。</p>]]></content>
        
        <summary type="html">
            
            于是他只好保持着沉默，默默地与同样面无表情的她擦肩而过，继续向前走去。他的身影逐渐融入同样安静的灰色人群之中，整个城市都显得寂静极了。——《寂静之城》——谨以此文献礼十九大。杨永信电击治疗网瘾柴静雾霾调查被封杀百度魏则西事件巫山童养媳事件明经国抗强拆杀人案北影性侵事件刘国梁事件
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>从 Material 主题学习开源项目管理</title>
        <link href="https://blog.viosey.com/2017/06/01/how-to-manage-a-open-source-project-from-material/"/>
        <id>https://blog.viosey.com/2017/06/01/how-to-manage-a-open-source-project-from-material/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2017-10-13T13:54:22+00:00</published>
        <updated>2017-10-13T13:54:22+00:00</updated>
        
        <content type="html"><![CDATA[<p>几分钟之前，1.4.0 版本 material 主题正式发布</p>
<a></a>
<p>更新之际，发布此文以回顾这一漫漫旅程。</p>
<p>原文由我的朋友与主题协助开发者 neoFelhz 撰写 <a href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html" target="_blank">从 Material 主题学习开源项目管理的一点技巧</a>，此篇基于原文稍作演绎。</p>
<p>历经半年，眼见项目逐渐成长，眼见项目逐渐规范，最终跻身 Hexo Top3 主题 <a href="https://github.com/viosey/hexo-theme-material" target="_blank"><img src="https://img.shields.io/github/stars/viosey/hexo-theme-material.svg?style=social&amp;label=Star" /></a>，</p>
<h2><a href="https://blog.viosey.com/2017/06/01/how-to-manage-a-open-source-project-from-material/#Commit-格式"></a>Commit 格式</h2><p>Git 的特点是可以记录你文件的往期动态改动记录。对于代码进行版本管理、代码追溯、质量管理时，检索 Commit 日志是非常重要的。所以，如果你的 commit 信息是整齐和有条理的，那么就会方便很多。</p>
<p>我们的 Commit 记录分别记录了提交的类型（新特性、修复还是重构）、改动部分（侧边栏、页脚、图标还是文章页面）和改动和目的。所以我们可以现在很轻松的进行 Code Review（以及精准地抓人来背锅），在发布新版本时也明确知道这个版本都干了什么。</p>
<p>早期 Commit title 为版本号，body 为具体内容<br /><img src="https://qiniu.viosey.com/img/123035.jpg" /><br /><img src="https://qiniu.viosey.com/img/122925.jpg" /></p>
<p>从 <a href="https://github.com/viosey/hexo-theme-material/commit/40278ed1292e782cabaaec76b6d88d7a2ce8ac12" target="_blank"><code>40278ed1292e782cabaaec76b6d88d7a2ce8ac12</code></a> 之后使用了新的 commit 信息规范。<br /><img src="https://qiniu.viosey.com/img/123348.jpg" /></p>
<p>想要知道我们的 commit 信息规范，可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Commit-message-format" target="_blank">hexo-theme-material - Contributing Wiki - Commit message format</a> 以了解我们每一次 commit 记录的详细含义和规范。</p>
<h2><a href="https://blog.viosey.com/2017/06/01/how-to-manage-a-open-source-project-from-material/#Branches-管理"></a>Branches 管理</h2><p>有的时候，我们不得不面临一点「危机」—— 新加的功能或者特性实在太过冒险，最后出了严重的问题。<br />虽然 Git 提供了 Revert 功能，可以方便的直接回归某条 commit 时的代码状态。但是有一点问题就是你之前的成果都被推倒。<br />如果不 Revert，那么在你一条条 commit 来修复 Bug 和 push 到远程仓库之前你云端的仓库上的代码都是有问题的，而且对别人的协同开发造成不必要的麻烦。</p>
<p>正确做法是把有风险和较大的改动都要新建一个分支进行管理，在新的分支里进行提交。当功能已经完善以后，把分支 Pull Rquest 合并回主分支。这样，就算其它分支改残了，主分支依然是合理和完美的。而且，不同的人协同开发时，可以尽量用不同的分支，互不冲突。</p>
<p>从 <a href="https://github.com/viosey/hexo-theme-material/commit/7cd11ad840317991bdee7997bf66157634b17950" target="_blank"><code>7cd11ad840317991bdee7997bf66157634b17950</code></a> 开始，Material 主题的开发中，我们学习谷歌 Chrome，引入了 canary 的概念。在 Material 主题的仓库中，master 分支被高度保护，所有 PR 都必须经过 两个以上的项目参与者 Review 后才能入库，所以 master 分支是高度稳定的正式版本。以 master 为基础，我们 fork 出一份 canary 分支，用来存放所有未经过完善测试的代码。然后当需要作出较大改动或者重做一个新功能时，再以 canary 分支为基础 fork 一份新的分支进行开发，开发完毕以后再 Pull Request 合并回 canary 分支。当一定阶段的开发结束以后，会有项目参与者参与对 canary 分支的代码进行功能性测试。当验收完毕以后，canary 分支最后再会合并回 master。</p>
<p>想要知道我们的 Branch 命名的含义，可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Branch-Name-Format" target="_blank">hexo-theme-material - Contributing Wiki - Branch Name Format</a>。</p>
<h2><a href="https://blog.viosey.com/2017/06/01/how-to-manage-a-open-source-project-from-material/#Changelog-更新日志"></a>Changelog 更新日志</h2><p>当一个阶段的开发以后，我们就会推出更新日志。对于开发者，这是对过去一段时间自己开发的总结；对于用户，更新日志是他们了解你开发成果的渠道。<br />一个好的更新日志可以清楚地展现你这一段时间的成果，应该包括你修复的 Bug、你新增的 Feature、你做的改动。如果有必要，你还需要列出你的突破性变更（Breaking Changes，一般这类改动会改变用户过去的操作习惯、或者需要用户对其作出新的配置，以及其它包含不向下兼容的改动）。</p>
<p>从 <a href="https://github.com/viosey/hexo-theme-material/releases/tag/1.2.5" target="_blank"><code>1.2.5</code></a> 开始，Material 主题开始采用新的更新日志格式（灵感来自于 neoFelhz 发布 ROM 包时的经验）。然后我参考 <a href="https://github.com/angular/angular.js/blob/master/CHANGELOG.md" target="_blank">Angular Changelog</a> 完善了更新日志格式。我们用成熟了的更新日志格式发布了 1.2.6。<br />如果想学习 Material 的更新日志规范，可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Change-log-format" target="_blank">hexo-theme-material - Contributing Wiki - Change log format</a>。</p>]]></content>
        
        <summary type="html">
            
            几分钟之前，1.4.0 版本 material 主题正式发布  更新之际，发布此文以回顾这一漫漫旅程。 原文由我的朋友与主题协助开发者 neoFelhz 撰写 从 Material 主题学习开源项目管理的一点技巧，此篇基于原文稍作演绎。 历经半年，眼见项目逐渐成长，眼见项目逐渐
            
        </summary>
        
        <category term="技术向"/>
        
        <category term="开源"/>
        
        <category term="OpenSource"/>
        
        <category term="项目管理"/>
        
    </entry>
    
    <entry>
        <title>使用 BrowserStack 测试前端兼容性</title>
        <link href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/"/>
        <id>https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2017-10-13T13:54:05+00:00</published>
        <updated>2017-10-13T13:54:05+00:00</updated>
        
        <content type="html"><![CDATA[<p>前端开发一直过不去的坎就是浏览器兼容性。<br /><a></a><br />曾经为了开发学院网站装了三四个 <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/" target="_blank">IE 虚拟机</a>，后来阿里也曾推出过 FTS（前端测试服务），但现在已经挂了。最近发现国外有一个建于 2011 年的前端测试服务 BrowserStack。</p>
<p>这是 Wikipedia 上的介绍：</p>
<blockquote>
<p>BrowserStack is a cloud-based cross-browser testing tool that enables developers to test their websites across various browsers on different operating systems and mobile devices, without requiring users to install virtual machines, devices or emulators.</p>
</blockquote>
<h2><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#测试方案"></a>测试方案</h2><p>BrowserStack 有三种测试方案：</p>
<ul>
<li>Live: 最为简单的测试，在 BrowserStack 的首页选择一款浏览器后就可以「真机」测试了。</li>
<li>Automate: 下文会具体介绍这种测试方案，一般搭配 CI 使用，功能最为丰富。</li>
<li>Screenshots: 有桌面端与移动端，可以选择至多 25 款浏览器对某个网页生成截图，适合批量测试兼容性。</li>
</ul>
<h2><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#Automate"></a>Automate</h2><p>顾名思义，Automate 即自动化测试。<br />BrowserStack 的 Automate 脚本支持的语言有</p>
<ul>
<li>Java</li>
<li>Node.js</li>
<li>C#</li>
<li>PHP</li>
<li>Python</li>
<li>Ruby</li>
<li>Perl</li>
</ul>
<p>CI 插件也有 Jenkins, Travis, TeamCity, Bamboo。</p>
<p>我用 Node.js 作为示例，来体验一下 Automate。</p>
<h3><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#0x00"></a>0x00</h3><p>首先创建一个 js 文件，大致如下</p>
<pre><code>var webdriver = require('selenium-webdriver');

// 设置 capabilities
var capabilities = {
    'browserstack.user' : 'Automate 用户名',
    'browserstack.key' : 'Access Key'
}

var driver = new webdriver.Builder().
    usingServer('http://hub-cloud.browserstack.com/wd/hub').
    withCapabilities(capabilities).
    build();

driver.get('测试网页的 URL');
driver.findElement(webdriver.By.name('q')).sendKeys('BrowserStack');
driver.findElement(webdriver.By.name('btnG')).click();

driver.getTitle().then(function(title) {
    console.log(title);
});

driver.quit();
</code></pre>
<h3><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#0x01"></a>0x01</h3><p><code>capabilities</code> 参数是浏览器的属性，只要修改它就可以了。</p>
<p>在 <a href="https://www.browserstack.com/automate/node#setting-os-and-browser" target="_blank">这里</a> 可以选择不同的操作系统、浏览器和分辨率，它会自动生成一个 <code>capabilities</code> 参数，将里面的字段填入 js 文件中的 <code>capabilities</code> 即可。</p>
<p>capabilities 有几个常用的可选字段:</p>
<ul>
<li>browserstack.local: 是否本地测试</li>
<li>project: 项目名称</li>
<li>build: 版本号</li>
</ul>
<p>设置 <code>project</code> 和 <code>build</code> 可以使生成的记录更为规范。<br /><img src="https://qiniu.viosey.com/img/BrowserStack-Automate-Dashboard.png" /></p>
<h3><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#0x02"></a>0x02</h3><p>Node.js 的 Automate 测试需要安装 selenium-webdriver，<br />创建一个文件夹，把刚才的 js 文件放进去，执行</p>
<pre><code>npm install selenium-webdriver
</code></pre><p>等安装完成之后就可以测试了。</p>
<h2><a href="https://blog.viosey.com/2017/04/24/Using-BrowserStack-FTS/#Local-Testing"></a>Local Testing</h2><p>BrowserStack 不仅支持在线测试，还可以本地测试。本地测试有两种方式。</p>
<ol>
<li>仅支持在 Chrome 31+ 或 Firefox 38+ 浏览器进行 Live 测试，，安装 <a href="https://chrome.google.com/webstore/detail/browserstack-local/mfiddfehmfdojjfdpfngagldgaaafcfo?hl=en" target="_blank">Chrome 插件</a> 即可。</li>
<li>浏览器不受限制的 Live 和 Automate 测试。需要先根据不同的操作系统 <a href="https://www.browserstack.com/local-testing#command-line" target="_blank">下载二进制文件</a>，然后执行下载的文件。<blockquote>
<p>例如：macOS 和 Linux：</p>
<pre><code>./BrowserStackLocal --key Access_Key
</code></pre></blockquote>
</li>
</ol>]]></content>
        
        <summary type="html">
            
            前端开发一直过不去的坎就是浏览器兼容性。曾经为了开发学院网站装了三四个 IE 虚拟机，后来阿里也曾推出过 FTS（前端测试服务），但现在已经挂了。最近发现国外有一个建于 2011 年的前端测试服务 BrowserStack。 这是 Wikipedia 上的介绍：  Browse
            
        </summary>
        
        <category term="技术向"/>
        
        <category term="BrowserStack"/>
        
        <category term="Front-end"/>
        
        <category term="FTS"/>
        
        <category term="前端兼容性"/>
        
    </entry>
    
    <entry>
        <title>Story of Journey</title>
        <link href="https://blog.viosey.com/2017/04/04/Story-of-Journey/"/>
        <id>https://blog.viosey.com/2017/04/04/Story-of-Journey/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2017-10-13T13:53:50+00:00</published>
        <updated>2017-10-13T13:53:50+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote>
<p>多图预警</p>
</blockquote>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-1"></a>Chapter 1</h2><p>两周之前心血来潮，买了台 PS4，其独占的《风之旅人》(Journey) 是长草的游戏之一。<br />大概在高中的时候就听朋友安利这款游戏，《纪念碑谷》似乎也是以其为原型。</p>
<blockquote>
<p>刚到手的 PS4，一开始为横放，但太占位置了，于是便换成了立式</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/IMG_20170319-PS4.jpg" /></p>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-2"></a>Chapter 2</h2><p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402112041.jpg" /></p>
<p>初次进入旅途，一切都是新鲜而又充满未知，跌跌撞撞地四处探索。</p>
<p>刚开始一片沙漠，四处茫茫沙海，在远处依稀有一道光柱，带着疑惑朝之缓步前行。</p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170322132000.jpg" /></p>
<p>《风之旅人》 场景十分细致，光影交错，原声更是渲染了强烈的代入感，实为第九艺术的典范。</p>
<p>游戏中按「○」会出现一个符号，在遇见其他旅人之后才意识到这是每个人独有的象征。</p>
<blockquote>
<p>一周目的符号，感觉挺好看的</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170322201613.jpg" /></p>
<p>《风之旅人》会随机遇到不同的伙伴，但是不能语音，也不能发消息，只能默默的陪伴前行，交流只有按下「○」键发出的声响和符号，直到游戏最后才能看到对方的游戏 ID。</p>
<blockquote>
<p>一周目遇到的同伴</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170322202455.jpg" /></p>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-3"></a>Chapter 3</h2><p>结束了一周目，对于 Journey 的关卡有了大概的了解后，于是二周目开始计划解锁奖杯。<br />为了尽早获得白袍，所以参考了这个攻略 <a href="https://forum.gamer.com.tw/Co.php?bsn=60281&amp;sn=694711" target="_blank">風之旅人 - 全符文壁畫攻略</a></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170324111806.jpg" /></p>
<p>有了攻略的参考，<br />在二周目一下子跳了七个奖杯：</p>
<ul>
<li>「冥想」</li>
<li>「临界点」</li>
<li>「海市蜃楼」</li>
<li>「冒险」</li>
<li>「升华」</li>
<li>「远古生物」</li>
<li>「登峰造极」</li>
</ul>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170324115050.jpg" /></p>
<p>从此在三周目变身「白袍」，再也不愁围巾的能量了 lol</p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170324122208.jpg" /></p>
<blockquote>
<p>二周目遇到的同伴</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170324123029.jpg" /></p>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-4"></a>Chapter 4</h2><p>为了体验作为白袍的感觉，顺便再解锁「历史」与「试炼」这两个本该在二周目解锁的成就，于是在当天晚上又老老实实地过了一次三周目</p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170324224344.jpg" /></p>
<p>三周目只身一人，直到通关都没有邂逅其他的旅人，莫名感到有一丝孤独，一直在期待屏幕四周会有白光亮起。</p>
<blockquote>
<p>当出现同伴时，会根据对方所在位置在屏幕边缘亮起一道白光</p>
</blockquote>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-5"></a>Chapter 5</h2><p>隔了一周没有踏上旅途，是为了「归来」</p>
<blockquote>
<p>在熟悉的启动界面跳杯了</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402111756.jpg" /></p>
<p>至此剩余「至交」，「奇迹」和「探索」三个奖杯</p>
<p>「探索」需要在沙漠中找到所有魔带，便直接移动到沙漠，根据网友制作的路线图跳杯了。<br /><img src="https://qiniu.viosey.com/img/Journey-Desert.jpg" /></p>
<p>随之遇到了一个红袍旅人，本打算带着他直到通关，然而没过多久他消失了，看着他打坐，身体从上到下逐渐消逝… 明知这是无可挽回的事情，我却拼命按着「○」键想改变些什么。</p>
<p>似乎希望没了，继续前行的心情也没了。</p>
<h2><a href="https://blog.viosey.com/2017/04/04/Story-of-Journey/#Chapter-6"></a>Chapter 6</h2><p>开始全新的游戏，希望着能遇到一个默契的同伴。</p>
<p>进入了断桥关，正无聊的等待同伴时，突然「奇迹」跳杯了！但是屏幕四边并没有亮起白光呀，疑惑的四处观望，突然发现高处有一个白色的小点，这时有点小激动，感觉对方也是一个白袍。</p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402124626.jpg" /></p>
<p>我们两人开始朝对方移动，走进了看到他确实是个白袍，而且袍文两人都一样多。</p>
<blockquote>
<p>一起飞越断桥</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402125153.jpg" /></p>
<blockquote>
<p>似乎两人的围巾也一样长</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402125401.jpg" /></p>
<blockquote>
<p>你看！这里有朵花！</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402125712.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402130315.jpg" /></p>
<blockquote>
<p>同时跳下悬崖</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402130740.jpg" /></p>
<p>当我们跳下悬崖之后，过了一会儿他也开始消失了… 这时心情别提有多难过了，难得遇到一个十分默契的同伴。而且觉得他似乎知道里世界的入口，正盼他带我进入里世界呢</p>
<p>我在这里飞来飞去，不知道在等些什么，也不愿意再独自走下去。</p>
<p>过了不知道多久，屏幕亮起白光，怔了一下，便看向对方，<br />桥豆麻袋！那个符号！他回来了！</p>
<p>失而复得的激动无法言表</p>
<p>当近乎绝望的时候，他带着那道白光，从天空飘然而下。</p>
<blockquote>
<p>廊桥</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402131321.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402131433.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402132258.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402133310.jpg" /></p>
<p>到了雪山的时候，他没有朝着前方行走，似乎是在卡地图的 bug，果然我的猜想是正确的，他知道进入里世界的方法 (๑•̀ㅂ•́)و✧</p>
<blockquote>
<p>bug 位置</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402134334.jpg" /></p>
<blockquote>
<p>成功进入了里世界</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402134746.jpg" /></p>
<blockquote>
<p>里世界中的神庙</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402135000.jpg" /></p>
<blockquote>
<p>通向重生之路</p>
</blockquote>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402135345.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402135621.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402135852.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402135912.jpg" /></p>
<p><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402141309.jpg" /></p>
<p>Nice to meet you, ANARKY420<br /><img src="https://qiniu.viosey.com/img/%E9%A3%8E%E4%B9%8B%E6%97%85%E4%BA%BA_20170402142148.jpg" /></p>]]></content>
        
        <summary type="html">
            
             多图预警  Chapter 1两周之前心血来潮，买了台 PS4，其独占的《风之旅人》(Journey) 是长草的游戏之一。大概在高中的时候就听朋友安利这款游戏，《纪念碑谷》似乎也是以其为原型。  刚到手的 PS4，一开始为横放，但太占位置了，于是便换成了立式   Chapte
            
        </summary>
        
        <category term="分享境"/>
        
        <category term="PS4"/>
        
        <category term="风之旅人"/>
        
        <category term="Journey"/>
        
        <category term="多图杀猫"/>
        
        <category term="第九艺术"/>
        
    </entry>
    
    <entry>
        <title>全新 Material Theme 官网</title>
        <link href="https://blog.viosey.com/2017/09/26/material-index-v2/"/>
        <id>https://blog.viosey.com/2017/09/26/material-index-v2/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2017-10-13T13:47:41+00:00</published>
        <updated>2017-10-13T13:47:41+00:00</updated>
        
        <content type="html"><![CDATA[<p>好久不见。</p>
<p>二十天前，新版的 Material Theme 官网有了第一行代码。</p>
<a></a>
<p>两天前，官网正式上线了。</p>
<p>同时，还带来新的文档，powered by docsify &amp; jsdelivr。</p>
<p>以及新的域名 <a href="https://mt.viosey.com" target="_blank">mt.viosey.com</a>。</p>
<p>当然，<a href="https://material.viosey.com" target="_blank">旧域名</a>也能访问。</p>
<p>关于技术栈，则使用了 React 与 SCSS。</p>
<blockquote>
<p>Facebook re-license React to MIT is a great news.</p>
</blockquote>
<hr />
<p>距离 Material Theme 诞生一周年，还差 42 天。</p>
<blockquote>
<p>42 is the Answer to Life, the Universe, and Everything.</p>
</blockquote>
<p>最后，附上官网的 Github 地址：<a href="https://github.com/neko-dev/material-index" target="_blank">material-index</a></p>
<p>希望你们也会喜欢上这个性冷淡的官网 :)</p>]]></content>
        
        <summary type="html">
            
            好久不见。 二十天前，新版的 Material Theme 官网有了第一行代码。  两天前，官网正式上线了。 同时，还带来新的文档，powered by docsify &amp;amp; jsdelivr。 以及新的域名 mt.viosey.com。 当然，旧域名也能访问。 关于技术
            
        </summary>
        
        <category term="创作集"/>
        
        <category term="React"/>
        
        <category term="SCSS"/>
        
        <category term="Material"/>
        
    </entry>
    
    <entry>
        <title>云主机和 VPS 的区别</title>
        <link href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html"/>
        <id>https://blog.nfz.moe/archives/compare-vps-ecs-vh.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-10-08T07:35:00+00:00</published>
        <updated>2017-10-08T07:35:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>很多站长对于云主机、VPS、虚拟主机之间的区别都不知所以，很多解释这些概念的文章也经常出现各种错误，使得这些概念经常被混淆。所以我也写一篇阐述它们区别的文章。</p><a></a><h1><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html#VPS"></a>VPS</h1><p>VPS(Virtual Private Server)，中文名称是虚拟专用服务器。详细的定义可以去看 <a href="https://zh.wikipedia.org/wiki/ 虚拟专用服务器" target="_blank">维基百科 - VPS</a>。通俗点讲，就是在一台大型的独立服务器上，通过一定的技术（如虚拟化或者容器化）和一定的软件（VMWare、Xen、KVM、OpenVZ），将这台大型独立服务器的运存、处理器、硬盘进行划分成一个一个小的 VPS，每一台 VPS 都可以分配到独立公网 IP 地址、独立资源和独立系统配置，用户可以安装独立操作系统、单独对自己的 VPS 进行重启和关机。</p><h1><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html# 云主机"></a>云主机 </h1><p> 云主机我见过的常见的两个英文缩写是 CVM(Cloud Virtual Machine 腾讯云使用这个名词) 和 ECS(Elastic Compute Service 阿里云和华为云使用这个名词)。<br />理解云主机的概念，就必须抛开一台独立的大型服务器的概念，而要明白一个概念——算池。<br />以阿里云为例。阿里云在国内很多地区都建设了数据中心，在数据中心中所有服务器都是内网互通的。在数据中心里有专门负责存储的机器，配备有大型 HDD 和 SSD 组成 RAID 存储阵列，这些机器组成存储池；有专门负责运算的机器，根据不同的需求有不同的配置（如多核 CPU、强劲的 GPU 和大运存），这些机器组成运算池；有专门进行网络分配和调度的交换机，组成了虚拟网关。</p><blockquote><p>当然，这些算池还会往下细分、以便在不同业务的不同需求中完成调度。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html# 区别"></a>区别 </h1><h2><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html# 可用性"></a> 可用性 </h2><p> 从可用性来讲，VPS 的可用性是要低于云主机的。VPS 的宿主机一旦出现软硬件故障，就会影响到上面的虚拟出来的 VPS。而在云计算池中，如果算池中的某个部分甚至一个物理单位出现故障而离线，大部分情况下都可以由算池中其它部分接替工作，所以云计算一般不会出现整个服务出现大规模故障的情况。</p><h2><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html# 灵活性"></a>灵活性 </h2><p> 以升级你的主机配置为例。VPS 升级配置需要先关闭你的 VPS，然后分配更多的 CPU、运存和硬盘给你的 VPS；虽然 VPS 的宿主机可能有足够强劲的配置，但是一旦你的需求在你目前的宿主机上无法得到满足，你就有可能需要让主机商将你的数据转移到另一台宿主机上重新分配资源虚拟出一个 VPS。而对于云主机，升级配置只需要从算池中分配给你更多的资源即可，非常灵活。</p><blockquote><p>这些就是阿里云、腾讯云、美团云这类云计算创立的初衷——把平时业务较少时从算池中将闲置的算力拿出来卖钱。所以会有这么一句很有意思的话——“双十一期间，你的阿里云主机隔壁就有可能是淘宝的后端服务。”</p></blockquote><h2><a href="https://blog.nfz.moe/archives/compare-vps-ecs-vh.html# 性能"></a>性能 </h2><p> 通常情况下，云主机的性能会比 VPS 差很多，在 IO 性能表现的尤为明显。整个算池分工明确，所有算力都通过内网传输，内网的传输速度是远远不如单一硬件设备之间传输的。举例说明，阿里云的 IO 性能平均为 120M/s，而较好性能的宿主机上的 VPS 的 IO 性能可以达到 1G/s 。</p><hr /><blockquote><p>实际上对于一般情况，云主机和 VPS 的性能的区别是感觉不明显的；VPS 的可用性和 SLA 也不会逊于云主机。在实际的使用体验和操作中也并不能感受到云主机和 VPS 之间的区别；具体如何选择还是要根据自己的业务需要和预算。</p></blockquote>]]></content>
        
        <summary type="html">
            
            很多站长对于云主机、VPS、虚拟主机之间的区别都不知所以，很多解释这些概念的文章也经常出现各种错误，使得这些概念经常被混淆。所以我也写一篇阐述它们区别的文章。VPSVPS(Virtual Private Server)，中文名称是虚拟专用服务器。详细的定义可以去看 维基百科 -
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="VPS"/>
        
        <category term="云主机"/>
        
        <category term="服务器"/>
        
    </entry>
    
    <entry>
        <title>开始使用 Service Workers</title>
        <link href="https://www.isthnew.com/archives/service-workers.html"/>
        <id>https://www.isthnew.com/archives/service-workers.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-10-07T05:58:01+00:00</published>
        <updated>2017-10-07T05:58:01+00:00</updated>
        
        <content type="html"><![CDATA[<h3><a href="https://www.isthnew.com/archives/service-workers.html#Service-Workers-是什么？"></a>Service Workers</h3>]]></content>
        
        <summary type="html">
            
            Service Workers
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="服务工作线程"/>
        
        <category term="Service Worker"/>
        
        <category term="缓存"/>
        
    </entry>
    
    <entry>
        <title>多合一二维码收款码</title>
        <link href="https://www.isthnew.com/archives/all-in-one-qrpay.html"/>
        <id>https://www.isthnew.com/archives/all-in-one-qrpay.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-10-05T14:58:57+00:00</published>
        <updated>2017-10-05T14:58:57+00:00</updated>
        
        <content type="html"><![CDATA[<p>我之前看到了一个网站可以将支付宝和微信的收款码合在一起，研究了下，应该是通过UA来判断扫码的客户端，从而返回特定的链接或者代码。我用网上的工具将支付宝，微信，QQ钱包的二维码都解码之后，用PHP写一个判断来返回对应的值。不过很遗憾的是只有支付宝支持这种用外部返回链接的方式直</p>]]></content>
        
        <summary type="html">
            
            我之前看到了一个网站可以将支付宝和微信的收款码合在一起，研究了下，应该是通过UA来判断扫码的客户端，从而返回特定的链接或者代码。我用网上的工具将支付宝，微信，QQ钱包的二维码都解码之后，用PHP写一个判断来返回对应的值。不过很遗憾的是只有支付宝支持这种用外部返回链接的方式直
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="二维码支付"/>
        
        <category term="qrcode"/>
        
    </entry>
    
    <entry>
        <title>ESP8266 断网神器 基础使用</title>
        <link href="https://blog.asec01.net/esp8266-wifi-deauther-basic/"/>
        <id>https://blog.asec01.net/esp8266-wifi-deauther-basic/</id>
        
        <published>2017-10-04T15:51:03+00:00</published>
        <updated>2017-10-04T15:51:03+00:00</updated>
        
        <content type="html"><![CDATA[<p>我们都是熊孩纸~~~ x2</p>
<a></a>
<hr />
<p>&lt; 接上文 &gt;</p>
<h4>基础使用</h4>
<p>本文仅介绍Deauth攻击。<br />
后续我会写关于Beacon和Probe的使用方式，敬请期待</p>
<hr />
<h4>连接</h4>
<p>这块没有啥好说的。。。<br />
使用手机或者 PC 搜索 WiFi 接入点<br />
你会发现一个名为 <strong>pwned</strong> 的接入点，此热点默认密码为 <strong>deauther</strong><br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/connect-wifi-01.png" /><br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/connect-wifi-02.png" /></p>
<p>然后随便打开个现代一点的浏览器（360滚，谁知道他会搞出什么事）<br />
在地址栏输入 <strong>192.168.4.1</strong><br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-warning.png" /></p>
<p>翻译：</p>
<blockquote>
<p>此软件仅用于测试802.11 标准中的常见漏洞.<br />
它可以中断无保护的 wi-fi 连接.<br />
在使用之前请查阅您的国家的法律.</p>
<p>您只能在自己的网络和设备上使用它!<br />
此软件在未经许可的情况下对其他网络的使用是非法的!</p>
<p>你要为你所做的一切包括这个程序负责!<br />
它将记录所有针对任何网络和设备的操作.</p>
<p>请不要将此项目命名为干扰器，他没有扰乱任何频率。<br />
去 <a href="http://github.com/spacehuhn/esp8266_deauther" target="_blank">github.com/spacehuhn/esp8266_deauther</a> 获得更多信息</p>
</blockquote>
<p>当然果断理解啦</p>
<hr />
<h4>扫描接入点</h4>
<p>理解了上面的通知会直接把你带到扫描页面（192.168.4.1/apscan.html）<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-scan-aps.png" /></p>
<p>等待几秒，扫描完成<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-scan-aps-result.png" /><br />
选择攻击目标<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-scan-aps-select.png" /></p>
<hr />
<h4>攻击</h4>
<p>切换到攻击页面（192.168.4.1/attack.html）<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-attack.png" /></p>
<p>开始攻击<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-attack-start.png" /></p>
<hr />
<h4>效果</h4>
<p>2.4G 就是连不上<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/phone-wifi-01.png" /><br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/phone-wifi-02.png" /></p>
<hr />
<h4>设置</h4>
<p>切换到设置页面（192.168.4.1/settings.html）<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-settings-1.png" /><br />
SSID 是控制板子用的接入点的名称<br />
Password 是连接密码</p>
<p><img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/web-settings-2.png" /><br />
Timeout 是自动停止时间<br />
调成0为不自动停止</p>
<p>其他设置不建议新手小白修改。。。</p>
<hr />
<h3>本文，完</h3>
<p>Beacon之类的请待我更新下一篇博文。。。</p>]]></content>
        
        <summary type="html">
            
            我们都是熊孩纸~~~ x2   &amp;lt; 接上文 &amp;gt; 基础使用 本文仅介绍Deauth攻击。 后续我会写关于Beacon和Probe的使用方式，敬请期待  连接 这块没有啥好说的。。。 使用手机或者 PC 搜索 WiFi 接入点 你会发现一个名为 pwned 的接入点，此
            
        </summary>
        
    </entry>
    
    <entry>
        <title>ESP8266 断网神器 淘板子与刷入程序</title>
        <link href="https://blog.asec01.net/esp8266-wifi-deauther/"/>
        <id>https://blog.asec01.net/esp8266-wifi-deauther/</id>
        
        <published>2017-10-03T17:38:09+00:00</published>
        <updated>2017-10-03T17:38:09+00:00</updated>
        
        <content type="html"><![CDATA[<p>我们都是熊孩纸~~~</p>
<a></a>
<h4>实现原理：</h4>
<blockquote>
<p>Deauth（去认证）攻击<br />
任何客户端进入一个无线网络前必须先获得一个AP接入点的认证，在这之后跟这个AP相关联。当一个客户端离开时，他会发送一个去除认证信息去不再和AP进行关联。攻击者可以向绑定到客户端IP地址的接入点发送去除认证消息，从而使用户离线并且需要重新认证，从而让攻击者可以观察到重新认证握手时候的有价值的信息。<br />
为了防御这种攻击，可以设置接入点延迟解除认证或者解除关联请求（比如这样的请求需要排队等待5到10秒），从而给接入点机会来观测客户端后续发送过来的数据包。如果一个数据包在一个解除认证或者解除关联请求被放入等待队列之后到达，那么该请求会被丢弃，因为合法客户端将不会以该顺序生成数据包。</p>
<p>来自 维基百科 网络接口层安全 （“Deauth（去认证）攻击”章节）</p>
</blockquote>
<hr />
<h3>搞事情第一步当然是采购</h3>
<p>某宝上面淘一块，推荐NodeMCU<br />
推荐选择CP2102版本的，CH340的那个大了点。。。<br />
CP2102: <a href="https://cnhv.co/2gua" target="_blank">https://item.taobao.com/item.htm?id=530734023642</a><br />
CH-340: <a href="https://cnhv.co/2gul" target="_blank">https://item.taobao.com/item.htm?id=531755241333</a></p>
<hr />
<h3>然后货到了开搞</h3>
<h4>两种搞事情的方式</h4>
<ol>
<li>直接刷大佬编译好的程序</li>
<li>把大佬的源码拉过来自己编译</li>
</ol>
<p>本文先介绍第一种方式<br />
第二种似乎。。没有什么必要<br />
以后再写吧</p>
<hr />
<h4>下载 NodeMCU-Flasher</h4>
<p><a href="https://cnhv.co/2gv8" target="_blank">https://github.com/nodemcu/nodemcu-flasher</a></p>
<p><img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-download.PNG" /></p>
<p>根据你自己的操作系统版本，这俩文件夹自己选<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-01.PNG" /></p>
<p><img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-02.PNG" /></p>
<p>打开软件<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-03.PNG" /></p>
<p>将 NodeMCU 连接到电脑上<br />
（我就不告诉你咋装驱动）<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-connect.PNG" /><br />
连接成功，放在一边</p>
<hr />
<h4>下载 esp8266_deauther</h4>
<p>发布地址: <a href="https://cnhv.co/2gx7" target="_blank">https://github.com/spacehuhn/esp8266_deauther/releases</a><br />
直接下载: <a href="https://cnhv.co/2gxo" target="_blank">https://github.com/spacehuhn/esp8266_deauther/releases/download/v.1.6/esp8266_deauther_1mb.bin</a></p>
<hr />
<h4>开始刷程序</h4>
<p>Config -&gt; 小齿轮 -&gt; 选择刚刚下载的文件<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-04.PNG" /></p>
<p>Operation -&gt; Flash<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-05.PNG" /></p>
<p>刷入完成<br />
<img src="https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther/nodemcu-flasher-use-05.PNG" /></p>
<hr />
<h3>本文，完</h3>
<p>基础使用请看：<a href="https://cnhv.co/2mip" target="_blank">https://blog.zhangzhe-tech.cn/esp8266-wifi-deauther-basic/</a></p>]]></content>
        
        <summary type="html">
            
            我们都是熊孩纸~~~  实现原理：  Deauth（去认证）攻击 任何客户端进入一个无线网络前必须先获得一个AP接入点的认证，在这之后跟这个AP相关联。当一个客户端离开时，他会发送一个去除认证信息去不再和AP进行关联。攻击者可以向绑定到客户端IP地址的接入点发送去除认证消息，从
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Nginx启用HTTP Basic Auth</title>
        <link href="https://www.iwch.me/archives/658.html"/>
        <id>https://www.iwch.me/archives/658.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-10-03T08:41:00+00:00</published>
        <updated>2017-10-03T08:41:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>我们通常可以使用HTTP基本认证来保护我们网站的一些页面(如：探针)，效果如图：</p><p><img src="https://static.yecdn.com/static/blog/post/658/login.png" /></p><p>当用户输入了错误的用户名或密码时，Nginx会返回<code>401 Authorization Required</code>禁止访问。</p><h2>生成用户认证文件</h2><pre><code>echo &quot;username:$(openssl passwd -crypt 'password')&quot; &gt;&gt; /home/.htpasswd
</code></pre><p>其中，<code>username</code>为用户名，<code>password</code>为密码，<code>/home/.htpasswd</code>为用户认证文件路径。</p><p>注意：密码长度最大为8位。</p><h2>修改Nginx配置文件</h2><pre><code>auth_basic &quot;Administrator’s Area&quot;;
auth_basic_user_file /home/.htpasswd;
</code></pre><p>最后别忘了reload一下Nginx：</p><pre><code>nginx -s reload
</code></pre><p>大功告成！</p></div>]]></content>
        
        <summary type="html">
            
             我们通常可以使用HTTP基本认证来保护我们网站的一些页面(如：探针)，效果如图：当用户输入了错误的用户名或密码时，Nginx会返回401 Authorization Required禁止访问。生成用户认证文件echo &amp;quot;username:$(openssl pass
            
        </summary>
        
    </entry>
    
    <entry>
        <title>如何写好一个开源项目的 README</title>
        <link href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html"/>
        <id>https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-10-02T06:07:00+00:00</published>
        <updated>2017-10-02T06:07:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>README 是一个项目的门面。如果你想让更多人使用你的项目或者给你的贡献 PR、丢 star，你就应该写一个吸引人的 README。</p><a></a><h1><a href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html#Logo"></a>Logo</h1><p>无论如何，项目有一个 logo 是一个加分项。一个生动活泼的 logo 能吸引很多人的注意。如果没有 logo，那么就学习 Material 主题、把一张漂亮的预览图丢在 README 开头吧~</p><blockquote><p>就像这样 ↓↓</p></blockquote><p><br /><img src="https://st.nfz.yecdn.com/img/blog/0000180.png" /><br /></p><p>logo 当然需要居中放置，所以我们不能使用 markdown 语法来添加图片，而应该使用 html。正确做法就像这样：</p><pre><code><span><span><span>&lt;</span>p</span> <span>align</span><span><span>=</span><span>&quot;</span>center<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>img</span> <span>src</span><span><span>=</span><span>&quot;</span>https://i.loli.net/2017/09/07/59b1367f76fdb.png<span>&quot;</span></span> <span>alt</span><span><span>=</span><span>&quot;</span>Material Render Phone<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span><span></span><span></span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html# 项目名称"></a>项目名称 </h1><p> 同样的，如果想要突出项目的名称，应该同样让其居中。带上 <code>&lt;a&gt;</code> 标签链接到项目的官网（如果有的话）那也是极好的。</p><pre><code><span><span><span>&lt;</span>h1</span> <span>align</span><span><span>=</span><span>&quot;</span>center<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&quot;</span>https://material.viosey.com<span>&quot;</span></span> <span>target</span><span><span>=</span><span>&quot;</span>_blank<span>&quot;</span></span><span>&gt;</span></span>Material Theme<span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span><span><span>&lt;/</span>h1</span><span>&gt;</span></span><span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html#Slogan"></a>Slogan</h1><p>然后是 slogan。slogan 要么耍帅要么优雅。我列举几个项目的 slogan 吧~</p><blockquote><ul><li>Nature, Source | 原之质，物之渊 —— <a href="https://github.com/viosey/hexo-theme-material/tree/2.x-develop" target="_blank">hexo-theme-material</a></li><li>🍭Wow, such a powerful music API framework —— <a href="https://github.com/metowolf/Meting" target="_blank">Meting</a></li><li>A magical documentation site generator. —— <a href="https://github.com/QingWei-Li/docsify" target="_blank">docsify</a></li></ul></blockquote><p>需要注意的是，你的项目 README 中的 Logo 和名称应该要能够完整地出现在手机版 GitHub 页面内。当然，如果 slogan 也在那就更好了。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000181.png" /></p><h1><a href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html#Badge"></a>Badge</h1><p>README 里面一定不能缺少 Badge。Badge 可以形象的把大部分项目的信息、比如版本号、依赖、构建状态等等展示出来。<br />比如说，hexo-theme-material 添加了这几个 badge：</p><ul><li>Version</li><li>Author</li><li>Hexo Version</li><li>NodeJS Version</li><li>Travis Build Status</li><li>Download</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000182.png" /></p><p>这里当然要推荐 <a href="https://shields.io" target="_blank">Shields.io</a>，绝大部分常见的 GitHub Badge 都是用这个网站生成的。</p><h1><a href="https://blog.nfz.moe/archives/how-to-write-beautiful-github-readme.html# 介绍"></a>介绍 </h1><p> 接下来就应该是对项目的介绍了。README 需要解答下面这些问题：</p><ul><li>这个开源项目是做什么的</li><li>项目维护、CI、依赖更新状态</li><li>项目可用版本及其他版本、并且应该如何下载它们</li><li>Demo 或官网地址（如果有）</li><li>License</li></ul><p>这就是对项目的简单介绍。当然，除了需要上述信息能对用户对你的项目有一个简单的印象，你还需要在 README 中写一些关于项目的介绍。</p><ul><li>如何下载这个项目</li><li>项目依赖</li><li>安装方式</li><li>部署方法（如果项目可以被部署的话）</li><li>Debug 方法</li><li>文档</li></ul><p>由于 Material 是 Hexo 的一个主题，所以我们在 README 中只介绍了下载方式，然后我们提供了一个链接通往我们的文档。</p><hr /><p>基本这就是一个 README 需要包括的内容了。当然，书写项目 README 时候还需要遵守排版规范。这里是 <a href="https://neko-dev.github.io/GUIDELINE/#/others/copywriter" target="_blank">Neko-Dev 的文案风格 GUIDELINE</a></p>]]></content>
        
        <summary type="html">
            
            README 是一个项目的门面。如果你想让更多人使用你的项目或者给你的贡献 PR、丢 star，你就应该写一个吸引人的 README。Logo无论如何，项目有一个 logo 是一个加分项。一个生动活泼的 logo 能吸引很多人的注意。如果没有 logo，那么就学习 Materi
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="GitHub"/>
        
        <category term="README"/>
        
        <category term="Coding"/>
        
        <category term="Markdown"/>
        
    </entry>
    
    <entry>
        <title>使用新窗口打开是个坏习惯</title>
        <link href="https://www.isthnew.com/archives/target-blank.html"/>
        <id>https://www.isthnew.com/archives/target-blank.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-10-02T05:52:43+00:00</published>
        <updated>2017-10-02T05:52:43+00:00</updated>
        
        <content type="html"><![CDATA[<p>实际上有点标题党了，应该说成在任何时候在网页上都使用新窗口打开属性是一个坏习惯。很多站长都喜欢问怎么把自己网站的链接搞成新窗口打开的方式，实际上我觉得这是完全多此一举，甚至是一个坏习惯。<br />实际上会发现很多国外网站和国内网站的不同之处在于，国内网站的链接喜欢新窗口打开，</p>]]></content>
        
        <summary type="html">
            
            实际上有点标题党了，应该说成在任何时候在网页上都使用新窗口打开属性是一个坏习惯。很多站长都喜欢问怎么把自己网站的链接搞成新窗口打开的方式，实际上我觉得这是完全多此一举，甚至是一个坏习惯。实际上会发现很多国外网站和国内网站的不同之处在于，国内网站的链接喜欢新窗口打开，
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="target"/>
        
        <category term="新窗口打开"/>
        
        <category term="blank"/>
        
    </entry>
    
    <entry>
        <title>Android 切换 F2FS 文件系统</title>
        <link href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html"/>
        <id>https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-10-01T14:03:00+00:00</published>
        <updated>2017-10-01T14:03:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>F2FS 如今也是折腾 Android 的玩家口中的一个常见词汇。虽然 2014 年起就已经有 ROM 对其提供支持，但是一加在 2016 年发布了原生支持 F2FS 的氢 OS 7.0，和华为重金聘用了 F2FS 文件系统开发人员的新闻，又把 F2FS 推上了热点。本文介绍了 F2FS 是什么、F2FS 的优势和将手机切换到 F2FS 文件系统的方式。</p><h1><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 警告"></a>警告 </h1><p> 切换文件系统为 F2FS 是一项有风险的行为。如果你的 ROM 的内核不能够支持 F2FS 文件系统，那么有可能导致一系列问题！这些问题并不是由 F2FS 文件系统引起！</p><h1><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html#Why-F2FS"></a>Why F2FS?</h1><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html#F2FS- 是什么"></a>F2FS 是什么</h2><p>F2FS ，即 “Flash-Friendly File system”，是一种新的文件系统，用于 NAND 闪存一类的储存设备，甚至可以自移动设备广泛应用至服务器。三星应用了日志结构档案系统的概念，使它更适合用于储存设备。</p><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html#F2FS- 的优点"></a>F2FS 的优点</h2><p>F2FS 相对目前主流的 EXT3/4 格式，</p><ul><li>更好的加密特性；</li><li>更快的读取速度；</li><li>加快针对零碎小文件的读写速度；</li><li>对固态存储的寿命保护；</li><li>娱乐兔跑分 UX 性能可以增加 3000 多分（<del>不重要</del>）。</li></ul><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html#F2FS- 的缺点"></a>F2FS 的缺点 </h2><p> 虽然 F2FS 拥有针对零碎小文件有 Buff，但是在面对大文件读写上并没有太大优势（如果部分 ROM 没有调试好有关参数，甚至可能导致出现性能波动）。而且当存储空间快要满的时候，F2FS 的性能也会急剧下降。<br />除此以外，F2FS 和 FBE 加密之间存在冲突（这也是小米至今不愿意跟进 F2FS 的原因）。</p><blockquote><p>本人的建议是，除非你的存储芯片是 EMMC 或者 UFS2.0，否则不需要使用 F2FS 来增强你的存储 IO 性能。在 UFS2.1 上，F2FS 对存储 IO 性能的提升并不明显，而且损失 FBE 加密对于一些用户来说是得不偿失的。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html#How-to-F2FS"></a>How to F2FS?</h1><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 选择合适的 ROM"></a>选择合适的 ROM</h2><p>首先你得选择一个支持 F2FS 的 ROM 。比如说我的 nubia Z9 max 的 NubiaUI 并不支持 F2FS ，但是适配的 Mokee 和 CM 都是支持的。<br />大部分第三方 ROM 都是支持的，建议直接咨询 ROM 的开发者。</p><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 刷入一个第三方 -recovery"></a>刷入一个第三方 recovery</h2><p>最好是 TWRP 。因为 TWRP 支持可视化和触摸操作，也支持文件系统转换等很多功能。TWRP 支持 F2FS 的版本是 2.8.6.1+ 。<del>本人使用的是 TWRP3.0.2-2-stalence-nx510j-unofficial</del> TWRP 3.0.1-1_abforce-oneplus3-unofficial。</p><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 备份数据"></a>备份数据 </h2><p> 备份你的数据，包括使用钛备份应用数据，用 TWRP 备份存储 system、data 分区。<br />把你位于内部存储和外部存储的个人文件也全部拷贝到电脑上。</p><blockquote><p>自 Android 5.0 开始已经实现了 data 分区和内置存储合并；这样一旦转换 data 分区的文件系统以后，内置存储也会被清空。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 切换分区"></a>切换分区</h2><ol><li>在 TWRP 下，先清除下述分区的内容：cache、data、system。</li><li>“高级清除菜单”，勾选 Data ，“修复或转换文件系统”，“转换文件系统”，选择 F2FS 。</li><li>用同样的方法，转换 cache 分区为 F2FS</li><li>对于 system 分区要特别注意，有的 ROM 不支持 system 分区为 F2FS 。所以一旦转换 system 分区以后无法开机，你可以直接退回 TWRP ，把 system 再转换回 ext4 ，重新刷入 ROM 一遍即可。</li></ol><blockquote><p>部分 ROM 会在刷机前检测 system 的分区格式，如果不支持会自动把分区转换回 ext4。这是正常现象。</p><p>注意，部分 ROM 也不支持 cache 分区为 F2FS 格式，表现为转换后开机时间变长、多次重启均无法改善。如果出现这种情况，把 cache 分区转换为 ext4 即可（刷机后或者清除 davlik/cache 分区后第一次开机需要执行 dex2oat，所以时间会较长，所以需要之后再多次重启作为对照）。</p></blockquote><p>全部转换以后，再用 TWRP 看一下分区是不是已经转换好了。然后就可以享受 F2FS 给你带来的丝滑的感受了。</p><h2><a href="https://blog.nfz.moe/archives/switch-f2fs-file-system-for-android.html# 还原数据"></a>还原数据 </h2><p> 先把 TWRP 文件夹拷回手机（这个文件夹中有你转换分区格式之前的分区备份文件），然后在 TWRP 的设置中，把 “使用 rm-rf 指令代替格式化” 的选项勾上，以便实现跨文件系统还原分区（如果不勾选，TWRP 会给你还原你之前的文件系统），然后再用 TWRP 还原分区。</p><p>当分区还原完以后就可以开机进系统测试一下，如果一切正常，就再把你备份的个人数据拷回手机存储即可。</p>]]></content>
        
        <summary type="html">
            
            F2FS 如今也是折腾 Android 的玩家口中的一个常见词汇。虽然 2014 年起就已经有 ROM 对其提供支持，但是一加在 2016 年发布了原生支持 F2FS 的氢 OS 7.0，和华为重金聘用了 F2FS 文件系统开发人员的新闻，又把 F2FS 推上了热点。本文介绍了
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="Android"/>
        
        <category term="TWRP"/>
        
        <category term="F2FS"/>
        
        <category term="文件系统"/>
        
    </entry>
    
    <entry>
        <title>自动检查SSL证书到期情况</title>
        <link href="https://flyhigher.top/develop/755.html"/>
        <id>https://flyhigher.top/develop/755.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-10-01T06:25:44+00:00</published>
        <updated>2017-10-01T06:25:44+00:00</updated>
        
        <content type="html"><![CDATA[<h3>这是什么鬼？</h3>
<p>自从我换了ECS，无垠旗下的各种项目也陆陆续续换成了HTTPS协议。然而，随着HTTPS使用越来越广泛，我手头的证书也越来越多。Let’s的证书还好说嘛，可以搞自动续期，但各种CDN上的证书就难搞了…何况我在各大CDN服务商都有挂域名。我才懒得检查证书有效期嘞！So，我打算利用手头的技术搞点事情。</p>
<p>自动检查SSL证书情况！Yeah!Demo:<a href="https://ssl.flyhigher.top" target="_blank">无垠证书透明</a></p>
<h3>让我们开始吧</h3>
<p>如何获取证书信息让我纠结了很久。因为咱都知道你申请到的证书都是一坨乱码，直接读当然不行。一开始找到一个冷门的Python轮子结果并不支持Let’s的证书，直接报不信任。花了老半天终于发现curl就自带检查emmmm</p>
<p>执行<code>curl 你的URL -v</code>可以看到（一定要加https://）<br />
<a href="https://img.flyhigher.top/wp-content/uploads/2017/10/Axton2017.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/10/Axton2017.jpg" /></a><br />
但<code>curl</code>不止会输出连接信息，还会输出下载到的全文到终端。很显然如果任由<code>curl</code>把全文输出到终端非常不利于我们提取出我们需要的时间数据，何况这些是输出到<code>stderr</code>的。因此我们需要把输出重定向到一个文件然后用<code>cat+grep</code>控制输出。</p>
<p>所以咱这次不瞎扯了，直接上手程序。Python 3坠吼了！</p><pre># -*- coding:utf-8 -*-
#依赖库只有一个：pymysql，记得安装
#需要一个MySQL数据库，数据库结构看代码下面的图
import subprocess
import os
import time
import pymysql

db = pymysql.connect(&quot;数据库地址&quot;,&quot;数据库用户名&quot;,&quot;数据库密码&quot;,&quot;数据库名&quot;)
cursor = db.cursor()
cursor.execute(&quot;SET NAMES utf8&quot;);#设置数据库连接字符集

websitelist = ['flyhigher.top','img.flyhigher.top'] #需要检查的域名列表，无需填写协议名，同时支持端口号。建议先在数据库里面添加相应数量的记录，每条记录仅需填写ID，因为我懒没在代码里处理
for i in range(len(websitelist)):
    comm1 = &quot;curl https://&quot;+websitelist[i]+&quot; --connect-timeout 10 -v -s -o /dev/null 2&gt;/tmp/ca.info ; cat /tmp/ca.info | grep 'start date: '&quot; #利用curl检查证书开始时间，注意一下ca.info保存路径，connect-timeout可以控制超时时间，避免假死
    out_bytes1 = subprocess.check_output(comm1, shell=True)
    out_text1 = out_bytes1.decode('utf-8')
    comm2 = &quot;cat /tmp/ca.info | grep 'expire date: '&quot; #检查证书到期时间
    out_bytes2 = subprocess.check_output(comm2, shell=True)
    out_text2 = out_bytes2.decode('utf-8')
    comm3 = &quot;cat /tmp/ca.info | grep 'issuer: '&quot; #获取证书颁发机构
    out_bytes3 = subprocess.check_output(comm3, shell=True)
    out_text3 = out_bytes3.decode('utf-8')
    os.system('rm -f /tmp/ca.info')
    sql = 'UPDATE 数据表名 SET domain = &quot;'+websitelist[i]+'&quot;, check_time = &quot;'+time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime())+'&quot;, s_time = &quot;'+time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,time.strptime(out_text1[-25:-5],&quot;%b %d %H:%M:%S %Y&quot;))+'&quot;, e_time = &quot;'+time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,time.strptime(out_text2[-25:-5],&quot;%b %d %H:%M:%S %Y&quot;))+'&quot;, c_info = &quot;'+out_text3[11:-1].replace('&quot;', &quot;'&quot;)+'&quot; WHERE ID = '+str(i+1) #格式化时间及证书颁发机构名称，构造SQL查询
    cursor.execute(sql)
    db.commit()
    time.sleep(1) #睡一会儿，免得太High
db.close()</pre><p>OK，注释都有了。只要把这段Python扔到服务器上，搞个定时任务每天跑一遍就行了，这就不赘述了。</p>
<p>数据库结构如下，<code>if_s</code>是我用于判断敏感域名的字段，非敏感域名会被展示在前端页面。<br />
<a href="https://img.flyhigher.top/wp-content/uploads/2017/10/Axton20171.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/10/Axton20171.jpg" /></a></p>
<h3>然后呢</h3>
<p>emmm数据都在数据库里了你还想干啥？如果有空可以搞个邮件提醒，或者像我一样做个前端展示页。记得去掉敏感域名就好。</p>
<p>稍后我<strong>可能会</strong>将其整理并作为一个完整的、带Web面板、支持邮件提醒的项目发布到Github上。</p>
<p>溜了溜了</p>]]></content>
        
        <summary type="html">
            
            这是什么鬼？ 自从我换了ECS，无垠旗下的各种项目也陆陆续续换成了HTTPS协议。然而，随着HTTPS使用越来越广泛，我手头的证书也越来越多。Let’s的证书还好说嘛，可以搞自动续期，但各种CDN上的证书就难搞了…何况我在各大CDN服务商都有挂域名。我才懒得检查证书有效期嘞！S
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="Python"/>
        
        <category term="SSL"/>
        
        <category term="检查"/>
        
        <category term="证书"/>
        
    </entry>
    
    <entry>
        <title>两个自己拍摄的延时摄影视频</title>
        <link href="https://www.isthnew.com/archives/Time-Lapse-2017.html"/>
        <id>https://www.isthnew.com/archives/Time-Lapse-2017.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-09-30T15:45:37+00:00</published>
        <updated>2017-09-30T15:45:37+00:00</updated>
        
        <content type="html"><![CDATA[<p>分享两个自己学做延时视频的成果，第一个是在从稻城返程的时候在318国道旁边休息时拍摄的，不过我忘记了具体位置。第二个是在我家拍摄的芦山县新城的样子。做的不是太好，将就看看。</p>
<br />]]></content>
        
        <summary type="html">
            
            分享两个自己学做延时视频的成果，第一个是在从稻城返程的时候在318国道旁边休息时拍摄的，不过我忘记了具体位置。第二个是在我家拍摄的芦山县新城的样子。做的不是太好，将就看看。 
            
        </summary>
        
        <category term="不能无聊"/>
        
        <category term="延时摄影"/>
        
        <category term="318国道"/>
        
        <category term="芦山县"/>
        
    </entry>
    
    <entry>
        <title>开箱测评 | 阿里月饼</title>
        <link href="https://liyin.date/2017/09/29/unbox-alimooncake/"/>
        <id>https://liyin.date/2017/09/29/unbox-alimooncake/</id>
        
        <published>2017-09-29T21:04:27+00:00</published>
        <updated>2017-09-29T21:04:27+00:00</updated>
        
        <content type="html"><![CDATA[<p>前几天，收到了一份从 <a href="https://ikk.me" target="_blank">Kookxiang</a> 寄来的阿里月饼！ <strong>ありがとう</strong><br />那么，来开箱吧！<br /></p>]]></content>
        
        <summary type="html">
            
            前几天，收到了一份从 Kookxiang 寄来的阿里月饼！ ありがとう那么，来开箱吧！
            
        </summary>
        
    </entry>
    
    <entry>
        <title>几个提高WordPress速度的技巧</title>
        <link href="https://www.isthnew.com/archives/some-tips-about-optimizing-wordpress.html"/>
        <id>https://www.isthnew.com/archives/some-tips-about-optimizing-wordpress.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-09-23T02:05:45+00:00</published>
        <updated>2017-09-23T02:05:45+00:00</updated>
        
        <content type="html"><![CDATA[<p>虽然有很多介绍WordPress缓存插件的，我也介绍过用Redis来缓存WordPress生成的页面，这也不失为一个较便捷的优化方法。但是很多时候我们会使用动态的元素，比如手机端和桌面端分发不同的图片，如果直接使用前端缓存插件会导致这些元素失去原有的效果。<br />Apach</p>]]></content>
        
        <summary type="html">
            
            虽然有很多介绍WordPress缓存插件的，我也介绍过用Redis来缓存WordPress生成的页面，这也不失为一个较便捷的优化方法。但是很多时候我们会使用动态的元素，比如手机端和桌面端分发不同的图片，如果直接使用前端缓存插件会导致这些元素失去原有的效果。Apach
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="wordpress"/>
        
        <category term="nginx"/>
        
        <category term="php"/>
        
    </entry>
    
    <entry>
        <title>九年计划</title>
        <link href="https://blog.asec01.net/nine-years-plan/"/>
        <id>https://blog.asec01.net/nine-years-plan/</id>
        
        <published>2017-09-21T05:08:00+00:00</published>
        <updated>2017-09-21T05:08:00+00:00</updated>
        
        <content type="html"><![CDATA[<h2>简单说明</h2>
<p>在北京市第五十四中学的秋季运动会上，武旭主任屡次担当女子实心球裁判。</p>
<a></a>  
<p>每年计划的执行者都会拍下一张武旭主任坐在那里的照片[滑稽]<br />
本计划的目标是拍摄武旭主任9年的变化，在计划最后一年在朋友圈中发9张图。</p>
<h2>成果展示</h2>
<p>2014 [暂未添加原图]<br />
<img src="https://blog.zhangzhe-tech.cn/nine-years-plan/2014.jpg" /></p>
<p>2015 [暂未添加原图]<br />
<img src="https://blog.zhangzhe-tech.cn/nine-years-plan/2015.jpg" /></p>
<p>2016 [暂未添加原图]<br />
<img src="https://blog.zhangzhe-tech.cn/nine-years-plan/2016.jpg" /></p>
<p>2017 [暂未添加原图]<br />
<img src="https://blog.zhangzhe-tech.cn/nine-years-plan/2017.JPG" /></p>
<h2>计划成员</h2>
<ul>
<li>
<p><strong>江昊楠</strong>：本计划的发起者。<br />
拍摄2014-2016年，共三张<br />
当时的职务：DV社团社长（2014-2016）</p>
</li>
<li>
<p><strong>张哲</strong>：拍摄2017<br />
当时的职务：科技社团社长（2016-2017）</p>
</li>
<li>
<p><strong>周慧明</strong>： 拍摄2017<br />
当时的职务：科技社团副社长（2016-2017）</p>
</li>
<li>
<p><strong>蒋思怡</strong>：预备成员</p>
</li>
</ul>
<h2>备注</h2>
<ul>
<li>本计划由 2017届毕业生 <strong>江昊楠</strong> 发起。</li>
<li>本计划共需要9年，已执行3年。</li>
</ul>]]></content>
        
        <summary type="html">
            
            简单说明 在北京市第五十四中学的秋季运动会上，武旭主任屡次担当女子实心球裁判。    每年计划的执行者都会拍下一张武旭主任坐在那里的照片[滑稽] 本计划的目标是拍摄武旭主任9年的变化，在计划最后一年在朋友圈中发9张图。 成果展示 2014 [暂未添加原图]  2015 [暂未添
            
        </summary>
        
    </entry>
    
    <entry>
        <title>使用UltraEdit一键转换MAT方案为IFW</title>
        <link href="https://blackyau.cc/8.html"/>
        <id>https://blackyau.cc/8.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2017-09-17T15:09:00+00:00</published>
        <updated>2017-09-17T15:09:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>My Android Tools作为一位Android优化软件新秀，使用与其他优化软件单纯的杀后台抑制后台唤醒完全不同的方法，深受Android倒腾党的喜爱。但任何应用App都可以使用公开的接口<a href="https://developer.android.com/reference/android/content/pm/PackageManager.html?hl=zh-cn#setComponentEnabledSetting">Android Developer</a>来重新激活自己的组件。My Android Tools作者也考虑到了这个问题，同时也推出了一个<a href="https://www.coolapk.com/apk/cn.wq.myandroidtoolsxposed">Xposed模块</a>阻止这个api的调用。<br />Xposed模块的滥用又会导致系统执行效率，详细原因可以查看该文<a href="https://blog.nfz.moe/archives/why-xposed-cause-unsmooth-exprience.html">为什么安装 Xposed 以后会导致卡顿</a>。所以又有人挖掘除了新的方法，能够在仅ROOT的情况下阻止禁用后的Service/Receiver/Activity调用api重新激活自己的组件。绿色守护在V3.0时也在新推出的“处方”功能时，使用了该特性。<strong>Intent Firewall</strong></p><h2>Intent是什么？</h2><p>Activity、服务和广播接收器，是通过名为 Intent 的消息进行启动的。可以将 Intent 视为从其他组件请求操作的信使，无论组件属于这个应用还是其他应用。<br />对于 Activity 和服务， Intent 传达要执行的操作。例如， Intent 传达的请求可以是打开应用设置界面的Activity，或是启动下载某文件的服务<br />对于广播接收器， Intent 只会定义要广播的通知，可以响应这个广播的接收器会被启动以执行下一步操作</p><h2>Intent Firewall的原理？</h2><p>写轮眼是通过关闭组件来达到效果，而处方则是拦截了启动组件的途径。Intent防火墙是Android框架的一个组件，允许根据XML文件中定义的规则强制阻止intent。Intent防火墙不是Android框架的官方支持的功能，没有官方文档，只能通过阅读源代码了解。<br />每一个在Android框架中启动的Intent，包括由操作系统创建的Intent，都会通过Intent防火墙。这意味着Intent防火墙有权允许或拒绝任何Intent。Intent防火墙在决定如何处理传入Intent时不考虑发送方，只考虑Intent的细节和其预期的接收者。XML文件被写入到<code>/data/system/ifw</code>目录并可以删除，这使得Intent防火墙可以动态更新其规则集。<br />绿色守护在此基础上进行开发，使处方成为一个非常强大的功能，但严重依赖网友贡献的意图筛选规则，比My Android Tools更甚。</p><h2>Intent Firewall的编写规则？</h2><p>你可以通过查看<a href="http://www.cis.syr.edu/~wedu/android/IntentFirewall/"><a href="http://www.cis.syr.edu/~wedu/android/IntentFirewall/">http://www.cis.syr.edu/~wedu/android/IntentFirewall/</a></a>来知道。下面是一个实例</p><pre><code>&lt;rules&gt;
&lt;broadcast block=&quot;true&quot; log=&quot;false&quot;&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/cooperation.dingdong.DingdongPluginProxyBroadcastReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/cooperation.qzone.QzoneProxyReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.open.downloadnew.common.DownloadReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.open.downloadnew.common.DownloadReceiverWebProcess&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.open.business.base.appreport.AppReportReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/cooperation.weiyun.WeiyunProxyBroadcastReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/cooperation.weiyun.WeiyunBroadcastReceiver&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.mobileqq.msf.core.NetConnInfoCenter&quot; /&gt;
&lt;/broadcast&gt;
&lt;service block=&quot;true&quot; log=&quot;false&quot;&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.mobileqq.app.CoreService&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.mobileqq.app.CoreService$KernelService&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/cooperation.qzone.remote.logic.QzoneWebPluginProxyService&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.tmdownloader.TMAssistantDownloadService&quot; /&gt;
&lt;/service&gt;
&lt;activity block=&quot;true&quot; log=&quot;false&quot;&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.mobileqq.activity.UpgradeActivity&quot; /&gt;
&lt;component-filter name=&quot;com.tencent.mobileqq/com.tencent.mobileqq.activity.UpgradeDetailActivity&quot; /&gt;
&lt;/activity&gt;
&lt;/rules&gt;</code></pre><p><code>broadcast</code>为广播，<code>service</code>为服务，<code>activity</code>为活动。其他的你应该很容易的看出规律。</p><h2>如何将MAT备份转为IFW方案？</h2><p>首先下载安装UltraEdit个人推荐zd426破解版，因主站易主不建议使用最新版，这里提供可信的历史版直链下载(基于又拍云的个人CDN)和蓝奏云<br /><a href="https://st.blackyau.net/dl/UltraEdit/UltraEdit_v25.0.0.82_x64_zh_CN.7z">UltraEdit_v25.0.0.82_x64_zh_CN</a><br /><a href="https://st.blackyau.net/dl/UltraEdit/UltraEdit_v25.0.0.82_x32_zh_CN.7z">UltraEdit_v25.0.0.82_x32_zh_CN</a><br /><a href="https://st.blackyau.net/dl/UltraEdit/UltraEdit.exe">UltraEditv 8.20 简体中文汉化经典版单文件</a><br /><a href="https://www.lanzous.com/b275916/">https://www.lanzous.com/b275916/</a> 密码:hg3y</p><p>然后下载<a href="https://dl.blackyau.cc/?dir=%E7%A6%81%E7%94%A8%E6%96%B9%E6%A1%88">MAT转IFW.mac</a><br /><img src="https://blackyau.b0.upaiyun.com/blog/8/1.png" /><br /><strong>在转换时不建议使用键盘或鼠标进行任何操作，在转换量较大时应用会未响应属正常现象。等待即可。</strong><br />目前在<code>MAT转IFW-new</code>中使用了新的思路，来自<a href="https://bbs.letitfly.me/d/100/11">cubesky</a>，转换速度快到令人发指。实现方法为，先在两边加上前缀和后缀，后将整个MAT方案复制两遍然后在将IFW用于判定broadcast、service、activity属性的语句，重复三遍。</p><pre><code>&lt;rules&gt;
&lt;broadcast block=&quot;true&quot; log=&quot;false&quot;&gt;
我是毒瘤服务1
我是毒瘤服务2
我是毒瘤广播1
我是毒瘤广播2
我是毒瘤活动1
&lt;/broadcast&gt;

&lt;service block=&quot;true&quot; log=&quot;false&quot;&gt;
我是毒瘤服务1
我是毒瘤服务2
我是毒瘤广播1
我是毒瘤广播2
我是毒瘤活动1
&lt;/service&gt;

&lt;activity block=&quot;true&quot; log=&quot;false&quot;&gt;
我是毒瘤服务1
我是毒瘤服务2
我是毒瘤广播1
我是毒瘤广播2
我是毒瘤活动1
&lt;/activity&gt;
&lt;/rules&gt;
</code></pre><p>经测试，方案中的所有服务/广播/活动都被IFW正常干掉。具体会导致什么负面效果有待进一步的查证，现在看来除了会让IFW配置文件变得大一点还没发现什么问题。</p><p><code>MAT转IFW-old</code>使用了broadcast、service、activity关键字来判断组件属性，生成IFW方案比较干净没有多余的内容。不过如果有不按标准命名的组件，将会在宏运行结束后在最底部需要你手动操作一下。你可以将光标停留在任意一行，通过快捷键ALT+F1|ALT+F2|ALT+F3分别将该行组件插入服务|广播|活动分组。</p><p>我正在寻找能够高效率/跨平台完成MAT到IFW的转换方法，如果你有建议欢迎给我提出。这会对我有极大的帮助。<br />如果您由于各种原因，无法自己转换。可以将MAT方案发送到blackyau426@gmail.com、Telegram:@Black_Yau或是直接在博客评论区留言。我会尽力为你解答。</p>]]></content>
        
        <summary type="html">
            
            My Android Tools作为一位Android优化软件新秀，使用与其他优化软件单纯的杀后台抑制后台唤醒完全不同的方法，深受Android倒腾党的喜爱。但任何应用App都可以使用公开的接口Android Developer来重新激活自己的组件。My Android Too
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（6）——WebFont 字体优化</title>
        <link href="https://blog.nfz.moe/archives/wpo-web-font-performance.html"/>
        <id>https://blog.nfz.moe/archives/wpo-web-font-performance.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-09-17T09:48:18+00:00</published>
        <updated>2017-09-17T09:48:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>WebFont 的加载是一个令人头疼的事情。除了跨域问题、还有 FOIT、FOUT 等等。为了提供更好的用户体验，我寻找了一些高效加载 WebFont 的简单解决方法，并对它们分别进行测试。</p><a></a><h1><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 解决方案"></a>解决方案 </h1><p> 常见的加速字体的方案有：</p><ul><li>将字体部署在 CDN 并开启跨域头</li><li>使用第三方字体库加载字体</li><li>将字体以 base64 形式保存在 css 中并缓存下来</li><li>将字体以 base64 形式保存在 css 中并通过 localstorage 中进行缓存</li></ul><blockquote><p>参考阅读：</p><ul><li><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html">《Web 性能优化（3）——探讨 data URI 的性能》</a></li><li><a href="https://blog.nfz.moe/archives/wpo-localstorage-css-js.html">《Web 性能优化（4）——localstorage 存储静态文件的意义》</a> </li></ul></blockquote><h1><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 测试"></a>测试 </h1><p> 我写了四个测试页面，分别用来测试上述四种方案的字体加载性能。</p><ul><li>测试字体：Roboto 的三个字重（300、400、500）</li><li>测试环境：完整 HTTP2</li><li>测试工具：<a href="https://gtmetrix.com" target="_blank">GTmetrix</a></li></ul><h2><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 将字体部署在 -CDN- 上"></a>将字体部署在 CDN 上 </h2><p><a href="https://lab.nfz.moe/fonts-performance/default.html" target="_blank"> 测试页面</a></p><p>在这个页面中，我从 inline 在页面中的 <code>style</code> 标签通过 <code>@font-face</code> 引用了来自 <code>css.net</code> 的公共 CDN 库中的 Roboto 字体。</p><h3><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 正常网络环境"></a>正常网络环境</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000170.png" /></p><p>可以看到，只有在 DOMLoaded 触发以后，WebFont 才开始予以加载。WebFont 的优先级在加载中并不高。</p><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/Ap69eYgs" target="_blank">详细的测试报告</a></del></p><p>在测试报告中提供的视频里也可以清楚地看到，当页面整体框架出来以后，文字内容才被“一点点填充”进页面中</p><h3><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 极限网络环境"></a>极限网络环境</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000171.png" /></p><p>在 <code>Slow 3G</code> 的极端模式下，如果整个页面全部使用外源字体，那么就会严重影响主要内容的展现。</p><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/geEKorku" target="_blank">详细的测试报告</a></del></p><h2><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 使用 -Google-Font- 加载字体"></a>使用 Google Font 加载字体 </h2><p><a href="https://lab.nfz.moe/fonts-performance/google-font.html" target="_blank"> 测试页面</a></p><p>在这个页面中，我用 <code>https://fonts.googleapis.com/css?family=Roboto:300,400,500</code> 加载 Roboto 字体。</p><h3><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 正常网络环境 -1"></a>正常网络环境</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000173.png" /></p><p>由于 Google 字体库的字体压缩和分离 Buff，GTmetrix 的测试中加载的字体非常快。但是加载字体 css 还需要新建立一个 TCP 连接，所以略微延迟了 DOMLoaded 触发。</p><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/QI8daVFy" target="_blank">详细的测试报告</a></del></p><h3><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 极限网络环境 -1"></a>极限网络环境</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000174.png" /></p><p>在 <code>Slow 3G</code> 的极端模式下，Google 字体库不得不额外建立一个 TCP 连接的劣势被放大。</p><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/FS9lebB8" target="_blank">详细的测试报告</a></del></p><h2><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 将 -base64- 字体 -inline- 在 -HTML"></a>将 base64 字体 inline 在 HTML</h2><p><a href="https://lab.nfz.moe/fonts-performance/base64.html" target="_blank">测试页面</a></p><blockquote><p>将字体转变为 base64 使用了 <a href="https://amio.github.io/embedded-google-fonts/" target="_blank">embedded-google-fonts</a> 项目，下同。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000175.png" /></p><p>无需新增任何额外请求使这个页面的加载性能表现的很优秀，但是这无疑增大了 HTML 的体积，把字体这种不常更新的资源提升到了和 HTML 这种经常改变的资源同等的缓存地位，于性能是大大不利的。<br />而且，将将这么大的字体进行 base64 加码，可能会严重影响页面的渲染性能，因为解码 base64 也要消耗时间。</p><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/cKJhnLnQ" target="_blank">详细的测试报告</a></del></p><h2><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 将 -base64- 字体 -inline- 在 -css"></a>将 base64 字体 inline 在 css</h2><p><a href="https://lab.nfz.moe/fonts-performance/base64-css.html" target="_blank">测试页面</a></p><p>虽然很多人并不赞同将字体 base64 化后储存在 css 中，包括了 css 和字体的缓存等级的不同、影响 css 文件的加载从而影响渲染等等；但是 css 本身具有可以缓存的特点，而且使用 css 内建 base64 字体可以避免 FOIT。</p><blockquote><ul><li>Chrome 和 Firefox 的部分版本最多只能显示 3 秒钟内显示的文字。如果网络字体在这三秒内到达，文本从不可见切换到您的自定义字体。如果字体在 3 秒后仍未到达，则文本使用系统默认字体。这是 <code>FOIT</code>。</li><li>IE 会立即显示系统备用字体，然后在自定义字体到达时将进行替换。这是 <code>FOUT</code>。现在部分版本的 Chrome 也使用了这种方案。</li><li>Safari 会不显示字，直到字体到达。如果字体从未到达，它也没有备用字体。这是 <code>FOIT</code>，用户可能永远无法看到您网页上的任何文字。</li></ul></blockquote><p><del><a href="https://gtmetrix.com/reports/lab.nfz.moe/0yCct7SN" target="_blank">详细的测试报告</a></del></p><h2><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 将 -base64- 字体存储在 -localstorage- 中"></a>将 base64 字体存储在 localstorage 中 </h2><p><a href="https://lab.nfz.moe/fonts-performance/base64-lsloader.html" target="_blank"> 测试页面</a></p><blockquote><p>这个页面使用了 Material 主题中专门开发的轮子 <code>lsloader</code></p></blockquote><p>无论文件是否可以缓存，总有特殊环境和辣鸡浏览器不能很好的缓存文件。这个时候将字体 base64 以后直接储存在 localstorage 中可以实现强缓存的效果。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000176.png" /></p><p>当二次加载以后，页面的主要拖延成为了从本地的 localstorage 中取出巨大体积的 base64 字体并将其解码、渲染。但是这一切操作均在本地完成，本身不需要发起网络请求，在移动端这种恶劣的网络环境下这不失为一种最佳选择。</p><h1><a href="https://blog.nfz.moe/archives/wpo-web-font-performance.html# 最佳实践"></a>最佳实践</h1><ul><li>尽量避免 Google 字体库，因为这不得不需要专门下载一个 <code>@font-face</code> 的 css 片段才能加载字体。直接内置在 css 片段中是一个不错的选择。</li><li>使用 base64 字体主要是为了避免跨域和 FOIT。如果只考虑现代浏览器，使用 <code>woff</code> 或者 <code>woff2</code> 这种内建压缩的现代的 WebFont 格式搭配 <code>Preload</code> 提升字体加载优先级别可能更适合常规选择。</li><li>最好的选择是不加载字体，尽量使用访客设备上默认的字体用于页面。毕竟各种系统默认的内置字体在对应系统上有最好的显示效果。</li><li>如果需要使用 base64 字体（比如外源的图标字体），建议对字体本身进行精简，然后 base64 转码后储存在 localstorage 中，可以有效改善缓存的效果、显著提升二次加载的性能。</li></ul><p>在 Material 主题 2.0.0 重构的计划中，我们决定采用 <a href="https://ant.design" target="_blank">ANT.Design</a> 的字体设定（稍作改造）以获得最好的显示效果和加载性能。选择 <code>woff</code> 或者 <code>woff2</code> 格式的 Material Icon 内联在 css 当中，并使用 Material 主题中已经成熟的 <code>lsloader</code> 储存字体 css，获得最好的性能。</p>]]></content>
        
        <summary type="html">
            
            WebFont 的加载是一个令人头疼的事情。除了跨域问题、还有 FOIT、FOUT 等等。为了提供更好的用户体验，我寻找了一些高效加载 WebFont 的简单解决方法，并对它们分别进行测试。解决方案  常见的加速字体的方案有：将字体部署在 CDN 并开启跨域头使用第三方字体库加
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="字体"/>
        
        <category term="WebFont"/>
        
        <category term="localstorage"/>
        
        <category term="base64"/>
        
    </entry>
    
    <entry>
        <title>LetITFly BBS 重新开放啦</title>
        <link href="https://liyin.date/2017/09/15/lifbbs/"/>
        <id>https://liyin.date/2017/09/15/lifbbs/</id>
        
        <published>2017-09-15T17:33:49+00:00</published>
        <updated>2017-09-15T17:33:49+00:00</updated>
        
        <content type="html"><![CDATA[<h1><a href="https://liyin.date/2017/09/15/lifbbs/#LetITFly-BBS"></a>LetITFly BBS</h1><p><code>LetITFly BBS</code> 的前身是</p>]]></content>
        
        <summary type="html">
            
            LetITFly BBSLetITFly BBS 的前身是
            
        </summary>
        
    </entry>
    
    <entry>
        <title>辣鸡MIUI</title>
        <link href="https://blog.asec01.net/junk-miui/"/>
        <id>https://blog.asec01.net/junk-miui/</id>
        
        <published>2017-09-10T15:55:19+00:00</published>
        <updated>2017-09-10T15:55:19+00:00</updated>
        
        <content type="html"><![CDATA[<p>MIUI9 快如闪电<br />
快你个锤子</p>
<a></a>
<p>不小心把Magisk框架弄崩了<br />
然后爽死我<br />
绿色守护没自动休眠应用<br />
冰箱把国产毒瘤都放出来了<br />
开个摩拜小车要5分钟<br />
网易云音乐开始慢放</p>
<p>Magisk死了的时候内存最多能剩1.3G<br />
卡的要命<br />
修好了只剩不到700M<br />
一点都不卡<br />
谁能给我解释一下这是啥个意思</p>
<p>更新到开发板 7.9.7<br />
依旧装不上Magisk v14.0<br />
还强行改我按键习惯<br />
短按菜单键不能显示菜单<br />
那这玩意为何还要叫菜单键<br />
<img src="https://blog.zhangzhe-tech.cn/junk-miui/Screenshot_2017-09-10-23-25-17-255_com.android.settings.png" /></p>
<p>以后换手机绝对不用国产深度定制系统</p>]]></content>
        
        <summary type="html">
            
            MIUI9 快如闪电 快你个锤子  不小心把Magisk框架弄崩了 然后爽死我 绿色守护没自动休眠应用 冰箱把国产毒瘤都放出来了 开个摩拜小车要5分钟 网易云音乐开始慢放 Magisk死了的时候内存最多能剩1.3G 卡的要命 修好了只剩不到700M 一点都不卡 谁能给我解释一下
            
        </summary>
        
    </entry>
    
    <entry>
        <title>自建邮件服务小记</title>
        <link href="https://blog.lwl12.com/read/mta-of-the-elite.html"/>
        <id>https://blog.lwl12.com/read/mta-of-the-elite.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-09-10T15:25:58+00:00</published>
        <updated>2017-09-10T15:25:58+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/mta-of-the-elite.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/mail-system-3.jpg" /></a></p><h1>咋回事啊</h1>
<p>LWL 之前用过很多家的邮件服务。腾讯云企业邮箱、阿里云邮、ZOHO Mail、Submail (Push)…… 但是由于各种各样的原因，这些邮局都没能让我满意（例如国内大部分邮件服务甚至都不支持 DKIM 这种<strong>基础</strong>功能），于是咱决定自建一台邮件服务器。<br />
<span></span><br />
<div></div></p>
<h1>前置准备</h1>
<h2>机器要求</h2>
<p>LWL 使用 <a href="https://github.com/mailcow/mailcow-dockerized">mailcow: dockerized</a> 项目完成邮件服务器基础建设，因此需要满足一定的配置要求，具体如下：</p>
<ul>
<li>CPU: 1 GHz</li>
<li>RAM: 1 GiB (1.5 GiB + Swap 最佳)</li>
<li>Disk: 5 GiB （不包括邮件储存空间）</li>
<li>System: x86_64 （所以 32 位系统大概用不了吧）</li>
</ul>
<blockquote><p>
  ClamAV 会大量占用 RAM. 可以在 <code>mailcow.conf</code> 中加入 <code>SKIP_CLAMD=y</code> 来关闭它。
</p></blockquote>
<p>另外，邮件服务器的真实 IP 无法隐藏，因此建议使用带高防的机器以防止遭受攻击。</p>
<h2>检查端口</h2>
<p>可以在 BASH 使用以下指令快速检查端口占用情况</p>
<pre><code>netstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995'
</code></pre>
<p>也可以参照下表自行检查</p>
<p><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/snipaste20170910_192112.png" /></p>
<p>如有冲突情况，可以选择关闭正在占用端口的程序或是修改 <code>mailcow.conf</code> 中的默认端口设置。<br />
服务器原有 NGINX 等网页服务时，可参看<a href="https://mailcow.github.io/mailcow-dockerized-docs/firststeps-rp/">官方文档</a>中的反向代理设置方法。这里顺带提供我使用的 NGINX 反代配置：</p>
<pre><code>location ~* {
        proxy_pass http://127.0.0.1:8080;
        proxy_redirect https://127.0.0.1:8080 $scheme://$host:$server_port;
        proxy_redirect https://127.0.0.1:8443 $scheme://$host:$server_port;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
</code></pre>
<h2>设置 DNS</h2>
<p>对于邮件服务，DNS 配置错误将极有可能导致发出的所有邮件被收信方判定为 SPAM。因此正确的 DNS 配置是必要的。如果只提供程序使用（而非个人日常使用）的话，一般需要配置以下内容：</p>
<ul>
<li>A / AAAA</li>
<li>MX Record</li>
<li>rDNS (即 PTR Record)</li>
<li>SPF</li>
<li>DKIM</li>
<li>DMARC</li>
</ul>
<p>如果需要作为日常使用，为了便于邮件客户端配置，还可添加关于 <code>autodiscover</code> 与 <code>autoconfig</code> 相关的记录。这部分内容请参看<a href="https://mailcow.github.io/mailcow-dockerized-docs/prerequesite-dns/#the-advanced-dns-configuration">官方文档</a>。</p>
<h3>A / AAAA</h3>
<p>A 记录，用于访问 mailcow 等组件的 Web 控制台，指向邮件服务器即可。<br />
在稍后的安装过程中，程序会自动签发一张证书来保证 SSL/TLS 链接正常建立。由于使用 webroot 方式验证，请务必正确设置该记录。</p>
<h3>MX Record</h3>
<p>MX 记录的用途想必不用我再赘述，将其指向邮件服务器地址即可。</p>
<blockquote><p>
  根据规范，不建议直接将 MX 记录指向 IP地址，应指向能够映射到一个或者多个 DNS 中类型为 A 或者 AAAA 的地址记录。且根据RFC2181，原则上禁止指向 CNAME 记录。
</p></blockquote>
<h3>rDNS</h3>
<p>rDNS，即反向解析，在 MTA （Mail Transfer Agent, 邮件传送代理）中通常被用于判断发送方邮件服务器域名与给定IP是否互相关联。</p>
<p>有些邮件系统例如会拒绝没有进行反向解析的发件服务器发出的所有消息，所以建议设置好反向解析。</p>
<p>由于 rDNS 需要你的服务器（IP）提供商协助才能设置，因此具体设置方法需咨询您的服务器提供商。部分服务商并不支持设置反向解析记录，如果为了搭建邮局特意购入服务器，请务必提前询问其对 rDNS 的支持情况。（当然，实在不支持那就没办法了╮(╯▽╰)╭）</p>
<h3>SPF</h3>
<p>SPF 记录的用途是阻止垃圾邮件发件人发送假冒您网域中的“发件人”地址的电子邮件。收件人可以参考 SPF 记录来确定号称来自您网域的邮件是否来自授权的邮件服务器。</p>
<p>如果你已经配置了 MX 记录，只需要添加一个内容为 <code>&quot;v=spf1 mx ~all&quot;</code> 的 TXT 记录即可完成 SPF 记录的配置。</p>
<blockquote><p>
  例如，假设您的网域为 example.com。您为网域创建了 SPF 记录，将您的邮件服务器（们）识别为获得授权的邮件服务器。当收件人的邮件服务器收到来自 user@example.com 的邮件时，会检查 example.com 的 SPF 记录以确定该邮件是否有效。如果发送邮件的服务器不在 SPF 记录的您的邮件服务器列表中，收件人的邮件服务器会将其视为垃圾邮件而拒绝接收。</p>
<p>  如果您的网域没有 SPF 记录，那么有些收件人可能会拒绝您发送的邮件，因为收件人无法验证相应邮件是否来自获得授权的邮件服务器。</p>
<p>  (该文段修改自 <a href="https://support.google.com/a/answer/33786?hl=zh-Hans">Google</a>)
</p></blockquote>
<h3>DKIM</h3>
<p>DKIM 记录是一个包含公钥的记录。邮件发出时，邮局会对邮局的标题、ID 等内容进行签名，收件方通过 DKIM 记录中的公钥验证该邮件签名是否有效，进而确认该邮件是否由真实的域名持有者发出。</p>
<p>正确的设置 DKIM 可有效提高邮件的可信度并提升到信率。由于密钥对生成需要后文内容支持，lwl 将在稍后讲述如何添加 DKIM 记录。不过，可以先让你看看它大概长什么样：</p>
<pre><code>dkim._domainkey  IN TXT     &quot;v=DKIM1; k=rsa; t=s; s=email; p=...&quot;
</code></pre>
<h3>DMARC</h3>
<p>DMARC 记录用来指示收件方对 SPF 或 DKIM 检查情况的响应方式。由于 lwl 搭建只是作为系统发信使用，所以一步到位上了最严格的方式，即 DKIM / SPF 校验不通过就直接拒信（连对方垃圾箱都进不去）。具体配置条目如下：</p>
<pre><code>_dmarc TXT &quot;v=DMARC1; p=reject; pct=100;&quot;
</code></pre>
<p>完成前置准备后，就可以开始进行安装了。</p>
<h1>安装</h1>
<h2>Docker</h2>
<p>Mailcow-dockerized 是基于 Docker 的项目，因此需要先安装 Docker。这不是本文的重点，如果有任何出错情况请自己多搜索一下（问我也没用我也不会）<br />
在 BASH 执行以下指令即可完成安装：</p>
<pre><code>curl -sSL https://get.docker.com/ | sh
</code></pre>
<h3>Docker-Compose</h3>
<p>还需要安装一个似乎是 Docker 包管理器的程序：</p>
<pre><code>curl -L https://github.com/docker/compose/releases/download/$(curl -Ls https://www.servercow.de/docker-compose/latest.php)/docker-compose-$(uname -s)-$(uname -m) &gt; /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
</code></pre>
<h2>Mailcow</h2>
<p>终于到了今天的主角了，下面就来开始安装 Mailcow！</p>
<h3>准备文件</h3>
<p>使用 Git 下载相关文件即可：</p>
<pre><code>git clone https://github.com/mailcow/mailcow-dockerized &amp;&amp; cd mailcow-dockerized
</code></pre>
<h3>生成配置文件</h3>
<p>执行以下命令来生成配置文件。当要求输入域名时，请输入前文 rDNS 中设置的那个。（如果没设置 rDNS，请保证你输入的域名符合 FQDN 格式。如果你设置了 rDNS，服务商应该会保证你的格式符合 FQDN）</p>
<pre><code>./generate_config.sh
</code></pre>
<blockquote><p>
  如有需要，可以修改 <code>mailcow.conf</code> 中的配置项
</p></blockquote>
<h3>拉取镜像并启动 mailcow</h3>
<p>马上就要完成了！输入以下指令下载相关镜像并启动 mailcow：</p>
<pre><code>docker-compose pull
docker-compose up -d
</code></pre>
<h2>Done!</h2>
<p>访问你之前输入的域名，就应该能看到 mailcow 的后台了。使用默认帐号 <code>admin</code> 和密码 <code>moohoo</code> 登录后台。</p>
<h1>进一步配置</h1>
<p>先修改掉默认的帐号和密码，如果想进一步提高安全性，设置两步验证（OTP），然后继续下面的步骤吧~</p>
<h2>添加域名</h2>
<p>选择顶部导航栏上的 Configuration -&gt; Mailboxes -&gt; Add domain 来添加一个域名</p>
<h2>设置 DKIM</h2>
<p>添加完域名后，我们终于可以完成上面没有设置完成的 DKIM 了。</p>
<p>回到 Configuration -&gt; Administration, 选择<strong>下方</strong>的 Configuration 选项卡，在 Add ARC/DKIM key 区域填写域名，选择密钥长度（如果 DNS 服务商可以支持 2048 位长密钥的公钥，选择 2048 更安全。如果不支持，那就只能选 1024 位了）。Selector 如果没有冲突，一般不需要修改。</p>
<p>设置完成后，在上方应该能看到类似下图的信息：<br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/snipaste20170910_224033-1024x126.png" /></p>
<p>前往 DNS 服务商，添加一条记录名为 <code>Selector</code> + ._domainkey. + <code>Domain （host）</code>，类型 <code>TXT</code>，记录值为灰色框内内容的记录。如上图应该添加记录名为 <code>dkim._domainkey</code>，记录值为灰框内容的记录即可。如果上图中 Domain 改为 <code>mail.example.com</code> ，则相对应的，记录名应改为 <code>dkim._domainkey.mail</code>。</p>
<h2>添加用户</h2>
<p>再次前往 Mailboxes 页面，选择 Add mailbox 并填写相关信息即可。</p>
<blockquote><p>
  至此，您应该可以开始发送邮件了。用上面的信息通过 SMTP 发信试试吧！
</p></blockquote>
<h2>IPv6</h2>
<p>对于有 IPv6 地址的服务器，可编辑 <code>data/conf/postfix/main.cf</code>，搜索 <code>smtp_address_preference</code> 配置项，将其值改为 <code>ipv6</code> 以优先使用 v6 地址发信。<br />
修改后执行 <code>docker-compose restart</code> 重启即可。</p>
<h2>匿名化发送人</h2>
<p>为了避免 IP 暴露可能引起的攻击，你可能使用了 CDN 等技术保护了后端 IP。但是在默认情况下，使用 SMTP 连接到邮件系统发信时，会将请求发信的 IP 信息写入邮件头中。使用下列步骤来去除这些信息：</p>
<p>新建 <code>data/conf/postfix/mailcow_anonymize_headers.pcre</code>，写入以下内容：</p>
<pre><code>/^\s*Received:[^\)]+\)\s+\(Authenticated sender:(.+)/
    REPLACE Received: from localhost (localhost [127.0.0.1]) (Authenticated sender:$1
/^\s*User-Agent/        IGNORE
/^\s*X-Enigmail/        IGNORE
/^\s*X-Mailer/          IGNORE
/^\s*X-Originating-IP/  IGNORE
/^\s*X-Forward/         IGNORE
</code></pre>
<p>然后编辑 <code>data/conf/postfix/main.cf</code>，加入一句</p>
<pre><code>smtp_header_checks = pcre:/opt/postfix/conf/mailcow_anonymize_headers.pcre
</code></pre>
<p>最后执行 <code>docker-compose restart</code> 重启即可。</p>
<h2>设置 No Reply 邮箱</h2>
<p>一般系统发信的邮箱是没人去看内容的，这时有必要设置拒绝所有来信。<br />
在 mailcow 后台找到 SOGo 页面，登录要设置 no-reply 的帐号，选择左侧栏的设置 -&gt; Mail -&gt; FILTERS，按下图设置（其中 message 可以自己编一条）<br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/snipaste20170910_222737.png" /></p>
<h2>让 WordPress 使用 SMTP 发信</h2>
<pre><code>global $phpmailer;
add_action('phpmailer_init', function (&amp;$phpmailer) {
    $phpmailer-&gt;isSMTP();
    $phpmailer-&gt;Host = '你的邮件服务器地址';
    $phpmailer-&gt;Port = &quot;465&quot;; //使用 SSL 端口连接
    $phpmailer-&gt;SMTPAuth = true;
    $phpmailer-&gt;Username = &quot;上文设置的用户名&quot;;
    $phpmailer-&gt;Password = '和密码';
    $phpmailer-&gt;SMTPSecure = 'ssl'; //使用 SSL 加密
    $phpmailer-&gt;From = &quot;发送人邮件地址&quot;;
    $phpmailer-&gt;FromName = &quot;发送人名称&quot;;
});
</code></pre>
<p>将以上内容加入主题的 <code>function.php</code> 即可</p>
<h1>一些跑题的事情</h1>
<p>至此全文的主要内容结束啦！去 <a href="https://www.mail-tester.com">Mail Tester</a> 试试能拿多少分吧~<br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/snipaste20170910_231242-1024x990.jpg" /></p>
<p>其实这篇文章刚开始写的时候标题打算叫 “欢迎来到实力至上主义的邮局”的（ 后来觉得太尴尬了就还是没用……<br />
于是下面是原定的两张题图，<del>辛辛苦苦做了不发出来也太可惜了</del><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/photo_2017-09-10_23-17-41.jpg" /><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/photo_2017-09-10_23-17-48.jpg" /></p>
<p>最后，安利一下<a href="https://bangumi.bilibili.com/anime/6339">欢迎来到实力至上主义的教室</a>这部番！超好看 233，本文的第一首 BGM 就是这部番的 ED 了！<br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/09/%E3%82%88%E3%81%86%E3%81%93%E3%81%9D%E5%AE%9F%E5%8A%9B%E8%87%B3%E4%B8%8A%E4%B8%BB%E7%BE%A9%E3%81%AE%E6%95%99%E5%AE%A4%E3%81%B8-1024x580.png" /></p>
<p>- EOF -</p>]]></content>
        
        <summary type="html">
            
            咋回事啊 LWL 之前用过很多家的邮件服务。腾讯云企业邮箱、阿里云邮、ZOHO Mail、Submail (Push)…… 但是由于各种各样的原因，这些邮局都没能让我满意（例如国内大部分邮件服务甚至都不支持 DKIM 这种基础功能），于是咱决定自建一台邮件服务器。   前置准备
            
        </summary>
        
        <category term="程序"/>
        
        <category term="Mail"/>
        
        <category term="MTA"/>
        
    </entry>
    
    <entry>
        <title>小米降噪耳机评测</title>
        <link href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html"/>
        <id>https://blog.nfz.moe/archives/xiaomi-anc-earphone.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-09-10T10:16:00+00:00</published>
        <updated>2017-09-10T10:16:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>在同学的安利之下，我剁手了一副小米降噪耳机 Type-C 版。</p><a></a><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 开箱图"></a>开箱图</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000164.jpg" /></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000165.jpg" /></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000166.jpg" /></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000167.jpg" /></p><p>包装盒左下角的金标很醒目，实际上也就是玄学加成而已。。<br />包装盒里的配件包括：</p><ul><li>耳机本身</li><li>3 对硅胶套</li><li>2 对空气耳套</li><li>1 个布制随身袋</li></ul><p>小米耳机上部使用塑胶线，下部使用编织线。总的来说，小米降噪耳机整体做工可以的。我买的是黑色款，做工还算细致，整体上来讲并不简陋。由于使用 Type-C 供电，也就免去了常见主动降噪耳机中颇影响美观的电池盒。</p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 参数"></a>参数</h1><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>耳机类型</td><td>入耳式</td></tr><tr><td>喇叭阻抗</td><td>32Ω</td></tr><tr><td>产品净重</td><td>20g</td></tr><tr><td>连接线长</td><td>1.25m</td></tr><tr><td>插头类型</td><td>USB Type - C</td></tr><tr><td>额定功率</td><td>5mW</td></tr><tr><td>执行标准</td><td>Q / WMSX 004 - 2016</td></tr><tr><td>频响范围</td><td>20 - 40000Hz</td></tr><tr><td>耳机灵敏度</td><td>113dB</td></tr><tr><td>尺寸</td><td>77 * 120 * 30mm</td></tr></tbody></table><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 体验"></a>体验 </h1><h2><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 使用体验"></a> 使用体验 </h2><p> 我主要拿小米降噪耳机搭配我的 一加三 使用。目前系统是 Mokee Unofficial。<br />开启主动降噪后耗电并没有明显增加，属于正常水平。<br />线控的音量加减和播放暂停都可以正常使用；使用网易云音乐时不能使用按两次下一曲、按三次上一曲，但是可以用长按音量键切歌。<br />在一加三上，小米降噪耳机无法在通话中使用。来电话无法用线控接听和挂断、通话中耳机没有声音、对方也听不到任何声音。</p><h2><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 降噪效果"></a>降噪效果 </h2><p> 开启线控上的开关之后 主动降噪发挥一定作用，加上入耳式耳塞和空气气囊，晚自习时班上的喧闹声基本都被削弱了：能明显感觉到背景声音变小甚至消失，但耳压感觉正常、不是把耳朵捂住的那种感觉，但是说话声和其它比较尖锐的声音的降噪效果不明显。<br />个人认为，小米降噪耳机的降噪能力还算是过关的，至少声音是相对纯净的、也不需要在公共场合时刻意提高耳机的音量了。</p><h2><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 音质音色"></a>音质音色 </h2><p> 音质的话，高 / 中频可以接受；高音偏弱但明显，低频推力不是太够；音色上小米降噪耳机偏清亮、有些粗糙，而一加银耳相对偏浑厚和圆润，可能是我没有煲过小米降噪耳机的缘故。</p><h1><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 测试曲目"></a>测试曲目 </h1><p> 光说感觉无益，直接上测试曲目。</p><h3><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 纯音乐测试"></a>纯音乐测试</h3><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html#You"></a>You</h4><div></div><p>在《You》上，小米降噪耳机的解析度并不差，但是节拍和鼓点的效果不如一加银耳。一加银耳对《You》的表现平平常常，小米降噪耳机的清亮的音色发挥得不错。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html#Relentless-WhiteRose-RWBY-doujin-remix"></a>Relentless-WhiteRose [RWBY doujin remix]</h4><div></div><p>在《Relentless-WhiteRose》中小米降噪耳机的高音段的缺陷变得明显一些，而一加银耳的表现还是一贯地出色，Nubia 的圈铁表现显然更好，声音让人听得舒服。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html#Leevis"></a>Leevis</h4><div></div><p>小米降噪耳机在《Leevis》上的表现得偏尖锐、鼓点表现不够有力，但是解析力还是足够的。Nubia 圈铁耳机音色偏厚重，解析度不错，也不会显得刺耳。</p><h3><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 人声测试"></a>人声测试 </h3><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 记忆回收"></a> 记忆回收</h4><div></div><p>可以明显听出，小米降噪耳机明显和一加银耳的音色上有明显的区别，一加银耳的声音更真实和圆润，对于阿绫的声音还原较为真实。小米耳机表现偏飘，而 Nubia 圈铁在人声的表现很不赖。几种耳机各有千秋。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 残月雪"></a>残月雪</h4><div></div><p>《残月雪》中阿绫的高音部分中，一加银耳显然相对失真少（但是一加银耳高音性能还是比不上 Nubia 红魔）、声音也偏浑厚一些，但是高音有些失真；小米降噪耳机会颇清亮一些，高音发挥不错。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 八重回归·伪"></a>八重回归·伪</h4><div></div><p>在《八重回归》上，小米降噪耳机和一加银耳的表现效果各有千秋。小米降噪耳机声音显得更通透一些；Nubia 圈铁的还原效果更好、更清晰，相比之下小米降噪耳机显得偏飘。</p><h4><a href="https://blog.nfz.moe/archives/xiaomi-anc-earphone.html# 将死"></a>将死</h4><div></div><p>小米降噪耳机的低频段有些推力不足，在《将死》上显得有些飘，一加银耳的浑厚圆润的音色在低音段发挥优秀。而 Nubia 圈铁耳机表现优秀，解析度和低音表现出色。</p><hr /><p>总的来说，小米降噪耳机表现平平，在低音表现不足，但在高音段和人声表现还是说得过去的。可能小米对降噪耳机在 <em>流行、人声 </em> 这一块做了一定打磨，但是音质上普遍不如一加银耳，在听觉感受上也不如 Nubia 圈铁有优势。但是听耳机也是耳机听你的过程。适应以后，小米降噪耳机也不是不能接受。<br /> 个人觉得小米降噪耳机，价格能接受，音质尚可，做工不错。如果只是希望在通勤或者旅行中听听歌舒缓心情、或者主要用于削弱外界的骚扰（比如晚自习时的喧闹），那么小米降噪耳机还是可以成为一种选择。如果你对音质有更高的要求、或者不满意小米降噪耳机的音色，那么你完全可以去选择其它耳机。</p><blockquote><p>以上评测完全基于个人，不保证完全公正、客观。玄学的东西，八千以下都是听个响嘛。。</p></blockquote>]]></content>
        
        <summary type="html">
            
            在同学的安利之下，我剁手了一副小米降噪耳机 Type-C 版。开箱图包装盒左下角的金标很醒目，实际上也就是玄学加成而已。。包装盒里的配件包括：耳机本身3 对硅胶套2 对空气耳套1 个布制随身袋小米耳机上部使用塑胶线，下部使用编织线。总的来说，小米降噪耳机整体做工可以的。我买的是
            
        </summary>
        
        <category term="分享镜"/>
        
        <category term="耳机"/>
        
        <category term="评测"/>
        
        <category term="小米降噪耳机"/>
        
    </entry>
    
    <entry>
        <title>微博图片反查上传者</title>
        <link href="https://i-meto.com/weibo-pic-author/"/>
        <id>https://i-meto.com/weibo-pic-author/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-09-04T16:02:00+00:00</published>
        <updated>2017-09-04T16:02:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>消息来源于 <a href="https://www.v2ex.com/t/388152">https://www.v2ex.com/t/388152</a></p>
<p>大概就是上传到微博的图片，在 URL 中会带上一串用户的 uid 标识。</p>
<p>比方说 <a href="http://wx1.sinaimg.cn/mw690/9d0d09abgy1fj0wcs7aewj20ij0sn12y.jpg">http://wx1.sinaimg.cn/mw690/9d0d09abgy1fj0wcs7aewj20ij0sn12y.jpg</a> 这张图片，提取文件名前 8 位 9d0d09ab，以 16 进制转成 10 进制后就可以得到用户 uid: 2634877355</p>
<p>看完感觉很震惊，马上关闭了 API 站的一个图床接口，从今天开始替换所有微博图床的图片。<br />
安利一下兽兽的图床：<a href="https://sm.ms">https://sm.ms</a></p>
<hr />
<p>一个赶工出来的反查器<br />
</p>
<p></p>
</div>]]></content>
        
        <summary type="html">
            
            消息来源于 https://www.v2ex.com/t/388152 大概就是上传到微博的图片，在 URL 中会带上一串用户的 uid 标识。 比方说 http://wx1.sinaimg.cn/mw690/9d0d09abgy1fj0wcs7aewj20ij0sn12y.j
            
        </summary>
        
    </entry>
    
    <entry>
        <title>随时随地 Hexo——我是如何使用 Hexo 的</title>
        <link href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html"/>
        <id>https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-09-01T04:53:27+00:00</published>
        <updated>2017-09-01T04:53:27+00:00</updated>
        
        <content type="html"><![CDATA[<p>Hexo 是一个使用 Node.js 作为构建引擎的极速、简单且强大的静态博客架构。但 Hexo 只有在安装了 Hexo 的环境上才能运行。于是我设计了一套实现 Hexo 随时随地部署、随时随地发布的方案。</p><a></a><h1><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 同步 -Hexo- 工程"></a>同步 Hexo 工程</h1><p>Hexo 和基于数据库的动态博客或者动静分离的博客不同，博客的文章等并不是储存在数据库中，而是由主题仓库、配置的 yml 文件，还有文章的 markdown 文件组成。这些我们称作是 Hexo 的工程文件。</p><h2><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 初始化 -Hexo- 工程文件"></a>初始化 Hexo 工程文件 </h2><p> 安装完 Hexo 后，博客的目录中会包括以下内容：</p><pre><code>$ <span>ls</span> -latotal 2043drwxr-xr-x 1 Admin 197121       0 5 月   1 09:28 ./drwxr-xr-x 1 Admin 197121       0 4 月  30 19:45 <span>..</span>/drwxr-xr-x 1 Admin 197121       0 5 月   1 11:03 .git/-rw-r--r-- 1 Admin 197121      65 4 月   5 03:16 .gitignore-rw-r--r-- 1 Admin 197121    2124 4 月  30 23:03 _config.yml-rw-r--r-- 1 Admin 197121 1725099 5 月   1 10:39 db.json-rw-r--r-- 1 Admin 197121   45375 4 月  22 13:04 debug.logdrwxr-xr-x 1 Admin 197121       0 4 月  28 22:31 drafts/drwxr-xr-x 1 Admin 197121       0 5 月   1 09:19 node_modules/-rw-r--r-- 1 Admin 197121     796 5 月   1 09:27 package.jsondrwxr-xr-x 1 Admin 197121       0 5 月   1 09:28 public/drwxr-xr-x 1 Admin 197121       0 4 月   5 03:16 scaffolds/drwxr-xr-x 1 Admin 197121       0 4 月  29 12:08 source/drwxr-xr-x 1 Admin 197121       0 4 月  30 23:03 themes/<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这就是博客工程文件了。</p><p>同步文件的方法有很多种，常见的就是通过 云盘 同步和通过 Git 管理。<br />在这里我介绍的是通过 Git 管理和同步博客的工程文件。</p><blockquote><p>当然，Git 是 Hexo 的 dependencies，如果你装好了 Hexo，你肯定也装好了 Git。</p></blockquote><p>在你的 Hexo 的目录下使用 <code>git init</code> 初始化一个 Git 仓库。并在 <code>.gitignore</code> 中填入以下内容来排除不需要同步的部分：</p><pre><code>.DS_StoreThumbs.dbdb.json*.lognode_modules/public/.deploy*/</code></pre><p>然后自然是 <code>git remote add</code> <code>git add .</code> <code>git commit -m</code> <code>git push</code> 将你的博客工程文件推送到远端 Repo 当中。我的博客工程文件托管在 Coding 和 Gitlab 的私有库中。</p><h2><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 同步 -Hexo- 到另一台设备"></a>同步 Hexo 到另一台设备 </h2><p> 一般教程上介绍的都是需要在远端重新安装一遍完整的 Hexo 并也初始化一个 Git 仓库，还需要 <code>git reset --hard</code> 来重置。。。我介绍另一种办法。</p><p>首先，在另一台终端上，使用 <code>npm install hexo-cli -g</code> 安装 Hexo 的基本命令行。这个是需要全局安装的。</p><blockquote><p>如果你安装了其它辅助工具，如我使用了 gulp 压缩 html，这时候就又需要额外全局安装 gulp。</p></blockquote><p>新建一个目录，并使用 <code>git clone</code> 将你的博客远端文件拉下来。cd 到你 clone 下来的目录里，直接使用 <code>npm install</code> 安装依赖。</p><blockquote><p>这一步中 npm 会使用 <code>package.json</code> 安装依赖。<code>package.json</code> 里面已经保存了 Hexo 的必备资源包信息, 包括基本的 Hexo、你曾经安装过的插件等等。<code>npm install</code> 后 Hexo 环境就建立起来了。</p></blockquote><p>等安装完了以后，迁移就完成了。以后在不同的设备上管理 Hexo 就像和管理 Git Repo 一样，使用 <code>git pull</code> <code>git add</code> <code>git commit</code> <code>git push</code> 指令即可。</p><p>我后来编写了一个 shell 脚本，可以实现在任何安装了 Git、Nodejs 的终端上完成一键安装 <code>hexo-cli</code> <code>gulp</code> 和执行 <code>npm install</code>（懒喵）</p><hr /><p>Hexo 有一个算不上坑的地方，<code>page.updated</code> 函数当没有在 <code>front-matter</code> 定义时，是会跟随本地文件的改动日期而变动的。所以在多设备间同步 Hexo 时，需要为每篇文章指定 <code>page.updated</code> 的 <code>front-matter</code>。</p><h2><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 在移动端使用 -Hexo"></a>在移动端使用 Hexo</h2><p>如果你想在移动端安装 Hexo，你可以读一读这篇文章：<a href="http://droid-max.github.io/2016/12/01/Share-1/" target="_blank">《手机端部署 hexo 博客到 GithubPage》</a></p><p>但是，我并不建议这么做：手机端运行的速度远远不如电脑端，甚至不如 CI。我在手机端运行一次 <code>hexo g</code> 需要花费 37s，在 CI 只需要 11s，在我的电脑上是 2.7s。所以我在移动端依然是用 Git 管理 Hexo，然后，将页面生成的部分交给 CI 平台。这就是我接下来要讲的：</p><h1><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 用 -CI- 实现 -Hexo- 持续集成"></a>用 CI 实现 Hexo 持续集成 </h1><p> 在一些情况下，你不能在某个设备上安装 Hexo，比如公共电脑之类的，有时你甚至只能在代码托管的网页端用 Web Editor 修改和发布博客。这样如何实现 Hexo 的发布呢？<br />你需要借助 CI，借助 CI 可以实现静态页面在远端生成和自动远端部署。</p><p>如何在 CI 平台上部署 Hexo，你可以阅读我的下列文章：</p><ul><li><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html">《Hexo 持续自动化部署》</a></li><li><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html">《用 Flow.CI 让 Hexo 持续集成》</a></li><li><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html">《使用 Gitlab CI 实现 Hexo 持续部署》</a></li><li><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html">《使用 Travis CI 持续构建 Hexo》</a></li></ul><blockquote><p>你也可以将持续集成移植到 Travis CI 或者其它 CI 平台中。在 CI 安装 Hexo 和同步工程文件的过程可以参考本文之前的“同步 Hexo 到另一台设备”。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html# 部署 -Hexo"></a>部署 Hexo</h1><p>如果你的博客是直接在部署到 Pages 服务上的话，那么就没什么需要担心的了。因为绝大部分 Pages 都支持 Git 部署。你只要根据文档配置 <code>hexo-deploy-git</code> 即可。<br />但是我的博客部署在自己独立的 WebServer 上，所以需要把生成的静态页面部署到我的 WebServer。为了安全，我没有直接在 WebServer 上部署 Repo，这样就不能直接一步到位地把静态页面 deploy 到 WebServer 上。</p><p>所以，这就是我的方案：<br />首先，我需要将我生成的页面部署到一个公开的 Git Repo 中，在这里我选择了 Github 新建一个 Repo。至于部署方式，我之前选择使用 SSH 连接 Github 的 Repo，后来改成使用 Github 的 <code>Personal access token</code> 来获得对 Repo 的写入权限。</p><p>通过 CI 的环境变量保管 SSH 或者 <code>Personal access token</code> 是最安全的选择。在 CI 的后台添加一个环境变量，将 <code>Personal access token</code> 写入其中。然后新建一个 <code>deploy.sh</code> 文件，写入以下内容：</p><pre><code><span>cd</span> ./public <span>#生成的静态页面会存储在 public 目录下</span><span>git</span> init<span>git</span> config --global push.default matching<span>git</span> config --global user.email <span>&quot;username@example.com&quot;</span> <span>#填入 GitHub 的邮箱地址</span><span>git</span> config --global user.name <span>&quot;username&quot;</span> <span>#填入 GitHub 的用户名</span><span>git</span> add --all <span>.</span> <span>#提交所有内容</span><span>git</span> commit -m <span>&quot;Site updated with CI&quot;</span> <span>#自动构建后的内容将全部以此信息提交</span><span>git</span> push --quiet --force https://<span>{</span>设置的环境变量名<span>}</span><span>}</span>@github.com/ 你的 GitHub 用户名 / 你的代码仓库名.git master<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>使用 SSH 也可以通过类似的方案实现。</p></blockquote><p>在 CI 的 workflow 中调用这个脚本即可实现 <code>hexo-deploy-git</code> 的效果。</p><blockquote><p>由于我在使用 Gitlab 的私有库保管工程文件，使用 Gitlab CI 持续集成。所以我直接“肆无忌惮”地直接 <code>hexo d</code> 的目标 <code>{Personal access token}@github.com/neoFelhz/MyBlog.git</code> 写进了 <code>hexo-deploy-git</code> 的配置中。严格来讲，这是非常不安全的。</p></blockquote><p>然后，在 WebServer 上部署一个 WebHook，然后在 Github 的 Repo 设定中添加该 WebHook，这样可以实现 Github 上 Repo 有更新时通知 WebServer 拉去静态页面的内容到 WebServer。</p>]]></content>
        
        <summary type="html">
            
            Hexo 是一个使用 Node.js 作为构建引擎的极速、简单且强大的静态博客架构。但 Hexo 只有在安装了 Hexo 的环境上才能运行。于是我设计了一套实现 Hexo 随时随地部署、随时随地发布的方案。同步 Hexo 工程Hexo 和基于数据库的动态博客或者动静分离的博客不
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="博客"/>
        
        <category term="Hexo"/>
        
        <category term="Git"/>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（2）——分析 Prefetch</title>
        <link href="https://blog.nfz.moe/archives/wpo-by-prefetch.html"/>
        <id>https://blog.nfz.moe/archives/wpo-by-prefetch.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-09-01T04:48:18+00:00</published>
        <updated>2017-09-01T04:48:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>对于文件的预加载的作用并不是直接加快网站的加载速度。预加载是提前准备好你所需要的资源，然后当需要的时候即可直接调用、直接完成页面的渲染，不造成阻塞。</p><a></a><h1><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html# 常见 -Prefetch- 用法"></a>常见 Prefetch 用法 </h1><p> 资源预加载是另一个性能优化技术，我们可以使用该技术来预先告知浏览器某些资源可能在将来会被使用到。如果我们正确使用这些预获取技术，可以显著提升用户的体验。</p><h2><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html#DNS- 预解析 -Prefetch"></a>DNS 预解析 Prefetch</h2><p>DNS 预解析告诉浏览器将来我们可能会从哪里获取文件，从而提前完成 <code>DNS Look Up</code> 的操作。这意味着当浏览器真正请求该域中的某个资源时，DNS 的解析就已经完成了。<br />实现 DNS-Prefetch 只需要在 <code>&lt;head&gt;</code> 内加入：</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>dns-prefetch<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>//example.com<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>实际上，单纯执行 DNS-Prefetch 只能够微小的提升浏览性能，因为大部分现代浏览器也都内置了预解析的功能，<del>甚至在你在地址栏输入域名时就完成了预解析。开启这个优化算是聊胜于无吧。</del><br />更正一下，后来我阅读了 Chormium 的文档，得到以下信息：</p><ul><li>不用对超链接做手动 dns prefetching，因为 chrome 会自动做 dns prefetching</li><li>chrome 会自动把当前页面的所有带 href 的 link 的 dns 都 prefetch 一遍</li><li>但是。对于一些需要跳转的域名做好预解析，最多可以减少 300~500ms 的加载时间<br />2017.09.01 更新：查了一些有关文档，Chrome 在一个域下最多只会对 8 个域名做预解析。</li></ul></blockquote><h2><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html# 预连接 -Preconnect"></a>预连接 Preconnect</h2><p>和 DNS 预解析有些类似，不过 Preconnect 的预连接的特点在于不仅完成 DNS 预解析，同时还将进行 TCP 握手和建立传输层协议，预先建立 socket 连接，从而消除昂贵的 DNS 查找、TCP 握手和 TLS 往返开销。<br />实现 <code>Preconnect</code> 只需要在 <code>&lt;head&gt;</code> 中加入：</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preconnect<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>http://example.com<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>2017.09.01 更新：在最近的测试中，Chrome 似乎不会对 Chrome 预先完成 TLS 握手。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html# 预获取 -Prefetching"></a>预获取 Prefetching</h2><p>如果我们确定某个资源将来一定会被使用到，我们可以让浏览器预先请求并下载该资源并放入浏览器缓存中。<br />Prefetching 有两种用法。其中 <code>prefetch</code> 为将来的页面提供了一种低优先级的资源预加载方式，而 <code>subresource</code> 为当前页面提供了一种高优先级的资源预加载。所以，如果资源是当前页面必须的，或者资源需要尽快可用，那么最好使用 <code>subresource</code>。用法如下：</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>prefetch<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>image.png<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>subresource<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>styles.css<span>&quot;</span></span><span>&gt;</span></span><span><span></span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html#Can-I-Use"></a>Can I Use?</h1><ul><li>DNS Prefetch</li></ul><p><a href="http://caniuse.com/#feat=link-rel-dns-prefetch" target="_blank">http://caniuse.com/#feat=link-rel-dns-prefetch</a></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000074.png" /></p><ul><li>Preconnect</li></ul><p><a href="http://caniuse.com/#feat=link-rel-preconnect" target="_blank">http://caniuse.com/#feat=link-rel-preconnect</a></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000075.png" /></p><ul><li>Prefetching</li></ul><p><a href="http://caniuse.com/#feat=link-rel-prefetch" target="_blank">http://caniuse.com/#feat=link-rel-prefetch</a></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000076.png" /></p><blockquote><p>连 IE 都支持了，Safari 和 iOS 你个辣鸡~</p></blockquote><ul><li>Subrecource</li></ul><p><a href="http://caniuse.com/#feat=subresource-integrity" target="_blank">http://caniuse.com/#feat=subresource-integrity</a></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000077.png" /></p><h1><a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html# 实际意义"></a>实际意义 </h1><p> 介绍了这么多，预加载和预解析有什么用呢？</p><p>首先，大家通常知道 <code>&lt;script&gt;</code> 标签有必要放在 <code>&lt;body&gt;</code> 的尾部，css 要尽可能早的加载，这已经是“业界规范”了。</p><p>但无论如何不可否认，CSS 严重影响网站的渲染，所有 CSS 尽早加载是减少首屏时间的最关键。那么在浏览器加载 DOM 树时预加载 CSS 文件可以加快网站加载速度。<br />既然 Web 性能优化的手段并不是非黑即白的，对于 JS 的意见不一，预加载也不是什么坏事，尤其是使用了 CDN 从引用 JS。</p><p>还有 Fonts。Fonts 大部分都是 DOMLoad 以后才会开始加载的。所以我们可以通过预加载的方式获取到字体，这样 DOMLoad 完用字体对页面进行重新渲染时就不需要再发起请求加载字体。</p><blockquote><p>在 Preload 草案提出和得到支持以前，WebView 优化的各种奇技淫巧中中有专门在首次加载时建立一个 1px 的 iframe 专门用于放置 Prefetch 标签的，服务端通过 cookie 进行判断。</p></blockquote><p>实际运用时，要根据实际情况使用预加载和预解析的技巧，可以有效加快网站访问速度。</p><hr /><p>本文参考资料</p><ul><li><a href="http://bubkoo.com/2015/11/19/prefetching-preloading-prebrowsing/" target="_blank">前端性能优化 - 资源预加载</a></li><li><a href="http://delai.me/code/dns-prefetching/" target="_blank">预加载系列一：DNS Prefetching 的正确使用姿势</a></li><li><a href="https://developers.google.com/web/fundamentals/" target="_blank">Google Web Fundamentals</a></li></ul>]]></content>
        
        <summary type="html">
            
            对于文件的预加载的作用并不是直接加快网站的加载速度。预加载是提前准备好你所需要的资源，然后当需要的时候即可直接调用、直接完成页面的渲染，不造成阻塞。常见 Prefetch 用法  资源预加载是另一个性能优化技术，我们可以使用该技术来预先告知浏览器某些资源可能在将来会被使用到。如
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="HTTPS"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="Resource Hint"/>
        
        <category term="Prefetch"/>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（1）——浅尝 Service Worker</title>
        <link href="https://blog.nfz.moe/archives/wpo-by-service-worker.html"/>
        <id>https://blog.nfz.moe/archives/wpo-by-service-worker.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-09-01T04:48:17+00:00</published>
        <updated>2017-09-01T04:48:17+00:00</updated>
        
        <content type="html"><![CDATA[<p>静态内容非常适合做缓存来加速页面的访问，除了使用 CDN 实现加速之外，通过客户端也可以实现更好的访问体验。本文就利用 Service Worker 来探讨基于静态资源的加速方案。</p><a></a><blockquote><p><del>ServiceWorker 对动态页面依然有效，但是效果不如静态站效果显著。</del><br />对于动态页面，Google 推出了 sw-toolbox，借助 Service Worker 的一系列接口实现了更强的缓存 API 和网络加载请求处理，使其能适合动态页面缓存。我也在《<a href="https://blog.nfz.moe/archives/sw-toolbox-practice.html">本博客对 sw-toolbox 的实践</a>》一文中介绍了 sw-toolbox。我推荐无论是静态站还是动态站，都使用 sw-toolbox。</p></blockquote><p>Service worker 是 PWA 这类 WebApp 的重要支持，因为可以使 web 支持离线体验。除此以外，Service Worker 还支持通知推送和后台同步。当然这里我们用的是它离线加载的特性来优化网站体验。</p><h1><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html# 启用 -Service-Worker- 支持"></a>启用 Service Worker 支持 </h1><h2><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html# 在首页添加 -Service-Worker- 注册代码"></a> 在首页添加 Service Worker 注册代码</h2><pre><code><span><span><span>&lt;</span>script</span><span>&gt;</span></span>if ('serviceWorker' in navigator) {navigator.serviceWorker.register('/sw.js');}<span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码向下兼容 Service Worker，检测浏览器是否支持 Service Workers。如果支持就会根据 <code>sw.js</code> 注册 Service Workers 服务。如果浏览器不支持就不会注册。</p><h2><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html# 添加 -Service-Workers- 所需文件"></a>添加 Service Workers 所需文件 </h2><p> 你可以从 <a href="https://gist.github.com/neoFelhz/50800b701d00dc6d874be95da2cd7655" target="_blank"> 这里 </a> 下载到所需的文件，将其放在网站根目录下。</p><ul><li><code>sw.js</code></li><li><code>offline.svg</code></li><li><code>offline.html</code> 你可以用 Hexo 生成一个独立页面，也可以自己写一个。</li></ul><blockquote><p>由于 Service Worker 的离线加载特性，在浏览者离线以后依然可以访问已经缓存了的页面。但是对于没有缓存的页面和图片，你可以通过 <code>offline.svg</code> 和 <code>offline.html</code> 加以提示。</p></blockquote><p>修改 <code>sw.js</code> 中的下述内容。</p><pre><code><span>const</span> ignoreFetch <span>=</span> <span>[</span>  <span>/https?:\/\/cdn.bootcss.com\//</span><span>,</span>  <span>/https?:\/\/www.google-analytics.com\//</span><span>,</span>  <span>/chrome-extension:\/\//</span><span>,</span><span>]</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这部分定义了你不需要缓存的资源，用的是正则表达式对资源进行匹配。这里给出了按域名进行排除的例子。如果你无法判断哪些资源不需要缓存，请用 F12 打开 Dev Tools 的 Source 选项卡逐个加以筛选；如果还不会，就把你看到的所有不是源站的域名统统输进去。</p><h1><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html# 加速效果"></a>加速效果 </h1><p> 这是第一次访问的效果。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000071.png" /></p><p>可以看到，第一次访问不能算太理想，花费 1.39s 才完成了 DOMLoad，所需资源全部加载完实际上花了 1.69s。</p><blockquote><p>可以看到，实际上网络资源花费了 3.11s 才加载完。我特意截图了最后加载的几个有齿轮标识的资源。<del>这些是 ServiceWorker 在 <code>sw.js</code> 里加载的资源——offline.svg 和 offline.html。</del>博客更新以后，离线提示页面被下线，不会再加载 offline.svg 和 offline.html。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000072.png" /></p><p>这是第二次访问的效果。DOMLoad 只花费了 571ms，全部资源加载只需要 608ms。可以看到，很多资源 <code>from  ServiceWorker</code>。说明 ServiceWorker 拦截了请求，直接从 ServiceWorker 获得资源。</p><blockquote><p>看见没有？连 <code>blog.nfz.moe</code> 都被 ServiceWorker 拦截了，现在你知道为什么可以离线加载了吧。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html# 先决条件"></a>先决条件 </h1><h2><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html#HTTPS"></a>HTTPS</h2><p> 你的网站必须 <strong>完整使用  HTTPS 进行加密</strong>！ServiceWorker 一旦被注册，除非有进行定义、或者访问者手动在 Dev Tools 内 Unregister 了 ServiceWorker，否则你的资源都将被 ServiceWorker 接管，一旦访问者第一次加载资源时被攻击或者被劫持，后果则不堪设想。在开发过程中，可以通过 <code>localhost</code> 予以调试，但是生产环境必须高度可靠。</p><h2><a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html#Can-I-Use"></a>Can I Use?</h2><p><a href="http://caniuse.com/#feat=serviceworkers" target="_blank">http://caniuse.com/#feat=serviceworkers</a></p><p><img src="https://st.nfz.yecdn.com/img/blog/0000073.png" /></p><p>根据 Google 的文档表明，Chorme、Firefox 和 Opera 都支持；Microsoft Edge 现在表示公开支持。Safari 也暗示未来会进行相关开发。</p><hr /><p>参考文章：</p><ul><li><a href="https://yangbo.tech/2017/01/15/2017-01-15-speedy-and-offline-site-by-service-worker/" target="_blank">使用 Service worker 实现加速 / 离线访问静态 blog 网站</a></li><li><a href="https://www.anotherhome.net/2954" target="_blank">Service Workers 实现网站加速和离线缓存</a></li><li><a href="https://segmentfault.com/a/1190000008491458" target="_blank">Service Workers 与离线缓存</a></li></ul><p>以及 Google 的 <a href="https://developer.google.com/web/fundamentals/getting-started/primers/service-workers" target="_blank">ServiceWorker</a> 有关文档。</p>]]></content>
        
        <summary type="html">
            
            静态内容非常适合做缓存来加速页面的访问，除了使用 CDN 实现加速之外，通过客户端也可以实现更好的访问体验。本文就利用 Service Worker 来探讨基于静态资源的加速方案。ServiceWorker 对动态页面依然有效，但是效果不如静态站效果显著。对于动态页面，Goog
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="Service Worker"/>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（5）——Preload 和 Server Push</title>
        <link href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html"/>
        <id>https://blog.nfz.moe/archives/wpo-preload-serverpush.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-31T17:10:00+00:00</published>
        <updated>2017-08-31T17:10:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>相比使用 Prefetch 之类的技术让浏览器提前准备好将来需要的资源，Preload 是让浏览器在加载页面时提前准备好这个页面所需要的资源。</p><a></a><p>在之前的 <a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html">《Web 性能优化（2）——分析 Prefetch》</a> 中，我介绍了 Prefetch 对于前端优化的重要性。</p><p>在开发过程中，我们经常会碰到这样的情况，有些资源由于依赖管理、条件加载、加载顺序控制等等的原因，不需要立即在页面上执行，但是又需要尽早获取。<br />应对这类问题的传统的解决方案是：</p><ul><li>用 JS 动态地插入元素<ul><li>缺陷：script 不能延迟执行</li></ul></li><li>XMLHttpRequest 异步加载<ul><li>缺陷：浏览器无法根据资源类型进行预判并优化加载，造成性能问题；大量加载脚本会 Block 页面的加载进程。</li></ul></li></ul><blockquote><p>我在 <a href="https://blog.nfz.moe/archives/wpo-by-prefetch.html">《Web 性能优化（2）——分析 Prefetch》</a> 中，还介绍了一种针对 WebView 的奇技淫巧：服务端根据 cookie 判断页面是否为首次加载，如果是则会返回的 HTML 中包含一个 1px 的 iframe 用于承担 Prefetch 的代码片段。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html#Preload"></a>Preload</h1><p>Preload 是解决文首的问题的一个新的解决方案：</p><ul><li>与页面逻辑分离，基本不阻塞加载</li></ul><blockquote><p>指不影响页面加载进程。实际上 Preload 资源时会占用一部分带宽，在移动端上尤为明显</p></blockquote><ul><li>资源提前加载但不会被使用</li><li>优先级高，不像 Prefetch/Subresource 那般模棱两可</li></ul><h2><a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html# 使用方法"></a>使用方法 </h2><p> 使用 <code>&lt;link&gt;</code> 标签设置需要的预加载的元素。</p><ul><li>rel：<code>preload</code></li><li>href：用来定义需要 Preload 的资源。</li><li>as：用来指定资源的类型，使浏览器能够确定优先级、根据资源类型发送合适的 <code>Accept headers</code>、判断资源能否复用。</li></ul><blockquote><p>具体用法，可以查看一下 <a href="https://w3c.github.io/preload/" target="_blank"> W3C 关于 Preload 的标准</a></p></blockquote><h2><a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html# 使用场景"></a>使用场景</h2><ul><li>加载”隐性“资源</li></ul><p>一些非标签资源，比如在 css 内定义的资源如图片。由于“隐藏”在 css 中，大部分浏览器不能判断资源优先级，所以导致 css 中的资源优先级不够高、被“搁浅”。</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>logo-island.png<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>image<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><ul><li>加载字体</li></ul><p>加载字体的规则异常复杂。有些重要的字体等到真正加载的时候已经晚了。</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>MaterialIcons-Regular.woff2<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>font<span>&quot;</span></span> <span>type</span><span><span>=</span><span>&quot;</span>font/woff2<span>&quot;</span></span> <span>crossorigin</span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>需要注意，字体即使符合同源策略也需要加上 crossorigin 属性。</p></blockquote><ul><li>JS 的只加载而不执行</li></ul><pre><code><span>var</span> preload <span>=</span> document<span>.</span><span>createElement</span><span>(</span><span>'link'</span><span>)</span><span>;</span>preload<span>.</span>href <span>=</span> <span>'https://cdn.bootcss.com/fullPage.js/2.9.4/jquery.fullpage.min.js'</span><span>;</span>preload<span>.</span>rel <span>=</span> <span>'preload'</span><span>;</span>preload<span>.</span><span>as</span> <span>=</span> <span>'script'</span><span>;</span>document<span>.</span>head<span>.</span><span>appendChild</span><span>(</span>preload<span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>script<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>https://cdn.bootcss.com/fullPage.js/2.9.4/jquery.fullpage.min.js<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><ul><li>基于标签实现的 css 异步加载</li></ul><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>style<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>async_style.css<span>&quot;</span></span> <span>onload</span><span><span>=</span><span>&quot;</span>this.rel<span>=</span><span>'</span>stylesheet<span>'</span><span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>渲染页面框架的重要 css 不建议异步引入；如果 css 加载过慢或者 onload 不能及时触发会导致页面抖动。<br />这是一个很有意思的设计，是比 loadcss 更简单的 css 异步加载方案。比如使用这种方法加载谷歌字体库的字体 css，可以避免因为访客连通性不佳而彻底影响页面内容的渲染。</p></blockquote><ul><li>响应式加载</li></ul><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>image<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>map.png<span>&quot;</span></span> <span>media</span><span><span>=</span><span>&quot;</span>(max-width: 600px)<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>preload<span>&quot;</span></span> <span>as</span><span><span>=</span><span>&quot;</span>script<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>map.js<span>&quot;</span></span> <span>media</span><span><span>=</span><span>&quot;</span>(min-width: 601px)<span>&quot;</span></span><span>&gt;</span></span><span><span></span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html#Server-Push"></a>Server Push</h1><p>Server Push 是 HTTP2 的一项新特性。当客户端请求 HTML 文件时，服务端同时将其它重要资源随 HTML 在同一个资源中一并发送给用户。这样不仅节省了请求，还避免了重要资源阻塞了页面渲染和加载。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000123.png" /></p><p>在目前 W3C 的草案中使用了 Link Preload 响应头标记 Server Push。你可以看到页面响应类似如下所示的 Header：</p><pre><code>Link: &lt;/app/script.js&gt;; rel=preload; as=script</code></pre><blockquote><p>目前 Nginx <del>尚不</del> 没有直接支持 Server Push，在 Apache 中支持 Server Push 但是需要 <code>mod_http2</code> 的配置中 <code>H2Push On</code>，然后通过添加 Header  <code>Header add Link &quot;&lt;/css/styles.css&gt;;rel=preload&quot;</code> 的方法启用 Server Push。在不支持 Server Push 的 WebServer 上添加该响应头，不过是通过让服务端响应头、而不是通过 HTML 标记 Preload、从而可以让浏览器提前执行预加载罢了。</p></blockquote><p>从某种意义上讲，Server Push 就是更激进、更主动的 Preload。</p><h1><a href="https://blog.nfz.moe/archives/wpo-preload-serverpush.html# 兼容性"></a>兼容性</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000124.png" /></p><p>根据 CanIUse 上的数据表明，目前支持 Preload 的浏览器并不多，只占到了 53% 。但是试想在 2015 年、Preload 的草案刚刚出来时、甚至还没有任何浏览器表态支持这项技术，我们不得不感叹 Web 技术的日新月异啊。</p><hr /><p>参考资料：</p><ul><li><a href="http://stackoverflow.com/questions/36641137/how-exactly-does-link-rel-preload-work" target="_blank">http://stackoverflow.com/questions/36641137/how-exactly-does-link-rel-preload-work</a></li><li><a href="https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/" target="_blank">https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/</a></li><li><a href="https://httpd.apache.org/docs/2.4/mod/mod_http2.html" target="_blank">https://httpd.apache.org/docs/2.4/mod/mod_http2.html</a></li></ul>]]></content>
        
        <summary type="html">
            
            相比使用 Prefetch 之类的技术让浏览器提前准备好将来需要的资源，Preload 是让浏览器在加载页面时提前准备好这个页面所需要的资源。在之前的 《Web 性能优化（2）——分析 Prefetch》 中，我介绍了 Prefetch 对于前端优化的重要性。在开发过程中，我们
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="Resource Hint"/>
        
        <category term="Preload"/>
        
        <category term="HTTP2"/>
        
    </entry>
    
    <entry>
        <title>本博客对 sw-toolbox 的实践</title>
        <link href="https://blog.nfz.moe/archives/sw-toolbox-practice.html"/>
        <id>https://blog.nfz.moe/archives/sw-toolbox-practice.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-30T10:06:00+00:00</published>
        <updated>2017-08-30T10:06:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>Service Worker 可能是前端的一场革命。Service Worker 开放了众多 API，是 PWA 的基石。同时，Service Worker 开放的操作 Cache Storage 的 API 更是给了一个极其方便的控制浏览器缓存的工具。</p><a></a><h1><a href="https://blog.nfz.moe/archives/sw-toolbox-practice.html#What-amp-why-sw-toolbox"></a>What &amp; why sw-toolbox</h1><p>我曾经在 《<a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html">Web 性能优化（1）——浅尝 Service Worker</a>》一文当中介绍了 Service Worker 的离线加载特性，并且给了一份使用 Service Worker 原生 API 的样例代码。那份代码实现了基于白名单一个拦截所有请求并存储进 Cache Storage。<br />这份样例代码有很多缺陷：比如说不能针对路径、文件类型控制资源缓存，仅支持通过版本号管理全部缓存，对于频繁更新的内容不能起到很好的缓存效果等等。<br />针对动态缓存的需求，Google 推出了 <a href="https://googlechrome.github.io/sw-toolbox/" target="_blank">sw-toolbox</a>。<br />Google 的 sw-toolbox 提供了一套专门为动态缓存使用的通用策略。它使用了一套类似 Express.js 路由的语法专门用于编写缓存策略。<br />对于加载，sw-toolbox 提供了以下选项：</p><ul><li>networkFirst（网络加载优先，无法返回正确状态码后 fallback 到缓存）</li><li>cacheFirst（优先从缓存加载，cacheTank 中没有再发起网络请求）</li><li>networkOnly（每次加载都在线加载资源）</li><li>cacheOnly（仅使用缓存，或者不加载。可以搭配 precache 使用）</li><li>fastest（同时发起网络请求和读取缓存，谁快就用谁。一般缓存都先于网络请求）</li></ul><p>除了对于资源的加载来源提供了上述选项，sw-toolbox 还提供了可以便利的在 Cache Storage 中添加或删除缓存、控制缓存数量和有效期的 API；提供了一套可以快速利用 Service Worker 发起请求的 API；等等。</p><h1><a href="https://blog.nfz.moe/archives/sw-toolbox-practice.html#How-to-use-sw-toolbox"></a>How to use sw-toolbox</h1><p>简单介绍了一下 sw-toolbox 以后，我介绍一下本博客对 sw-toolbox 的实践。</p><pre><code><span>var</span> cacheVersion <span>=</span> <span>&quot;-170816&quot;</span><span>;</span><span>var</span> staticImageCacheName <span>=</span> <span>&quot;image&quot;</span> <span>+</span> cacheVersion<span>;</span><span>var</span> staticAssetsCacheName <span>=</span> <span>&quot;assets&quot;</span> <span>+</span> cacheVersion<span>;</span><span>var</span> contentCacheName <span>=</span> <span>&quot;content&quot;</span> <span>+</span> cacheVersion<span>;</span><span>var</span> vendorCacheName <span>=</span> <span>&quot;vendor&quot;</span> <span>+</span> cacheVersion<span>;</span> <span>var</span> maxEntries <span>=</span> <span>100</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先是定义一些 Cache Storage 名称的有关变量。首先是 Cache Version，强制刷新缓存时会用的到。我将要缓存的内容分别分类为 图片 (image)，静态资源(assets)，网页内容(content) 和其它(vendor)。</p><pre><code>self<span>.</span><span>importScripts</span><span>(</span><span>&quot;https://cdnjs.cat.net/ajax/libs/sw-toolbox/3.6.1/sw-toolbox.js&quot;</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>options<span>.</span>debug <span>=</span> <span>false</span><span>;</span>self<span>.</span>toolbox<span>.</span>options<span>.</span>networkTimeoutSeconds <span>=</span> <span>3</span><span>;</span><span><span></span><span></span><span></span></span></code></pre><p>从 css.net 的公共 CDN 库载入 sw-toolbox.js、关闭 sw-toolbox 的 debug 模式、将加载方式从 Network 超时 fallback 到 Cache 的时长设置为 3s。</p><hr /><pre><code><span>/* staticImageCache */</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/img/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/blog\.nfz\.yecdn\.com/</span><span>,</span>     cache<span>:</span> <span>{</span>        name<span>:</span> staticImageCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/p0\.ssl\.qhmsg\.com/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> staticImageCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/i\.nfz\.yecdn\.com/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> staticImageCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/i\.loli\.net/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> staticImageCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于可以缓存的图片部分，全部采用 cacheFirst 的原则，节省用户流量，提升页面二次加载速度。我总共匹配了所有可能遇到的图片的域名，包括 <code>s.nfz.yecdn.com</code> <code>img1.nfz.yecdn.com</code> <code>img2.nfz.yecdn.com</code> <code>i.loli.net</code> 等等。</p><hr /><pre><code><span>/* StaticAssetsCache */</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/css/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>origin<span>:</span> <span>/blog\.nfz\.yecdn\.com/</span><span>,</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/js/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>origin<span>:</span> <span>/blog\.nfz\.yecdn\.com/</span><span>,</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/static/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>origin<span>:</span> <span>/blog\.nfz\.yecdn\.com/</span><span>,</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/fonts/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/blog\.nfz\.yecdn\.com/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> staticAssetsCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/cdnjs\.cat\.net/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> staticAssetsCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我的博客对于 css 和 js 使用了基于 localstorage 的缓存机制；我不想在刷新缓存时，同时刷新 CDN、localstorage 和 Cache Storage 的缓存，所以针对 css js 都做了 <code>networkOnly</code>。</p><blockquote><p>这样一来，我的博客会存在一个 Bug，即当用户处于离线模式时，本地 Cache Storage 缓存了对当前页面的离线、同时用户的 localstorage 已经损坏，这时候会引起页面的渲染错误。但是发生这种错误的可能性微乎其微，因为 localstorage 的缓存强度比 Cache Storage 要强。</p></blockquote><p>对于字体和从公共 CDN 库上调用的文件，都是不会经常改动的（准确说几乎不会改动），全部使用 <code>cacheFirst</code>。</p><hr /><pre><code><span>/* ContentCache */</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/archives/(.*).html(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>    cache<span>:</span> <span>{</span>        name<span>:</span> contentCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(tags|about|gallery|archives|links|timeline)(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>   cache<span>:</span> <span>{</span>        name<span>:</span> contentCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/$&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>    cache<span>:</span> <span>{</span>         name<span>:</span> contentCacheName<span>,</span>         maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/\?(.*)$&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>    cache<span>:</span> <span>{</span>        name<span>:</span> contentCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkFirst<span>,</span> <span>{</span>    cache<span>:</span> <span>{</span>        name<span>:</span> contentCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据 URI 匹配我博客的页面，采用 <code>networkFirst</code>，这样当访客在线时可以及时收到页面更新，访客离线时也能正常加载已经缓存的版本。</p><hr /><pre><code><span>/* VendorCache */</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/next/config.json&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkOnly<span>,</span> <span>{</span>origin<span>:</span> <span>/disqus\.com/</span><span>,</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/api/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkOnly<span>,</span> <span>{</span>origin<span>:</span> <span>/disqus\.com/</span><span>,</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/disquscdn\.com/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> vendorCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>    origin<span>:</span> <span>/referrer\.disqus\.com/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> vendorCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>cacheFirst<span>,</span> <span>{</span>origin<span>:</span> <span>/(www\.google-analytics\.com|ssl\.google-analytics\.com)/</span><span>,</span>    cache<span>:</span> <span>{</span>        name<span>:</span> vendorCacheName<span>,</span>        maxEntries<span>:</span> maxEntries    <span>}</span><span>}</span><span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于 Disqus 几个域名，分别做了不同的安排。我的博客使用 <code>disqus.com/next/config.json</code> 作为访客 Disqus 连通性测试的探针，所以这个请求一定不能被缓存，只能 <code>networkOnly</code>。对于需要实时更新的一些 Disqus API 数据，也用 URI 正则匹配的方式加以 <code>networkOnly</code>。对于 Disqus CDN 的域名（主要用于加载用户头像和评论框的 css）也全部 <code>cacheFirst</code>，加快访客的 Disqus 评论框二次加载速度。<br />我对于 Disqus 引入的 Google Analytics 和 <code>referrer.disqus.com</code> 没有好感，同样全部缓存处理，反正并不影响我自己网站的访问统计（我自己的 Google Analytics 实现方式不同）</p><hr /><pre><code><span>/* NoCache */</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/sw.js&quot;</span><span>,</span>self<span>.</span>toolbox<span>.</span>networkFirst<span>)</span><span>,</span>self<span>.</span>toolbox<span>.</span>router<span>.</span><span>get</span><span>(</span><span>&quot;/(.*).php(.*)&quot;</span><span>,</span> self<span>.</span>toolbox<span>.</span>networkOnly<span>)</span><span>,</span><span><span></span><span></span><span></span></span></code></pre><p>最后是不缓存部分和预缓存部分。对于博客中的动态部分不做任何缓存；对于 <code>sw.js</code> 采取 <code>networkFirst</code> 策略，使访客网络状态正常时更新 <code>sw.js</code>，离线时也能正常使用 Service Worker。</p><hr /><pre><code>self<span>.</span><span>addEventListener</span><span>(</span><span>&quot;install&quot;</span><span>,</span><span>function</span><span>(</span>event<span>)</span> <span>{</span><span>return</span> event<span>.</span><span>waitUntil</span><span>(</span>self<span>.</span><span>skipWaiting</span><span>(</span><span>)</span><span>)</span><span>}</span><span>)</span><span>;</span>self<span>.</span><span>addEventListener</span><span>(</span><span>&quot;activate&quot;</span><span>,</span><span>function</span><span>(</span>event<span>)</span> <span>{</span><span>return</span> event<span>.</span><span>waitUntil</span><span>(</span>self<span>.</span>clients<span>.</span><span>claim</span><span>(</span><span>)</span><span>)</span><span>}</span><span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>sw.js</code> 结尾部分设置 <code>skipWaiting</code> 和 <code>clients.claim</code> 以便实现每次页面加载时 Service Worker 都要强制更新。</p>]]></content>
        
        <summary type="html">
            
            Service Worker 可能是前端的一场革命。Service Worker 开放了众多 API，是 PWA 的基石。同时，Service Worker 开放的操作 Cache Storage 的 API 更是给了一个极其方便的控制浏览器缓存的工具。What &amp;amp; w
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="博客"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="Service Worker"/>
        
    </entry>
    
    <entry>
        <title>Obfuscate PDF Text: Scramble Copied Text with Crafted CMap</title>
        <link href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/"/>
        <id>https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2017-08-29T04:18:23+00:00</published>
        <updated>2017-08-29T04:18:23+00:00</updated>
        
        <content type="html"><![CDATA[<h1><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#Notice"></a>Notice</h1><ul>
<li>This does not prevent your PDF from being copied. OCR nowadays is pretty advanced.</li>
<li>Backup your document before you do anything.</li>
<li>The author does not encourage plagiarism in any form.</li>
</ul>
<a></a>
<h1><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#Background-What-is-CMap"></a>Background: What is CMap</h1><p>In a PDF file where fonts are embedded, those glyphs are stored in a table, usually following the encoding in the source font. Some of the files, considering to reduce the file size, only uses a subset of the font. For example, to store a font that is used by the phrase <code>THE CAT SAT ON THE MAT</code>, only T, H, E, C, A, S, O, N, M would be enough.</p>
<p>But not for the every case, glyphs and code points have 1 to 1 relationship. Especially when ligatures come in to play. (Yah, I know ﬂ has its own code point (<code>U+FB02</code>), but for sure you would never want to type it whenever you want to search for words like “fly” or “flight”, etc.) Also, sometimes the glyphs are not located in the correct place as in its code point, but just merely 0, 1, 2, … Thus, to recognise every glyph precisely, we need a map to link glyphs and the code point(s) that it represents.</p>
<p>Here is an example of CMap:</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div></pre></td><td><pre><div>/CIDInit /ProcSet findresource begin <span>12</span> dict begin begincmap /CIDSystemInfo &lt;&lt;</div><div>/Registry (F6+<span>0</span>) /Ordering (T1UV) /Supplement <span>0</span> &gt;&gt; def</div><div>/CMapName /F6+<span>0</span> def</div><div>/CMapType <span>2</span> def</div><div><span>1</span> begincodespacerange &lt;<span>02</span>&gt; &lt;b7&gt; endcodespacerange</div><div><span>19</span> beginbfchar</div><div>&lt;<span>07</span>&gt; &lt;<span>03</span>C0&gt;</div><div>&lt;<span>09</span>&gt; &lt;<span>0061</span>&gt;</div><div>&lt;<span>0</span>a&gt; &lt;<span>006</span>D&gt;</div><div>&lt;<span>0</span>b&gt; &lt;<span>0070</span>&gt;</div><div>&lt;<span>1</span>e&gt; &lt;<span>02</span>DA&gt;</div><div>&lt;<span>20</span>&gt; &lt;<span>0020</span>&gt;</div><div>&lt;<span>22</span>&gt; &lt;<span>0022</span>&gt;</div><div>&lt;<span>3</span>d&gt; &lt;<span>003</span>D&gt;</div><div>&lt;<span>3</span>f&gt; &lt;<span>003</span>F&gt;</div><div>&lt;<span>59</span>&gt; &lt;<span>0059</span>&gt;</div><div>&lt;<span>5</span>b&gt; &lt;<span>005</span>B&gt;</div><div>&lt;<span>5</span>d&gt; &lt;<span>005</span>D&gt;</div><div>&lt;<span>5</span>f&gt; &lt;<span>005</span>F&gt;</div><div>&lt;<span>7</span>d&gt; &lt;<span>007</span>D&gt;</div><div>&lt;<span>84</span>&gt; &lt;<span>2014</span>&gt;</div><div>&lt;<span>85</span>&gt; &lt;<span>2013</span>&gt;</div><div>&lt;<span>90</span>&gt; &lt;<span>2019</span>&gt;</div><div>&lt;b0&gt; &lt;<span>00</span>B0&gt;</div><div>&lt;b7&gt; &lt;<span>00</span>B7&gt;</div><div>endbfchar</div><div><span>8</span> beginbfrange</div><div>&lt;<span>24</span>&gt; &lt;<span>25</span>&gt; &lt;<span>0024</span>&gt;</div><div>&lt;<span>27</span>&gt; &lt;<span>29</span>&gt; &lt;<span>0027</span>&gt;</div><div>&lt;<span>2</span>b&gt; &lt;<span>2</span>e&gt; &lt;<span>002</span>B&gt;</div><div>&lt;<span>30</span>&gt; &lt;<span>3</span>b&gt; &lt;<span>0030</span>&gt;</div><div>&lt;<span>41</span>&gt; &lt;<span>50</span>&gt; &lt;<span>0041</span>&gt;</div><div>&lt;<span>52</span>&gt; &lt;<span>57</span>&gt; &lt;<span>0052</span>&gt;</div><div>&lt;<span>61</span>&gt; &lt;<span>7</span>b&gt; &lt;<span>0061</span>&gt;</div><div>&lt;<span>8</span>d&gt; &lt;<span>8</span>e&gt; &lt;<span>201</span>C&gt;</div><div>endbfrange</div><div><span>6</span> beginbfrange</div><div>&lt;<span>02</span>&gt; &lt;<span>02</span>&gt; [&lt;<span>0066006</span>C&gt;]</div><div>&lt;<span>03</span>&gt; &lt;<span>03</span>&gt; [&lt;<span>00540068</span>&gt;]</div><div>&lt;<span>04</span>&gt; &lt;<span>04</span>&gt; [&lt;<span>00660069</span>&gt;]</div><div>&lt;<span>05</span>&gt; &lt;<span>05</span>&gt; [&lt;<span>00660074</span>&gt;]</div><div>&lt;<span>06</span>&gt; &lt;<span>06</span>&gt; [&lt;<span>00660066</span>&gt;]</div><div>&lt;<span>08</span>&gt; &lt;<span>08</span>&gt; [&lt;<span>006600660069</span>&gt;]</div><div>endbfrange</div><div>endcmap CMapName currentdict /CMap defineresource pop end end</div></pre></td></tr></table>
<p>There are 2 main sections in a CMap, <code>beginbfchar</code> and <code>beginbfrange</code>. Each of them starts with a number, representing the number of entries it has. It begins</p>
<h2><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#bfchar"></a><code>bfchar</code></h2><p>This is usually used for one to one relationship. First code is the glyph ID, and the second means the Unicode code point. For example, <code>&lt;07&gt; &lt;0035&gt;</code> means glyph 07 is mapped to code point 0035.</p>
<h2><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#bfrange"></a><code>bfrange</code></h2><p>This is used for batch mapping in order: mapping a range in the glyph table to the Unicode code points. For example: <code>&lt;31&gt; &lt;39&gt; &lt;00F2&gt;</code> means:</p>
<ul>
<li>Map 31 to 00F2</li>
<li>Map 32 to 00F3</li>
<li>Map 33 to 00F4</li>
<li>…</li>
<li>Map 39 to 00FA</li>
</ul>
<p>Also, <code>bfrange</code> can also assign a glyph to multiple Unicode characters, which is useful in processing ligatures. <code>&lt;02&gt; &lt;02&gt; [&lt;0066006C&gt;]</code> means that mapping glyph 02 to a sequence (0066, 006c).</p>
<h1><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#Procedure"></a>Procedure</h1><p>In this example, we’re using a PDF generated with Xe(La)TeX as an example.</p>
<ol>
<li>Decompress the PDF document using <code>qzip</code><br /><code>qpdf --qdf --object-streams=disable docuent.pdf decompressed.pdf</code></li>
<li>Open the file with a suitable tool. I’d recommend using a binary/hex editor.</li>
<li>Locate to the CMap of the targeting font.</li>
<li>Use <code>bfrange</code> and/or <code>bfchar</code> to scramble a range of characters, e.g. Set a specific set of chars to code point 0:<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div></pre></td><td><pre><div><span>8</span> beginbfrange</div><div>&lt;<span>00</span>&gt; &lt;<span>01</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>09</span>&gt; &lt;<span>0</span>A&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>23</span>&gt; &lt;<span>26</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>28</span>&gt; &lt;<span>3</span>B&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>3</span>F&gt; &lt;<span>5</span>B&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>5</span>D&gt; &lt;<span>5</span>E&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>61</span>&gt; &lt;<span>7</span>A&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>7</span>B&gt; &lt;<span>7</span>C&gt; &lt;<span>0000</span>&gt;</div><div>endbfrange</div><div><span>40</span> beginbfchar</div><div>&lt;<span>02</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>03</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>04</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>05</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>06</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>07</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>08</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>0</span>B&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>0</span>C&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>0</span>D&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>0</span>E&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>0</span>F&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>10</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>11</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>12</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>13</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>14</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>15</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>16</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>17</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>18</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>19</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>A&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>B&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>C&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>D&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>E&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>1</span>F&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>21</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>22</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>27</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>3</span>C&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>3</span>D&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>3</span>E&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>5</span>C&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>5</span>F&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>60</span>&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>7</span>D&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>7</span>E&gt; &lt;<span>0000</span>&gt;</div><div>&lt;<span>7</span>F&gt; &lt;<span>0000</span>&gt;</div><div>endbfchar</div></pre></td></tr></table>
</li>
</ol>
<h1><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#Notes"></a>Notes</h1><ul>
<li>This should be technically possible for all PDFs, but not been tested throughly.</li>
<li>If you are using <code>pdftex</code> or <code>LuaTeX</code>, you may want to try some of the methods <a href="https://tex.stackexchange.com/questions/11307/is-it-possible-to-produce-a-pdf-with-un-copyable-text" target="_blank">here</a>.</li>
<li>This method still retains text as text, but just scrambled when copied. Other methods such as converting the document to vector shapes or raster images can also make the text “uncopyable”, but no text will be detected directly as compared to the original document.</li>
</ul>
<h1><a href="https://blog.1a23.com/2017/08/29/Obfuscate-PDF-Text-Uncopiable-text-with-crafted-CMap/#References"></a>References</h1><ul>
<li><a href="https://blog.idrsolutions.com/2009/05/introductory-pdf-font-tutorial/" target="_blank">Introductory PDF font tutorial</a></li>
<li><a href="https://blog.idrsolutions.com/2012/05/understanding-the-pdf-file-format-embedded-cmap-tables/" target="_blank">Understanding the PDF file format – Embedded CMAP tables</a></li>
<li><a href="https://tex.stackexchange.com/questions/11307/is-it-possible-to-produce-a-pdf-with-un-copyable-text" target="_blank">Is it possible to produce a PDF with un-copyable text?</a></li>
</ul>]]></content>
        
        <summary type="html">
            
            Notice This does not prevent your PDF from being copied. OCR nowadays is pretty advanced. Backup your document before you do anything. The 
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="PDF"/>
        
        <category term="CMap"/>
        
        <category term="Obfuscate"/>
        
        <category term="Scramble"/>
        
    </entry>
    
    <entry>
        <title>生日快乐</title>
        <link href="https://itroy.cc/968"/>
        <id>https://itroy.cc/968</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2017-08-27T16:54:24+00:00</published>
        <updated>2017-08-27T16:54:24+00:00</updated>
        
        <content type="html"><![CDATA[<p>emmm…<br />
祝我自己生日快乐，话说今年好奇怪哦，等了 28 分钟的启动页，反反复复地打开与关闭，却发现只有 Bilibili 有相应的内容。<br />
我记得往年 QQ 邮箱应该会自动给我发一封邮件，QQ 的启动页，QQ 空间的启动页，Google 的 logo 区域应该会变成生日相关的内容诶……</p>
<p>顺便这篇文章证明我还活着（XD）。</p>
<p>（emm… 作业好多啧，去写作业了…… =。=）</p>]]></content>
        
        <summary type="html">
            
            emmm… 祝我自己生日快乐，话说今年好奇怪哦，等了 28 分钟的启动页，反反复复地打开与关闭，却发现只有 Bilibili 有相应的内容。 我记得往年 QQ 邮箱应该会自动给我发一封邮件，QQ 的启动页，QQ 空间的启动页，Google 的 logo 区域应该会变成生日相关的
            
        </summary>
        
        <category term="日常"/>
        
    </entry>
    
    <entry>
        <title>全站开启 HSTS</title>
        <link href="https://blog.nfz.moe/archives/enable-hsts.html"/>
        <id>https://blog.nfz.moe/archives/enable-hsts.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-25T07:36:00+00:00</published>
        <updated>2017-08-25T07:36:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>HSTS 是 HTTP Strict Transport Security （HTTP 严格安全传输）的缩写。开启了这项设置以后，大部分浏览器会强制性地使用 HTTPS 来请求资源，能够更加有效地保护网站和用户的数据安全。</p><a></a><p>一般情况（未启用 HSTS），浏览器会允许用户在了解了安全风险之后继续使用不安全的连接来访问，但如果启用了 HSTS，则不允许忽略，所以如果你要启用 https ，得一定要 <strong> 很长期使用 HTTPS</strong>，或者像我一样，成为一个 https 控。</p><h1><a href="https://blog.nfz.moe/archives/enable-hsts.html# 启用 HSTS"></a>启用 HSTS</h1><p>HSTS 是一个响应头，格式如下：</p><pre><code>Strict-Transport-Security: max-age=31536000; includeSubDomains; preload;</code></pre><ul><li>max-age，单位是秒，用来告诉浏览器在指定时间内，这个网站必须通过 HTTPS 协议来访问。也就是对于这个网站的 HTTP 地址，浏览器需要先在本地替换为 HTTPS 之后再发送请求。</li><li>includeSubDomains ，可选参数，如果指定这个参数，表明这个网站所有子域名也必须通过 HTTPS 协议来访问。</li><li>preload ，可选参数，预加载到浏览器缓存。</li></ul><blockquote><p><a href="https://tools.ietf.org/html/rfc6797" target="_blank">RFC 6797</a> 对 HSTS 进行了详细说明。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/enable-hsts.html# 配置 -HSTS"></a>配置 HSTS</h1><p>HSTS 这个响应头只能用于 HTTPS 响应；网站必须使用默认的 443 端口；必须使用域名，不能是 IP。而且启用 HSTS 之后，<strong>一旦网站证书错误，用户无法选择忽略。</strong>（这意味着你需要及时给证书续命）<br />添加 HSTS 支持其实很简单，修改一下 Web 服务器的配置，增加一个 HTTP 头就行。</p><blockquote><p>举个例子，这个域名目前使用的是：</p></blockquote><pre><code>Strict-Transport-Security: max-age=15552000; includeSubDomains; preload max-age=15552000</code></pre><p>告诉浏览器缓存这条规则 180 天；includeSubDomains 对子域名也使用相同的规则；preload 允许将这条规则内置进浏览器。</p><h1><a href="https://blog.nfz.moe/archives/enable-hsts.html#WebServer- 配置 -HSTS"></a>WebServer 配置 HSTS</h1><p>对于 Apache，只需在 .htaccess 加入以下代码即可</p><pre><code>Header always set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot; env=HTTPS<span><span></span></span></code></pre><p>对于 Nginx，可以在站点配置文件中添加</p><pre><code>add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;<span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/enable-hsts.html# 申请 -HSTS-Preload-List"></a>申请 HSTS Preload List</h1><p>HSTS 必须要在浏览器访问过你的网站一次以后才会生效，如果希望提前生效，需要申请 HSTS Preloading List。<br />目前这个 Preload List 由 Google Chrome 维护，Chrome、Firefox、Safari、IE 11 和 Microsoft Edge 都在使用和不断更新。<br />如果要想把自己的域名加进这个列表，首先需要满足以下条件：</p><ul><li>拥有合法的证书（如果使用 SHA-1 证书，过期时间必须早于 2016 年）</li><li>将所有 HTTP 流量重定向到 HTTPS</li><li>确保所有子域名都启用了 HTTPS</li><li>输出 HSTS 响应头</li><li>max-age 不能低于 18 周（10886400 秒）</li><li>必须指定 includeSubdomains 参数</li><li>必须指定 preload 参数</li></ul><p>觉得妥了可以去 <a href="https://hstspreload.org" target="_blank">HSTS Preload List</a> 这个页面申请。<br />我的域名已经去申请加入预加载列表了。如果能通过，将会是很吼的！</p><blockquote><p>特别提醒：对于 HSTS 以及 HSTS Preload List ，如果你不能确保永远提供 HTTPS 服务，就不要启用。因为一旦 HSTS 生效，<strong>你再想把网站重定向为 HTTP ，之前的老用户会被无限重定向，唯一的办法是换新域名。</strong></p></blockquote><hr /><p>本站已经加入了 <a href="https://cs.chromium.org/chromium/src/net/http/transport_security_state_static.json?q=nfz.moe&amp;sq=package:chromium&amp;maxsize=5625974&amp;l=24044" target="_blank">HSTS Preload List</a>。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000150.jpg" /></p>]]></content>
        
        <summary type="html">
            
            HSTS 是 HTTP Strict Transport Security （HTTP 严格安全传输）的缩写。开启了这项设置以后，大部分浏览器会强制性地使用 HTTPS 来请求资源，能够更加有效地保护网站和用户的数据安全。一般情况（未启用 HSTS），浏览器会允许用户在了解了安
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="安全"/>
        
        <category term="HSTS"/>
        
        <category term="SSL"/>
        
        <category term="HTTPS"/>
        
    </entry>
    
    <entry>
        <title>阻止运行、猎鹰网络、黑域 始末</title>
        <link href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html"/>
        <id>https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-25T07:20:28+00:00</published>
        <updated>2017-08-25T07:20:28+00:00</updated>
        
        <content type="html"><![CDATA[<p>SuperSU 和阻止运行被收购和商业化无疑是一场巨变。因为 Root 和 Xposed 都是对 Android 安全、稳定运行非常重要的一部分，一旦商业化和作恶，后果不可预料。</p><a></a><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html#ForceStopGB（阻止运行）"></a>ForceStopGB（阻止运行）</h1><p>我来首先介绍一下阻止运行是什么。<br />阻止运行项目最早开始于 2015 年，原作者 liudongmiao 表示是写给他女朋友的一款作品，目的是为了遏制 Android 的众多毒瘤，通过 Xposed 或 Hook 系统 Framework 实现。项目完整地在 Github 上使用 WTFPL 协议完整开源并高度自由。截止到 2.3.2 版本，阻止运行已经是一款较完善的应用，名声广为流传，在酷安尤为口碑良好，甚至一度超过绿色守护。</p><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 被收购后的阻止运行"></a>被收购后的阻止运行</h1><p>2016 年 3 月，liudongmiao 在酷安发表一条动态称，魔趣开源项目的发起人 Martincz 发现 ForceStopGB 项目在 Github 被删库，liudongmiao 表示阻止运行项目被卖给一家叫做“猎鹰工作室”的公司，并表示阻止运行即使被收购后依然不会作恶，并且 liudongmiao 表示阻止运行依然在他可控的范围之内。</p><blockquote><p>后面大家可以看到，这一切并不是如 liudongmiao 所想的那样。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 联网权限"></a>联网权限 </h2><p> 猎鹰网络在收购发布的第一个版本 <code>2.3.3</code> 立刻就加入了联网权限，以及一个“立刻阻止”和“无法阻止？立刻上报程序猿”两个功能。猎鹰表示这个是必要权限。</p><blockquote><p>2.3.3 的阻止运行的联网权限是否必要这里我已经不想深究。不然我备用机装一个 Xposed 再装一个抓包就全部找出来了。大家如果愿意的可以去尝试一下。</p></blockquote><p>对于联网权限我想说一下，Xposed 是一把非常锋利的双刃剑，它的原理是通过替换 <code>/system/bin/app_process</code> 控制<code>zygote</code>，使 <code>app_process</code> 在启动过程中加载 <code>XposedBridge.jar</code>，从而完成对 <code>Zygote</code> 进程及其创建的 <code>Dalvik 虚拟机</code> ` 的劫持，Xposed 在开机的时候完成对所有的 Hook Function，在原 Function 执行的前后加上自定义代码。所以说，一般的权限管理软件对 Xposed Module 是毫无作用的，Xposed 无疑拥有系统的最高权限。</p><h2><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 百度定位 -SDK"></a>百度定位 SDK</h2><p>这个猎鹰工作室的高振刚（即酷安中的 ksana2016）——猎鹰老大表示是上头公司要求内置的 sdk。至于上头公司是啥我后面会讲到。<br />最早发现这个的是因为一些酷友发现阻止运行 2.3.6 版开始莫名耗电，使用写轮眼一查看可以发现里面竟然内置了百度定位的 sdk <code>com.baidu.location.f</code> 。大家结合上面我介绍的 Xposed 的介绍，以及联系 Xposed 的后台保活能力，可以联想一下这个的后果。</p><blockquote><p>其实大家想一下要定位权限有什么用？如果真的只是为了统计，为什么并没有在 <code>AndroidManiFest.xml</code> 内发现定义的其它统计有关的组件？而且，在酷友的强烈要求下，2.3.7 立刻就去掉了百度定位 sdk，说明这个组件对于应用运行是毫无影响的。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000056.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000055.png" /></p><blockquote><p>2.3.6 版本还可以在手机乐园上下载到，大家可以自取。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 盗用 -UI- 设计"></a>盗用 UI 设计 </h2><p> 在 2.3.6，阻止运行使用了一个新的 UI 设计，包括一个 <code>listviewer</code> 和一个 <code>drawer</code>。然而很快，一名 ID 为 twroc 的酷友在酷安声称该 UI 设计所有权应归他所有，并且得到了 liudongmiao 的证实。然而猎鹰工作室对于此却宣称因为该酷友不肯加入猎鹰工作室的团队、不能接受“外包私活”等理由推诿。</p><blockquote><p>这是酷友 tworc 的声明</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000063.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000051.jpg" /></p><p>最后这件事情是这样不了了之的。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000064.png" /></p><blockquote><p>具体情况可以看下面</p></blockquote><h2><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 微阻止"></a>微阻止 </h2><p> 这项功能当时 ksana2016 是这么介绍的：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000053.png" /></p><p>这项功能当时在酷安被大部分酷友抨击和反对。并且该功能在 2.4.0 版本终于推出以后，我们可以发现，所谓去除开屏广告不过是使广告不显示，实际上带有启动屏的广告应用启动时会有 2s 的黑屏。</p><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 猎鹰网络"></a>猎鹰网络 </h1><p> 猎鹰工作室到底是何方神圣？于是我上网进行了一番调查，结果很快就出来了。</p><p>这是搜狐新闻网的一篇 <a href="http://mt.sohu.com/20150928/n422296570.shtml" target="_blank"> 报道</a>，里面介绍了一个名叫“智度投资”的投资公司全资收购了猎鹰网络和半数“应用汇”的股份。</p><p>这是 <a href="http://www.falconnect.cn" target="_blank">猎鹰网络的官网</a> ，可以在公司介绍里看到这样的内容：</p><blockquote><p>猎鹰网络已成为国内领先的以大数据、机器学习、人工智能为技术驱动的新兴移动广告技术公司。</p></blockquote><p>哦，一个有着“闭环生态链”的移动广告技术公司，要收购阻止运行这种对抗毒瘤的”安卓优化神器”，还要开发广告阻止功能？一旦借助 Xposed Hook 系统底层的优势投放广告、窃取用户隐私，是颇有些令人不寒而栗的，大家联想一下百度定位 SDK、联网权限应该也就明白了。</p><h2><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 工作室成员行为和态度"></a>工作室成员行为和态度 </h2><h3><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 面对盗用 -UI- 行为的态度"></a> 面对盗用 UI 行为的态度</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000057.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000052.png" /></p><blockquote><p>这脸打的 pia pia 的响。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000059.png" /></p><p>对于猎鹰高振刚和酷友 twroc 在微信的对话可以在 <a href="https://ooo.0o0.ooo/2017/01/26/5889fb945e96e.jpg" target="_blank"> 这里 </a> 看。</p><h3><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 对于定位 -SDK- 的态度"></a>对于定位 SDK 的态度</h3><p><img src="https://st.nfz.yecdn.com/img/blog/0000054.png" /></p><blockquote><p>我不置可否，不过把质疑用户称为嘴脸也真是没谁了。</p></blockquote><h3><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 面对质疑的态度"></a>面对质疑的态度</h3><blockquote><p>如果你们的阻止运行的底线是这样，那么请问还有谁放心用？</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000062.png" /></p><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 补丁版黑域"></a>补丁版黑域 </h1><p> 大概是这样的，liudongmiao 找到高振刚高总，申请开发基于 Android N 的补丁版“阻止运行”，即补丁版黑域项目。liudongmiao 表示新的项目只能用于 Android N、部分开源，并且不采用 Xposed 模式，于是高振刚同意了。后来补丁版黑域可以成功用于 Android 4.4-7.1 的任何版本，于是猎鹰网络威胁 liudongmiao 要起诉他。于是补丁版黑域被迫在酷安网下架，liudongmiao 被迫停更、去转向开发非补丁版黑域。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000050.png" /></p><p>幸运的是猎鹰网络没有（<strong>实际上也没有能力</strong>）封杀补丁版黑域，所以一键黑域打补丁项目和补丁版黑域依然可以继续使用。为了避免纠纷，酷安网页版隐藏了有关的项目，大家可以使用酷安手机客户端下载使用。</p><blockquote><p>对我而言，我认为猎鹰网络起诉 liudongmiao 是无稽之谈。补丁版黑域仅仅使用了阻止运行闭源前 2.3.2 的源码（我自己也有一份，也开源在 Github 和 Coding 上），而且那份源码是根据 WTFPL 的协议开源的，是完全自由的。补丁版黑域的实现原理和阻止运行完全不同，无论是否支持 Android N 以下都无所谓。<br />猎鹰把一个本来开源的项目弄成闭源，还彻底毁了阻止运行，这样一个优秀开源项目的名声，谁的罪过更大一清二楚。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 非补丁版黑域"></a>非补丁版黑域 </h1><p> 现在非补丁版黑域使用了全新的实现方法，通过一定的权限（如 Priv 权限或者 ADB 权限）来监听 Android 的运行日志，获取应用自启、唤醒的情况，配合 Android N 的后台机制一起对付应用毒瘤。当然，这种方法并不是那么强力。</p><hr /><p>如果说，现在最终的结果绿色守护依然在不断完善，方便的 非补丁版黑域依然可以继续吊打毒瘤，补丁版黑域虽然不再提供支持、也依然可以使用，所以广大 Android 机油面对 BAT 毒瘤并不是没有方法。但是要说有什么损失，那么就是基于 Xposed 的一款开源自由的神器被迫闭源、走向了另一端，给大家留下一个商业化以后的反例。</p><hr /><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 黑域后续 - 更新于 -2017-08-18"></a> 黑域后续(更新于 2017.08.18)</h1><blockquote><p>这部分最早发布于 <a href="https://t.me/neoFelhzW" target="_blank"> 个人的 Telegram 频道</a></p></blockquote><p>黑域本身到底几宗罪？</p><p>最早宣称是为了自己的 Pixel 开发，不想 Root 和解锁，开发了基于 ADB 的黑域，然后开发了 Root 功能。<br />曾经宣称不对 Root 用户提供技术支持，然而 Root 模式需要捐赠才能使用（可惜我丢了那张 liudongmiao 骂捐赠用户是猪的截图，不然就太劲爆了）<br />认为绿色应用公约是没有意义的，认为只有比流氓技高一筹才能打败流氓。<br />liudongmiao 多次和绿色守护开发者冯老师针锋相对，多次恶意攻击 MyAndroidTools 和绿色守护的处方（你可以在他知乎上对“你如何看待绿色应用公约”问题的回答，含沙射影在攻击绿色守护的处方功能）<br />使用 WTFPL 开源了部分代码，但是却宣称任何人都无权分发第三方版本，甚至因为 Rikka 的 Shizuku Manager 参考了 Brevent Server 部分代码而大动肝火、在酷安怼人。如今又因为有人分发社区版而大动肝火，甚至拒绝开源部分代码；彻底违背了 WTFPL 的理念和意义，也玷污了开源这个名词。</p><p>liudongmiao 和冯老师之间的故事现在很像 SSR 和 SS，一个在努力宣称自己所谓的能力、对另一个针锋相对，另一个却在默默开发、努力提倡公约推动国内安卓生态的改变。<br />你国安卓生态会死于内讧，而不是死于 BAT。你国开源生态死于 liudongmiao 这样的人，而不是死于 妮哩萌萌 这样的人。</p><hr /><h1><a href="https://blog.nfz.moe/archives/forcestopgb-lieying-brevent.html# 阻止运行后续 - 更新于 -2017-08-25"></a> 阻止运行后续 (更新于 2017.08.25)</h1><p> 阻止运行已经被猎鹰工作室离职员工 “园子” 更名为 <code>绿色运行</code>，添加了所谓“游戏模式”——王者荣耀不卡顿。之前阻止运行多个版本均曝光了阻止运行劫持用户淘宝、强制给用户使用返利券、从而使工作室盈利的行为。为了自己的安全，请不要继续使用任何阻止运行（同样不推荐使用旧版本阻止运行）和绿色运行 Xposed 模块，也不要使用由猎鹰工作室或者推出的 Xposed 商店。当然，欢迎不怕死的人来作死。</p>]]></content>
        
        <summary type="html">
            
            SuperSU 和阻止运行被收购和商业化无疑是一场巨变。因为 Root 和 Xposed 都是对 Android 安全、稳定运行非常重要的一部分，一旦商业化和作恶，后果不可预料。ForceStopGB（阻止运行）我来首先介绍一下阻止运行是什么。阻止运行项目最早开始于 2015 
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="Android"/>
        
        <category term="省电"/>
        
        <category term="黑域"/>
        
        <category term="阻止运行"/>
        
    </entry>
    
    <entry>
        <title>使用 GitLab CI 实现 Hexo 持续部署</title>
        <link href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html"/>
        <id>https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-25T07:08:00+00:00</published>
        <updated>2017-08-25T07:08:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>自从使用 Hexo 博客以来，我一直在研究如何实现在任何平台上自由编写和发布 Hexo 博客。<a></a>之前我在 <a href="https://blog.neofelhz.space/archives/hexo-auto-deploy-with-daocloud.html" target="_blank">《Hexo 持续自动化部署》</a> 和<a href="https://blog.neofelhz.space/archives/hexo-auto-deploy-with-flow-ci.html" target="_blank">《用 Flow.CI 让 Hexo 持续集成》</a>两篇文章中分别讲述了使用 DaoCloud 的 Docker 和 Flow.CI 的 Sass 平台部署持续集成的 Hexo，但是如今 DaoCloud 部署越来越慢，Flow.CI 也已经转向收费；所以我不得不寻找新的替代方案。</p><p>很早就听说了 GitLab。</p><blockquote><p>就是那个最近因为不小心使用 <code>rm rf</code> 把自家数据库删光、还在 YouTube 上直播修库、让失误的程序员看了 10 小时的 <em>nyancat</em> 的那个 GitLab。</p></blockquote><p>GitLab 有面向企业的计划、有开发独立的服务端程序，所以和主要面向平民化的码农天堂 Github 一口气亏损 6600 亿美元不同，GitLab 至少并没有亏损。这一点和 Coding 颇为类似——无论是运营方式还是盈利方式，甚至是网站 UI 交互层面。</p><p>接下来事情就很简单了。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html# 准备工作"></a>准备工作 </h1><p> 首先，在 GitLab 创建一个新的私有库，用来存储我的博客工程文件；在我的本地的 Hexo 博客工程文件中的 Repository 里添加一个新的 Remote 到 GitLab。然后从原来的 repo 上 <code>git pull</code>，并 <code>git push</code> 到 GitLab。<br />现在我在 Coding 和 GitLab 上都有了 Hexo 博客的工程文件。接下来就是直接部署 CI 平台了。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html# 编写 -workflow"></a>编写 workflow</h1><p>和 Github 的 Travis.CI 类似，你只需要在 Repository 的根目录上新建一个 <code>.gitlab-ci.yml</code> 你就可以实现 GitLab 的 CI 平台执行自动部署。</p><blockquote><p>在 GitLab，CI 和 Repository 是高度集成的。你可以在 <code>pipeline</code> 里看到你的 CI 运行信息。</p></blockquote><p>在 <code>.gitlab-ci.yml</code> 中填入下述内容：</p><pre><code><span>image</span><span>:</span> neofelhz/hexo<span>-</span>docker<span>build</span><span>:</span>  <span>cache</span><span>:</span>    <span>paths</span><span>:</span>    <span>-</span> node_modules/  <span>script</span><span>:</span>  <span>-</span> hexo clean &amp;&amp; hexo g  <span>-</span> hexo d  <span>only</span><span>:</span>  <span>-</span> master<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上述脚本会自动在每次 push 后帮你生成 Hexo 静态文件。至于 <code>hexo d</code>，你需要事先部署好 Deploy 方式。<br />如果需要部署到 GitLab Pages，请把上面 <code>build</code> 节点更名为 <code>pages</code> 并在 <code>pages</code> 节点中添加下述子层级内容：</p></blockquote><pre><code>  <span>artifacts</span><span>:</span>    <span>paths</span><span>:</span>    <span>-</span> public<span><span></span><span></span><span></span></span></code></pre><p>同时需要去掉 <code>hexo d</code>。</p><blockquote><p>至于这些脚本的原理，你可以直接参考我之前那两篇关于 CI 部署 Hexo 的博客。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html#SSH- 有关"></a>SSH 有关 </h1><p> 一些人可能在用 Github Pages 或者 Coding Pages，或者是使用的自己的 VPS（git 部署）。这样一来你就可能需要使用 SSH 连接你的 webserver 仓库。（当然，用 Caddy 做 webserver 和定时 git pull 那个算是异类）。这些你可以在 GitLab CI 的 wiki 上查看到 <a href="https://docs.gitlab.com/ee/ci/ssh_keys/README.html" target="_blank">GitLab CI SSH 配置的相关内容</a>。</p><blockquote><p>值得一提的是，和 DaoCloud 和 Flow.CI 不同，GitLab CI 可以通过设置 <strong>环境变量</strong> 的方式加载你的 SSH 的私钥，这样子就不需要把你的私钥放在你的项目仓库里，有效防止私钥泄露到第三方。这种环境变量的方式不仅安全，而且灵活。<br />GitLab CI 配置环境变量的位置是 <code>Setting -&gt; Pipelines -&gt; Secret variables</code>，如下图所示：</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000157.png" /></p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html# 小结"></a>小结</h1><blockquote><p>本文就是由 GitLab CI 生成并发布的。</p></blockquote><p>本文介绍了利用 GitLab CI 进行持续集成 / 部署，今后的使用和之前的方式一样，向仓库提交 push 就可以触发自动部署。<br />和 Daocloud 和 Flow.CI 的代码构建相比，GitLab CI 为持续集成 / 部署优点如下：</p><ul><li>目前私有库完全免费</li><li>可以和 GitLab 的 Repository 无缝兼容，无需第三方 CI 平台接入。</li><li>支持在 <code>hexo deploy</code> 的同时自动发布到 GitLab Pages</li></ul>]]></content>
        
        <summary type="html">
            
            自从使用 Hexo 博客以来，我一直在研究如何实现在任何平台上自由编写和发布 Hexo 博客。之前我在 《Hexo 持续自动化部署》 和《用 Flow.CI 让 Hexo 持续集成》两篇文章中分别讲述了使用 DaoCloud 的 Docker 和 Flow.CI 的 Sass 
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="Hexo"/>
        
        <category term="持续集成"/>
        
        <category term="CI"/>
        
        <category term="GitLab CI"/>
        
    </entry>
    
    <entry>
        <title>关于这个主题及本站未来计划</title>
        <link href="https://flyhigher.top/develop/726.html"/>
        <id>https://flyhigher.top/develop/726.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-08-24T14:44:26+00:00</published>
        <updated>2017-08-24T14:44:26+00:00</updated>
        
        <content type="html"><![CDATA[<p>主题已经发布啦，详见新发布的文章。</p>
<p><del><strong>主题还没完成，未发布！！！</strong></del></p>
<p><del>受新高考政策的影响，即日起我会基本失踪，主题开发暂停，预计11月中旬回归。</del></p>
<blockquote><p>最后一个有空的下午就折腾了一个下午的主题，就差最后一点了但是想想太着急发布也不是很好，就先缓缓吧，11月再说。<br />
本来想趁这个下午给评论加上短信验证码以适应新政策，但是在和同学讨论之后决定暂时不理，如果会受到政策影响会先关闭评论，待回归后加上短信验证码。</p></blockquote>
<p>可劲儿折腾一个暑假，我开发的新主题总算是有点样子了，虽然是半成品但先给自己网站换上。</p>
<p>因为是半成品，还有非常多的细节需要打磨，所以最后主题的样子不会是你现在看到的这样。当然你如果发现什么奇奇怪怪的Bug欢迎跟我反馈，我就拿这个站测试了2333</p>
<p>目前急需改进的有：</p>
<ol>
<li>割阉版Ajax加载，需要完善功能</li>
<li><del>单独页面样式还未完成，需要完成</del></li>
<li><del>友链页面的样式暂时炸了，下次加上单独的友链页面和关于页面类型</del> [基本完成，还有一点小问题]</li>
<li><del>评论Ajax还没加上，下次加上</del> [基本完成，还有一点小问题]</li>
<li>阅读进度保存功能还没加上，下次加上</li>
<li>…</li>
</ol>
<p>你现在可以体验到的少数几个个牛逼哄哄的功能有：</p>
<ol>
<li>实时搜索。你可以试试点右上角的搜索按钮，随便打几个字体验一下</li>
<li>夜间模式，开关在抽屉菜单里</li>
<li>扫描“在其他设备上继续阅读”二维码时，会同步阅读进度</li>
<li>没屁放了</li>
</ol>
<p>我目前开发主题的活跃迭代网站不是这个，我会等开发有了一定进展后再把代码同步过来，所以上面说的急需开发功能还得再等等。</p>
<p>开学了，时间少了很多，恐怕进度会慢很多。</p>
<p>睡觉去了。</p>]]></content>
        
        <summary type="html">
            
            主题已经发布啦，详见新发布的文章。 主题还没完成，未发布！！！ 受新高考政策的影响，即日起我会基本失踪，主题开发暂停，预计11月中旬回归。 最后一个有空的下午就折腾了一个下午的主题，就差最后一点了但是想想太着急发布也不是很好，就先缓缓吧，11月再说。 本来想趁这个下午给评论加上
            
        </summary>
        
        <category term="开发"/>
        
        <category term="MDx"/>
        
        <category term="WordPress"/>
        
        <category term="主题"/>
        
    </entry>
    
    <entry>
        <title>使用 Travis CI 持续构建 Hexo</title>
        <link href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html"/>
        <id>https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-20T04:51:00+00:00</published>
        <updated>2017-08-20T04:51:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>我已经写了三篇关于如何使用 CI 持续构建 Hexo 的文章了，现在我将博客迁移到 GitHub 上托管，所以就需要使用 Travis CI 完成持续构建了。</p><a></a><blockquote><p>相关阅读</p><ul><li>《<a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html">使用 DaoCloud 让 Hexo 持续集成</a>》</li><li>《<a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html">用 Flow.CI 让 Hexo 持续集成</a>》</li><li>《<a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-gitlab-ci.html">使用 GitLab CI 实现 Hexo 持续部署</a>》</li><li>《<a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html">随时随地 Hexo——我是如何使用 Hexo 的</a>》</li></ul></blockquote><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html# 建立 -Repo"></a>建立 Repo</h1><p>根据《<a href="https://blog.nfz.moe/archives/use-hexo-at-any-time-any-place.html">随时随地 Hexo——我是如何使用 Hexo 的 </a>》一文，你应该使用 Git 管理你的 Hexo 工程文件。<br /> 新建一个分支 <code>raw</code>，用来存放你的 Hexo 工程文件。将 <code>raw</code> 分支 push 到 GitHub 上。</p><p>如果你不想使用 SSH 的方式完成 Hexo 的 Deploy 的话，你可以使用——</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html#GitHub-Personal-Access-Token"></a>GitHub Personal Access Token</h1><p>在 GitHub 上点击页面右上角你的头像，进入 <code>Settings</code>。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000151.jpg" /></p><p>在左侧菜单的最下面、<code>Developer Settings</code> 中最后一项就是 <code>Personal Access Token</code>。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000152.jpg" /></p><p>点击 <code>Generate new token</code>。GitHub 会让你输入密码，因为这是一个危险的操作。<br />你需要给 Token 取一个名字，建议使用一个容易辨别的名字。权限勾选 <code>repo</code> 的全部权限，即可生成一个新的 Token。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000153.jpg" /></p><p>确定生成后，Token 将会显示在页面上，强烈建议你将其复制并保存好，同时避免泄露。遗忘 Token 后不能找回，只能重新生成。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html# 配置 -Travis-CI"></a>配置 Travis CI</h1><p>打开 <a href="https://travis-ci.com" target="_blank">Travis CI</a> 并用 GitHub 帐号登陆完成授权，同步一下你 GitHub 帐号下的 repo 到 Travis CI，找到你博客的 repo，把左侧的开关打开。<br />找到已经启用自动构建的 repo，并在右侧找到设置按钮，有两处需要设置。首先需要启用 <code>Build only if .travis.yml is present</code> 选项，以避免用于 deploy 的分支被构建和、陷入构建循环的问题；在下方的环境变量设置处，我们需要设置几组环境变量，并注意保持 <code>Display value in build log</code> 处于禁用状态（默认为禁用），以免构建日志泄露重要信息。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000155.jpg" /></p><pre><code>GitHubKEY = 上文生成的 GitHub Personal Access TokenGitHubEMail = 你绑定在 GitHub 上的邮箱地址GitHubUser = 你的 GitHub 用户名GitHubRepo = 静态页面 deploy 的目标仓库名称</code></pre><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html# 定义构建流程"></a>定义构建流程</h1><p>Travis CI 使用 repo 根目录下的 <code>.travis.yml</code> 来定义构建流程。</p><p>有关于 Travis CI 配置的详细解释可以查阅 <a href="http://docs.travis-ci.com/" target="_blank"> 文档</a>，下面是我使用的 <code>.travis.yml</code>：</p><pre><code><span>language</span><span>:</span> node_js<span>dist</span><span>:</span> trusty<span>node_js</span><span>:</span>  <span>-</span> <span>&quot;7&quot;</span><span>install</span><span>:</span>  <span>-</span> npm install hexo<span>-</span>cli <span>-</span>g  <span>-</span> npm install<span>script</span><span>:</span>  <span>-</span> chmod +x ../deploy.sh  <span>-</span> hexo clean  <span>-</span> hexo g  <span>-</span> ../deploy.sh <span>&gt;</span> /dev/null<span>branches</span><span>:</span>  <span>only</span><span>:</span>    <span>-</span> raw<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，部署生成的静态页面我使用了一个 <code>deploy.sh</code>。接下来我就来介绍一下这个脚本是如何替代 <code>hexo d</code> 和 <code>hexo-deployer-git</code> 的。</p><pre><code><span>cd</span> ./public <span># Hexo 生成的目录默认在 public 下</span><span>git</span> init <span># 初始化一个 Repo</span><span>git</span> config --global push.default matching<span>git</span> config --global user.email <span>&quot;<span>${GitHubEMail}</span>&quot;</span><span>git</span> config --global user.name <span>&quot;<span>${GitHubUser}</span>&quot;</span> <span># 利用在环境变量中定义的信息配置 Git</span><span>git</span> add --all <span>.</span><span>git</span> commit -m <span>&quot;Auto Builder of <span>${GitHubUser}</span>'s Blog&quot;</span> <span># commit 信息</span><span>git</span> push --quiet --force https://<span>${GitHubKEY}</span>@github.com/<span>${GitHubUser}</span>/<span>${GitHubRepo}</span>.git master <span># 将生成的静态整站部署到指定 Repo 的 master 分支。</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html# 分支保护"></a>分支保护 </h1><p> 为了防止你不小心将 Hexo 生成的静态整站覆盖了存放工程文件的分支，你需要对存放工程文件的分支开启写保护。<br />进入 Repo 的 <code>Settings</code>，在 <code>Branches</code> 选项卡中 <code>Protected Branches</code> 选中存放你的 Hexo 工程文件的分支，只勾选第一个勾 <code>Protect this branch</code> 即可。点击 <code>Save Changes</code> 保存。</p><blockquote><p>因为在 Travis CI 构建时，是使用 <code>git push --quiet --force</code> 完成 deploy 的，所以对 Hexo 工程文件所在分支进行写保护（即禁止 Force Push）可以有效保护你的工程文件。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-travis-ci.html# 加密 -Personal-Access-Token"></a>加密 Personal Access Token</h1><p>Travis CI 的环境变量相对可靠。但 GitHub Personal Access Token 权限太大，不能轻易暴露出去。所以如果你对 Travis CI 不太放心，那么可以用 Travis 命令行工具对其进行加密。</p><p>在本地配置好 Ruby 环境后，执行</p><pre><code>gem <span>install</span> travistravis login<span><span></span><span></span></span></code></pre><p>安装 Travis 命令行工具并登陆。</p><pre><code>travis encrypt <span>'GitHubKEY=&lt; 这里填入你生成的 Token &gt;'</span> --add<span><span></span></span></code></pre><p>上面命令会在 <code>.travis.yml</code> 中添加如下内容：</p><pre><code><span>env</span><span>:</span>  <span>global</span><span>:</span>    <span>secure</span><span>:</span> QAH+/EIDC/Jg<span>...</span><span><span></span><span></span><span></span></span></code></pre><p>上面的一长串字符串就是加密后的环境变量。之后，在 Travis 执行脚本时，就可以直接使用该环境变量了。由于已经在 <code>.travis.yml</code> 里完成 <code>env</code> 的定义，你就不需要在 Travis CI 后台配置 <code>GitHubKEY</code> 变量了。</p>]]></content>
        
        <summary type="html">
            
            我已经写了三篇关于如何使用 CI 持续构建 Hexo 的文章了，现在我将博客迁移到 GitHub 上托管，所以就需要使用 Travis CI 完成持续构建了。相关阅读《使用 DaoCloud 让 Hexo 持续集成》《用 Flow.CI 让 Hexo 持续集成》《使用 GitL
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="Hexo"/>
        
        <category term="持续集成"/>
        
        <category term="CI"/>
        
        <category term="Travis"/>
        
    </entry>
    
    <entry>
        <title>Docker+Jekyll+NGINX 全自动部署</title>
        <link href="https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html"/>
        <id>https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-08-18T08:01:16+00:00</published>
        <updated>2017-08-18T08:01:16+00:00</updated>
        
        <content type="html"><![CDATA[<p>继上一篇文章，完成了<a href="kejun.me">个人首页</a>的全自动部署。</p>

<ul>
  <li><a href="https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html#开始">开始</a></li>
  <li><a href="https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html#nginx">NGINX</a></li>
  <li><a href="https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html#jekyll">jekyll</a></li>
  <li><a href="https://blog.kejun.me//technology/2017/08/18/docker-jekyll-nginx-auto-pull.html#autopull">autopull</a></li>
</ul>

<h2>开始</h2>

<p>需要安装以下工具：</p>

<ul>
  <li>编辑器,以vim为例</li>
  <li>docker</li>
  <li>docker-compose</li>
</ul>

<p>新建并进入要工作的目录：</p>

<div><div><pre><code>mkdir workspace
<span>cd </span>workspace
</code></pre></div></div>

<blockquote>
  <p>不建议使用 windows 系统</p>
</blockquote>

<h2>NGINX</h2>

<p>创建 NGINX 的 <code>Dockerfile</code> ：</p>

<div><div><pre><code>mkdir nginx
<span>cd </span>nginx
vim Dockerfile
</code></pre></div></div>
<p>输入：</p>

<div><div><pre><code><span>FROM</span><span> nginx</span>
<span>COPY</span><span> nginx/default.conf /etc/nginx/conf.d/default.conf</span>
</code></pre></div></div>

<p>可以看的我们 <code>COPY</code> 了一份 <code>default.conf</code> ,因此还要再新建一个 <code>default.conf</code>:</p>

<div><div><pre><code>vim default.conf
</code></pre></div></div>

<p>输入：</p>

<div><div><pre><code>
<span>server</span> <span>{</span>
    <span>listen</span>       <span>80</span><span>;</span>
    <span>server_name</span>  <span>localhost</span><span>;</span>
    <span>root</span> <span>/app</span><span>;</span>
    <span>error_page</span>   <span>500</span> <span>502</span> <span>503</span> <span>504</span>  <span>/50x.html</span><span>;</span>
    <span>location</span> <span>=</span> <span>/50x.html</span> <span>{</span>
        <span>root</span>   <span>/usr/share/nginx/html</span><span>;</span>
    <span>}</span>
    <span>location</span> <span>~</span><span>*</span> <span>/</span><span>(images|css|assets)</span> <span>{</span>
        <span>index</span> <span>index.html</span><span>;</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>创建<code>conf.d</code>文件夹：</p>

<div><div><pre><code>mkdir conf.d
</code></pre></div></div>

<p>以后所有的服务器配置全部放置在 <code>conf.d</code> 文件夹里。</p>

<p>返回 <code>workspace</code> 并创建 <code>docker-compose.yml</code> :</p>

<div><div><pre><code><span># 这个时候的工作目录是在 workspace ！</span>
vim docker-compose.yml 
</code></pre></div></div>

<p>输入以下内容：</p>

<div><div><pre><code><span>version</span><span>:</span> <span>'</span><span>2.1'</span>

<span>services</span><span>:</span>
  <span>nginx</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span>  <span>./nginx/Dockerfile</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/data:/app</span>
      <span>-</span> <span>./nginx/conf.d:/etc/nginx/conf.d</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>80:80</span>
      <span>-</span> <span>443:443</span>
</code></pre></div></div>

<p>在 volumes 中可以看的，<code>./site/data</code> 对应 <code>/app</code> ,也就是说，未来我们的jekyll构建的文件都将在 <code>./site/data</code> 中。</p>

<p>这个时候，我们的 <code>nginx</code> 已经可以跑起来了，你可以在 <code>./site/data</code> 创建一个<code>index.html</code> ,并使用：</p>

<div><div><pre><code>docker-compose build
docker-compose up
</code></pre></div></div>

<p>然后访问你的ip，就可以看到了。</p>

<h2>jekyll</h2>

<p>想当初，要使用 githooks 自动部署，必须在服务器安装 Ruby 。</p>

<p>如今，Docker 大法好。</p>

<p>在 <code>workspace</code> 下创建 <code>jekyll</code> 目录并建立 Dockerfile ：</p>

<div><div><pre><code>mkdir jekyll
<span>cd </span>jekyll
vim Dockerfile
</code></pre></div></div>

<p>输入：</p>

<div><div><pre><code><span>FROM</span><span> jekyll/jekyll</span>
<span>CMD</span><span> jekyll build -w</span>
</code></pre></div></div>

<p>返回 <code>workspace</code> ，编辑 <code>docker-compose.yml</code> ：</p>

<div><div><pre><code>vim docker-compose.yml
</code></pre></div></div>

<p>修改为：</p>

<div><div><pre><code><span>version</span><span>:</span> <span>'</span><span>2.1'</span>
<span>services</span><span>:</span>
  <span># nginx 在这</span>
  <span>nginx</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span>  <span>./nginx/Dockerfile</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/data:/app</span>
      <span>-</span> <span>./nginx/conf.d:/etc/nginx/conf.d</span>
      <span>-</span> <span>/etc/letsencrypt:/etc/letsencrypt</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>80:80</span>
      <span>-</span> <span>443:443</span>
  <span># jekyll 在这</span>
  <span>jekyll</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span>  <span>./jekyll/Dockerfile</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/source:/srv/jekyll</span>
      <span>-</span> <span>./site/data:/srv/jekyll/_site</span>
</code></pre></div></div>

<p>在 volumes 中可以看的，<code>./site/source</code> 对应 <code>/srv/jekyll</code> ,也就是说，我们的jekyll 站点的源码就在 <code>./site/source</code> 中；<code>./site/data/homepage</code> 对应 <code>/srv/jekyll/_site</code> ,也就是说，我们 jekyll 构建后的内容就在 <code>./site/data</code> 中。</p>

<p><code>./site/data</code> 目录正好对应 nginx。</p>

<blockquote>
  <p>比较建议将 <code>./site/data:/srv/jekyll/_site</code> 改为 <code>./site/data/jekyllsite:/srv/jekyll/_site</code> ，并在 <code>./nginx/conf.d</code> 里新建 nginx 配置，这样你可以更方便的管理一个以上的站点。</p>
</blockquote>

<p>这个时候，我们的 <code>jekyll</code> 已经可以跑起来了，你可以在 <code>./site/source</code> 中拉取我们的 jekyll 项目：</p>

<div><div><pre><code><span># ./site/source 目录里，命令最后有个&quot;.&quot;</span>
git clone https://git.coding.net/KeJun/homepage.git <span>.</span>
</code></pre></div></div>

<p>然后执行：</p>

<div><div><pre><code><span># `workspace` 目录里</span>
docker-compose build
docker-compose up
</code></pre></div></div>

<p>此时，访问 ip ，成功的将jekyll部署啦~</p>

<h2>autopull</h2>

<p>由于我的远程仓库在 coding 里，无法操作 githooks 。</p>

<p>但是，无论是 github 还是 coding 都提供了 <a href="https://open.coding.net/webhooks/">WebHook</a> 。</p>

<p>我使用 nodejs 造了一个接受 coding webhook 一小段代码。</p>

<p>返回 <code>workspace</code> ，创建 <code>autopull</code> 目录并新建 <code>config.js</code> ：</p>

<div><div><pre><code><span>module</span><span>.</span><span>exports</span> <span>=</span> <span>{</span>
    <span>folder</span> <span>:</span> <span>&quot;site&quot;</span><span>,</span>
    <span>port</span> <span>:</span> <span>9091</span><span>,</span>
    <span>token</span> <span>:</span> <span>&quot;xxx&quot;</span>
  <span>};</span>
</code></pre></div></div>

<p>新建 <code>index.js</code> ：</p>

<div><div><pre><code><span>var</span> <span>http</span> <span>=</span> <span>require</span><span>(</span><span>'http'</span><span>);</span>
<span>var</span> <span>exec</span> <span>=</span> <span>require</span><span>(</span><span>'child_process'</span><span>).</span><span>exec</span><span>;</span>
<span>var</span> <span>config</span> <span>=</span> <span>require</span><span>(</span><span>'./config.js'</span><span>);</span>
<span>var</span> <span>main</span> <span>=</span> <span>function</span> <span>(</span><span>data</span><span>,</span><span>res</span><span>)</span> <span>{</span>
    <span>//校验是不是第一次绑定</span>
    <span>if</span> <span>(</span><span>data</span><span>.</span><span>zen</span><span>){</span>
        <span>console</span><span>.</span><span>log</span><span>(</span><span>data</span><span>.</span><span>zen</span><span>);</span>
        <span>res</span><span>.</span><span>end</span><span>();</span>
        <span>return</span> <span>0</span><span>;</span>
    <span>}</span>
    <span>//校验 event 类型</span>
    <span>if</span> <span>(</span><span>data</span><span>.</span><span>event</span> <span>===</span> <span>&quot;push&quot;</span><span>)</span> <span>{</span>
        <span>//校验 token 类型</span>
        <span>if</span> <span>(</span><span>data</span><span>.</span><span>token</span> <span>==</span> <span>config</span><span>.</span><span>token</span><span>)</span> <span>{</span>
            <span>//执行 pull</span>
            <span>exec</span><span>(</span><span>&quot;cd &quot;</span><span>+</span><span>config</span><span>.</span><span>folder</span><span>+</span><span>&quot; &amp;&amp; git pull&quot;</span><span>,</span> <span>function</span> <span>(</span><span>err</span><span>,</span> <span>stdout</span><span>)</span> <span>{</span>
                <span>var</span> <span>cmd_message</span> <span>=</span> <span>stdout</span><span>.</span><span>replace</span><span>(</span><span>/^</span><span>[</span><span>0-9a-f</span><span>]</span><span>+</span><span>?\ </span><span>/</span><span>,</span> <span>''</span><span>);</span>
                <span>console</span><span>.</span><span>log</span><span>(</span><span>cmd_message</span><span>);</span>
                <span>//console.log(err);</span>
                <span>res</span><span>.</span><span>end</span><span>();</span>
            <span>});</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
<span>var</span> <span>server</span> <span>=</span> <span>http</span><span>.</span><span>createServer</span><span>(</span><span>function</span> <span>(</span><span>req</span><span>,</span> <span>res</span><span>)</span> <span>{</span>
    <span>var</span> <span>POST</span> <span>=</span> <span>&quot;&quot;</span><span>;</span>
    <span>req</span><span>.</span><span>on</span><span>(</span><span>'data'</span><span>,</span> <span>function</span> <span>(</span><span>chunk</span><span>)</span> <span>{</span>
        <span>POST</span> <span>+=</span> <span>chunk</span><span>;</span>
    <span>});</span>
    <span>req</span><span>.</span><span>on</span><span>(</span><span>'end'</span><span>,</span> <span>function</span> <span>()</span> <span>{</span>
        <span>POST</span> <span>=</span> <span>JSON</span><span>.</span><span>parse</span><span>(</span><span>POST</span><span>);</span>
        <span>res</span><span>.</span><span>writeHead</span><span>(</span><span>200</span><span>,</span> <span>{</span>
            <span>&quot;Content-Type&quot;</span><span>:</span> <span>&quot;text/plain&quot;</span>
        <span>});</span>
        <span>main</span><span>(</span><span>POST</span><span>,</span><span>res</span><span>);</span>
    <span>});</span>
<span>});</span>
<span>server</span><span>.</span><span>listen</span><span>(</span><span>config</span><span>.</span><span>port</span><span>);</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>&quot;Server runing at port: &quot;</span> <span>+</span> <span>config</span><span>.</span><span>port</span> <span>+</span> <span>&quot;.&quot;</span><span>);</span>
</code></pre></div></div>

<p>这段代码参考了<a href="https://blog.coding.net/blog/nodejs-webhook">使用 Node.js 实现简单的 Webhook</a>，目前自用还没有看到bug，有 dalao 的话帮忙优化以下。</p>

<p>新建 <code>Dockerfile</code> ：</p>

<div><div><pre><code><span>FROM</span><span> node:6-alpine</span>
<span>ENV</span><span> NODE_ENV production</span>
<span>RUN </span>apk update <span>&amp;&amp;</span> apk upgrade <span>&amp;&amp;</span> <span>\
</span>    apk add <span>--no-cache</span> bash git openssh
<span>WORKDIR</span><span> /usr/src/app</span>
<span>COPY</span><span> ./* /usr/src/app/</span>
<span>EXPOSE</span><span> 9091</span>
<span>CMD</span><span> node index.js</span>
</code></pre></div></div>

<p>这里我们在容器里安装了 <code>git</code></p>

<p>返回 <code>workspace</code> 并修改 <code>docker-compose.yml</code> :</p>

<div><div><pre><code><span># 这个时候的工作目录是在 workspace ！</span>
vim docker-compose.yml 
</code></pre></div></div>

<p>修改为：</p>

<div><div><pre><code><span>version</span><span>:</span> <span>'</span><span>2.1'</span>
<span>services</span><span>:</span>
  <span># nginx 在这</span>
  <span>nginx</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span>  <span>./nginx/Dockerfile</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/data:/app</span>
      <span>-</span> <span>./nginx/conf.d:/etc/nginx/conf.d</span>
      <span>-</span> <span>/etc/letsencrypt:/etc/letsencrypt</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>80:80</span>
      <span>-</span> <span>443:443</span>
  <span># jekyll 在这</span>
  <span>jekyll</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span>  <span>./jekyll/Dockerfile</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/source:/srv/jekyll</span>
      <span>-</span> <span>./site/data:/srv/jekyll/_site</span>
  <span># autopull 在这</span>
  <span>autopull</span><span>:</span>
    <span>build</span><span>:</span>
      <span>context</span><span>:</span> <span>.</span>
      <span>dockerfile</span><span>:</span> <span>./autopull/Dockerfile</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>9091:9091</span>
    <span>volumes</span><span>:</span>
      <span>-</span> <span>./site/source:/usr/src/app/site</span>
</code></pre></div></div>

<p><code>./site/source:/usr/src/app/site</code> 注意这里一定要加上 <code>site</code> 。</p>

<p>现在我们就可以启动咯！</p>

<div><div><pre><code><span># `workspace` 目录里</span>
docker-compose build
docker-compose up
</code></pre></div></div>

<p>现在，在 coding 仓库项目设置中添加一个WebHook，并将 url 指向，你 <code>服务器ip:9091</code>,如果设置令牌的话，一定要和 <code>config.js</code> 中的 <code>token</code> 一致。</p>

<p>绑定成功后， coding 会自动发送：</p>

<div><div><pre><code><span>{</span><span>
    </span><span>&quot;token&quot;</span><span>:</span><span> </span><span>&quot;123&quot;</span><span>,</span><span> 
    </span><span>&quot;zen&quot;</span><span>:</span><span> </span><span>&quot;Coding！ 让开发更简单&quot;</span><span>
</span><span>}</span><span>
</span></code></pre></div></div>

<p>如果没有意外，你可以在 console 里看到 <code>autopull_1  | Coding！ 让开发更简单</code> 。</p>

<p>这个时候，尝试修改远程仓库文件并提交，你会在 console 里看到类似下面的信息：</p>

<div><div><pre><code>autopull_1  | Updating c79effb..0fba65c
autopull_1  | Fast-forward
autopull_1  |  offline.html | 3 +--
autopull_1  |  1 file changed, 1 insertion<span>(</span>+<span>)</span>, 2 deletions<span>(</span>-<span>)</span>
autopull_1  | 
jekyll_1    |       Regenerating: 1 file<span>(</span>s<span>)</span> changed at 2017-08-18 07:43:04 ...done <span>in </span>0.081600133 seconds.
</code></pre></div></div>

<p>至此，我们就完成了，一切就绪后，我们使用：</p>

<div><div><pre><code>docker-compose up <span>-d</span>
</code></pre></div></div>

<p>在后台运行 docker ，享受高枕无忧。</p>

<p>补充一下文件树：</p>

<pre><code>├── autopull
│   ├── config.js
│   ├── Dockerfile
│   ├── index.js
│   └── package.json
├── docker-compose.yml
├── jekyll
│   └── Dockerfile
├── nginx
│   ├── conf.d
│   │   └── homepage.conf
│   ├── default.conf
│   └── Dockerfile
└── site
    ├── data
    │   ├── homepage
        │   └── ...
    │   └── index.html
    └── source
        └── ...
</code></pre>]]></content>
        
        <summary type="html">
            
            继上一篇文章，完成了个人首页的全自动部署。     开始   NGINX   jekyll   autopull   开始  需要安装以下工具：     编辑器,以vim为例   docker   docker-compose   新建并进入要工作的目录：  mkdir wor
            
        </summary>
        
        <category term="jekyll"/>
        
        <category term="docker"/>
        
        <category term="nginx"/>
        
        <category term="auto"/>
        
        <category term="pull"/>
        
        <category term="autopull"/>
        
    </entry>
    
    <entry>
        <title>Powershell 美化笔记</title>
        <link href="https://blog.kejun.me//technology/2017/08/17/beautify-powershell.html"/>
        <id>https://blog.kejun.me//technology/2017/08/17/beautify-powershell.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-08-17T08:01:16+00:00</published>
        <updated>2017-08-17T08:01:16+00:00</updated>
        
        <content type="html"><![CDATA[<p>嗯，PowerShell 的蠢蓝色背景和宋体真的是丑到让我怀疑人生。</p>

<h2>缘起</h2>

<p>某天某人尝试折腾宝塔面板，但没注意看宝塔面板只适合<strong>纯净系统</strong>。</p>

<p>于是尝试卸载不行就重装的无敌大法，突然想起了 halyul 的站用了 docker 。向 dalao 看齐。</p>

<p>再本地调试的时候，实在忍受不了 PowerShell 难看的默认样式，就开始折腾了。</p>

<h2>前面的坑</h2>

<p>首先通过强大的浏览器找的了 <a href="https://www.petri.com/change-powershell-console-font-and-background-colors">How to Change PowerShell Console Font and Background Colors</a> 这篇文章。</p>

<p>确实写的蛮不错，复制粘贴用了之后好爽。</p>

<p>配图的截图就来自于这个的运行结果：</p>

<div><div><pre><code>Function Test-ConsoleColor <span>{</span>
<span>[</span>cmdletbinding<span>()]</span>
Param<span>()</span>
 
Clear-Host
<span>$heading</span> <span>=</span> <span>&quot;White&quot;</span>
Write-Host <span>&quot;Pipeline Output&quot;</span> <span>-ForegroundColor</span> <span>$heading</span>
Get-Service | Select <span>-first</span> 5
 
Write-Host <span>&quot;</span><span>`</span>nError<span>&quot; -ForegroundColor </span><span>$heading</span><span>
Write-Error &quot;</span>I made a mistake<span>&quot;
 
Write-Host &quot;</span><span>`</span><span>nWarning&quot;</span> <span>-ForegroundColor</span> <span>$heading</span>
Write-Warning <span>&quot;Let this be a warning to you.&quot;</span>
 
Write-Host <span>&quot;</span><span>`</span>nVerbose<span>&quot; -ForegroundColor </span><span>$heading</span><span>
</span><span>$VerbosePreference</span><span> = &quot;</span>Continue<span>&quot;
Write-Verbose &quot;</span>I have a lot to say.<span>&quot;
</span><span>$VerbosePreference</span><span> = &quot;</span>SilentlyContinue<span>&quot;
 
Write-Host &quot;</span><span>`</span><span>nDebug&quot;</span> <span>-ForegroundColor</span> <span>$heading</span>
<span>$DebugPreference</span> <span>=</span> <span>&quot;Continue&quot;</span>
Write-Debug <span>&quot;</span><span>`</span>nSomething is bugging me. Figure it out.<span>&quot;
</span><span>$DebugPreference</span><span> = &quot;</span>SilentlyContinue<span>&quot;
 
Write-Host &quot;</span><span>`</span><span>nProgress&quot;</span> <span>-ForegroundColor</span> <span>$heading</span>
1..10 | foreach <span>-Begin</span> <span>{</span><span>$i</span><span>=</span>0<span>}</span> <span>-process</span> <span>{</span>
 <span>$i</span>++
 <span>$p</span> <span>=</span> <span>(</span><span>$i</span>/10<span>)</span><span>*</span>100
 Write-Progress <span>-Activity</span> <span>&quot;Progress Test&quot;</span> <span>-Status</span> <span>&quot;Working&quot;</span> <span>-CurrentOperation</span> <span>$_</span> <span>-PercentComplete</span> <span>$p</span>
 Start-Sleep <span>-Milliseconds</span> 250
<span>}</span>
<span>}</span> <span>#Test-ConsoleColor</span>
</code></pre></div></div>

<p>在终端输入 <code>Test-ConsoleColor</code> 就可以测试各种类型输出的颜色。</p>

<p>最终，我没有选择这个。</p>

<h2>配色</h2>

<p><a href="https://github.com/lukesampson/concfg">lukesampson/concfg</a> 可以用来导入和导出Windows控制台的设置。总之 concfg 十分方便。</p>

<p>安装很简单，首先安装 scoop</p>

<div><div><pre><code>iex <span>(</span>new-object net.webclient<span>)</span>.downloadstring<span>(</span><span>'https://get.scoop.sh'</span><span>)</span>
</code></pre></div></div>
<p>如果你没有打开运行远程签名的脚本文件则会提示你输入下面的指令：</p>

<div><div><pre><code>Set-ExecutionPolicy RemoteSigned <span>-scope</span> CurrentUser
</code></pre></div></div>
<p>允许之后，再允许一次安装命令即可。</p>

<p>使用 <code>scoop help</code> 检查是否已安装成功。</p>

<p>接下来只要使用 <code>scoop install concfg</code> 就完成了concfg的安装。</p>

<h2>字体</h2>

<p>首选 Inziu Iosevka 系列字体，可以在 <a href="https://be5invis.github.io/Iosevka/inziu.html"> Inziu Iosevka </a> 下载，然后安装到<code>C:\Windows\Fonts</code> （安装后会有三个小字体，Inziu Iosevka SC/TC/J 和 Inziu IosevkaCC SC/TC/J 可以用于控制台）。</p>

<p>另外还需要修改注册表：</p>

<div><div><pre><code>HKEY_LOCAL_MACHINE <span>&gt;&gt;</span> SOFTWARE <span>&gt;&gt;</span> Microsoft <span>&gt;&gt;</span> Windows NT <span>&gt;&gt;</span> CurrentVersion <span>&gt;&gt;</span> Console <span>&gt;&gt;</span> TrueTypeFont
</code></pre></div></div>

<p>新增一个字符串项目，内容为“Inziu Iosevka SC”。</p>

<h2>应用</h2>

<p>新建一个 <code>Ttheme.cfg</code> 文件，并键入如下内容：</p>

<div><div><pre><code><span>{</span><span>
    </span><span>&quot;cursor_size&quot;</span><span>:</span><span>  </span><span>&quot;small&quot;</span><span>,</span><span>
    </span><span>&quot;command_history_length&quot;</span><span>:</span><span>  </span><span>50</span><span>,</span><span>
    </span><span>&quot;num_history_buffers&quot;</span><span>:</span><span>  </span><span>4</span><span>,</span><span>
    </span><span>&quot;command_history_no_duplication&quot;</span><span>:</span><span>  </span><span>false</span><span>,</span><span>
    </span><span>&quot;quick_edit&quot;</span><span>:</span><span>  </span><span>true</span><span>,</span><span>
    </span><span>&quot;insert_mode&quot;</span><span>:</span><span>  </span><span>true</span><span>,</span><span>
    </span><span>&quot;load_console_IME&quot;</span><span>:</span><span>  </span><span>true</span><span>,</span><span>
    </span><span>&quot;font_face&quot;</span><span>:</span><span>  </span><span>&quot;Inziu Iosevka SC&quot;</span><span>,</span><span>
    </span><span>&quot;font_true_type&quot;</span><span>:</span><span>  </span><span>true</span><span>,</span><span>
    </span><span>&quot;font_size&quot;</span><span>:</span><span>  </span><span>&quot;0x18&quot;</span><span>,</span><span>
    </span><span>&quot;font_weight&quot;</span><span>:</span><span>  </span><span>0</span><span>,</span><span>
    </span><span>&quot;screen_buffer_size&quot;</span><span>:</span><span>  </span><span>&quot;80x3000&quot;</span><span>,</span><span>
    </span><span>&quot;window_size&quot;</span><span>:</span><span>  </span><span>&quot;80x20&quot;</span><span>,</span><span>
    </span><span>&quot;fullscreen&quot;</span><span>:</span><span>  </span><span>false</span><span>,</span><span>
    </span><span>&quot;popup_colors&quot;</span><span>:</span><span>  </span><span>&quot;cyan,white&quot;</span><span>,</span><span>
    </span><span>&quot;screen_colors&quot;</span><span>:</span><span>  </span><span>&quot;white,black&quot;</span><span>,</span><span>
    </span><span>&quot;black&quot;</span><span>:</span><span>  </span><span>&quot;#1E1E1E&quot;</span><span>,</span><span>
    </span><span>&quot;dark_blue&quot;</span><span>:</span><span>  </span><span>&quot;#2472C8&quot;</span><span>,</span><span>
    </span><span>&quot;dark_green&quot;</span><span>:</span><span>  </span><span>&quot;#0DBC79&quot;</span><span>,</span><span>
    </span><span>&quot;dark_cyan&quot;</span><span>:</span><span>  </span><span>&quot;#11A8CD&quot;</span><span>,</span><span>
    </span><span>&quot;dark_red&quot;</span><span>:</span><span>  </span><span>&quot;#CD3131&quot;</span><span>,</span><span>
    </span><span>&quot;dark_magenta&quot;</span><span>:</span><span>  </span><span>&quot;#BC3FBC&quot;</span><span>,</span><span>
    </span><span>&quot;dark_yellow&quot;</span><span>:</span><span>  </span><span>&quot;#E5E510&quot;</span><span>,</span><span>
    </span><span>&quot;gray&quot;</span><span>:</span><span>  </span><span>&quot;#E5E5E5&quot;</span><span>,</span><span>
    </span><span>&quot;dark_gray&quot;</span><span>:</span><span>  </span><span>&quot;#666666&quot;</span><span>,</span><span>
    </span><span>&quot;blue&quot;</span><span>:</span><span>  </span><span>&quot;#3B8EEA&quot;</span><span>,</span><span>
    </span><span>&quot;green&quot;</span><span>:</span><span>  </span><span>&quot;#23D18B&quot;</span><span>,</span><span>
    </span><span>&quot;cyan&quot;</span><span>:</span><span>  </span><span>&quot;#29B8DB&quot;</span><span>,</span><span>
    </span><span>&quot;red&quot;</span><span>:</span><span>  </span><span>&quot;#F14C4C&quot;</span><span>,</span><span>
    </span><span>&quot;magenta&quot;</span><span>:</span><span>  </span><span>&quot;#D670D6&quot;</span><span>,</span><span>
    </span><span>&quot;yellow&quot;</span><span>:</span><span>  </span><span>&quot;#F5F543&quot;</span><span>,</span><span>
    </span><span>&quot;white&quot;</span><span>:</span><span>  </span><span>&quot;#E5E5E5&quot;</span><span>
</span><span>}</span><span>
</span></code></pre></div></div>

<p>当然可以根据自己的需求随意改动。</p>

<p>在此处打开 PowerShell ，使用 <code>concfg import Ttheme.cfg -n</code> 命令后新开一个 PowerShell 窗口，就完成拉~</p>]]></content>
        
        <summary type="html">
            
            嗯，PowerShell 的蠢蓝色背景和宋体真的是丑到让我怀疑人生。  缘起  某天某人尝试折腾宝塔面板，但没注意看宝塔面板只适合纯净系统。  于是尝试卸载不行就重装的无敌大法，突然想起了 halyul 的站用了 docker 。向 dalao 看齐。  再本地调试的时候，实在
            
        </summary>
        
        <category term="powershell"/>
        
    </entry>
    
    <entry>
        <title>Android 的网络感叹号</title>
        <link href="https://blog.nfz.moe/archives/android-captive-portal.html"/>
        <id>https://blog.nfz.moe/archives/android-captive-portal.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-15T17:06:17+00:00</published>
        <updated>2017-08-15T17:06:17+00:00</updated>
        
        <content type="html"><![CDATA[<p>从 Android L 开始，原生和 CM 的 ROM 用户就会发现，状态栏的网络信号莫名多了一个感叹号。而且，有的时候明明连着 WIFI 用得好好的，却突然跳到数据流量。</p><a></a><h1><a href="https://blog.nfz.moe/archives/android-captive-portal.html#“感叹号”出现的原因和作用"></a>“感叹号”出现的原因和作用</h1><p>Android 5.0 开始引入了一种新的网络评估机制来评估网络状况，当你有网络请求时会自动选择网络连接条件最好的一个网络进行连接（也就是 WIFI 和数据之间自动切换）。自然，验证方法是连接到 Google 自家的服务器进行检查。</p><blockquote><p>这个检测的作用除了可以检查该网络是否能够使用以外，还能检查该网络是否需要登陆（就是运营商的 WiFi 如 CCMC，或者其它公共场所的免费 WiFi 的那个认证）。</p></blockquote><hr /><p>正是这个 google 被 Wall 掉了以后导致安卓没有办法评估网络。所以，系统每隔一定时间都会重新尝试连接，就在不知不觉中消耗了数据流量。更恐怖的就是 Android 认为在 WiFi 下无法连接互联网，就让联网的程序通通走流量。于是这样就导致了那个蛋碎的感叹号一直存在，以及 WiFi 用着用着突然自动连回数据连接了。</p><h1><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 解决方法"></a>解决方法 </h1><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-5-0-6-0"></a>Android 5.0-6.0</h2><h3><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 直接禁用验证"></a> 直接禁用验证 </h3><p> 手机连接电脑开启 USB 调试，输入以下 ADB 命令：</p><pre><code>adb shell <span>&quot;settings put global captive_portal_detection_enabled 0&quot;</span><span><span></span></span></code></pre><p>重启设备或者开关一下飞行模式就行。</p><blockquote><p>但是，还记得我说过么，这个感叹号可以用来判断网络可用性，还可以用来判断网络是否需要登录。</p></blockquote><h3><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 更换验证地址"></a>更换验证地址 </h3><p> 当然还有另外一个方法，就是直接把这个服务地址切换到国内的可用的地址就行了。这样既可以去除叹号，也可以检查网络可用情况。</p><pre><code>adb shell <span>&quot;settings put global captive_portal_server your.domain&quot;</span><span><span></span></span></code></pre><h3><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 恢复方法"></a>恢复方法 </h3><p> 如果你用的是第一种方法，恢复方法是：</p><pre><code>adb shell <span>&quot;settings put global captive_portal_detection_enabled 1&quot;</span><span><span></span></span></code></pre><p>如果你用的是第二种方法，那么你需要输入的是：</p><pre><code>adb shell <span>&quot;settings delete global captive_portal_server&quot;</span><span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-7-0-7-1-0"></a>Android 7.0-7.1.0</h2><p>与 Android 5.0-6.0 所用的方法相同，只是验证要求从 443 端口进行，也就是说必须要支持通过 HTTPS 正常访问。</p><p>也可以通过 ADB 输入以下指令禁用 HTTPS：</p><pre><code>adb shell <span>&quot;settings put global captive_portal_use_https 0&quot;</span><span><span></span></span></code></pre><p>恢复 HTTPS 的方法是用 ADB 输入以下指令：</p><pre><code>adb shell <span>&quot;settings put global captive_portal_use_https 1&quot;</span><span><span></span></span></code></pre><p>或者</p><pre><code>adb shell <span>&quot;settings delete global captive_portal_use_https&quot;</span><span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-7-1"></a>Android 7.1+</h2><p>从 Android 7.1.1 开始，系统在验证时不会自动加入 <code>generate_204</code> 的后缀了，这意味着 url 可以设计的更加灵活，同时也意味着在设置的时候需要填入完整的 url，即需要在现有的 url 验证地址后面加上 <code>/generate_204</code></p><p>同时也默认要求使用 HTTPS 的方法进行验证。禁用和恢复 HTTPS 检查的方法同 <a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-7-0-7-1-0">Android 7.0 ~ 7.1.0</a> 的方法。</p><p>在 Android 7.1+ 上配置 Captive Portal 地址需要两行指令：</p><pre><code>adb shell &quot;settings put global captive_portal_http_url http://yourdomain&quot;; adb shell &quot;settings put global captive_portal_https_url https://]]yourdomain&quot;;</code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 手机端应用"></a>手机端应用 </h2><p><a href="www.noisyfox.cn"> 小狐狸 </a> 开发了这款“叹号杀手”应用实现了这个：<a href="http://www.coolapk.com/apk/org.foxteam.noisyfox.noexclamation" target="_blank">酷安下载地址</a></p><p>用这款应用可以快速设置禁用验证或者更换验证地址。<del>可能 </del> 需要 root，如果没 root <del>可能 </del> 会导致修改失败。</p><h1><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 架设自己的验证服务"></a>架设自己的验证服务 </h1><p> 这个验证机制是访问所给地址的 <code>generate_204</code> 子目录看返回值，所以可以这么解决：</p><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Apache"></a>Apache</h2><p>开启 Rewrite 模块（大部分虚拟主机商都会帮你开好），在 <code>.htaccess</code> 文件中最末写入以下值：</p><pre><code><span><span><span>&lt;</span>IfModule</span><span> mod_rewrite.c</span><span>&gt;</span></span>  <span>RewriteEngine</span> On  <span>RewriteCond</span> <span>%{REQUEST_URI}</span><span> /generate_204$</span>  <span>RewriteRule</span><span> $</span> / [R=204]<span><span><span>&lt;/</span>IfModule</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Nignx"></a>Nignx</h2><p>直接在配置文件中写入：</p><pre><code><span>location</span> <span>/</span>generate_204 <span>{</span><span>return</span> <span>204</span><span>;</span><span>}</span><span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Workaround"></a>Workaround</h2><p><del>如果你没有服务器（比如你只用 pages 服务），或者上述设置方法全部无效，还有一个 workaround 的方法——直接建立一个名字叫做“generate_204”的空文件，因为空文件也会被 Android 当做是 204 返回（毕竟空文件绝对不会是网络登录验证咯）</del> 经测试，这种方法已经不能生效了。</p><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 验证服务地址"></a>验证服务地址</h2><ul><li>www.qualcomm.com/generate_204（高通）</li><li>noisyfox.cn/generate_204（小狐狸）</li><li><del>www.v2ex.com</del>（V2EX 旧 Captive 地址，已弃用）</li><li>captive.v2ex.co/generate_204（V2EX 新 Captive 地址）</li><li><del>bbs.mfunz.com</del>（魔趣开源项目，已弃用）</li><li>g.cn/generate_204（谷歌中国，一个不存在的网站）</li><li>google.cn</li><li>developer.google.cn/generate_204（谷歌开发者文档中国）</li><li>http204.sinaapp.com/generate_204（Tink 提供，运行在 SAE 上）</li></ul><h1><a href="https://blog.nfz.moe/archives/android-captive-portal.html# 分析 -NetWorkMonitor- 的工作原理"></a>分析 NetWorkMonitor 的工作原理 </h1><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-5-0-6-0-1"></a>Android 5.0~6.0</h2><p> 以下代码摘自 <a href="https://android.googlesource.com/platform/frameworks/base/+/android-6.0.1_r70/services/core/java/com/android/server/connectivity/NetworkMonitor.java" target="_blank">Android 6.0.1_r70 分支</a> 的 <code>NetworkMonitor</code> 第 384 行至第 425 行</p><pre><code><span>@Override</span><span>public</span> <span>boolean</span> <span>processMessage</span><span>(</span>Message message<span>)</span> <span>{</span><span>switch</span> <span>(</span>message<span>.</span>what<span>)</span> <span>{</span>        <span>case</span> CMD_REEVALUATE<span>:</span>            <span>if</span> <span>(</span>message<span>.</span>arg1 <span>!=</span> mReevaluateToken <span>||</span> mUserDoesNotWant<span>)</span>                <span>return</span> HANDLED<span>;</span>            <span>// Don't bother validating networks that don't satisify the default request.</span>            <span>// This includes:</span>            <span>//  - VPNs which can be considered explicitly desired by the user and the</span>            <span>//    user's desire trumps whether the network validates.</span>            <span>//  - Networks that don't provide internet access.  It's unclear how to</span>            <span>//    validate such networks.</span>            <span>//  - Untrusted networks.  It's unsafe to prompt the user to sign-in to</span>            <span>//    such networks and the user didn't express interest in connecting to</span>            <span>//    such networks (an app did) so the user may be unhappily surprised when</span>            <span>//    asked to sign-in to a network they didn't want to connect to in the</span>            <span>//    first place.  Validation could be done to adjust the network scores</span>            <span>//    however these networks are app-requested and may not be intended for</span>            <span>//    general usage, in which case general validation may not be an accurate</span>            <span>//    measure of the network's quality.  Only the app knows how to evaluate</span>            <span>//    the network so don't bother validating here.  Furthermore sending HTTP</span>            <span>//    packets over the network may be undesirable, for example an extremely</span>            <span>//    expensive metered network, or unwanted leaking of the User Agent string.</span>            <span>if</span> <span>(</span><span>!</span>mDefaultRequest<span>.</span>networkCapabilities<span>.</span><span>satisfiedByNetworkCapabilities</span><span>(</span>mNetworkAgentInfo<span>.</span>networkCapabilities<span>)</span><span>)</span> <span>{</span><span>transitionTo</span><span>(</span>mValidatedState<span>)</span><span>;</span>                <span>return</span> HANDLED<span>;</span>            <span>}</span>            mAttempts<span>++</span><span>;</span>            <span>// Note: This call to isCaptivePortal() could take up to a minute. Resolving the</span>            <span>// server's IP addresses could hit the DNS timeout, and attempting connections</span>            <span>// to each of the server's several IP addresses (currently one IPv4 and one</span>            <span>// IPv6) could each take SOCKET_TIMEOUT_MS.  During this time this StateMachine</span>            <span>// will be unresponsive. isCaptivePortal() could be executed on another Thread</span>            <span>// if this is found to cause problems.</span>            <span>int</span> httpResponseCode <span>=</span> <span>isCaptivePortal</span><span>(</span><span>)</span><span>;</span>            <span>if</span> <span>(</span>httpResponseCode <span>==</span> <span>204</span><span>)</span> <span>{</span><span>transitionTo</span><span>(</span>mValidatedState<span>)</span><span>;</span>            <span>}</span> <span>else</span> <span>if</span> <span>(</span>httpResponseCode <span>&gt;=</span> <span>200</span> <span>&amp;&amp;</span> httpResponseCode <span>&lt;=</span> <span>399</span><span>)</span> <span>{</span><span>transitionTo</span><span>(</span>mCaptivePortalState<span>)</span><span>;</span>            <span>}</span> <span>else</span> <span>{</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当安卓设备联网后，如果该网络是 VPN，那么直接使用这个网络进行连接，否则调用 <code>isCaptivePortal()</code> 函数进行网络状况的判定，再根据判定结果决定是否选用此网络。这个函数就会先访问系统内指定的网址并根据返回结果来判断网络状况，而这个网址如字面所说，会产生一个 204 返回值。204 返回值的意思就是空内容。如果当 WiFi 是需要登录才可以连接，那么当试图访问 google 的服务器的链接就一定会自动跳转到一个登录页面，这个时候 http 请求的返回值就必然不是 204。就是通过这一机制，便可以区分当前 WiFi 是否需要验证，不得不佩服想出这个办法的人来。</p><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-7-0-7-1-0-1"></a>Android 7.0-7.1.0</h2><p>以下代码摘自 <a href="https://android.googlesource.com/platform/frameworks/base/+/android-7.1.0_r2/services/core/java/com/android/server/connectivity/NetworkMonitor.java" target="_blank">Android 7.1.0_r2 分支</a> 的 <code>NetworkMonitor</code> 第 336 行至第 386 行。</p><pre><code><span>@Override</span><span>public</span> <span>boolean</span> <span>processMessage</span><span>(</span>Message message<span>)</span> <span>{</span><span>switch</span> <span>(</span>message<span>.</span>what<span>)</span> <span>{</span>        <span>case</span> CMD_LAUNCH_CAPTIVE_PORTAL_APP<span>:</span>            <span>final</span> Intent intent <span>=</span> <span>new</span> <span>Intent</span><span>(</span>ConnectivityManager<span>.</span>ACTION_CAPTIVE_PORTAL_SIGN_IN<span>)</span><span>;</span>            intent<span>.</span><span>putExtra</span><span>(</span>ConnectivityManager<span>.</span>EXTRA_NETWORK<span>,</span> mNetworkAgentInfo<span>.</span>network<span>)</span><span>;</span>            intent<span>.</span><span>putExtra</span><span>(</span>ConnectivityManager<span>.</span>EXTRA_CAPTIVE_PORTAL<span>,</span>                    <span>new</span> <span>CaptivePortal</span><span>(</span><span>new</span> <span>ICaptivePortal<span>.</span>Stub</span><span>(</span><span>)</span> <span>{</span>                        <span>@Override</span>                        <span>public</span> <span>void</span> <span>appResponse</span><span>(</span><span>int</span> response<span>)</span> <span>{</span><span>if</span> <span>(</span>response <span>==</span> APP_RETURN_WANTED_AS_IS<span>)</span> <span>{</span>                                mContext<span>.</span><span>enforceCallingPermission</span><span>(</span>                                        android<span>.</span>Manifest<span>.</span>permission<span>.</span>CONNECTIVITY_INTERNAL<span>,</span>                                        <span>&quot;CaptivePortal&quot;</span><span>)</span><span>;</span>                            <span>}</span>                            <span>sendMessage</span><span>(</span>CMD_CAPTIVE_PORTAL_APP_FINISHED<span>,</span> response<span>)</span><span>;</span>                        <span>}</span>                    <span>}</span><span>)</span><span>)</span><span>;</span>            intent<span>.</span><span>setFlags</span><span>(</span>Intent<span>.</span>FLAG_ACTIVITY_BROUGHT_TO_FRONT <span>|</span> Intent<span>.</span>FLAG_ACTIVITY_NEW_TASK<span>)</span><span>;</span>            mContext<span>.</span><span>startActivityAsUser</span><span>(</span>intent<span>,</span> UserHandle<span>.</span>CURRENT<span>)</span><span>;</span>            <span>return</span> HANDLED<span>;</span>        <span>default</span><span>:</span>            <span>return</span> NOT_HANDLED<span>;</span>    <span>}</span><span>}</span><span>@Override</span><span>public</span> <span>void</span> <span>exit</span><span>(</span><span>)</span> <span>{</span>    Message message <span>=</span> <span>obtainMessage</span><span>(</span>EVENT_PROVISIONING_NOTIFICATION<span>,</span> <span>0</span><span>,</span>            mNetworkAgentInfo<span>.</span>network<span>.</span>netId<span>,</span> null<span>)</span><span>;</span>    mConnectivityServiceHandler<span>.</span><span>sendMessage</span><span>(</span>message<span>)</span><span>;</span><span>}</span><span>}</span><span>/*** Result of calling isCaptivePortal().* @hide*/</span><span>@VisibleForTesting</span><span>public</span> <span>static</span> <span>final</span> <span>class</span> <span>CaptivePortalProbeResult</span> <span>{</span><span>static</span> <span>final</span> CaptivePortalProbeResult FAILED <span>=</span> <span>new</span> <span>CaptivePortalProbeResult</span><span>(</span><span>599</span><span>,</span> null<span>)</span><span>;</span><span>final</span> <span>int</span> mHttpResponseCode<span>;</span> <span>// HTTP response code returned from Internet probe.</span><span>final</span> String mRedirectUrl<span>;</span>   <span>// Redirect destination returned from Internet probe.</span><span>public</span> <span>CaptivePortalProbeResult</span><span>(</span><span>int</span> httpResponseCode<span>,</span> String redirectUrl<span>)</span> <span>{</span>    mHttpResponseCode <span>=</span> httpResponseCode<span>;</span>    mRedirectUrl <span>=</span> redirectUrl<span>;</span><span>}</span><span>boolean</span> <span>isSuccessful</span><span>(</span><span>)</span> <span>{</span> <span>return</span> mHttpResponseCode <span>==</span> <span>204</span><span>;</span><span>}</span><span>boolean</span> <span>isPortal</span><span>(</span><span>)</span> <span>{</span><span>return</span> <span>!</span><span>isSuccessful</span><span>(</span><span>)</span> <span>&amp;&amp;</span> mHttpResponseCode <span>&gt;=</span> <span>200</span> <span>&amp;&amp;</span> mHttpResponseCode <span>&lt;=</span> <span>399</span><span>;</span><span>}</span><span>}</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/android-captive-portal.html#Android-7-1-1"></a>Android 7.1.1</h2><p>以下代码摘自 <a href="https://android.googlesource.com/platform/frameworks/base/+/android-7.1.1_r4/services/core/java/com/android/server/connectivity/NetworkMonitor.java" target="_blank">Android 7.1.1_r4 分支 </a> 的 <code>NetworkMonitor</code> 第 611 行至第 631 行。<br /> 可以看到 Android 7.1.1 开始已经不会再自动给验证 url 加上 <code>generate_204</code>。</p><pre><code><span>private</span> <span>static</span> String <span>getCaptivePortalServerHttpsUrl</span><span>(</span>Context context<span>)</span> <span>{</span><span>return</span> <span>getSetting</span><span>(</span>context<span>,</span> Settings<span>.</span>Global<span>.</span>CAPTIVE_PORTAL_HTTPS_URL<span>,</span> DEFAULT_HTTPS_URL<span>)</span><span>;</span>    <span>}</span><span>public</span> <span>static</span> String <span>getCaptivePortalServerHttpUrl</span><span>(</span>Context context<span>)</span> <span>{</span><span>return</span> <span>getSetting</span><span>(</span>context<span>,</span> Settings<span>.</span>Global<span>.</span>CAPTIVE_PORTAL_HTTP_URL<span>,</span> DEFAULT_HTTP_URL<span>)</span><span>;</span>    <span>}</span><span>private</span> <span>static</span> String <span>getCaptivePortalFallbackUrl</span><span>(</span>Context context<span>)</span> <span>{</span>  <span>return</span> <span>getSetting</span><span>(</span>context<span>,</span>  Settings<span>.</span>Global<span>.</span>CAPTIVE_PORTAL_FALLBACK_URL<span>,</span> DEFAULT_FALLBACK_URL<span>)</span><span>;</span>    <span>}</span><span>private</span> <span>static</span> String <span>getCaptivePortalUserAgent</span><span>(</span>Context context<span>)</span> <span>{</span><span>return</span> <span>getSetting</span><span>(</span>context<span>,</span> Settings<span>.</span>Global<span>.</span>CAPTIVE_PORTAL_USER_AGENT<span>,</span> DEFAULT_USER_AGENT<span>)</span><span>;</span>    <span>}</span><span>private</span> <span>static</span> String <span>getSetting</span><span>(</span>Context context<span>,</span> String symbol<span>,</span> String defaultValue<span>)</span> <span>{</span><span>final</span> String value <span>=</span> Settings<span>.</span>Global<span>.</span><span>getString</span><span>(</span>context<span>.</span><span>getContentResolver</span><span>(</span><span>)</span><span>,</span> symbol<span>)</span><span>;</span>  <span>return</span> value <span>!=</span> null <span>?</span> value <span>:</span> defaultValue<span>;</span>    <span>}</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
        
        <summary type="html">
            
            从 Android L 开始，原生和 CM 的 ROM 用户就会发现，状态栏的网络信号莫名多了一个感叹号。而且，有的时候明明连着 WIFI 用得好好的，却突然跳到数据流量。“感叹号”出现的原因和作用Android 5.0 开始引入了一种新的网络评估机制来评估网络状况，当你有网络
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Android"/>
        
        <category term="Root"/>
        
        <category term="Captive"/>
        
    </entry>
    
    <entry>
        <title>从应用“妮乎”不遵守开源协议谈谈我国开源的现状</title>
        <link href="https://blog.nfz.moe/archives/open-source-in-china.html"/>
        <id>https://blog.nfz.moe/archives/open-source-in-china.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-14T04:54:16+00:00</published>
        <updated>2017-08-14T04:54:16+00:00</updated>
        
        <content type="html"><![CDATA[<p>身在这个奇怪的地方，被迫做着奇怪的事情，来获取本该轻易获取的东西。然而就算这样，也不能避开一群被害不浅的人，来帮他们洗地。</p><a></a><p>我本以为我应该对这种事情是睁一只眼闭一只眼的。但发生了一些事情以后，我还是选择了站出来。或许我把自己看得太高，不过，谨慎一点好。</p><hr /><p>在酷安“妮乎”这个应用中因为开发者不负责任的举动、不遵守开源协议的行为的撕逼中，我可能不是最积极的，但的确是很活跃的一个存在。</p><p>“妮乎” 具体都干了什么，我大概列举一下就行：</p><ul><li>其开发的工具箱 “妮哩萌萌” 提供类似交流社区的服务，但是却使用明文传输用户名和密码；</li><li>其开发的工具箱 “妮乎” 功能不华也不实（什么振动 1 次、振动 2 次），部分功能（如抢 TIM 红包，网易云音乐 VIP 破解功能）甚至盗用了开源项目的源码。之所以称为盗用，是因为使用了开源项目的源码却不遵守开源协议。</li></ul><blockquote><p>具体的可以去看知乎 <a href="https://www.zhihu.com/question/55263859" target="_blank">“如何看待“妮哩萌萌”开发出的《妮乎 ARE YOUOK》不遵守开源协议？” </a> 的回答。我的回答是 <a href="https://www.zhihu.com/question/55263859/answer/143661495" target="_blank">https://www.zhihu.com/question/55263859/answer/143661495</a></p></blockquote><hr /><p>当然我这篇文章不能只单纯批判妮乎，不然就没有什么意义了。</p><p>现在国内的开源现状是什么样的呢？用 Shadowsocks 的开发功臣 <a href="https://github.com/clowwindy" target="_blank">clowwindy</a> 的话来讲，叫做“社会人人都围着官转，人人都巴不得当官”。</p><blockquote><p>这个是另外一个事件了，破娃酱的事情，也许经常翻越 <code>The Girl Friend Wall</code> 的人可能会知道。<br />破娃酱（Breakwa11）开发了 ShadowsocksR ，实现了 TCP 协议头混淆，但是拒绝开源，而 SSR 本来是在 SS 的基础上开发的、而后者是根据开源协议 GPL 开源的。后来那些纠葛我无需再提。最后 clowwindy 被 <code>你懂得那啥 </code> 请去喝茶了，所有 Github 的动态被冻结在 2015 年 11 月；破娃酱最后还是把 SSR 开源了；现在 SS 和 SSR 项目依然在蓬勃而富有生机地继续发展着。对于用户方面，现在服务商卖 SS 的也有，SSR 的也有。<br /> 我本人对这件往事不置可否。我的个人看法是：BreakWa11 再怎么圈粉也好，最后他还算有贡献的——他至少开发了个 SSR，<strong>至少最后开源了 </strong>；他还有一个用爬虫构建的项目 gfw_whitelist，PAC 用的。这和<strong> 妮乎直接盗用、不尊重他人成果</strong>、毫无贡献，还是有一些区别的。 </p></blockquote><p>现在国内的各个手机厂商，不尊重 GPL 就算了，“把名字换成自己的”，还加点什么功能，然后加上 “官方、独家” 之类的字样。<br />比如小米的内核。众所周知，Android 内核是基于 Linux 内核的，然而 Linux 的内核是根据 GPL 协议开源的，所以各大厂商使用了 Android，就必须第一时间开源内核源码；但是小米宣称自家内核用了什么黑科技，所以拒绝开源。。。</p><blockquote><p>在国内使用 Linux 内核的手机厂商有数十家，然而遵守 GPLv2 的仅几家而已，某些个人开发者更将自己修改后的内核作为私有财产，不仅不开源，还在代码中加入诸多限制，绞尽脑汁使内核只在自己指定的环境正常工作。用户并不懂什么是开源协议，所以这些人就会去拉拢用户攻击其他试图使他遵守开源协议的开发者。<br />在国内厂商中，开源这一块做的最好的是一加。虽然做得不好——氢 OS 发布 3.0 一个月以后基于 Android N 的内核才开源出来。但是，这 <strong> 总比其它厂商做得好 </strong>——比如吧一加还开源了 device tree。看看传说中的蓝绿大厂 OPPO VIVO，连谷歌发布的 Android 安全补丁都不更新，还宣称安全，结果<strong> 被 wuxianlin 这样的真大神吊着打</strong>。呃，跑偏了。</p></blockquote><p>当然啦，大部分用户才不会管这些（不然为什么线下 OV 做的这么欢快）。<br />享受成果的人是不会去花时间去研究你是不是盗用的、有没有遵守开源协议，也不会去做道德判断，大部分人都是只要觉得好用就行。所以可以看到，这种环境下开源其实并没有什么优势，只不过为一些人抄袭提供了便利。在这种环境下最后留下来的都是这些，比如妮乎。</p><blockquote><p>clowwindy 说过，他一直想象的那种大家一起来维护一个项目的景象始终没有出现，也没有出现的迹象。他在维护 SS 时，遇到的主动分享的贡献者并不多。</p></blockquote><p>与 clowwindy 所想是不同的是，他被喝茶一年以后，SS 项目现在是活跃的，Fork 数我最近去看了一下已经 2.7k 了，全球都有人参与这个项目，为了各种目的（比如翻越限制，比如躲避审查，比如内网穿透）。<br />我认为我自己也是 Github 开源社区的受益者。我参与了我现在使用的博客主题的开发（这个主题的开源地址可以在 Footer 和侧边栏看到）——虽然贡献是微小的，但是项目老大 viosey 依然给了我 <code>collabrator</code> 的权限，我也很幸运能加入到这个项目的开发：我学到的不仅仅是如何用 ejs 开发 hexo 博客的主题，我学到的东西更多，比如如何管理一个多人协同开发的项目，比如 commit 信息怎么写符合规范便于追踪，甚至在和来自法国的小哥共同开发时略微提升了自己英语水平。<br />当然现在年轻的开发者都愿意开源的（比如我认识的 dalao 们，Aviraxp、Omico、iACN、PeterCxy、Trumeet . . . 等等）。但是 Github issue 却并不是那么景气——很多来报 bug 的人是以一种小白求大大解决问题，解决完就走人的方式来的。他们既不愿提供足够的信息（我们也不奢求日志，但是有的 issuer 提供了日志，我们找问题真的会简单很多），也不愿写一些自己尝试的过程供后人参考。他们很多连文档都不仔细阅读，所以弄出不少问题。</p><blockquote><p>事实上，就以 Material 主题为例——老大 vio 喵是建立了挺完善的文档供大家参考的（而且我们参与者都是谁开发的功能就由谁写文档~）——但是依旧有很多小白进来提问题，而其中有的问题真的可以看文档就能解决的。我又不好意思留个 <code>Please read [docs](https://material.viosey.com)</code> 作为回答然后就 close issue（至少我觉得我和其它外国项目维护者不同，他们真的会这么回答然后 close 掉 issue 的）。<br />我以前做 ROM 时，发包帖会带上一句——“请仔细阅读这个帖子的每一个字，避免错过重要信息。如果做不到，就请大声朗读本帖”。我不希望任何文档需要带上这个。</p></blockquote><p>不是我贬低什么，也不是我看不起什么，我真的是觉得最适合这个民族的其实是一群小白围着大大转，大大通过小白的夸奖获得自我满足，小白通过大大的幽默挑逗获得参与感。被迫闭源主代码库的魔趣就是这样，龙猪在贴吧和微博和用户们打情骂俏，在自己的 <a href="https://bbs.mfunz.com" target="_blank"> 魔趣社区 </a> 搞社区经营。当然龙猪自己也和他带领的团队也是为魔趣写了不少东西的。现在魔趣 <strong> 暂时</strong>（希望以后永远是）是世界第一大安卓开源项目，希望国人能够争气一点。</p><blockquote><p>像月光这种打包他人 device tree 和开源的内核源码，还恶意诋毁他人、污言秽语人身攻击的，的确又是中国扭曲的开源现状上的又一大块污点。<br />像月光这种打包别人东西搞什么 MOS，这和 RR、AICP、DU、SultanCM 之类的 ROM 性质不同。后者的上游代码也的确都是 CM，他们的项目会严格地附上 credits，甚至是 reference ，它们是互相促进的。大家都知道，少了谁都不行。这就是为什么 CM 解散以后 Android 会有这么大动荡的原因，不过这是另一个故事了。<br />跑偏了，回来继续说。大部分开发者是很低调的，他们愿意去自己潜心做一个项目，就算被侵权被抄袭也不会说什么。他们会觉得很难受，但是不会停止开发。。也有开发者受到用户攻击和诋毁的——Nubia Z11 社区的那几个喷子那次搞起来的就是——但是说实话，几个卷入的 romer 当时其实是在那里把这个当笑话看的。</p></blockquote><p>在这种用户的群体存在，中国的开源现状就是玩笑。</p><p>我已经有一些明白到这个民族的前面为什么会有一堵墙了。国内的论坛和社区到处都是什么附件回帖可见，等级多少用户组可见，一个论坛一个大大供小白跪舔。不需要造墙，网民也已经地自发造墙——这些回帖可见、等级不足啥的不就是墙么？</p><blockquote><p>当然，国内清流的论坛也有，比如 <a href="https://mat.letitfly.me" target="_blank">MAT BBS</a>，近乎于无偿地让大家一起平等地分享 MyAndroidTools 的使用经验。这样的参见蠢喵大佬的<a href="https://blackyau.cc/guozixi.html" target="_blank">《良心不易》</a>）。</p></blockquote><p>当然，正如我所说的，“大部分用户才不会管这些”，小白跪舔时也不会选人的，他们不会判断。不然就没法理解月光打包党的微博下面为什么会有这么多评论在那里跪舔了。</p><p>这和国外社区是不一样的，国外社区哪有这样的环境？重新提我之前写的那一段，在国外，遇到 bug 和 issue，会有人发帖挖坑，然后很多人参与研究和造轮子，造出来以后会有自己的经历分享。我觉得这才是一个技术向的社区应该有的气氛，比如 xda-developer fourm 就是这样的一个社区。在这个全球最大的智能设备交流社区，不论技术多高，任何不遵守开源协议的开发者都会被删帖封号。国内哪个论坛会这么干？也就一加论坛和 MIUI 论坛封过臭名昭著的月光的号罢了。</p><hr /><p>我自己也是华夏民族的后人，但我也知道，我的民族是一个造了几千年墙的保守的农耕民族。我不得不承认我自己的劣根性（鲁迅说过，也是整个民族都有的劣根性），也不得不承认我们有时候的确缺乏对别人的基本尊重，我们不愿意分享、喜欢遮遮掩掩，喜欢小圈子抱团，需要通过闭关锁国来获得自己需要的优越感。</p><blockquote><p>也许我颇有些数典忘祖的感觉，但是不得不承认的确是这样。</p></blockquote><p>国内的开源环境到底是什么样呢？大量开发者使用现成的开源的成果，却很少有人遵守开源协议。他们从上游 merge，却并不将自己的成果反馈回去，然后大言不惭地宣称自己的项目有多么多么强大，比事实上的上游（他们往往并不承认）牛掰多少，这与开源社区的精神背道而驰。更有甚者，如我文首提到的，毫无贡献、拿来就用，然后宣称是自己的成果（即使不是公开说出来，也是暗示性的影响。为数不多的人遵守 GPL ，更别提哪怕在 Credit 注明一下来源的了）。</p><hr /><p>尾声：在我写到国外社区那一段时，妮哩萌萌找到我，告诉我侵权的网易云和谐功能已经去除。所以我把我在酷安的那条动态删掉了。更新日志说是功能“已经失效”，Aviraxp 说是“因为你抄错了”。是不是这样，我也已经不想深究，人的确是会累的，但是在做自己喜欢做的事情和自己有义务要去做的事情，我希望我会继续坚持乐此不疲。写完一篇博客，梳理自己大脑里混乱的思路，其实真的能看开很多东西。<br />最后，推荐大家读一读 <a href="https://github.com/beijinglug/fsfs-zh" target="_blank">《自由软件，自由社会》</a>（<em>Free Software,Free Society</em>）。这本书的中文翻译在 Github 开源。</p><p>=========================</p><p>2017.08.14 更新：</p><p>昨天下午我在知乎看到妮哩萌萌开发者对 <a href="https://www.zhihu.com/question/55263859/answer/143661495" target="_blank"> 我的回答 </a> 下评论做出「表态」如下：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000141.png" /></p><p>既然作为妮乎的开发者「表态」，我在看到以后很快对「表态」做出「回应」：</p><blockquote><p>针对「表态」的第二条：妮乎使用的 Unblock163Netease 模块的源代码根据 GPLv3 开源，妮乎最早开源出来的源码使用 Apache 开源，不符合 GPL License。<br />针对「表态」的第三条：开发者不允许将 GPL 代码用于商业，QQ 进群收费是一种商业行为。<br />针对「表态」的第四条：妮乎之前开源的代码为混淆过的代码，并非软件源代码，违反了 GPL。而且，现在 stytool 开源的 Repo <a href="https://github.com/stytooldex/stytool" target="_blank">stytooldex/stytool</a> 里面都是些啥？</p></blockquote><p>实际上，我很早就没有关注这个事件了，甚至不知道这个声明最早诞生于今年四月。<br />不管怎么说，我的回应是针对「表态」本身，而不是针对开发者本人。所以，虽然今天下午我在知乎上的回答收到了评论，不过还是让这件事算了吧。<br />开发者既然已经发了声明，应该是已经端正了态度、正视这个问题。如果这样的话，对开源协议本身不完全了解和不懂得如何用 Git 在 GitHub 上提交代码是可以原谅的。。。</p><p>就这样吧，希望国内开源环境能好。以上。</p>]]></content>
        
        <summary type="html">
            
            身在这个奇怪的地方，被迫做着奇怪的事情，来获取本该轻易获取的东西。然而就算这样，也不能避开一群被害不浅的人，来帮他们洗地。我本以为我应该对这种事情是睁一只眼闭一只眼的。但发生了一些事情以后，我还是选择了站出来。或许我把自己看得太高，不过，谨慎一点好。在酷安“妮乎”这个应用中因为
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="开源"/>
        
        <category term="生态"/>
        
        <category term="环境"/>
        
    </entry>
    
    <entry>
        <title>PJAX，真的好吗？</title>
        <link href="https://flyhigher.top/develop/684.html"/>
        <id>https://flyhigher.top/develop/684.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-08-13T01:53:29+00:00</published>
        <updated>2017-08-13T01:53:29+00:00</updated>
        
        <content type="html"><![CDATA[<p>本文从实用性的角度看待PJAX技术，而非技术角度。</p>
<p>最近发现越来越多的网站开始使用了PJAX无刷新加载。看起来这是一种趋势：PJAX是一种优秀的技术，大家都在用。但真的是这样吗？我看未必。</p>
<p>别把AJAX和PJAX放在一起</p>
<p>AJAX和PJAX，看起来非常相似，事实上PJAX也是基于AJAX发展而来。</p>
<blockquote><p>AJAX 是一种用于创建快速动态网页的技术。</p>
<p>通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<p>传统的网页（不使用 AJAX）如果需要更新内容，必需重载整个网页面。</p></blockquote>
<p>AJAX的确是一种优秀的技术，它赋予了网页全新的能力，大大拓展了网页的能力范围。</p>
<ul>
<li>Google地图使用AJAX实现顺畅的拖动体验，而不用在每次选定地点后都需要等待整个页面刷新</li>
<li>评论系统使用AJAX可以让用户在提交评论的同时继续浏览页面</li>
<li>AJAX让Facebook们的点赞得以流畅实现</li>
</ul>
<p>这样例子有很多，也很好发现，就不多举了。AJAX通过简单的异步请求，可以实现的功能非常多，能带来丰富的体验。</p>
<p>但是，AJAX的优秀真的代表着PJAX的优秀吗？</p>
<p>人们为什么使用PJAX？我们需要从使用PJAX的原始目的来看。很多网站使用PJAX的目的无非两个：</p>
<ol>
<li>减少页面加载所需的流量</li>
<li>避免页面白屏，提高用户体验</li>
</ol>
<p>看起来好像没什么问题，而且它的作用也值得让人使用它。然而，在现实中，我发现很多人其实根本没有实现这两条就匆匆实现PJAX。这样做，恐怕会适得其反。</p>
<p>对于第一条，有相当一部分人并没有实现，他们只是简单引用了pjax.js或者turbolinks.js等项目，看起来实现了PJAX，但实际上加载的内容仍是完整的页面，有些情况下甚至会导致更多流量。使用PJAX，正确的做法应该是只加载页面显示所需要的内容，而不是一股脑儿全加载进来。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170813-1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170813-1.jpg" /></a></p>
<p>偶然见到的网站，却是一样地滥用PJAX。这样加载PJAX与完整加载网页有什么区别？</p>
<p>所以事实上实现PJAX需要一个专门的API来最小化数据传输，最好可以结构化数据方便前端解析，再不济也需要对PAJX发起的请求做优化。</p>
<p>对于第二条，有人说流量没减少没关系，至少我们提高了用户体验。但事实是添加PJAX后很多网站用户体验不升反降。以往常规加载的方式，浏览器会帮你做很多事情比如记忆浏览到哪里啦等等，但如今PJAX要求你需要自己实现很多特性。</p>
<p>举个栗子，LWL12的博客<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fblog.lwl12.com" target="_blank">blog.lwl12.com</a>使用了PJAX，但他的加载逻辑有些小问题导致在他的网站中浏览时，每次前进和后退都会重新定位到页面顶端而不是之前浏览到的位置。而首页AJAX加载文章列表的方式会导致在不知不觉中困在某一页而无法回到上一页。这就会让人很不爽。而使用常规加载方式，浏览器会在短时间内记忆用户的滚动位置，至少前进后退时是没有问题的，而AJAX状态也不会改变。</p>
<p>（当然这不是在说LWL12的网站不好，LWL12网站中的内容质量还是比较高的）</p>
<p>所以第二条也很难成立。要做到好的用户体验不是一件容易的事，你要额外做很多以前浏览器帮你做的事，所以很多网站根本做不到。PJAX带来了各种各样的问题，反而是大大降低了体验，更不用提提升体验了。</p>
<p>所以，我个人认为，<strong>要么不用PJAX，要么就在保证做好上面两点后再使用。</strong></p>
<p>但做到完美太难了，甚至做到接近完美也很难，所以我倾向于不要使用PJAX。</p>
<p>PJAX的用武之地</p>
<p>然而，很容易可以发现，很多大型网站已经在使用PJAX。譬如百度，它在用户输入关键词时实时猜测用户的目的并改变搜索结果。</p>
<p>Google地图也可以看作使用PJAX，在用户浏览地图时，地址栏中的内容会实时改变以方便用户分享位置信息。</p>
<p>这么看起来，好像PJAX也不说像上面说的那么不实用嘛。</p>
<p>PJAX的确有用武之地，但有前提，就是“在连续性服务下”提供。</p>
<p>百度搜索，输入关键词是一个连续性的动作，Google地图，浏览地图是一个连续性的过程。而PJAX的最佳用地，就是在连续性服务上。</p>
<p>连续性是一个非常主观的概念，我认为只要是需要提供流畅服务的、任何等待都会造成严重体验下降的都算是连续性服务。而PJAX可以很好地满足不停顿的要求。</p>
<p>比如很多小说网站，现行页面会包含大量广告而导致页面加载速度严重下降，在看小说时每翻过一章就需要等待几秒让页面加载出来。而使用PJAX，翻页时可以只加载小说内容而不用加载广告框架（小说内容加载完成后再异步刷新广告即可），可以大大提高浏览的流畅度，会舒服很多。当然前提是做好上面两点。</p>
<p>而普通网站呢？恐怕是不需要。尤其是大量的个人博客，做不好最基础的要求就急吼吼地部署PJAX，但这根本不是硬需。网站内容不连续，用户也不一定感兴趣，不会发生小说网站的情况，这样提供PJAX功能，只会大大削弱用户体验。</p>
<p>毕竟，用户来网站是为了获取服务/信息而不是来看加载动画的，组织良好的服务/内容远比简单地开启低质量的PJAX来得重要。</p>
<p>举个正面的例子，大牛Jerry Qu的网站<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fimququ.com" target="_blank">imququ.com</a>就没有使用PJAX，但他使用了大量的前端后端优化，虽然是常规的加载方式，体验却完全不输PJAX，完全没有白屏时间。这样的加载速度，内容质量又很高，远不是面向动画的网站们能比的，还需要什么PJAX呢？</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170813_173609.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170813_173609.jpg" /></a></p>
<p>Jerry Qu的网站首页在禁用缓存后全部加载只花了232ms，一共3个请求，比绝大多数使用了PJAX的网站还快得多（当然第一次访问会慢些）。</p>
<p>所以，再重新审视PJAX，<strong>请把它当做一个Patch，只在需要的时候使用，没有理由就不要使用了。</strong></p>
<p>PJAX不是万能的，不应该被滥用。</p>
<blockquote><p>本文原创，首发于flyhigher.top/develop/684.html，转发请注明来源。</p></blockquote>]]></content>
        
        <summary type="html">
            
            本文从实用性的角度看待PJAX技术，而非技术角度。 最近发现越来越多的网站开始使用了PJAX无刷新加载。看起来这是一种趋势：PJAX是一种优秀的技术，大家都在用。但真的是这样吗？我看未必。 别把AJAX和PJAX放在一起 AJAX和PJAX，看起来非常相似，事实上PJAX也是基
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="PJAX"/>
        
        <category term="前端"/>
        
    </entry>
    
    <entry>
        <title>用笔记本屏幕造个显示器</title>
        <link href="https://blog.asec01.net/how-to-modified-laptop-screen-to-monitor/"/>
        <id>https://blog.asec01.net/how-to-modified-laptop-screen-to-monitor/</id>
        
        <published>2017-08-12T15:18:12+00:00</published>
        <updated>2017-08-12T15:18:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>嗯，高三了，老妈没收了我的显示器[捂脸] （虽然以前也不给我吧）</p>
<p>暑假还有点时间，搞事！</p>
<h2><a></a></h2>
<h2>前期准备</h2>
<h5>2017.8.10-11</h5>
<p>手头有个巨老的笔记本 NEC Versa S3000<br />
拆了拆了<br />
嗯第一次拆笔记本，喵的键盘还可以卸下来[再次捂脸]<br />
拆机过程并不重要，重要的是我忘记拍照了[第三次捂脸]</p>
<p>液晶屏GET√</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170812_225438.jpg" /></p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170811_224208.jpg" /></p>
<p>然后是 华强宝</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170812_225912.png" /></p>
<hr />
<h2>货到啦</h2>
<h5>2017.08.14</h5>
<p>忘记拍拆包了[捂脸]</p>
<p>组装起来试一试<br />
<img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_155301.jpg" /><br />
<img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_155347.jpg" /><br />
嗯，很好，能用</p>
<p>然后开始搞外壳<br />
<img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_160510.jpg" /></p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_160914.jpg" /><br />
放到原来的外壳上</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_160942.jpg" /><br />
某根电源线太短我只能在外壳上打洞了[捂脸]</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_161309.jpg" /><br />
装上外壳依旧能用</p>
<h3>这就完了？</h3>
<h2>才怪嘞！</h2>
<p>裸着用怎么行<br />
给线路板加个壳保护一下嘛</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_162432.jpg" /><br />
快递盒的正确用法</p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_162550.jpg" /><br />
万能的泡棉胶</p>
<h2>完工！</h2>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_230405.jpg" /></p>
<p><img src="https://blog.zhangzhe-tech.cn/how-to-modified-laptop-screen-to-monitor/IMG_20170814_164029.jpg" /></p>
<p>希望不会被我和蔼的老妈发现[捂脸]</p>]]></content>
        
        <summary type="html">
            
            嗯，高三了，老妈没收了我的显示器[捂脸] （虽然以前也不给我吧） 暑假还有点时间，搞事！  前期准备 2017.8.10-11 手头有个巨老的笔记本 NEC Versa S3000 拆了拆了 嗯第一次拆笔记本，喵的键盘还可以卸下来[再次捂脸] 拆机过程并不重要，重要的是我忘记拍
            
        </summary>
        
    </entry>
    
    <entry>
        <title>本博客的优化汇总</title>
        <link href="https://blog.nfz.moe/archives/optimization-of-my-blog.html"/>
        <id>https://blog.nfz.moe/archives/optimization-of-my-blog.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-11T17:07:00+00:00</published>
        <updated>2017-08-11T17:07:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://st.nfz.yecdn.com/img/blog/0000087.png" /></p><p>我一直在关注我的博客的浏览体验，其中，网站的加载速度对于浏览体验来说是非常重要的。<a></a>我见过很多菊苣的博客，他们的博客加载速度却很一般（偷笑）我现在也在写一些 WPO 方面的文章，我并不想在写如何做好优化性能的同时，自己的博客却十分缓慢。<br />除了 Pageseed、YSlow 常见提到的颇有些老生常谈的一些优化手段以外，我的博客也用了其它一些零散的优化点。我把它们列举在这里。</p><h2><a href="https://blog.nfz.moe/archives/optimization-of-my-blog.html# 静态资源优化"></a>静态资源优化 </h2><p> 如果你打开 Dev Tools，你会发现我的博客加载时 <del> 除了一个用于网站统计的 <code>piwik.js</code> 以外，</del> 没有 <del> 再</del>引用任何大段的 css、js。</p><blockquote><p>博客已经弃用 Piwik 统计服务，不再加载 <code>piwik.js</code>。</p></blockquote><p>这是 <code>hexo-theme-material</code> 的一个实验性特性，首次加载利用 XMLHttpRequest 从外部加载资源并异步执行，同时将其存入 localstorage，以后加载都通过 localstorage 加载，不再发起请求。<br />这样做的好处有：</p><ol><li>后续访问减少连接数</li><li>不怕刷新和强刷</li></ol><p>同时，我把这些文件部署在了又拍云的 CDN，这样在页面首次加载时也不会阻塞页面的加载。</p><blockquote><p>localstorage 这项特性在 <code>hexo-theme-material</code> 1.4.0 版本中发布。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/optimization-of-my-blog.html# 图片优化"></a>图片优化 </h2><p><code>hexo-theme-material</code> 是很漂亮的、图文并茂的主题，这就意味着主题需要加载大量图片资源。不加载用户看不见的图片是一项最基本的优化（图片采用 lazyload）。这是老生常谈的话题，<code>hexo-theme-material</code> 也已经实现，在这里略过不谈。<br /> 除了 lazyload 博客首页的缩略图以外，博客很多小而碎的图片都使用了 <code>date URI</code> 的方式来减少小资源的引用，避免增加 Request。<del>比如博客侧边栏抽屉的又拍云的 svg 格式的 logo、</del> 比如页脚的 SNS 的几个图标（页脚的图标则是将 svg 格式 <del>转码成 base64</del> 直接 inline 在 css 予以输出）</p><h2><a href="https://blog.nfz.moe/archives/optimization-of-my-blog.html#Piwik- 统计优化"></a>Piwik 统计优化</h2><p>Piwik 的统计和一般的统计不同在于，他们的 JS 是剥离出来的，统计时 <code>piwik.js</code> 可以不和架设 Piwik 的 WebServer 同源加载。所以我将 JS 托管在了又拍云的 CDN 上，同时改造了我的站点统计代码部分，将 JS 改到了又拍云上的 URI。以下是我修改过的示例代码。</p><pre><code><span>var</span> _paq <span>=</span> _paq <span>||</span> <span>[</span><span>]</span><span>;</span>_paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;setDomains&quot;</span><span>,</span> <span>[</span> <span>&quot;*.example.com&quot;</span><span>]</span><span>]</span><span>)</span><span>,</span> _paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;enableCrossDomainLinking&quot;</span><span>]</span><span>)</span><span>,</span> _paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;trackPageView&quot;</span><span>]</span><span>)</span><span>,</span> _paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;enableLinkTracking&quot;</span><span>]</span><span>)</span><span>,</span> <span>function</span><span>(</span><span>)</span> <span>{</span>_paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;setTrackerUrl&quot;</span><span>,</span> <span>&quot;https://piwik.nfz.moe/piwik.php&quot;</span><span>]</span><span>)</span><span>,</span> _paq<span>.</span><span>push</span><span>(</span><span>[</span><span>&quot;setSiteId&quot;</span><span>,</span> <span>&quot;2&quot;</span><span>]</span><span>)</span><span>;</span>    <span>var</span> e <span>=</span> document<span>,</span>        a <span>=</span> e<span>.</span><span>createElement</span><span>(</span><span>&quot;script&quot;</span><span>)</span><span>,</span>        p <span>=</span> e<span>.</span><span>getElementsByTagName</span><span>(</span><span>&quot;script&quot;</span><span>)</span><span>[</span><span>0</span><span>]</span><span>;</span>    a<span>.</span>type <span>=</span> <span>&quot;text/javascript&quot;</span><span>,</span> a<span>.</span><span>async</span> <span>=</span> <span>!</span><span>0</span><span>,</span> a<span>.</span>defer <span>=</span> <span>!</span><span>0</span><span>,</span> a<span>.</span>src <span>=</span> <span>&quot;//cdn.example.com/piwik/piwik.js&quot;</span><span>,</span> p<span>.</span>parentNode<span>.</span><span>insertBefore</span><span>(</span>a<span>,</span> p<span>)</span><span>}</span><span>(</span><span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>除此以外，和其它统计代码不同，我直接将其放在了页面底部。相比放在 <code>&lt;head&gt;</code> 标签之内，将 Piwik 统计代码放在页脚直接使 DOMContentLoaded 提前了 70ms 触发（大雾）</p><p><strong>注：博客已经撤掉了 Piwik 统计服务，转而使用 Google Analytics。优化方案参见《<a href="https://blog.nfz.moe/archives/google-analytics-optimize.html">Google Analytics 异步优化方案</a>》</strong></p></blockquote><h2><a href="https://blog.nfz.moe/archives/optimization-of-my-blog.html#Service-Worker"></a>Service Worker</h2><p>静态内容非常适合做缓存，来加速页面的访问。我的博客使用了 Service Worker 技术，利用 sw-toolbox 获取和 “劫持” 请求，可以大大改善博客的二次加载的时长，还可以实现离线访问已经被缓存的页面，改善了用户的体验。</p><blockquote><p>我的博客已经在使用 sw-toolbox 代替原生 Service Worker。我在《<a href="https://blog.nfz.moe/archives/sw-toolbox-practice.html">本博客对 sw-toolbox 的实践</a>》一文中介绍了 sw-toolbox。我推荐无论是静态站还是动态站，都使用 sw-toolbox。</p></blockquote><hr /><p>实际上，我的博客加载不逊于 BAT 主流网站，使用了 Hexo 静态博客框架也是一个很重要的原因。Hexo 是一款基于 NodeJS 的快速、简洁且高效的博客框架，能在几秒内渲染出上百个静态页面。静态博客相对于使用动态的博客，不需要查询数据库、动态生成页面等后端延迟，可以大大提升网站加载所需的时间。</p>]]></content>
        
        <summary type="html">
            
            我一直在关注我的博客的浏览体验，其中，网站的加载速度对于浏览体验来说是非常重要的。我见过很多菊苣的博客，他们的博客加载速度却很一般（偷笑）我现在也在写一些 WPO 方面的文章，我并不想在写如何做好优化性能的同时，自己的博客却十分缓慢。除了 Pageseed、YSlow 常见提到
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="博客"/>
        
        <category term="Hexo"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
    </entry>
    
    <entry>
        <title>1000天成就达成！</title>
        <link href="https://flyhigher.top/diary/701.html"/>
        <id>https://flyhigher.top/diary/701.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-08-06T16:01:20+00:00</published>
        <updated>2017-08-06T16:01:20+00:00</updated>
        
        <content type="html"><![CDATA[<p>1000天成就达成！<br />
<a href="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170807.png"><img src="https://img.flyhigher.top/wp-content/uploads/2017/08/snipaste_20170807.png" /></a></p>]]></content>
        
        <summary type="html">
            
            1000天成就达成！ 
            
        </summary>
        
        <category term="其他"/>
        
    </entry>
    
    <entry>
        <title>本博客开始支持 TLS 1.3</title>
        <link href="https://imququ.com/post/enable-tls-1-3.html"/>
        <id>https://imququ.com/post/enable-tls-1-3.html</id>
        
        <published>2017-08-06T06:37:02+00:00</published>
        <updated>2017-08-06T06:37:02+00:00</updated>
        
        <content type="html"><![CDATA[<p>几个月前，我在升级本博客所用 Nginx 时，顺手加上了对 TLS 1.3 的支持，本文贴出详细的步骤和注意事项。有关 TLS 1.3 的介绍可以看 CloudFlare 的这篇文章：<a href="https://blog.cloudflare.com/tls-1-3-overview-and-q-and-a/">An overview of TLS 1.3 and Q&amp;A</a>。需要注意目前 Chrome 和 Firefox 支持的是 TLS 1.3 draft 18，暂时不要用在生产环境。</p>

<h3>安装依赖</h3>
<p>我的 VPS 系统是 Ubuntu 16.04.3 LTS，如果你使用其它发行版，与包管理有关的命令请自行调整。</p>
<p>首先安装依赖库和编译要用到的工具：</p>
<pre><code>sudo apt-get install build-essential libpcre3 libpcre3-dev zlib1g-dev unzip git
</code></pre>
<h3>获取必要组件</h3>
<p><code>nginx-ct</code> 和 <code>ngx-brotli</code> 与本文主题无关，不过都是常用的 Nginx 组件，一并记录在这里。</p>
<h4>nginx-ct</h4>
<p><code>nginx-ct</code> 模块用于启用 <a href="https://imququ.com/post/certificate-transparency.html">Certificate Transparency</a> 功能。直接从 github 上获取源码：</p>
<pre><code>wget -O nginx-ct.zip -c https://github.com/grahamedgecombe/nginx-ct/archive/v1.3.2.zip
unzip nginx-ct.zip
</code></pre>
<h4>ngx_brotli</h4>
<p>本站支持 Google 开发的 <a href="https://github.com/google/brotli">Brotli</a> 压缩格式，它通过内置分析大量网页得出的字典，实现了更高的压缩比率，同时几乎不影响压缩 / 解压速度。</p>
<p>以前要想支持 <code>ngx_brotli</code> 模块，需要先手动编译 <code>libbrotli</code>。经评论里的朋友提醒，现在已经不用了。直接获取源码即可：</p>
<pre><code>git <span>clone</span> https://github.com/google/ngx_brotli.git
<span>cd</span> ngx_brotli

git submodule update --init

<span>cd</span> ../
</code></pre>
<h4>OpenSSL</h4>
<p>为了支持 TLS 1.3，需要使用 OpenSSL 1.1.1 的 draft-18 分支：</p>
<pre><code>git <span>clone</span> -b tls1.3-draft-18 --single-branch https://github.com/openssl/openssl.git openssl
</code></pre>
<h3>编译并安装 Nginx</h3>
<p>接着就可以获取 Nginx 源码，编译并安装：</p>
<pre><code>wget -c https://nginx.org/download/nginx-1.13.4.tar.gz
tar zxf nginx-1.13.4.tar.gz

<span>cd</span> nginx-1.13.4/

./configure --add-module=../ngx_brotli --add-module=../nginx-ct-1.3.2 --with-openssl=../openssl --with-openssl-opt=<span>'enable-tls1_3 enable-weak-ssl-ciphers'</span> --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module

make
sudo make install
</code></pre>
<p><code>enable-tls1_3</code> 是让 OpenSSL 支持 TLS 1.3 的关键选项；而 <code>enable-weak-ssl-ciphers</code> 的作用是让 OpenSSL 继续支持 3DES 等不安全的 Cipher Suite，如果你打算继续支持 IE8，才需要加上这个选项。</p>
<p>除了 <code>http_v2</code> 和 <code>http_ssl</code> 这两个 HTTP/2 必备模块之外，我还额外启用了 <code>http_gzip_static</code>，需要启用哪些模块需要根据自己实际情况来决定。</p>
<p>以上步骤会把 Nginx 装到 <code>/usr/local/nginx/</code> 目录，如需更改路径可以在 configure 时指定。</p>
<h3>WEB 站点配置</h3>
<p>在 Nginx 的站点配置中，以下两个参数需要修改：</p>
<pre><code>ssl_protocols              TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # 增加 TLSv1.3
ssl_ciphers                TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5;
</code></pre><p>包含 <code>TLS13</code> 是 TLS 1.3 新增的 Cipher Suite，加在最前面即可；如果你不打算继续支持 IE8，可以去掉包含 <code>3DES</code> 的 Cipher Suite。</p>
<p>本博客完整的 Nginx 配置，请<a href="https://imququ.com/post/my-nginx-conf.html">点击这里</a>查看。</p>
<h3>验证是否支持 TLS 1.3</h3>
<p>目前最新版 Chrome 和 Firefox 都支持 TLS 1.3，但需要手动开启：</p>
<ul>
<li>Chrome，将 <code>chrome://flags/</code> 中的 <code>Maximum TLS version enabled</code> 改为 <code>TLS 1.3</code>（Chrome 62 中需要将 <code>TLS 1.3</code> 改为 <code>Enabled (Draft)</code>，感谢 @TsuranSonoda 指出）；</li>
<li>Firefox，将 <code>about:config</code> 中的 <code>security.tls.version.max</code> 改为 <code>4</code>；</li>
</ul>
<p>本博客多次推荐的 <a href="https://www.ssllabs.com/ssltest/index.html">Qualys SSL Labs's SSL Server Test</a> 也支持验证服务端是否支持 TLS 1.3，非常方便，继续推荐。</p>
<p>本文链接：<a href="https://imququ.com/post/enable-tls-1-3.html">https://imququ.com/post/enable-tls-1-3.html</a>，<a href="https://imququ.com/post/enable-tls-1-3.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            几个月前，我在升级本博客所用 Nginx 时，顺手加上了对 TLS 1.3 的支持，本文贴出详细的步骤和注意事项。有关 TLS 1.3 的介绍可以看 CloudFlare 的这篇文章：An overview of TLS 1.3 and Q&amp;amp;A。需要注意目前 Chrom
            
        </summary>
        
    </entry>
    
    <entry>
        <title>妄想 Paranoia 歌词 API 文档</title>
        <link href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html"/>
        <id>https://blog.nfz.moe/archives/delasaka-paranoia-api.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-08-03T08:24:00+00:00</published>
        <updated>2017-08-03T08:24:00+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>封面：β<br />取自 <a href="http://www.bilibili.com/video/av8264026/" target="_blank">妄想症系列专辑预热宣传</a> 视频封面</p></blockquote><a></a><h1><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 妄想症 -Paranoia-API"></a>妄想症 Paranoia API</h1><p>妄想症 Paranoia API 是一个类似于 Hitokoto 随机返回一句话的 API。</p><blockquote><p>API 内收录所有歌词，版权归 妄想症系列 策划 / 作词 <a href="http://weibo.com/sakacastle" target="_blank">雨狸</a> 所有！</p></blockquote><ul><li>问题反馈：neofelhz@gmail.com</li><li>调用实例：数据获取</li><li>数据条数：242</li></ul><h1><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 数据获取方式"></a>数据获取方式</h1><ul><li>请求地址：<a href="https://api.nfz.moe/paranoia/" target="_blank">https://api.nfz.moe/paranoia/</a> （仅支持 HTTPS，HTTP 请求将会 301/307 强制跳转 HTTPS，域名已启用 HSTS 响应头）</li><li>请求方式：GET</li><li>请求参数：<ul><li><del>charset：字符集，支持 GBK/UTF-8</del> 现仅支持 UTF-8，该参数已被取消</li><li>encode：数据可返回函数名为 <code>paranoia</code> 的 JavaScript 脚本用于同步调用</li></ul></li></ul><h1><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 实例"></a>实例 </h1><h2><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 直接请求"></a> 直接请求</h2><ul><li>请求：<a href="https://api.nfz.moe/paranoia/" target="_blank">https://api.nfz.moe/paranoia/</a></li><li>返回：<code>被抛弃的女孩 深渊中乞愿被爱 无法失去陪伴 被自己的愿望加害——《妄想·Reality》</code></li></ul><h2><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html#Javascript-HTML"></a>Javascript + HTML</h2><p>脚本地址：<code>https://api.nfz.moe/paranoia/?encode=js</code></p><p>在 HTML 内引用 JavaScript，建议放在 <code>&lt;/head&gt;</code> 之前：</p><pre><code><span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>&quot;</span>text/javascript<span>&quot;</span></span> <span>src</span><span><span>=</span><span>&quot;</span>https://api.nfz.moe/paranoia/?encode<span>=</span>js<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>API 响应时间平均为 200ms，可对域名 <code>api.nfz.moe</code> 做 <code>preconnect</code> 提前完成 TCP 连接。</p></blockquote><p>在你需要展示一句话的地方加上：</p><h4><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 显示来源"></a>显示来源</h4><pre><code><span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>paranoiaapi<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>script</span><span>&gt;</span></span>paranoia(true)<span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span><span></span></span></code></pre><h4><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 不显示来源"></a>不显示来源</h4><pre><code><span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>paranoiaapi<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;</span>script</span><span>&gt;</span></span>paranoia(false)<span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span><span></span></span></code></pre><p>支持其它 CSS 样式。</p><blockquote><p><a href="https://api.nfz.moe/paranoia/example.html" target="_blank">HTML 调用实例</a></p><p>返回的 JavaScript 会返回一个 <code>paranoia</code> 的函数，同步调用。该脚本实质为使用 document.write 的脚本。<br />是否显示来源取决于 <code>paranoia()</code> 传递的参数：<code>true</code> 为显示，<code>false</code> 为不显示。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/delasaka-paranoia-api.html# 更新日志"></a>更新日志</h1><ul><li>2017 年 4 月 4 日：正式上线</li><li>2017 年 6 月 2 日：第一次重构</li><li>2017 年 8 月 3 日：第二次重构、更新数据</li></ul>]]></content>
        
        <summary type="html">
            
            封面：β取自 妄想症系列专辑预热宣传 视频封面妄想症 Paranoia API妄想症 Paranoia API 是一个类似于 Hitokoto 随机返回一句话的 API。API 内收录所有歌词，版权归 妄想症系列 策划 / 作词 雨狸 所有！问题反馈：neofelhz@gmai
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="API"/>
        
        <category term="VOCALOID"/>
        
        <category term="妄想者系列"/>
        
        <category term="Hitokoto"/>
        
    </entry>
    
    <entry>
        <title>osu! 日文字体显示不正常の修复方案</title>
        <link href="https://milkice.me/2017/08/02/osu-optimize-japanese-font-rendering/"/>
        <id>https://milkice.me/2017/08/02/osu-optimize-japanese-font-rendering/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-08-02T12:02:53+00:00</published>
        <updated>2017-08-02T12:02:53+00:00</updated>
        
        <content type="html"><![CDATA[最近太忙没什么好写的就随便水一篇吧格式什么的就不要care了 因为日常嫌弃Windows 10太不干净，Windows Update也提示我该把1607升级到1703了，于是就重装了一下到了1703，后来打开osu之后发现有个问题 请无视糟糕透顶的成绩 嗯这个日文字体不是太养眼啊（ 那么，找找原因吧 一开始以为是1703阉割掉了一部分日文……]]></content>
        
        <summary type="html">
            
            最近太忙没什么好写的就随便水一篇吧格式什么的就不要care了 因为日常嫌弃Windows 10太不干净，Windows Update也提示我该把1607升级到1703了，于是就重装了一下到了1703，后来打开osu之后发现有个问题 请无视糟糕透顶的成绩 嗯这个日文字体不是太养眼
            
        </summary>
        
        <category term="Games"/>
        
        <category term="Tech"/>
        
        <category term="Font"/>
        
        <category term="Japanese"/>
        
        <category term="OSU!"/>
        
        <category term="Windows"/>
        
    </entry>
    
    <entry>
        <title>稻城亚丁游记</title>
        <link href="https://www.isthnew.com/archives/yading.html"/>
        <id>https://www.isthnew.com/archives/yading.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-08-01T08:48:22+00:00</published>
        <updated>2017-08-01T08:48:22+00:00</updated>
        
        <content type="html"><![CDATA[<p>前几天，我们一家人从芦山出发走过 G318~S217~S216 到达稻城县香格里拉镇。一路上 G318</p>]]></content>
        
        <summary type="html">
            
            前几天，我们一家人从芦山出发走过 G318~S217~S216 到达稻城县香格里拉镇。一路上 G318
            
        </summary>
        
        <category term="世界在这里"/>
        
        <category term="稻城"/>
        
        <category term="亚丁"/>
        
        <category term="S318"/>
        
    </entry>
    
    <entry>
        <title>一些有利于保障个人信息安全的上网习惯</title>
        <link href="https://www.iwch.me/archives/655.html"/>
        <id>https://www.iwch.me/archives/655.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-07-28T18:36:00+00:00</published>
        <updated>2017-07-28T18:36:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><p>在我删库跑路之前其实已经发过一篇类似的文章了，但是最终我还是觉得应该再发一次。</p><p>这篇文章相比较于删库之前的那篇，可能会更加侧重于介绍一些「个人信息安全」方面的内容。</p><p>本文可能会涉及一些互联网服务，所以，请首先确保你的设备已经连接到互联网，而不是局域网。</p><h2>密码安全</h2><p>首先我们说一说帐号密码的安全问题。</p><p>我们都知道，密码当然是强度越强越好，比如我们可以同时使用「数字」、「小写字母」、「大写字母」、「标点符号」混合生成一个密码，字符尽可能不重复，密码尽可能无意义，同时密码长度尽可能的长一些，不能让他人很轻易的就可以猜测出来。</p><p>针对不同的帐号，我们也应该使用不同的密码，以防止某个站点被拖库，或者被撞库后，导致密码泄漏。</p><p>密码应当经常更换，不能等到帐号已经被盗的那一天再去申诉更改密码，等到那时候你的个人信息已经泄漏得差不多了，即使更改完密码也不可弥补了。</p><p>但是我们都知道，一个人的帐号数量会越来越多，同时做到上面的三点是十分困难的，很可能时不时就忘记了某个帐号的密码是什么，所以，我强烈推荐使用专业的密码管理工具管理密码，生成随机密码并安全存储，而不是靠大脑去记忆。</p><p>注意：请务必确定密码管理工具的可靠性，确保它不会收集密码数据，并且确定它的存储加密方式足够安全，并设置一个高强度的主密码。</p><p>开源且免费的「<a href="http://keepass.info/" target="_blank">KeePass</a>」对于大多数人来说，可能会是一个不错的选择。</p><p>如果你不信任任何一个密码管理工具，或者觉得把密码存储下来是一种很不安全的做法，那么你也可以选择使用大脑去记忆。但单纯的靠大脑去记忆，我们很难同时记住很多个不重复的高强度密码，所以，靠传统的记忆方法，密码强度就有可能会相应的降低一些。</p><p>这里我分享一个很实用的记忆密码的方式。</p><p>我们可以把网站的域名，在键盘上，向左偏移一个键位之后，作为密码的一部分。</p><p>比如，我有一个主密码，是<code>123456</code>，那么我在Google的密码就是<code>123456-Fiifkw</code>，我在V2EX的密码就是<code>123456-C1WZ</code>，这样，我们只需要记住一个主密码，并且主密码的强度高一些即可，更换密码的时候也只需要更换主密码。</p><p>当然，你也可以使用类似于「<a href="https://flowerpassword.com/" target="_blank">花密</a>」这类非储存型的密码管理工具。</p><p>无论如何，请永远不要使用类似于「123456」、「111111」、「5201314」、「123123」、「woaini」、「147258」、「password」、「qwerty」这样子的密码。</p><p>此外，无论强度多么高的密码，都存在被破解的可能性。所以，给帐号启用两步验证，也是必不可少的。</p><p>这里强烈<strong>不推荐</strong>使用短信验证码作为两步验证。比如，你的Twitter绑定了国内的手机号码作为两步验证，那么你很有可能收不到Twitter发来的验证码短信<del>（别问我为什么，说多了都是泪）</del>，同时也存在着短信验证码被伪基站截获的可能性。</p><p>推荐使用「<a href="https://authy.com/" target="_blank">Authy</a>」作为2FA工具，免费，且支持多设备同步。</p><p>这里所说的「密码安全」，当然不单单指「帐号密码」。给你的电脑、手机设置一个解锁密码，并且养成随手锁屏的好习惯，在很大程度上也可以保障你的个人隐私不会被他人窃取。</p><h2>数据安全</h2><p>我们的手机、电脑等设备里，存储了包括联系人、通话记录、短信、照片、浏览记录、工作文档等大量的隐私信息，这些信息一旦被曝光到互联网上，无异于我们在别人面前裸奔。</p><p>所以，我们应当在上网的同时，养成及时清理掉无用的历史记录，并对数据进行加密存储的好习惯。</p><p>同时记住：珍爱生命，远离毒瘤。对于一切不能确定安全性和可靠性的软件，我们都不应该运行它，如果确实需要使用，在虚拟机中运行可能是个最可行的方案。但请注意：测试运行未知软件的虚拟机，我们不应该安装虚拟机的增强工具（如VMware虚拟机中自带的VMware Tools等），以防止软件通过漏洞由虚拟机渗透至宿主机，继而获取到我们的隐私数据。</p><p>设备性能条件允许的话，我们可以将设备的硬盘进行全盘加密，同时设置一个高强度的解锁密码，这样基本可以满足绝大多数人对于数据加密的需求。</p><p>如果设备性能条件不能满足全盘加密的话，也一定要将关键的隐私数据单独进行加密，以防这些数据被他人轻易获取。</p><p>一般情况下，常见的操作系统已经内置了全盘加密方案，例如Windows的BitLocker、macOS的FileVault等；Android也可以在Settings的Security中，找到Encrypt phone的选项。</p><p>如果不希望进行全盘数据加密的话，可以考虑使用开源且免费的「<a href="https://www.veracrypt.fr/" target="_blank">VeraCrypt</a>」对关键的数据单独进行加密。</p><h2>其他</h2><p>我在刚开始写这篇文章的时候，觉得这个标题的范围太广了，很多东西都能写，但是都比较零散，不知道怎么互相联系起来，所以，我单独写了「密码安全」和「数据安全」两个方面，其他的一些内容就全都堆在这里吧，想到什么就说什么。</p><p>尽可能不要安装和使用毒瘤应用，合理管理应用权限，不要给应用一些不必要的权限。</p><p>尽可能不要使用那些无密码的公共WiFi，如果一定要用的话，也应该挂个全局VPN，加密转发一下数据流量。</p><p>杀软的话，尽可能不要使用一些国产的毒瘤（比如大数字），在很多情况下，免费的其实是最贵的。</p><p>尽可能使用独立的帐号密码进行登录，而不是使用QQ、微信、微博等帐号进行授权登录，因为，授权登录很可能会导致网站能够获取到你帐号内的隐私信息。</p><p>Apple ID这类很重要的帐号，一定不要使用不安全的邮箱进行注册。这里推荐使用Gmail进行注册。（点名批评网易邮箱，注册和登录页面竟然连HTTPS协议都不支持，前些阵子还被拖库，很大一部分Apple ID被盗导致iPhone等设备被锁、隐私信息被泄漏的案例，都是因为使用了网易邮箱作为Apple ID的主邮箱）</p><p>待补充OwO</p></div>]]></content>
        
        <summary type="html">
            
             在我删库跑路之前其实已经发过一篇类似的文章了，但是最终我还是觉得应该再发一次。这篇文章相比较于删库之前的那篇，可能会更加侧重于介绍一些「个人信息安全」方面的内容。本文可能会涉及一些互联网服务，所以，请首先确保你的设备已经连接到互联网，而不是局域网。密码安全首先我们说一说帐号密
            
        </summary>
        
    </entry>
    
    <entry>
        <title>做了一个个人摄影展示页</title>
        <link href="https://flyhigher.top/diary/639.html"/>
        <id>https://flyhigher.top/diary/639.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-07-25T15:53:20+00:00</published>
        <updated>2017-07-25T15:53:20+00:00</updated>
        
        <content type="html"><![CDATA[<p>不废话，先扔链接（丢：<a href="https://photo.axton.cc" target="_blank">photo.axton.cc</a></p>
<p>做这个页面的起因很神奇。我曾经用过腾讯云的CDN但是已经弃用很久了，所有配置也清空了，但前几天腾讯云莫名其妙给我产生了7.5KB的CDN流量，然后邮件短信各种告诉我已经激活了50GB/月共6个月的新手包。2333我想着不用白不用，就翻出了之前摄影展示页的万年老坑，把它填完扔到服务器上去了，图片扔在腾讯云。</p>
<p>这也算是我的新域名axton.cc的正式启用吧…但是挂在axton.cc下的个人介绍页现在是个坑，等我抽空填了吧。</p>
<p>折腾半天，主要问题是舍不得压缩图片，然后流量各种爆。于是在狠下心把图片压缩到1M左右（？？？）（别害怕缩略图没这么大啦）之外，我还开启了WebP支持。WebP是Google搞出来的一种图片文件格式，不了解的可以自行了解，反正牛逼哄哄的，<strong>重点是可以减小图片体积</strong>。问题是FF和IE/Edge等浏览器不支持。</p>
<p>腾讯云和七牛一样的坑就是不能自动判断并输出WebP格式图片，要手动判断然后在URL后面加查询。本来想搞静态页面，Nginx判断是否支持WebP（请求的Header里有注明），再搞替换。结果Nginx的配置文件各种坑，Sub替换还不能放在if里面…因为要判断必须用if最后只能在if里面搞rewrite。搞完以后看着一堆302极其不爽，最后还是放弃静态搞了PHP。</p>
<p>腾讯云还不支持.top域名，气死，还好手头有空闲同时备案过的域名。</p>
<p>呼。</p>
<p>听说又拍云有自动判断，改天换一下试试，就是又拍实名有点麻烦2333</p>
<p>最后实测WebP<strong>减少了</strong>大约50%-70%的流量，总算安心了。</p>
<p>发现有点奇怪的事就是很多喜欢搞技术的人也喜欢摄影，虽然水平各有不同（摊手</p>
<p>说不定哪位大佬还可以研究一下，写篇论文出来（逃</p>
<p>（震惊！你怎么知道这篇文章是用来水一水的！）</p>]]></content>
        
        <summary type="html">
            
            不废话，先扔链接（丢：photo.axton.cc 做这个页面的起因很神奇。我曾经用过腾讯云的CDN但是已经弃用很久了，所有配置也清空了，但前几天腾讯云莫名其妙给我产生了7.5KB的CDN流量，然后邮件短信各种告诉我已经激活了50GB/月共6个月的新手包。2333我想着不用白不
            
        </summary>
        
        <category term="其他"/>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="摄影"/>
        
        <category term="Axton"/>
        
        <category term="个人"/>
        
    </entry>
    
    <entry>
        <title>记一次事故</title>
        <link href="https://blog.lirici.moe/archives/77/"/>
        <id>https://blog.lirici.moe/archives/77/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-07-25T13:59:36+00:00</published>
        <updated>2017-07-25T13:59:36+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/3923628370.jpg" /></p>
<blockquote>
<p>手滑导致的一次事故</p>
</blockquote>
<ul>
<li>昨晚修改配置文件，编辑好了直接用xftp上传。想着顺手清理一下mysql日志，删的时候不小心碰到触控板，把/usr/local/mysql/var里的mysql文件夹删了。我发现不对的时候已经晚了，当即停止操作。</li>
<li>在不知道里面是什么的情况下，我觉得必须要先备份mysql的数据。果然在我进入mysql后台备份完数据后就不能登录了，提示密码错误。</li>
<li>我想到试试看lnmp的mysql升级脚本可能能修复，但是它有密码验证，输入正确密码提示错误。我意识到被删掉的文件里肯定有mysql主密码。尝试使用重置密码脚本无果后，为了稳定<del>其实是不知道该怎么修了</del>，果断备份好其他数据。在今天上午开始重装。</li>
<li>原来装的lnmp1.3正好也趁这次机会直接上1.4。当然也重新编译了nginx，lnmp默认不开real IP模块。加上real IP模块的同时也开了Brotli。</li>
<li>删东西还是老老实实rm比较好，没那么容易出错误删。<del>先水到这里</del></li>
</ul>]]></content>
        
        <summary type="html">
            
              手滑导致的一次事故   昨晚修改配置文件，编辑好了直接用xftp上传。想着顺手清理一下mysql日志，删的时候不小心碰到触控板，把/usr/local/mysql/var里的mysql文件夹删了。我发现不对的时候已经晚了，当即停止操作。 在不知道里面是什么的情况下，我觉得必
            
        </summary>
        
    </entry>
    
    <entry>
        <title>CloudFront+WordPress实现全站CDN</title>
        <link href="https://milkice.me/2017/07/25/wordpress-entire-site-cdn-via-cloudfront/"/>
        <id>https://milkice.me/2017/07/25/wordpress-entire-site-cdn-via-cloudfront/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-07-25T12:37:37+00:00</published>
        <updated>2017-07-25T12:37:37+00:00</updated>
        
        <content type="html"><![CDATA[最近真的要穷的吃土啦！ 原先的vps的月付费用已经完全无法支撑（摊手），后来不得已把IceBox迁到了Digital Ocean（有coupon可以连着开好几个月啦），但是失望地发现无论是美西旧金山节点还是新加坡节点从国内访问的速度都是十分感人，况且听说最近Digital Ocean在国内一些地方不能访问，据说是因为路由的问题，所以无论如……]]></content>
        
        <summary type="html">
            
            最近真的要穷的吃土啦！ 原先的vps的月付费用已经完全无法支撑（摊手），后来不得已把IceBox迁到了Digital Ocean（有coupon可以连着开好几个月啦），但是失望地发现无论是美西旧金山节点还是新加坡节点从国内访问的速度都是十分感人，况且听说最近Digital Oc
            
        </summary>
        
        <category term="CDN"/>
        
        <category term="Tech"/>
        
        <category term="Web"/>
        
        <category term="AWS"/>
        
        <category term="CloudFront"/>
        
        <category term="WordPress"/>
        
    </entry>
    
    <entry>
        <title>Bilibili 自动开宝箱脚本</title>
        <link href="https://i-meto.com/bilibili-silver/"/>
        <id>https://i-meto.com/bilibili-silver/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-07-24T15:58:00+00:00</published>
        <updated>2017-07-24T15:58:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<img src="https://image.static.i-meto.com/uploads/2017/12/bilibili.jpeg" /><p>项目地址：<a href="https://github.com/metowolf/BilibiliHelper">https://github.com/metowolf/BilibiliHelper</a></p>
<p>之前用 PHP 写了个<a href="https://i-meto.com/bilibili-heart/">直播间自动挂机脚本</a>，等级从个位数快速成长到 33 级。<br />
某天晚上和 <a href="https://blog.lwl12.com/">LWL</a> 聊天的时候脑洞大开，花了一个晚上实现了用 PHP 自动开宝箱领瓜子。</p>
<p>较难的部分就是验证码识别，用了字符切割，再与训练样本匹配的方法，使正确率几乎达到了 100% （目前还没失败的报告</p>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/bilibili.png" /></p>
<p>实现后的脚本在服务器上试运行了两天，效果良好，和之前直播挂机脚本合并重写了逻辑，可以安心食用了。</p>
<h2>药效</h2>
<ul>
<li>每日签到</li>
<li>每 5 分钟自动发送心跳包，+3000 观众经验</li>
<li>每日自动领宝箱（瓜子）</li>
</ul>
<h2>食用方法</h2>
<ol>
<li>首先你需要有一台服务器，非虚拟主机。</li>
<li>安装有 <code>php, php-gd, php-curl</code>，Ubuntu 用户可以直接 <code>sudo apt install php php-gd php-curl</code> 安装</li>
<li>到 <a href="https://github.com/metowolf/BilibiliHelper">Github</a> 下载源代码</li>
<li>修改 <code>index.php</code> 的 <code>Cookie</code> 和相关配置</li>
<li>测试 php index.php 可正常运行后，运行 <code>crontab -e</code> 写入 <code>3 0 * * * php [path]/index.php &gt; [path]/log.txt</code>，也就是在每天 00:03 运行该脚本，并将运行日志存入 <code>log.txt</code></li>
</ol>
<h2>注意事项</h2>
<p><strong>更可靠的获取 cookie 方法</strong>：需要点开一个直播间，按 F12 选 Network 选项卡，稍等大约 5 分钟后拿到 <code>https://api.live.bilibili.com/eventRoom/</code> 类似的数据包，复制里面的 cookie 即可。</p>
</div>]]></content>
        
        <summary type="html">
            
             项目地址：https://github.com/metowolf/BilibiliHelper 之前用 PHP 写了个直播间自动挂机脚本，等级从个位数快速成长到 33 级。 某天晚上和 LWL 聊天的时候脑洞大开，花了一个晚上实现了用 PHP 自动开宝箱领瓜子。 较难的部分就
            
        </summary>
        
    </entry>
    
    <entry>
        <title>腾达AC18安装梅林固件</title>
        <link href="https://www.isthnew.com/archives/ac18-install-merlin.html"/>
        <id>https://www.isthnew.com/archives/ac18-install-merlin.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-07-21T08:35:54+00:00</published>
        <updated>2017-07-21T08:35:54+00:00</updated>
        
        <content type="html"><![CDATA[<p>搬新家之后路由换了个腾达的 AC18 ，主要是听说这货刷不死，拿回来刷个梅林。AC18 的配置和 AC68U 基本相同，所以可以直接刷上 AC68U 的梅林固件，地址在这里<br /></p>]]></content>
        
        <summary type="html">
            
            搬新家之后路由换了个腾达的 AC18 ，主要是听说这货刷不死，拿回来刷个梅林。AC18 的配置和 AC68U 基本相同，所以可以直接刷上 AC68U 的梅林固件，地址在这里
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="腾达 ac18"/>
        
        <category term="路由"/>
        
        <category term="梅林"/>
        
    </entry>
    
    <entry>
        <title>黄昏</title>
        <link href="https://blog.lwl12.com/read/na-dusk.html"/>
        <id>https://blog.lwl12.com/read/na-dusk.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-07-15T14:49:10+00:00</published>
        <updated>2017-07-15T14:49:10+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/na-dusk.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/07/na-dusk.jpg" /></a></p><p><span></span></p>
<p><div></div></p>
<p> </p>
<p>他用一种慈祥的姿态在高处安抚着你</p>
<p>他铺开巨大的过滤网层层信仰奢靡</p>
<p>他大义凌然地宣布要把纯净筛留给你</p>
<p>过滤得只剩下了残骸还要你歌颂感激</p>
<p> </p>
<p>你终其一生想找到理由去热爱脚下的土地</p>
<p>他为其定义的伟大 对你有什么意义</p>
<p>你所能做的只是在奔跑中保护好你自己</p>
<p>你想要感受到他爱你 愿他别去伤害你</p>
<p> </p>
<p>他庞大的身躯压垮了多少初生的纯良</p>
<p>他曾有的灵魂矗立在远方冷漠地观望</p>
<p>他费力塑造的繁华成为装扮阴暗面的假象</p>
<p>他毁掉的美好在不久的将来变成了疯狂</p>
<p> </p>
<p>你终其一生想找到理由去热爱脚下的土地</p>
<p>他为其定义的伟大 对你有什么意义</p>
<p>你所能做的只是在奔跑中保护好你自己</p>
<p>你想要感受到他爱你 愿他别去伤害你</p>
<p>你终其一生找不到理由去热爱脚下的土地</p>
<p>传说中这里的强大是你生命的全部意义</p>
<p>你所能做的只是在奔跑中保护好你自己</p>
<p>你想要感受到他爱你 愿他别去伤害你</p>
<p> </p>
<blockquote>
<p>“这首歌我当初在写的时候为了防止它被和谐，所以就说它是一首关于父权的，家庭暴力的歌，其实并不仅仅关于此，叫做《黄昏》。” ——<a href="https://www.zhihu.com/question/27068245/answer/80462264">知乎</a></p>
</blockquote>
<style>#container{ filter: grayscale(100%); -webkit-filter: grayscale(100%); -moz-filter: grayscale(100%); -ms-filter: grayscale(100%); -o-filter: grayscale(100%); filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1); -webkit-filter: grayscale(1);}</style>
<p>-EOF-</p>]]></content>
        
        <summary type="html">
            
                他用一种慈祥的姿态在高处安抚着你 他铺开巨大的过滤网层层信仰奢靡 他大义凌然地宣布要把纯净筛留给你 过滤得只剩下了残骸还要你歌颂感激   你终其一生想找到理由去热爱脚下的土地 他为其定义的伟大 对你有什么意义 你所能做的只是在奔跑中保护好你自己 你想要感受到他爱你 愿他
            
        </summary>
        
        <category term="时事"/>
        
    </entry>
    
    <entry>
        <title>修复 Telegram 中文输入</title>
        <link href="https://i-meto.com/telegram-ibus/"/>
        <id>https://i-meto.com/telegram-ibus/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-07-14T11:35:00+00:00</published>
        <updated>2017-07-14T11:35:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><p>近日将 Ubuntu 升级到了 17.10，新的 Gnome3 桌面的确好看很多。但同时出现了很多之前在 Unity 没有出现过的 BUG，例如在 Telegram 下无论怎么切换输入法都不能输入中文。</p>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/telegram.png!/format/webp/lossless/true" /></p>
<p>于是聊天就很蛋疼，想要回复对方一句话，得先打在其他地方，然后再复制回来发送。</p>
<p>到 Telegram 的 Github issue 上查了查，有不少 Fedora 用户也有这样的问题。</p>
<p>大概是所有 QT 编写的应用程序在 Gnome3 下都会出现这个问题，解决方法是引入 QT_IM_MODULE 变量。大致步骤如下：</p>
<ol>
<li>编辑 ~/.local/share/applications/telegramdesktop.desktop 文件</li>
<li>修改 Exec 该行，添加环境变量 env QT_IM_MODULE=ibus，使用 fcitx 的用户，把 ibus 替换成 fcitx</li>
</ol>
<p>最后修改效果如图</p>
<p><img src="https://ww2.sinaimg.cn/large/a15b4afegy1fhjn68w3c2j20qp0ifwg8" /></p>
<p>最后保存即可。</p>
<hr />
<p><strong>最后感谢一下把我文章抄走的网站</strong></p>
<pre><code>http://www.qingpingshan.com/pc/fwq/298889.html
清屏网，删除作者署名，删除原文链接
</code></pre>
</div>]]></content>
        
        <summary type="html">
            
            近日将 Ubuntu 升级到了 17.10，新的 Gnome3 桌面的确好看很多。但同时出现了很多之前在 Unity 没有出现过的 BUG，例如在 Telegram 下无论怎么切换输入法都不能输入中文。  于是聊天就很蛋疼，想要回复对方一句话，得先打在其他地方，然后再复制回来发
            
        </summary>
        
    </entry>
    
    <entry>
        <title>在Centos7上部署魔改版后端</title>
        <link href="https://blog.lirici.moe/archives/68/"/>
        <id>https://blog.lirici.moe/archives/68/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-07-13T14:14:00+00:00</published>
        <updated>2017-07-13T14:14:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/349453324.jpg" /></p>
<blockquote>
<p>在Centos7上部署魔改版后端跟Centos6中有一些不同，本文介绍如何在Centos7上部署魔改版SSR<del>基本就是官方教程拿来改一改</del></p>
</blockquote>
<ol>
<li><a href="https://github.com/esdeathlove/shadowsocks">项目的Github地址</a></li>
<li><a href="https://github.com/esdeathlove/shadowsocks/wiki/%E8%AF%B4%E6%98%8E%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">官方部署教程，适用于Centos6</a></li>
</ol>
<blockquote>
<p>准备工作</p>
</blockquote>
<ol>
<li>更新yum源<br />
<code>yum update</code></li>
<li>添加epel源<br />
<code>yum install -y epel-release</code></li>
<li>安装git等
<pre><code>yum install -y git
yum install -y wget
yum install python-setuptools &amp;&amp; easy_install pip</code></pre></li>
<li>安装 libsodium
<pre><code>yum -y groupinstall &quot;Development Tools&quot;
wget https://github.com/jedisct1/libsodium/releases/download/1.0.13/libsodium-1.0.13.tar.gz
tar xf libsodium-1.0.13.tar.gz &amp;&amp; cd libsodium-1.0.13
./configure &amp;&amp; make -j2 &amp;&amp; make install
echo /usr/local/lib &gt; /etc/ld.so.conf.d/usr_local_lib.conf
ldconfig</code></pre></li>
<li>下载程序源代码并安装依赖
<pre><code>git clone -b manyuser https://github.com/glzjin/shadowsocks.git
cd shadowsocks
yum -y install python-devel
yum -y install libffi-devel
yum -y install openssl-devel
pip install -r requirements.txt</code></pre></li>
<li>获取配置文件
<pre><code>cd /root/shadowsocks
cp apiconfig.py userapiconfig.py
cp config.json user-config.json</code></pre></li>
<li>主要编辑 userapiconfig.py ,来解释下里面各项配置的意思
<pre><code># Config
#节点ID
NODE_ID = 1
#自动化测速，为0不测试，此处以小时为单位，要和 ss-panel 设置的小时数一致
SPEEDTEST = 6
#云安全，自动上报与下载封禁IP，1为开启，0为关闭
CLOUDSAFE = 1
#自动封禁SS密码和加密方式错误的 IP，1为开启，0为关闭
ANTISSATTACK = 0
#是否接受上级下发的命令，如果你要用这个命令，请参考我之前写的东西，公钥放在目录下的 ssshell.asc
AUTOEXEC = 1
多端口单用户设置，看重大更新说明。
MU_SUFFIX = 'zhaoj.in'
多端口单用户设置，看重大更新说明。
MU_REGEX = '%5m%id.%suffix'
#不明觉厉
SERVER_PUB_ADDR = '127.0.0.1' # mujson_mgr need this to generate ssr link
#访问面板方式
`API_INTERFACE = 'glzjinmod' #glzjinmod (数据库方式连接)，modwebapi (http api)
#mudb，不要管
MUDB_FILE = 'mudb.json'
# HTTP API 的相关信息，看重大更新说明。
WEBAPI_URL = 'https://zhaoj.in'
WEBAPI_TOKEN = 'glzjin'
# Mysql 数据库连接信息
MYSQL_HOST = '127.0.0.1'
MYSQL_PORT = 3306
MYSQL_USER = 'ss'
MYSQL_PASS = 'ss'
MYSQL_DB = 'shadowsocks'
# 是否启用SSL连接，0为关，1为开
MYSQL_SSL_ENABLE = 0
# 客户端证书目录，请看 https://github.com/glzjin/shadowsocks/wiki/Mysql-SSL%E9%85%8D%E7%BD%AE
MYSQL_SSL_CERT = '/root/shadowsocks/client-cert.pem'
MYSQL_SSL_KEY = '/root/shadowsocks/client-key.pem'
MYSQL_SSL_CA = '/root/shadowsocks/ca.pem'
# API，不用管
API_HOST = '127.0.0.1'
API_PORT = 80
API_PATH = '/mu/v2/'
API_TOKEN = 'abcdef'
API_UPDATE_TIME = 60
# Manager 不用管
MANAGE_PASS = 'ss233333333'
#if you want manage in other server you should set this value to global ip
MANAGE_BIND_IP = '127.0.0.1'
#make sure this port is idle
MANAGE_PORT = 23333
#安全设置，限制在线 IP 数所需，下面这个参数随机设置，并且所有节点需要保持一致。
IP_MD5_SALT = 'randomforsafety'</code></pre></li>
<li>运行的话，有几种方式。
<ul>
<li>python server.py 用于调错的</li>
<li>./run.sh 无日志后台运行</li>
<li>./logrun.sh 有日志后台运行</li>
<li>supervisord</li>
</ul></li>
</ol>
<blockquote>
<p>优化</p>
</blockquote>
<pre><code>编辑 /etc/security/limits.conf
最后添加
* soft nofile 51200
* hard nofile 51200
然后在运行之前执行
ulimit -n 51200
然后编辑 /etc/sysctl.conf
fs.file-max = 51200
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 4096
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 0
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 10000 65000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.tcp_mtu_probing = 1
保存
sysctl -p 来使其生效。</code></pre>
<blockquote>
<p>配置supervisord</p>
</blockquote>
<pre><code>yum install supervisor python-pip -y
pip install supervisor==3.1
wget https://github.com/glzjin/ssshell-jar/raw/master/supervisord.conf -O /etc/supervisord.conf
wget https://raw.githubusercontent.com/Supervisor/initscripts/master/centos-systemd-etcs -O /usr/lib/systemd/system/systemd-supervisor.service
vi /usr/lib/systemd/system/systemd-supervisor.service
在里面加入LimitNOFILE=512000
保存</code></pre>
<ul>
<li>编辑配置文件
<pre><code>编辑 /etc/supervisord.conf 最后一段改成如下的，以 /root/shadowsocks/ 为例
[program:mu]
command=python /root/shadowsocks/server.py
directory=/root/shadowsocks
autorestart=true
startsecs=10
startretries=36
redirect_stderr=true
user=root ; setuid to this UNIX account to run the program
log_stdout=true ; if true, log program stdout (default true)
log_stderr=true ; if true, log program stderr (def false)
logfile=/var/log/mu.log ; child log path, use NONE for none; default AUTO
;logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB)
;logfile_backups=10 ; # of logfile backups (default 10)
保存</code></pre></li>
<li>然后<br />
<code>systemctl enable systemd-supervisor</code>设置开机自启<br />
<code>systemctl start systemd-supervisor</code>启动supervisord<br />
<code>systemctl status systemd-supervisor</code>查看supervisord运行情况</li>
<li>如果运行正常，节点不能使用可能需要在iptables里放行端口
<pre><code>vi /etc/sysconfig/iptables
-A INPUT -p tcp -m tcp --dport 1025: -j ACCEPT 添加这一行
保存
-A INPUT -p tcp -m state --dport 443 --state NEW -j ACCEPT
-A INPUT -p udp -m state --dport 443 --state NEW -j ACCEPT
-A INPUT -p udp -m udp --dport 443 -j ACCEPT
单端口同时开启tcp和udp
systemctl restart iptables.service 重启iptables</code></pre></li>
</ul>]]></content>
        
        <summary type="html">
            
              在Centos7上部署魔改版后端跟Centos6中有一些不同，本文介绍如何在Centos7上部署魔改版SSR基本就是官方教程拿来改一改   项目的Github地址 官方部署教程，适用于Centos6   准备工作   更新yum源 yum update 添加epel源 yu
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Centos7替换Firewall为iptables</title>
        <link href="https://blog.lirici.moe/archives/66/"/>
        <id>https://blog.lirici.moe/archives/66/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-07-13T13:35:11+00:00</published>
        <updated>2017-07-13T13:35:11+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/3902069161.jpg" />&gt;对于习惯了Centos6的人来说使用iptables肯定比Firewall更舒服。<del>其实是我懒得学习怎么使用Firewall</del></p>
<p>因为Centos7默认使用的是Firewall所以这里就教大家怎么替换Firewall为iptables</p>
<blockquote>
<p>首先关闭Firewall的开机自启动并停止它</p>
</blockquote>
<pre><code>systemctl disable firewalld.service
systemctl stop firewalld.service</code></pre>
<blockquote>
<p>安装iptables并启用</p>
</blockquote>
<pre><code>yum install -y iptables-services
systemctl enable iptables.service
systemctl start iptables.service</code></pre>
<blockquote>
<p>配置iptables</p>
</blockquote>
<pre><code>vi /etc/sysconfig/iptables
保存退出即可，不会vim就用nano吧。
systemctl restart iptables.service</code></pre>
<p>简单的替换教程就到此结束了</p>]]></content>
        
        <summary type="html">
            
            &amp;gt;对于习惯了Centos6的人来说使用iptables肯定比Firewall更舒服。其实是我懒得学习怎么使用Firewall 因为Centos7默认使用的是Firewall所以这里就教大家怎么替换Firewall为iptables  首先关闭Firewall的开机自启动并
            
        </summary>
        
    </entry>
    
    <entry>
        <title>做好精致教育 成就共同梦想</title>
        <link href="https://blog.asec01.net/bj54zx-2017-summer/"/>
        <id>https://blog.asec01.net/bj54zx-2017-summer/</id>
        
        <published>2017-07-12T09:48:00+00:00</published>
        <updated>2017-07-12T09:48:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>​北京市第五十四中学 2017·夏</p>
<a></a>
<p>高清未压缩视频下载：链接: <a href="https://pan.baidu.com/s/1bpGRDNL" target="_blank">https://pan.baidu.com/s/1bpGRDNL</a> 密码: e77u</p>

<p>制作：<br />
张哲 周慧明</p>
<p>策划：<br />
北京市第五十四中学 科宣处</p>
<p>技术支持：<br />
北京市第五十四中学 信息中心</p>]]></content>
        
        <summary type="html">
            
            ​北京市第五十四中学 2017·夏  高清未压缩视频下载：链接: https://pan.baidu.com/s/1bpGRDNL 密码: e77u  制作： 张哲 周慧明 策划： 北京市第五十四中学 科宣处 技术支持： 北京市第五十四中学 信息中心
            
        </summary>
        
    </entry>
    
    <entry>
        <title>初识 Linux 文件权限</title>
        <link href="https://blog.kejun.me//reading/2017/07/11/the-first-Linux-file-permissions.html"/>
        <id>https://blog.kejun.me//reading/2017/07/11/the-first-Linux-file-permissions.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-07-11T11:49:27+00:00</published>
        <updated>2017-07-11T11:49:27+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote>
  <p>Linux一般将文件可存取的身份分为三个类别，分别是 owner/group/others，且三种身份各有 read/write/execute 等权限——鸟哥</p>
</blockquote>

<p>如文章头图所示，<strong>r = 4，w = 2 , x = 1</strong>。</p>

<p>我们一般在网上所找到的授予<code>755</code>权限就是相当于<code>-rwxr-xr-x</code>,<code>777</code>权限就是<code>-rwxrwxrwx</code>。</p>

<hr />

<p>与文件权限相关的命令主要有三个：</p>

<ol>
  <li><code>chgrp</code> ：改变文件所属群组</li>
  <li><code>chown</code> ：改变文件拥有者</li>
  <li><code>chmod</code> ：改变文件的权限, SUID, SGID, SBIT等等的特性</li>
</ol>

<h2><code>chgrp</code></h2>

<p>改变一个文件的群组很简单，直接以<code>chgrp</code>来改变即可，这个指令就是<code>change group</code>的缩写嘛！很好记吧！ QwQ。</p>

<div><div><pre><code><span>[</span>kejun@localhost ~]<span>$ </span>chgrp <span>[</span><span>-R</span><span>]</span> dirname/filename ...
选项与参数：
<span>-R</span> : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件、目录
     都更新成为这个群组之意。常常用在变更某一目录内所有的文件之情况。

其他参数使用man chgrp查询
</code></pre></div></div>

<div><div><pre><code>范例：
将test.sh的所属群组更改为testgrp
<span>[</span>kejun@localhost ~]<span>$ </span>chgrp testgrp test.sh
<span>[</span>kejun@localhost ~]<span>$ </span><span>ls</span> <span>-l</span>
<span>-rw-rw-r--</span><span>.</span> 1 kejun testgrp 0 Jul 12 03:43 test.sh
</code></pre></div></div>

<h2><code>chown</code></h2>

<p>如何改变一个文件的拥有者呢？很简单呀！既然改变群组是change group，那么改变拥有者就是change owner啰！</p>

<p><code>chown</code> 也可以直接修改所属群组~</p>

<div><div><pre><code><span>[</span>kejun@localhost ~]<span>$ </span>chown <span>[</span><span>-R</span><span>]</span> 帐号名称 文件或目录
<span>[</span>kejun@localhost ~]<span>$ </span>chown <span>[</span><span>-R</span><span>]</span> 帐号名称:群组名称 文件或目录
选项与参数：
<span>-R</span> : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件都变更
</code></pre></div></div>

<div><div><pre><code>范例：
将test.sh的文件拥有者更改为testusr、文件所属群组更改为testgrp
<span>[</span>kejun@localhost ~]<span>$ </span>chown testusr:testgrp test.sh
</code></pre></div></div>

<h2><code>chmod</code></h2>

<p>文件权限的改变使用的是chmod这个指令，权限的设置方法有两种,分别是数字或符号。</p>

<h3>使用数字</h3>

<p>如开头所说，各权限对应分数如下:</p>

<p><strong>r:4 w:2 x:1</strong></p>

<div><div><pre><code><span>[</span>kejun@localhost ~]<span>$ </span>chmod <span>[</span><span>-R</span><span>]</span> xyz 文件或目录
选项与参数：
xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。
<span>-R</span> : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件都会变更
</code></pre></div></div>

<div><div><pre><code>范例：
将test.sh文件的所有权限都启用
<span>[</span>kejun@localhost ~]<span>$ </span>chmod 777 test.sh
</code></pre></div></div>

<p>如果要将权限变成<code>-rwxr-xr--</code>，那么对应分数就是 [4+2+1][4+0+1][4+0+0]=754；使用<code>chmod 754 filename</code>即可完成。</p>

<h3>使用符号</h3>

<table>
  <tbody>
    <tr>
      <td>chmod</td>
      <td>u<br /> g<br /> o<br /> a<br /></td>
      <td>+（加入）<br /> -（除去）<br /> =（设置）<br /></td>
      <td>r w x</td>
      <td>文件或目录</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>u = user;</li>
  <li>g = group;</li>
  <li>o = others;</li>
  <li>a = all</li>
</ul>

<div><div><pre><code>范例1：
将 test.sh 文件的权限设置为-rwxr-xr-x
<span>[</span>kejun@localhost ~]<span>$ </span>chmod <span>u</span><span>=</span>rwx,go<span>=</span>rx test.sh

范例2：
为 test.sh  的ugo加上可执行权限
<span>[</span>kejun@localhost ~]<span>$ </span>chmod a+x test.sh
</code></pre></div></div>]]></content>
        
        <summary type="html">
            
               Linux一般将文件可存取的身份分为三个类别，分别是 owner/group/others，且三种身份各有 read/write/execute 等权限——鸟哥   如文章头图所示，r = 4，w = 2 , x = 1。  我们一般在网上所找到的授予755权限就是相当于
            
        </summary>
        
        <category term="linux"/>
        
        <category term="权限"/>
        
    </entry>
    
    <entry>
        <title>Hack.init() 2017 Write Up</title>
        <link href="https://flyhigher.top/develop/594.html"/>
        <id>https://flyhigher.top/develop/594.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-07-11T03:32:04+00:00</published>
        <updated>2017-07-11T03:32:04+00:00</updated>
        
        <content type="html"><![CDATA[<p>日常碎碎念</p>
<p>非常荣幸，（zijibaoming）参加了7.8-9在上海科技大学举办的Hack.init()创客马拉松。既然来了就想着写点东西出来，也算是留个纪念吧2333</p>
<p>开始之前</p>
<p>7.7到达上海，第二天早上前往上海科技大学。结果跑错门，烈日下绕了大半圈，结果真的就是Staff说的<del>香汗淋漓</del>大汗淋漓。好歹算是没有迷路。成功抵达2333</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/1.gif"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/1.gif" /></a></p>
<p>结果之前组队的一位学长“遇到多年旧友”“打算跑路”，组队彻底崩坏，然后现场面基拉人组队。对，最后就是下面四个<del>大佬</del>傻子。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/2.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/2.jpg" /></a></p>
<p>然后就是非常纠结争论不休的伪·MindStorm，7.8 12:00正式开始为期24小时的HHHHHHack。</p>
<p>修仙与肝代码</p>
<p>不知道怎么想的，反正我们最后决定做纯软件的Project…我还带了一箱子的硬件来着（虽然都是些简单的开源硬件）。最后要做什么其实我也不太理解到底是啥…大概是因为我没有这方面的硬需吧2333</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/34.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/34.jpg" /></a></p>
<p>（PPT不是重点（虽然没有别的重点了</p>
<p>大概就是类似于生活管家之类的东西…这套系统会统计用户日常生活中的各种消耗品的使用情况并提供反馈，同时带有简单的账单功能和购买推荐功能，每月会根据需求自动下单购买商品，并生成账单。通过机器学习可以在使用中提高预测的精确性（而且真的写了算法但是由于一些原因最后没有使用）。还有基于Tags的社群数据分析之类的balabala…整个系统基于WEB。</p>
<p>上截屏</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/a1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/a1-576x1024.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/a2.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/a2-576x1024.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/a3.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/a3-576x1024.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/a4.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/a4-576x1024.jpg" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/a5.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/a5-576x1024.jpg" /></a></p>
<p>所以总结一下遇到的坑，嗯我做前端顺便怂恿了后端花了一点时间速成了某种世界上坠吼的语言。</p>
<p>在这个项目里我第一次真正使用了Vue.js，结果这一决定导致了我浪费了超多的时间去Debug。简直就是主要写Bug顺便Debug…</p>
<p>首先一个非常低级的错误就是我使用Ajax来保证前后端分离，但是在有一些库实例化的时候（比如实例化图表）忘记了Ajax需要时间导致在实例化的时候需要的某个变量还是未定义2333，简单地把实例化语句放到Ajax过程里面即可。</p>
<p>还有就是jQuery在解析后端传来的JSON数据的时候，好几次因为数据库中某个字段中多了不必要的换行符而导致JSON解析错误。这个Bug很隐蔽，在Windows下用浏览器访问接口看不出异常，直到我试图用POSTMAN解析才发现多出了换行符…</p>
<p>由于是草草速成Vue.js，我并没有详细翻阅文档而是直接上手偷示例代码，结果v-for给我造成了一大堆问题，由于时间不够最后拿jQuery修修补补，反正js写得超乱就对了（实现就好啊2333</p>
<p>这个项目前后端数据交换超累。由于JSON有些语法规则用代码实现会有些复杂，又有很高的出错率，导致现实情况是后端封装完一个接口以后要不断地修修改改，一会儿改这个接口一会儿改那个接口，开发非常零碎，又提高了了出错的可能性2333</p>
<p>团队在进度同步上，由于并非都会Git以及懒得提交等种种（为了偷懒）因素，我们并没有使用Git同步，而是简单粗暴在服务器上搭建环境并开放FTP，通过客户端的设置实现代码修改实时上传，直接在公网服务器环境上进行调试（我的实现是VS Code的自动保存+FlashFXP的活动编辑功能，各成员的实现各有不同）。这种方法在一定程度上提高了我们的开发效率，虽然没有Git严格安全，但至少适合了我们高强的开发。</p>
<p>后端本来打算使用Python+MySQL，然而我们的后端表示看不懂Django亦或是Flask的文档（“我是搞算法的啊喂”），所以最后我带他直接PHP速成（还是最新的PHP 7哦（笑），然后他负责封装接口我来搞前端。</p>
<p>到凌晨1点多后端表示撑不住了于是果断失踪3小时，但是此刻我还在Vue的海洋中挣扎，一直撑到6点睡了一会儿。结果醒来一看才一个小时但我已经清醒异常睡不着了，再次奋不顾身跳进Vue的大坑2333</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/5.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/5.jpg" /></a></p>
<p>（凌晨5点的比赛场地）</p>
<p>然后就一直肝到11:45总算是实现了一个简陋的页面。由于是单页面所以HTML乱的要死，我还花了好多时间给代码搞了层级缩进2333Beauty格式化完好丑啊不管我怎么配置…行了我强迫症犯了。</p>
<p>Staff们建议我们在11:30之前完成开发，Deadline是12:00，但是我们毕竟是Web应用所以死皮赖脸开发到11:45（Code in everywhere…嘛）</p>
<p>评审啦</p>
<p>吃完午饭评审就开始了。由于参赛分组多，评审不是公开的而是评委走到各组地方进行Face to Face的交流。一共来了3波评委，然后我们就语速飞快给他们扯我们的项目…扯完以后就直接去闭幕式。</p>
<p>结果刚走到场地就得知我们组是前十（好水啊），需要准备一下面向所有参赛者和赞助商爸爸们的讲演。于是又改了一下PPT扯了一通。</p>
<p>其实是不抱什么希望的因为有超多大神。有一组甚至写出了一个类似于编译器的东西，但是只是提供模块化编程界面并输出结果，没有代码，目的是帮助初学者学习代码思维（大佬欸）反正看起来牛逼哄哄的。</p>
<p>然后颁奖。这时候我们组的队友已经在看6-10名团队的奖励了(WolframAlphaPro一年使用权，看起来吼厉害的样子但是我们团队的人都不用）。接着看到第三名团队的奖品是可编程的无人机的时候真的是一脸羡慕（我最心水的就是这个无人机了好吗）。</p>
<p>拖了很久终于轮到给第一名颁奖。主持的Staff说了一句希望第一的团队还没走我就无意加了一句是的我们还没走。结果…</p>
<p>卧卧卧卧卧槽是我们！</p>
<p>真的被吓到了反正。</p>
<p>然后一脸懵逼地领了奖。1.2W欸，虽然是4个人分也很棒了，还有搜狗面试机会什么的虽然对我没用…</p>
<p>终于我们的队伍还是散了，时间是7.9下午6点左右。</p>
<p>Hack.init()再见！口爱的Staff们再见！</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/7-2.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/7-2.jpg" /></a></p>
<p>(为什么我的参赛证上面没有名字！别人都有欸）</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/8.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/8.jpg" /></a></p>
<p>（怕是没有更乱的桌子了）</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/10.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/10.jpg" /></a></p>
<p>（Google的T恤！）</p>
<p>并没有什么意义的p.s.</p>
<p>第二天逛了逛上海。虽然宁波离上海很近但是我上次来上海已经是大概7、8年前了，所以趁此机会走一走。</p>
<p>打卡</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/07/9.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/07/9.jpg" /></a></p>
<p>但是科技馆周一闭馆，好气哟。</p>
<p>下午泡在了上海书城，5楼Geek们的天堂。</p>
<p>然后就回家了。上海再见。</p>
<p>（都看到这里了，不如…留条评论吧↓)</p>]]></content>
        
        <summary type="html">
            
            日常碎碎念 非常荣幸，（zijibaoming）参加了7.8-9在上海科技大学举办的Hack.init()创客马拉松。既然来了就想着写点东西出来，也算是留个纪念吧2333 开始之前 7.7到达上海，第二天早上前往上海科技大学。结果跑错门，烈日下绕了大半圈，结果真的就是Staff
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="Hack.init()"/>
        
        <category term="WriteUp"/>
        
    </entry>
    
    <entry>
        <title>为博客启用 PWA 支持</title>
        <link href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html"/>
        <id>https://blog.nfz.moe/archives/pwa-support-for-my-blog.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-07-07T15:10:27+00:00</published>
        <updated>2017-07-07T15:10:27+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>对于 native app 和 PWA 的纷争我不想发表太多看法，但是有一件事是确定的——PWA 极大改善了移动端用户的体验。</p></blockquote><a></a><p>好消息是改造你的网站为 Progressive Web Apps（PWAs）并不困难。这就是本文想介绍的——我是如何改造我的博客使之成为 PWA 的。</p><h1><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 启用全站 -HTTPS"></a>启用全站 HTTPS</h1><p>这是使用 PWA 的第一步。<br />这是由于一些显而易见的原因（其中，PWA 需要借助 ServiceWorker 是最主要的原因）<br />我旗下所有网站都已经启用了 HTTPS 支持。</p><h1><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 创建一个 -Service-Worker"></a>创建一个 Service Worker</h1><p>ServiceWorker 是一个可以拦截和响应你的网络请求的编程接口，具备有可以高效的缓存、提供通知和离线访问的特性。<br />Service Worker 很复杂，你可以修改示例代码来达到自己的目的。<a href="https://gist.github.com/neoFelhz/50800b701d00dc6d874be95da2cd7655" target="_blank">这里 </a> 是一个标准的 Web Worker，浏览器用一个单独的线程来下载和执行它。它没有调用 DOM 和其他页面 API 的能力，但它可以拦截网络请求，包括页面切换，静态资源下载。你要做的不过是启用它。<br />关于如何用上述示例代码启用一个最简单的 ServiceWorker，你可以阅读<a href="https://blog.nfz.moe/archives/wpo-by-service-worker.html">《Web 性能优化（2）——浅尝 Service Worker》</a>。</p><h1><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 创建 -Web-App-Manifest"></a>创建 Web App Manifest</h1><p>manifest 文件提供了一些我们网站的信息，例如 name，description 和需要在主屏使用的图标的图片，启动屏的图片等。<br />manifest 文件是一个 JSON 格式的文件，位于你项目的根目录。它必须用 <code>Content-Type: application/manifest+json</code> 或者 <code>Content-Type: application/json</code> 这样的 HTTP 头来请求。</p><pre><code><span>{</span>  <span>&quot;name&quot;</span>              <span>:</span> <span>&quot;PWA Website&quot;</span><span>,</span>  <span>&quot;short_name&quot;</span>        <span>:</span> <span>&quot;PWA&quot;</span><span>,</span>  <span>&quot;description&quot;</span>       <span>:</span> <span>&quot;An example PWA website&quot;</span><span>,</span>  <span>&quot;start_url&quot;</span>         <span>:</span> <span>&quot;/&quot;</span><span>,</span>  <span>&quot;display&quot;</span>           <span>:</span> <span>&quot;standalone&quot;</span><span>,</span>  <span>&quot;orientation&quot;</span>       <span>:</span> <span>&quot;any&quot;</span><span>,</span>  <span>&quot;background_color&quot;</span>  <span>:</span> <span>&quot;#ACE&quot;</span><span>,</span>  <span>&quot;theme_color&quot;</span>       <span>:</span> <span>&quot;#ACE&quot;</span><span>,</span>  <span>&quot;icons&quot;</span><span>:</span> <span>[</span>    <span>{</span>      <span>&quot;src&quot;</span>           <span>:</span> <span>&quot;/images/logo/logo072.png&quot;</span><span>,</span>      <span>&quot;sizes&quot;</span>         <span>:</span> <span>&quot;72x72&quot;</span><span>,</span>      <span>&quot;type&quot;</span>          <span>:</span> <span>&quot;image/png&quot;</span>    <span>}</span><span>,</span>    <span>{</span>      <span>&quot;src&quot;</span>           <span>:</span> <span>&quot;/images/logo/logo192.png&quot;</span><span>,</span>      <span>&quot;sizes&quot;</span>         <span>:</span> <span>&quot;192x192&quot;</span><span>,</span>      <span>&quot;type&quot;</span>          <span>:</span> <span>&quot;image/png&quot;</span>    <span>}</span><span>,</span>    <span>{</span>      <span>&quot;src&quot;</span>           <span>:</span> <span>&quot;/images/logo/logo256.png&quot;</span><span>,</span>      <span>&quot;sizes&quot;</span>         <span>:</span> <span>&quot;256x256&quot;</span><span>,</span>      <span>&quot;type&quot;</span>          <span>:</span> <span>&quot;image/png&quot;</span>    <span>}</span><span>,</span>    <span>{</span>      <span>&quot;src&quot;</span>           <span>:</span> <span>&quot;/images/logo/logo512.png&quot;</span><span>,</span>      <span>&quot;sizes&quot;</span>         <span>:</span> <span>&quot;512x512&quot;</span><span>,</span>      <span>&quot;type&quot;</span>          <span>:</span> <span>&quot;image/png&quot;</span>    <span>}</span>  <span>]</span><span>}</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是一个 PWA Manifest 的示例。你可以通过简单修改它后在自己的网站上启用。<br />可选的属性有：</p><ul><li>name —— 网页显示给用户的完整名称</li><li>short_name —— 当空间不足以显示全名时的网站缩写名称</li><li>description —— 关于网站的详细描述</li><li>start_url —— 网页的初始 相对 URL（比如 /）</li><li>scope —— 导航范围。比如，<code>`/app/</code>的 scope 就限制 <code>app</code> 在这个文件夹里。</li><li>background-color —— 启动屏和浏览器的背景颜色</li><li>theme_color —— 网站的主题颜色，一般都与背景颜色相同，它可以影响网站的显示</li><li>orientation —— 首选的显示方向：any, natural, landscape, landscape-primary, landscape-secondary, portrait, portrait-primary, 和 portrait-secondary。</li><li>display —— 首选的显示方式：fullscreen, standalone (看起来像是 native app)，minimal-ui (有简化的浏览器控制选项) 和 browser (常规的浏览器 tab)</li><li>icons —— 定义了 src URL, sizes 和 type 的图片对象数组，用来定义 PWA 的 icon。</li></ul><blockquote><p>你可以在 <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest" target="_blank">MDN</a> 中找到对 <code>manifest</code> 详细说明。<br />另外，你也可以通过 <a href="https://app-manifest.firebaseapp.com" target="_blank"> 这个网站 </a> 快速生成一个 <code>manifest.json</code> 和各种大小的图标。</p></blockquote><p>最后，在 HTML 内引用这个文件。</p><pre><code><span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&quot;</span>manifest<span>&quot;</span></span> <span>href</span><span><span>=</span><span>&quot;</span>/manifest.json<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><h1><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 调试"></a>调试 </h1><p> 现代浏览器都提供了完善的调试工具。本文以 Chrome 为例。</p><h2><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 调试 -Manifest"></a>调试 Manifest</h2><p>在开发者工具中的 <code>Application</code> 选项卡左边有 <code>Manifest</code> 选项，你可以验证你的 manifest JSON 文件，并提供了 <code>Add to homescreen</code>。执行操作，检查控制台日志是否有报错。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000085.png" /></p><h2><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 调试 -ServiceWorker"></a>调试 ServiceWorker</h2><p>在开发者工具中的 <code>Application</code> 选项卡左边的 <code>Application</code> 选项中你可以轻松地调试你的 ServiceWorker。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000086.png" /></p><p>点击 <code>Offline</code>，检查你的离线页面是否正常工作。</p><blockquote><p>在 <code>Clear storage</code> 选项中你可以清除 ServiceWorker 的缓存。</p><p>技巧一：用 隐身窗口 来测试你的 PWA，这样在你关闭这个窗口之后缓存就不会保留下来。<br />技巧二：在 Chrome 新版本的开放人员面板中新增了功能 <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk?utm_source=chrome-app-launcher-info-dialog" target="_blank">Lighthouse</a> 可以快速调试 PWA。Lighthouse 还内置了 <code>pagespeed</code> 可以测试页面的加载性能。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/pwa-support-for-my-blog.html# 让 -PWA- 安装提示在首次访问时弹出"></a>让 PWA 安装提示在首次访问时弹出 </h2><p> 你可以在页面中加入下述 JavaScript，可以让访客首次访问你的页面时弹出 PWA 安装下图所示的提示弹窗。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000156.jpg" /></p><pre><code>window<span>.</span><span>addEventListener</span><span>(</span><span>'beforeinstallprompt'</span><span>,</span> event <span>=</span><span>&gt;</span> <span>{</span>  event<span>.</span>userChoice<span>.</span><span>then</span><span>(</span>result <span>=</span><span>&gt;</span> <span>{</span>console<span>.</span><span>log</span><span>(</span>result<span>.</span>outcome<span>)</span>  <span>}</span><span>)</span><span>}</span><span>)</span><span><span></span><span></span><span></span><span></span></span></code></pre><p>不过我还是比较喜欢 Chrome 默认的做法，即首次访问并不一定弹出对话框，只有用户在 24 小时内多次访问页面（次数是根据会话数统计的）才弹出安装对话框。我认为，这样做也是对访客负责——固然安装 PWA 能吸引访客回访——但是不是所有人都愿意安装一个 PWA，尤其是不频繁访问网站的。</p><hr /><p>上述调试都通过了？把你的网站部署上生产环境吧！</p><hr /><blockquote><p>本文更新于 2017.7.7 日，根据 <a href="https://siyuanlau.github.io/2017/06/08/ 在博客上完全实现 PWA 支持 /" target="_blank">《在博客上完全实现 PWA 支持》</a> 提到的细节进行了完善。</p></blockquote>]]></content>
        
        <summary type="html">
            
            对于 native app 和 PWA 的纷争我不想发表太多看法，但是有一件事是确定的——PWA 极大改善了移动端用户的体验。好消息是改造你的网站为 Progressive Web Apps（PWAs）并不困难。这就是本文想介绍的——我是如何改造我的博客使之成为 PWA 的。启
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="Web"/>
        
        <category term="PWA"/>
        
        <category term="Service Worker"/>
        
    </entry>
    
    <entry>
        <title>用 Service Workers 为网站加速</title>
        <link href="https://i-meto.com/service-workers/"/>
        <id>https://i-meto.com/service-workers/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-07-06T09:42:00+00:00</published>
        <updated>2017-07-06T09:42:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><img src="https://i.loli.net/2017/12/12/5a2faec953ed8.jpg" /><p>其实 Service Workers 是 Google 爸爸推出很久的一个黑科技，它可以在浏览器层面动态缓存一些请求，从而使网站的二次加载速度大幅提高。</p>
<p><img src="https://ww2.sinaimg.cn/large/a15b4afegy1fhaajo3iipj21hb0m9jz8" /></p>
<p>二次刷新我的博客，只重载了 16.0KB 的资源，甚至可以剪断网线访问 ∠( ᐛ 」∠)＿</p>
<p>需要注意的是，Service Workers 只有在 HTTPS 的前提下才能发挥作用</p>
<h2>添加 sw-toolbox 核心</h2>
<p>下载 <a href="https://raw.githubusercontent.com/GoogleChrome/sw-toolbox/master/sw-toolbox.js">sw-toolbox.js</a> 并且放置到主题目录下的 <code>assets/js</code> 目录</p>
<p>*如果你是默认主题，应该是在<code>path_to_ghost/content/themes/casper/assets/js</code></p>
<h2>创建缓存规则</h2>
<p>在主题根目录下创建 serviceworker.js，并且写入下面内容</p>
<pre><code>'use strict';

(function () {
  'use strict';
    /**
    * Service Worker Toolbox caching
    */

    var cacheVersion = '-toolbox-v1';
    var dynamicVendorCacheName = 'dynamic-vendor' + cacheVersion;
    var staticVendorCacheName = 'static-vendor' + cacheVersion;
    var staticAssetsCacheName = 'static-assets' + cacheVersion;
    var contentCacheName = 'content' + cacheVersion;
    var maxEntries = 50;

    self.importScripts('assets/js/sw-toolbox.js');

    self.toolbox.options.debug = false;

    // 缓存本站静态文件
    self.toolbox.router.get('/assets/(.*)', self.toolbox.cacheFirst, {
        cache: {
          name: staticAssetsCacheName,
          maxEntries: maxEntries
        }
    });

    // 缓存 googleapis
    self.toolbox.router.get('/css', self.toolbox.fastest, {
        origin: /fonts\.googleapis\.com/,
            cache: {
              name: dynamicVendorCacheName,
              maxEntries: maxEntries
            }
    });

    // 不缓存 DISQUS 评论
    self.toolbox.router.get('/(.*)', self.toolbox.networkOnly, {
        origin: /disqus\.com/
    });
    self.toolbox.router.get('/(.*)', self.toolbox.networkOnly, {
        origin: /disquscdn\.com/
    });


    // 缓存所有 Google 字体
    self.toolbox.router.get('/(.*)', self.toolbox.cacheFirst, {
        origin: /(fonts\.gstatic\.com|www\.google-analytics\.com)/,
        cache: {
          name: staticVendorCacheName,
          maxEntries: maxEntries
        }
    });

    self.toolbox.router.get('/content/(.*)', self.toolbox.fastest, {
        cache: {
          name: contentCacheName,
          maxEntries: maxEntries
        }
    });

    self.toolbox.router.get('/*', function (request, values, options) {
        if (!request.url.match(/(\/ghost\/|\/page\/)/) &amp;&amp; request.headers.get('accept').includes('text/html')) {
            return self.toolbox.fastest(request, values, options);
        } else {
            return self.toolbox.networkOnly(request, values, options);
        }
        }, {
        cache: {
            name: contentCacheName,
            maxEntries: maxEntries
        }
    });

    // immediately activate this serviceworker
    self.addEventListener('install', function (event) {
        return event.waitUntil(self.skipWaiting());
    });

    self.addEventListener('activate', function (event) {
        return event.waitUntil(self.clients.claim());
    }); 

})();
</code></pre>
<h2>启用 Service Workers</h2>
<p>在主题下的 <code>default.hbs</code> 文件 <code>&lt;/body&gt;</code> 标签前加入下面代码</p>
<pre><code> &lt;script&gt;
    var serviceWorkerUri = '/serviceworker.js';

    if ('serviceWorker' in navigator) {  
        navigator.serviceWorker.register(serviceWorkerUri).then(function() {
          if (navigator.serviceWorker.controller) {
            console.log('Assets cached by the controlling service worker.');
          } else {
            console.log('Please reload this page to allow the service worker to handle network operations.');
          }
        }).catch(function(error) {
          console.log('ERROR: ' + error);
        });
    } else {
        console.log('Service workers are not supported in the current browser.');
    }
    &lt;/script&gt;
</code></pre>
<p>搞定！刷新一遍，剪断网线试试吧 ୧(๑•̀⌄•́๑)૭</p>
<h2>参考资料</h2>
<ul>
<li><a href="http://wangkaibo.com/node-express-ghost-progressive-web-apps-pwa/">让你的 Ghost 博客支持 Progressive Web Apps （PWA）</a></li>
<li><a href="https://yangbo.tech/2017/01/15/2017-01-15-speedy-and-offline-site-by-service-worker/">使用Service worker实现加速/离线访问静态blog网站</a></li>
</ul>
</div>]]></content>
        
        <summary type="html">
            
            其实 Service Workers 是 Google 爸爸推出很久的一个黑科技，它可以在浏览器层面动态缓存一些请求，从而使网站的二次加载速度大幅提高。  二次刷新我的博客，只重载了 16.0KB 的资源，甚至可以剪断网线访问 ∠( ᐛ 」∠)＿ 需要注意的是，Service 
            
        </summary>
        
    </entry>
    
    <entry>
        <title>一篇划水公告</title>
        <link href="https://flyhigher.top/diary/583.html"/>
        <id>https://flyhigher.top/diary/583.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-07-04T07:01:19+00:00</published>
        <updated>2017-07-04T07:01:19+00:00</updated>
        
        <content type="html"><![CDATA[<p>启用新的DataCenter-Singapore B，同时无垠旗下所有服务器已开启谷歌BBR加速算法</p>]]></content>
        
        <summary type="html">
            
            启用新的DataCenter-Singapore B，同时无垠旗下所有服务器已开启谷歌BBR加速算法
            
        </summary>
        
        <category term="其他"/>
        
    </entry>
    
    <entry>
        <title>博客统计报告（2016.11.26-2017.07.02）</title>
        <link href="https://blog.nfz.moe/archives/2016-blog-analytics.html"/>
        <id>https://blog.nfz.moe/archives/2016-blog-analytics.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-07-03T07:25:00+00:00</published>
        <updated>2017-07-03T07:25:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>我的博客到现在快 300 天了，期间我的域名换了两次，博客程序也换了 Hexo。如今我即将使用 Google Analytics 统计访问数据，本文将公布从 2016.11.26 至 2017.07.02 的访问情况。</p><a></a><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html#PV-amp-UV"></a>PV &amp; UV</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000131.png" /></p><p>在这过去的 220 天中，我的博客总共迎来了 21557 名访客，总共访问了 86729 次页面。每位访客平均在我的页面上驻留 346s，跳出率平均为 40%。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000130.png" /></p><p>上图的几个波峰颇有意思。</p><ul><li>2016.12.22 第一次访问高峰，是我在酷安“玩机技巧”话题推广了我的博客。那一次访问高峰跑掉了我七牛 2 个 G 的流量、将近 2 块钱。这一次访问高峰持续了三天，累计带来了 641PV。</li><li>2017.1.23 这是第二次访问高峰。之前酷安发生了一起有人打包绿色守护、App Settings 等 Xposed 模块为木马的恶性事件，我写了一篇博客解析这个病毒。这篇博客我分享到了酷安和知乎，后来被多次转载。</li><li>2017.1.26 接下来我乘胜追击，写了《阻止运行、猎鹰网络、黑域 始末》，延续了这一次高峰。</li><li>2017.1.31 怒怼妮乎，又痛批了中国的开源环境。这几次的访问高峰总共为我带来了 3992PV。</li><li>2017.2.11 在怒几次事件中，我看清了酷安，选择离开。有感而发的文章引发了之后的一次访问高峰，累计带来 992PV。</li><li>之后的访问量便趋于平稳，图表中一些比较小的波峰一般是当天发表了新的文章。</li></ul><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 地理位置与语言"></a>地理位置与语言</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000132.png" /></p><p>毫无疑问，我的博客绝大部分访问量都来自中国，主要访客以使用简体中文为主。也就是说，并不是国内用户都会选择使用中文系统。</p><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 设备类型"></a>设备类型</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000133.png" /></p><p>我的博客主要流量还是来自于移动端，主要和我之前主要在酷安推广我的博客有关。<br />我的博客通过桌面浏览器访问能获得最好的体验；移动端的优势是方便，可以随时随地阅读，我的博客的主题的响应式设计也对移动端友好；而随着手机屏幕越来越大，平板已经被逐渐边缘化。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000134.png" /></p><p>除去 UA 中未知的部分（应该是桌面端的访问），绝大部分访客都使用 Android，小米和一加位居第一和第二。联想到我之前在酷安推广博客，这并不奇怪。排在第三、第四和第五的是三星、苹果和华为。它们也的确是非常热销的品牌。</p><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 操作系统"></a>操作系统</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000135.png" /></p><p>从操作系统来看，使用 Android 的占绝对优势，Windows 紧随其后。但是，使用 Mac 和 Linux 的访客数量加起来只是略多于 iOS 用户。看来我博客的访问依然不是以开发者为主。</p><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 浏览器"></a>浏览器</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000136.png" /></p><p>访问我的博客的浏览者中，使用 Chrome 的占绝大多数。接下来是 QQ 浏览器，我认为应该是使用 QQ 或者微信上的内置 TencentX5 内核的访客。<br />Chrome 浏览器性能优异，而且有很多 Web 前沿的特性。我的博客在 Chrome 上有最好的性能表现。<br />对于那微乎其微的 UC 浏览器用户，博客的主题甚至专门为 UC 内置了一整套样式。<br />由于来自 IE 的份额极低以至于都没有出现在报表中，这意味着我可以尽情尝试各种新的技术。</p><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 流量来源"></a>流量来源</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000137.png" /></p><p>我博客的大部分流量来自于我在社交媒体和社区上的推广，所以以直接访问为主。同时，我也欣喜地发现有多个搜索引擎收录了我的博客，并为我的博客带来了访客。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000138.png" /></p><p>可以看到，我的博客的引荐流量主要来自我的个人主页、知乎跳转、酷安跳转、Google+ 转发和 Telegram。<br />还可以看到，我的友链在流量引荐中占了很大一部分。<br />同时，我也注意到一些特定搜索引擎的关键词来的流量，这意味着我的 SEO 做的不错，有被搜索引擎收录。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000139.png" /></p><p>同时也需要注意，就是直接访客和引荐访客，网页平均停留时间较长、跳出率明显较低，但是从搜索引擎到来的访客则相反。这符合人们使用搜索引擎的习惯，找到有用的信息便不再继续探索，但同时也说明了我的博客对于这一类访客保活度还不够。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000140.png" /></p><p>Google 对原创博客非常友好，使用 HTTPS、提高访问速度、对移动端友好、结构化数据等也很有利于提高在 Google 的权重，最终绝大部分搜索引擎流量来自于 Google 搜索。而百度对原创博客就没有这么友好了，但基于其在国内庞大的市场份额，本博客也有部分的流量来自于百度。不过最近我使用 CloudXNS 分线路解析功能，刻意将百度爬虫的线路解析到 127.0.0.1 来阻止百度爬虫的到访，以后应该不会有从百度到访的人了。</p><h1><a href="https://blog.nfz.moe/archives/2016-blog-analytics.html# 后记"></a>后记 </h1><p> 我快要高三了，到高考结束以前，更新博客只会越来越少。很多事情在刚开始时，并不能预料到它最终会有什么结果。写博客也是一样。但是只要长期投入，最终一定能从中找到乐趣和成就感。</p>]]></content>
        
        <summary type="html">
            
            我的博客到现在快 300 天了，期间我的域名换了两次，博客程序也换了 Hexo。如今我即将使用 Google Analytics 统计访问数据，本文将公布从 2016.11.26 至 2017.07.02 的访问情况。PV &amp;amp; UV在这过去的 220 天中，我的博客总共
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="博客"/>
        
        <category term="访问统计"/>
        
        <category term="Piwik"/>
        
    </entry>
    
    <entry>
        <title>Spacemacs 和 Org-mode 和 LaTeX</title>
        <link href="https://blog.poi.cat/spacemacs-plus-org-mode-plus-latex"/>
        <id>https://blog.poi.cat/spacemacs-plus-org-mode-plus-latex</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-06-27T07:32:10+00:00</published>
        <updated>2017-06-27T07:32:10+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><p>我曾经试图将我的所有课笔记转换成 Markdown 文档以永久保存. 我的笔记包含了大量的数学公式, 所以需要在 Markdown 里内嵌 LaTeX.</p><blockquote><p>LaTeX 是对著名排版系统 TeX 的二次开发, TeX 是公认的数学公式排版最好的系统.</p></blockquote><p>但是, 在 Markdown 里编辑 LaTeX 简直是噩梦: 编辑器不提供 LaTeX 的补全. 一个公式里可能有大量重复的 <code>\alpha</code> <code>\sigama</code> <code>\rightarrow</code> 等符号, 而它们全部需要我一个字母一个字母地输入.</p><p><img src="https://c1.staticflickr.com/5/4026/35586235096_957455b2a9_o.png" /></p><p><em>Markdown 中内嵌的 LaTeX 大多是通过 MathJax 实现的, 所以另外一个大问题就是有的宏用不了了</em></p><p>所以在花费了大量时间将一本书的笔记录成 Markdown 之后, 我放弃了. :)</p><hr /><p>后来在 #archlinux-cn 的 <a href="https://twitter.com/riaqn0">riaqn</a> 安利下, 我开始使用 Emacs 的 Org-mode 来作笔记. 不得不说相比 Markdown, Org-mode 配合 Emacs 的生态, 在各种体验上都上升了不止一个等级.</p><p><img src="https://c1.staticflickr.com/5/4102/35238943780_858e7994a5_o.png" /></p><p>当然, 一个编辑器想要达到最佳的输入效果, 一番配置是少不了的. 下面就是我的整个 Emacs + Org-mode + LaTeX 环境的配置过程, 大家可以选择性观看.</p><h2>Spacemacs</h2><p>Emacs (<strong>E</strong>ditor <strong>MAC</strong>ro<strong>S</strong>) 是一个文本编辑器, 著名的编辑器之战的两大主角之一 (另一个是 vi 即其派生版本).</p><p>在 openSUSE 中安装 Emacs 只需要在 root 用户下运行:</p><pre><code>$ zypper <span>in</span> emacs
</code></pre><p>其他的 Linux 发行版请尝试使用包管理器安装, 或者和 Windows/macOS 用户一起看看<a href="https://www.gnu.org/software/emacs/download.html">官方文档</a>.</p><p>而 Spacemacs 是一个由社区驱动的 Emacs 的分支, 它的口号是:</p><blockquote><p>The best editor is neither Emacs nor Vim, it's Emacs <em>and</em> Vim!</p></blockquote><p>正如他们的口号所言, Spacemacs 的最大的特点就是 Vim 风格中通过 <a href="https://www.emacswiki.org/emacs/Evil">Evil</a> 实现了 Vim 的键位绑定. 在 Emacs 中也能使用 Vim 中独特的 <code>insert mode</code> 和 <code>visual mode</code> 了.</p><p>Spacemacs 的默认风格是 Vim, 同时也提供了 Emacs 和 Hybrid 适用不同的人.</p><p>安装 Spacemacs 只需要:</p><pre><code>$ mv ~/.emacs.d ~/.emacs.d.old &amp;&amp; mv ~/.emacs ~/.emacs.old <span># backup</span>
$ git <span>clone</span> https://github.com/syl20bnr/spacemacs ~/.emacs.d
</code></pre><p>在 Windows 下的话, 不仅要将 Spacemacs 的 <code>.emacs</code> 放在 <code>C:\Users\{username}\</code> 同时也要在 <code>C:\Users\{username}\AppData\Roaming</code> 里. 此外, 还有可能出现 <code>packages unavailable</code> 的情况, 此时可以参考一下官方的 <a href="https://github.com/syl20bnr/spacemacs/blob/master/doc/FAQ.org#why-are-all-packages-unavailable">FAQ</a>.</p><p>无论是什么 Editor/IDE, 装好的第一步应该都是修改字体吧. Spacemacs 的默认等宽字体是 Abode 的 <strong>Source Code Pro</strong>, 这曾经是我也是我的首选, 不过我现在喜欢用带连字 (ligatures) 的 <strong>Fira Code</strong>.</p><p>Spacemacs 的配置文件在 <code>~/.spacemacs</code>, 打开后找到 <code>dotspacemacs-default-font</code> 修改成:</p><pre><code>dotspacemacs-default-font '(&quot;Fira Code&quot;
                            :size 21
                            :weight normal
                            :width normal
                            :powerline-scale 1.4)
</code></pre><p>其中字体大小, 宽度等参数见个人喜好, 你可以在<a href="https://github.com/syl20bnr/spacemacs/blob/master/doc/DOCUMENTATION.org#font">这里</a> 看到各个参数的含义.</p><p>英文的等宽字体配置完后, 还可以选择性地配置其他的语言, 例如中文(这里需要先判断一下是不是 GUI):</p><pre><code>;; Set Chinese Font
;; Put this inside `dotspacemacs/user-config()`
(if window-system
        (dolist (charset '(kana han cjk-misc bopomofo))
                (set-fontset-font (frame-parameter nil 'font)
                        charset (font-spec :family &quot;Noto Sans SC&quot; :size 20))))
</code></pre><blockquote><p>如果不配置中文字体的话, 在打开带有中文字符的文件时, Emacs 会出现严重的卡顿 :(</p></blockquote><h2>Org-mode &amp; LaTeX</h2><p>Org-mode 是 Emacs 中的一种编辑模式, 支持编写 To-do list, 日志, 笔记等功能. 其中(对于我来说)最重要的就是支持 <a href="http://orgmode.org/manual/Embedded-LaTeX.html">内嵌 LaTeX</a> 了. Org-mode 从 Emacs 22 开始就已经成为默认安装的部分了, 所以不需要额外的安装操作, 只需要打开带有 <code>.org</code> 的文件, 就会自动进入 Org-mode 了.</p><p>不过想要有 LaTeX 的预览/导出的话, 还需要安装 <code>texlive</code>. openSUSE 下依旧是在 root 环境下运行:</p><pre><code>$ zypper <span>in</span> texlive
</code></pre><blockquote><p>#archliux-cn 的 farseerfc 前辈提示我可以用 texlive 的 Unix Installer, 方便管理各个版本的 texlive, 不过我还未尝试过.</p></blockquote><p>其他的系统也可以使用包管理器安装或者请参照一下<a href="https://www.tug.org/texlive/">官方文档</a>.</p><p>Org-mode 内嵌 LaTeX 有几种方式, display 我喜欢用 <code>\[E=mc^2\]</code>, inline 我偏好 <code>$E=mc^2$</code>. 预览时只需要用 <code>C - C X L</code> 即可.</p><p>默认的预览有点小, 所以我在 <code>.spacemacs</code> 里拉伸了一下大小:</p><pre><code>;; Enlarge LaTeX Fragment in Org-mode
;; Put this inside `dotspacemacs/user-config`
(require 'org)
(plist-put org-format-latex-options :scale 2.5)
</code></pre><h2>CDLaTeX</h2><p>到这里看来 Emacs + Org-mode 的组合相比 Markdown 似乎没有给输入太大的便利吧. 所以接下来要介绍的就是 Emacs 的另外一个 mode 了, 这个 mode 可以大大提高在 Org-mode 中输入 LaTeX 的效率 -- <code>CDLaTeX</code>.</p><p>在介绍 <code>CDLaTeX</code> 的工作原理之前, 先说一下 Emacs 中的 mode: Org-mode 和 <code>CDLaTeX</code> 虽然同是 Emacs 的 mode, 但是地位不同的. Org-mode 是 Major Mode(主要模块); <code>CDLaTeX</code> 是 Minor Mode(辅助模块). 一般来说 Emacs 是不能同时使用多个 Major Mode.</p><blockquote><p>如果想在 Emacs 的 buffer 中开多个 Major Mode, 参见: <a href="https://www.emacswiki.org/emacs/MultipleModes">MultipleModes</a></p></blockquote><p>所以 <code>CDLaTeX</code> 作用其实是实现了部分来自另外一个 Major Mode -- <code>AUCTeX</code> 的功能, 让你可以在其他的 Major Mode 里快速输入 LaTeX.</p><p>相比直接在 Org-mode 里使用 <code>CDLaTeX</code>, Org-mode 推荐使用 Org-mode 自带的轻量版的 <code>org-cdlatex-mode</code>.</p><p><code>org-cdlatex-mode</code> 依赖 <code>cdlatex.el</code> 和 <code>texmathp.el</code>(这个来自 <code>AUTeX</code>, 作用是判定目前光标所在位置是否在内嵌的 LaTeX 中). 所以我们需要在 <code>.spacemacs</code> 加入我们需要安装的 <code>CDLaTeX</code> 和 <code>AUTeX</code>:</p><pre><code>dotspacemacs-additional-packages '(cdlatex auctex)
</code></pre><p>然后重启 Emacs, Spacemacs 会自动帮你安装好他们.</p><p>注意全部使用小写, 而且不要用 <code>M - x package-install</code> 来安装, 因为 Spacemacs 会在<a href="https://github.com/syl20bnr/spacemacs/blob/master/doc/FAQ.org#why-are-packages-installed-with-package-install-automatically-deleted-by-spacemacs-when-it-boots">重启之后删掉他们</a>...</p><p>再次打开 Org-mode, 用 <code>M - x org-cdlatex-mode</code> 打开 <code>CDLaTeX</code>. 然后你就可以体验的 <code>CDLaTeX</code> 带来的快速输入 LaTeX 的功能了:</p><ol><li><p>用自动补全一些 LaTeX 模板, 例如: <code>fr</code> =&gt; <code>\frac{}{}</code>, <code>lr(</code> =&gt; <code>\left(\right)</code>. 此外,也可以用于在各个 <code>{}</code> 之间跳跃.</p></li><li><p><code>_</code> 和 <code>^</code> 会自动补全 <code>{}</code>, 不过如果 <code>{}</code> 里只有一个元素的话, 也会自动去掉.</p></li><li><p>在 <code>`</code> 后加一个字母可以快速输入一些 LaTeX 的符号, 例如 <code>`a</code> =&gt; <code>\alpha</code>, <code>`b</code> =&gt; <code>\beta</code></p></li><li><p>在一些字母之后加上 <code>'</code> 则是可以修改该字母的字体或者加修饰, 例如 <code>a'.</code> =&gt; <code>\dot{a}</code>, <code>a'1</code> =&gt; <code>{\displaystyle a}</code></p></li></ol><p><img src="https://c1.staticflickr.com/5/4068/35625649445_ed1143f084_o.png" /></p><p><em><code>&lt;TAB&gt;</code> 的补全</em></p><p><img src="https://c1.staticflickr.com/5/4011/35586234806_7a9c27dbee_o.png" /></p><p><em><code>`</code>的补全</em></p><h2>后语</h2><p>经过上述配置和折腾之后, 整理笔记终于成了一件不那么麻烦的事了. :)</p><p>一直有人问我为什么那么费劲的在各种标记语言里嵌套 LaTeX, 而不直接用 LaTeX 写呢? 嗯... 其实我一直有一个想法就是建立一个属于自己的类似知识库的东西, 所以我的期望是可以导出成 HTML 以便于时刻可以浏览, 而 LaTeX 在这方面就比较吃力了.</p><p>不过使用了 Org-mode 之后也有一个问题: 目前似乎没有现成的基于 Org-mode 的 Wiki Software, 所以这意味着我可能又需要自己造个轮子了... :(</p>]]></content>
        
        <summary type="html">
            
            前言我曾经试图将我的所有课笔记转换成 Markdown 文档以永久保存. 我的笔记包含了大量的数学公式, 所以需要在 Markdown 里内嵌 LaTeX.LaTeX 是对著名排版系统 TeX 的二次开发, TeX 是公认的数学公式排版最好的系统.但是, 在 Markdown 
            
        </summary>
        
        <category term="emacs"/>
        
        <category term="latex"/>
        
        <category term="org-mode"/>
        
    </entry>
    
    <entry>
        <title>寂静之城 (The Silence City)</title>
        <link href="https://blog.nfz.moe/archives/the-silence-city.html"/>
        <id>https://blog.nfz.moe/archives/the-silence-city.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-06-25T08:08:08+00:00</published>
        <updated>2017-06-25T08:08:08+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>马伯庸《寂静之城》未删节版本全文 <br /> 发表在 2005 年第 5 期《科幻世界》上的本文由于众所周知的原因进行了删节。以下是发在马伯庸个人网站上的原文。</p></blockquote><hr /><p>And in the naked light I saw ten thousand people, maybe more.<br />People talking without speaking, people hearing without listening.<br />People writing songs that voices never shared, no one dared disturb the sound of silence.</p><p>— The sound of silence</p><p>美利坚合众国，2015 年，纽约。</p><p>当电话响起来的时候，阿瓦登正趴在电脑前面睡觉。电话铃声十分急促，尖锐，每一次振动都让他的耳膜难受好久。他揉了揉干涩的眼睛，十分不情愿地爬起来，觉得脑子沉滞无比。</p><p>其实他的脑子一直就很沉滞，这种感受既然是生理上的也是心理上的。他身处的房间很狭窄，空气不很好，唯一的两扇窗户紧闭着——即使打开窗户也没用，外面的空气更加浑浊。这是一间大约只有三十平米的小屋子，屋子墙壁上泛黄的墙纸有好几处开始剥落，天花板上的水渍渗成奇怪的形状；一张老式的军绿色行军床摆在墙角，床腿用白漆写着编号；紧挨着行军床的是一张三合板制成的电脑桌，桌上摆着一台浅白色的电脑，机箱后面五颜六色的电线纠缠在一起，把它们自己打成一个古怪的死结，杂乱无章地蔓延到地板与墙角，仿佛常春藤一样。</p><p>阿瓦登走到电话前，慢慢坐到地板上，目光呆滞地盯着电话，手却没有动。这部古怪的东西是老式的按键式电话，大概是十几年前的款式，这是阿瓦登有一次去费城出差时偶尔在一家杂货店里买到的；他拿回家以后稍微修理了一下，发现居然还能用，这让他当时小小地兴奋了一阵子。</p><p>电话继续在响着，已经是第七声。阿瓦登意识到自己不得不去接听了。于是他弓下腰，用两个指头拈起电话，慢慢把电话放到耳边。</p><p>“请说出你的网络编号？”话筒里传来的声音并不急噪，事实上它也不带其他任何的感情色彩，因为这是电脑合成的人工智能语音系统。<br />“19842015”<br />阿瓦登熟练地报出一连串数字，同时开始觉得胸有些更闷了。说实话他并不喜欢这些空洞的电子声音。</p><p>他有时候想，假如打过电话来的是一位声音圆润的女性该多好。阿瓦登知道这是一种不切实际的幻想，不过这幻想会让他的身体得到几秒钟的舒缓。<br />话筒里的声音仍旧在继续着。<br />“关于你在十月四日提交的网络论坛用户注册申请已经被受理，经有关部门审查后确认资格无误，请在三日内持本人身份证件、网络使用许可证及相关文件前往办理登记手续，并领取用户名及密码。”<br />“知道了，谢谢。”<br />阿瓦登谨慎地选择词语，同时努力挤出一副满足的微笑，好象话筒的另一侧有人在看着自己一样。放下电话，阿瓦登先是茫然地盯着它看了大约两分钟，然后站起来活动一下手腕，坐回到电脑前面，缓慢地推动了一下鼠标。<br />电脑屏幕“啪”地一声亮了起来，显示出一个登陆的界面，还有一行英文：“请输入你的网络编号和姓名。”阿瓦登将那八位数字敲进去，又输入了自己的名字，点击“登陆”。随即机箱的指示灯开始频繁地闪动起来，整个机器发出细微的噪音。</p><p>每一个使用互联网的人都有一个网络编号，没有这个编号，就无法连接进互联网络。每一个编号都是独一无二的，每个人只有一个；这是使用者在网上的唯一代号，既不能修改，也不能取消。这些编号分别对应着使用者身份证上的名字，因此 <code>19842015</code> 就是阿瓦登，阿瓦登就是 <code>19842015</code>。阿瓦登知道有些记忆力不好的人会把自己的编号印在衣服的后面，那看起来颇为滑稽，也容易引发一些不正当的联想。</p><p>有关部门说使用网络实名制是为了规范网络秩序方便管理，杜绝因匿名使用网络而产生的一系列重大问题和混乱。阿瓦登不太清楚那一系列重大问题会是什么，他自己没试过用假名上网，他所认识的任何人里也不曾有人尝试过——事实上，从技术角度来说，他根本没办法匿名登陆互联网络，没有编号就没有权限上网，而编号则连接着他的详细档案，换句话说，没人能在网上隐藏自己。有关部门把这一切都考虑的很周详。<br />“有关部门”，这是一个语意模糊、但却有着权威与震慑力的词组。它既是泛指，又是确指，其所涵盖的意义相当广泛。有时候，它指的是为阿瓦登颁发网络编号的美国联邦网络管理委员会；有时候它是将最新通告及法规发到阿瓦登 EMAIL 信箱的服务器；还有时候它是监察网络的 FBI 特属网络调查科；总之一句话，有关部门是无处不在，无职不司的，总会在适当的时候出现，给予指导、监控或者警告，无论你是在网上还是网下。<br />简直就象是老大哥一样无微不至。</p><p>电脑仍旧在持续运转着，阿瓦登知道这得花上一阵子。这台电脑是有关部门配发给他的，具体型号和配置阿瓦登并不清楚，机箱是被焊死的，无法打开。于是他拿出一小瓶清凉油，用右手小拇指的指甲挑出一点抹在自己的太阳穴，然后从脚下堆积如山的杂物里翻出一个塑料杯子，从桌子旁的饮水机里接了半杯蒸馏水，就着一片镇痛片一饮而尽。蒸馏水穿过喉咙和狭长的食道滑进胃里，空泛的味道让他有些恶心。</p><p>音响里忽然传来一阵美国国歌的旋律，阿瓦登放下杯子，重新把目光投到电脑上去。这是已经连入互联网络的标志。屏幕上首先跳出来的是有关部门的通告，白底黑色四号字，里面陈述了使用互联网的意义以及最新的规章制度。<br />“缔造健康的互联网络，美国万岁！”<br />音响里传来激昂的男性呼声，阿瓦登不大情愿地跟着大声念了一遍。“缔造健康的互联网络，美国万岁！”</p><p>这段呼号持续了三十秒钟，然后消失，取而代之的是写着“缔造健康的互联网络”标语的桌面背景。另外一个窗口慢慢浮上开，上面开列出几个选项：工作、娱乐、电子信箱和 BBS 论坛。其中 BBS 选项呈现灰色，说明这项功能还没有开通。<br />整个操作系统简洁明了，这台电脑的浏览器没有地址输入栏，只是在收藏夹里有几个无法修改的的网站地址。理由很简单，这些网站都是健康向上的，假如其他站点和这些网站一样，那么只保留这些网站就够了；假如其他站点与这些网站不一样，那么就是不健康的，是低级趣味，不能保留。这是有关部门精心设计的，是为了公民的精神健康着想，生怕他们受到不良信息的侵染。</p><p>阿瓦登首先点开了“工作”，一连串和他工作相关的站点列表与相关软件在电脑上显示出来。阿瓦登是一名程序员，他每天的工作就是根据上级的要求编写程序。这份工作很无聊，不过可以保证他有稳定的收入。他不知道自己的源代码会被用到哪里去，上级也从来没有跟他说过。<br />他打算继续昨天的工作，但是很快发现自己很难继续下去。阿瓦登觉得今天的情绪比以前要烦躁，无法集中精神，大脑还是很呆滞，胸口仍旧发闷。他试图娱乐自己，但是他发现“娱乐”选项里只有纸牌与挖地雷，根据有关部门的说法，这是两个健康的游戏，没有暴力，没有色情，不会让人产生犯罪冲动，也不涉及任何政治色彩。据说美国境外也是有互联网络站点的，不过无法连上去，因为本国的互联网络自成格局，独立自主，普通人无法直接连接到国外——IE 浏览器没有地址栏，就算知道地址也没有用处。</p><p>“您有一封新邮件。”<br />系统忽然跳出来提示，阿瓦登终于找到了可以暂停工作的理由，他很快移动鼠标到电子信箱的选项上，点开，很快一个新的界面出现了。<br />“To: 19842015<br />From：10045687<br />Subject: 模块、已经、完成、当前、项目、是否、开始。”</p><p>阿瓦登微微地叹了一口气，觉得有些失望。每一次他收到新的电子邮件，都希望能够有一次新鲜的刺激来撞击他日益迟钝的脑神经，每一次他都失望了。其实他早就知道这一点，只不过他觉得保持期待至少能够享受到几秒钟快感。就好象他期待着打电话过来的是一个圆润温柔的女性声音一样。不给自己一些渺茫的希望，阿瓦登觉得自己迟早会疯掉的。</p><p>这封信很简短，但是内容很充实。<code>19842015</code> 是阿瓦登的网络编号，而 <code>10045687</code> 则是他的一位同事的编号，这种工作性质的信件通常都以编号相称。信的内容是几个不连续的英文单词，这是有关部门所提倡的一种电子邮件书写方式，因为这样可以方便软件检查信件中是否含有敏感词汇。<br />阿瓦登打开回信的页面，同时另开了一个窗口，打开一份名字叫做“网络健康语言词汇列表”的 TXT 文档。这是有关部门要求每一位网民所必须使用的词汇。当他们书写电子邮件或者使用论坛服务的时候，都得从这个词汇列表中寻找适合的名词、形容词、副词或者动词来表达自己想要说的话。一旦过滤软件发现网民使用了列表以外的词，那么这个词就会被自动屏蔽，取而代之的是“请使用健康语言”。<br />“屏蔽”是个专有名词，被屏蔽的词将不允许再度被使用，无论是在书信里还是口头都不允许。讽刺的是，“屏蔽”一词本身也是被屏蔽的词汇之一。<br />这个列表是经常更新的，每一次更新都会有几个词在列表上消失，于是阿瓦登不得不费劲脑汁寻找其他词语来代替那个被屏蔽掉的词语或者单字。比如在以前，“运动”这个词是可以使用的，但后来有关部门宣布这也是一个敏感词汇，阿瓦登只好使用“质点位移”来表达相同的意思。</p><p>他对照着这份列表，很快就完成了一封文字风格与来信差不多的 <code>EMAIL</code>——健康词汇表迫使人们不得不用最短的话来表达最多意思，而且要尽量减少不必要的修辞，所以这些信件就好象是那杯蒸馏水一样，淡而无味，阿瓦登有时候想，他早晚也会和这些水和信一样腐烂，因为这些信是他写的，水是他喝的。<br />接下来阿瓦登启动检查软件先扫了一遍，确保自己没无意中加入什么敏感词汇。等这一切都完成后，他按下了发送键，邮件被送出去了。<br />阿瓦登没有留下备份，因为他的机器里没有硬盘，也没有软驱、光驱或者 USB 接口。这个时代宽带技术已经得到了很大发展，应用软件可以集中在统一的一个服务器中，个人用户调用时的速度丝毫不会觉得迟滞。因此个人不需要硬盘，也不需要本地存储，他们在自己电脑里写的每一份文档、每一段程序、甚至每一个动作都会被自动传送到有关部门的公共服务器中，这样便于管理。换句话说，阿瓦登所使用的电脑，仅仅具备输入和输出两种功能。<br />完成了这封信后，阿瓦登再度陷入了软绵绵的焦躁状态，这是一个连续工作了三天的程序员的正常反应。这种情绪很危险，因为它让人效率低下精神低迷，而且没有渠道发泄。“疲劳”、“烦躁”以及其他负面词汇都属于危险词汇，如果他写信给别人抱怨的话，那么对方收到的将会是一封写满“请使用健康语言”的 <code>EMAIL</code>。</p><p>这就是阿瓦登每天的生活，今天比昨天更糟糕，但应该比明天还稍微好一点。事实上这个叙述也很模糊，因为阿瓦登自己并不清楚什么是“好一点”，什么是“更糟糕”。“好”与“坏”是两个变量，而他的生活就是一个定量，只有一个常数叫“压抑”。<br />阿瓦登推开鼠标，把脑袋向后仰去，长长地呼了一口气。（至少“呼”这个字还没有被屏蔽）这是空虚的表现，他想哼些歌，但却又不记得什么，转而吹了几下口哨，但那听起来与一只生了肺结核的狗差不多，只得做罢。有关部门象幽灵一样充斥在整个房间里，让他无法舒展自己的烦闷。就好象一个人在泥沼里挣扎，刚一张口就被灌入泥水，甚至无法大声呼救。<br />他的头不安分地转了几转，眼神偶尔撇到了摆在地板上的老式电话机，他忽然想到还必须要去有关部门申请自己的 BBS 论坛浏览许可证。于是他关掉“工作”和“电子邮件”窗口，退出了网络登陆。阿瓦登在做这些事的时候毫不犹豫，他很高兴能够暂时摆脱互联网络，在那上面他只是一串枯燥的数字和一些“健康词汇”的综合体。<br />阿瓦登找出一件破旧的黑色呢子大衣，那件大衣继承自他的父亲，袖口和领子已经磨损的很严重，个别地方有灰色的棉花露出来，但还是很耐寒。他把大衣套到身上，戴上一副墨绿色的护镜，用过滤口罩捂住嘴。他犹豫了一下，拿起“旁听者”别在耳朵上，然后走出家门去。</p><p>纽约的街上人很少，在这个时代，互联网的普及率相当地高，大部分事务在网上就可以解决，有关部门并不提倡太多的户外活动。太多的户外活动会导致和其他人发生物理接触，而两个人发生物理接触后会发生什么事则很难控制。<br />“旁听者”就是为了防止这种事而发生的，这是一种便携式的语言过滤器，当携带者说出敏感词汇的时候，它就会自动发出警报。每一位公民外出前都必须要携带这个装置，以便随时检讨自己的言语。当人们意识到旁听者存在的时候，他们往往会选择沉默，至少阿瓦登是如此。有关部门正逐步试图让网络和现实生活统一起来，一起“健康”。<br />这时候正是 11 月份，寒风凛冽，天空漂浮着令人压抑的铅灰阴云，街道两旁的电线杆仿佛落光了叶子的枯树，行人们都把自己包裹在黑色或灰色的大衣里面，浓缩成空旷街道上的一个个黑点飞快移动着。一层若有若无的烟雾将整个纽约笼罩起来，不用过滤口罩在这样的空气里呼吸将会是一件很有挑战的事情。<br />距离上一次离开家门已经有两个月了吧，阿瓦登站在公共汽车站的站牌下，不无感慨地想，周围的一切看起来很陌生，泛黄，而且干燥。那是上一次沙尘暴的痕迹。不过沙尘暴这个词也已经被屏蔽了，因此阿瓦登的脑海里只是闪过那么一下，思想很快就转移到别的事情上去了。</p><p>站在阿瓦登旁边的是一个穿着蓝色制服的高个男人。他先是狐疑地看了阿瓦登一眼，看到后者沉默地沉在黑色大衣里，他的两只脚交替移动，缓慢地凑了过去，装做漫不经心对阿瓦登说：<br />“烟，有吗？”<br />男人说，每一个字都说的很清晰，而且词与词之间间隔也足够长。这“旁听者”还没有精密到能够完全捕捉到每一个人语速和语调的程度，因此有关部门要求每一位公民都要保持这种说话风格，以方面检测发言人是否使用了规定以外的词汇。<br />阿瓦登转过头去，看了他一眼，舔舔自己干裂的嘴唇，回答说：<br />“没有。”<br />男人很失望，又一次不甘心地张开嘴。<br />“酒，有吗？”<br />“没有。”<br />阿瓦登又重复了一次这个词，他也已经很久没有收到烟和酒了，也许是缺货的关系吧，这是常有的事。不过有一点很奇怪，“旁观者”这一次却没有发出警报。以阿瓦登的经验，以往一旦烟、酒或者其他生活必需品发生短缺现象，这个词就会暂时成为被屏蔽掉的敏感词汇，直到恢复供给为止。<br />这个男人看起来很疲惫，红肿的眼睛是这个时代的人们普遍的特征，这是长时间挂在网上的关系。他的头发蓬乱，嘴边还留着青色的胡子碴，制服下的衬衣领口散发着刺鼻的霉味。能看的出，他也很久不曾到街上来了。</p><p>阿瓦登这时候才注意到，他的耳朵上空荡荡的，没有挂着那个银灰色的小玩意“旁听者”，这实在是一件严重的事情。不携带“旁听者”外出，就意味着语言不会再被过滤，一些不健康的思想和言论就有可能孳生，因此有关部门相当严厉地规定公民上街必须携带旁听者。而这个男人的耳朵旁却什么也没有。阿瓦登暗暗吃惊，一时间不知道是该去提醒还是装做没看到。他暗自想，也许向有关部门举报会更好。<br />这时候那个男人又朝他靠近了一点，眼神变的饥渴起来。阿瓦登心里一阵紧张，下意识地向后退去。这难道是一次抢劫？还是说他是个压抑太久的同性恋者？那个男人忽然扯住他的袖子，阿瓦登狼狈地挣扎却没有挣开。出乎他的意料，那个男人并没有进一步的动作，而是大吼一声，用一种阿瓦登已经不太习惯了的飞快语速向他倾泻起话语来。阿瓦登被这突如其来的爆发弄的莫名其妙，不知所措。</p><p>“我只是想和你多几句话，就几句，我很久没有说过话了。我叫斯多葛，今年三十二岁，记得，是三十二岁。我一直梦想有一套在湖边的房子，有一副钓鱼竿和一条小艇；我讨厌网络，打倒网管；我妻子是个可恶的网络中毒者，她只会用枯燥乏味的话叫我的网络编号；这个城市就是一个大疯人院，里面大疯子管着小疯子，并且把所有没疯的人变的和他们同样疯狂；敏感词汇都去他 X 的，老 * 受够了……”<br />男人的话仿佛一瓶摇晃了很久然后突然打开的罐装碳酸饮料，迅猛，爆裂，而且全无条理。阿瓦登惊愕地望着这个突然狂躁起来的家伙，却不知道如何应对；更可怕的是，他发现自己居然对他产生了一点同情，那种“同病相怜”式的同情。男人的话这时候已经从唠叨变成了纯粹谩骂，全部都是最直抒胸臆的那种。阿瓦登已经有五、六年不曾说过这些脏话，最后一次听到这些也是四年前。有关部门认为这都有碍精神文明，于是全部都屏蔽掉了。<br />而现在这个男人就在公众场合对着他大吵大嚷，似乎要将被屏蔽掉的敏感词汇一口气全倒出来。他的目光和手势并不针对任何人，甚至也不针对阿瓦登，更象是在一个人在自说自话。阿瓦登的耳膜似乎不习惯这种分贝，开始有些隐隐做痛，他捂着耳朵，拿不定主意是干脆逃掉还是……这时候，远处街道出现两辆警车，一路闪着警灯直直冲着这座公共汽车站而来。<br />警车开到站台旁时，男人仍旧在痛骂着。警车门开了，涌出了五、六名全副武装的联邦警察。他们扑过去将那个男子按在地上，用橡皮棍痛打。男人两条腿挣扎着，嘴里的语速更快了，骂出来的话也越来越难听。其中一名警察掏出一卷胶带，“嚓”地一声扯下一条向男人的嘴贴去。男人在嘴被胶带封住之前，突然提高嗓门，冲着警察痛快无比地喊了一句：“FUXKYOU, YOUSONOFBITCH！”阿瓦登看到他的表情由疯狂变成享受，面带着微笑，似乎完全陶醉在那一句话所带来的无上快感和解脱感中。</p><p>联邦警察们七手八脚地将男人送进了警车，这时才有一名警察走到了阿瓦登的跟前。<br />“他，是，你朋友？”<br />“我，不，认识。”<br />警察盯了他一阵，取下他耳朵上的“旁观者”查看记录，发现他并没有提及任何敏感词汇，于是重新给他戴回去，警告他说那名男子说的全部都是极度反动的词汇，要求他立刻忘掉，然后转身押着那男子离开了。<br />阿瓦登松了一口气，其实刚才他有一瞬间涌现出一种冲动，也想在这空旷的街道上大喊一声“FUXKYOU, YOUSONOFBITCH”那一定很爽快，他心里想，因为那男子说出这句话的时候表情很享受。不过他也知道，这也是妄想的一种，“旁观者”紧帖在耳朵上的冰凉感觉时刻提醒着他。</p><p>街上很快就恢复了冷清，十分钟后，一辆公共汽车慢吞吞地开进站里，锈迹斑斑的车门哗啦一声打开，一个电子女声响彻整个空荡荡的车厢：“请乘客注意文明用语，严格按照健康词汇发言。”<br />阿瓦登把自己缩进大衣，压抑住自己异样的兴奋，决定继续保持沉默下去。<br />大约过了一个小时，公共汽车到了目的地。从破碎的车窗玻璃里吹进来的寒风让阿瓦登脸上挂起一层暗灰色的霜气，面部被风中的沙砾和煤渣刮的生疼。他听到电子女声报出了站名，就站起身来，象一条狗一样抖抖身上的土，走下车去。</p><p>车站对面就是阿瓦登要去的地方，那是有关部门负责受理 BBS 论坛申请的网络部。这是一间五层的大楼，正方形，全水泥混凝土结构，外表泛灰。如果没有那几个窗户的话，那么它的外貌将与水泥块没有任何区别：生硬、死气沉沉，让蚊子和蝙蝠都退避三舍。<br />BBS 论坛是一种奇特的东西，从理论上来讲它完全多余，BBS 的功能完全可以由 EMAIL 新闻组来取代，后者更容易管理和审查。而且申请使用 BBS 论坛资格不是件容易的事，申请人必须要通过十几道手续和漫长的审查才能有浏览资格，浏览资格三个月才会被允许在指定论坛发布帖子，至于自己开设 BBS 则几乎是不可能。<br />因此真正对 BBS 有兴趣的人少之有少。阿瓦登当初之所以决定申请 BBS 论坛资格，纯粹是因为他那种模糊但却顽强的怀旧心态，就好象他从杂货店里买的那部老式电话一样。他也不知道自己为什么会自找麻烦，也许是为了给生活带来些刺激，还是说为了强调自己和曾经旧时代的那么一点点联系，也许两者兼有之。<br />阿瓦登恍惚记得在他小的时候，互联网与现在并不太一样。并不是指技术上的不同，而是一种人文的感觉。他希望能通过使用 BBS 论坛回想起一些当年的事情。</p><p>阿瓦登走进网络部的大楼，大楼里和外面一样寒冷，而且阴森。走廊里没有路灯，蓝白色调的两侧墙壁贴满了千篇一律的网络规章条文与标语，冰冷的空气呼吸到肺里，让阿瓦登一阵痉挛。只有走廊尽头的小门缝隙里流泻出一丝光亮，小门的上面挂着一块牌子，上面写的是“网络部 BBS 论坛科。”<br />一走进这间屋子，阿瓦登立刻感觉到一阵温洋洋的热气。屋子里的暖气（或者是空调）开的很大，让阿瓦登冻麻了的手脚和脸麻酥酥的，有些发痒，他不禁想伸出手去挠挠。</p><p>“公民，请您站在原地不要动。”<br />一个电子女声忽然从天花板上的喇叭里传来，阿瓦登触电似地把手放下，恭敬地站在原地不同。他借这个机会观察了一下这间屋子。这屋子准确来说应该是一个狭长形的大厅，一道拔地而起的大理石柜台象长城一样将房间割裂成两部分，柜台上还装着一排银白色的圆柱形栅栏，直接连到天花板。屋子里没有任何装饰，没有观赏植物，没有塑料鲜花，甚至没有长椅和饮水机。<br />“缔造健康的互联网络，美国万岁。”<br />阿瓦登跟着声音重复了一遍。<br />“请前往八号窗口。”<br />电子女声的语调很流畅，因为这是电脑制作出来的，因此没有敏感词汇的限制。</p><p>阿瓦登转头看到在自己右手边的不远处，大理石柜台上的液晶屏幕显示着八号的字样。他走过去，拼命抬起头，因为柜台实在太高了，他只能勉强看到边缘，而无法看到柜台另一侧的情形。不过他能听到，一个人走到柜台对面，坐下去，并有翻动纸张与敲击键盘的声音。<br />“请把文件放入盒子里。”<br />柜台上的喇叭传来命令。出乎意料，这一次在喇叭里的声音却变了。虽然同样冷漠枯燥，但阿瓦登还是能分辨出它与电子女声的不同——这是一个真正的女性的声音。他惊讶地抬头望去，却什么都看不到，柜台太高了。<br />“请把文件放入盒子里。”<br />声音又重复了一次，语气里带着一丝烦躁，似乎对阿瓦登的迟钝很不满。<br />“是的，这是真正的女声……”阿瓦登想，电子女声永远是彬彬有礼不带任何感情色彩的。他把相关的电子身份证、网络许可证、网络编号和敏感词汇犯罪记录等一系列个人资料卡片一起放进柜台外的一个小金属盒子里，然后把盒子插进柜台上一个同样大小的凹槽中，关好门。<br />很快他听到“唰”的一声，他猜测这也许是对面的人——也许是个女人——将盒子抽出去的声音。</p><p>“你申请 BBS 服务的目的是什么？”<br />喇叭后的女声浸满了纯粹事务性的腔调。<br />“为了、提高、互联网络、工作效率、为了、缔造、一个、健康、的网络、环境，更好地、为、祖国、做出、贡献。”<br />阿瓦登一字一句地回答，心里知道这只是一道官方程序，只需要按标准回答就可以。<br />对面很快就陷入沉默，大约过了十五分钟，喇叭再度响起。<br />“最后手续确认，你已经获得 BBS 论坛浏览权。”<br />“谢谢。”<br />“砰”的一声，金属盒子从柜子里弹了出来，里面除了阿瓦登的证件以外还多了五张小尺寸光盘。<br />“这是有关部门核发给你的 BBS 论坛统一用户名与密码，BBS 论坛列表、互联网 BBS 论坛使用指南及相应法规、以及最新健康网络词汇列表。”<br />阿瓦登向前踏了一步，从盒子里将这些东西一股脑全拿出来，揣进大衣的大兜里。那些东西其实是可以全部放在同一张光盘里的，不过有关部门认为每一张光盘装一份文件有助于用户理解这些文件的严肃性和重要性，并产生敬畏。<br />他心里盼望着那个喇叭能再说两句。让他失望的是，对面传来的是一个人起身并且离开的声音，从脚步声的韵律判断，阿瓦登愈发相信这是一名女性。<br />“手续办理完毕，请离开网络部回到自己的工作岗位上。”</p><p>甜美空洞的电子女声从天花板上传来，阿瓦登厌恶地抽动鼻翼，拿手揉了揉，转身离开这间温暖的大厅，重新进入到寒冷的走廊。<br />在回家的路上，阿瓦登蜷缩在公共汽车上一动不动，顺利申请到 BBS 的使用权让他有些虚无缥缈的兴奋。他闭着眼睛，找了一个合适的角度躲开破窗而入的寒风，右手在兜里不断摩挲那一系列光盘，还在怀念着那一个神秘的女声。<br />如果能再一次听到该多好，他不能抑制自己这样的想法，同时用拇指的指肚在光盘上轻轻地摩擦，幻想这几张光盘也曾经被她的手触摸过。他兴奋的几乎也想破口大骂一句“FUXKYOU, YOUSONOFBITCH”，真奇怪，那名男子的骂声在他的记忆里根深蒂固，并时不时不自觉地滑到唇边。<br />忽然，他的手指在光盘上发觉到一丝异常的感觉。阿瓦登下意识地朝四周望去，确认周围一个乘客也没有后，他小心翼翼地把光盘全拿出来，就着窗外的光亮仔细端详。<br />阿瓦登很快注意到，在装有 BBS 论坛列表的光盘背面，被人用指甲轻轻地划了一道刮痕。这条刮痕很轻，如果不是阿瓦登仔细地抚摩光盘的话，是很难发觉到的。这条刮痕很奇特，是一条直线，而在这条直线末端的不远处，则是另外一条极短的刮痕，似乎刻意想弯成一个圆点。整体看上去就好象是一个叹号，或者倒过来说，象是字母 i。<br />很快他在其他四张光盘上也发现了类似的刮痕，它们造型都不同，但都似乎代表着某种符号。阿瓦登回想起喇叭里那个女声最后一句提到过的文件顺序，于是把这五张光盘按照 BBS 论坛统一用户名与密码、BBS 论坛列表、互联网 BBS 论坛使用指南、相应法规、以及最新健康网络词汇列表的顺序排列好，接着依次把那五道刮痕用手指临摹到汽车窗户上。很快那些刮痕构成了一个英文单词：<code>title</code></p><p>题目？这是什么意思？<br />阿瓦登看着这个单词莫名其妙，这究竟是纯属无意的痕迹，还是有人刻意为之？如果是有人刻意为之，他这么做的用意是什么？<br />这时候汽车停住了，又有几名乘客走上车来。阿瓦登挪动一下身体，不让他们看到自己在车窗上写出来的字迹，然后装做打呵欠的样子抬起袖子，轻轻把那五个字母擦掉。<br />阿瓦登暗自庆幸，如果他没有在现在发现这些光盘上的痕迹，那么以后就永远没有机会发觉了。按照规定，个人电脑是不允许使用任何存储存设备的，因此阿瓦登的电脑并没有光驱。他下一步所要做的是将这些光盘送交到管区网络安全部，由他们将光盘内资料登陆到服务器中，再转发给阿瓦登。这是为了防止个人私自在家里制造、阅读或者传播黄色或者反动信息，网络安全部发出的通告是这么解释的。联邦的网络警察经常会突入到个人家中进行临时检查，看用户是否非法拥有信息贮存设备，阿瓦登曾经亲眼见过一个邻居被警察带走，原因仅仅是因为他私自藏了一张光盘在家里——其实他只是打算拿那个当茶杯垫用。那个邻居再没回来过。<br />无论这些符号代表的是什么意思，它都是一种全新的体验，这让阿瓦登感觉到兴奋。怀旧与渴望新奇是阿瓦登生活在这个时代的两根精神支柱，否则他会与这座城市一样变的僵硬，然后窒息而死。<br />他先来到网络安全分部，将光盘交给那里的负责人，负责人反复地检查光盘和阿瓦登的表情，好象所有使用 BBS 论坛的人都不可信赖一样。末了负责人终于找不到什么破绽，只得将光盘收下，然后举起右手，阿瓦登和他一起高呼“缔造健康的互联网络”。这句话是唯一被允许可以连贯着被说出来的句子。</p><p>回到家里，阿瓦登脱掉大衣，摘了过滤口罩，将旁观者扔到了行军床上，然后整个人也倒进枕头里。每次出去外面都会让他疲劳，这一半是因为他孱弱的肉体已经不大适合室外活动；另外一半原因是因为他必须花费大量的精力来应付旁观者。<br />过了四十分钟，他才悠悠地醒过来，头还是和平常一样地疼，胸口还是一如既往地闷。胡乱吃了一点东西以后，阿瓦登爬到电脑桌前，打开电脑，按程序登陆上网络，习惯性地先检查了一遍信箱。<br />信箱里有七、八封新的信件，其中两封是同事发来的事务信。另外五封则是网络安全部发给他的，内容就是他送交的那几张光盘。<br />阿瓦登打开了包含有 BBS 论坛的用户名、密码和 BBS 论坛列表的两封信。他看到自己的论坛通用用户名叫做 <code>19842015</code>，和自己的网络编号完全一样，不由得有些失望。他依稀记得在小的时候，BBS 论坛的用户名是可以自己决定的，而且每一个论坛都可以不同，一个人在网上并不单只是一串枯燥数字。<br />小时候的记忆往往是跟童话和幻想混杂在一起，未必与实际相符。现实中你只能使用有关部门指定的用户名和密码，理由很简单，用户名和密码内也可能含有敏感词汇。</p><p>阿瓦登又打开了那份 BBS 列表，全部都是有关部门开设的官方论坛，没有私人的——事实上个人能够合法持有的电脑设备从技术上来说也无法架设新 BBS——这些论坛的主题各有侧重点不同，但基本上是围绕着如何更好响应国家号召，缔造健康互联网络来说的。比如其中一个电脑技术论坛，主题就是如何更好地屏蔽掉敏感词汇。<br />居然在这些论坛中还有一个是关于游戏的。里面正在讨论的是一个如何帮助别人使用健康词汇的网络游戏，玩家可以操纵一名小男孩在街上侦察，看是否有人使用了敏感词汇，小男孩可以选择上前指责或者通知警察，抓到的人越多，小男孩得到的褒奖就越高。<br />阿瓦登随便打开了几个论坛，里面的人都彬彬有礼，说话很“健康”，就好象街上的那些行人一样。不，准确地说，比街上的气氛还要压抑。在街上的人也许还有机会保留一下自己的小动作，比如阿瓦登刚才在公共汽车上就偷偷地写了 TITLE 五个字母；而在网上论坛，人的最后的一点隐私也全被暴露出来，有关部门随时可以调看你的一切行动，无从遁形，这就是科学技术发展所带来的进步。</p><p>一阵失落和失望袭上阿瓦登的心头，他合上眼睛，把鼠标甩开，重重地向后靠去。原来他天真地以为 BBS 论坛也许会少许宽松一些，现在看来甚至比现实中更叫人窒息，他感觉到自己好象陷入沉滞的电子淤泥之中，艰于呼吸。“FUXKYOU,YOUSONOFBITCH”再一次涌现到他的唇边，强烈无比，要化好大的力气才控制住。<br />忽然，他又想到了那个神秘的 <code>title</code>，那究竟是什么意思？那五张光盘里或许隐藏着什么？也许这跟 <code>title</code> 有关系？<br />阿瓦登想到这里，把目光重新转向电脑屏幕，仔细去看网络安全部发来的五封信的 <code>title</code> 部分。五张光盘各隐藏着一个字母，凑到一起就是 <code>title</code>，那么按照这个方式，那五封 EMAIL 的 <code>title</code> 凑到一起，就变成了一句话：去用户学习论坛。”<br />阿瓦登记得刚才他确实看到其中一个论坛的名字叫做“用户学习”，于是他抱着姑且一试的心态连接到这个论坛去。他希望这并不是一个巧合。</p><p>用户论坛是一个事务性论坛，里面是一些关于 BBS 用户资料的投诉帖和管理帖，斑竹的是一个叫 <code>19387465</code> 的人；发帖的人和回帖的人数量都很少，里面冷冷清清的。阿瓦登打开帖子列表，按照刚才的规律去搜寻每一个帖子的标题，并把它们综合到一起，很快他就得到了另外一句话：</p><p>“每周日辛普森大楼 5 层 B 户。”</p><p>又是一个谜团，阿瓦登想。但这却坚定了他的信心，这其中必定隐藏着玄机。光盘、EMAIL 和 BBS 论坛，连续三次都可以通过首词组组合的方式得到暗示，绝非巧合。<br />究竟是什么人会在有关部门的官方文件中隐藏着这样的信息呢？每周日在效率大楼 5 层 B 户又会发生什么事情呢？<br />阿瓦登终于找到了久违的兴奋感，未知事物的新奇刺激着他麻木很久的神经。更重要的是，这种在有关部门正式文件中玩弄的文字技巧，叫他有一种喘息的快感，仿佛一个密不透风的铁面罩上几个透进空气的小孔。</p><p>营造健康的互联网络。<br />FUXKYOU, YOUSONOFBITCH。<br />阿瓦登盯着屏幕上的桌面背景，用嘴唇比出了那句粗话的口型，并且比出了中指。</p><p>在接下来的日子里，阿瓦登一直处于一种潜藏的兴奋状态，就象是一个摆出无辜表情嘴里却藏着糖果的小孩子，在大人转身过去之后露出狡黠的笑容，尽情享受心中藏有秘密的乐趣。<br />日子一天一天地过去，健康词汇在列表里又少了几个，窗外的空气又浑浊了几分，这已经是生活的常态。阿瓦登自己已经开始拿网络健康词汇表当日历来用，划掉三个词就证明过了三天，划掉七个就证明过了一周，于是周日终于到来了。<br />阿瓦登抵达辛普森大楼的时间是中午，暗示的句子里并没有指明时间，阿瓦登认为在中午前往应该是比较可以接受的。当穿着深绿军大衣，耳朵上别着旁观者的阿瓦登来到辛普森大楼的入口时，他的心开始忐忑不安地跳跃起来。他在上一星期设想了无数种可能发生的情景，而现在这个谜底就要揭晓了。无论在周日效率大楼会发生什么，也不会比现在的生活更加糟糕，阿瓦登心里想，所以他并不怎么害怕。</p><p>他走进大楼内部，发现这里的人也很少，空旷的走廊里只听到他哒哒的脚步声与回音。一部老电梯里贴着“缔造美好网络家园”的广告，以及一个充满了正义感的男性头像海报，背景是星条旗，他在纸里用右手食指指向观看者，头上写着一行字是“公民，请使用健康词汇。”阿瓦登厌恶地转过身去，发现另外一侧也贴着同样的海报，避无可避。<br />值得庆幸的是五楼很快就到了，电梯的门一开，对面的门上就赫然挂着 B 户的牌子。门是掉了漆的绿色，门框上还点了几滴墨水，一部简易的电子门铃挂在右上角。</p><p>阿瓦登深深吸了一口气，伸手去按电纽。<br />电铃响起，很快屋子里传来脚步声。阿瓦登觉得这脚步的韵律很熟悉，似乎是在哪里见到过。门“咔拉”一声被打开一半，一名年轻女子一手握着把手，把身体前倾望着阿瓦登，警惕地说：<br />“你，找谁？”<br />女子疑惑地问道。阿瓦登一下子就认出了她的声音，就是那个在网络部 BBS 论坛科柜台后面的女性。她很漂亮，穿着墨绿色绒线衫，头上梳着这时代流行的短发，皮肤特别的白，只有嘴唇能看到一些血色。<br />看着女子的眼神，一瞬间阿瓦登不知道该说什么好，犹豫了一下，他举起右手，轻声回答说：“title。”<br />阿瓦登不知道这句话能否奏效，也不知道自己是否真的找对了地方，但这是他唯一能想到的回答了。他紧张地望着那女子，假如那女子忽然报警，那么自己就会被抓起来仔细审问为什么无缘无故跑到陌生人家里。“肆意游走罪”只比“使用敏感词汇罪”轻那么一点。<br />女子听到他这么说，脸上还是毫无表情，只是把头幅度很轻微地点了一下，右手谨慎地做了一个“进来”的手势。阿瓦登刚要张口，那女子严厉地瞪了他一眼，吓的他把话又吞回去了，乖乖地跟着她进了屋子。</p><p>一进屋子，女子首先做的就是把门关好，然后拉起来一层铅灰色的门帘挡在门口。阿瓦登不安地眨着眼睛，趁她拉门帘的时候环顾四周。这屋子是标准的两室一厅，在厅里摆放的是一套双人沙发与一个茶几，茶几上居然还有几束红紫色的塑料花。靠墙是电脑桌和电脑，墙上挂着普通的白色日历，<br />但被主人用粉红色的纸套了边，看起来颇为温馨。一盏粗笨的日光灯从天花板上垂下来，上面象是恶作剧一样挂了几缕绿色的电线，象是垂下藤蔓的葡萄架。阿瓦登注意到厅口的鞋架上有四双鞋，尺码不同，说明今天的客人并不只他一个。<br />阿瓦登正踌躇不安，忽然女子从背后拍了拍他的肩膀，示意他朝里面走。于是两个人穿过客厅另一侧的短小回廊来到其中一间卧室。卧室上挂着同样质地的铅灰色帘子，女子伸手举起帘布，推开了门。阿瓦登迈了进去，首先映入眼帘的是三名面带微笑的人类，以及一间用真正的鲜花装点的房间。屋子里有很多旧日记忆里的古老物品，比如一幅印象派的油画、一尊乌干达木雕，甚至还有一个银烛台，唯独没有电脑。<br />他正在迟疑，女子也进了屋子。她谨慎地拉好门帘关上门，将耳边的旁观者取下，回过身来对阿瓦登用曼妙的声音说道：<br />“欢迎加入说话会！”<br />“说话会？”<br />出于习惯，阿瓦登并没有把这三个字说出口，因为他不确定是否“健康”，只是用眼神表示自己的疑惑。<br />“在这里你可以随便说话，这个该死的东西不会起作用的。”女子把自己的旁观者晃了晃，那个小东西象死掉了一样，对女子句子里两个敏感词汇“随便”和“该死”充耳不闻。</p><p>阿瓦登一下子想到上星期在公共汽车站前碰到的男子，如果他摘下旁观者，会不会也会落到同一境地呢？那女子见他犹豫不决，指了指门口的铅灰色门帘说：“放心好了，这里是可以屏蔽掉旁观者信号的，不会有人觉察到。”<br />“你们，是什么，人，这，是，哪里？”<br />阿瓦登一边摘下耳朵上的旁观者，一边小声说道，语调还是改不了那种有关部门规定的说话方式。<br />“这里是说话会，是一个完全自由场所，在这里你可以畅所欲言，请不要拘束。”<br />另外一个人起身对他说道，这是一名瘦高的中年男子，鼻梁上的眼镜非常地厚。<br />阿瓦登嗫嚅着，却找不到发音的焦点，在四个人的注视下显得窘迫不堪，脸都要红起来。女子同情地看了他一眼：“可怜的家伙，不用太紧张，每一个刚到这里的人都是这样。慢慢就习惯了。”<br />她把手搭到阿瓦登的肩上：“我们其实见过的，当然，我见过你，而你没见过我。”她一边说，一边将自己的头发解下来，原来她留的是一头齐肩的乌黑长发，头发披下来的一瞬间阿瓦登觉得她真的很美。<br />“我……我记得你，记得你的声音。”阿瓦登终于说出了一句完整的话，虽然不够流畅。<br />“是吗，那可太好了。”女子笑起来，拉着他的手，让他坐到沙发上，递给他一杯水。阿瓦登注意到这是一个款式古老的茶杯，上面还刻着花纹，杯子里的水带着浓郁的香气，阿瓦登尝了一点，那种甜丝丝的味道对喝惯纯净水的舌头来说刺激格外地大。让他觉得浑身一下子被注进了许多活力。<br />“弄到这个可不容易，我们也不是每周都能喝到。”女子坐到他身边，两只乌黑的眼睛注视着他，“你是怎么知道这个集会的？”<br />阿瓦登把发现光盘暗示的过程说了一遍，其他四个人都赞许地点了点头。“果然是个聪明人，脑筋还没被陈腐的空气腐蚀掉。”一个三十多岁的胖子称赞道，他的嗓门大的要命。那个戴眼镜的中年人把两只手交叉在一起，表示赞同。<br />“这正是天生的说话会成员，聪明、敏锐，而且不甘屈从于沉默。”<br />“那么。”胖子提议，“先让我们鼓掌欢迎说话会的新成员吧。”<br />于是四个人鼓起掌来，小小的屋子里响起一片掌声。阿瓦登羞涩地举起杯子做回应，他还不太习惯这样的场面。等到掌声稍息，他抬起头怯生生地问道：<br />“可以问个问题吗？说话会到底是什么？”</p><p>带他进屋的女子伸出食指，在他鼻子前两公分的地方比了一比，解释道：<br />“说话会，就是可以畅所欲言的集会。在这里你不必顾忌什么，说出任何你想说的东西。这里没有敏感词汇，也没有健康互联网络。这里是绝对自由的空间，你可以尽情释放你的灵魂，舒展你的身体，没有任何禁锢与束缚。”说着说着，她的声音变的高亢、奔放，里面饱含了许多早已经被屏蔽掉的词汇，阿瓦登不曾听到这样流畅连贯的话语很久了。<br />“我们的宗旨就是，说话，就这么简单。”中年人扶扶眼镜，补充道。<br />“可是，要说些什么呢？”阿瓦登又问道。<br />“任何事情，你心里想的任何事情都可以说出来。”中年人露出宽和的笑容，“尤其是那些被美国政府限制的思想。”<br />这可真是一个大胆的集会啊，这分明就是犯罪，阿瓦登心想，但他发觉自己却被这种犯罪慢慢地吸引住了。<br />“当然，有件事我们会事先说明。说话会是危险的，每一个成员都冒着被有关部门拘捕的风险。联邦执法人员也随时可能破门而入，以非法集会以及非法使用不合法词语的名义把我们抓起来。你现在有权拒绝加入，并且离开。”<br />阿瓦登听到女子的警告，心里一度犹豫起来。但一想到此刻离去的话，那么又要开始持续那种窒息的泥沼生活，他就难以压抑自己的烦闷。阿瓦登第一次发现，原来“说话”对他来说是一个致命的诱惑，他先前并不知道自己原来是如此地渴望着说话。<br />“我不会离开的，我要加入你们，说话。”<br />“那太好了。唔，那么不妨就从自我介绍开始吧。”女子高兴地说，同时站起身来，把右手搭到胸前，“从我开始。我的名字叫阿尔特弥斯，至于网络编号和身份证号码，让他们见鬼去吧！谁会去管那个！我有我自己的名字，我不是数字。”</p><p>她的话让所有人包括阿瓦登都笑了起来。接着她继续说道：“不过，这其实只是一个假名，这是希腊神话里的女神。”<br />“假名？”<br />“是的，和我户籍本上的名字是不同的。”<br />“可是，为什么？”<br />“你不会对自己在档案里的名字厌倦吗？我想起一个自己喜欢的名字，哪怕只有一次机会也好，自己想叫什么就叫什么。在这个说话会里的每一个人都有一个自己喜欢的名字，我们彼此拿这个称呼。”<br />阿瓦登若有所思地点点头，他很理解阿尔特弥斯的想法。事实上当他在使用网络论坛的时候，也希望能够自己取一个称心如意的名字，而不是被分配一个用户名。<br />通过介绍，阿瓦登了解到阿尔特弥斯是网络部 BBS 论坛管理科的职员，今年 23 岁，未婚，最讨厌蟑螂和蜘蛛，喜欢缝纫与园艺，屋子里的花就是她偷偷从城市边缘摘回来的。</p><p>接下来是那名中年人，他自我介绍说名字叫兰斯洛特，41 岁，是城市电厂的一名工程师；兰斯洛特这名字出自英国的亚瑟王传说，是一名忠贞的骑士。他有自己的老婆和两个孩子，一男一女；男孩三岁，女孩四岁，他们最喜欢吃的就是柠檬味道的水果糖。说到这里，兰斯洛特说希望下次聚会能把他们也带了，孩子们正是学说话的时候，他想教给他们真正的说话。<br />那个三十多岁的胖子是网络部的一名网管，叫瓦格纳。这个身份让阿瓦登吃惊不已，他的印象里网管都是些绷着脸全无表情的冷漠生物，但眼前的瓦格纳脸圆滚滚的，油光锃亮，嘴边两条翘起的小胡子神气十足。他喜欢的是雪茄和歌剧，利用网管的特权这两样东西都不难弄到。<br />“这个能屏蔽掉信号的门帘就是他弄的。”阿尔特弥斯补充说，瓦格纳冲她做了个“乐意为您效劳”的手势，然后点燃了雪茄，把它放到嘴里，很快屋子里就笼罩起一片稀薄的烟雾。<br />说话会的第四名成员是一位穿着黑色制服的女性，今年刚满三十。她的名字是杜拉丝，城市日报（那个时代的报纸已经全部都数字化了）的编辑，她比阿尔特弥斯还瘦，颧骨高高耸起，眼窝身陷，两片薄薄的嘴唇即使在最说话的时候也很少分开，看不到牙齿。爱好是饲养狗和猫，尽管她并没有养。<br />“那么，到你了。”阿尔特弥斯对阿瓦登说。阿瓦登想了想，结结巴巴地把自己的情况说了一遍，当谈到自己的爱好时候，他一时间居然想不到自己喜好什么，似乎什么都没有，在那之前他甚至从来没想过。<br />“那，你最想做的是什么事呢？”阿尔特弥斯把手再一次放在他肩上，诱导着问道。<br />“真的什么都可以？”<br />“什么都可以，在这里没有任何限制。”</p><p>阿瓦登觉得自己终于找到机会了，他咳了一声，抓抓头，脱口而出一句响亮的叫喊：“FUXKYOU, YOUSONOFBITCH！”</p><p>在一瞬间，在座的四个人都被他这句话震惊了。瓦格纳率先反应了过来，他先叼住雪茄，用力鼓掌，然后用右手把雪茄取下来，张嘴大声地赞叹道：“真棒，痛快，这简直是最完美的入会誓词。”<br />“我宁可听十遍这样的脏话，也不想再去碰那个乏味的电子女声。”兰斯洛特也是一脸陶醉，毫不掩饰自己对电子女声的厌恶。而阿尔特弥斯和杜拉丝全都咯咯地笑起来，杜拉丝发现自己的笑容幅度大了一点，不好意思地把嘴掩住。阿瓦登觉得他们与其说是觉得新奇，不如说是在享受这句脏话所带来的对体制的蔑视与挑战。<br />“那你叫希望自己叫什么名字呢？” 阿尔特弥斯歪着头问。<br />“唔……王二。“ 阿瓦登沉吟了一下，回答说。这是一个中式的名字，他以前有一个中国人朋友，喜欢讲故事，故事里的主角名字总是叫王二。<br />屋子里的气氛现在完全融洽了，大家都开始谈些比较自然的话题，每个人都摆出了最舒服的姿势，阿尔特弥斯不时拿起茶壶来为大家续水。阿瓦登紧张的心情逐渐放松下来，他感觉到自己的脑子前所未有地轻松。</p><p>“你知道的。”阿尔特弥斯又给他倒了一杯甜水，“我们一直想把说话会保持在一定规模，平日是没有办法畅所欲言的，我们需要空间。麻烦的是，我们没办法公开征集会员，又不可能直接通过物理接触去寻找，那风险太大。于是兰斯洛特就设计了一套暗示系统，只有发现这些暗示的人才能知道本会的存在。”<br />“这套系统考虑到的还不止是安全问题。”兰斯洛特把自己的眼镜摘下来仔细擦拭了一下，得意地说，“这其实也是一个会员资格验证。说话会所吸纳的成员，必须有智慧，有头脑，内心渴望激情，并且对自由有着渴望。”<br />瓦格纳用两根指头夹着雪茄，在事先准备好的烟灰缸里弹了弹烟灰，大声说道：“据我的经验，申请 BBS 论坛服务的人，大多数都是为了怀旧，或者说渴望一些新鲜的东西，这样的人往往都怀有激情，认为 BBS 论坛也许能给他们一些与现实不一样的东西——当然，事实上并非如此，美国政府对 BBS 论坛的管理甚至严厉过电子邮件——这暗示着他们心里渴望解脱束缚。因此我们将暗示隐藏在申请 BBS 论坛的光盘之中，只有申请人才有机会接触到这些暗示。而只有那些有智慧、观察敏锐的人才会发觉到这些暗示的存在，并顺利解读出来，找到这里。”<br />“归根到底，说话会也不过是一群渴望自由说话的秘密小团体罢了。”兰斯洛特笑道。<br />“你是第二个找到说话会的人，第一个是杜拉丝小姐。”<br />阿尔特弥斯告诉阿瓦登。阿瓦登敬佩地看了杜拉丝一眼，后者淡淡地回答道：“这没什么，这是我的工作，我的工作就是摆弄文字。”</p><p>阿瓦登想到上一周在公共汽车站碰到的那个疯狂男子，于是把这件事讲给其他成员听。听完之后，兰斯洛特摇了摇头，从嘴唇里滑出一声叹息：<br />“这样的事情我也是见过的，我的一个同事就是如此。所以说话会的存在是必要的，这是缓解压力的阀门。长时间的敏感词汇限制会让人都疯掉的，因为他们既无法思考又没办法表达。”<br />“这正是美国政府有关部门所希望看到的，这样只有傻瓜能够存活下来，一个全是傻瓜的社会是稳定的。” 瓦格纳费力地把自己肥胖的身躯挪了一下位置，轻蔑地说。<br />“你也是有关部门的一分子，瓦格纳先生。”阿尔特弥斯一边往茶杯里续了些热水，一边抬头轻声说道。<br />“阿尔特弥斯小姐，我只是一个能比普通人多使用几个敏感词汇的普通人而已。”<br />大家都笑了起来。阿瓦登从来没有见过这么多的人说这么多的话，这是前所未有的奇妙经验。他惊讶地发现自己居然很快就融进了这个小圈子里，隔阂与陌生感很快就消失了；同时消失的还有胸闷与头晕等习惯性的毛病。<br />很快话题就从说话会本身扩展到了更加宽泛随意的话题，阿尔特弥斯唱支歌，兰斯洛特说了几个笑话，杜拉丝则给大家讲了美国南部诸州的风土人情；瓦格纳甚至还唱了一段歌剧，虽然阿瓦登一个字也听不懂，但他一点也不吝惜掌声。在这个城市的某一个被屏蔽掉的角落里，五个不甘沉默的人正在享受着在这个时代视为奢侈品的事情——说话。</p><p>“王二，你可曾看过《1984》？”<br />阿尔特弥斯忽然问道，她就靠着阿瓦登坐下，阿瓦登摇摇头，反问道：“这是网络编号的一段么？”<br />“这是一本书的名字。”<br />“书？”阿瓦登听到这个名词，头摇的更大了。这是个古老的名词，在这个电脑技术非常发达的时代，网络可以承载一切信息，任何人都可以在网上图书馆查到电子版；因此有关部门认为实体书籍变成了一种没有必要存在的浪费，实体书也就逐渐消亡了。瓦格纳对此的评论是：“有关部门喜欢电子书籍的心情是可以理解的，电子书籍的话，只需要 FIND 和 REPLACE 两个命令就可以消灭掉全部不健康词汇，替一本书消毒；而实体书籍的校对与修订却是件旷日持久的工作。”<br />“这是一本伟大的书，是旧世界哲人们对我们这个时代的预言。”阿尔特弥斯认真地说。“它很早以前就洞察到了肉的束缚与解脱，灵的束缚与解脱，这是说话会的基石。”</p><p>阿瓦登不无惊奇地发现他的网络编号开头恰好是这这本书名字：<code>19842015</code>。<br />“那么，该怎么样才能看到呢？”阿瓦登盯着阿尔特弥斯乌黑色的眼睛问。<br />“我们也无法找到纸质版，网络图书馆不可能存在这样的书。”兰斯洛特摇摇头，然后重新露出笑容，左手向着杜拉丝摆了个请的姿势，“但我们的杜拉丝小姐应该为她的记忆力而自豪，她在很早已经有幸阅读过这两本书，并且能够记得里面的大部分文字。”<br />“太好了，然后她写下来了，对吗？”<br />“那太危险，这时代持有实体书是个大罪过，也容易让说话会暴露。我们只是在每次聚会的时候请杜拉丝小姐为我们背诵。既然是说话会，那么把这两个故事讲出来不是更名符其实吗？”<br />大家都安静下来，杜拉丝站起来走到屋子中央，其他四个人坐在旁边看着她。阿瓦登不经意地把手搂在阿尔特弥斯肩上，后者微微朝这边靠过来，女性头发的幽香“咝咝”地划过他的鼻子，让他的心里一阵荡漾。屋子里非常暖和，他分不清这是花香还是阿尔特弥斯的味道。<br />杜拉丝的声音并不高，不过却很清晰有力；她的记忆力确实惊人，不仅记得情节，包括一些细节和句子都可以复述下来。杜拉丝讲到了朱丽亚假装摔倒，然后偷偷递给温斯顿一张写着“我爱你”的纸条，绘声绘色，这让听众们都听的入神了，阿尔特弥斯听的尤其认真，以至于都没有注意到阿瓦登一直注视着她。</p><p>“1984 的作者预见到了专制的进步，却没有预见到技术的进步。”瓦格纳在杜拉丝停下来喝水的时候发表自己的评论，阿瓦登觉得他与外貌不太相称，是个很有洞察力的技术官僚。<br />“在大洋国人们还可以靠传递纸条来偷偷表达自己的想法，但是现在不一样了。美国政府有关部门把我们全赶到了网上，而在网络技术发达的今天，我们即使想发一条短信都会被系统或者网管看的一清二楚，无从遁形。现实里呢，还有旁观者在。”瓦格纳在腿上敲了敲雪茄根部，“一句话，技术是中性的，但技术的进步会让自在的世界更自在，集权的世界更加集权。”<br />“这句话说的很有哲学家的味道哟。”阿尔特弥斯冲瓦格纳挤了挤眼睛，从抽屉里取来一把饼干和曲奇散发给大家。<br />“就好象同样是 0 和 1，有的人就能写出工具软件，有人却拿那个编出恶性病毒？”<br />阿瓦登想到一个类似的比喻，瓦格纳听了以后满意地打了个响指。<br />“很不错的比喻，王二，就是如此，真不愧是程序员。”<br />谈话持续了不知道有多久，杜拉斯看了一眼墙壁上的挂钟，连忙提醒谈兴正浓的四个人时间快到了。说话会不能持续很长时间，旁听者被屏蔽的越久，暴露的危险就越大。</p><p>“那么好吧，我们就抓紧最后半个小时来完成今天的活动。”<br />阿尔特弥斯一边说着，一边将桌子上的空杯子收走。兰斯洛特和瓦格纳也都站起身来，活动一下已经有些酸疼的肩膀和腰，只有杜拉丝坐在位子上没有动。<br />“活动？还有什么活动？”<br />阿瓦登奇怪地问道，说话会除了说话还有其他活动？<br />“唔，对啊，我们还有其他活动。”阿尔特弥斯撩起额前的长发，对他妩媚一笑：“我们还会和对方完全交流。”<br />“完全交流？”<br />“就是 intercourse”<br />“………………”阿瓦登一下子变的脸色苍白，呼吸急促起来，仿佛胃里被灌进去零下三十度的寒风，他几乎不相信自己的耳朵。<br />“说话会有说话的自由，也有选择与谁上床的自由。”阿尔特弥斯毫不羞涩地说，“我们互相谈话，然后选择合适的人做爱，就象我们选择我们喜欢的词汇说话一样。”<br />兰斯洛特看阿瓦登很窘迫，走过去拍拍他的肩膀，慢慢地说：“当然，我们不会强迫任何人，这完全是在自愿的基础上。今天我还要早点回去照顾小孩，你们人数正好合适。”</p><p>阿瓦登的脸色涨红，热的仿佛夏季的电脑 CPU，他甚至不敢多看阿尔特弥斯一眼。他憧憬过女性很长时间，但如此接近还是第一次。<br />还要回家去照顾小孩子的兰斯洛特向大家道别后就先行离去了，阿尔特弥斯将房间留给瓦格纳与杜拉丝，然后带着惶恐不安的阿瓦登来到了另外一间房间。这间显然是阿尔特弥斯的卧室，屋子里很简单，但却收拾的十分干净，在床上枕头旁还摆着一个手制的布娃娃，床单和窗帘都是粉红色的。<br />最初的是由阿尔特弥斯主动开始的，丝毫没心理准备的阿瓦登只是被动地任她摆布。经过了几轮挑逗，阿瓦登才逐渐放开，任由潜藏在自己心内的原始欲望奔流出来，那种期待听到圆润女声的青春憧憬本来只是苦闷生活的意淫，而在今天它加倍实现了。很快这种憧憬与他在现实中被压抑的郁闷合流，转化成了猛烈的冲动，让他一次又一次与阿尔特弥斯融为一体。阿瓦登不知道这种冲动和他想大声说出“FUXKYOU, YOUSONOFBITCH”冲动有什么不同，不过现在不是考虑这个的时候，他现在脑子里想的只有尽情地、全无束缚地让自己释放激情，完全没有任何束缚。<br />强烈的刺激一波波地冲击着兴奋中枢，最终一阵快感浪潮在狂暴洋面扬起头来，达到了一个极高的顶端。阿瓦登在那一瞬间感觉到了前所未有的自由，那种轻盈无比的自由，以及因自由而生的快乐与疲惫。浑身是汗的他喘息着倒在了阿尔特弥斯身上，一阵舒畅的倦意如潮水般淹没了他的身体……</p><p>……当他醒来的时候，发现阿尔特弥斯躺在自己身边，赤裸的身体好象一尊白玉雕像，睡姿恬美静谧。他侧过身子去，慵懒地打了个呵欠，然后阿尔特弥斯睁开了眼睛。<br />“很舒服，对不对？”她问道。<br />“是啊……”阿瓦登不知道该说什么好，他顿了顿，犹豫地说道：“你以前和兰斯洛特、瓦格纳他们也……呃，我是说，象刚才那样子过吗？”<br />“是的。”阿尔特弥斯温柔地回答，她半支起胳膊，长发从肩膀披到了胸口。她的大方坦白反而让阿瓦登有些不知所措。屋子里出现了一段时间的沉默，然后阿尔特弥斯忽然开口问道：<br />“还记得今天杜拉丝讲的那段故事吗？女主角偷偷递给男主角写着“我爱你”的纸条。”<br />“唔，还记得。”阿瓦登回答，很高兴终于能从那个拙劣的话题摆脱出来了。<br />“在有关部门的健康互联网络词汇列表里，没有爱这个字呢。在我们这个时代，我爱你也是一个敏感词汇，被屏蔽掉了。”阿尔特弥斯的眼神里似乎是感慨，又象是失落。<br />“我爱你。”阿瓦登不禁脱口而出，他知道在这间屋子里可以说出任何自己想说的话，不必顾忌。<br />“谢谢你。”<br />阿尔特弥斯听到之后只是笑了笑，起身穿上衣服，催促阿瓦登时间差不多了。阿瓦登有些失望，因为她没有预期反应的热烈，仿佛他刚才说的只是有些无关紧要的东西。<br />这时候杜拉丝和瓦格纳已经离开了，屋子里只剩他们两个人。阿尔特弥斯把他送到门口，将旁观者交给他，然后叮嘱他说：“记得在外面绝对不要提及说话会的任何事情或者任何人，我们在说话会以外的地方是完全不认识的。”<br />“我记住了。”阿瓦登回答，然后转身要走。<br />“王二。”<br />阿尔特弥斯忽然叫道，阿瓦登连忙转身，还没等他反应过来，两片柔软温暖的嘴唇忽然贴到了他的双唇，然后是一个细切的声音在耳边响起：“谢谢你，我爱你。”</p><p>阿瓦登觉得眼睛有些湿润，他戴上旁观者，推开门，重新步入到那一片令人窒息的世界中去，但他此时已与来时的心境大不相同。<br />此后阿瓦登的精神面貌明显有了改善。他谨慎地享受着这种秘密集会的乐趣，并且乐在其中。每一周或者两周，他们五个人都会在周日秘密地举行说话会的活动，聊天，唱歌或者听杜拉丝讲 1984 的故事。阿瓦登同阿尔特弥斯又“完全交流”了几次，偶尔他也会跟杜拉丝“交流”。他有了两个身份，一个是现实中和网上的阿瓦登，编号 19842015，还有一个是说话会里的王二。他很享受这个名字，觉得这就是自己另外的一个人生。<br />有一次集会，他们谈到了敏感词汇的问题。阿瓦登记得很早的时候——他对这方面的记忆有点模糊——有关部门给出的是一份敏感词汇列表，由网站的内部管理人员秘密参考使用，他对如何演变成现在的局面大惑不解。那一天瓦格纳带了一瓶葡萄酒，兴致很高，于是索性给他们讲了讲“屏蔽”的进化史，身为网管的他经常可以接触到这些资料。</p><p>在最开始美国政府只是单纯地屏蔽掉敏感词汇，但很快他们就发现这样的措施根本没有用处。很多人会采取在词组中夹杂符号或者数字的方式来绕开系统检查；于是有关部门不得不将这些近似敏感词汇也一一屏蔽掉。然而众所周知，数字与符号之间的组合方式是近乎无限的，只要你有想象力，就完全可以组合出一个新的词组而且不失掉他的原意。比如说“politic”这个词，就有“politi/c”、“政 polit/ic”、“pol/itic”等近乎无限种表达方式。<br />当有关部门意识到这个问题时，他们采取了新的策略。既然无法辨识词组，那么就用单词屏蔽。这一举措在一开始是奏效的，违规交谈的人显著减少，但很快人们就发现可以用同音字或者谐音的方式来继续表达自己的危险思想。即使有关部门封掉全部敏感词汇的同音字，也无济于事，思想活跃的美国人充分发挥了自己的想象力，使用隐喻，借代、类比、引申及其他修辞方法，或者将一个敏感词用数个不敏感的字来代替。人类的思维方式要比电脑开阔许多。电脑屏蔽掉一条路，他们还会有更多的路可以选择。<br />这一场水面以下的角力看起来似乎是美国大众要取得胜利。这时候，一个具有逆向思维精神的人出现了。他的身份不明。有人说他是有关部门的主管；也有人说他是因过度使用敏感词汇而被捕的危险人士。无论他是谁，总之整个局面被扭转过来。他向有关部门建议，不再告诉大众禁止说什么，而是规定他们只能说什么，用什么方式去说。有关部门很快就心领神会，制订了新的规章制度：取消了敏感词汇列表，取而代之的是互联网络健康语言列表，并把这举措推广到了日常生活中的语言屏蔽系统中去。</p><p>这一次，大众终于处于下风。以往他们与有关部门尽情地在网络与现实中捉着迷藏，而现在他们却被有关部门扼住了咽喉。这样一来，有关部门可以有效率地掌握住言论，因为整个语言的框架都被彻底控制了。在有限的空间内，大众几乎是无计可施。<br />尽管如此，大众还是不屈不挠地将这场战争——或者说游戏——继续下去，他们挑选健康词汇列表中的合法字眼来表达不合法的意思：两个连续的“稳定”意思就是“反对”，“稳定”加“繁荣昌盛”则暗示“屏蔽”。美国政府不得不对这一动向保持着警惕，并日复一日地将更多的词汇从健康词汇列表里删掉，禁止大众使用。<br />“当然，这场战争会持续下去的。只要世界上还存在着两个不同的字或者词组，那么就可以继续自由交流——你知道莫尔斯电码吧？”<br />瓦格纳说到这里，拿起茶杯一饮而尽，满意地打了一个嗝。<br />“可是，这场战争的代价就是语言的失落。表达能力会越来越贫乏，越来越淡而无味，人们会越来越倾向于沉默，这对有关部门反而是好事。”兰斯洛特摆出一副忧虑的表情，有节奏地用指关节敲击着桌面，“这样一来，岂不就等于是大众的自由意识将语言推向死亡的边缘？真讽刺啊。按照这个趋势，有关部门是不会败的，他们会笑到最后。”<br />“不，不，笑这种情感他们是不会了解的。”瓦格纳淡淡地回答。<br />“我倒是觉得，美国是一直处于恐惧的情感之中呢，生怕人们掌握了太多的词汇，表达出太多的思想，变的难以掌握。”阿尔特弥斯说完摆出一副她在上班期间冷若冰霜的呆板脸孔，学着僵硬的腔调喊了一句：“营造健康的网络环境，美国万岁！”<br />杜拉丝、兰斯洛特与瓦格纳都哈哈大笑，唯一没笑的是王二（阿瓦登）。他对于兰斯洛特刚才的那句话始终耿耿于怀：大众与有关部门的对抗，其最终结局就是语言的消亡。那么他们现在这个小小的说话会，也只不过是在一列开向悬崖的列车里关上窗帘，享受坠毁前最后的宁静罢了。<br />不过他没有说出口，因为这太煞风景了。阿瓦登不希望破坏说话会的气氛，这对他很重要。</p><p>从说话会回到家里，阿瓦登躺在行军床上，双手枕着脑袋，陷入了沉思。自从加入说话会以后，他变的比以前更容易陷入思考。有时候他想的是这个社会、这个互联网络或者这座城市中存在的荒谬性；有时候他想的是自己的生活；还有时候他想的是阿尔特弥斯。他不知道是不是在一个压抑的世界里，人的情感会变的格外强烈，他现在陷入对阿尔特弥斯的迷恋无法自拔。阿瓦登一直很羡慕杜拉丝讲的《1984》里面的温斯顿，他和朱利亚有一间两个人独处的小屋，一个只属于他们两个人的小世界。<br />他在与阿尔特弥斯“完全交流”的时候曾经吐露过自己的心声，阿尔特弥斯没有直接回答，而是表示两个人的关系无法再比说话会更近一步——维持现在的状态就已经是个人行为的极限，有关部门可不会一直打瞌睡。“我们只能把感情生活压缩在每周一次的说话会活动里，这已经很奢侈了。”她对他说，同时温柔地抚摩他的胸膛。“只有在说话会里，我们才是阿尔特弥斯和王二。而在其他时间里，你是 <code>19842015</code>，而我是 <code>19387465</code>。”<br />对此，阿瓦登只能发出一声轻轻的叹息，确实他不该奢求更多。<br />除了感情，发生变化的还有互联网络。自从加入说话会以后，阿瓦登逐渐发现互联网表面下潜藏的一些东西。正如瓦格纳在一次活动的时候指出，普罗大众与有关部门的战争从未结束，总会有思想和言论从严厉管制的缝隙中流泻出来。阿瓦登发现，在完全公式化的 EMAIL 与网络论坛中其实隐藏着不少耐人寻味的细节，就好象那个 title 一样，存在着各式各样的密码与隐藏寓意。这些东西出自不同人的手里，样式和破译方式都不同，阿瓦登不知道那些密码背后隐藏的是怎样的内容。不过有一点可以确知的是，说话会并不是唯一的一个地下集会，瓦格纳说的对，始终还是有人在试图用“健康”词汇表达“不健康”思想。<br />讽刺的是，给阿瓦登感触最深的，是有关部门的管制。以往他只是模糊地感觉到自己被绑缚起来，现在他能清晰地看清这种束缚与压抑的脉络，以及加诸在自己身上的各种手段。在小小说话会中享受到的自在让他更加深刻地感受到在宽阔现实中的不自在。</p><p>“FUXKYOU, YOUSONOFBITCH！”</p><p>每一次的聚会，三位男士都会轻蔑地一起高喊这一句粗话。他们清楚这不会给有关部门带来什么不良影响，不过这确实很痛快。<br />这一周，阿瓦登特别地忙碌，他的同事因为不明原因而被屏蔽掉了，这样一来整个项目就全压在了他一个人身上。这项目是为有关部分设计一种软件，用来控制大功率主动式“旁观者”的能源分配控制。软件很复杂，他不得不每天在电脑前工作十几个小时，只有在身体实在支撑不住的时候才停下来随便吃一点东西，喝一口纯净水，困了就躺在旁边的行军床上睡上一觉，爬起来继续工作。屋子里满是浑浊的烟味与袜子脏衣服的酸臭味，阿瓦登就在这种环境下蓬头垢面地敲着键盘，并不时揉揉满布血丝的眼睛。<br />偏偏在这个时候屋子里的暖气坏掉了。洋灰色的暖气片从昨天开始就变的冰凉，不再有热水流动。阿瓦登检查了一下，发现并不是管道问题，而且邻居们也碰到同样的事，看来是供热系统出了问题。这一变故的正面影响是稍微淡化了屋子内的酸臭味，负面影响是整个屋子变的有如冰窖一样。紧闭的窗户和门能挡住寒风，却挡不住寒冷，低温让本来就寒酸的房间更笼罩上一层霜气。无论是那把木椅还是行军床都象是冷酷的冰雕，屋子里唯一还有些热气的就只剩下电脑。阿瓦登不得不披上所有的御寒衣物，蜷缩在床上，把电脑的散热口对准自己。</p><p>有关部门宣布“供热”和“暖气”暂时也被列入敏感词汇，于是阿瓦登没办法写信向供热部门询问，只好静待，除了用来敲键盘的指头以外，尽量保持全身一动不动，以节约热量。在停止供暖后的第四天，暖气片里终于传来“哗啦哗啦”的声音，带着热气的水开始流动，屋子里恢复了温暖，“供热”和“暖气”又可以恢复使用了。于是 EMAIL 与网络论坛上全都是“庆祝有关部门恢复供应暖气，急人民之所急”的帖子，EMAIL 新闻组里也全是类似主题。<br />不过这对阿瓦登来说太晚了，他生了病，感冒，而且是重感冒。他面色苍白，全身软弱无力，头疼的象是被一枚达姆弹射入头部，只能躺在床上等医生。医生来到他家里，给他做了两三次点滴，喂了一些叫不上名字的药片，叫他静养。这一场病足足持续了数天，他不得不放弃参加这一星期的说话会，身体状况实在太差了，阿瓦登甚至怀疑自己搞不好会因此而死掉。</p><p>阿瓦登躺在床上，心里懊悔不已，说话会是他唯一的乐趣，现在他却没办法参加。他把头蒙在被子里胡思乱想，瓦格纳这一次会带什么特别的东西来呢？兰斯洛特有没有把两个孩子也领过来？还有阿尔特弥斯，他没参加的话，她会和谁“完全交流”呢？瓦格纳还是兰斯洛特？他还想到了杜拉丝，上一次的聚会里，杜拉丝讲到了温斯顿在秘密幽会的屋子里对朱丽亚说“我们已经死了”，朱丽亚附和着说“我们已经死了”，这时候第三个声音说道“你们已经死了。”<br />杜拉丝就讲到这里，就停住了。阿瓦登急切地想知道接下来发生了什么，第三个声音是谁，是党吗？温斯顿和朱丽亚是否会被捕，他们会有什么样的下场？不光是他，阿尔特弥斯也很希望知道后续情节的发展，不过她并没有去追问杜拉丝。</p><p>“让这成为一个悬疑，这样接下来的一周我们的生活都会在期待的乐趣中度过。”她对阿瓦登说，然后两个人继续沉溺于 intercourse 的快乐。<br />“也许他们都会死。”阿尔特弥斯在交流结束后，看着天花板说。<br />“也许那只是奥布林的声音，他去探望他们。”阿瓦登安慰她道，但是他的心里也不确定。<br />阿瓦登的病持续了十天，然后他终于痊愈了。他痊愈后的第一件事就是从床上爬起来，然后去看墙上的日历：这一天恰好是星期日，说话会活动的日子。阿瓦登已经缺席了一周，这已经令他如饥似渴，甚至做梦都在和他们一起喋喋不休地说着话——所幸他并没有说梦话的习惯，所以 24 小时工作的旁观者并没发出任何警报。</p><p>阿瓦登简单地洗了一下脸，用一把有些生锈的剃刀沾着肥皂仔细地刮掉脸上粗硬的胡须，然后咕噜咕噜地刷了刷牙齿，用手和毛巾沾着热水将自己蓬起的乱发压下去。因为生病，有关部门发了一些补贴给他，其中包括两块羊角面包、两瓶姜汁啤酒和一份精制砂糖。他将这些东西都用塑料布仔细包好，揣到宽大的军大衣里，打算带到说话会上去与大家分享。<br />今天的天气和往常一样地冷，阿瓦登把自己裹在大衣里，登上前往效率大楼的公共汽车。一路上车厢里的广播重复着“营造健康的互联网络”以及一些优秀网络用户的先进事迹；车厢前面的电子屏幕不断滚动显示着最新的健康词汇列表，一个旁观者自车顶垂下来睥睨着车内的每一个表情呆滞的人。阿瓦登坐在最后一排，望着窗外不断向后移动的建筑物与枯黄的树木发呆。<br />车子很快就到达了辛普森大楼附近的车站，阿瓦登下了车，把手放到怀里摸了摸塑料布包着的食物，朝着大楼走去。他在半路无意中抬起头，忽然一阵冰冷的寒流刺入他的胸腔，迫使他停住了脚步。</p><p>有什么地方不对劲！<br />他看到了效率大楼的第五层阿尔特弥斯家的窗户发生了一些奇怪的变化。以前阿尔特弥斯家面向大街的窗户总是挂着粉红色的窗帘，而现在窗帘则被扯到了两边，窗户大开，用肉眼可以勉强看到窗玻璃和屋子里雪白的墙壁。假如今天有说话会的话，阿尔特弥斯绝对不会把有屏蔽效果的窗帘打开。而且打开窗户这件事也绝不寻常，在这个城市里的室外空气十分浑浊，几乎不会有人会去开窗换气。<br />也就是说，今天并没有说话集会召开，而是发生了另外一些事情。阿瓦登望着那窗户，心情开始变的有些慌乱，他把手从兜里掏出来，叼起一支香烟，把身体靠在一根电线杆旁故做镇静，以免被行人怀疑。究竟说话会发生了什么，为什么这一周停办了呢？要知道，只要还有复数的成员能够出席，说话会就会一直办下去，难道说瓦格纳、兰斯洛特、杜拉丝和阿尔特弥斯同时无法出席？这种概率实在太小了。阿瓦登一边这样想着，一边向四周不安地张望。忽然他看到了一样东西，一个念头霎时占据了他的全部心灵，让他几乎眩晕过去。</p><p>“说话会本周不会有了，以后也不会有了。”阿瓦登嘴唇默默地蠕动着，面如死灰。<br />他看到在街道内侧一处不起眼的地方隐藏着一个类似雷达天线的东西，其造型很象是两个背部贴在一起的大碗。阿瓦登心里清楚这是什么东西：这正是他负责软件设计的大功率主动式“旁观者”，这造型他很熟悉。这装置可以主动发射电波去探测人们的声音，并检查其中是否存在敏感词汇。<br />这样的装置居然就安放在阿尔特弥斯家附近，那么就等于说话会完全暴露在了有关部门的监控之下。主动式旁观者的强大刺探电波会轻易刺穿她家中的铅质窗帘，把所有成员的话原封不动地传到有关部门耳朵里。</p><p>这是一个划时代的发明，这一技术的突破意味着有关部门可以不再被动地等待警报，可以主动出击去刺探人们在任何时间任何地点说的任何话语。阿瓦登可以想象接下来会发生什么，阿尔特弥斯他们的每一句话都被有关部门记录下来，会有机器统计出到底有多少违禁词汇被他们使用过；然后联邦警察会冲进她的屋子，将正在聚会的成员们都带走，只留下搜查过后空荡荡的房间和窗户。<br />阿瓦登想到这里，心如刀绞，他一点也不为自己的侥幸逃脱而感到幸运。他的胃袋翻腾起来，一种恶心的感觉从胃里直接升到嘴边，让他想吐，却又不能吐——因为“呕”也是个敏感词汇；大病初愈的孱弱身躯无法承受这种打击，象害了风寒一样颤抖起来，几乎站立不住。<br />他不敢继续朝前走去，仓皇地转过身去，登上另外一辆公共汽车，把嘴闭的更紧了。等阿瓦登回到自己家楼下，看到楼房附近另外一架新的主动式旁观者正在兴建中，漆黑的天线在半空舒展开来，仿佛一面巨大的蜘蛛网。看来有关部门已经着手在整个纽约市部署这种新兴高科技产品。</p><p>他不敢驻足观看，低着头从那巨大装置旁边走过，一路不停地走回家，然后把自己的脸紧紧地压在枕头里，却不敢哭出声音来，连一句“FUXKYOU,<br />YOUSONOFBITCH”都不能说。<br />从那以后，阿瓦登的生活回到了普通状态——就是说和原来一样沉滞、压抑、欠缺激情，健康向上，缺乏低级趣味。兰斯洛特说过：“战争的结果就是，大众的自由意识会将语言推向死亡的边缘”，现在看来，他的预言是很准确的：说话会的覆灭，导致“说话”、“歌剧”、“完全”、“交流”几个词先后被剔除出了健康词汇列表，成为敏感词汇。<br />另外，虽然阿拉伯数字还能用，但“1984”这一个数字组合也被屏蔽掉了，这让包括阿瓦登在内的程序员在编写程序时不得不谨慎地检查数字是否违规，这额外增加了很多工作量，让他更加疲惫。<br />阿瓦登不是没有担心过，也许在某一天的深夜，他就会忽然接到一封 EMAIL，让他留在家里不要动，不要试图在网络做任何动作；接着电话会响起，电子女声会把这一要求重复再重复，直到警察打开他家的大门，把他带去未知的地方，那里有未知的命运等待着他。《1984》后面的情节发展阿瓦登始终不知道，唯一知道的杜拉丝已经彻底失踪了，所以温斯顿和朱丽亚的结局始终是个谜；就好象兰斯洛特、瓦格纳、杜拉丝和阿尔特弥斯的结局一样，也不从得知。其实这两件事对于阿瓦登来说没什么本质性的区别，所以它们也可以看做是同一个谜。</p><p>其实他最担心的，是阿尔特弥斯。每次想到这个名字，阿瓦登就难以抑制心中的郁闷。她究竟会怎么样，彻底被屏蔽掉吗？如果是那样，那么她在这世界上遗留下来的唯一痕迹，就是一个程序员记忆里的假名而已了。<br />说话会消失后三个星期，仍旧风平浪静，没有任何人来找过阿瓦登，他也没收到过任何类似内容的 EMAIL，阿瓦登一直在想，也许是他们没有吐露出自己的下落，也可能是因为他们根本不知道——他们认识的只是一个叫王二的程序员。这个城市里有数以千计的程序员，而王二是个假名。<br />因此，生活一如既往地平静。不，确切地说，还是有一点不同的，那就是互联网络健康词汇列表：那上面的词组消失的速度比以前要快的快，每小时每分钟都有词与单字飞快地在名单上消失，阿瓦登不得不花上大量时间去更新列表，以跟紧当前形势。<br />与词汇列表更新速度相对的，EMAIL 和网络论坛上的东西越来越乏味。因为人们不得不用极有限的词去表达广泛的意思，大家都变得寡言少语。就连那些秘密的暗语和联系方式也少了许多；整个网络就象是前些天阿瓦登家里出了问题的暖气片一样：虽然名义上是给人带来温暖的东西，但却变的冰冷、僵硬，让人如坠冰窟。</p><p>这一天，阿瓦登从电脑前抬起头来，他看了看窗外迷茫的灰色天空，胸口一阵抽搐，不由得痛苦地咳了一声。他拿起塑料杯，将杯子里的纯净水一饮而尽，杯子丢进同样是塑料质地的垃圾桶里，发出钝钝的撞击声，他觉得自己的脑子也是一团垃圾，举起手敲了敲，果然发出同样钝钝的撞击声。<br />然后他拿起大衣，戴上墨绿色的护目镜，走出门去。阿瓦登没带便携式的旁观者，那东西已经不需要了，城市里到处都是主动式的旁观者，随时监听是否有违禁词汇的存在。整个纽约现在就象是互联网络一样，被有关部门营造成十分健康。<br />阿瓦登这一次外出是有正当理由的，他决定去取消网络论坛服务，这服务已经用不着了，因为无论 EMAIL，新闻组，BBS 论坛还是其他什么现在全部都变成了一样的东西。</p><p>从日历来说现在应该是春季，但外面还是很冷，高大的灰色建筑矗立在平地上，仿佛绝对零度下的石林。大团大团的风裹着黄沙与废气穿行其间，风沙无处不在，让人置身其中而难以摆脱。阿瓦登把手揣进兜里，脖子缩进领口，畏缩着向网络部的大楼走去。<br />忽然，他停下了脚步，惊讶地站在原地无法动弹。他看到阿尔特弥斯正站在前面的路灯下，穿着黑色的制服。可是她的变化有多么大啊，面容象是老了十岁，满脸都是衰老的皱纹，年轻的活力荡然无存；她听到脚步声，转过头来，两个乌黑的大眼睛显得异常空洞，目光越过阿瓦登延伸到远方，没有一个明晰的焦点。<br />阿瓦登万万没有想到会在这个时间这个地点碰到她，这让他已经沉寂已久的心灵泛起了几点火花，可惜他迟钝的神经已经无法表达出“激动”这一个简单的情感了。两个人互相对视了一阵，他终于木然走到她身边，张了张嘴唇，想对她说些什么。但是他掏出今天新发布的健康词汇列表，发现上面是一片空白——终于连最后一个词组也被有关部门屏蔽了。</p><p>于是阿瓦登只好保持着沉默，默默地与面无表情的她擦肩而过，继续向前走去。他的身影逐渐融入同样安静的灰色人群之中，整个城市都显得寂静极了。</p><hr /><p>我曾不止一次地读过这篇文章。我最终决定转载它，是因为最近发生了的事情。<br />广电总局封杀 AcFun，体育总局的苟屁，还有 B 站 UP 主实名制，等等等等，不一而足。<br />最后，推荐大家阅读我自己写的博客<a href="https://blog.nfz.moe/archives/my-view-of-freedom.html">《真正的自由？——从杨舒平的演讲来谈中国和言论自由》</a></p>]]></content>
        
        <summary type="html">
            
            马伯庸《寂静之城》未删节版本全文  发表在 2005 年第 5 期《科幻世界》上的本文由于众所周知的原因进行了删节。以下是发在马伯庸个人网站上的原文。And in the naked light I saw ten thousand people, maybe more.Peo
            
        </summary>
        
        <category term="异闻堂"/>
        
    </entry>
    
    <entry>
        <title>支付宝、微信、QQ收款二维码3合1</title>
        <link href="https://www.iwch.me/archives/651.html"/>
        <id>https://www.iwch.me/archives/651.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-06-21T05:42:00+00:00</published>
        <updated>2017-06-21T05:42:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><p><div></div>
</p><p>最近折腾了一下合并收款码，简单记录一下折腾的过程，方法不唯一，只是提供一种思路，如果各位大佬有更加简单粗暴的办法，一定要偷偷告诉我哈(=｀ω´=)</p><h2>Here we go!</h2><h3>原理</h3><p>首先解析出三个二维码的内容，用Nginx判断User agent后，返回302，跳转到对应的URL。</p><h3>支付宝</h3><p>支付宝的收款码内容大概是这个样子的：</p><pre><code>HTTPS://QR.ALIPAY.COM/FKX04064LA1PNS8SI7BLE4
</code></pre><p>抓了一下支付宝的UA，大概是这个样子的：</p><pre><code>Mozilla/5.0 (Linux; U; Android 6.0.1; zh-CN; A0001 Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/40.0.2214.89 UCBrowser/11.3.8.909 UCBS/2.10.1.4 Mobile Safari/537.36 Nebula AlipayDefined(nt:WIFI,ws:432|0|2.5) AliApp(AP/10.0.12.042101) AlipayClient/10.0.12.042101 Language/en useStatusBar/true
</code></pre><p>然后就有了下面这段Nginx配置</p><pre><code>if ( $http_user_agent ~* &quot;AlipayClient&quot; ) { return 302 &quot;HTTPS://QR.ALIPAY.COM/FKX04064LA1PNS8SI7BLE4&quot;; }
</code></pre><p>经过测试，支付宝正常弹出支付窗口。</p><h3>微信&amp;QQ</h3><p>同理，得到了下面这段Nginx配置</p><pre><code>if ( $http_user_agent ~* &quot;MicroMessenger&quot; ) { return 302 &quot;wxp://f2f0adN69vNDsE9d2xVmp258P9cAqEU_07EU&quot;; }
if ( $http_user_agent ~* &quot;QQ&quot; ) { return 302 &quot;https://vac.qq.com/wallet/qrcode.htm?m=tenpay&amp;a=1&amp;u=1798390978&amp;ac=0F5EBA1F54F811516CED292E33E75C0DF063DC3C6DACAD291A98B1CDF4108FA9&amp;n=Zohar%20Wang&amp;f=wallet&quot;; }
</code></pre><p>但是经过测试，微信和QQ都不能正常弹出支付窗口，搜了一下，貌似是因为调用微信和QQ的支付需要申请一个特殊的支付接口，而且相当麻烦，不然只能扫收款码进行支付。</p><p>但是，长按二维码识别，也是可以正常弹出支付窗口，于是，曲线救国，用Photoshop做了两张图：</p><p><img src="https://static.yecdn.com/static/pay/zohar-wechat.png" /></p><p><img src="https://static.yecdn.com/static/pay/zohar-qq.png" /></p><p>然后，用Nginx判断User agent后，跳转到相应的图片。</p><p>经过测试，微信和QQ正常弹出支付窗口。</p><h3>小插曲</h3><p>我最初使用的是<code>pay.iwch.me</code>这个域名做跳转，但微信扫描后出现下图的风险通知：</p><p><img src="https://static.yecdn.com/static/blog/post/651/photo_2017-06-21_16-17-31.png" /></p><p>更换至<code>pay.yecdn.com</code>域名后，没有再次出现这个风险通知，初步怀疑是<code>iwch.me</code>域名没有备案，而<code>yecdn.com</code>有备案的原因。但是因为我没有其他有备案的域名做测试，所以不能确定是不是因为域名没备案而导致的风险通知。</p><h3>总结</h3><p>完整的Nginx配置如下：</p><pre><code>server {
	listen 80;
	listen [::]:80;
	listen 443 ssl http2;
	listen [::]:443 ssl http2;
	server_name pay.yecdn.com;
	server_tokens off;

	location /generate_204 { return 204; }

	location /zohar {
		if ( $http_user_agent ~* &quot;AlipayClient&quot; ) { return 302 &quot;HTTPS://QR.ALIPAY.COM/FKX04064LA1PNS8SI7BLE4&quot;; }
		if ( $http_user_agent ~* &quot;MicroMessenger&quot; ) { return 302 &quot;https://static.yecdn.com/static/pay/zohar-wechat.png&quot;; }
		if ( $http_user_agent ~* &quot;QQ&quot; ) { return 302 &quot;https://static.yecdn.com/static/pay/zohar-qq.png&quot;; }
	}

	location / {
		return 200 Success;
		default_type text/html;
	}

	include enable-ssl-yecdn.conf;
}
</code></pre><p>最后，生成一个跳转域名的二维码即可使用。</p><p><img src="https://static.yecdn.com/static/blog/page/donate/pay.png" /></p></div>]]></content>
        
        <summary type="html">
            
             最近折腾了一下合并收款码，简单记录一下折腾的过程，方法不唯一，只是提供一种思路，如果各位大佬有更加简单粗暴的办法，一定要偷偷告诉我哈(=｀ω´=)Here we go!原理首先解析出三个二维码的内容，用Nginx判断User agent后，返回302，跳转到对应的URL。支付
            
        </summary>
        
    </entry>
    
    <entry>
        <title>集体荣誉感和自私有什么联系</title>
        <link href="https://www.isthnew.com/archives/Collective-sense-of-honor.html"/>
        <id>https://www.isthnew.com/archives/Collective-sense-of-honor.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-06-20T07:09:00+00:00</published>
        <updated>2017-06-20T07:09:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>所谓的集体荣誉感，尤其是在学校里被灌输的，大多都会变成自私的一种体现，为什么这么说呢？因为你被教育到你是集体的一个成员，你的荣誉是来自集体，集体伟大你就伟大，集体得到荣誉你就得到荣誉，这样看起来似乎是没有什么问题。但是这样会走向一个极端，那就是集体中的个体会用各种办法来维护</p>]]></content>
        
        <summary type="html">
            
            所谓的集体荣誉感，尤其是在学校里被灌输的，大多都会变成自私的一种体现，为什么这么说呢？因为你被教育到你是集体的一个成员，你的荣誉是来自集体，集体伟大你就伟大，集体得到荣誉你就得到荣誉，这样看起来似乎是没有什么问题。但是这样会走向一个极端，那就是集体中的个体会用各种办法来维护
            
        </summary>
        
        <category term="思考"/>
        
        <category term="集体"/>
        
        <category term="集体荣誉"/>
        
        <category term="集体主义"/>
        
    </entry>
    
    <entry>
        <title>MDx主题开发开始</title>
        <link href="https://flyhigher.top/develop/561.html"/>
        <id>https://flyhigher.top/develop/561.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-06-18T08:17:41+00:00</published>
        <updated>2017-06-18T08:17:41+00:00</updated>
        
        <content type="html"><![CDATA[<p>考虑了有一段时间，终于下定决心自己写一款WP主题，暂时定名MDx，不过最后有可能改名…</p>
<p>GitHub地址：</p>

	<div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com" target="_blank"><i></i></a>
		</div>
		<div>
		yrccondor / mdx
		</div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com%2Fyrccondor%2Fmdx" target="_blank"><i></i></a>
		</div>
	</div>
	
<p>从名字可以看出来我会使用Material Design风格。至少我个人觉得Material Design风格还蛮好看的，Typecho和Hexo都有MD风格的主题，但是WP好像没有（至少我没有找到过），于是打算自己写一款。</p>
<p>会采用MDUI开发，这是个很棒的开源库。</p>

	<div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com" target="_blank"><i></i></a>
		</div>
		<div>
		zdhxiong / mdui
		</div>
		<div>
			<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fgithub.com%2Fzdhxiong%2Fmdui" target="_blank"><i></i></a>
		</div>
	</div>
	
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170618_155933.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170618_155933.jpg" /></a></p>
<p>该开源库使用MIT协议，所以基本无需为版权问题纠结。</p>
<p><del>有意向使用WordPress的REST API进行前后端分离。貌似已经有这种思路的主题了，不过不多。不知有没有大佬指导一下2333</del> WordPress REST API将只应用于某些功能，因为国内太多人关闭它了…</p>
<p>打算免费发布主题。毕竟我是把它当作一次学习来看待的。用了这么久WP才开始学习WP开发，很惭愧。</p>
<p>目前这个项目已经开始，与短链接项目并行开发，可能会拖一段时间…</p>
<p>先吊吊你们胃口嘿嘿嘿。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170807_220055.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170807_220055.jpg" /></a></p>
<p><del>我稍后会把项目推到Github上，链接会稍后在此放出</del>已放出，也欢迎各位大佬为这个项目做出贡献吖。</p>
<p>计划实现</p>
<ul>
<li><del>3种首页样式</del>目前计划4种首页样式</li>
<li><del>3种文章页样式</del>目前计划4种文章页样式</li>
<li><del>Pjax/</del> AJAX评论无刷新 [没有PJAX，详细原因见另一篇文章]</li>
<li><del>3D Touch/Force Touch支持</del> 已移除。折腾了一下午，发现这对不支持压力触控的移动设备非常不友好，最后非常不舍地删除了改了一下午的代码</li>
<li>SEO友好</li>
<li>前端加载速度优化</li>
<li>阅读进度展示/记录及自动滚动</li>
<li>REST API支持</li>
<li><del>接入WordPress更新机制</del>[已完成]</li>
<li><del>Safari Touch Bar Icon支持</del>[已完成]</li>
<li>…</li>
</ul>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/IMG_20170810_221038.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/IMG_20170810_221038.jpg" /></a></p>
<p>Time Line</p>
<p>2017.6.16 项目建立<br />
2017.6.18 项目公布，开始开发<br />
2017.8.04 静态页面设计完成90%，开始转制PHP（<del>所以需要哪位大佬捐助一台服务器用于搭建测试环境</del>（逃<br />
2017.8.11 磨磨蹭蹭把后台做完了（遵循WordPress官方设计样式哦（逃），再把前台修改修改就可以发布啦<br />
2017.8.22 看来没有人发现我在公网上的测试用服务器嘿嘿嘿嘿…一直在加入新功能，越来越满意了（捂脸）<br />
2017.8.24 完成大部分功能，主站已经更换MDx主题<br />
2014.8.28 受新高考政策的影响，即日起主题开发暂停，预计11月中旬回归</p>]]></content>
        
        <summary type="html">
            
            考虑了有一段时间，终于下定决心自己写一款WP主题，暂时定名MDx，不过最后有可能改名… GitHub地址：                         yrccondor / mdx                        从名字可以看出来我会使用Material D
            
        </summary>
        
        <category term="开发"/>
        
        <category term="Material Design"/>
        
        <category term="MDUI"/>
        
        <category term="WordPress"/>
        
        <category term="主题"/>
        
    </entry>
    
    <entry>
        <title>Google Analytics 异步优化方案</title>
        <link href="https://blog.nfz.moe/archives/google-analytics-optimize.html"/>
        <id>https://blog.nfz.moe/archives/google-analytics-optimize.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-06-18T05:28:00+00:00</published>
        <updated>2017-06-18T05:28:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>一般地，网站配置 Google An­a­lyt­ics 的常见方式是在网站前端引用 Google Analytics 的 trackercode，然后获取 <code>analytics.js</code> 并开始统计用户行为。</p><a></a><h1><a href="https://blog.nfz.moe/archives/google-analytics-optimize.html#Google-Analytics- 异步方案的必要性"></a>Google Analytics 异步方案的必要性 </h1><p> 虽然现在 Google Analytics 的 <code>www.google-analytics.com</code> 和 <code>ssl.google-analytics.com</code> 已经重新解析回谷歌在国内那 200 多台服务器了，所以 Google Analytics 已经不用再担心被墙而导致网站加载慢和无法采集到数据的问题了。</p><p>然而，浏览器端经常有意无意的，包括常见的 Ad­block 扩展等自带的屏蔽列表，利用 user­script 等方式，屏蔽 Google An­a­lyt­ics。这导致了数据统计不准的问题。</p><p>在 JerryQu 的 <a href="https://imququ.com/post/summary-of-my-blog-optimization.html" target="_blank">《本博客零散优化点汇总》</a> 一文中提到他是如何处理 Google Analytics 的：</p><blockquote><p>把统计逻辑挪到了服务端；自己生成用户唯一标识，获取访问页面的标题、URL、Referer，获取用户 IP 和浏览器 UA，随着每次访问发给 Google 的统计地址。服务端向 Google 发起的请求是异步的，用户端访问速度丝毫不受影响。</p></blockquote><p>Google Analytics 的 <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/reference" target="_blank"> 官方文档 </a> 给出了相关介绍，Google 也提供了 <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/" target="_blank">Measurement Protocol</a>。</p><h1><a href="https://blog.nfz.moe/archives/google-analytics-optimize.html#Google-Analytics- 异步方案介绍"></a>Google Analytics 异步方案介绍 </h1><p> 目前常见的是这两种方法：完整的后端方案和前端和后端搭配的方案。</p><blockquote><p>前者通过配置 Nginx，使用 uid 模块和 proxy_pass 向后端转发请求；后者的方案则是通过 JS 发送请求给中转服务，再由中转服务器异步发送给 Google。对于前者的解决方案的实现可以阅读下述文章：</p></blockquote><ul><li><a href="https://darknode.in/network/nginx-google-analytics/" target="_blank">《Ng­inx 内配置 Google An­a­lyt­ics 指南》</a></li><li><a href="https://eason-yang.com/2016/11/04/google-analytics-via-nginx/" target="_blank">《使用 Nginx 将请求转发至 Google Analytics 实现后端统计》</a></li></ul><p>还有一种方案，就是在前端通过 JS 发起一个请求、生成用户端的信息带到请求的 URI 上，然后后端的有关程序监听这个请求，并异步发送给 Google。</p><blockquote><p>对于这种解决方案，有人写了一个 Node.js（基于 ThinkJS） 的程序实现：<a href="https://blog.alphatr.com/google-analytics-on-server.html" target="_blank">《服务端使用 Google Analytics》</a></p></blockquote><h1><a href="https://blog.nfz.moe/archives/google-analytics-optimize.html#PHP- 的轮子"></a>PHP 的轮子 </h1><p> 我想，没有 Node.js 支持的虚拟主机，又不是所有人都有独立的 VPS 的，也不是所有人都使用 Node.js 的。所以我根据这种思路，找到了个 PHP 版的。</p><pre><code><span>&lt;?php</span><span>// ********************</span><span>// * Author: stneng</span><span>// * Date: 2016.12.11</span><span>// * Introduction: https://u.nu/ytq</span><span>// *********************</span>    <span>header</span><span>(</span><span>&quot;status: 204&quot;</span><span>)</span><span>;</span>    <span>header</span><span>(</span><span>&quot;Cache-Control: no-cache, max-age=0&quot;</span><span>)</span><span>;</span>    <span>header</span><span>(</span><span>&quot;Pragma: no-cache&quot;</span><span>)</span><span>;</span>    <span>$tid</span><span>=</span><span>''</span><span>;</span>  <span>// 在这里写 Google Analytics 给的 tid，形如：UA-XXXX-Y</span>    <span>function</span> <span>create_uuid</span><span>(</span><span>)</span><span>{</span><span>$str</span> <span>=</span> <span>md5</span><span>(</span><span>uniqid</span><span>(</span><span>mt_rand</span><span>(</span><span>)</span><span>,</span> <span>true</span><span>)</span><span>)</span><span>;</span>        <span>$uuid</span> <span>=</span> <span>substr</span><span>(</span><span>$str</span><span>,</span><span>0</span><span>,</span><span>8</span><span>)</span> <span>.</span> <span>'-'</span><span>;</span>        <span>$uuid</span> <span>.</span><span>=</span> <span>substr</span><span>(</span><span>$str</span><span>,</span><span>8</span><span>,</span><span>4</span><span>)</span> <span>.</span> <span>'-'</span><span>;</span>        <span>$uuid</span> <span>.</span><span>=</span> <span>substr</span><span>(</span><span>$str</span><span>,</span><span>12</span><span>,</span><span>4</span><span>)</span> <span>.</span> <span>'-'</span><span>;</span>        <span>$uuid</span> <span>.</span><span>=</span> <span>substr</span><span>(</span><span>$str</span><span>,</span><span>16</span><span>,</span><span>4</span><span>)</span> <span>.</span> <span>'-'</span><span>;</span>        <span>$uuid</span> <span>.</span><span>=</span> <span>substr</span><span>(</span><span>$str</span><span>,</span><span>20</span><span>,</span><span>12</span><span>)</span><span>;</span>        <span>return</span> <span>$uuid</span><span>;</span>    <span>}</span>    <span>if</span> <span>(</span><span>!</span><span>isset</span><span>(</span><span>$_COOKIE</span><span>[</span><span>&quot;uuid&quot;</span><span>]</span><span>)</span><span>)</span> <span>{</span><span>$uuid</span><span>=</span><span>create_uuid</span><span>(</span><span>)</span><span>;</span>        <span>setcookie</span><span>(</span><span>&quot;uuid&quot;</span><span>,</span> <span>$uuid</span> <span>,</span> <span>time</span><span>(</span><span>)</span><span>+</span><span>368400000</span><span>)</span><span>;</span>    <span>}</span><span>else</span><span>{</span><span>$uuid</span><span>=</span><span>$_COOKIE</span><span>[</span><span>&quot;uuid&quot;</span><span>]</span><span>;</span>    <span>}</span>    <span>if</span> <span>(</span><span>function_exists</span><span>(</span><span>&quot;fastcgi_finish_request&quot;</span><span>)</span><span>)</span> <span>{</span><span>fastcgi_finish_request</span><span>(</span><span>)</span><span>;</span> <span>// 对于 fastcgi 会提前返回请求结果，提高响应速度。</span>    <span>}</span>    <span>$url</span><span>=</span><span>'v=1&amp;t=pageview&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'tid='</span><span>.</span><span>$tid</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'cid='</span><span>.</span><span>$uuid</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'dl='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_SERVER</span><span>[</span><span>'HTTP_REFERER'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'uip='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_SERVER</span><span>[</span><span>'REMOTE_ADDR'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'ua='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_SERVER</span><span>[</span><span>'HTTP_USER_AGENT'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'dt='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'dt'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'dr='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'dr'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'ul='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'ul'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'sd='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'sd'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'sr='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'sr'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'vp='</span><span>.</span><span>rawurlencode</span><span>(</span><span>rawurldecode</span><span>(</span><span>$_GET</span><span>[</span><span>'vp'</span><span>]</span><span>)</span><span>)</span><span>.</span><span>'&amp;'</span><span>;</span>    <span>$url</span><span>.</span><span>=</span><span>'z='</span><span>.</span><span>$_GET</span><span>[</span><span>'z'</span><span>]</span><span>;</span>    <span>$url</span><span>=</span>'https<span>:</span><span>//www.google-analytics.com/collect?'.$url;</span>    <span>$ch</span><span>=</span><span>curl_init</span><span>(</span><span>)</span><span>;</span>      <span>curl_setopt</span><span>(</span><span>$ch</span><span>,</span> <span>CURLOPT_URL</span><span>,</span> <span>$url</span><span>)</span><span>;</span>      <span>curl_setopt</span><span>(</span><span>$ch</span><span>,</span> <span>CURLOPT_RETURNTRANSFER</span><span>,</span> <span>true</span><span>)</span><span>;</span>      <span>curl_exec</span><span>(</span><span>$ch</span><span>)</span><span>;</span>      <span>curl_close</span><span>(</span><span>$ch</span><span>)</span><span>;</span><span>?&gt;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将上述代码保存为 <code>ga.php</code>，放在网站根目录。</p><blockquote><p>当然你也可以命名为其它的，不过你需要修改下述提到的 script。</p></blockquote><p>在页面中插入下述代码：</p><pre><code><span><span><span>&lt;</span>script</span><span>&gt;</span></span>!function(e,n,o){var t=e.screen,a=encodeURIComponent,r=[&quot;dt=&quot;+a(n.title),&quot;dr=&quot;+a(n.referrer),&quot;ul=&quot;+(o.language||o.browserLanguage),&quot;sd=&quot;+t.colorDepth+&quot;-bit&quot;,&quot;sr=&quot;+t.width+&quot;x&quot;+t.height,&quot;vp=&quot;+e.innerWidth+&quot;x&quot;+e.innerHeight,&quot;z=&quot;+ +new Date],i=&quot;?&quot;+r.join(&quot;&amp;&quot;);e.__beacon_img=new Image,e.__beacon_img.src=&quot;/ga.php&quot;+i}(window,document,navigator,location);<span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span></span></span></code></pre><blockquote><p>上面这段代码是直接修改自 imququ.com 的 <code>ana_js</code><br />屈哥在 Disqus 把他这部分 javascript 的源码给了我，如下：</p></blockquote><pre><code><span>(</span><span>function</span><span>(</span>window<span>,</span> document<span>,</span> navigator<span>,</span> location<span>)</span> <span>{</span><span>var</span> screen <span>=</span> window<span>.</span>screen<span>;</span><span>var</span> encode <span>=</span> encodeURIComponent<span>;</span><span>var</span> data <span>=</span> <span>[</span><span>'dt='</span> <span>+</span> <span>encode</span><span>(</span>document<span>.</span>title<span>)</span><span>,</span><span>'dr='</span> <span>+</span> <span>encode</span><span>(</span>document<span>.</span>referrer<span>)</span><span>,</span><span>'ul='</span> <span>+</span> <span>(</span>navigator<span>.</span>language <span>||</span> navigator<span>.</span>browserLanguage<span>)</span><span>,</span><span>'sd='</span> <span>+</span> screen<span>.</span>colorDepth <span>+</span> <span>'-bit'</span><span>,</span><span>'sr='</span> <span>+</span> screen<span>.</span>width <span>+</span> <span>'x'</span> <span>+</span> screen<span>.</span>height<span>,</span><span>'_='</span> <span>+</span> <span>(</span><span>+</span><span>new</span> <span>Date</span><span>)</span><span>]</span><span>;</span><span>var</span> query <span>=</span> <span>'?'</span> <span>+</span> data<span>.</span><span>join</span><span>(</span><span>'&amp;'</span><span>)</span><span>;</span>window<span>.</span>__beacon_img <span>=</span> <span>new</span> <span>Image</span><span>(</span><span>)</span><span>;</span>window<span>.</span>__beacon_img<span>.</span>src <span>=</span> <span>'/ga.php'</span> <span>+</span> query<span>;</span><span>}</span><span>)</span><span>(</span>window<span>,</span> document<span>,</span> navigator<span>,</span> location<span>)</span><span>;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段 JS 代码完成了 URI 生成和发起请求两个操作。</p><p>后端 PHP 程序包含了 uuid 生成、cookie 校验和转发请求三个部分。</p><p>首先是用 md5 生成符合 Google Analytics 的唯一用户 uid，作为辨别不同用户的依据。<br />然后会从客户端的 cookie 来进行匹配，判断是否是回访的访客。如果客户端没有相关 cookie，这个请求就会把 uuid 写进用户端的 cookie 中。<br />然后就是解析 URI，通过请求采集请求的 URI 获取有关信息，然后组成 <code>www.google-analytics.com/collect</code> 适用的 URI。<br />最后就是服务端通过发起 cURL 请求 <code>www.google-analytics.com</code>，把统计的页面行为提交给 Google 即可。</p><blockquote><p>上述代码你可以在 <a href="https://gist.github.com/neoFelhz/4bc074783641b1ba9f4484cd232765e7" target="_blank"> 我的 gist</a> 中下载。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/google-analytics-optimize.html# 异步方案的性能分析"></a>异步方案的性能分析</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000122.png" /></p><p>上图上半部分是使用 Google Analytics 的 Tracker Code 的前端响应速度，下半部分是我使用 PHP 程序异步的 Google Analytics 统计的性能表现。</p><blockquote><p>使用 <code>https://blog.viosey.com</code> 和 <code>https://blog.nfz.moe</code> 做的测试。</p></blockquote><p>使用 Google Analytics 的 Tracker Code 需要加载一个大小 30k 左右的脚本（可被缓存），整个统计需要花费 90ms 左右（还不包括中间异步等待时的时间）。使用我的异步统计方案大概需要 85ms - 100ms。虽然速度相差无几，但是异步方案无需加载 JS，而且如果主机性能能再好一些，后端 PHP 运行速度再快一些，完全可以将时间控制在 50ms 以内。</p>]]></content>
        
        <summary type="html">
            
            一般地，网站配置 Google An­a­lyt­ics 的常见方式是在网站前端引用 Google Analytics 的 trackercode，然后获取 analytics.js 并开始统计用户行为。Google Analytics 异步方案的必要性  虽然现在 Googl
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="访问统计"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="Google Analytics"/>
        
    </entry>
    
    <entry>
        <title>基于 React 的 SEO 友好的博客</title>
        <link href="https://blog.poi.cat/make-a-react-based-blog-seo-friendly"/>
        <id>https://blog.poi.cat/make-a-react-based-blog-seo-friendly</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-06-15T13:35:03+00:00</published>
        <updated>2017-06-15T13:35:03+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><p>嗯, 没错, 又是一篇 &quot;如何打造一个 XXX 的博客&quot; 的文章.</p><p>这里的 XXX 是 &quot;<strong>基于 React 的 SEO 友好</strong>&quot;.</p><blockquote><p>Search engine optimization (SEO) 即 <strong>搜索引擎优化</strong></p></blockquote><p>什么? React? 你不是 <a href="https://blog.poi.cat/post/introducing-solomon/">Angular 的教徒</a> 吗? 怎么叛变到 React 了呢?</p><p>嗯, 这就说来话长了.</p><h2>Angular 还未达到 SEO-friendly 的程度</h2><p>单页应用一直有一个令人诟病的问题就是就是其对搜索引擎不友好.</p><p>究其原因, 就是单页应用核心就是 JavaScript 应用, 而一般的搜索引擎都只在乎你页面的 HTML 而对于其中的 JavaScript 是不会执行的.</p><p>虽然 Google <a href="https://developers.google.com/webmasters/ajax-crawling/">曾经表示会抓取单页应用</a> (对 Ajax 的结果进行缓存), 但是现在已经表示已经 <a href="https://webmasters.googleblog.com/2015/10/deprecating-our-ajax-crawling-scheme.html">不再支持了</a>.</p><p><img src="https://c1.staticflickr.com/5/4269/34513373373_3b51f0d1e1_o.png" /></p><p><em>用 Google 自家的框架 Angular 写的 Solomon 在 Google Search 下只能显示一个可怜标题(2017-6-15)</em></p><p>难道单页应用就是不能实现 SEO 吗? 并不是, 还是可以通过一种名叫 Server-side rendering(服务器端预渲染) 的方式来实现的.</p><p>Angular 的 Server-side Rendering API 叫 Angular Univeral API, 并且 <a href="https://github.com/angular/angular/issues/13822">也已经整合进了 Angular 4</a>.</p><p>虽然前景是好的, 但是目前支持的 Angular Universal 的库少之又少, 难怕是 Angular 官方的 Angular Material 也 <a href="https://github.com/angular/material2/issues/308">尚未支持</a>.</p><p>而相比之下, React 的 Server-side Rendering API: <code>ReactDOMServer.renderToString()</code> 则适用程度大了很多, 至少我目前还没有发现不支持的库.</p><blockquote><p>当然也有可能是 React 的 API 实现的非常简单, 生成 HTML 时, 只调用了 <code>constructor()</code>, <code>componentWillMount()</code>, <code>render()</code>, <code>componentDidMount()</code> 几个方法.</p></blockquote><p>所以我叛教了 :)</p><h2>react-snapshot &amp; react-helmet</h2><p>想调用 React 的 Server-side Rendering 的 API 的话, 最简单的方法是使用 react-snapshot.</p><p>它和 creat-react-app (一个类似 Angular Cli 的命令行工具) 整合得很好, 只需要将 <code>render()</code> 替换成 React-Snaport 提供的 <code>render()</code> 即可. 它会在 Developer Mode 的时候调用 <code>Render.render()</code> 和之前一样; 在 Production Mode 的时候调用 <code>ReactDomServer.toSting()</code>.</p><p>在运行 <code>react-scripts build</code> 后再运行 <code>react-snapshot</code>, 就会开启一个爬虫, 将所以的页面遍历一遍后, 导出至 HTML.</p><p>运行结果:</p><p><img src="https://c1.staticflickr.com/5/4288/35156879512_a5f49cc4d1_o.png" /></p><p>使用 w3m 访问 About 页面的结果:</p><p><img src="https://c1.staticflickr.com/5/4208/35156881432_ecd658d958_o.png" /></p><p>同时也保留了单页应用不需要重复加载的优点:</p><p><img src="https://c1.staticflickr.com/5/4224/34936141690_8824e95d2d_o.png" /></p><p><em>从 About 页面进入之后, 我重复切换了几次页面, 但是 Network 里都没有出现新的请求</em></p><blockquote><p>原理是什么? 每一个单页应用都有一个 <code>index.html</code> 作为的入口.</p><p>而使用了 react-snapshot 之后, 你的单页应用相当于有了同时多个不同入口, 或者说你同时拥有了复数个功能相同的单页应用.</p></blockquote><p>react-snapshot 目前还有一个问题 (对我来说), 它会将路径 <code>/path/to/page</code> 保存为 <code>/path/to/page.html</code>, 但是并不是所有的服务器都可以识别, 例如 Python 的 SimpleHTTPServer 就不行. 所以我写了 <a href="https://github.com/PoiScript/Solomon/blob/dev/react/scripts/moving-html.js">一个小脚本</a>, 将保存好的 <code>/path/to/page.html</code> 重命名为 <code>/path/to/page/index.html</code>.</p><blockquote><p>我给 react-snapshot 推了一个 <a href="https://github.com/geelen/react-snapshot/pull/36">Pull Request</a>, 增加将页面保留保存为 <code>/path/to/page/index.html</code> 的形式, 希望可以被合并, 这样就能省去这一步了.</p></blockquote><p>如果说 react-snapshot 让你的单页应用里的 <code>body</code> 标签搜索引擎可见的话, 那 react-helmet 就可以让你的单页应里的 <code>head</code> 标签能被搜索引擎爬到了.</p><p>而 <code>head</code> 中的 <code>meta</code> 标签更是 SEO 的关键之一, 通过它我们可以主动给爬虫提供重要的信息, 例如文章的作者, 发布时间等.</p><h2>更进一步</h2><p>嗯, 经过 react-snapshot 和 react-helmet 处理之后, 已经能够完全满足 SEO 的需求了.</p><blockquote><p>其实文章写到这里, 除了一些关于 Angular 的吐槽和 react-snapshot 的小修改的话, 和 Medium 上的 <a href="https://medium.com/superhighfives/an-almost-static-stack-6df0a2791319">这篇文章</a> 没什么区别.</p></blockquote><p>但是还有一些缺点, 在说之前, 先说一下为什么单页引用可以提高网页的响应速度, 减少资源的加载次数.</p><p>因为单页应用虽然在第一个页面的时候, 需要加载更多的内容 (毕竟还要加载 JavaScript) 但是在访问第二个, 第三个页面的时候, 则不需要请求任何的资源, 因为它们是由你的浏览器动态生成的.</p><blockquote><p>假设你访问一个传统的静态网页, 每访问一个页面, 你可能只需要 60 的数据量, 但是你每访问一个页面都需要 60 的数据量. 而访问一个单页应用, 你需要 200 的数据量 --- 但是从头到尾都只需要这 200 的数据量.</p></blockquote><p>所以使用 react-snapshot 之后, 可以达到切换页面不需要重新载入文字的原因是, 它其实是将你的所有文字都写入了 JavaScript.</p><p>以上面的 Medium 那篇文章中给的 Demo: https://yadg.surge.sh/ 为例, <code>/</code> 和 <code>/about</code> 的文字都写进了 JavaScript 里, 所以才能做到流畅的切换(因为全部帮都下载来了...):</p><p><img src="https://c1.staticflickr.com/5/4282/35156880482_e19f536f76_o.png" /></p><p>所以假设你有上百篇文章的话, 造成的结果就是用户需要在加载的完全部的文章之后才可以正常使用你的博客 (在没有加载完剩余的文章之前, 用户只能盯着当前的页面什么都做不了).</p><blockquote><p>如果访问一个单页应用需要 2000 的数据量的话, 那还值得吗?</p><p>虽然目前来说也就我的博客也就几篇文章, 远远达不到 2000 数据量的程度, 不过随着时间的增长, 这个问题只会越来越明显.</p></blockquote><p>所以我做了一个改进: 在 React 中使用 XHR (XML HTTP Request) 获取文章, 而不是用上面 Medium 里用 Component 的形式. 这样就不需要全部写进 JavaScript 里了.</p><p>等一下, 如果使用 XHR 的话, 在调 <code>render()</code> 的时候, 是不会含有文字的: 因为 XHR 请求是异步, 而 React 中的 <code>setState</code> 函数也是异步的.</p><p>没错, 就是空标签. 那么说好的 SEO 呢? 很简单, 把生成的 HTML 里的空标签 <a href="https://github.com/PoiScript/Solomon/blob/dev/react/scripts/replace-html.js">替换成我们的文章</a> 即可. :)</p><blockquote><p>提示: 直接替换生成的 HTML 文件是一个危险的行为, 最好替换普通的标签, 不要替换 React Component 生成的标签.</p><p>因为如果随意替换的话, 可以会丢掉带有额外属性 (例如: <code>data-reactid</code>) 的标签. 其中 <code>data-reactid</code> 是 React 给每一个 Component 的一个唯一的标识符, 如果缺少了其中的某一个的话, 会导致 React 停止工作.</p></blockquote><h2>后语</h2><p>在经过上述的步骤之后, 我们的博客将拥有一下特性:</p><ol><li><p>基于 React 模型</p></li><li><p>博客中的每一个链接都是可以直接打开, 而不需要将路由重写至 <code>index.html</code>. 而且每一个页面都有 Server-side rendering, 可以被搜索引擎爬到, 哪怕是不支持 JavaScript 的纯文本浏览器 (例如 w3m) 也可以直接访问, 而不会显示那个臭名昭著的 &quot;Loading&quot;. :)</p></li><li><p>在打开一个页面之后, 除非是查看一篇新的文章, 否则, 不需要再加载任何的资源. 而查看一篇新的文章时, 也只需要加载文章本身的 HTML, 其他组件, CSS 都不需要重新加载.</p></li></ol><p>这是我想到的目前来说, 最完美的单页应用的 SEO 的解决方案.</p><p>有什么疑问的话, 可以查看 Solomon 中 <a href="https://github.com/PoiScript/Solomon/tree/dev/react"><code>/react</code></a> 的源码, 当然也欢迎向我提问.</p><blockquote><p>没错, 我已经打算将 Solomon-React 和 Solomon-AMP 合并到一个 repo 了. :)</p></blockquote><hr /><p>算上这篇文章, 我的博客里几乎半数以上都是 &quot;如何打造一个 XXX 的博客&quot; 的文章了 :( , 一点都不技术 poi.</p><p>接下来我大概会继续我的 Rust 学习之旅, 然后... 等到我做了些真正有趣的东西再和大家分享吧.</p>]]></content>
        
        <summary type="html">
            
            前言嗯, 没错, 又是一篇 &amp;quot;如何打造一个 XXX 的博客&amp;quot; 的文章.这里的 XXX 是 &amp;quot;基于 React 的 SEO 友好&amp;quot;.Search engine optimization (SEO) 即 搜索引擎优化什么? React? 你不
            
        </summary>
        
        <category term="blog"/>
        
        <category term="react"/>
        
        <category term="seo"/>
        
    </entry>
    
    <entry>
        <title>让 Ghost 吃上 APlayer</title>
        <link href="https://i-meto.com/ghost-aplayer/"/>
        <id>https://i-meto.com/ghost-aplayer/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-06-14T14:14:43+00:00</published>
        <updated>2017-06-14T14:14:43+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<img src="https://image.static.i-meto.com/uploads/2017/12/music.jpg" /><p>之前围绕着 DIYgod 做的 HTML5 音乐播放器 APlayer 做了不少东西，然而因为种种原因并没有给自己的博客挂上。</p>
<p>Wordpress 有 <a href="https://github.com/liwanglin12/Hermit-X">Hermit-X</a>，Typecho 有 <a href="https://github.com/MoePlayer/APlayer-Typecho">APlayer-Typecho</a>, 然而 Ghost 什么也没有，主要是官方一直没给出插件开发的文档。</p>
<p>于是我花了一点时间，开发了一个云解析的播放器「插件」，主要原理是由 JS 解析短标签的数据，从 API 请求歌曲信息，再在用户端进行生成播放器。目前已经发布在 <a href="https://github.com/metowolf/MetingJS">https://github.com/metowolf/MetingJS</a></p>
<p><strong>理论上这个方式可以在任何网站上使用，并且允许用户自定义自己的 API.</strong></p>
<p>期间遇到了不少问题，诸如样式炸裂、跨域、异步请求等等，不过都解决了。</p>
<p>下面记录一下简化后的步骤：</p>
<h3>引入依赖</h3>
<p>首先进入后台，进入 <code>Code Injection</code> 菜单，在 <code>Blog Header</code> 加入代码</p>
<pre><code>&lt;style&gt;
    li {margin: 0em 0;}
    button {min-height: 0px;}
    .aplayer {margin: 0 0 1.75em 0 !important;}
&lt;/style&gt;

&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css&quot;&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>*其中 css 部分是为了修复主题和播放器不兼容的部分</p>
<p>然后在 <code>Blog Footer</code> 中添加</p>
<pre><code>&lt;script src=&quot;https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>至此，播放器已经引入成功了</p>
<h3>使用</h3>
<p>在文章中想要的位置添加如下的代码即可</p>
<pre><code>&lt;div class=&quot;aplayer&quot; data-id=&quot;60198&quot; data-server=&quot;netease&quot; data-type=&quot;playlist&quot; data-mode=&quot;random&quot;&gt;&lt;/div&gt;
</code></pre>
<p>其中的参数如下，<strong>加粗表示必须</strong></p>
<ul>
<li><strong>data-id</strong>: 歌曲/专辑/歌单 ID</li>
<li><strong>data-server</strong>: 音乐平台，支持如下参数
<ul>
<li>netease</li>
<li>tencent</li>
<li>xiami</li>
<li>kugou</li>
<li>baidu</li>
</ul>
</li>
<li><strong>data-type</strong>: 请求类型，支持如下参数
<ul>
<li>song （单曲）</li>
<li>album （专辑）</li>
<li>playlist （歌单）</li>
<li>search （搜索）</li>
</ul>
</li>
<li>data-order: 播放模式
<ul>
<li>random （随机）</li>
<li>list* （列表）</li>
</ul>
</li>
<li>data-autoplay: 自动播放
<ul>
<li>false*</li>
<li>true</li>
</ul>
</li>
</ul>
<p>更多参数详见 <a href="https://github.com/metowolf/MetingJS#option">https://github.com/metowolf/MetingJS#option</a></p>
<h3>更新日志</h3>
<ul>
<li>1.1.0 支持 APlayer 1.7.x</li>
<li>1.0.1 兼容普通模式下的 APlayer</li>
<li>1.0.0 框架重写，更名 MetingJS</li>
</ul>
<h3>演示</h3>
<pre><code>&lt;div class=&quot;aplayer&quot; 
    data-id=&quot;933900516&quot; 
    data-server=&quot;netease&quot; 
    data-type=&quot;playlist&quot; 
    data-order=&quot;random&quot;&gt;
&lt;/div&gt;
</code></pre>
<div>
</div>
<pre><code>&lt;div class=&quot;aplayer&quot;
    data-name=&quot;rainymood&quot;
    data-artist=&quot;rainymood&quot;
    data-url=&quot;https://rainymood.com/audio1110/0.m4a&quot;
    data-cover=&quot;https://rainymood.com/i/badge.jpg&quot;&gt;
&lt;/div&gt;
</code></pre>
<div>
</div>
<table>
<thead><tr><th>项目</th><th>作者</th><th>说明</th></tr></thead>
<tbody>
<tr>
  <td><a href="https://github.com/metowolf/MetingJS">MetingJS</a></td>
  <td>METO</td>
  <td>a beautiful HTML5 music player (with Meting API)</td>
</tr>
<tr>
  <td><a href="https://github.com/DIYgod/APlayer">APlayer</a></td>
  <td>DIYgod</td>
  <td>a beautiful HTML5 music player</td>
</tr>
<tr>
  <td><a href="https://github.com/metowolf/Meting">Meting</a></td>
  <td>METO</td>
  <td>a powerful music API framework</td>
</tr>
</tbody></table></div>]]></content>
        
        <summary type="html">
            
             之前围绕着 DIYgod 做的 HTML5 音乐播放器 APlayer 做了不少东西，然而因为种种原因并没有给自己的博客挂上。 Wordpress 有 Hermit-X，Typecho 有 APlayer-Typecho, 然而 Ghost 什么也没有，主要是官方一直没给出插
            
        </summary>
        
    </entry>
    
    <entry>
        <title>SS+Cow代理配置</title>
        <link href="https://131.re/marchives/101"/>
        <id>https://131.re/marchives/101</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-06-13T04:00:00+00:00</published>
        <updated>2017-06-13T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>此方案适用于有境外SS账号+境内服务器的人</p>

<p>首先安装<a href="https://github.com/cyfdecyf/cow" target="_blank">Cow</a>：</p>
<pre><code>curl -L git.io/cow | bash
</code></pre>
<p>然后编辑<code>~/.cow/rc</code>，修改以下内容：</p>
<pre><code>listen = http://127.0.0.1:7777
</code></pre>
<pre><code>proxy = ss://[SS加密方式]:[SS密码]@[SS服务器地址]:[SS服务器端口]
</code></pre>
<p>切换至安装Cow的目录，然后执行：</p>
<pre><code>nohup ./cow &amp;
</code></pre>
<p>最后设置系统代理，执行：</p>
<pre><code>export http_proxy=http://127.0.0.1:7777/
export https_proxy=$http_proxy
export ftp_proxy=$http_proxy
export rsync_proxy=$http_proxy
</code></pre>
<p>这样就配置完毕了，不过部分流量仍不会直接走Cow的代理，需要另行配置</p>
<p>PS：Cow不会自启动，请手动配置</p>]]></content>
        
        <summary type="html">
            
            此方案适用于有境外SS账号+境内服务器的人  首先安装Cow： curl -L git.io/cow | bash  然后编辑~/.cow/rc，修改以下内容： listen = http://127.0.0.1:7777  proxy = ss://[SS加密方式]:[SS密
            
        </summary>
        
    </entry>
    
    <entry>
        <title>真正的自由？——从杨舒平的演讲来谈中国和言论自由</title>
        <link href="https://blog.nfz.moe/archives/my-view-of-freedom.html"/>
        <id>https://blog.nfz.moe/archives/my-view-of-freedom.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-06-07T17:28:00+00:00</published>
        <updated>2017-06-07T17:28:00+00:00</updated>
        
        <content type="html"><![CDATA[<p> 在前天，也就是那个特殊的日子的前一天晚上，我和几个同学彻夜长谈。我们谈了很多东西，我思绪万千，所以我决定写点东西出来。</p><a></a><p> 让我先从端午节的辱华演讲说起吧。</p><blockquote><p> 顺便说一句，辱华演讲这个事情出来以后，很显然中国国内的媒体就这两个反应：要么洗白国内的空气，要么就是有组织有意识地引导舆论批判杨舒平。为了获得一个更客观的认知，我在 YouTube 上看了完整的视频，看了维基百科对该事件的介绍，甚至还浏览了一些著名反华势力的媒体的新闻。</p></blockquote><p> 杨舒平的演讲是以“国外的空气都是甜美的”一句话开场的，然后用美国的空气和中国的空气进行对比，然后比对了两国的“空气”：美国开放自由的环境和中国压抑的环境。<br /> 不知为何，这个演讲被断章取义之后就成了“辱华演讲”。</p><p> 嗯，那就让我先从杨舒平口中的空气质量说起吧。</p><p> 首先，无论如何，你必须承认，中国国内现在的空气质量就是不如美国。因为，美国已经走过了这一段道路。</p><blockquote><p> 在几年前，我曾阅读过《洛杉矶烟雾启示录》一书，这本书详细的介绍和审视了自 1943 年出现在洛杉矶的雾霾、到 1963 年蓝色的有毒烟雾弥漫、到上个世纪 80 年代彻底解决空气质量问题这一段时间里，洛杉矶政府的政策和美国公民的生活。</p></blockquote><p> 最早出现严重空气污染的城市是第一次工业革命的发源地——“雾都”伦敦。直到 19 世纪末，伦敦才彻底摘掉“雾都”的帽子。美国的洛杉矶和丹佛治理空气也花了 30 年。我们必须承认，治理空气需要努力，但不是北京市政府拍拍胸脯说几年就可以搞定的。这个是一个艰苦卓绝的过程。我们要做的就是正视这个事实，然后坦然接受这个事实，然后开始努力。</p><blockquote><p> 而不是像清华的校长在演讲中说，“我就是觉得国内的空气甜美”。那是您运气不错，端午节前十天左右一场大风，把帝都的雾霾吹散了。</p></blockquote><p> 当然，我不仅仅只是谈空气的问题。杨舒平举这个例子，是为了谈美国的自由。在杨舒平眼里，美国是一个充斥着开放和自由的空气的国度，在美国你可以较为自由地发表一些观点。而在中国要处处拘谨，甚至要担心触动利益被迫离开中国。</p><blockquote><p> 柴静，著名的媒体人。《穹顶之下》这部纪录片揭露了山东临沂和国内其它“重灾区”的空气问题。如今，《穹顶之下》因为触动了多方利益，已经全部禁播。</p></blockquote><p> 对于我们这些生活在下层的人民，对于“言论自由”，可能领会的更深刻一些。<br /> 首先是赵薇事件。我去年三月份是在新浪微博亲身经历过这个事件的。赵薇一人就敢买通百度搜索引擎，买通整个渣浪微博，严格压制全网的言论，连共青团中央发声的微博都会被屏蔽和删除（twice）。网民自然就要想了：上不了谷歌我认了，土共太强大；但是你个下九流都能控制言论，这可不能忍。</p><p> 这本是件无足挂齿的小事，一开始大家其实并不怎么在意，但是在事件发展的过程中赵薇团队却意外的向我们展示了资本的真实面目：赵薇背后势力庞大，我们本来就知道，但我们不知道的是这些势力在民意面前如此肆无忌惮。<br /> 别人我不清楚，至少我感到了深深的恐惧。中国大陆言论自由的界限是政府画的，还好它画的很宽，就那么几条红线，所以我们平日里一般的言论是相对自由的。然而，资本家公然控制言论的行为还是令人震惊的。</p><p> 说到政府的红线，我们自然是想到搜索引擎的“根据相关法律法规”，著名的防火长城。嗯，当然现在还多了一条，今年六月一日开始生效的中国国家网络安全法。</p><blockquote><p> 现在的国家网络安全法就有那么几条，比如现在的网民必须实名，至少绑定手机号；经营博客、论坛类业务也必须备案。原因很简单，控制言论呗：谁造谣，谁搞事，就抓谁。当然我也必须承认，实名的好处是有的，至少微信朋友圈（著名造谣圈）里的类似于 水洗肉松 和 塑料粉丝 的言论将会受到制裁、基站辐射之类的谣言也有望得到整治。</p></blockquote><p> 之所以在这个日子感慨万千，原因很简单——二十几年前的那一天，可以是正式宣告中国的言论自由被压制。</p><p> 当然，对于网民来说，印象深刻的，还是防火长城。</p><blockquote><p> 那还是 2011 年， Google 暂时妥协了中国政府的要求，禁止用户搜索一些敏感词汇（甚至包括“胡萝卜”“学习”“温度计”），再后来就是 Google 拒绝妥协，并主动离开了中国。</p></blockquote><p> 政府压制言论自由是有他们的原因的，我们要客观理性的对待，这一点我之后会再谈我自己的看法。不过，政府造墙，一个副作用就是给反华势力提供了机会。</p><ul><li> 赛风，著名的翻墙软件，联通他们的境外服务器后会首先弹出一个境外反华势力的媒体网站。</li><li> 蓝灯，由国外反华势力赞助。</li><li>GreatFire 旗下的自由浏览器，其主页是一个充斥着反华媒体新闻的主页。</li><li>. . . . . .</li></ul><p> 反华势力热衷于不遗余力地对那些能够初级翻墙的中国国民进行洗脑。</p><blockquote><p> 比如我的生物老师竟然都相信活摘器官，当初听他讲选修课时提到这个令我胆战心惊。再比如被压制下来的广州高考模拟题中英语科目试卷七选五部分竟然出现介绍 神韵 的文章。不得不承认，反华势力为了颠覆中国，是不遗余力和不择手段的。</p></blockquote><p> 反华势力想搞翻中国，并不是单纯想看着好玩的。他们自然背后有他们的利益相关。至于那些欧美国家，则选择将这些反华势力作为和中国谈判的筹码（比如给达赖五世发个诺贝尔和平奖恶心中国一下）。反华势力背后更有势力和财力，赞助一些低级 FQ 工具来推广那些反华势力的信息，自然是可以理解的了。</p><blockquote><p> 我们当然也要认识到，欧美国家的这些举措不过是外交伎俩，并不能完整代表欧美国家的立场。中国是世界贸易中重要的一部分，是不可或缺的。</p></blockquote><p> 那么为什么中国政府需要一道长城来压制我们的获取外部信息的渠道？要知道，就连北邮前校长方滨兴曾经都发言承认说我们不应该墙一些学术类网站和 Play 商店之类的服务。</p><p> 我另外举一些例子来说明一下吧。</p><p> 为什么水洗肉松、塑料粉丝为什么会有人信？还有小区基站。多少小区的大爷大妈写联名信、拉横幅、搞游行要求拆除基站，宣称辐射？渣浪微博上甚至有人造谣说他所在的公司在基站附近工作，竟然一半的员工患上甲状腺癌。<br /> 对了，还有变电站。天津一个小区要求不能在小区附近建设高压变电站，担心辐射。今年年初还有听说华北某地区正在计划要修新的核电站（微博上看到的，具体位置不记得了），甚至引发了闹事。我想，这个工程应该是已经被搁置了。<br /> 还有 B 超。有人宣传给孕妇做 B 超会破坏水分子诱发癌症。微博上还有人说汽车尾部的车距激光定位装置的红光能割伤手，甚至有人信誓旦旦出来作证，“展示被激光割伤的伤口”。<br /> 当然还有就在我写本文时刚刚被渣浪微博禁了 30 天的崔永元，他有一批忠实的粉丝坚持和他反转基因，那些粉丝还跟着崔化钠攻击微博大 V、渣浪微博的老总来去之间，连共青团和紫光阁都不放过， 崔永元甚至骂过上合组织是草台班子、还直面攻击网信办。</p><blockquote><p> 当然，我再提提我自己的亲身经历：我在 Google Play 商店的一个付费应用下面看到一条评论，那个人说他在吾爱破解上面花了两块钱买了个破解版，为此洋洋得意（我就不对这种行为做评论吧）；联想起曾经闹得沸沸扬扬的中国旅客在境外的不文明、低素质行为，我有时会这样感叹：“你国人民还是别翻出去丢人现眼比较好”。</p></blockquote><p> 当然，主要并不是丢脸的问题。丢脸事情小，丢命事情大。</p><p> 为什么法轮功能够影响巨大，让共产党和中国政府如此忌惮不已？因为有人相信。教徒们信法轮功，就像现在一些人相信转基因有毒、基站辐射能致癌一样。<br /> 他们矢志不渝地相信这些、本来是高中甚至是初中课堂上学到的知识、就能解释和辟谣的言论，甚至为这些我们看起来很荒唐的言论进行辩护（可以看看崔永元的微博下面他的粉丝的为反转基因的无脑洗地，或者去关注一下最近微博上因武汉理工大学发生砍人事件而怼微博大 V 的那些“武理取闹”的学生们）。<br /> 所以，这就是为什么邪教这么可怕。</p><p> 所以，GFW 之所以存在，是有他的意义和作用的。</p><blockquote><p> 现在的初高中义务教育实验是 2002 年开始的。让我们想一下，在 2002 年开始接受新课标改革后的学生是刚刚小学毕业步入初中的，那么他们现在也才 27、28 岁左右，暂时不能在这个社会上占据主导地位。你应该知道我说的是什么意思。</p></blockquote><p> 政府为言论自由划定红线、不惜高昂代价架设 GFW，其目的是为了维持中国的稳定、维护中国的安全。<br /> 华夏民族是一个农耕民族。农耕民族的特点是偏安、保守、内敛的，不喜欢突破条条框框、不喜欢对外扩张，甚至对于创新都有些畏畏缩缩。而欧美国家的传统是开放而又自由的。中国是一个历来喜欢造墙的民族，这是两个国家的意识形态的不同、决定了中国和欧美国家的走向的不同导致的。这一不同从而又决定了国家的制度不同。中国有 13 至 14 亿人口，中国要发展，最需要的是稳定。中国的这种中央集权制度最适合中国目前的国情，因为这种制度不仅稳定，而且高效。</p><p> 中国不能长期与世隔绝。闭关锁国的后果已经成为了前车之鉴。随着中国经济的不断发展，随着国民精神文明素质和知识水平的不断提高，最终很多东西都会解封，很多东西会浮出水面。和治理空气污染一样，这需要我们的努力，这也是一个时间问题。</p><blockquote><p>MDN 和 Google 开发者网站已经回到中国了；Google 翻译在国内已经可以访问了；Google Analytics 和 Google 字体库也已经解封了。</p></blockquote><p> 最后，让我引用著名 FQHosts 维护者 racaljk 的项目 Wiki 中的那段话做结尾，也感谢诸位看官能耐住性子看到这里。</p><blockquote><p> 网络审查在各个国家都普遍存在着，它并不仅存在于中国。在全球的局势对中国都不利的当下，当局会过滤掉影响、危害到中国长远发展的信息，此时国家安全的意义更加重大。<br /> 互联网上存在着大量终究不现实的、不客观的，甚至自相矛盾的抹黑当局政府言论，它们背后一般有西方政府或非政府组织资金支持。这些媒体包括但不限于一些港媒、境外网站。<br /> 我们希望您能在遇到此类言论和见解时，不要不加思考地、情绪一度被煽动而不能克制地、盲目地相信这些片面或者歪曲事实的东西，而是要事实求是地思考，要摆脱情绪绑架的怪诞思维去理解。<br /> 我们需要了解到，中国的发展总基调是“稳中求进”，中国社会的最核心问题就是稳定。失去稳定的中国将会是一盘散沙，面临分裂和肢解的危险。我们希望您了解当今中国发展的根本保证是什么，发展的过程中哪部分是主旋律，哪些是噪音；哪些是进取的，哪些是会开历史倒车的。<br /> 我们应该清醒和全面地认识问题，偏信西方媒体的言论、缺乏对国家的信任是不可取的。您的数据安全和隐私对您尤为重要。若这些信息不应当被西方掌握时，它对国家和民族的命运更为重要。出于此原因，当局可能会限制您的行为，我们不会也无法干预当局的任何政策和决定。<br /> 所以，我们希望您在使用此服务时，不要盲目地攻击当局的做法。</p></blockquote><p>——<a href="https://u.nu/e5j" target="_blank">《关于中国的互联网》</a></p>]]></content>
        
        <summary type="html">
            
             在前天，也就是那个特殊的日子的前一天晚上，我和几个同学彻夜长谈。我们谈了很多东西，我思绪万千，所以我决定写点东西出来。 让我先从端午节的辱华演讲说起吧。 顺便说一句，辱华演讲这个事情出来以后，很显然中国国内的媒体就这两个反应：要么洗白国内的空气，要么就是有组织有意识地引导舆论
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>Arch Linux 使用F2FS作为根文件系统的安装方案 [ItsLucas]</title>
        <link href="https://milkice.me/2017/06/07/arch-linux-f2fs-installation/"/>
        <id>https://milkice.me/2017/06/07/arch-linux-f2fs-installation/</id>
        
        <author>
            <name>ItsLucas</name>
        </author>
        
        <published>2017-06-07T07:04:05+00:00</published>
        <updated>2017-06-07T07:04:05+00:00</updated>
        
        <content type="html"><![CDATA[一些BB F2FS最近被炒的十分火热，某些号称18个月不卡顿的手机用的特别开心 那么我在想要不要把它用在Arch上 不BB了，开始安装 首先请Follow官方的安装指南 https://wiki.archlinux.org/index.php/installation_guide 在建立分区之前停下 我们的分区表大概长这样（我弄了个1G的……]]></content>
        
        <summary type="html">
            
            一些BB F2FS最近被炒的十分火热，某些号称18个月不卡顿的手机用的特别开心 那么我在想要不要把它用在Arch上 不BB了，开始安装 首先请Follow官方的安装指南 https://wiki.archlinux.org/index.php/installation_guid
            
        </summary>
        
        <category term="Linux"/>
        
        <category term="Maintenance"/>
        
        <category term="OS"/>
        
        <category term="Tech"/>
        
        <category term="Arch"/>
        
        <category term="F2FS"/>
        
    </entry>
    
    <entry>
        <title>ADSL猫（RG100A）通过设置VLAN虚拟WAN口</title>
        <link href="https://milkice.me/2017/06/07/simulate-wan-ports-via-vlan-on-rg100a/"/>
        <id>https://milkice.me/2017/06/07/simulate-wan-ports-via-vlan-on-rg100a/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-06-07T06:41:29+00:00</published>
        <updated>2017-06-07T06:41:29+00:00</updated>
        
        <content type="html"><![CDATA[前言 自从家里宽带升到百兆之后 电信师傅就把我原来那个配置好的刷了tomato的路由器换成了电信的光猫 按照惯例我在网上找破解这个光猫超级密码的方法，但是我找了很多试了很多办法都不行，想刷成别的系统找了下似乎也没有适配这个机型的系统，于是就很无奈啊 本来我家打印机是接在那个tomato路由器上的这样一来我就可以在手机上直接打印了，可是现在……]]></content>
        
        <summary type="html">
            
            前言 自从家里宽带升到百兆之后 电信师傅就把我原来那个配置好的刷了tomato的路由器换成了电信的光猫 按照惯例我在网上找破解这个光猫超级密码的方法，但是我找了很多试了很多办法都不行，想刷成别的系统找了下似乎也没有适配这个机型的系统，于是就很无奈啊 本来我家打印机是接在那个to
            
        </summary>
        
        <category term="Openwrt"/>
        
        <category term="Router"/>
        
        <category term="VLAN"/>
        
        <category term="RG100A"/>
        
    </entry>
    
    <entry>
        <title>一战成名，高考加油！</title>
        <link href="https://blog.lwl12.com/read/2017-university-exam.html"/>
        <id>https://blog.lwl12.com/read/2017-university-exam.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-06-06T16:00:13+00:00</published>
        <updated>2017-06-06T16:00:13+00:00</updated>
        
        <content type="html"><![CDATA[<p>愿你们合上笔盖的那一刻，有武士将刀收回剑鞘般的骄傲。</p>
<p><span></span></p>
<p> </p>
<p>高考加油啦！祝各位一战成名！</p>
<p>学考党和中考党也是一样</p>
<p>本博主今年没有考试，甚至还放了假🐟233333</p>
<div></div>]]></content>
        
        <summary type="html">
            
            愿你们合上笔盖的那一刻，有武士将刀收回剑鞘般的骄傲。    高考加油啦！祝各位一战成名！ 学考党和中考党也是一样 本博主今年没有考试，甚至还放了假🐟233333 
            
        </summary>
        
        <category term="时事"/>
        
    </entry>
    
    <entry>
        <title>HexoKit——为国内环境优化的 Hexo 一键安装方案</title>
        <link href="https://blog.nfz.moe/archives/hexokit-intro.html"/>
        <id>https://blog.nfz.moe/archives/hexokit-intro.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-06-06T10:37:00+00:00</published>
        <updated>2017-06-06T10:37:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>最早萌生这个想法，是因为 Material 主题的群里有人不会安装 Hexo，亦或者是因为卡在安装过程太久。所以，我决定解决 Hexo 安装过慢的问题，向大众“普及” Hexo。</p><a></a><p>首先让我们重新阅读 Hexo 的官方文档，重新了解如何安装 Hexo，就可以了解是哪一步出了问题。</p><h1><a href="https://blog.nfz.moe/archives/hexokit-intro.html# 依赖下载太慢"></a>依赖下载太慢 </h1><p> 安装 Hexo 的第一步自然是全套的依赖。Git 和 NodeJS 一个都不能少。在 Linux 上，实在不行直接换包管理器的源就可以解决 Git 的安装问题。不过对于异端的 Windows，就是另一个故事了。</p><p>对于 Git for Windows，现在 Hexo 官方文档是这么说的：</p><blockquote><p>由于众所周知的原因，从上面的链接下载 git for windows 最好挂上一个代理，否则下载速度十分缓慢。</p></blockquote><p>不过这个问题好解决。Github 上 <a href="https://github.com/waylau/git-for-win" target="_blank"> 这个项目 </a> 有 Git for Windows 的国内镜像。</p><h1><a href="https://blog.nfz.moe/archives/hexokit-intro.html#NPM- 源半墙"></a>NPM 源半墙 </h1><p><code>https://registry.npmjs.org/</code> 是 NPM 的官方源镜像，部署在 Fastly CDN 上。嗯，别看 Fastly CDN 的节点的超时过得去，实际上却时刻处于半墙状态。这也就是是为什么从 NPM 官方源下载并安装依赖非常缓慢了。<br /> 当然解决方案就是使用国内的镜像源。淘宝或者 CNPM 的源都挺好；中科大的源次之。我们可以使用 <code>npm config set registry</code> 指令换源。</p><h1><a href="https://blog.nfz.moe/archives/hexokit-intro.html#GitHub- 半墙"></a>GitHub 半墙 </h1><p> 据说在严重抗议下，Github 也算是解封了。不过，直连并使用 HTTPS 协议 <code>git clone</code> 时的速度依然让人难以忍受。<br />Hexo 默认主题 landscape 是托管在 Github 上的，clone 的指令是内置在 <code>hexo-cli</code> 的 <code>install.js</code> 中的。这个时候就算 npm 换源，这一步也绕不过去。看着 5kb/s 的 clone 速度也足够让我们对着 GFW 爆粗了。</p><h1><a href="https://blog.nfz.moe/archives/hexokit-intro.html# 解决方案"></a>解决方案 </h1><p> 所以，知道了是哪里出了问题，解决方案就很简单了。<br />对于 Git 下载服务器被墙的问题，我们可以用镜像站解决；NPM 源被墙的问题，我们可以通过换源的方法解决；但是从 Github Clone 默认主题倒是一个很难绕过去的坎。</p><p>所以，让我们分析下 <code>hexo init</code> 会执行哪些操作。<br />执行 <code>hexo init</code> 时，<code>hexo-cli</code> 会在指定目录生成 Hexo 工程文件所需要的目录，如 <code>scaffolds</code>、<code>drafts</code>、<code>public</code> 等目录、<code>.gitignore</code>、<code>db.json</code>、<code>_config.yml</code> 等文件，并生成依赖列表 <code>package.json</code>。然后会根据 <code>package.json</code> 安装 Hexo 自身、安装基本插件和其它依赖如 markdown 解析器、主题语言解析器、页面生成器等。然后就是 clone 主题到 <code>theme/landscape</code> 目录下，Hexo 初始化过程结束。</p><p>所以，根据之前改造 Hexo 的工程文件实现 CI 持续集成的经验，我们会发现之前生成目录到生成依赖列表 <code>package.json</code> 这些文件都是可以直接从 Repo 中拉下来直接用的。</p><blockquote><p>因为 <code>hexo init</code> 中 <code>install.js</code> 过程不能被介入，所以我们只能绕过 <code>hexo init</code>。</p></blockquote><p>我在本地执行完 <code>hexo init</code>，在初始化好了的 Hexo 工程文件目录下执行 <code>git init</code>，分别推送到 Github 和 OSChina 的公共 Repo 中。<br />所以，现在 <code>hexo init</code> 将会被下述指令替代：</p><pre><code><span>git</span> clone https://git.oschina.net/neoFelhz/hexokit.git<span>npm</span> <span>install</span><span><span></span><span></span></span></code></pre><p>现在我把所有步骤写进一个 shell 中，用户只需要在 Git Bash 中执行下述指令即可快速完成 Hexo 的全部安装：</p><pre><code>curl http://git.oschina.net/neoFelhz/hexokit/raw/master/install.sh <span>|</span> sh<span><span></span></span></code></pre><p>这个脚本中包含了了以下指令：</p><pre><code><span>npm</span> config <span>set</span> registry https://registry.npm.taobao.org<span>npm</span> <span>install</span> hexo-cli -g<span>git</span> clone https://git.oschina.net/neoFelhz/hexokit.git<span>rm</span> install.sh<span>cd</span> hexokit<span>npm</span> <span>install</span><span>npm</span> config <span>set</span> registry https://registry.npmjs.org/hexo version<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这一步将完成 <code>hexo-cli</code> 的安装和初始化一个 Hexo 工程文件的操作。用户只需要安装好 NodeJS 和 Git 后即可在需要安装 Hexo 的目录下执行即可。</p><blockquote><p>HexoKit 项目 Repo 地址：</p><ul><li>Github：<a href="https://github.com/neoFelhz/HexoKit" target="_blank">https://github.com/neoFelhz/HexoKit</a></li><li>OSChina：<a href="https://git.oschina.net/neoFelhz/hexokit" target="_blank">https://git.oschina.net/neoFelhz/hexokit</a></li></ul></blockquote><p>HexoKit 需要我每月定时在本地执行一次 <code>hexo init</code>，以更新 Repo 中的目录结构和 <code>package.json</code>。</p>]]></content>
        
        <summary type="html">
            
            最早萌生这个想法，是因为 Material 主题的群里有人不会安装 Hexo，亦或者是因为卡在安装过程太久。所以，我决定解决 Hexo 安装过慢的问题，向大众“普及” Hexo。首先让我们重新阅读 Hexo 的官方文档，重新了解如何安装 Hexo，就可以了解是哪一步出了问题。依
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="博客"/>
        
        <category term="Hexo"/>
        
        <category term="HexoKit"/>
        
    </entry>
    
    <entry>
        <title>记一次SS中转配置</title>
        <link href="https://131.re/marchives/100"/>
        <id>https://131.re/marchives/100</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-06-06T04:00:00+00:00</published>
        <updated>2017-06-06T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[
<p>SS的安装过程就不写了，直接从配置讲起：<br />
目标：客户端-&gt;广州服务器-&gt;香港服务器</p>
<p>最开始的时候尝试过<strong>HAProxy</strong>，但是它只能转发TCP的流量，这会导致所有UDP流量(DNS解析、部分游戏等)无法转发，所以最后还是决定用iptables来配置</p>
<p>起初是直接按照网上的教程进行配置，但却始终无法正常转发，在Google上查了一下，貌似像Azure、腾讯云这类的服务器的配置过程会有略微不同，方法如下：</p>
<blockquote>
<p>普通服务器(即网卡上绑的是公网IP)：</p>
</blockquote>
<pre><code>iptables -t nat -A PREROUTING -p tcp --dport [广州服务器端口] -j DNAT --to-destination [香港服务器IP]:[香港服务器端口]
iptables -t nat -A PREROUTING -p udp --dport [广州服务器端口] -j DNAT --to-destination [香港服务器IP]:[香港服务器端口]
iptables -t nat -A POSTROUTING -p tcp -d [香港服务器IP] --dport [香港服务器端口] -j SNAT --to-source [广州服务器公网IP]
iptables -t nat -A POSTROUTING -p udp -d [香港服务器IP] --dport [香港服务器端口] -j SNAT --to-source [广州服务器公网IP]
</code></pre>
<blockquote>
<p>Azure、腾讯云服务器等(即网卡上绑的是内网IP)：</p>
</blockquote>
<pre><code>iptables -t nat -A PREROUTING -p tcp --dport [广州服务器端口] -j DNAT --to-destination [香港服务器IP]:[香港服务器端口]
iptables -t nat -A PREROUTING -p udp --dport [广州服务器端口] -j DNAT --to-destination [香港服务器IP]:[香港服务器端口]
iptables -t nat -A POSTROUTING -p tcp -d [香港服务器IP] --dport [香港服务器端口] -j SNAT --to-source [广州服务器内网IP]
iptables -t nat -A POSTROUTING -p udp -d [香港服务器IP] --dport [香港服务器端口] -j SNAT --to-source [广州服务器内网IP]
</code></pre>
<p>最后，再执行：</p>
<pre><code>service iptables save
service iptables restart
</code></pre>]]></content>
        
        <summary type="html">
            
             SS的安装过程就不写了，直接从配置讲起： 目标：客户端-&amp;gt;广州服务器-&amp;gt;香港服务器 最开始的时候尝试过HAProxy，但是它只能转发TCP的流量，这会导致所有UDP流量(DNS解析、部分游戏等)无法转发，所以最后还是决定用iptables来配置 起初是直接按照网上
            
        </summary>
        
    </entry>
    
    <entry>
        <title>在 VPS 上利用 GIT HOOKS 自动部署 Jekyll</title>
        <link href="https://blog.kejun.me//living/2017/06/04/jekyll-auto-deployment-methods.html"/>
        <id>https://blog.kejun.me//living/2017/06/04/jekyll-auto-deployment-methods.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-06-04T16:00:00+00:00</published>
        <updated>2017-06-04T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>jekyll 官方提供了<a href="https://jekyllrb.com/docs/deployment-methods/">教程</a>，写的还是蛮清楚的，但我觉得还是有必要记录一下。</p>

<p>希望看到此文的同学能够一起讨论更高效的自动化部署。</p>

<p>感谢<a href="http://miku01qaq.xyz/">Mysaku</a>提供的机器测试。</p>

<p>下面命令中：</p>
<ul>
  <li><code>root@server$</code> 前缀表示服务器的root用户；</li>
  <li><code>git@server$</code> 前缀表示服务器的git用户；</li>
  <li><code>localhost$</code> 前缀表示本地用户；</li>
  <li>无前缀表示文本。</li>
</ul>

<h2>配置用户</h2>

<p>新建一个<code>git</code>用户</p>

<div><div><pre><code>root@server<span>$ </span>adduser git
</code></pre></div></div>

<h2>用户授权</h2>

<p>授与无需密码操作的权限</p>

<div><div><pre><code>root@server<span>$ </span><span>sudo </span>vim /etc/sudoers
</code></pre></div></div>

<p>添加 <code>git    ALL=(ALL:ALL) ALL</code></p>

<p>然后使用 <code>:wq!</code> 强制保存并退出。</p>

<p>授予操作 nginx 放网页的地方的权限</p>

<div><div><pre><code>root@server<span>$ </span><span>cd</span> /var/www
root@server<span>$ </span>mkdir jekyll
root@server<span>$ </span>chown git:git <span>-R</span> /var/www/jekyll
</code></pre></div></div>

<h2>配置Hooks</h2>

<div><div><pre><code>root@server<span>$ </span>su git
git@server<span>$ </span><span>cd</span> ~
git@server<span>$ </span>mkdir jekyll.git
git@server<span>$ </span><span>cd </span>jekyll.git/
git@server<span>$ </span>git <span>--bare</span> init
git@server<span>$ </span>vim hooks/post-receive
</code></pre></div></div>

<p>复制下面的内容粘贴并保存：</p>

<div><div><pre><code><span>#!/bin/bash</span>
<span>GIT_REPO</span><span>=</span><span>$HOME</span>/jekyll.git
<span>TMP_GIT_CLONE</span><span>=</span><span>$HOME</span>/tmp/myrepo
<span>PUBLIC_WWW</span><span>=</span>/var/www/jekyll

git clone <span>$GIT_REPO</span> <span>$TMP_GIT_CLONE</span>
<span>cd</span> <span>$TMP_GIT_CLONE</span>
bundle
jekyll build <span>-s</span> <span>$TMP_GIT_CLONE</span> <span>-d</span> <span>$PUBLIC_WWW</span>
rm <span>-Rf</span> <span>$TMP_GIT_CLONE</span>
<span>exit</span>
</code></pre></div></div>
<p>最后授予执行权限</p>

<div><div><pre><code>git@server<span>$ </span>chmod +x hooks/post-receive
</code></pre></div></div>

<h2>安装Jekyll</h2>

<p>推荐使用git用户安装jekyll。</p>

<p>如何安装 jekyll ？详见<a href="https://blog.kejun.space/technology/2017/05/27/how-to-install-jekyll.html">此文章</a>。</p>

<h2>添加SSh</h2>

<p>接下来上传本地机器的SSH公钥到服务器。</p>

<p>首先打开你<strong>本地机器</strong>的<code>git bash</code> 输入：</p>

<div><div><pre><code>localhost<span>$ </span>ssh-keygen <span>-t</span> rsa
localhost<span>$ </span>vim ~/.ssh/id_rsa.pub
<span>&quot;*yy
</span></code></pre></div></div>
<p><code>&quot;*yy</code> 为vim的复制命令。</p>

<p>继续<strong>返回到服务器</strong>（git用户）。</p>

<div><div><pre><code>git@server<span>$ </span><span>cd</span> ~
git@server<span>$ </span>mkdir .ssh <span>&amp;&amp;</span> <span>cd</span> .ssh
git@server<span>$ </span>touch authorized_keys
git@server<span>$ </span>vim authorized_keys
</code></pre></div></div>
<p>粘贴刚刚复制的公钥。</p>

<p>现在，在<strong>本地机器</strong> 使用 <code>ssh git@yourvpsip</code> 已经可以成功登陆啦~</p>

<p>如果你vps的端口不是22，那么在<strong>本地机器</strong>：</p>

<div><div><pre><code>localhost<span>$ </span>vim ~/.ssh/config
</code></pre></div></div>
<p>输入,并调整为你vps的信息：</p>

<div><div><pre><code>Host <span>#VPS IP</span>
HostName <span>#VPS IP</span>
User git
Port <span>#SSH Port</span>
IdentityFile ~/.ssh/id_rsa
</code></pre></div></div>

<h2>关联本地仓库</h2>

<p>在你<strong>本地机器的博客仓库</strong>中添加一个远程仓库：</p>

<div><div><pre><code>localhost<span>$ </span>git remote add www git@yourvpsip:~/jekyll.git
</code></pre></div></div>

<p>现在，每次发布新文章只要<code>push</code>即可~</p>

<div><div><pre><code>localhost<span>$ </span>git push www master
</code></pre></div></div>

<h2>nginx &amp; apache</h2>

<p>记得配置http哟~</p>]]></content>
        
        <summary type="html">
            
            jekyll 官方提供了教程，写的还是蛮清楚的，但我觉得还是有必要记录一下。  希望看到此文的同学能够一起讨论更高效的自动化部署。  感谢Mysaku提供的机器测试。  下面命令中：    root@server$ 前缀表示服务器的root用户；   git@server$ 前
            
        </summary>
        
        <category term="jekyll"/>
        
        <category term="git"/>
        
        <category term="hooks"/>
        
        <category term="vps"/>
        
        <category term="ubuntu"/>
        
    </entry>
    
    <entry>
        <title>用Python活捉多余jQuery</title>
        <link href="https://flyhigher.top/develop/527.html"/>
        <id>https://flyhigher.top/develop/527.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-06-03T14:06:09+00:00</published>
        <updated>2017-06-03T14:06:09+00:00</updated>
        
        <content type="html"><![CDATA[<p>唔，我猜肯定有人看了标题也不知道我要说什么。</p>
<p>起因是这样的：</p>
<p>我在将服务器换到云服务器之后，后知后觉地发现服务器水管太细，图片加载实在太慢，于是使用了七牛CDN来加速图片加载。在WordPress端我选择了WPJAM插件来方便管理。</p>
<p>有一天我无聊看了一下网站加载情况，突然发现加载了两份jQuery。看图，第一条和最后一条：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212451.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212451.jpg" /></a></p>
<p>这就奇怪了。我使用的主题经过过我自己二次开发，清楚主题自带一份jQuery，而且此前绝对没有从除主站域名之外的域名加载过内容。最后我怀疑是WPJAM插件的锅。但由于现在我的网站已经依赖CDN加速，插件无法轻易停用，只能自己确认原因。</p>
<p>首先我先到该插件的问答中心向作者询问，结果并没有什么收获。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_213835.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_213835.jpg" /></a></p>
<p>用WP自带的插件编辑器翻了几个该插件的文件，没有什么发现，实在不想继续手动找了。</p>
<p>不用手动，那就自动化嘛。Python蛮合适这种小任务的，正好也可以练练手。于是上手。</p>
<p>开始</p>
<p>首先把网站文件全部备份到本地方便调试。根目录为V:\Web\fh\。</p>
<p>脚本思路很简单，遍历所有PHP文件，从中搜索dn-staticfile.qbox.me这个域名。如果找到就将路径+文件名输出告诉我。</p>
<p>本来以为遍历文件要自己写递归，后来发现Python提供了一个更方便的方法<code>os.walk()</code>，在Unix及Windows中有效。</p>
<p>它提供好几个参数，但一般只用第一个参数，即传入根目录即可。然后就可以得到一个三元数组，用for遍历这个数组即可。于是有了这样的代码：</p>
<p></p><pre># -*- coding:utf-8 -*-
import os

#遍历
for root, dirs, files in os.walk(&quot;V:\\Web\\fh&quot;):
    for name in files:
        match = str(os.path.join(root, name)).find(&quot;.php&quot;)#只搜索php
        if match != -1:
            f = open(os.path.join(root, name),&quot;r&quot;)
            cont = f.read().encode('utf-8')
            resu = cont.find(b&quot;dn-staticfile.qbox.me&quot;)#搜索域名
            if resu != -1:
                #如果找到了
                print(os.path.join(root, name))
            f.close()</pre><p></p>
<p>跑一下，结果报错。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170604_153623.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170604_153623.jpg" /></a></p>
<p>有一个文件里面用了非UTF-8字符，结果这个坎半天翻不过去。试图把它decode，但是还是报错：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212034.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212034.jpg" /></a></p>
<p>诶呀，忘了Python 3里面字符串不能decode了。那把字符串变成二进制就好了，更换打开文件方式r为rb。</p>
<p>现在代码如下：</p>
<p></p><pre># -*- coding:utf-8 -*-
import os

for root, dirs, files in os.walk(&quot;V:\\Web\\fh&quot;):
    for name in files:
        match = str(os.path.join(root, name)).find(&quot;.php&quot;)
        if match != -1:
            f = open(os.path.join(root, name),&quot;rb&quot;)
            cont = f.read().decode('gbk','ignore').encode('utf-8')#解编码，忽略错误
            resu = cont.find(b&quot;dn-staticfile.qbox.me&quot;)
            if resu != -1:
                print(os.path.join(root, name))
            f.close()</pre><p></p>
<p>再跑，没问题了。</p>
<p>活捉！果然是WPJAM的锅。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212057.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212057.jpg" /></a></p>
<p>打开瞧瞧，活捉添加jQuery的函数：</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212302.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212302.jpg" /></a></p>
<p>注释或删除掉即可。</p>
<p>刷新页面，果然没了。完美！</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212539.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/06/Axton20170603_212539.jpg" /></a></p>
<p>今天划水到这里2333跑了</p>]]></content>
        
        <summary type="html">
            
            唔，我猜肯定有人看了标题也不知道我要说什么。 起因是这样的： 我在将服务器换到云服务器之后，后知后觉地发现服务器水管太细，图片加载实在太慢，于是使用了七牛CDN来加速图片加载。在WordPress端我选择了WPJAM插件来方便管理。 有一天我无聊看了一下网站加载情况，突然发现加
            
        </summary>
        
        <category term="开发"/>
        
        <category term="jQuery"/>
        
        <category term="Python"/>
        
    </entry>
    
    <entry>
        <title>Windows 无痛运行 Jekyll 3?</title>
        <link href="https://blog.kejun.me//living/2017/06/02/running-jekyll-on-windows.html"/>
        <id>https://blog.kejun.me//living/2017/06/02/running-jekyll-on-windows.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-06-02T16:00:00+00:00</published>
        <updated>2017-06-02T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>在windows上运行ruby也是相当麻烦的，安装各种出错…但是win10 、jekyll3之后官方起码有了在bash下安装的教程。</p>

<p>仅在win7+win10下测试。</p>

<p>不过本文是写给不想用 bash 的同学。</p>

<p>如果你使用的是 Ubuntu ，请查看此<a href="https://blog.kejun.space/technology/2017/05/27/how-to-install-jekyll.html">文章</a></p>

<h2>安装 RubyInstallers</h2>

<ol>
  <li>访问 https://rubyinstaller.org/downloads/ 页面。</li>
  <li>选择最新版本下载并运行，攥写此文章时最新版本为 <code>Ruby 2.4.1-1</code>。</li>
  <li>勾选I accept the License 单选框，然后一路下一步，直到点击完成按钮出现时，取消勾选<code>run ‘ridk install’ to install MSYS2...</code> 复选框并点击完成。
    <ul>
      <li>请务必勾选<code>Add Ruby executables to your PATH</code>复选框。</li>
    </ul>
  </li>
</ol>

<h2>安装Jekyll</h2>

<p>打开cmd窗口，键入如下：</p>

<div><div><pre><code>gem install bundler jekyll
</code></pre></div></div>

<p>至此，已经完成。</p>

<h2>运行Jekyll</h2>

<p>新建博客：</p>

<div><div><pre><code>jekyll new blog
</code></pre></div></div>

<p>使用<code>cd blog</code>进入<code>blog</code>文件夹并安装依赖：</p>

<div><div><pre><code>bundle install
</code></pre></div></div>

<p>运行：</p>

<div><div><pre><code>jekyll s <span>-w</span>
</code></pre></div></div>

<p>如果出现</p>

<div><div><pre><code>Please add the following to your Gemfile to avoid polling <span>for </span>changes:
gem <span>'wdm'</span>, <span>'&gt;= 0.1.0'</span> <span>if </span>Gem.win_platform?
</code></pre></div></div>
<p>请不要担心，目录仍然会被正常监视（我也不知道为啥，反而尝试安装<code>wdm</code>倒是会报错）。</p>

<p>现在使用<code>chrome53+</code>访问 <code>127.0.0.1:4000/</code>。</p>

<p><img src="https://ooo.0o0.ooo/2017/06/03/5932a82785044.jpg" /></p>

<blockquote>
  <p>嗯，几乎和linux下体验差不多。妈妈再也不用担心我的系统是windows啦（雾</p>
</blockquote>

<h2>一键安装</h2>

<p>RubyInstallers可以使用命令行安装，既然如此我为何不写个bat呢？</p>

<ul>
  <li>ruby 2.4</li>
  <li>jekyll 3.4.3</li>
</ul>

<p><a href="https://github.com/KeJunMao/fastjekyll">项目地址</a></p>

<p><a href="https://github.com/KeJunMao/fastjekyll/releases/tag/1.0">下载</a></p>

<h2>有用的链接</h2>

<ul>
  <li><a href="http://jekyll-windows.juthilo.com/">Run Jekyll on Windows</a>（jekyll2）</li>
  <li><a href="https://jekyllrb.com/docs/windows/#installation">Jekyll on Windows</a>（bash）</li>
  <li><a href="https://blog.kejun.space/technology/2017/05/27/how-to-install-jekyll.html">如何安装Jekyll？</a>（ubuntu）</li>
</ul>]]></content>
        
        <summary type="html">
            
            在windows上运行ruby也是相当麻烦的，安装各种出错…但是win10 、jekyll3之后官方起码有了在bash下安装的教程。  仅在win7+win10下测试。  不过本文是写给不想用 bash 的同学。  如果你使用的是 Ubuntu ，请查看此文章  安装 Ruby
            
        </summary>
        
        <category term="jekyll"/>
        
        <category term="install"/>
        
        <category term="windows"/>
        
        <category term="一键安装"/>
        
        <category term=".bat"/>
        
    </entry>
    
    <entry>
        <title>MDN JavaScript阅读计划(1)</title>
        <link href="https://blog.kejun.me//reading/2017/05/31/mdn-javascript-reading-plan-1.1.html"/>
        <id>https://blog.kejun.me//reading/2017/05/31/mdn-javascript-reading-plan-1.1.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-05-31T16:00:00+00:00</published>
        <updated>2017-05-31T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>JavaScript document reading plan 1.</p>

<blockquote>
  <p>JavaScript 是一门为你的网站添加交互功能的编程语言。</p>
</blockquote>

<h2>什么是JavaScript？</h2>

<p>JavaScript(缩写：JS)是一门成熟的动态编程语言，当应用于HTML文档时，可以在网站上提供动态交互性。</p>

<h2>一个”hello, world”示例</h2>

<p>index.html:</p>
<div><div><pre><code><span>&lt;script </span><span>src=</span><span>&quot;scripts/main.js&quot;</span><span>&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>将 &lt;/script/&gt; 元素放在 HTML 文件底部的原因是，浏览器解析 HTML 似乎按照代码出现的顺序来的。如果 JavaScript被首先读取，它也应该影响下面的 HTML，但有时会出现问题，因为 JavaScript 会在 HTML 之前被加载，如果 JavaScript 代码出现问题则 HTML 不会被加载。所以将 JavaScript 代码放在底部是最好的选择。</p>

<p>scripts/main.js:</p>
<div><div><pre><code><span>var</span> <span>maHeading</span> <span>=</span> <span>document</span><span>.</span><span>querySelector</span><span>(</span><span>'h1'</span><span>);</span>

<span>maHeading</span><span>.</span><span>innerHTML</span> <span>=</span> <span>'hello, world'</span><span>;</span>
</code></pre></div></div>

<h2>语言基础浏览</h2>

<h3>变量(variables)</h3>

<div><div><pre><code><span>var</span> <span>myVariables</span><span>;</span>
</code></pre></div></div>

<p>行末的分号表示语句结束；几乎可以以任何名称来命名一个变量；JavaScript 是对大小写敏感的</p>

<p>定义的变量可以赋值：</p>
<div><div><pre><code><span>myVariables</span> <span>=</span> <span>'Bob'</span><span>;</span>
</code></pre></div></div>
<p>可以通过变量名称检索变量：</p>
<div><div><pre><code><span>myVariables</span><span>;</span>
</code></pre></div></div>
<h3>注释</h3>

<p>多行注释：</p>
<div><div><pre><code><span>/*
注释
*/</span>
</code></pre></div></div>
<p>单行注释：</p>
<div><div><pre><code><span>// 注释</span>
</code></pre></div></div>
<h3>运算符</h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators">表达式和运算符完整列表</a></p>

<h3>语句</h3>

<p>if…else等</p>

<h3>函数</h3>

<p>除了浏览器内置函数，允许自定义函数：</p>

<div><div><pre><code><span>//创建</span>
<span>function</span> <span>multiply</span><span>(</span><span>num1</span><span>,</span><span>num2</span><span>){</span>
    <span>var</span> <span>result</span> <span>=</span> <span>num1</span> <span>*</span> <span>num2</span><span>;</span>
    <span>return</span> <span>result</span><span>;</span>
<span>}</span>
<span>//使用</span>
<span>multiply</span><span>(</span><span>4</span><span>,</span><span>7</span><span>);</span>
</code></pre></div></div>

<p>return 语句告诉浏览器返回 result 变量以便使用。这是很有必要的，因为函数内定义的变量只能在函数内使用。这叫做作用域 scoping</p>

<h3>事件</h3>

<p>事件是能够捕捉浏览器操作并且允许你运行代码进行响应的代码结构.</p>

<div><div><pre><code><span>document</span><span>.</span><span>querySelector</span><span>(</span><span>'html'</span><span>).</span><span>onclick</span> <span>=</span> <span>function</span><span>(){</span>
    <span>alert</span><span>(</span><span>'Ouch! Stop poking me!'</span><span>);</span>
<span>}</span>
</code></pre></div></div>

<h2>改善示例网页</h2>

<h3>图片转换器</h3>

<div><div><pre><code><span>var</span> <span>myImage</span> <span>=</span> <span>document</span><span>.</span><span>querySelector</span><span>(</span><span>'img'</span><span>);</span>

<span>myImage</span><span>.</span><span>onclick</span> <span>=</span> <span>function</span><span>(){</span>
    <span>var</span> <span>mySrc</span> <span>=</span> <span>myImage</span><span>.</span><span>getAttribute</span><span>(</span><span>'src'</span><span>);</span>
    <span>if</span><span>(</span><span>mySrc</span> <span>===</span> <span>'images/firefox-icon.png'</span><span>){</span>
        <span>myImage</span><span>.</span><span>setAttribute</span><span>(</span><span>'src'</span><span>,</span><span>'https://ooo.0o0.ooo/2017/06/02/59312aafca8db.jpg'</span><span>);</span>
    <span>}</span><span>else</span><span>{</span>
        <span>myImage</span><span>.</span><span>setAttribute</span><span>(</span><span>'src'</span><span>,</span><span>'images/firefox-icon.png'</span><span>);</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<h3>个性化欢迎信息</h3>

<div><div><pre><code><span>var</span> <span>myButton</span> <span>=</span> <span>document</span><span>.</span><span>querySelector</span><span>(</span><span>'button'</span><span>);</span>
<span>var</span> <span>myHeading</span> <span>=</span> <span>document</span><span>.</span><span>querySelector</span><span>(</span><span>'h1'</span><span>);</span>

<span>function</span> <span>setUserName</span><span>(){</span>
    <span>var</span> <span>myName</span> <span>=</span> <span>prompt</span><span>(</span><span>'Please enter your name.'</span><span>);</span>
    <span>localStorage</span><span>.</span><span>setItem</span><span>(</span><span>'name'</span><span>,</span><span>myName</span><span>);</span>
    <span>myHeading</span><span>.</span><span>innerHTML</span> <span>=</span> <span>'Mozilla is cool, '</span> <span>+</span> <span>myName</span><span>;</span>
<span>}</span>

<span>if</span> <span>(</span><span>!</span><span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>'name'</span><span>)){</span>
    <span>setUserName</span><span>();</span>
<span>}</span> <span>else</span> <span>{</span>
    <span>var</span> <span>storedName</span> <span>=</span> <span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>'name'</span><span>);</span>
    <span>myHeading</span><span>.</span><span>innerHTML</span> <span>=</span> <span>&quot;Mozilla is cool, &quot;</span> <span>+</span> <span>storedName</span><span>;</span>
<span>}</span>

<span>myButton</span><span>.</span><span>onclick</span> <span>=</span> <span>function</span><span>(){</span>
    <span>setUserName</span><span>();</span>
<span>}</span>
</code></pre></div></div>]]></content>
        
        <summary type="html">
            
            JavaScript document reading plan 1.     JavaScript 是一门为你的网站添加交互功能的编程语言。   什么是JavaScript？  JavaScript(缩写：JS)是一门成熟的动态编程语言，当应用于HTML文档时，可以在网站上提
            
        </summary>
        
        <category term="javascript"/>
        
        <category term="mdn"/>
        
        <category term="reading"/>
        
    </entry>
    
    <entry>
        <title>Jekyll Theme MDUI Editor</title>
        <link href="https://blog.kejun.me//living/2017/05/29/Jekyll-Theme-MDUI-Editor.html"/>
        <id>https://blog.kejun.me//living/2017/05/29/Jekyll-Theme-MDUI-Editor.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-05-29T16:00:00+00:00</published>
        <updated>2017-05-29T16:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>静态博客在线攥写文章不是梦。</p>

<h2>功能</h2>

<ol>
  <li>自动生成yml头</li>
  <li>markdown自动保存</li>
  <li>头图可直接预览</li>
  <li>随意添加或选择任意分类</li>
  <li>随意添加Tags</li>
  <li>更好的日期选择器</li>
  <li>随时编辑包括手机</li>
</ol>

<h2>使用</h2>

<ol>
  <li>打开 <code>https://yourblogurl/pages/editor.html</code>。</li>
  <li>按照提示填写对应信息。</li>
  <li>点击 <code>CREATE FILE</code> 按钮。</li>
  <li>点击 <code>Download</code> 按钮。</li>
  <li>将下载的文件移动到 <code>_posts</code> 文件夹。</li>
  <li><code>git push</code> 。</li>
</ol>

<h2>预览</h2>

<p><a href="https://blog.kejun.space/pages/editor.html">demo</a></p>

<p><img src="https://ooo.0o0.ooo/2017/06/23/594cfd1144fa2.png" /></p>]]></content>
        
        <summary type="html">
            
            静态博客在线攥写文章不是梦。  功能     自动生成yml头   markdown自动保存   头图可直接预览   随意添加或选择任意分类   随意添加Tags   更好的日期选择器   随时编辑包括手机   使用     打开 https://yourblogurl/pag
            
        </summary>
        
        <category term="mdui"/>
        
        <category term="jekyll"/>
        
        <category term="theme"/>
        
        <category term="editor"/>
        
    </entry>
    
    <entry>
        <title>Jekyll Theme MDUI</title>
        <link href="https://blog.kejun.me//living/2017/05/29/jekyll-theme-mdui.html"/>
        <id>https://blog.kejun.me//living/2017/05/29/jekyll-theme-mdui.html</id>
        
        <author>
            <name>KeJun</name>
        </author>
        
        <published>2017-05-29T04:22:06+00:00</published>
        <updated>2017-05-29T04:22:06+00:00</updated>
        
        <content type="html"><![CDATA[<p>A Jekyll theme based on MDUI.</p>

<p>Material Design 设计，大部分配置使用 _data 文件，无需重启 <code>jekyll</code> 即可完成配置。</p>

<h2>MDUI</h2>

<p>MDUI 是一套用于开发 Material Design 网页的前端框架。</p>

<ul>
  <li>
    <p><a href="https://github.com/zdhxiong/mdui">github</a></p>
  </li>
  <li>
    <p><a href="https://www.mdui.org/">MDUI</a></p>
  </li>
</ul>

<h2>主题特性</h2>

<ul>
  <li>响应式设计</li>
  <li>集成服务
    <ul>
      <li>Google 分析</li>
      <li>RSS</li>
      <li>本地搜索</li>
      <li>Disqus</li>
      <li>sitemap</li>
    </ul>
  </li>
  <li>多种独立页面
    <ul>
      <li>category</li>
      <li>friends</li>
      <li>search</li>
      <li>tags</li>
    </ul>
  </li>
  <li>纯 Liquid 压缩 html</li>
  <li>不依赖非安全插件（可直接部署到Github）</li>
  <li>PWA</li>
  <li>多样性 SNS</li>
  <li>在线编辑器<a href="https://blog.kejun.space/pages/editor.html">demo</a></li>
</ul>

<h2>食用方法</h2>

<p><a href="https://github.com/KeJunMao/jekyll-theme-mdui/blob/master/README.md">jekyll-theme-mdui/README.md</a></p>

<h2>预览</h2>

<p><a href="https://github.com/KeJunMao/jekyll-theme-mdui">KeJunMao/jekyll-theme-mdui</a></p>

<p><a href="https://blog.kejun.space/">KeJun Blog</a></p>

<h2>License</h2>

<p>The theme is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>]]></content>
        
        <summary type="html">
            
            A Jekyll theme based on MDUI.  Material Design 设计，大部分配置使用 _data 文件，无需重启 jekyll 即可完成配置。  MDUI  MDUI 是一套用于开发 Material Design 网页的前端框架。        
            
        </summary>
        
        <category term="jekyll"/>
        
        <category term="theme"/>
        
        <category term="liquid"/>
        
    </entry>
    
    <entry>
        <title>一场向死而生的征程？——我是这么理解 「Green Android」的</title>
        <link href="https://blog.nfz.moe/archives/my-view-of-green-android.html"/>
        <id>https://blog.nfz.moe/archives/my-view-of-green-android.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-05-28T12:40:00+00:00</published>
        <updated>2017-05-28T12:40:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>黑云蔽空，极夜将至，风雷涌动，没有雨。 在寂寞中奔驰的猛士啊，在暂时无人慰藉你之前，请不要惮于前驱。<br />——题记</p><a></a><p>什么是 Android 「绿色应用公约」？这是公约的内容：<a href="https://green-android.org/app-convention.html" target="_blank">https://green-android.org/app-convention.html</a><br />还有，这是冯老师的 <a href="https://zhuanlan.zhihu.com/p/26689473" target="_blank">《从守护到公约，向死而生的新征程》</a> 一文。这篇文章介绍了冯老师对他自己想要缔造的一个生态的理念。<br />显然，冯老师提出的「绿色应用公约」引发了很多人的讨论，也引发了很多争议。我身边的一些搞 Android 开发的人有的也已经开始准备接入冯老师的 <code>Condom</code> SDK，也有申请绿色应用认证的（其中一些应用已经通过认证了）。面对「绿色应用公约」、引爆 Android 开发界的“炸弹”，我来谈谈我自己的看法。</p><p>首先，可能到最后才轮到会有 BAT 这些老牌的毒瘤剧透遵守公约。这些巨头们辛辛苦苦开发出 XGPush（信鸽推送）、MiPush（小米推送）、HWPush（华为推送）、Umeng（友盟毒瘤 SDK）等等这些东西并让其它开发者接入，一时半会是不会抛弃的。</p><blockquote><p>当然，这是一套方案。这是手机厂商和应用厂商为统一推送接口做出的努力。可惜，最后到达用户手上的，却是链式唤醒的恶果。<br />我记得，工信部之前一直在搞有关的大新闻。比如搞什么“工信部评选六大安全应用商店”，还有华为、工信部共同牵头的“安卓绿色联盟”。我想，这样的绿色联盟，也不过是为了继续统一管理接口、管理厂商，最终改善用户体验。<br />为了防止这些组件造成的链式唤醒，冯老师也开发了 <code>Condom</code> SDK。</p></blockquote><p>然而，这并不妨碍本次呼吁是一次极具意义和价值的重要呼吁。公约的提出对于整个 Android 的生态如同一记重锤。公约提出了一个观点——就是如果应用规范自己的行为、合理利用 Android 系统的各种接口、框架，不用那些尽力让后台保活、注册一堆广播 Receiver 和 Service，转而去尊重用户的整体体验，是利大于弊的。</p><blockquote><p>现在一些开发者（主要是 BAT）往往觉得如果选择不“成为毒瘤”，自己的利益会受损。然而现在一个很显著的趋势，就是国内各家厂商定制系统对于后台的控制都越来越严格。要是你的应用费尽心思搞的“流氓行为”在这些系统上，如果不进白名单会死的很惨。更别提还有各种手机管家，对于折腾 Android 的人来说还有黑域、绿色守护这一些神器。是的，包括冯老师开发了的绿色守护。</p></blockquote><p>像 BAT 的这种流氓行为实际上是不受用户待见的。大多数用户是不了解 Android 机制的，但是用户会把手机的卡顿、耗电归结于毒瘤，导致卸载甚至差评等行为，这是应用开发者最不愿意看到的。<br />在用户和毒瘤的战斗中，手机厂商也是一个很重要的角色。比如微信和支付宝还有 QQ，大家都离不开。如果在手机上这些应用引起卡顿，用户会把锅丢给手机厂商的。这时候厂商不得不从自己定制的 UI 出发，不断加强对进程和后台的限制。</p><p>而「绿色应用公约」的提出，相当于向开发者们强调：你无论多么暴力地企图保活进程、无论多么试图自启和推送各种广告，最终只会换来用户的反感，得不偿失。</p><p>「绿色应用公约」提出最大的影响就是，让一部分有良知有担当的应用主动去除对体验的破坏，让自己的应用支持「绿色应用公约」，手机厂商内置的 OEM 的安全中心类优化功能会对支持公约的应用放宽限制，例如不再强杀进程、允许长周期的后台任务、放宽对某些合理事件的自启动限制。最后这是一场良性循环。<br />而对于用户而言，这样一种公约无疑成为了一种评判标准。追求设备使用体验的用户将会倾向于安装和使用已经支持了「绿色应用公约」的应用，最终将会为这些应用带来更大的利益，最后依然是一场良性循环。</p><blockquote><p>当然，这个趋势肯定不是从 BAT 开始的，毕竟他们的提供了用户无法割舍的服务。所以公约能带来的价值可能还不及对它们的束缚。但对于中小应用，以及行业其它阵线的挑战者就不同了。他们中作为行业中的先知先觉者的那一部分，就会意识到即将到来的问题并开始行动。当用户知晓并转投这些产品中，那么顶部的巨头就会受到撼动。</p></blockquote><p>目前，「绿色应用公约」推行非常顺利。冯老师和很多手机 OEM 厂商的开发者进行了沟通，很多开发者也表示支持，就连华为的“安卓绿色联盟”都对「绿色应用公约」表态支持。</p><blockquote><p>是的，这是一个信号。以各巨头统一推送渠道为基础的“安卓绿色联盟”和以“后台纯净<br />”为基础的「绿色应用公约」如果达成共识，这将会是国内 Android 生态的一场动荡，将会引发巨变。</p></blockquote><p>如果，「绿色应用公约」能够推行下去，从用户、神器的作者、手机厂商，再到 BAT 这样的巨头。如此良性循环地发展，最终国内令人诟病的 Android 生态将会得到改变。</p><hr /><p>如何看待一些人对「绿色应用公约」的反对意见？<br />这不置可否。毕竟如今毒瘤横行的国内 Android 生态是一种僵局，打破这个僵局的确并不容易。单单靠一个公约，或许不能改变整个生态。但是，我们必须试着去努力，不是么？<br />所以，像 piebridge 这种继续试图魔高一尺、道高一丈地压制毒瘤，只会让毒瘤继续尝试突破。最终两败俱伤，国内 Android 生态只会继续恶化。<strong>是的，使用黑域这类软件，对改善国内 Android 生态毫无意义。</strong><br />对于 piebridge 唱衰通过破坏毒瘤的组件完整性的优化方案的行为，例如绿色守护基于 Intent Filter Wall 的处方，例如 MyAndroidTools。是的，很多开发者都不喜欢它们，而且，我也不喜欢它们。虽然我是 <a href="https://mat.letitfly.me" target="_blank">MAT BBS</a> 的管理团队成员，MAT BBS 是一个讨论 MyAndroidTools 禁用方案的论坛。但是，如果我们能最终改善国内 Android 生态，让各种神器最终一无是处，此时，还需要诟病破坏组件之类的么？同样，你黑域破坏应用的国内推送渠道，相比绿色守护用“后台纯净”同时保障用户体验和厂商推送，不也是破坏应用的组件和功能完整性？</p>]]></content>
        
        <summary type="html">
            
            黑云蔽空，极夜将至，风雷涌动，没有雨。 在寂寞中奔驰的猛士啊，在暂时无人慰藉你之前，请不要惮于前驱。——题记什么是 Android 「绿色应用公约」？这是公约的内容：https://green-android.org/app-convention.html还有，这是冯老师的 《
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="Android"/>
        
        <category term="省电"/>
        
        <category term="生态"/>
        
    </entry>
    
    <entry>
        <title>CCMT 收购 SuperSU 以后</title>
        <link href="https://blog.nfz.moe/archives/after-the-acquisition-of-supersu-by-ccmt.html"/>
        <id>https://blog.nfz.moe/archives/after-the-acquisition-of-supersu-by-ccmt.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-05-26T15:16:21+00:00</published>
        <updated>2017-05-26T15:16:21+00:00</updated>
        
        <content type="html"><![CDATA[<p> 大概没有比 SuperSU 声誉更好、认可度最高的软件。无论是移动设备、平板电脑，亦或者机顶盒、智能手表，只要是基于 Android 的设备，大家都会想到使用 Chainfire 的 SuperSU 来接管 Android 系统的 Root 权限。</p><a></a><h1><a href="https://blog.nfz.moe/archives/after-the-acquisition-of-supersu-by-ccmt.html# 从 2015-09-29 开始谈起"></a> 从 2015.09.29 开始谈起 </h1><p>SuperSU 的作者 Chainfire 在近一年前（2015 年 09 月 29 日）的时候，将 SuperSU 项目移交给了一家叫 Coding Code Mobile Technology LLC 的公司（简称 CCMT）。包括 SuperSU 源码、签名以及 Chainfire 自己的 Google play 开发者账号。xda 上发布了一些有关的声明：<a href="http://www.xda-developers.com/chainfire-makes-important-announcement-about-supersus-future" target="_blank">Chainfire Makes Important Announcement About SuperSU’s Future</a></p><p>Chainfire 也在 Google+ 发表声明称，将此项目移交给 CCMT 以便让自己更好的去处理别的事情。</p><p>Chainfire 指出 CCMT 是一个用于接管 SuperSU 的全新公司。Chainfire 还表示 SuperSU 不会立即发生变化，它仍然是可以免费下载并再发布的（只要不经过修改）。将 SuperSU 移交给 CCMT 后，SuperSU 项目将会有更多的资金和更多的开发者参与，以利于 SuperSU 继续完善功能并更好的运行在众多 Android 设备上。</p><p> 之后，Chainfire 仍然在继续维护 SuperSU 项目，并在其个人网站 <a href="https://chainfire.eu/" target="_blank">chainfire.eu</a><br /> 上发布。</p><p> 在 2016 年 09 月 02 日（北京时间）的时候，CCMT 通过 Google Play 商店发布了第一个由 CCMT 基于原 SuperSU 源码进行开发的第一个版本 v2.78。</p><blockquote><p> 实际上，截止到本博客发布，Google play 上共发布过两个 CCMT 提供的 SuperSU 版本，一个是 2.73，另一个则是 2.78。</p></blockquote><p> 在酷安上，曾经有两次应用被收购引起了轩然大波，一次是 xposed 模块“阻止运行”被 liudongmiao 卖给了上海猎鹰网络的工作室，另一次就是这次 SuperSU 被一家来自中国的公司收购。</p><h1><a href="https://blog.nfz.moe/archives/after-the-acquisition-of-supersu-by-ccmt.html# 博主个人的冷眼旁观"></a> 博主个人的冷眼旁观 </h1><p>Chainfire 自己也没有构建，CCMT 就自行发布了新版本；</p><p> 严重怀疑是不是 Chainfire 说的来自纽约州的全新公司，而不是中国控制的空壳公司。<br /> 更新 logo 动不动就全球、率先、首发、第一…国产软件就这尿性么…</p><blockquote><p> 连 SuperSU 主页都把自己公司名字拼错了（目前已经修改）<br /><img src="https://st.nfz.yecdn.com/img/blog/0000006.jpg" /></p></blockquote><h1><a href="https://blog.nfz.moe/archives/after-the-acquisition-of-supersu-by-ccmt.html# 目前似乎一切正常"></a> 目前似乎一切正常 </h1><ol><li> 目前为止没有任何证据表明 CCMT 正在利用 SuperSU 做危害 Android 系统安全的事情。</li><li> 并不表明使用了由 CCMT 发布的 SuperSU 以后，系统就变的不再安全。</li><li> 获取 root 权限只是 Android 的一种使用方式； root 本身即存在风险。</li></ol><p>CCMT 公司是由谁控制的并不重要，如果一家美国公司通过 root 级别植入广告和跟踪工具，它仍然是坏公司。某些营销号和网站总想搞个大新闻，报道一些夸大且危言耸听的东西。恶意软件远比 SuperSU 亦或者 Root 权限本身更可怕。</p><hr /><p>2017.03.08 更新：CCMT 用 Chainfire 的 Play 帐号发布了一个新的手机管理软件 <code>AppMaster</code>，用户体验后说该应用在获取了 root 权限后会自动重启并把自己转成 <code>priv-app</code> 应用。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000069.png" /></p><p> 有网友认为这并不是 Chainfire 的一贯风格，所以在 xda 上询问 Chainfire，答复如下：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000070.jpg" /></p><blockquote><p>SuperSU 被收购以后，也并没有太多兼容性、功能性的改动。我自己已经在用 MagiskSU，以后会发生什么，也只能 Wait and see 罢了。</p></blockquote><hr /><p>2017.05.26 再度更新：</p><p> 嗯，SuperSU 最终还是开始作恶了。还是同样老套的“统计和信息采集”的理由，增加不必要的权限，如定位权限。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000115.png" /></p><blockquote><p> 在这里我顺便挂一个大言不惭的人。说真的，我还以为他只是跟我过不去呢。要不是在酷安我和他有过过节，我还真的以为他是 CCMT 请来的水军。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000116.png" /></p><hr /><p><strong> 对了，至于大家关心的、这个中国公司是否可靠的问题，可以参考前文。是的，这是一个曾经把自己官网页脚公司的英文名字的单词都拼错过的公司。我想，没必要再对这家公司做更多评价了。</strong></p>]]></content>
        
        <summary type="html">
            
             大概没有比 SuperSU 声誉更好、认可度最高的软件。无论是移动设备、平板电脑，亦或者机顶盒、智能手表，只要是基于 Android 的设备，大家都会想到使用 Chainfire 的 SuperSU 来接管 Android 系统的 Root 权限。 从 2015.09.29 
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="Android"/>
        
        <category term="Root"/>
        
        <category term="SuperSU"/>
        
        <category term="CCMT"/>
        
    </entry>
    
    <entry>
        <title>服务器装好系统后，我会做的一些操作</title>
        <link href="https://www.iwch.me/archives/649.html"/>
        <id>https://www.iwch.me/archives/649.html</id>
        
        <author>
            <name>Zohar</name>
        </author>
        
        <published>2017-05-26T13:28:00+00:00</published>
        <updated>2017-05-26T13:28:00+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<p></p><h2>前言</h2><p>今天给一台服务器重装了系统，于是顺便记录一下装好系统后我所做的一些操作，方便以后拿到新的服务器后直接复制&amp;粘贴。</p><p>注意：请不要在OpenVZ架构的VPS上安装和使用Arch Linux系统！</p><h2>安装系统</h2><p>我个人喜欢使用<a href="https://www.archlinux.org/" target="_blank">Arch Linux</a>系统。如果服务器提供商不提供Arch Linux系统的安装，并且不能挂载自定义镜像的话，可以考虑使用<a href="https://github.com/drizzt/vps2arch" target="_blank">VPS2Arch</a>脚本(<a href="https://github.com/drizzt/vps2arch/wiki/Tested-VPS-Providers" target="_blank">测试的VPS提供商</a>)，三行命令搞定Arch Linux系统的安装。</p><h3>VPS2Arch</h3><p><strong>注意！此操作将会删除你服务器中的所有数据！</strong></p><pre><code>wget http://git.io/vps2arch
chmod +x vps2arch
./vps2arch
</code></pre><h2>安装后的工作</h2><p>以下的所有操作是在Arch Linux的root用户环境下完成。</p><h3>选择镜像</h3><p>编辑<code>/etc/pacman.d/mirrorlist</code>文件，选择两个到你服务器速度比较快的镜像。因为我目前使用的是国内的VPS，所以选择了科大和清华的镜像站。</p><pre><code>Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
</code></pre><h3>安装常用工具</h3><p><strong>安装基本软件包</strong></p><p>这一步因人而异。我一般会最先装好<code>base-devel</code>软件包组，其中包括<code>make</code>和其他编译工具。这一步是编译AUR软件包的前提。</p><p>还有一些其他软件包，一起安装，不再一一解释。</p><pre><code>pacman -Syu base-devel vim git wget curl unzip screen jemalloc
</code></pre><p><strong>安装Oh My Zsh</strong></p><pre><code>pacman -Syu zsh
sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;
pacman -Syu bash-completion zsh-completions
</code></pre><p><strong>安装yaourt</strong></p><p>需要在非root用户环境下完成。</p><pre><code>git clone https://aur.archlinux.org/package-query.git
cd package-query
makepkg -si
cd ..
git clone https://aur.archlinux.org/yaourt.git
cd yaourt
makepkg -si
cd ..
</code></pre><p>基本上就这些内容，然后开始安装服务器线上环境。有什么补充的话，随时更新。</p></div>]]></content>
        
        <summary type="html">
            
             前言今天给一台服务器重装了系统，于是顺便记录一下装好系统后我所做的一些操作，方便以后拿到新的服务器后直接复制&amp;amp;粘贴。注意：请不要在OpenVZ架构的VPS上安装和使用Arch Linux系统！安装系统我个人喜欢使用Arch Linux系统。如果服务器提供商不提供Arc
            
        </summary>
        
    </entry>
    
    <entry>
        <title>绿色守护使用教程</title>
        <link href="https://blackyau.cc/6.html"/>
        <id>https://blackyau.cc/6.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2017-05-25T08:46:00+00:00</published>
        <updated>2017-05-25T08:46:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>当今安卓系统中优化软件众多，但因为绿色守护的快捷性和更新迭代时间长。他在优化类软件安装量前几的宝座，相信在一段时间内都无人能抵。本人在刚开始接触安卓系统优化的时候，第一个上手的就是绿色守护。作为这样一个神器，我们还有什么理由不去学习一下使用方法呢？</p><p>绿色守护完整解锁捐赠版下载链接：<br />正式版<a href="https://www.htcp.net/924.html">https://www.htcp.net/924.html</a><br />测试版<a href="https://www.htcp.net/912.html">https://www.htcp.net/912.html</a><br />无论任何时候我都建议只使用正式版</p><p>【如何校验MD5】<br />MD5相当于每一个文件的身份证，都是不同的。而由于网络的不稳定或运营商不老实。可能会导致文件损坏，不完整...等一系列问题。而不懂的人又会吧锅丟给作者，所以需要校验MD5。<br />a1.目前主流的文件管理器都可以校验MD5，这里我以MT管理器为例。<br />a2.找到你下载的APK文件<br />a3.然后长按-属性-校验。<br />a4.将我提供的MD5粘贴进去。<br />a5.如果窗口出现了绿色的“MD5√”则MD5一致。<br />注：如果MD5不一致，首先确定是否复制错了。如果没有，那么你可以重新下载或者是换一个网络重新下载。直到一致为止。<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/1.jpg" /></p><p>【如何添加需要绿色化的应用】<br />b1.点击右上角的 ＋<br />b2.在最下面点击显示更多应用<br />b3.选择你要绿色化的应用，点击右下角的√即可<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/2.jpg" /></p><p>【未ROOT如何设置】<br />未ROOT的设备，绿色守护是通过模拟点击应用详细页的“强制停止”来绿色化应用。<br />c1.点击右下角的zzz<br />c2.点击下方提示中的“设置”<br />c3.点击“绿色守护-自动休眠助手”<br />c4.启动开关，并点击确定。<br />c5.点击绿色守护主页右上角竖直三点中的设置，打开“不移除通知消息”在弹出的新窗口中也将绿色守护的开关打开。（若在新窗口中没有绿色守护，则无视）<br />c6.如果你是Android 4.4~5.x用户 还可以导入处方（对于应用唤醒有奇效）<br />绿色守护处方收集贴<a href="https://tieba.baidu.com/p/5108728433?see_lz=1">https://tieba.baidu.com/p/5108728433?see_lz=1</a><br /><img src="https://blackyau.b0.upaiyun.com/blog/6/3.jpg" /><br />补充：<br />1.如果你没有锁屏密码，请在请在绿色守护主页面。右上角竖直三点中的设置，打开“全自动化休眠”<br />2.如果你是Android6.0+系统，请在绿色守护主页面。右上角竖直三点中的设置，打开嗜睡模式。</p><p>【已ROOT如何设置】<br />已ROOT的状态下，相对于未ROOT也就是全自动化休眠可以在已设置密码的状态下使用。<br />d1.操作与c1～c5相同<br />d2.在绿色守护主页面，右上角竖直三点中的设置。打开“特殊方式关屏”<br />d3.导入处方（对于应用唤醒有奇效）<br />绿色守护处方收集贴<a href="https://tieba.baidu.com/p/5108728433?see_lz=1">https://tieba.baidu.com/p/5108728433?see_lz=1</a></p><p>【同时有ROOT和Xposed框架】<br />这才是绿色守护的完全状态，火力全开！<br />e1.在Xposed Installer中的模块页，将绿色守护打勾并重启设备。<br />e2.在绿色守护主页的设置中，将工作模式切换为高效模式。<br />e3.在绿色守护主页的设置中，将“基于Xposed的特性”页面中的所有选项打勾。<br />e4.在绿色守护主页的设置中，将唤醒追踪及切断打开。</p><p>疑难问题解答：</p><p>【绿色守护经常提示“自动休眠服务已停止”怎么办？】<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/4.png" /><br />在应用程序的后台管理中吧绿色守护锁定。<br />请到绿色守护主页的设置中的“疑难问题解决”将自动休眠中的“服务守护打开”同时根据这一选项下面的提示，将绿色守护允许自启。<br />再到手机设置-应用程序-设备管理器。讲绿色守护打勾并激活。<br />再到手机设置-辅助功能。将“绿色守护-自动休眠助手”打开。</p><p>【为什么我在绿色守护看不到，程序是被什么唤醒的？】<br />请到绿色守护主页的设置中，将唤醒追踪及切断打开。<br />请到绿色守护主页的设置中，将浅度休眠关闭。（针对Android6.0+系统）<br />点击此页的疑难问题解决-应用并未自动休眠。将唤醒追踪打开。</p><p>【怎么阻止应用互相唤醒？】<br />首先根据f2进行操作。<br />然后就在主页，点击一个被唤醒的应用。在点击右上角的小剪刀，在弹窗中再点击确定即可。<br />注：只有在唤醒的时候才会有小剪刀出现<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/5.jpg" /></p><p>【什么是处方？如何使用处方功能？】<br />处方是绿色守护3.0时推出的功能，它是针对应用中不欢迎的组件进行定向阻止的功能。本文只是介绍如何使用以及移除该功能，如果想要深入了解可以前往<a href="https://greenify.github.io/README.chs.html">绿色守护官方文档</a>（中文）进行了解。处方功能在未ROOT状态下只支持在Android 4.4~5.x下工作。对于已ROOT设备无限制。</p><p>导入处方<br />1.点击处方链接后，选择“用浏览器打开”<br />2.选择导入处方<br />3.然后点击右下角的悬浮按钮导入处方<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/6.jpg" /></p><p>移除/关闭处方<br />1.点击绿色守护主页的 处方<br />2.看图操作<img src="https://blackyau.b0.upaiyun.com/blog/6/7.jpg" /></p><p>【什么是纯净模式？】<br />处于后台纯净状态的应用，并不会在后台『继续运行』，它是处于不耗电的闲置待回收状态的，所以通常不必担心耗电和内存消耗问题。唯一的例外是后台纯净状态下，应用可以周期性的执行一些短暂的后台任务，类似于iOS下的应用后台约束。这些后台周期任务，一旦在手机进入打盹状态（Doze mode，嗜睡模式可以更早激活Doze）后也不再运行。（来自绿色守护作者oasisfeng在酷安评论区的回复）</p><p>【未ROOT用户通过ADB指令启用唤醒追踪或积极打盹】<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/8.jpg" /><br />首先要说明，对于Android 4.4~5.x是可以无ROOT截断唤醒的（小剪刀），其他版本都需要ROOT才能做到。（参考9楼）<br />对于打盹模式和激进打盹，所有设备都可以实现。<br />首先下载并打开此<a href="https://blackyau.b0.upaiyun.com/blog/6/adb-setup-1.4.3.rar">ADB工具箱</a><br />在弹出的窗口中输入y并按回车，依次重复操作3 次<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/9.png" /><br />操作完毕后，又会弹出一个“设备驱动程序安装向导”直接点击“下一步”即可安装完毕。<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/10.png" /><br />然后在设置-开发者选项中将设备USB调试打开（若没有，请连续点击关于本机中的版本号。直至提示“您已进入开发者模式”设置中就会有这一项了）<br />将设备使用USB线连接至电脑。按住windows徽标不放然后再按字母R，在弹出的窗口中输入cmd并点击确定。<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/11.png" /><br /><img src="https://blackyau.b0.upaiyun.com/blog/6/12.png" /><br />首先输入指令adb devices（若出现0701352 device）类似文字则表明已成功连接，若未出现。请安装豌豆荚等软件，让他们连接上手机后。将豌豆荚退出，在输入指令。<br /><img src="https://blackyau.b0.upaiyun.com/blog/6/13.png" /><br />如果你要启动嗜睡模式（Android 7.0+），请继续输入以下指令。并回车确定</p><pre><code>adb -d shell pm grant com.oasisfeng.greenify android.permission.WRITE_SECURE_SETTINGS
</code></pre><p>如果你要启动 浅度休眠/嗜睡模式，请继续输入以下指令。并回车确定</p><pre><code>adb -d shell pm grant com.oasisfeng.greenify android.permission.DUMP
</code></pre><p>如果你要启动唤醒追踪和小剪刀，请继续输入以下指令。并回车确定</p><pre><code>adb -d shell pm grant com.oasisfeng.greenify android.permission.READ_LOGS
adb -d shell pm grant com.oasisfeng.greenify android.permission.WRITE_SECURE_SETTINGS
分两次输入，都要回车一次
</code></pre><p>如果要让你输入的命令生效，请在最后。输入以下指令。并回车确定</p><pre><code>adb -d shell am force-stop com.oasisfeng.greenify
</code></pre><p>重新打开绿色守护设置好后即可生效。</p>]]></content>
        
        <summary type="html">
            
            当今安卓系统中优化软件众多，但因为绿色守护的快捷性和更新迭代时间长。他在优化类软件安装量前几的宝座，相信在一段时间内都无人能抵。本人在刚开始接触安卓系统优化的时候，第一个上手的就是绿色守护。作为这样一个神器，我们还有什么理由不去学习一下使用方法呢？绿色守护完整解锁捐赠版下载链接
            
        </summary>
        
    </entry>
    
    <entry>
        <title>查询Minecraft正版用户UUID</title>
        <link href="https://131.re/marchives/99"/>
        <id>https://131.re/marchives/99</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-05-23T04:00:00+00:00</published>
        <updated>2017-05-23T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[
<blockquote>
<p>官方API</p>
</blockquote>
<p>请求URL：</p>
<ul>
<li><code>https://api.mojang.com/users/profiles/minecraft/用户名</code></li>
</ul>
<p>请求方式：</p>
<ul>
<li>GET</li>
</ul>
<p>返回示例：</p>
<pre><code>{&quot;id&quot;:&quot;1aa95b7148fc4636962be95de5071da6&quot;,&quot;name&quot;:&quot;Zi_Min&quot;}
</code></pre>
<p>请求示例：</p>
<pre><code>curl https://api.mojang.com/users/profiles/minecraft/Zi_Min | Select -ExpandProperty Content
{&quot;id&quot;:&quot;1aa95b7148fc4636962be95de5071da6&quot;,&quot;name&quot;:&quot;Zi_Min&quot;}
</code></pre>
<p>注：请求时用户名不区分大小写</p>]]></content>
        
        <summary type="html">
            
              官方API  请求URL：  https://api.mojang.com/users/profiles/minecraft/用户名  请求方式：  GET  返回示例： {&amp;quot;id&amp;quot;:&amp;quot;1aa95b7148fc4636962be95de5071
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Wanna Cry 加密病毒又能教会我们什么</title>
        <link href="https://www.isthnew.com/archives/wannacry.html"/>
        <id>https://www.isthnew.com/archives/wannacry.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-05-16T14:47:36+00:00</published>
        <updated>2017-05-16T14:47:36+00:00</updated>
        
        <content type="html"><![CDATA[<p>其实这个病毒被媒体大规模报道的时候，我还觉得只会是那些维护不得当的机房会中招，因为用许多高校的计算机机房举例来说，几乎就是没有管理和任何的安全措施，甚至在其中编辑的 Doc</p>]]></content>
        
        <summary type="html">
            
            其实这个病毒被媒体大规模报道的时候，我还觉得只会是那些维护不得当的机房会中招，因为用许多高校的计算机机房举例来说，几乎就是没有管理和任何的安全措施，甚至在其中编辑的 Doc
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="安全"/>
        
        <category term="Wanna Cry"/>
        
        <category term="病毒"/>
        
    </entry>
    
    <entry>
        <title>魅族系统截图被附上全屏二维码水印，其中包含设备信息·转载</title>
        <link href="https://blog.nfz.moe/archives/meizu-qrcode-screenshot.html"/>
        <id>https://blog.nfz.moe/archives/meizu-qrcode-screenshot.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-05-16T13:30:00+00:00</published>
        <updated>2017-05-16T13:30:00+00:00</updated>
        
        <content type="html"><![CDATA[<a></a><ul><li>原作者：<a href="http://www.jianshu.com/u/f5f26e7f4133" target="_blank">Pandaria98 - 简书</a></li><li>原文链接（发表于简书）：<a href="http://www.jianshu.com/p/a1119d547f3d" target="_blank">魅族系统截图被附上全屏二维码水印，其中包含设备信息</a></li><li>原作者 · 知乎：<a href="https://www.zhihu.com/people/wu-ling-jiang-71/activities" target="_blank">执夷 - 知乎</a></li><li>原作者 · MAT BBS：<a href="https://mat.letitfly.me/?4414" target="_blank">Pandaria - MAT BBS</a></li></ul><blockquote><p>特殊注明：本文著作权和解释权由简书作者 Pandaria 所有，<strong>原作者保留一切权利 </strong>，本博客仅在接受授权后予以完整转载，并无二次演绎。<strong> 本文不受本博客 CC BY-NC-SA 3.0 Unported 协议的限制</strong>。</p></blockquote><hr /><p>本人在使用魅族手机 (原生 Flyme 系统) 的过程中，发现偶尔在一些网站上发布自己的手机截图后，图片会出现奇怪的色块。同时，其他魅族手机发布的截图中，也有类似的情况 (<strong> 为保护隐私</strong>，本文所有二维码主体部分使用白色色块遮挡，可从四角的二维码定位点判断出这确实是二维码)：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000100.png" /></p><p>起初我以为这只是图片在上传过程中发生的压缩导致的一些画质损失，但最近在某消息的提醒下发现，实际上图片上的色块并不是画质损失导致的，而是图片实实在在的被打上 <strong>全屏二维码水印 </strong>，将以上的图片进行调色处理后，二维码的图像变得明显(<em> 具体的还原步骤在文末</em>)：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000101.png" /></p><p>在 <strong> 反色 </strong> 之后，它就是一个实实在在的二维码了：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000102.png" /></p><p>识别结果是(为保护隐私，本文字符串中部分字符用「*」号代替)：</p><pre><code>#192#168#0#115#,460013*****8248#A10ABN****3H#m1metal</code></pre><p>稍加分析，可以容易的判断出：</p><ul><li>前四串字符是 IP 地址，这里是一个内网 IP</li><li>第五串字符是 IMSI 码，类似 IMEI，用于标识 SIM 卡</li><li>第六串字符是魅族设备的序列号</li><li>最后一串字符是魅族设备的型号</li><li>关于 IMSI</li></ul><p>我对于 IMSI 也是知之甚少，这里将我通过搜索引擎的来的结果列于下方(不保证准确)：</p><ul><li>IMSI 与 手机号码 没有必然的对应关系</li><li>IMSI 在到达运营商的交换机才可知道与 手机号码 相应的对应关系</li><li><strong>可能 </strong> 存在通过 IMSI 得到地域位置的算法</li></ul><p>另外，在探索过程中，在魅族社区找到了这样一张图：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000103.png" /></p><p>经过同样的步骤还原之后，得到了这样一张二维码：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000104.png" /></p><p>识别结果是：</p><pre><code>#---#---#---#---#460011*****2453#95AQACQ****M7#MX6#</code></pre><p>结果完全类似，只是由于可能是断网截图，IP 信息被留空了。<br />那么问题就来了，这种现象到底是不是个例呢？</p><p><strong>不是，它是完全可以被复现的。</strong></p><p>复现的方法非常简单，只要截图的背景颜色较深，就会出现二维码水印。而浅色背景的截图则不会出现二维码。</p><blockquote><p>注：以下测试基于本人自己的手机</p></blockquote><ul><li>机型：魅族 PRO 6</li><li>固件版本：Flyme 6.0.2.0A</li><li>这是截至本文发布，魅族官网上 PRO 6 的稳定版固件的最新版本：</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000105.png" /></p><hr /><p>下面是我在 JuiceSSH 中截图以后得到的图片：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000106.png" /></p><p>在手机上打开，肉眼几乎看不出上面有二维码(但还是能看见)，而在电脑上打开，由于图片解码库不同的缘故，可能导致完全看不到二维码，但是通过在网站上发布，经过服务端的压缩之后，二维码变得明显：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000107.png" /></p><p>同样的步骤将二维码还原：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000108.png" /></p><p>识别的结果：</p><pre><code>#---#---#---#---#460023*****9130,460009*****0563#80QBC***JFY#PRO6#</code></pre><p>由于我的手机是双卡，所以 IMSI 也有两个。经过在 OSBuild 这个应用中查看发现，与手机实际的 IMSI 吻合。<br />而下面是用 fooView 第三方截图获得的图片，没有任何的二维码水印。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000109.png" /></p><h3><a href="https://blog.nfz.moe/archives/meizu-qrcode-screenshot.html# 还原步骤"></a>还原步骤</h3><ul><li>使用魅族手机在 JuiceSSH 等背景颜色较深且为纯色的应用内进行系统截图，也可以对上方展示的没有二维码的图进行截图</li><li>此时用手机的图库查看图片，仔细看可以看到轻微的二维码</li><li>到酷安等发布图片将遭到压缩的网站上发布图片，获取压缩后的图片，如果直接用 Photo Editor 对原图进行还原，可能根本看不到二维码</li><li>使用 Photo Editor 调整<ul><li>打开图片，选择「色阶」，调整上方三个滑块至靠近波峰处，二维码将变得明显，点击右上角的勾保存操作(保存操作这一步下同)</li><li>选择「特效」-「自动对比度」，保存</li><li>选择「特效」-「负片」，保存</li><li>点击右上角的蓝色保存按钮，保存图片到指定的路径</li></ul></li><li>识别你获得的二维码图片</li></ul><p>本文只讲述事实，不作过多评价。<br />只是希望各位不要再用魅族的系统截图。<br />推荐使用第三方截图。</p><blockquote><p><strong>以下是目前为止与魅族官方人员对话的截图：</strong></p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000113.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000111.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000112.png" /></p><hr /><ul><li>原作者授权 <a href="https://akarin.moe" target="_blank">RockyLo</a> 转载的知乎专栏：<a href="https://zhuanlan.zhihu.com/p/26936016" target="_blank">转载：魅族系统截图被附上全屏二维码水印，其中包含设备信息 - 知乎专栏</a></li><li>与本文章相关的知乎问题在此处：<a href="https://www.zhihu.com/question/59919887" target="_blank">如何评价魅族为系统截图添加水印的行为？ - 知乎</a></li><li>对于位于知乎专栏和原文简书评论区的疑问，原作者补充了发现此问题的系统版本截图：</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000110.jpg" /></p><blockquote><p>直到 <code>2017 年 /5 月 /16 日</code> 为止此版本依旧是魅族官方最新的稳定版。</p></blockquote>]]></content>
        
        <summary type="html">
            
            原作者：Pandaria98 - 简书原文链接（发表于简书）：魅族系统截图被附上全屏二维码水印，其中包含设备信息原作者 · 知乎：执夷 - 知乎原作者 · MAT BBS：Pandaria - MAT BBS特殊注明：本文著作权和解释权由简书作者 Pandaria 所有，原作者
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="Android"/>
        
        <category term="安全"/>
        
        <category term="魅族"/>
        
        <category term="隐私"/>
        
    </entry>
    
    <entry>
        <title>暗流涌动：这是如今的互联网</title>
        <link href="https://flyhigher.top/diary/510.html"/>
        <id>https://flyhigher.top/diary/510.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-05-14T13:02:12+00:00</published>
        <updated>2017-05-14T13:02:12+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>这篇文章仅代表我个人的一些想法，写得有点粗糙，不如就当做一个技术宅发的牢骚好了。</strong></p>
<p>下面是正餐。</p>
<p>就在这篇文章发布的几天前，全球互联网爆发了一次大危机。一款名为“WannaCry”的病毒利用Windows系统“永恒之蓝”漏洞在互联网上大肆传播，通过加密文件索取比特币的方式获利，受害的设备不计其数。然而，这只是互联网目前混乱局面的一个缩影。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/05/IMG_20170514_203101.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/05/IMG_20170514_203101.jpg" /></a></p>
<p>这是我的一台服务器登录时的截屏。可以看到，几天之内，这台服务器就受到近千次密码爆破尝试。而查阅日志发现，这些攻击IP来自世界各个角落。很明显没有谁会大动干戈调用如此大量的设备攻击我，唯一的解释是这只是常规的、试探性的攻击。这些攻击日日夜夜都在发生，目标是世界上每一台暴露在公网上的服务器。</p>
<p>互联网的现状，远比大部分人想的危险的多。每一次的连接，数据到达你的设备之前，都要经过不计其数的其他设备。而这些设备的所有者不一定都是好心人。几乎可以说，你的每一次互联网连接，都是被他人窥视的。</p>
<p>之前Freebuf上的一篇文章基本上印证了我的想法。先上链接<a href="https://flyhigher.top/go/?url=http%3A%2F%2Fwww.freebuf.com%2Fnews%2Ftopnews%2F118424.html" target="_blank">http://www.freebuf.com/news/topnews/118424.html</a>。其实这篇文章蛮吓人的（万一里面有你的站2333），但也真实地反映了互联网的现状。而这只是中间人利用你的数据获利的一种方式（更何况互联网的暗流不止中间人攻击这一股）。更广泛的，是运营商的DNS劫持和HTTP劫持，估计少有人没碰到过。百度的无奈不必说了，树大招风。我所在地的劫持甚至猖狂到了导致七牛云首页js错误而无法登录…而投诉又总是没有效果。估计运营商自己也很无奈吧，毕竟公司员工如此多，想管也有心无力。</p>
<p>扯远了。</p>
<p>还有一个不得不说的就是暗网了（不了解的请自行了解）。我相信暗网、深网这才是世界真实的样子。这里是黑暗的猖狂之地，所幸它与我们的生活没有太大交集。但是很快了，不久前已有人公布了在攻击时将C&amp;C服务器置于暗网中的思路。这会导致攻击更难溯源，也会使黑暗更加猖獗。而这又只是暗网小小的一角。</p>
<p>黑暗当然不止这些。把时间再往前推一推，美国在不久前发生了一次大规模的断网事件，而这一事件起因是美国几大DNS服务商之一受到了大规模的DDOS攻击。时间再往前，阿里云曾宣布过他们防御了世上最大规模的DDOS攻击（14小时，流量峰值453.8Gb/s）（我的广告费呢）。不难看出，DDOS攻击的成本已经越来越低，很多时候甚至十几块就能打瘫一台服务器。而和攻击的廉价相比，防御就昂贵得多，也困难的多了。而且DDOS的流量洪峰如果不加控制，就能轻易堵塞一片区域甚至一座城市所以互联网连接。</p>
<p>最后再说一个，僵尸网络。就像电影中的僵尸一样，这些由无数设备组成的一个个互联网络正在以极快的速度扩展，而受害者大多是那些设计没有用心的智能设备。僵尸网络会接管这些设备，然后潜伏起来，并偷偷攻击其他设备来传播。一旦攻击者发出指令，这些设备便会统一行动起来。之前说到的美国断网事件，DDOS的来源便是全球百万台智能摄像头。当然不只有DDOS，想象一下，你的摄像头偷偷摸摸拍摄你的生活…</p>
<p>此前有安全公司的研究人员做过一个实验。他们把一台全新的智能摄像头接入网络，然后检测其网络连接。两秒之后这个摄像头被其他感染了僵尸网络的设备扫描到，然后就被黑了。</p>
<p>没了。</p>
<p>快到令人难以置信。</p>
<p>这就是互联网残酷而混乱的现状。我不想再举其他例子了，因为实在太多了。重要的是，这看似遥远的一切其实离我们很近，而且没有谁可以避免。我写下这一切，是为了提醒你们，没有什么可以掉以轻心，不论你自认为自己的信息是多么不重要。</p>
<p>曾经以自由自诩的互联网，正在变得不自由而危险，每个角落，都有暗流涌动。</p>
<p>而这一切的解决之道，只能寄托于防御技术的发展以及互联网使用者的道德和人品。</p>
<p>互联网把世界缩小了，而世界越小，每个人的人品就越重要。何况根据热力学第二定律，破坏总是比建立更简单。（逃</p>
<p>—不正常分割线—</p>
<p>看起来好奇怪的样子，还是放首歌撑一撑吧2333</p>
<div></div>]]></content>
        
        <summary type="html">
            
            这篇文章仅代表我个人的一些想法，写得有点粗糙，不如就当做一个技术宅发的牢骚好了。 下面是正餐。 就在这篇文章发布的几天前，全球互联网爆发了一次大危机。一款名为“WannaCry”的病毒利用Windows系统“永恒之蓝”漏洞在互联网上大肆传播，通过加密文件索取比特币的方式获利，受
            
        </summary>
        
        <category term="其他"/>
        
        <category term="开发"/>
        
        <category term="DDOS"/>
        
        <category term="DNS"/>
        
        <category term="互联网"/>
        
        <category term="安全"/>
        
    </entry>
    
    <entry>
        <title>Ubuntu版Telegram CJK（中韩日）字体优化方案</title>
        <link href="https://milkice.me/2017/05/13/ubuntu-telegram-cjk-font-optimization/"/>
        <id>https://milkice.me/2017/05/13/ubuntu-telegram-cjk-font-optimization/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-05-13T12:01:52+00:00</published>
        <updated>2017-05-13T12:01:52+00:00</updated>
        
        <content type="html"><![CDATA[前言 Telegram是一款俄罗斯人开发的IM软件，由于其安全性高、功能多、表情包丰富（这是重点！）、客户端优雅简介、跨平台、API强悍、完全免费，同时亦可用作逃避审查的通讯工具，因此深受国内IT相关人士喜爱 此处同时心里默念三遍 sb腾讯 Telegram在多个平台都开发了客户端 每个平台的客户端都很出彩 Telegram网页客户端更是……]]></content>
        
        <summary type="html">
            
            前言 Telegram是一款俄罗斯人开发的IM软件，由于其安全性高、功能多、表情包丰富（这是重点！）、客户端优雅简介、跨平台、API强悍、完全免费，同时亦可用作逃避审查的通讯工具，因此深受国内IT相关人士喜爱 此处同时心里默念三遍 sb腾讯 Telegram在多个平台都开发了客
            
        </summary>
        
        <category term="Linux"/>
        
        <category term="OS"/>
        
        <category term="Tech"/>
        
        <category term="Ubuntu"/>
        
        <category term="CJK"/>
        
        <category term="Font"/>
        
        <category term="Telegram"/>
        
    </entry>
    
    <entry>
        <title>OsuSync Project</title>
        <link href="https://milkice.me/2017/05/07/osusync-project/"/>
        <id>https://milkice.me/2017/05/07/osusync-project/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-05-07T11:30:24+00:00</published>
        <updated>2017-05-07T11:30:24+00:00</updated>
        
        <content type="html"><![CDATA[Progress bar Tasks 虾米音乐API 虾米音乐登录模块（扫码登录） 获取用户收藏集列表 获取收藏集内歌曲 向收藏集内添加歌曲 创建收藏集 搜索歌曲 网易云音乐API 网易云音乐登录模块（密码登录） 获取用户歌单列表 创建歌单 获取歌单歌曲 向歌单添加歌曲 搜索歌曲 Osu! API 获取指定用户最近游玩的曲目 获取map详……]]></content>
        
        <summary type="html">
            
            Progress bar Tasks 虾米音乐API 虾米音乐登录模块（扫码登录） 获取用户收藏集列表 获取收藏集内歌曲 向收藏集内添加歌曲 创建收藏集 搜索歌曲 网易云音乐API 网易云音乐登录模块（密码登录） 获取用户歌单列表 创建歌单 获取歌单歌曲 向歌单添加歌曲 搜索歌
            
        </summary>
        
        <category term="Develop"/>
        
        <category term="Tech"/>
        
        <category term="node.js"/>
        
        <category term="OSU!"/>
        
        <category term="php"/>
        
    </entry>
    
    <entry>
        <title>Web 性能优化（3）——探讨 data URI 的性能</title>
        <link href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html"/>
        <id>https://blog.nfz.moe/archives/wpo-data-uri-performance.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-04-28T13:16:18+00:00</published>
        <updated>2017-04-28T13:16:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>业内常会有 Data URI 的利与弊、用与不用的讨论，即使在最有经验的前端开发者眼中，也会形成对 data URI 截然不同的看法。</p><a></a><h1><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html# 什么是 -Data-URI"></a>什么是 Data URI</h1><p>减少 Request，一直是业内公认的一项优化网站加载的方案。过去，对于众多图标类的小图片，通常都会采用雪碧图的方法合并多张小图片为一张大图片、来减少请求。现在，data URI 成为了新的选择。</p><p><a href="https://tools.ietf.org/html/rfc2397" target="_blank">RFC2397</a> 中首次定义了 data URI 的规范和格式如下：</p><pre><code>data:[&lt;mime type&gt;][;charset=&lt;charset&gt;][;base64],&lt;encoded data&gt;</code></pre><p>在这种格式中，data: 就是 URI 的协议，表明这是一个 data URI。<br /><code>mime type</code>可能是 <code>image/png</code> 之类的，如果不填，默认是 <code>text/plain</code>。</p><h1><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html# 性能神器 - 还是弃之可惜的鸡肋"></a>性能神器 还是弃之可惜的鸡肋 </h1><h2><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html# 节省请求全等于优化性能？"></a> 节省请求全等于优化性能？</h2><p>首先，如果直接在 <code>&lt;img&gt;</code> 标签的 src 中使用 base64 时，图片出现很多次时就会需要把 base64 图片的文本内容重复很多次，导致 HTML 变大。虽然多次重复的内容很适合 Gzip，但对于浏览器来说，导入 HTML 并生成 DOM 则会被阻碍。而且多次重复的 data URI 浏览器会不断的暂停渲染和进行解码，如果使用 data URI 的文件过多过大，就会阻碍页面的渲染。<br />当然，你可以说，在 <code>style.css</code> 里写好 <code>background</code> 可以应对这个问题。<br />固然，将 data URI 写进 CSS 以后，似乎是减少了请求。但是这样做的缺点就没那么容易发现了。<strong>样式表会变得很大，从而阻塞关键下载和渲染</strong>。通俗地讲，图片文件的体积被转移到了 HTML 或 CSS 中，而后者的体积直接影响渲染，导致用户会长时间注视空白屏幕。HTML 和 CSS 阻塞渲染，图片不会。</p><blockquote><p>这是用户打开网页时浏览器加载页面的过程：</p><ul><li>下载 HTML 文档。HTML 内容准备就绪后，浏览器解析字节并构建 DOM 树。</li><li>在浏览器构建我们这个简单页面的 DOM 时，在文档的 head 部分遇到了一个 link 标签，该标记引用一个外部 CSS 样式表 <code>style.css</code>。由于预见到需要利用该资源来渲染页面，它立即发出了对该资源的请求。</li><li>与处理 HTML 时一样，我们需要将收到的 CSS 转换成浏览器能够理解和处理的东西。因此浏览器会重复解析过程，不过是为解析 CSS，而不是 HTML。它需要提取并解析 CSS 文件以构建页面。</li><li>在浏览器构建页面时，如果遇到了 <img /> 标签，它意识到需要该资源来渲染页面，就会把该资源加入到请求队列。但是图片的暂时缺失不影响浏览器渲染其他部分。因此图片不会阻塞关键路径渲染。</li></ul></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000089.png" /></p><h2><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html#Gzip- 能缓解这一切？"></a>Gzip 能缓解这一切？</h2><p>Gzip 又是什么？</p><blockquote><p>Gzip 是在 Web 端最常用的一种压缩文本的方法。Gzip 压缩算法分两步。第一步，采用 LZ77 算法的一个变种替换字符串，第二步，使用 Huffman 树来储存出现的位置和长度。</p></blockquote><p>看不懂？我也看不懂。。不过我找到了下面这张图，这样就形象多了。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000090.png" /></p><p>HTML 中重复出现大量的 HTML 标签以及类名等，CSS 中重复出现大量的属性，JavaScript 中重复的函数调用等（即使经过混淆）。因此 HTML、CSS、JavaScript 的 Gzip 压缩率都是很高的。但是由于 base64 近乎于乱码的文本是无规律的，所以在 Gzip 中不达不到较高的压缩率。</p><h2><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html# 考虑考虑缓存？"></a>考虑考虑缓存？</h2><p>如果我们把样式、图片文件合并到变成一个资源，我们就无法再分别为它们配置缓存时间，以及更新资源。而图片、HTML 和 CSS 的更新频率都是不一样的。<br />然而 CSS 文件的修改频率还算是较高的，图片其次。我们一般会为不同类型的文件利用缓存头设置不同的缓存失效时间，以及在更新某个文件之后单独更新这个文件的时间戳。但是混在一起之后，即使我们只是想更新 CSS 规则里面一个字号，整个巨大的文件就会重新生成。用户不得不在每次更新后重新下载整个大文件，这违背了基本的缓存原则。</p><hr /><p>总结一下：</p><ul><li>base64 会让样式文件变得很大而阻塞关键下载和渲染</li><li>css 因 base64 增加的体积无法通过 Gzip 很好地压缩</li><li>浏览器渲染方面，增加了解析 css 的耗时</li><li>在 css 文件中过多使用 base64 会让首次渲染时间大幅增加，移动端影响可能更大</li></ul><h1><a href="https://blog.nfz.moe/archives/wpo-data-uri-performance.html#Data-URI- 的实践"></a>Data URI 的实践 </h1><p> 在 hexo-theme-material 1.4.0 版本的开发中为了优化页面加载，我们开始考虑应用 data URI。<br />由于 Material 主题 1.4.0 版本的前期开发中已经引进了一套基于 localstorage 的缓存方案，不怕强制刷新和禁用缓存，极大程度上优化了二次加载。<br />在这基础上，我将 footer sns 的 icon 独立了出来，使用 base64 加码，并独立存储在一个 css 当中。这个 css 便不需要经常更新。</p><p>Material 主题的 footer sns icon 是 svg。svg 的格式是：</p><pre><code>&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox= ...&gt;  <span><span><span>&lt;</span>path</span> <span>...</span><span>&gt;</span></span><span><span><span>&lt;/</span>path</span><span>&gt;</span></span><span><span><span>&lt;/</span>svg</span><span>&gt;</span></span><span><span></span><span></span><span></span></span></code></pre><p>不同的 svg 中，只有定义图像的 <code>&lt;path&gt;</code> 部分会有所不同，开头定义规范的部分之类的都完全相同，所以这一部分也是可以被 Gzip 压缩的，一定程度上缓解了传输文件大小的问题。</p><p>在实际测试中，直接加载外链的 svg，即使用了支持 HTTP2 的 CDN 可以连接多路复用，加载一个 svg 仍然需要 25ms，而且这一部分是最后加载的，直接影响了 DOMContentLoaded 的触发。采用该方案以后，DOMContentLoaded 提前了将近 15ms 左右触发，效果虽然不明显，但是说明这个方案毕竟是可行的。</p>]]></content>
        
        <summary type="html">
            
            业内常会有 Data URI 的利与弊、用与不用的讨论，即使在最有经验的前端开发者眼中，也会形成对 data URI 截然不同的看法。什么是 Data URI减少 Request，一直是业内公认的一项优化网站加载的方案。过去，对于众多图标类的小图片，通常都会采用雪碧图的方法合并
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="前端优化"/>
        
        <category term="Web"/>
        
        <category term="base64"/>
        
        <category term="data URI"/>
        
    </entry>
    
    <entry>
        <title>SLock项目开发记录</title>
        <link href="https://flyhigher.top/develop/408.html"/>
        <id>https://flyhigher.top/develop/408.html</id>
        
        <author>
            <name>Axton</name>
        </author>
        
        <published>2017-04-26T13:44:46+00:00</published>
        <updated>2017-04-26T13:44:46+00:00</updated>
        
        <content type="html"><![CDATA[<p>碎碎念</p>
<p>花了一些时间，做了一款可以用手机来开门的门锁，从原理到最终的开发实现绝大部分工作都是我一人完成，一部分工作得到了老师的帮助，以及在赶项目的时候得到了<a href="https://flyhigher.top/go/?url=https%3A%2F%2Fleaferx.github.io%2F" target="_blank">@Leafer</a>学长的支持与帮助，感谢。</p>
<p>其实这个想法从去年的六月份就已经提出来了，只是拖到了今年二月份才有机会实现它。这篇文章算是对这整个制作过程的一个记录，也算是一个总结吧。附上一张这个项目参加本地TEDx活动展示的照片。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/wp-1492929548156.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/wp-1492929548156.jpg" /></a></p>
<p>注意，<strong>由于这个项目要拿出去比个赛，所以 对于这篇文章的所有内容，包括但不仅限于文字、图片、思路、代码（开源库除外）我均保留所有权利，并对侵权行为追究法律责任。</strong></p>
<p>这么说来好像并没有什么人有空来侵权╮ (. ❛ ᴗ ❛.) ╭ </p>
<p>但是<strong>这篇文章主体仍遵循知识共享-4.0协议，你可以在注明这篇文章的链接并且非商用的情况下自由地转载这篇文章。</strong></p>
<p>扯远了_(:з」∠)_下面开始切入正题。</p>
<p>原理</p>
<p>这个项目最初的想法来源于我看到市面上一些指纹解锁门锁非常昂贵，动辄上千元，由此想到可以把现在都集成在门锁上的指纹识别部分移到手机上。这样，利用手机的强大能力，可以大大减少门锁成本，或许还能提高安全性以及可拓展性。</p>
<p>所以原理其实也很简单。一共三个设备构成完整流程：手机，门锁，以及一台公网上的服务器。手机与门锁均联网。</p>
<p>懒得画流程图了，我尽量说得简单点。详细技术细节看下一节吧。</p>
<p>首先在手机上选择要打开的门锁，随后输入该门锁的密码。服务器验证通过后用一些参数生成一串密钥，MD5之后扔给手机。</p>
<p>手机收到该密钥后以此为内容生成一个二维码，在屏幕上显示出来。门锁利用摄像头扫描这个二维码，获得密钥后与扔给服务器进行比对。如果和此前MD5后的密钥一致，服务器就通知门锁开门。</p>
<p>这种方案有一些优点。比如可拓展性强，后期可以拓展多种解锁方式，如密码，图案，或者最初设想的指纹，甚至面部识别或者两步验证。同时通过一些手段也可以保证安全性。重点是第一台原型的成本也只有500元左右，大大减少了成本。</p>
<p>在实现这一方案的过程中，我看到了别人做出的有一些相似的方案，是固定二维码贴在门锁旁边，手机扫码解锁。我想这样会带来与共享单车一样的问题：二维码一旦被篡改就无法解锁，甚至会带来危险。由于这一点，最后我坚持了动态生成二维码，由门锁扫描的方案。</p>
<p>实现过程</p>
<p>当然用单片机。由于要联网，还要扫描二维码，我选择了树莓派作为门锁的核心设备。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6339.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6339.jpg" /></a></p>
<p>↑超乱的灵魂走线…</p>
<p>然后在本来最纠结的锁芯方面有幸得到了老师的帮助，没有用电磁锁，而用了一个带电机的传统锁。唯一缺点就是用钥匙开锁时转动阻力实在太大，而且电机驱动稍稍慢了点。凑合着用吧。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6344.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6344.jpg" /></a></p>
<p>在手机如何与门锁通信本来也非常纠结。最初的方案其实是用声波进行通信。手机把密钥转换成声波播放，门锁进行识别。</p>
<p>最后发现这一方案有一些限制。我使用了<a href="https://flyhigher.top/go/?url=http%3A%2F%2Frest.sinaapp.com" target="_blank">http://rest.sinaapp.com</a>这一开源库，但它的文档实在有些简单了。好不容易折腾出来，却无奈发现在一些环境下效果实在不好。最终放弃，想了半天决定使用二维码。</p>
<p>关于在手机上用什么技术实现，按原本指纹识别的方案是需要APP的。然而不会写。所以转而使用已经足够强大的HTML5，美其名曰“轻量优雅”。解锁方案就先改成密码解锁和图案解锁（类安卓），反正只是个DEMO嘛。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-41-46-070_com.chimbori.hermitcrab.png"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-41-46-070_com.chimbori.hermitcrab.png" /></a></p>
<p>在安全方面，我对解锁的核心，即解锁密钥做了诸多限制。首先每一把门锁在某一刻只能有一串密钥，且每一串密钥的存活周期为一分钟，过期即失效。</p>
<p>同时我使用了账户登录制度，密钥归档于各个账户下。当账号登录时，前端网页就会以非常密集的频率重复发送简短的请求（我把它称为伪·心跳包）。一旦一个账号一段时间没有发送该请求，后端就会让该账户下的所有密钥失效。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/snipaste20170429_203659.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/snipaste20170429_203659.jpg" /></a></p>
<p>以及，我在服务器上开启了HTTPS和HSTS，同时使用了更安全的ECC证书，配置了更安全的加密算法。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-45-11-494_com.android.chrome_Mosaic_17_52_57.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-45-11-494_com.android.chrome_Mosaic_17_52_57.jpg" /></a></p>
<p>而且，服务器端会拒绝所有非浏览器请求（虽然可以模拟，但毕竟多防一点是一点嘛）。</p>
<p>我还在前段页面偷偷摸摸埋了几个<del>地雷</del>触发点。现在先收集点数据，下次有空了加上区分人机行为的功能好了（然而现在还没有2333）。</p>
<p>还有，门锁端与服务器的通信采用了与前端不同的域名（虽然是同一台服务器）以及自定义的UA，还是那句话，多防一点是一点。通过这些制度，我把我能想到的所有破解方式全部ban掉了。当然，如果你能发现什么漏洞，欢迎告诉我，感谢！</p>
<p>当然肯定不会忘了SQL注入和XSS漏洞，至少尽力了。</p>
<p>然后就没有什么大问题了。于是上手。</p>
<p>开发分成三部分。一部分是服务器上的后端和手机上的前端，一部分是门锁上的程序，还有是硬件布局。</p>
<p>先说前端和后端吧。其实有了思路也很简单了。后端用了PHP 7，开发简单而且据说性能不错。伪·心跳包和过期密钥处理上用了Python，一个死循环处理数据库而已。前端用AJAX实现前后端分离，而且保证了全部流程只刷新一次页面（登录需要刷新。虽然可以不刷新，但是懒）。本来想用这个项目练练vue的，结果发现来不及了。先写死了代码，以后再说吧。</p>
<p>前端用了一个非常棒的开源项目MDUI（<a href="https://flyhigher.top/go/?url=http%3A%2F%2Fmdui.org" target="_blank">http://mdui.org</a>)，模拟了Material Design效果，配上个Frameless的浏览器简直就<del> 像 </del>是个APP。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-37-38-255_com.chimbori.hermitcrab.png"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-37-38-255_com.chimbori.hermitcrab.png" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-19-20-29-08-825_com.chimbori.hermitcrab.png"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-19-20-29-08-825_com.chimbori.hermitcrab.png" /></a></p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-37-58-597_com.chimbori.hermitcrab.png"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/Screenshot_2017-04-15-17-37-58-597_com.chimbori.hermitcrab.png" /></a></p>
<p>对于如何在解锁完成后在手机上有所反馈的问题，直接用轮询服务器的方式暴力解决。正好有伪·心跳包，就搭了顺风车，用伪·心跳包查询是否解锁。</p>
<p>前端后端就这么不负责任地扯完了。然后是门锁上的程序。</p>
<p>更简单，一个死循环而已。读取一个超声波传感器的值，如果发现有手机在门锁前面（超声波传感器读取距离变小），就联系服务器，如果有密钥待验证，就用与超声波传感器在同一平面内的摄像头拍一张照片。如果没有读取到二维码就进入下一次循环，反之读取二维码与服务器验证。如果正确就叫电机开门，延时一会儿再锁门，然后进入下个循环。</p>
<p>特写来一发。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6343.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6343.jpg" /></a></p>
<p>其实本来是想用循环检查服务器上有没有密钥，有的话再拍照的，然后发现这对服务器来说有点累2333所以加上了超声波传感器。</p>
<p>最后来说说硬件布局。</p>
<p>一定会有人发现头图里面有一块Arduino板，然后奇怪地发现上面扯了这么多却只字未提Arduino。事实上我真的没有用到Arduino的计算能力，纯粹是因为电机要额外供电而我手头没有可以用跳线供电的线，所以机智地用Arduino把5V输入转换成了跳线接口。</p>
<p>你看只连了电源输出↓</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6346.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6346.jpg" /></a></p>
<p>还有一些跳线也看起来很奇怪，它们连到了线路板的螺丝孔里…那是为了把这些模块固定到面包板上。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6360.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6360.jpg" /></a></p>
<p>啊…我都佩服我自己的机智(*/ω＼*)。</p>
<p>剩下的结构其实也很简单了，只是线一多就乱了。主要是树莓派控制HC-SR04超声波传感器，电机以及摄像头，Arduino板给电机供电。摄像头为了保持小巧及低成本，用了排线的版本。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6361.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6361.jpg" /></a></p>
<p>然而还有坑。</p>
<p>是直流电机的问题。作为一个如假包换的直流电机，这个电机通过切换正负极来改变旋转方向。所以要用H桥。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/timg-1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/timg-1-228x300.jpg" /></a></p>
<p>（图源网络）</p>
<p>很明显，切换不同对角线上开关的闭合就能改变中间电机两端的正负极。</p>
<p>但是无论是H桥芯片还是H桥模块我都没有_(:з」∠)_</p>
<p>但是正好手头有一个双路继电器模块。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6349-1.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6349-1.jpg" /></a></p>
<p>于是拿它做了一个大号简易版H桥。原理差不多。</p>
<p><a href="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6352.jpg"><img src="https://img.flyhigher.top/wp-content/uploads/2017/04/DSC6352.jpg" /></a></p>
<p>唯一的毛病就是如果一不小心两边同时闭合就会Boom。所以改了连接和代码。首先把接地一端都接在继电器常闭端，同时在代码逻辑上总是先把两边同时切到接地端再进行其他操作。这样就尽量避免了短路问题。</p>
<p>越过了这些坑，我最后对整个布局改进了一下。其实就是加了个红色LED作为视觉反馈，顺便也方便了开发时勘误。</p>
<p>到这一步，整个项目就基本上完成了。这是树莓派端的完整Python脚本：</p>
<p></p><pre># -*- coding:utf-8 -*-
import time
import RPi.GPIO as GPIO
import urllib.request
from PIL import Image
import os, signal, subprocess

#初始化
GPIO.setmode(GPIO.BCM)
#超声波
GPIO.setup(24, GPIO.OUT)
GPIO.setup(23, GPIO.IN)
#LED
GPIO.setup(25, GPIO.OUT)
#继电器
GPIO.setup(8, GPIO.OUT)
GPIO.setup(21, GPIO.OUT)

#超声波读取距离函数
def checkdist():
    GPIO.output(25, True)
    time.sleep(0.03)
    GPIO.output(25, False)
    GPIO.output(24, GPIO.HIGH)
    time.sleep(0.000015)
    GPIO.output(24,GPIO.LOW)
    while not GPIO.input(23):
        pass
    t1 = time.time()
    while GPIO.input(23):
        pass
    t2 = time.time()
    return (t2-t1)*340/2

#开、关门函数
def downPower():
    GPIO.output(8, False)
    GPIO.output(21, False)

def openDoor():
    GPIO.output(21, True)
    time.sleep(3)
    GPIO.output(21, False)

def closeDoor():
    GPIO.output(8, True)
    time.sleep(3)
    GPIO.output(8, False)

#二维码读取函数
def lesen():
    #拍摄一幅图像
    os.system(&quot;raspistill -w 640 -h 480 -o /home/pi/cameraqrc/image.jpg -t 100 &quot;)
    print (&quot;raspistill finished&quot;)

    #处理图像以方便读取
    im = Image.open(&quot;/home/pi/cameraqrc/image.jpg&quot;).rotate(180).convert(&quot;L&quot;).save(&quot;/home/pi/cameraqrc/image-1.jpg&quot;)
    GPIO.output(25, True)
    time.sleep(0.1)
    GPIO.output(25, False)
    
    #读取二维码
    zbarcam=subprocess.Popen(&quot;zbarimg --raw /home/pi/cameraqrc/image-1.jpg&quot;, stdout=subprocess.PIPE, shell=True, preexec_fn=os.setsid)
    qrcodetext=zbarcam.stdout.readline()
        
    return qrcodetext

#主函数
def havePhone():
    urlc = &quot;https://xxx.flyhigher.top/checkkey/?lock_id=test001&quot;#才不告诉你们真实地址嘞
    content = urllib.request.urlopen(urlc).read().decode(&quot;utf-8&quot;)
    print(content)
    if content == &quot;true&quot;:
        result=lesen().strip().decode(&quot;utf-8&quot;)
        print(result)
        if result != '':
            headers = { 'User-Agent' : 'Lock/Beta1'}
            urld=&quot;https://xxx.flyhigher.top/ifkey/&quot;#才不告诉你们真实地址嘞
            pdata={'lock_id':'test001','passw':result}
            pdata=urllib.parse.urlencode(pdata)
            binary_data = pdata.encode('ascii')
            print('Checking!')
            req = urllib.request.Request(urld, binary_data, headers)
            fd = urllib.request.urlopen(req).read().decode(&quot;utf-8&quot;)
            print(fd)
            if fd == &quot;test001&quot;:
                print(&quot;开门&quot;)
                downPower()
                openDoor()
                time.sleep(7)
                print(&quot;关门&quot;)
                downPower()
                closeDoor()
            else:
                print(&quot;Wrong!&quot;)
        else:
            print('Continue!')
   #方便调试时关机
    elif content == &quot;die&quot;:
        print('Yes!')
        os.system(&quot;sudo shutdown&quot;)

#主循环
while True:
    dis = checkdist()*100
    print(dis)
    if dis &lt;= 30:
        havePhone()
    time.sleep(0.5)</pre><p></p>
<p>其他代码这么多我就不放了。你来打我呀略略略╮ (. ❛ ᴗ ❛.) ╭ </p>
<p>有空就放运行时的动图吧…</p>
<p>更新,ToDo List</p>
<ul>
<li>用Vue重构前端</li>
<li>改用更好的密钥生成算法</li>
<li>重新测试以发现可能存在的漏洞</li>
<li>加入两步验证功能</li>
<li>加入开门记录功能</li>
<li>加入习惯分析功能</li>
<li>加入短信/邮件告警功能</li>
<li>加密数据库</li>
<li>更多安全特性</li>
</ul>
<p>总结</p>
<p>感觉还是很棒的，接下来我会对它加入一些拓展，比如新的解锁方式、远程开门、优化流程、优化硬件布局以及增强安全性，拓展它的实用性。</p>
<p>以及，参加TEDx的时候有很多人建议我申请专利，估计很快就会落实（液！</p>
<p>这个项目也让我有了很多收获。第一次接触了Vue.js，但是遗憾最后没有应用；第一次尝试使用没有mysql扩展的PHP7开发后端，用熟了mysqli；自认为对硬件开发和树莓派初步入了个门；对Web安全有了更深刻的了解，未来可能会加上更高级的安全特性。当然，这个项目也得到了一些人的帮助，感谢他们！</p>
<p>然而估计很快就会开硬件方面的新坑…</p>]]></content>
        
        <summary type="html">
            
            碎碎念 花了一些时间，做了一款可以用手机来开门的门锁，从原理到最终的开发实现绝大部分工作都是我一人完成，一部分工作得到了老师的帮助，以及在赶项目的时候得到了@Leafer学长的支持与帮助，感谢。 其实这个想法从去年的六月份就已经提出来了，只是拖到了今年二月份才有机会实现它。这篇
            
        </summary>
        
        <category term="开发"/>
        
        <category term="推荐"/>
        
        <category term="SLock"/>
        
        <category term="单片机"/>
        
        <category term="服务器"/>
        
        <category term="树莓派"/>
        
    </entry>
    
    <entry>
        <title>充分运用七牛云自动备份网站/vps</title>
        <link href="https://milkice.me/2017/04/23/backup-website-to-qiniu-cloud/"/>
        <id>https://milkice.me/2017/04/23/backup-website-to-qiniu-cloud/</id>
        
        <author>
            <name>milkice</name>
        </author>
        
        <published>2017-04-23T12:12:34+00:00</published>
        <updated>2017-04-23T12:12:34+00:00</updated>
        
        <content type="html"><![CDATA[还记得好几年前还是在逛免费部落的时候才知道的多备份 当时觉得多备份很好用而且还免费 于是乎就注册了一个账户 只不过当时倒不是用来备份网站的 是用来备份mc服务器的 直到现在建了自己的Blog寻求备份途径的时候又想到了这玩意 再次登录的时候官网已经大变 Plan也从原来的免费Plan添加了收费版Plan 拉取备份的方式也由ftp/sftp登……]]></content>
        
        <summary type="html">
            
            还记得好几年前还是在逛免费部落的时候才知道的多备份 当时觉得多备份很好用而且还免费 于是乎就注册了一个账户 只不过当时倒不是用来备份网站的 是用来备份mc服务器的 直到现在建了自己的Blog寻求备份途径的时候又想到了这玩意 再次登录的时候官网已经大变 Plan也从原来的免费Pl
            
        </summary>
        
        <category term="Miscellaneous"/>
        
        <category term="Tech"/>
        
        <category term="Web"/>
        
        <category term="Backup"/>
        
        <category term="Qiniu"/>
        
        <category term="Website"/>
        
    </entry>
    
    <entry>
        <title>Hello O.</title>
        <link href="https://blog.viosey.com/2017/01/26/Hello-O/"/>
        <id>https://blog.viosey.com/2017/01/26/Hello-O/</id>
        
        <author>
            <name>Viosey</name>
        </author>
        
        <published>2017-04-22T16:26:36+00:00</published>
        <updated>2017-04-22T16:26:36+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://o.viosey.com" target="_blank">https://o.viosey.com</a></p>
<a></a>
<p>GitHub：<a href="https://github.com/viosey/O" target="_blank">https://github.com/viosey/O</a></p>
<p><code>O.</code> 是一个客制化上网首页</p>
<p>基于 Material Design &amp; Vue.js</p>
<p>集成搜索，网站，天气，TODO</p>
<p>Faster and pure</p>
<h2><a href="https://blog.viosey.com/2017/01/26/Hello-O/#功能"></a>功能</h2><blockquote>
<p>搜索：Google + Bing + 百度</p>
<p>网站：可自定义网站列表</p>
<p>天气：全国城市 + 4 天预测</p>
<p>TODO: 简单的 Todo 列表</p>
</blockquote>
<h2><a href="https://blog.viosey.com/2017/01/26/Hello-O/#关于"></a>关于</h2><p><strong>为何叫做 O？</strong></p>
<ul>
<li>O 在 leet 中即为 0，从<strong>零</strong>开始</li>
<li><strong>O</strong>rigin，起源</li>
<li>All in <strong>O</strong>ne</li>
</ul>
<p>意见反馈：</p>
<ul>
<li><a href="https://github.com/viosey/O/issues" target="_blank">https://github.com/viosey/O/issues</a></li>
<li><a href="mailto:i@viosey.com" target="_blank">i@viosey.com</a></li>
</ul>]]></content>
        
        <summary type="html">
            
            https://o.viosey.com  GitHub：https://github.com/viosey/O O. 是一个客制化上网首页 基于 Material Design &amp;amp; Vue.js 集成搜索，网站，天气，TODO Faster and pure 功能 搜
            
        </summary>
        
        <category term="创作集"/>
        
        <category term="Work"/>
        
        <category term="Homepage"/>
        
        <category term="Vue.js"/>
        
    </entry>
    
    <entry>
        <title>重新折腾MacType</title>
        <link href="https://www.isthnew.com/archives/use-mactype.html"/>
        <id>https://www.isthnew.com/archives/use-mactype.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-04-12T10:55:27+00:00</published>
        <updated>2017-04-12T10:55:27+00:00</updated>
        
        <content type="html"><![CDATA[<p>上次使用 MacType 是很久以前了，最近想换换 Windows 的字体渲染是因为我经常在 Ubuntu 和 Windows 下面切换，然而 Windows 下面显示我博客的字体发虚，为了最大的兼容性也不好使用自定义字体，所以用 MacType</p>]]></content>
        
        <summary type="html">
            
            上次使用 MacType 是很久以前了，最近想换换 Windows 的字体渲染是因为我经常在 Ubuntu 和 Windows 下面切换，然而 Windows 下面显示我博客的字体发虚，为了最大的兼容性也不好使用自定义字体，所以用 MacType
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="DirectWrite"/>
        
        <category term="MacType"/>
        
    </entry>
    
    <entry>
        <title>在双显卡笔记本安装Ubuntu时遇到的两个坑</title>
        <link href="https://www.isthnew.com/archives/install-ubuntu-on-laptop.html"/>
        <id>https://www.isthnew.com/archives/install-ubuntu-on-laptop.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-04-09T04:20:30+00:00</published>
        <updated>2017-04-09T04:20:30+00:00</updated>
        
        <content type="html"><![CDATA[<p>我的笔记本有 NVIDIA 的独显和 Intel 的集显，在刚刚引导进入U盘启动 Ubuntu 的时候会卡在 Ubuntu 的 Logo 界面，解决方法是在U盘 GRUB 引导选项的时候按E编辑启动时的参数，在 <code>linux</code></p>]]></content>
        
        <summary type="html">
            
            我的笔记本有 NVIDIA 的独显和 Intel 的集显，在刚刚引导进入U盘启动 Ubuntu 的时候会卡在 Ubuntu 的 Logo 界面，解决方法是在U盘 GRUB 引导选项的时候按E编辑启动时的参数，在 linux
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="Ubuntu"/>
        
        <category term="双显卡"/>
        
        <category term="笔记本"/>
        
    </entry>
    
    <entry>
        <title>不仅仅只是锦上添花——谈启用 HTTPS 的重要性</title>
        <link href="https://blog.nfz.moe/archives/the-importance-of-using-https.html"/>
        <id>https://blog.nfz.moe/archives/the-importance-of-using-https.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-04-08T08:41:23+00:00</published>
        <updated>2017-04-08T08:41:23+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>HTTPS 早就不是锦上添花的可有可无项，它已经逐渐成为 WEB 服务的标配。——JerryQu</p></blockquote><a></a><h1><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 是什么"></a>HTTPS 是什么</h1><p>HTTPS 是 <code>Hypertext Transfer Protocol Secure</code> 的缩写。HTTPS 利用 SSL/TLS 来加密数据包。HTTPS 开发的主要目的，是提供对网络服务器的身份认证，保护交换数据的隐私与完整性。</p><h1><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTP- 的安全性问题"></a>HTTP 的安全性问题 </h1><p> 众所周知，对 web 服务启用 HTTPS 普遍地比 HTTP 安全。HTTP 协议固然简单方便，易于部署，但是在设计之初也没有考虑安全性，所有内容都是使用明文传输，也就为现在的安全问题埋下了隐患。用户在基于 HTTP 协议的 web 应用上的传输内容都可以被中间者轻易查看和修改。</p><blockquote><p>这里所谓的中间者是指网络传输内容需要经过的网络节点，既有硬件也有软件，比如代理服务器、DNS、路由、通信基站 . . . . . . 这里面最容易拿到用户内容的就是各种通信服务运营商和二级网络带宽提供商。</p></blockquote><p>我们身边就时常发生中间人攻击，比如：</p><ul><li>使用移动数据浏览网页时运营商添加的流量球</li><li>浏览网页时底部莫名冒出来的广告</li><li>在下载文件时却得到了另外别的文件</li><li>等等等等 . . . .</li></ul><h1><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 为什么更加安全"></a>HTTPS 为什么更加安全 </h1><p> 通俗一点讲，HTTPS 有以下一些安全方面的优势。</p><ul><li>内容在传输过程中使用了对称加密，所以不会被第三方查看到。就像快递员运输的包裹都进行了封装，别人无法知道里面装了什么东西。</li><li>数据完整性。及时发现被第三方篡改的传输内容。就像快递员虽然不知道包裹里装了什么东西，但他有可能中途掉包，数据完整性就是指如果被掉包，我们能轻松发现并拒收。</li><li>身份校验。保证数据到达用户期望的目的地。就像我们邮寄包裹时，虽然是一个封装好的未掉包的包裹，但必须确定这个包裹不会送错地方。</li></ul><h1><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 的劣 -wu- 势 -qu"></a>HTTPS 的劣 (wu) 势(qu)</h1><p>在种种反对 HTTPS 的呼声中，我挑选了一些具有代表性的看法列举在这里，并加以讨论——</p><h2><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 导致性能下降？"></a>HTTPS 导致性能下降？</h2><p>HTTPS 链接和 HTTP 链接都建立在 TCP 协议之上。HTTP 链接比较单纯，使用三个握手数据包建立连接之后，就可以发送内容数据了。但是 HTTPS 链接在这三步结束以后，它还有一个 SSL/TLS 握手的环节，再加上 HTTPS 应用数据传输需要经过对称加密。所以使用 HTTPS 连接的过程的确会比 HTTP 复杂。<br />但是，随着服务器、浏览器在性能上的大幅提升，经过良好优化后 HTTPS 带来的性能损耗完全可以接受。更何况，部署 HTTPS 便可以启用 HTTP/2，大大提升 WEB 性能。所有浏览器都只支持 HTTP/2 Over TLS。也就是说，<strong>浏览器可以使用的 HTTP/2 必须基于 HTTPS 部署</strong>。</p><h2><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 并不非常可靠？"></a>HTTPS 并不非常可靠？</h2><p>是的。但是，并没有任何一种协议和加密方式是彻底安全的。HTTPS 在一定程度上，依旧可以保证用户传输数据的安全。</p><p><strong>HTTPS 的几个常见安全问题</strong>：</p><ul><li>web 服务提供商没有做自动从 HTTP 跳转到 HTTPS，所以用户可能还是会通过不安全的 HTTP 访问提供的 web 服务。</li><li>就算 web 服务提供商设置了从 HTTP 用 301 或者 302 跳转到 HTTPS，首次连接也需要使用 HTTP，中间人依然可以在第一次连接时发起攻击。</li><li>就算启用了 HSTS，让浏览器在以后访问该站点时都默认永久在浏览器本地预先用 307 做好从 HTTP 跳转到 HTTPS，并杜绝不安全的 HTTPS 链接，但第一次访问时浏览器才可能得到 HSTS 响应头，中间人甚至可以在第一次连接时入侵并劫持和替换成攻击者自己的证书（心血漏洞）。</li></ul><blockquote><p>心血漏洞的一个典型案例就是，在今日头条的官网下载手机客户端，就算已使用 HTTPS 访问，每次按下下载按钮下载下来的安装包的 MD5 检验都是不一样的（由 WJXXBSH 发现）</p><p>目前我的域名已经加入了 HSTS Preload List，内置在现代的浏览器内，通过浏览器更新分发到全球各地。这是目前唯一可以避免心血漏洞的办法。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html# 启用 -HTTPS- 很复杂？"></a>启用 HTTPS 很复杂？</h2><p>从 HTTP 切换成 HTTPS 确实会引入很多新工作，例如生成 CSR 和获取证书、SSL 配置、全站资源替换、配置 web 服务端环境，等等等等。从 HTTP 切换到 HTTPS 的过程是比较麻烦，但是一旦完成了所有工作，之后就不需要投入太多精力在这上面。<br />我切换 HTTP 到 HTTPS 花了我一晚上，我觉得是绝对值得的。</p><h2><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html#HTTPS- 成本很高？"></a>HTTPS 成本很高？</h2><p>为了让浏览器确认你的 HTTPS 安全，你的证书必须要从根证书颁发机构购买浏览器和客户端能够识别的 SSL 证书。但是对于个人来说，有很多零费用的证书方案可供选择，比如 Let’s Encrypt。而对于中大型企业来说，HTTPS 证书采购成本基本可以忽略不计。</p><blockquote><p>我的博客就采用了 Let’s Encrypt 的 SSL 证书，<del>我的个人主页则是用 TrustAsia 的 SSL 证书</del>（个人主页更换主机商，已经主动将 TrustAsia 的免费 SSL 吊销。现在旗下所有网站都在用 Let’s Encrypt）。我用的这些证书都是免费的。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/the-importance-of-using-https.html# 我的网站没有敏感内容，所以不需要 -HTTPS"></a>我的网站没有敏感内容，所以不需要 HTTPS</h2><blockquote><p>这就是 “一句” 的开发者所坚持的 “HTTPS 无用论” 观点的核心内容。</p></blockquote><p>实际上，并不是只有银行、电商等跟钱打交道的网站才需要部署 HTTPS。首先正如我之前列举和说明的，非 HTTPS 网站很容易被劫持和攻击、插入广告，严重影响用户体验。再比如，一些流量很大的热门网站，如果不部署 HTTPS 很容易被别有用心的人利用，例如 2015 年国内某著名大型网站的 JS 就被某些“自己人”主动劫持，用来 DDoS 攻击 Github。</p><blockquote><p>在 2017 年，再一次出现了百度统计的 JS 被劫持后用来攻击法轮功境内镜像网站的事件，详情可看 <a href="https://www.v2ex.com/t/384241" target="_blank">V2EX</a> 这篇帖子。<br />当然，如果你的站点根本不在乎用户体验，当然我们也无话可说。</p></blockquote><hr /><p>当然，并不是说部署了 HTTPS 就可以高枕无忧。HTTPS 解决的只是数据传输过程的安全性和保密性。用户客户端被病毒感染、服务端被入侵、使用有漏洞的证书签发商签发的 SSL 证书（如 <a href="https://blog.viosey.com/2016/11/06/Change-SSL-license-to-AlphaSSL" target="_blank"> 沃通漏洞事件 </a> 和 CNNIC 滥签事件），SSL 证书过期或者失效，都会引起 HTTPS 环境的不安全。<br />简而言之，HTTPS 页面 <strong> 不一定是 </strong> 安全环境。但是无论如何，HTTP 页面 <strong> 一定不是 </strong> 安全环境。</p><p>如今，Chrome 已经 <del>开始 </del> 主动把 HTTP 页面标记为 <strong> 不安全</strong>， Safari 也开始推进 HTTPS。现在的 HTTPS，正如 JerryQu 所说，HTTPS 已经不再是锦上添花的可有可无项，它已经逐渐成为 WEB 服务的标配。</p>]]></content>
        
        <summary type="html">
            
            HTTPS 早就不是锦上添花的可有可无项，它已经逐渐成为 WEB 服务的标配。——JerryQuHTTPS 是什么HTTPS 是 Hypertext Transfer Protocol Secure 的缩写。HTTPS 利用 SSL/TLS 来加密数据包。HTTPS 开发的主要
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="安全"/>
        
        <category term="HSTS"/>
        
        <category term="SSL"/>
        
        <category term="HTTPS"/>
        
    </entry>
    
    <entry>
        <title>在素质方面要对国人有信心</title>
        <link href="https://www.isthnew.com/archives/bike-sharing-schemes.html"/>
        <id>https://www.isthnew.com/archives/bike-sharing-schemes.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-04-06T02:23:29+00:00</published>
        <updated>2017-04-06T02:23:29+00:00</updated>
        
        <content type="html"><![CDATA[<p>共享单车火了，各种破坏共享单车的新闻也火了，其实不用网络来传播这些不文明的奇葩行为。走出家门，走到小区内，或者稍微偏僻一点的地方，总会发现几辆二维码被刮掉的小黄车，或者在草坪中央躺尸的黄橙蓝共享单车，我甚至在离双流机场不远的地方见过河中央静静被河水冲刷的摩拜。昨天在香草湖，</p>]]></content>
        
        <summary type="html">
            
            共享单车火了，各种破坏共享单车的新闻也火了，其实不用网络来传播这些不文明的奇葩行为。走出家门，走到小区内，或者稍微偏僻一点的地方，总会发现几辆二维码被刮掉的小黄车，或者在草坪中央躺尸的黄橙蓝共享单车，我甚至在离双流机场不远的地方见过河中央静静被河水冲刷的摩拜。昨天在香草湖，
            
        </summary>
        
        <category term="世界在这里"/>
        
        <category term="ofo"/>
        
        <category term="Mobike"/>
        
        <category term="摩拜"/>
        
        <category term="共享单车"/>
        
    </entry>
    
    <entry>
        <title>修复 Ubuntu 中文字体渲染</title>
        <link href="https://i-meto.com/fix-chinese-font-display/"/>
        <id>https://i-meto.com/fix-chinese-font-display/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-04-04T11:37:23+00:00</published>
        <updated>2017-04-04T11:37:23+00:00</updated>
        
        <content type="html"><![CDATA[<div><p><img src="https://wx2.sinaimg.cn/large/a15b4afegy1feav4omo73j20y30343yi" /></p>
<p>在 Ubuntu 下的默认中文字体渲染简直是渣，尤其是“复”字直接变成了一半宽度。</p>
<p><img src="https://wx2.sinaimg.cn/large/a15b4afegy1fecve5oardj20d903cmx0" /></p>
<p>对系统中的字体配置文件进行查看，最后找到了问题的所在。</p>
<p>在 Ubuntu 16.04 后，系统的中文字体交给了 Noto Sans CJK 来进行渲染，由于字体优先度配置中日文字体的优先度高于中文简体，导致部分字体如“复”，被渲染成了日文字体。</p>
<h3>修复方案</h3>
<ol>
<li>打开 <code>/etc/fonts/conf.avail/64-language-selector-prefer.conf</code> 字体优先度配置文件</li>
<li>修改配置文件，将 SC(简体中文) 的优先度调至第一，如图。保存后重启系统即可</li>
</ol>
<p><img src="https://wx2.sinaimg.cn/large/a15b4afegy1feavfu0ap9j20qm0hrabt" /></p>
</div>]]></content>
        
        <summary type="html">
            
             在 Ubuntu 下的默认中文字体渲染简直是渣，尤其是“复”字直接变成了一半宽度。  对系统中的字体配置文件进行查看，最后找到了问题的所在。 在 Ubuntu 16.04 后，系统的中文字体交给了 Noto Sans CJK 来进行渲染，由于字体优先度配置中日文字体的优先度高
            
        </summary>
        
    </entry>
    
    <entry>
        <title>两个图片处理相关的项目</title>
        <link href="https://www.isthnew.com/archives/two-project-about-image.html"/>
        <id>https://www.isthnew.com/archives/two-project-about-image.html</id>
        
        <author>
            <name>Robert Yang</name>
        </author>
        
        <published>2017-04-01T17:22:44+00:00</published>
        <updated>2017-04-01T17:22:44+00:00</updated>
        
        <content type="html"><![CDATA[<p>第一个项目是来自谷歌的 <a href="https://github.com/google/guetzli/" target="_blank">Guetzli</a> ，这个是一个新的图片压缩算法，与谷歌之前开发的 WEBP</p>]]></content>
        
        <summary type="html">
            
            第一个项目是来自谷歌的 Guetzli ，这个是一个新的图片压缩算法，与谷歌之前开发的 WEBP
            
        </summary>
        
        <category term="技术6"/>
        
        <category term="滤镜"/>
        
        <category term="图片处理"/>
        
        <category term="图片压缩"/>
        
        <category term="guetzli"/>
        
        <category term="deep-photo-styletransfer"/>
        
    </entry>
    
    <entry>
        <title>如何选择 AOKP 类 ROM 和厂商定制 UI</title>
        <link href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html"/>
        <id>https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-03-29T11:54:00+00:00</published>
        <updated>2017-03-29T11:54:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>最近老是被人问及，在厂商提供的原厂 ROM 、AOKP ，和移植的其它 ROM（比如移植的 flyme 和 MIUI），到底应该怎么选择。于是我决定写一写这篇博客，从功能层面和国内用户的行为习惯来讲讲如何选择这几类 ROM。</p><a></a><h2><a href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html# 厂商定制 -UI- 的特点"></a>厂商定制 UI 的特点 </h2><p> 厂商在 Android 的基础上修改了很多功能，还有很多界面上的修改，增加了很多功能。比如 MIUI 增加了手机分身、伪基站识别等功能；nubiaUI 增加了应用分身、边缘触控 FiT、Neovision 相机、录屏和长截屏等功能；乐视的 EUI 甚至可以把视频讯息聚合和桌面结合在一起，而一加的氢氧 OS 是国内难得的还用了点 Material Design 的定制 OS（而且现在国内厂商的 UI，普遍都有什么屏幕分屏、长截屏之类的功能）。这些都是作为手机厂商的卖点。毕竟手机是拿来用的，光靠堆高通骁龙 820 还有 6G 运存什么的，真不一定能把手机卖出去（在国内，买 nexus 或者 pixel 的多半为了体验全套谷歌服务的信仰）。<br />但是说实在的，其中有的功能的确算得上实际。比如在国内，流量不像国外价格那么便宜；比如在国内的骚扰广告电话和骚扰短信要比国外多很多；云云。所以国内定制 UI 一定会加一套完整的手机管家，具备完整的流量计算和自动断网功能（而且为了应对国内的现状增加了结转和闲时功能）；骚扰拦截功能，黑名单功能和关键字拦截；针对国内应用的毒瘤现状，纷纷增加了禁止自启、禁止唤醒、自动休眠的功能；云云。</p><h2><a href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html#AOKP- 的特点"></a>AOKP 的特点 </h2><h3><a href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html#CyanogenMod"></a>CyanogenMod</h3><p> 现在回来说说 CM 。CM 是基于 AOSP 开发的、开源的定制 Android 项目；CM 开始保留 Android 原生系统的界面风格，做了一些定制，比如内置了 root 、增加了一些有用的功能（比如说 CM 在今年四月份加入了天气功能，并提供了天气接口）。但是这些简单的修改是有限的，CM 基本保留了原生系统完整的风格，没有像国内厂商一样提供这么多功能，什么视频聚合、什么伪基站识别，什么手机管家。CM 并没有像国内的厂商一样做太多定制。</p><h3><a href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html#Mokee-Open-Source-Project"></a>Mokee Open Source Project</h3><p>当然谈到 AOKP，就不能避开魔趣，这个全世界排名第二的 AOKP 项目。有的人认为魔趣就是抄袭 CM，关于这一点我不想发表太多意见。所有基于 AOSP 开发的 ROM 都长这个样，不能因此就能说明魔趣抄袭 CM ；AICP 、Sudamod 、Slim 、Blisspop 等等一干 AOKP 项目都长这个样。魔趣可以说用了 CM 项目的部分代码，这是无可厚非的，因为 CM 是一项伟大的开源项目，很多东西是绕不开 CM 的；CM 有很多东西值得借鉴，但并不意味着魔趣就是彻头彻尾基于 CM 、进行抄袭；魔趣在不违反开源协定的前提下合并 CM 的源码无可厚非。<br />魔趣相比 CM 和其它一些 AOKP ，增加了更多基于中国本土化的修改，比如 chormium 内核的羽·浏览器；可以用来有效对付国内毒瘤的宙斯盾系统（这东西是要写进 framework 和 service.jar 里头的）；ViPER4Android 蝰蛇音效；更完整的汉化（虽然你可能感觉不到）；来去电归属地显示和基本的骚扰拦截功能；服务类短信归档；网速显示；短信验证码智能识别和复制；T9 拼音拨号；等等很多本土化的东西。</p><hr /><p>所以说，CM 的 ROM 没有那么臃肿；CM 的确会比官方 ROM 要流畅一些；CM 采用原生的 Material Design 风格；但是厂商定制的 ROM 的确会有更多的功能，有的功能你甚至还离不开。</p><h2><a href="https://blog.nfz.moe/archives/how-to-choose-customlized-rom-and-stock-ui.html#So…"></a>So…</h2><p>如果你对国内厂商拿来吹嘘和用来营销的一些作为卖点的功能特别感兴趣甚至离不开，那么请千万不要选择 CM 或者魔趣。所以如果你追求这些功能，你最好还是回去去用原厂 UI，而不是奢求有人愿意把某些功能移植会 CM 或者魔趣上面去、对 CM 或者魔趣的设备维护者说什么“有人曾经在 xxx 的 ROM 上成功过”、什么“CM/MK 加上什么功能就完美了”。<br />如果你对这些功能不感兴趣、或者说相比这些功能你更追求的是简洁和流畅，那么 CM 就是你的最佳选择；如果你希望本土化一些，可以选择魔趣。<br />如果你只是对现在的 UI 感到厌烦，或者对其它 UI 的界面碰巧感兴趣或者某项功能感兴趣，你可以选择去用 MIUI 或者 flyme，因为这类 ROM 和原厂的 UI 界面相似（国内定制 UI 和国内毒瘤 App 都有一个共性，就是尽量跪舔 iOS 界面），一样针对国人的使用习惯和国内现状做了特别定制。但是是否能够作为日常使用的 ROM ，取决于这个 ROM 的稳定性和各项功能的完备性。</p><blockquote><p>本文仅供参考，实际如何选择，还需要自己亲自体验一番才知道。毕竟你才是用户；毕竟安卓就是拿来折腾的。</p></blockquote><hr /><p>2017.03.29 更新</p><p>关于不同基于 AOSP 的 Android 开源的 ROM 项目的横向比较，可以参考 <a href="https://ivanilla.org/ITTech/Android/11/" target="_blank"> 这篇文章</a>。</p>]]></content>
        
        <summary type="html">
            
            最近老是被人问及，在厂商提供的原厂 ROM 、AOKP ，和移植的其它 ROM（比如移植的 flyme 和 MIUI），到底应该怎么选择。于是我决定写一写这篇博客，从功能层面和国内用户的行为习惯来讲讲如何选择这几类 ROM。厂商定制 UI 的特点  厂商在 Android 的基
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="CM"/>
        
        <category term="ROM"/>
        
        <category term="Android"/>
        
    </entry>
    
    <entry>
        <title>装了一台游戏 PC</title>
        <link href="https://ikk.me/archives/Diary/new_game_pc.html"/>
        <id>https://ikk.me/archives/Diary/new_game_pc.html</id>
        
        <author>
            <name>kookxiang</name>
        </author>
        
        <published>2017-03-27T16:29:00+00:00</published>
        <updated>2017-03-27T16:29:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>来深圳已经有4个多月了，平时手边只有一台公司发的 Macbook Pro，<del>根本不能愉快的游戏</del></p>

<p>加上之前用树莓派来做 NAS，百兆的网口和 USB 2.0 的速度根本不能满足需求…</p>

<p>所以一开始准备组一个 NAS，本来准备组个 J1900 啥的，结果因为偶尔还想撸撸 World of Warshits，所以干脆还是加钱上了 i3<del>（i3 默秒全）</del></p>

<p>配置方面的话，用的最辣鸡的 <a href="https://ark.intel.com/products/97455/Intel-Core-i3-7100-Processor-3M-Cache-3_90-GHz" target="_blank">7 代酷睿 i3 7100</a>，默频高达 3.9G，简直就是 excited 啊！<br />
主板方面自然是选得 B250 芯片组，因为个人对技嘉比较有好感，最后选的是 <a href="http://www.gigabyte.cn/Motherboard/GA-B250M-D3H-rev-10" target="_blank">B250M-D3H</a> 这款。一方面由于准备上 Micro-ATX 的机箱，所以只能挑小板；加上之前买的傻多戴 <a href="https://item.jd.com/2316993.html" target="_blank">U2417H</a>，最后发现这显示器只有 HDMI 和 DP（含 MiniDP） 两种接口，所以主板方面选了款带 DP / HDMI 输出的先用着。<br />
内存方面在二手东上随便选了个 8G * 2 的套装（结果一直蓝屏，最后发现有一根抽了，联系京东上门换货，不得不说下二手东这个服务…简直了）<br />
机箱的话选了一款铝制的 <a href="http://www.jonsbo.com/products_24_4.html" target="_blank">乔思伯 C3</a>，还有喜闻乐见的大侧透（毕竟主板说他带了灯，感觉不上测透也浪费嘛），这款机箱虽然是 ITX / Micro-ATX 的，却可以使用标准 ATX 电源，这样方便了不少。<br />
电源考虑到加显卡以及带多硬盘的需要，选了安钛克的 <a href="http://www.antec.com/product.php?id=707077&amp;fid=5022038&amp;lan=nz" target="_blank">Neo ECO 550</a>，毕竟之前也在用，接口够用，关键是不会爆炸。<br />
另外因为主板有 M.2 接口，直接就上了块 256G 的爆炸星 <a href="http://www.samsung.com/semiconductor/products/flash-storage/client-ssd/MZVLW256HEHP" target="_blank">PM961</a>，插到主板上就行，不需要占机箱空间，毕竟现在装机 SSD 还是标配嘛。<br />
最后把树莓派挂的那块 3T 的硬盘接了上去。</p>

<p>用了几个星期之后，偶尔打了把战舰世界，发现即使是低画质帧率也没法看。<br />
唉，没办法，谁叫我们是辣鸡集显呢，于是权衡了下老黄的 1060 和偷电大师 RX 480，最后还是支持了农企，毕竟手头上想玩的游戏比如大光头一直是 N 卡负优化。</p>

<p>最后整机下来大致花了 4500 左右，各类游戏基本最高画质都没啥压力。<br />
目前只发现 GTA 5 好像会掉帧… 谁叫咱是假 4 核呢，把画质调到高来玩咯，CPU 感觉还是不太需要升级……毕竟大部分时间不需要他满负荷。</p>

<p>最后来听一首有毒的歌吧~<br />
 &lt; 访问完整版以查看此播放器 &gt; </p>]]></content>
        
        <summary type="html">
            
            来深圳已经有4个多月了，平时手边只有一台公司发的 Macbook Pro，根本不能愉快的游戏  加上之前用树莓派来做 NAS，百兆的网口和 USB 2.0 的速度根本不能满足需求…  所以一开始准备组一个 NAS，本来准备组个 J1900 啥的，结果因为偶尔还想撸撸 World
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Solomon 现已支持 AMP</title>
        <link href="https://blog.poi.cat/solomon-now-supports-amp"/>
        <id>https://blog.poi.cat/solomon-now-supports-amp</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-03-26T11:54:06+00:00</published>
        <updated>2017-03-26T11:54:06+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>Solomon 现已支持 AMP. 你可以访问<a href="https://blog.poi.cat/amp/solomon-now-supports-amp.html">本篇文章的 AMP 版本</a>体验 :)</p></blockquote><h2>AMP 是什么?</h2><p><strong>AMP (Accelerated Mobile Pages)</strong> 是 Google 推出的一门能加快移动端页面呈现速度的技术.</p><p>经测试, 能提高 <strong>15% ~ 85%</strong> 的页面加载性能: <a href="https://www.ampproject.org/how-it-works/">Accelerated Mobile Pages – A new approach to web performance</a></p><p>此外, 大家还看一下 AMP 官方的介绍视频:</p><p><a href="https://www.youtube.com/watch?v=lBTCB7yLs8Y&amp;t=131s">Intro to AMP (Accelerated Mobile Pages)</a></p><blockquote><p>里面小哥的演技好逼真 :)</p></blockquote><h2>AMP 结构简述</h2><p>AMP 主要由 <strong>AMP HTML</strong>, <strong>AMP Runtime</strong> 和 <strong>AMP Component</strong> 组成:</p><p><strong>AMP HTML</strong> 是 HTML 的一个 <strong>子集</strong>.</p><p>一个规范的 AMP HTML 有以下的几个 <strong>必要条件</strong>:</p><ol><li><p>以 <code>&lt;!doctype html&gt;</code> 开头</p></li><li><p>顶层标签为 <code>&lt;html ⚡&gt;</code> 或 <code>&lt;html amp&gt;</code></p></li><li><p>必须包括 <code>&lt;head&gt;</code> 和 <code>&lt;body&gt;</code> 标签, 他们在 HTML 中是可选的</p></li><li><p><code>&lt;meta charset=&quot;utf-8&quot;&gt;</code> 放在 <code>&lt;head&gt;</code> 的开头</p></li><li><p><code>&lt;script async src=&quot;https://cdn.ampproject.org/v0.js&quot;&gt;&lt;/script&gt;</code> 做为第二个元素</p></li><li><p><code>&lt;link rel=&quot;canonical&quot; href=&quot;$SOME_URL&quot; /&gt;</code> 这个 metadata 指向和这个页面相同内容的非 AMP 版本的页面</p></li><li><p><code>&lt;head&gt;</code> 中必须包含 <code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,minimum-scale=1&quot;&gt;</code></p></li><li><p><code>&lt;head&gt;</code> 中必须包含 <code>&lt;style amp-boilerplate&gt;body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style&gt;&lt;noscript&gt;&lt;style amp-boilerplate&gt;body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style&gt;&lt;/noscript&gt;</code></p></li></ol><p>除了以上的要求之外, AMP HTML 还有其他的限制:</p><p>多数的 HTML 标签在 AMP HTML 中都可以使用, 除了少数的标签, 例如 <code>&lt;img&gt;</code>, <code>&lt;video&gt;</code>, <code>&lt;audio&gt;</code> 等则必须以 <code>&lt;amp-img&gt;</code>,<code>&lt;amp-anim&gt;</code>,<code>&lt;amp-video&gt;</code>,<code>&lt;amp-audio&gt;</code> 替代, 而且他们都是需要闭合的.</p><blockquote><p>关于为什么不能使用上述标签, 可以参阅 AMP 官方文档:</p><p><a href="https://www.ampproject.org/docs/guides/author-develop/amp_replacements">Include Images &amp; Video – Accelerated Mobile Pages Project</a></p></blockquote><p>AMP HTML 不能引用 <strong>除 AMP Runtime 和 AMP Components 之外的 JS 库</strong>.</p><p>AMP HTML 不能引用 CSS 文件, 只能使用内联样式, 内联样式必须写成 <code>&lt;style amp-custom&gt;</code> 而不是 <code>&lt;style&gt;</code>, 而且在一个页面中 <strong>只能出现一次</strong> 内联样式.</p><blockquote><p>AMP HTML 的规范很多, 记不住没关系, 可以通过在 URL 最后加 <code>#development=1</code>, 进入开发模式, 控制台里输出不符合 AMP HTML 的地方; 或者使用 <a href="https://validator.ampproject.org">The AMP Validator</a></p></blockquote><p>上面提到的 AMP HTML 的必要条件的第 5 条中, 引用的 https://cdn.ampproject.org/v0.js 就是 <strong>AMP Runtime</strong>, 负责协调资源的加载.</p><p><strong>AMP Component</strong> 其实是 <strong>自定义元素(Custom Elements)</strong>;</p><p>除了上述的 <code>&lt;amp-img&gt;</code>, <code>&lt;amp-audio&gt;</code> 之外, AMP Project 还提供了其他的 Components, 例如: <code>&lt;amp-analytics&gt;</code>, <code>&lt;amp-app-banner&gt;</code>, <code>&lt;amp-experiment&gt;</code></p><p>你可以在 https://ampbyexample.com/#components 找到他们.</p><p>简单来说, AMP 其实并不算是什么 &quot;黑科技&quot;. 它能提高移动端页面的加载速度的主要原因, 是给页面增加了许多的限制: 不能使用其他的 JS 库, 必须使用内联样式, 所有的资源使用 AMP Runtime 加载等等. 当然, 结果也是非常可观的: 能过提高 <strong>15% ~ 85%</strong> 的性能.</p><blockquote><p>AMP HTML 通过限制 HTML 的能力, 获得了提高页面加载速度的能力;</p><p>和 PyPy 里的 rPython 通过限制 Python 动态语言的能力, 使得 rPython 可以进行静态的推导的能力, 颇有异曲同工之妙.</p></blockquote><h2>Why Pelican?</h2><p>上面提到了, AMP 不允许使用除了 AMP Runtime 和 AMP Components 的 JS 库, 所以 Angular, React 等前端框架就 <strong>用不上了</strong>. 所以要实现 Solomon AMP, 就必须用 <strong>静态博客生成器</strong>.</p><p>静态博客生成器有很多的选择, 例如: <a href="https://gohugo.io/">Hugo</a>, <a href="https://hexo.io">Hexo</a>, <a href="https://blog.getpelican.com/">Pelican</a>, <a href="https://jekyllrb.com/">Jekyll</a> 等.</p><p>我选择的是 <strong>Pelican</strong>. 理由很简单, AMP HTML 相比普通的 HTML 有大的区别, 这意味着我必须修改生成器的代码或者写一个插件, 使其可以渲染出合法的 AMP HTML.</p><p>而 Hugo 是用 <strong>Golang</strong> 写的, Jekyll 是用 <strong>Ruby</strong> 写的, 我都没有学习过, 因而放弃了他们.</p><p>至于用 JavaScript 写的 Hexo, 确实曾是我的最爱, 但我也仅限于写过它的主题而已, 没有写过 Hexo 的插件; 而我经常听见有人抱怨 Hexo 的 API 经常改, 写的插件很容易不兼容, 所以我也就放弃了.</p><h2>自定义 Reader 插件</h2><p>决定了使用 <strong>Pelican</strong> 之后, 第一步当然是添加一个新的 <strong>Reader 插件</strong>:</p><ol><li><p>新建一个名为 <code>AMPMarkdownReader</code> 的类,</p></li><li><p>然后添加 Markdown 的后缀名: <code>['md', 'markdown', 'mkd', 'mdown']</code>,</p></li><li><p>最后注册该 Reader 即可.</p></li></ol><p>Pelican 里的 Reader 是 <strong>一个黑箱</strong>, 输入的是 <strong>文件路径</strong>, 要求输出的是 Metadata(元数据) 和渲染好的 HTML. 所以我们需要的是读取文件之后, 采用我们自己的 Markdown 和 Metadata 渲染器.</p><blockquote><p>Pelican 默认的 Metadata 的格式是 <a href="https://pythonhosted.org/Markdown/extensions/">Markdown Extension</a>.</p><p>但是为了兼容我以前写的文章的 Metadata 格式(JSON 代码块), 所以我读取 Metadata 的方式是直接解析了 JSON 代码块.</p></blockquote><p>Pelican 默认的 Markdown 渲染器不支持自定义函数, 所以我换成了 <a href="https://github.com/lepture/mistune">Mistune</a>, 并且重写了 <code>image</code>, 把所有的 <code>&lt;img&gt;</code> 标签换成了 <code>&lt;amp-img&gt;&lt;/amp-img&gt;</code>.</p><p>写好了自己的 Reader 之后, 记得还要去 <code>pelicanconf.py</code> 里, 设置插件的路径和需要引入的插件: <code>amp_markdown_reader</code>, 这样插件才能生效.</p><p>自定义的 Markdown Reader 写好了之后, 下一步就是一个主题了. AMP 的页面是专注于移动端加速的, 不需要也不适合太复杂页面逻辑, 所以我就自己写了一个主题: <code>solomon-amp</code>.</p><p>写 AMP 主题的时候和写普通主题差不多, 只不过写完之后记得用 <a href="https://validator.ampproject.org">The AMP Validator</a> 或者在 URL 后面加 <code>#development=1</code> (前提是你引入了 AMP Runtime) 的方法来确认你的 AMP HTML 是否合法.</p><p>不过我这里要特别提到的就是页面中的 <code>&lt;script type=&quot;application/ld+json&quot;&gt;</code> 即 <strong>Structured Data</strong> 的设置: Structured Data 虽然不是 AMP HTML 中的规范, 但是对于 AMP 的页面来说, Structured Data 是相当重要的, 因为它可以提供给搜索引擎更多的信息, 使我们的页面在搜索引擎上可以显示 <strong>更多的信息</strong>.</p><h2>Structured Data</h2><p>Structured Data 有两个形式: 基于 JSON 的 <strong>JSON-LD</strong> 和基于 HTML Meta 标签的 <strong>Microdata</strong>. 我推荐的是 <strong>JSON-LD</strong>, 因为它的可读性相比后者更好, 而且占的字节也小.</p><p>使用 Structured Data 当然也有 Structured Data 的标准,首先先从 <a href="https://developers.google.com/search/docs/data-types/data-type-selector">Introduction to Structured Data Types | Search | Google Developers</a> 里选择你的网页的类型相应的 Structured Data: 目前有 <strong>Articles</strong>(文章), <strong>Music</strong>(音乐), <strong>Recipes</strong>(食谱), Reviews(评论), <strong>TV &amp; Movies</strong>(电视剧 &amp; 电影), and <strong>Videos</strong>(视频) 几种.</p><p>以 Articles 的 Structured Data 为例: 在 <a href="https://developers.google.com/search/docs/data-types/articles#type_definitions">Articles | Search | Google Developers</a> 里点击 <strong>See Mark Up</strong> 之后, 就可以在新页面里面看到 Google 给的一个 json-ld 例子:</p><p>我们把它复制到我们的主题里面就行了, 当然这只是一个例子, 我们还需要根据具体的需求修改我们的 <strong>json-ld</strong>. 当然修改的时候根据 <a href="https://developers.google.com/search/docs/data-types/articles#type_definitions">Articles | Search | Google Developers</a> 里的规定修改, 否则也是会视为无效的. 改完了之后我们可以通过 <a href="https://search.google.com/structured-data/testing-tool">Structured Data Testing Tool</a> 来查看我们的 json-ld 是否合法.</p><h2>后语</h2><p>最后, Solomon AMP 实现以 MIT 协议开源在 <a href="https://github.com/PoiScript/Solomon-AMP">PoiScript/Solomon-AMP</a> 上. 有什么意见或建议的话, 欢迎提 Issue 或者推 Pull Request. :)</p>]]></content>
        
        <summary type="html">
            
            Solomon 现已支持 AMP. 你可以访问本篇文章的 AMP 版本体验 :)AMP 是什么?AMP (Accelerated Mobile Pages) 是 Google 推出的一门能加快移动端页面呈现速度的技术.经测试, 能提高 15% ~ 85% 的页面加载性能: Ac
            
        </summary>
        
        <category term="amp"/>
        
        <category term="blog"/>
        
    </entry>
    
    <entry>
        <title>为 Hexo 博客添加评论系统</title>
        <link href="https://blog.nfz.moe/archives/add-comment-system-to-hexo.html"/>
        <id>https://blog.nfz.moe/archives/add-comment-system-to-hexo.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-03-23T13:49:10+00:00</published>
        <updated>2017-03-23T13:49:10+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p> 由于 Hexo 本身已经弃用了 swig 支持，所以本文教程是根据 ejs 语言来写的。如果使用了如 NexT 等基于 swig 的 Hexo 主题，请自行切换。</p></blockquote><p>Hexo 是一款静态博客，所以不像 WordPress 或者 Typecho 这类动态博客一样支持原生评论系统，所以一般需要引入第三方评论系统。国内常见的评论系统有多说、友言、畅言等，国外的有 Disqus 和 Moss。</p><blockquote><p>在写作本文的时候，多说已经宣布即将暂停服务，很多使用多说的人都在寻找解决方案；加上网络上找到的解决方案大多都不具备通用性，而且也不具备太多指导意义，这也是为什么我写作本文的原因。</p><p><strong>强烈建议：</strong>在阅读本文并根据本文进行操作前，请仔细阅读 Hexo 的 API 和主题开发的有关文档！</p></blockquote><h1><a href="https://blog.nfz.moe/archives/add-comment-system-to-hexo.html# 修改主题配置文件"></a>修改主题配置文件 </h1><p> 在主题文件夹下的 <code>_config.yml</code> （以下简称主题配置文件）合适位置中加入以下内容：</p><pre><code><span>comment</span><span>:</span>     <span>use</span><span>:</span> <span>true</span>    <span>shortname</span><span>:</span> <span>{</span>YOUR_SHORTNAME<span>}</span>    <span>thread_key</span><span>:</span> <span>{</span>IDENTIFIER<span>}</span><span><span></span><span></span><span></span><span></span></span></code></pre><p>注意，这些评论系统的配置内容仅供参考。有的评论系统可能需要配置更多信息或者不需要配置某些信息（如友言需要配置 conf、appid 而不是 shortname），请自行根据需求进行修改。</p><blockquote><p>如果你的修改只是给你一个人使用，这一步可以忽略。但是如果你想把你的成果分享出去或提交给上游，建议通过主题配置文件的方法配置这些属性，这样可以方便更多人使用。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/add-comment-system-to-hexo.html# 添加评论 -ejs"></a>添加评论 ejs</h1><p>在主题内的合适位置新建一个 ejs 文件，命名如 <code>comment.ejs</code>，填入评论框的公共代码（即包括引用有关 js 文件等的代码）加上评论框的代码。</p><blockquote><p>对于评论系统的公共代码，你也可以插入在其它位置。以 Material 主题为例，typecho-theme-material 的评论公共代码在侧边栏，hexo-theme-material 的评论公共代码在 footer。</p></blockquote><p>然后，替换提供的代码中的有关变量。常见的变量有 shortname、page_identifier 等。这些变量可以通过 Hexo 的 API 进行调用。比如你可以使用 <code>&lt;%= theme.comment.shortname %&gt;</code> 这样的 API  即可调用你在主题配置文件中的 <code>comment.hortname</code> 属性中赋的值。</p><blockquote><p>当然，正如我在上一步所说，如果你的修改只是供你一个人使用，你可以直接将你的变量值替换到这段代码中，而不需要额外通过主题配置文件进行调用。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/add-comment-system-to-hexo.html# 在文章页面添加评论"></a>在文章页面添加评论 </h1><p> 在类似于 <code>post.ejs</code> 的文件中，在文章结尾处插入<code>&lt;%- partial('/THE_PATH_TO/comment') %&gt;</code> 来调用 <code>/YOUR PATH/comment.ejs</code> 文件。这样在 Hexo 生成静态页面时就会把评论部分插入进去。</p><h1><a href="https://blog.nfz.moe/archives/add-comment-system-to-hexo.html# 实践"></a>实践 </h1><p> 以上内容是 Hexo 主题加入评论系统的方法。现在介绍一下 <a href="https://material.viosey.com" target="_blank">Material</a> 主题的评论系统是如何添加的。</p><p>Material 主题涉及到评论系统的组件有：</p><ul><li>post.ejs（文章页面，引用评论系统）</li><li>layout/_partial/comment.ejs（评论框）</li><li>layout/_partial/footer-option.ejs（评论系统公共代码）</li><li>layout/_widget/disqus.ejs（Disqus 评论框组件）</li><li>layout/_widget/duoshuo.ejs（多说评论框组件）</li></ul><p>首先，我们在主题配置文件中，写入以下内容：</p><pre><code><span># Comment Systems</span><span># Available value of &quot;use&quot;:</span><span>#     duoshuo | disqus</span><span>comment</span><span>:</span>    <span>use</span><span>:</span>    <span>shortname</span><span>:</span>    <span>duoshuo_thread_key_type</span><span>:</span> path    <span>duoshuo_embed_js_url</span><span>:</span> <span>&quot;https://static.duoshuo.com/embed.js&quot;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这些用来定义评论系统在主题配置文件中的变量。</p></blockquote><p>然后，在 <code>footer-options.ejs</code> 加入下述代码：</p><pre><code>&lt;% if(theme.comment.use === 'duoshuo') { %&gt;    <span>&lt;!-- 多说公共 js 代码 start --&gt;</span>    <span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>&quot;</span>text/javascript<span>&quot;</span></span><span>&gt;</span></span>        queue.offer(function(){            var duoshuoQuery = {short_name: '&lt;%= theme.comment.shortname %&gt;'};            (function() {var ds = document.createElement('script');                ds.type = 'text/javascript';                ds.async = true;                ds.src = '&lt;%= theme.comment.duoshuo_embed_js_url %&gt;';                ds.charset = 'UTF-8';                (document.getElementsByTagName('head')[0]                 || document.getElementsByTagName('body')[0]).appendChild(ds);            })();});    <span><span><span>&lt;/</span>script</span><span>&gt;</span></span>    <span>&lt;!-- 多说公共 js 代码 end --&gt;</span><span><span><span>&lt;</span>%</span> <span>}</span> <span>%</span><span>&gt;</span></span>&lt;% if(theme.comment.use === 'disqus') { %&gt;    <span>&lt;!-- 使用 DISQUS js 代码 --&gt;</span>    <span><span><span>&lt;</span>script</span> <span>id</span><span><span>=</span><span>&quot;</span>dsq-count-scr<span>&quot;</span></span> <span>src</span><span><span>=</span><span>&quot;</span>//&lt;%<span>=</span> theme.comment.shortname %<span>&gt;</span>.disqus.com/count.js<span>&quot;</span></span> <span>async</span><span>&gt;</span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span><span>&lt;</span>%</span> <span>}</span> <span>%</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这一段包括了一个判断，那就是通过判断用户在主题配置文件里配置的值来判断用户选择的评论系统，并选择加载哪一段代码。</p></blockquote><p>接下来是创建 <a href="https://github.com/viosey/hexo-theme-material/blob/master/layout/_widget/disqus.ejs" target="_blank"><code>duoshuo.ejs</code></a> 和 <a href="https://github.com/viosey/hexo-theme-material/blob/master/layout/_widget/duoshuo.ejs" target="_blank"><code>disqus.ejs</code></a>。这个是评论框的组件。里面的一些变量换成了由 Hexo 的主题配置文件里的变量。</p><blockquote><p>下面这个是 <code>duoshuo.ejs</code> 的内容。</p></blockquote><pre><code>&lt;%- css('css/duoshuo.min') %&gt;<span><span><span>&lt;</span>style</span><span>&gt;</span></span><span>    <span><span>#ds-thread</span> <span>#ds-reset</span> <span>.ds-post-button</span></span><span>{</span><span>background-color</span><span>:</span> &lt;<span>%</span>= theme<span>.</span>uiux<span>.</span>theme_color <span>%</span>&gt; <span>!important</span><span>;</span><span>}</span>    <span><span>#ds-wrapper</span> <span>#ds-reset</span> <span>.ds-icons-32</span></span><span>{</span><span>background-color</span><span>:</span> &lt;<span>%</span>= theme<span>.</span>uiux<span>.</span>theme_color <span>%</span>&gt; <span>!important</span><span>;</span><span>}</span>    <span><span>#ds-reset</span> <span>.ds-highlight</span> </span><span>{</span><span>color</span><span>:</span> &lt;<span>%</span>= theme<span>.</span>uiux<span>.</span>theme_color <span>%</span>&gt; <span>!important</span><span>;</span><span>}</span></span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span><span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>comments<span>&quot;</span></span><span>&gt;</span></span>    <span>&lt;!-- 多说评论框 start --&gt;</span>    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&quot;</span>ds-thread<span>&quot;</span></span>        <span>data-thread-key</span><span><span>=</span><span>&quot;</span>&lt;%<span>=</span> theme.comment.duoshuo_thread_key_type <span>=</span><span>=</span><span>=</span> <span>'</span>id<span>'</span> ? page.id : page.path %<span>&gt;</span><span>&quot;</span></span>        <span>data-url</span><span><span>=</span><span>&quot;</span>&lt;%- config.url + config.root + page.path %<span>&gt;</span><span>&quot;</span></span>        <span>data-title</span><span><span>=</span><span>&quot;</span>&lt;%<span>=</span> page.title %<span>&gt;</span><span>&quot;</span></span><span>&gt;</span></span>    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>    <span>&lt;!-- 多说评论框 end --&gt;</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>下面这个是 <code>disqus.ejs</code> 的内容。</p></blockquote><pre><code><span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>disqus_thread<span>&quot;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span><span><span>&lt;</span>script</span><span>&gt;</span></span>    queue.offer(function() {var disqus_config = function () {this.page.url = '<span><span><span>&lt;</span>%-</span> <span>config.url</span> <span>+</span> <span>url_for(path)</span> <span>%</span><span>&gt;</span></span>';  // Replace PAGE_URL with your page's canonical URL variable                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable            };            (function() { // DON'T EDIT BELOW THIS LINE                var d = document;                var s = d.createElement('script');                s.src = '//&lt;%= theme.comment.shortname %&gt;.disqus.com/embed.js';                s.setAttribute('data-timestamp', + new Date());                (d.head || d.body).appendChild(s);            })();});<span><span><span>&lt;/</span>script</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>本文给了这两个文件在 Github 的链接。大家可以直接参考。</p></blockquote><p>然后我们创建了 <code>comment.ejs</code>，根据用户的配置，判断加载哪一个评论框。</p><pre><code>&lt;% if(theme.comment.use === 'duoshuo') { %&gt;    <span>&lt;!-- 使用多说评论 --&gt;</span>    &lt;%- partial('_widget/duoshuo') %&gt;<span><span><span>&lt;</span>%</span> <span>}</span> <span>%</span><span>&gt;</span></span>&lt;% if(theme.comment.use === 'disqus') { %&gt;    <span>&lt;!-- 使用 DISQUS --&gt;</span>    <span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>disqus-comment<span>&quot;</span></span><span>&gt;</span></span>        &lt;%- partial('_widget/disqus') %&gt;    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>    <span><span><span>&lt;</span>style</span><span>&gt;</span></span><span>        <span><span>#disqus-comment</span></span><span>{</span>            <span>background-color</span><span>:</span> <span>#eee</span><span>;</span>            <span>padding</span><span>:</span> <span>2</span>pc<span>;</span>        <span>}</span>    </span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span><span><span><span>&lt;</span>%</span> <span>}</span> <span>%</span><span>&gt;</span></span>&lt;% if(theme.comment.use === 'disqus_click') { %&gt;    <span>&lt;!-- 使用 DISQUS_CLICK --&gt;</span>    <span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&quot;</span>disqus-comment<span>&quot;</span></span><span>&gt;</span></span>            &lt;%- partial('_widget/disqus_click') %&gt;    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>    <span><span><span>&lt;</span>style</span><span>&gt;</span></span><span>        <span><span>#disqus-comment</span></span><span>{</span>            <span>background-color</span><span>:</span> <span>#eee</span><span>;</span>            <span>padding</span><span>:</span> <span>2</span>pc<span>;</span>        <span>}</span>    </span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span><span><span><span>&lt;</span>%</span> <span>}</span> <span>%</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后就是在 <code>post.ejs</code> 里引用这个模块加载评论。</p><pre><code><span><span></span></span></code></pre><blockquote><p>在 Material 主题现有的框架基础上添加评论系统可以参考 Material 主题的 <a href="https://github.com/viosey/hexo-theme-material/pull/247" target="_blank">Pull Request #247</a>，这是一位 Contributer 为 Material 主题添加了畅言评论系统的支持。</p></blockquote><p>由于多说的关闭，Material 主题接下来也会去除对多说评论系统的支持。 大家可以根据本文的思路自己更换为新的评论系统。我们也欢迎大家把你的改动贡献到给 Material 主题，来 Open a new pull request 吧！</p>]]></content>
        
        <summary type="html">
            
             由于 Hexo 本身已经弃用了 swig 支持，所以本文教程是根据 ejs 语言来写的。如果使用了如 NexT 等基于 swig 的 Hexo 主题，请自行切换。Hexo 是一款静态博客，所以不像 WordPress 或者 Typecho 这类动态博客一样支持原生评论系统，所
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="博客"/>
        
        <category term="评论"/>
        
        <category term="Hexo"/>
        
        <category term="多说"/>
        
    </entry>
    
    <entry>
        <title>Chrome 离线包查询</title>
        <link href="https://i-meto.com/chrome-binary/"/>
        <id>https://i-meto.com/chrome-binary/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-03-22T06:08:41+00:00</published>
        <updated>2017-03-22T06:08:41+00:00</updated>
        
        <content type="html"><![CDATA[<div><img src="https://image.static.i-meto.com/uploads/2017/12/chrome_logo.jpeg" /><p>DEMO: <a href="https://api.i-meto.com/chrome">https://api.i-meto.com/chrome</a><br />
短网址：<a href="https://u.nu/chrome">https://u.nu/chrome</a></p>
<p><img src="https://image.static.i-meto.com/uploads/2017/12/chrome.png" /></p>
<p>由于种种原因，Chrome 在中国的安装一直是有问题的，不过 Google 也提供了一系列的 Chrome 离线安装包，这就大大方便了中国网民的使用。</p>
<p>然而官网似乎并没有提供离线包的下载入口。。</p>
<p>首先科学上网后安装一个 Chrome，打开设置的关于界面进行抓包，可以发现一个更新请求</p>
<pre><code>POST https://tools.google.com/service/update2
DATA:
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;request protocol='3.0' version='1.3.23.9' shell_version='1.3.21.103' ismachine='0'
         sessionid='{3597644B-2952-4F92-AE55-D315F45F80A5}' installsource='ondemandcheckforupdate'
         requestid='{CD7523AD-A40D-49F4-AEEF-8C114B804658}' dedup='cr'&gt;
&lt;hw sse='1' sse2='1' sse3='1' ssse3='1' sse41='1' sse42='1' avx='1' physmemory='12582912' /&gt;
&lt;os platform='win' version='6.3' arch='{{arch}}'/&gt;
&lt;app appid='{{appid}}' ap='{{ap}}' version='' nextversion='' lang='' brand='GGLS' client=''&gt;&lt;updatecheck/&gt;&lt;/app&gt;
&lt;/request&gt;
</code></pre>
<p>查询其中的 appid 可以找到一个协议文档 <a href="https://github.com/google/omaha/blob/master/doc/ServerProtocolV3.md">https://github.com/google/omaha/blob/master/doc/ServerProtocolV3.md</a></p>
<p>其中 {{appid}}，{{arch}} 和 {{ap}} 对应不同的版本号</p>
<pre><code>{{appid}}
Stable: 8A69D345-D564-463C-AFF1-A69D9E530F96&quot;,
Beta: 8A69D345-D564-463C-AFF1-A69D9E530F96&quot;,
Dev: 8A69D345-D564-463C-AFF1-A69D9E530F96&quot;,
Canary: 4EA16AC7-FD5A-47C3-875B-DBF4A2008C20&quot;
</code></pre>
<pre><code>{{arch}}
x64, x86
</code></pre>
<pre><code>{{ap}}
Stable
    &quot;x86&quot;: &quot;-multi-chrome&quot;,
    &quot;x64&quot;: &quot;x64-stable-multi-chrome&quot;
Beta
    &quot;x86&quot;: &quot;1.1-beta&quot;,
    &quot;x64&quot;: &quot;x64-beta-multi-chrome&quot;
Dev
    &quot;x86&quot;: &quot;2.0-dev&quot;,
    &quot;x64&quot;: &quot;x64-dev-multi-chrome&quot;
Canary
    &quot;x86&quot;: &quot;&quot;,
    &quot;x64&quot;: &quot;x64-canary&quot;
</code></pre>
<p>整理一下，做个数据库缓存，再加个定时队列，很容易就能写出一个查询器了（就不贴源码了</p>
</div>]]></content>
        
        <summary type="html">
            
            DEMO: https://api.i-meto.com/chrome 短网址：https://u.nu/chrome  由于种种原因，Chrome 在中国的安装一直是有问题的，不过 Google 也提供了一系列的 Chrome 离线安装包，这就大大方便了中国网民的使用。 然而
            
        </summary>
        
    </entry>
    
    <entry>
        <title>多说要关闭了</title>
        <link href="https://131.re/marchives/96"/>
        <id>https://131.re/marchives/96</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-03-21T04:00:00+00:00</published>
        <updated>2017-03-21T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>原文：<a href="http://dev.duoshuo.com/threads/58d10f50e9a8cb4433fd5c5d" target="_blank">http://dev.duoshuo.com/threads/58d10f50e9a8cb4433fd5c5d</a></p>
<p>由于本站的评论出了问题，多说又要关闭了，因此本站的评论功能就只好暂时取消了(╥﹏╥)</p>]]></content>
        
        <summary type="html">
            
            原文：http://dev.duoshuo.com/threads/58d10f50e9a8cb4433fd5c5d 由于本站的评论出了问题，多说又要关闭了，因此本站的评论功能就只好暂时取消了(╥﹏╥)
            
        </summary>
        
    </entry>
    
    <entry>
        <title>同步你的 JetBrains 设置</title>
        <link href="https://blog.poi.cat/sync-your-jetbrains-settings"/>
        <id>https://blog.poi.cat/sync-your-jetbrains-settings</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-03-18T05:36:11+00:00</published>
        <updated>2017-03-18T05:36:11+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><p>我是 JetBrains 的死忠, 一是喜欢他们各种功能强大的 IDE; 二是喜欢他们推出的 JVM 编程语言: <a href="https://kotlinlang.org/">Kotlin</a>, 对于我这种 Java 苦手来说, Kotlin 是一个非常不错的替代品.</p><p>但是 JetBrains 的 IDE 有一个令人诟病的问题就是: IDE 太多了. 所以如果你使用了太多 JetBrains 的 IDE 的话, 这会造成:</p><ol><li><p>IDE 的安装和更新等管理起来很麻烦</p></li><li><p>快捷键等设置也很麻烦</p></li></ol><p>关于第一个问题, JetBrains 官方已经有了解决方法: <a href="https://www.jetbrains.com/toolbox/app">JetBrains Toolbox</a></p><p><img src="https://c1.staticflickr.com/3/2805/33376053311_b9a620b4a7_o.jpg" /></p><p><em>使用 JetBrains Toolbox 可以很方便的管理你的项目和工具</em></p><p>有了 Toolbox 之后, 所以的 JetBrains 都可以从 Toolbox 下载或者更新, 同时 Toolbox 也会列出所以你使用 JetBrains IDE 的项目.</p><p>至于第二个问题, 官方也提供了一个解决方法: <strong>JetBrains Settings Repository</strong>.</p><h2>JetBrains Settings Repository</h2><p>顾名思义, JetBrains Settings Repository 就是一个用于存放你的设置的 <strong>Git 仓库</strong>, 你可以把它放在 GitHub 上或者其他托管服务.</p><p>例如我的就是 https://github.com/PoiScript/JetBrainsSettings</p><p>准备好 Settings Repository 之后, 在 JetBrains IDE 的 <strong>File &gt; Settings Repository</strong> 里输入你的 Settings Repository 的地址:</p><p><img src="https://c2.staticflickr.com/4/3901/33348177492_4cd9f7fed4_o.png" /></p><p><em>设置你的 Settings Repository</em></p><blockquote><p>如果你的没有找到这个选项的话, 请确认一下是否开启了 <a href="https://plugins.jetbrains.com/plugin/7566-settings-repository">Settings Repository</a> 这个插件:</p><p><img src="https://c2.staticflickr.com/4/3872/33348177642_ffb2e9019b_o.png" /></p><p>这个插件是默认安装好而且默认开启的.</p></blockquote><p>填好地址之后有三个选项:</p><p><strong>Merge</strong>(合并), <strong>Overwrite Local</strong>(覆写本地配置) 和 <strong>Overwrite Remote</strong>(覆写远程配置).</p><p>之后的步骤就不用多说了吧: 把你需要同步的 IDE 的 Settings Repository 都设为相同的, 之后只要在一个地方修改了并且覆盖了远程的配置之后, 其他的 IDE 只需要覆盖本地的配置即可.</p><blockquote><p>当然如果你需要修改远程的 Settings Repository 的话是需要验证的, JetBrains 推荐的验证方式是使用 AccessToken.</p><p>关于如何获取 GitHub 的 AccessToken, 我在讲如何将博客部署到 GitHub Pages 的文章里提到过, 这里就不赘述了.</p></blockquote><h2>我的配置</h2><p>这里简述一下我的配置, 我的配置肯定不会适合所有人, 所以仅供参考.</p><p>如果你有比我更好的配置方案的话, 也欢迎在评论里指出, 谢谢.</p><p><strong>UI</strong>:</p><p>我不太喜欢 JetBrains 原生的界面字体, 所以我替换成了 Google 的 <a href="https://fonts.google.com/specimen/Roboto">Roboto</a> 字体.</p><p>至于编辑器的等宽字体, 以前我喜欢用 Adobe 的 <a href="https://fonts.google.com/specimen/Source+Code+Pro">Source Code Pro</a>. 不过后来 kookxiang 安利了我 <a href="https://github.com/tonsky/FiraCode">Fira Code</a>, 我就用上了.</p><p>至于第二字体则是 <a href="https://www.google.com/get/noto/help/cjk/">Noto Sans Mono CJK SC</a>, 主要是为了显示中文字体的.</p><p><strong>快捷键</strong>:</p><p>因为我除了使用 JetBrains IDE 之外, 还同时使用 <a href="https://atom.io/">GitHub Atom</a>, 所以我的快捷键的设置很大程度上是为了同一两者的体验:</p><ul><li>删除光标所在的行: <code>Ctrl</code> + <code>L</code></li><li>移动光标所在的行: <code>Ctrl</code> + <code>Shift</code> + <code>Up/Down</code></li><li>复制光标所在的行: <code>Ctrl</code> + <code>D</code></li><li>向上/下新增一个光标(多光标模式): <code>Shift</code> + <code>Alt</code> + <code>Up/Down</code></li><li>开启/关闭文件栏: <code>Ctrl</code> + <code>\\</code></li></ul><p><strong>Code Style</strong>:</p><p>Code Style 里我主要改的只有 JavaScript 和 TypeScript:</p><p>JavaScript 里是把 Code Style 改成了 Standard, 这个用了 WebStorm 2017.1 EAP 的新功能.</p><p>此外, 我还把 JavaScript 的 Language Version 改到了 ECMAScript 6.</p><p>TypeScript 则是和 JavaScript 类似.</p>]]></content>
        
        <summary type="html">
            
            前言我是 JetBrains 的死忠, 一是喜欢他们各种功能强大的 IDE; 二是喜欢他们推出的 JVM 编程语言: Kotlin, 对于我这种 Java 苦手来说, Kotlin 是一个非常不错的替代品.但是 JetBrains 的 IDE 有一个令人诟病的问题就是: IDE
            
        </summary>
        
        <category term="github"/>
        
        <category term="jetbrains"/>
        
    </entry>
    
    <entry>
        <title>博客域名更换为131.re</title>
        <link href="https://131.re/marchives/95"/>
        <id>https://131.re/marchives/95</id>
        
        <author>
            <name>131</name>
        </author>
        
        <published>2017-03-14T04:00:00+00:00</published>
        <updated>2017-03-14T04:00:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>时隔4个多月又换域名了233(๑≧∀≦๑)</p>

<p>大致讲一下前后的过程：</p>
<p>首先是在Hexonet上面瞎搜，搜到这个域名没有被注册，然后发现Hexonet支持支付宝就把这个域名注册了</p>
<p>注册完才发现限制注册人，不得已赶紧去找挂靠</p>
<p>找了半天最后在V2EX上看到Showfom以前的一个回复，然后从他的博客上找到了他的联系方式</p>
<p>联系他他说可以帮忙挂靠，到今天挂靠域名完成就赶紧把博客地址更换啦！</p>
<p>在此特别感谢Showfom的帮助！</p>]]></content>
        
        <summary type="html">
            
            时隔4个多月又换域名了233(๑≧∀≦๑)  大致讲一下前后的过程： 首先是在Hexonet上面瞎搜，搜到这个域名没有被注册，然后发现Hexonet支持支付宝就把这个域名注册了 注册完才发现限制注册人，不得已赶紧去找挂靠 找了半天最后在V2EX上看到Showfom以前的一个回复
            
        </summary>
        
    </entry>
    
    <entry>
        <title>入手 PS4 Slim</title>
        <link href="https://blog.poi.cat/bought-ps4-slim"/>
        <id>https://blog.poi.cat/bought-ps4-slim</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-03-01T05:57:14+00:00</published>
        <updated>2017-03-01T05:57:14+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>2017-03-14 更新: 新增了 刺客信条: 大革命 和 杀戮地带: 暗影坠落的游戏体验部分.</p></blockquote><h2>Why PlayStation?</h2><p>为什么选择 Sony PlayStation? 而不是 XBox One? 甚至是即将出的 Nintento Switch?</p><p>主要是因为 PlayStation 上的独占游戏相比其他两个主机平台更多更全.</p><blockquote><p>例如: <a href="https://en.wikipedia.org/wiki/Nier:_Automata">尼尔: 机械纪元</a>(<s>2B 小姐姐</s>)</p></blockquote><p>此外 PS4 的性能相比 XBox One 也更加强. 当然, XBox 也在奋起直追, 推出了 <strong>天蝎座(Project Scorpio)</strong>. 不过鉴于目前天蝎座还为上市, XBox 能否借此翻身还是未知数.</p><h2>Why Slim?</h2><p>PS4 目前简略的来说有三个大版本: PS4(即初版), PS4 Slim, PS4 Pro.</p><p><img src="https://c1.staticflickr.com/3/2913/33297552255_446f3a52fe_o.jpg" /></p><p><em>三版 PS4 的对比, 从上到下分别是 PS4 Slim, PS4 和 PS4 Pro</em></p><p>原版的 PS4 和 PS4 Slim 已经没有任何的可比性了:</p><ol><li><p>PS4 Slim 机身比 PS4 更加 <strong>轻薄</strong>, 且 <strong>散热</strong> 更好, <strong>噪音</strong> 更少.</p></li><li><p>PS4 Slim 支持 <strong>5G</strong> 频段 WiFi.</p></li><li><p>PS4 Slim 的性能和 PS4 <strong>相同</strong>, 且价格更 <strong>便宜</strong>.</p></li><li><p>PS4 Slim 使用了 <strong>新版的 DualShock 4 手柄</strong>.</p></li></ol><p>而相比之下, PS4 Pro 的提升不多, 主要都是画质的提升:</p><ol><li><p>输出 <strong>4K 画面</strong></p></li><li><p>支持 <strong>HDR</strong></p></li><li><p>运行游戏更加流畅</p></li></ol><p>而且部分游戏还对 PS4 Pro 进行了优化, 可以获得更强的游戏性能. 这部分游戏会标注为 <strong>ENHANCED 强化游戏</strong>:</p><p><img src="https://c1.staticflickr.com/3/2848/33303850465_b012a05d4f_o.jpg" /></p><p><em>强化游戏的 LOGO</em></p><p>画面什么的目前我不太在意, 因为我本身的屏幕也不是什么好屏幕, 只是一个普通的 1080P 而已.</p><p>所以最后综合我目前的情况, 我选择了 PS4 Slim.</p><p>此外因为我的 PSN 帐号是港服的, 而国行的主机登录不了国服以外的帐号, 所以我买了港版的主机.</p><h2>上手体验</h2><p>拿到主机之后, 第一眼就看出 Slim 通体用的是磨砂的塑料, 而不是 PS4 的那种亮面的塑料, 显得更加的低调.</p><p><img src="https://c2.staticflickr.com/4/3885/33297553145_834dc9f216_b.jpg" /></p><p><em>SONY LOGO PS4 LOGO 特写</em></p><p>可以看出, PS4 Slim 并没有采用 PS4 上那个有点花哨的个感应式开机键, 而是换成了普通按键.</p><blockquote><p>实际上 SONY 在 PS4 12xx 系里就已经意识到静电开关的问题了, 将开关改成了普通的按键.</p><p>不过同时也去掉了 10xx 和 11xx 的漂亮的烤漆表面... sad</p></blockquote><p><img src="https://c1.staticflickr.com/1/760/33297552625_b8b83d8f89_b.jpg" /></p><p><em>DUALSHOCK4 手柄</em></p><p>新版的 DUALSHOCK4 手柄, 相比旧款的, 改进的地方不多. 主要是改进了 LED 灯, 可以通过触摸屏上看到 LED 灯的状态; 还有就是按键改成磨砂质感了.</p><p><img src="https://c1.staticflickr.com/3/2896/33169374751_e2d35245d0_b.jpg" /></p><p><em>DUALSHOCK 4 vs XBox One Controller</em></p><blockquote><p>XBox One 的手柄是 <strong>泰坦陨落(Titanfall)</strong> 版</p></blockquote><h2>游戏体验</h2><p><img src="https://c1.staticflickr.com/1/694/33169375011_61e98fb5f7_o.jpg" /></p><p><em>地平线: 黎明时分(Horizon: Zero Dawn)</em></p><p>地平线是我和 PS4 Slim 一起入的, 于 2 月 28 日 发售.</p><p>经过了几天的游玩之后, 我感觉 PS4 Slim 驾驭 1080p@30fps 还是绰绰有余的.</p><p>游戏全程都很流畅, 一些部分场景会发生 BGM 播放卡顿的问题, 应该是游戏优化的问题.</p><p>此外, 我还趁 PSN 港服优惠, 入手了 <strong>刺客信条: 大革命</strong>(Assassin's Creed Unity) 和 <strong>杀戮地带: 暗影坠落</strong>(Killzone Shadow Fall).</p><blockquote><p>值得一提的是, 杀戮地带和地平线是都是由 Sony 第一方游戏公司 Guerrilla 开发的.</p><p>此外, 他们还开发了 RIGS: 机械化战斗联盟(RIGS Mechanized Combat League).</p></blockquote><p>其中, 杀戮地带的运行十分流畅; 而刺客信条则不仅偶有卡顿, 而且不支持 PS4 的 Reset 模式, 每次进入待机模式回来之后都需要重新打开游戏. 所以只能归咎于育碧的渣优化了, 毕竟当初育碧就由于大革命的游戏 Bug 太多而将 DLC 免费赠送.</p><h2>后语</h2><p><strong>#archlinux-cn PSN 分部</strong> 已成立:</p><p><img src="https://c1.staticflickr.com/1/672/32921094540_d71432a809_o.jpg" /></p><p>欢迎大家入驻 :)</p>]]></content>
        
        <summary type="html">
            
            2017-03-14 更新: 新增了 刺客信条: 大革命 和 杀戮地带: 暗影坠落的游戏体验部分.Why PlayStation?为什么选择 Sony PlayStation? 而不是 XBox One? 甚至是即将出的 Nintento Switch?主要是因为 PlaySt
            
        </summary>
        
        <category term="game"/>
        
        <category term="ps4"/>
        
        <category term="sony"/>
        
    </entry>
    
    <entry>
        <title>Disqus 评论加载模式思路分析</title>
        <link href="https://blog.nfz.moe/archives/how-to-show-disqus-comment-in-gfw.html"/>
        <id>https://blog.nfz.moe/archives/how-to-show-disqus-comment-in-gfw.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-02-21T14:35:12+00:00</published>
        <updated>2017-02-21T14:35:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>Disqus 因为一些显而易见的问题，所以无法在一些 公正、平等、有序 的网络环境直接加载。</p><a></a><blockquote><p>为什么要使用 Disqus 而不使用多说，可以阅读我的另一篇博客——<a href="https://blog.neofelhz.space/archives/hello-disqus-and-goodbye-duoshuo.html" target="_blank">《你好 Disqus，再见多说》</a></p><p>现在为了博客的加载速度，你可以看到我博客底部评论区新增加了一个按钮，点击按钮以后才能加载评论。由于这个不主动加载 Disqus 的设计，我博客的 DOM Load 成功减少了 0.4s。这个功能在 hexo-theme-material 主题 1.3.0 时发布。</p></blockquote><p>但是为了解决浏览者看评论的问题，由于 Disqus 的跨域加载限制，在中国国内的互联网环境下加载 Disqus，不得不另辟蹊径。</p><p>Disqus 提供了一套完整的 API，可以调用很多类型的数据，比如评论数量、评论内容等等数据。调用地址是 disqus.com/api，这里是 <a href="https://disqus.com/api/docs" target="_blank">Disqus API 的文档 </a>。<br /> 由于 API 返回的是字符或者 json 文件，所以这时我们就可以通过反代 API 的地址就可以成功地获取到 json 数据。接下来只需要通过 JS 解析 json，转义成列表，展现出来即可。</p><p>对于指定页面加载指定评论，可以在调用 API 时用参数加以限制。Disqus 的 shortname 和文章标识符可以不需要动态生成，用 Hexo 的函数和 ejs 调用即可。例如通过 <code>&lt;%= theme.comment.shortname %&gt;</code> 可以调用主题配置文件里的 Disqus Shortname，用 <code>&lt;%- page.path %&gt;</code> 获取当前页面的标识。</p><blockquote><p>以下就是你可以获取到评论列表 json 的地址。</p></blockquote><pre><code>https://YOUR.DOMAIN/api/3.0/threads/list.json?forum=&quot; + YOUR DISQUS SHORTNAME + &quot;&amp;thread=ident:&quot; + &quot;&lt;%- page.path %&gt;&quot; + &quot;&amp;api_key= YOUR API KEY&quot;</code></pre><p>那么，什么时候用评论浏览模式，什么时候加载 Disqus，我们需要做一个判断。可以判断 Disqus 下的一些特定元素能不能加载（比如那个加载动画），一旦加载超时了，就切换到评论浏览模式。当然为了避免误判，我们可以保留那个按钮，做好切换功能。</p><p>当然，Disqus 的 API 的功能非常完善，除了可以加载评论列表，还可以回传评论。<a href="https://imququ.com" target="_blank">屈哥（前端大菊苣）的博客 </a> 的 Disqus 评论就可以支持本地评论，然后服务器异步回传给 Disqus。</p>]]></content>
        
        <summary type="html">
            
            Disqus 因为一些显而易见的问题，所以无法在一些 公正、平等、有序 的网络环境直接加载。为什么要使用 Disqus 而不使用多说，可以阅读我的另一篇博客——《你好 Disqus，再见多说》现在为了博客的加载速度，你可以看到我博客底部评论区新增加了一个按钮，点击按钮以后才能加
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="博客"/>
        
        <category term="评论"/>
        
        <category term="Disqus"/>
        
    </entry>
    
    <entry>
        <title>通过 Firebase Authentication 进行 OAuth 授权</title>
        <link href="https://blog.poi.cat/oauth-via-firebase-authentication"/>
        <id>https://blog.poi.cat/oauth-via-firebase-authentication</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-02-19T15:36:31+00:00</published>
        <updated>2017-02-19T15:36:31+00:00</updated>
        
        <content type="html"><![CDATA[<h2>前言</h2><p>在上上篇文章 里我介绍了我的新博客系统 <strong>Solomon</strong>, 其中就讲的到了我用了 GitHub Issue 做为评论系统. 这么做有两个麻烦的地方:</p><ol><li>需要为每一篇文章创建一个 issue;</li><li>评论者需要有 GitHub 帐号, 然后在登录的状态下到 issue 的页面进行评论.</li></ol><p>作为一个处女座, 我觉得需要到别的页面才能评论或点赞的用户体验太糟糕了. 所以, 我考虑让评论者通过 OAuth 授权的方式获得 Token, 然后就可以直接在文章页面进行评论了.</p><h2>OAuth</h2><blockquote><p>OAuth（开放授权）是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。</p><p>via 维基百科</p></blockquote><p>OAuth 的具体实现就是通过提供给第三方一个 <strong>Token</strong>, 第三方就可以通过这个 Token 在 <strong>特定的时间</strong> 内访问 <strong>特定的内容</strong>.</p><p>既然要在 GitHub 上评论, 我们就需要先在 GitHub 上注册我们的应用:</p><p>打开 <a href="https://github.com/settings/developers">Developer applications</a> 或者进入 GitHub 的设置页面, 在侧边栏里选择 <strong>OAuth applicatioins</strong>.</p><p>然后选择 <strong>Register a new application</strong> 注册一个新的应用:</p><p><img src="https://c1.staticflickr.com/3/2544/32836484732_010a3af524_b.jpg" /></p><blockquote><p>注意这里有个 <strong>Authorization callback URL</strong>, 它是我们和 GitHub 完成授权之后的一个重定向地址, 目前我们还不知道要填什么. 可以先空着也可以随便填点什么, 等一下我们会换成正确的地址.</p></blockquote><p>填写好信息之后点击 <strong>Register application</strong>. 之后就可以看到这个界面, 就代表我们的应用已经注册好了.</p><p><img src="https://c1.staticflickr.com/3/2302/32950124986_de5d4164e5_b.jpg" /></p><p>在这个页面我们还可以可以我们的 <strong>Client ID</strong> 和 <strong>Client Secret</strong>.</p><p><strong>Client ID</strong> 是用于用户和 GitHub 获得授权的时候使用的, GitHub 通过这个得知你要授权的网站, 并且会把该网站需要的权限列出来, 让用户决定是否授权.</p><p>用户确认了之后就会跳转到我们上面提到的 <strong>Callback URL</strong>, 并且返回一个 <strong>code</strong>.</p><p>我们在得到了 <strong>code</strong> 之后, 将它和 <strong>Client Secret</strong> 传给 GitHub, GitHub 就会返回一个有时限的 <strong>access_token</strong>, 通过这个 token 我们就能访问到 GitHub 的资源了.</p><p>但是, OAuth 授权的话意味着需要有服务器帮我们完全上述内容. 这对于我这种静态博客来说是一大困难. 本身就是为了节省打理服务器的时间而选择了静态博客, 现在为了一个评论的功能再引入一个服务器, 不免有点本末倒置.</p><p>所幸, 托管我的网站的 Firebase 提供了 <a href="https://firebase.google.com/docs/auth/">Firebasee Authentication</a>, 让我们可以通过 Firebasee 的服务器完成整个授权过程.</p><h2>Firebase Authentication</h2><p>关于 Firebase 的介绍在上上一篇我简要的介绍过了. Firebase Authentication 则是 Firebase 提供的一个身份验证服务.</p><p>Firebase Authentication 不仅可以使用 <strong>传统的邮箱密码验证</strong>, 还引入了一些比较流行的身份提供商, 例如: <strong>Google, Facebook 和 Twitter</strong> 等.</p><p><img src="https://c1.staticflickr.com/3/2312/32836484982_67c9929997_o.png" /></p><p>此外, Firebase Authentication 利用了行业标准: 我们上面提到的 <strong>OAuth 2.0</strong> 和 <strong>OpenID</strong> 等, 所以也可以集成到自定义的后端里.</p><p>要使用 Firebase Authentication 需要先进行一下配置: 首先登录到 <a href="https://console.firebase.google.com/">Firebase Console</a>.</p><p>然后在侧边栏里选择 <strong>Authentication</strong>, 然后选择 <strong>Sign-in Method</strong> 子选项卡:</p><p><img src="https://c1.staticflickr.com/3/2840/32836485442_c5d88f2ec8_o.png" /></p><p>接下来开启 GitHub 认证, 填写我们的 <strong>Client ID</strong>, <strong>Client secret</strong>:</p><p><img src="https://c1.staticflickr.com/1/766/32950124566_48f78f16dc_b.jpg" /></p><p>注意到下面地址了吗? 那个就是我们的 <strong>回调地址</strong>, 保存好 Firebase 这边的设置之后. 我们需要回到 GitHub, 把回调地址改成 Firebase 提供给我们的那个:</p><p><img src="https://c1.staticflickr.com/3/2351/32836485542_23f4471c15_o.png" /></p><blockquote><p>为了安全, Firebase 限制了只有通过认证的域名才可以通过完全整个用户认证的过程.</p><p>默认的认证的域名只有 localhost 和你项目的默认地址.</p><p>所以, 如果你使用了自定义域名的话. 还需要把你的域名加到 <strong>OAuth redirect domains</strong> 里:</p><p><img src="https://c1.staticflickr.com/1/733/32836485712_979b27f90d_o.png" /></p></blockquote><h2>Angularfire 2</h2><p>GitHub 和 Firebase 都设置好之后, 就可以正式的使用了.</p><p>Firebase Authentication 提供了两种使用方法:</p><ol><li><p><a href="https://github.com/firebase/FirebaseUI-Web">FirebaseUI</a></p></li><li><p><a href="https://firebase.google.com/docs/auth/web/github-auth">Firebase Authentication SDK</a></p></li></ol><p>FirebaseUI 尚处于测试阶段, 所以我这里选择用 Firebase Authentication SDK.</p><p>Firebase 提供的 <a href="https://github.com/firebase/quickstart-js/blob/master/auth/github-popup.html">Demo</a> 是在应用的 HTML 中加入 <code>firebase.js</code> 文件, 然后在 <code>&lt;script&gt;</code> 中定义各种操作.</p><p>既然我们已经用了 <strong>Angular</strong>, 就不需要用这种比较「脏」的方法了. 我们这里用 Angular 官方提供的库: <a href="https://github.com/angular/angularfire2">Angularfire2</a></p><p>设置 Angularfire 2 很容易, 先 <strong>安装依赖</strong>:</p><pre><code><span>$</span><span> yarn add firebase angularfire2</span>
</code></pre><blockquote><p>当然也可以用 <code>$ npm install firebase angularfire2 --save</code></p></blockquote><p>然后在你的 <strong>根模块</strong> 里加上:</p><pre><code><span>export</span> <span>const</span> firebaseConfig = {
  apiKey: <span>'&lt;your-key&gt;'</span>,
  authDomain: <span>'&lt;your-project-authdomain&gt;'</span>,
  databaseURL: <span>'&lt;your-database-URL&gt;'</span>,
  storageBucket: <span>'&lt;your-storage-bucket&gt;'</span>,
  messagingSenderId: <span>'&lt;your-messaging-sender-id&gt;'</span>
};

<span>@NgModule</span>({
  imports: [
    BrowserModule,
    AngularFireModule.initializeApp(firebaseConfig)
  ],
  declarations: [ AppComponent ],
  bootstrap: [ AppComponent ]
})
</code></pre><p>注意要将其中的 <code>firebaseConfig</code> 改成你的项目的配置.</p><p>配置在哪里找呢? 在你的 <strong>Firebase Console</strong> 的 <strong>Overview</strong> 里点击 <strong>Add Firebase to your web app</strong>:</p><p><img src="https://c2.staticflickr.com/4/3708/32991332765_c60264d52e_b.jpg" /></p><p>配置完了之后就可以使用了. 例如, 登录的话需要调用 <code>AngularFire.auth#login()</code> :</p><pre><code><span>this</span>.af.auth.login({
  provider: AuthProviders.Github,
  method: AuthMethods.Popup,
  scope: [<span>'public_repo'</span>]
}).then(<span>(<span>res: <span>any</span></span>) =&gt;</span> {
  <span>console</span>.log(res)
  <span>if</span> (<span>'accessToken'</span> <span>in</span> res.github) <span>this</span>.tokenService.setToken(res.github.accessToken)
  <span>else</span> <span>this</span>.snackBarOpen(<span>'Access Token Not Found, Re-login Please.'</span>, <span>1000</span>)
})
</code></pre><p>这里需要注意两点:</p><ol><li><p>为了安全, GitHub 只会在登录的时候返回 <code>accessToken</code>. 所以我们需要在发起登录请求的之后调用 <code>.then()</code>, 获取我们需要的 <code>accessToken</code>, 存在我们的 <strong>TokenService</strong> 里或者其他地方.</p></li><li><p>我们获取 <code>accessToken</code> 的目地是用它来调用 <strong>GitHub API</strong>, 实现评论的功能的. 所以我们在登录的时候需要多申请一个 <code>public_repo</code> 的权限. 否则就会出现 <code>Issue not viewable by xxx</code> 等错误.</p></li></ol><blockquote><p>我一开始没发现, 还去 stackoverflow 提问: <a href="https://stackoverflow.com/questions/42323439/how-to-post-comment-using-github-oauth-token-in-angular-2">How to Post Comment using GitHub OAuth Token in Angular 2</a> :(</p><p>在这里感谢一下 <a href="https://stackoverflow.com/users/1074361/pedro-nascimento">Pedro Nascimento</a>, 帮我找到了问题所在. :)</p></blockquote><p>得到了 <code>accessToken</code> 之后能干的事情就有很多了, 例如在 Solomon 里直接: 添加/修改/删除评论, 添加/删除 Reaction; 此外还可通过 <code>accessToken</code> 认证每一次 GitHub API 的调用, 实现增加 GitHub API 的调用上限: https://developer.github.com/v3/#rate-limiting</p><h2>存在的问题</h2><p>如果仔细看我上面的代码就会发现我是把 <code>accessToken</code> 放在了 <code>TokenService</code>, 而没有使用持久化存储, 例如数据库等. 这样的话, 意味着每次浏览完 Solomon, 关闭页面之后, 下次再来的话, 就需要重新登录一遍了.</p><p>当然, 也不是没有办法, Firebase 还提供了 <strong>实时数据库</strong>, 可以把 <code>accessToken</code> 存在里面.</p><p>不过这样就意味着我可以直接接触到 <code>accessToken</code>. 虽然这个 <code>accessToken</code> 的权限不多, 只能访问公共仓库, 而且有时限. 但是我还是不希望让整个认证的过程变得不那么透明, 所以目前还是 <strong>保留这个问题</strong>.</p><h2>后语</h2><p>就像我上一章里介绍了 Firebase Hosting 之后说的那样. Hosting 和 Authentication 只是 Firebase 众多功能中的两个而已:</p><p><img src="https://c1.staticflickr.com/3/2470/32991333905_b1b2a8db29_o.png" /></p><p>Firebase 还有更多非常使用的功能, 像上图中的 Analytics(用户分析), Datebase(实时数据库), Crash Reporting(错误追踪), Test Lab(测试平台, 测试 Android 应用的兼容性), Notifications(云推送), AdMob(广告获利) 等才是 Firebase 的大杀器.</p><p>所以, <strong>Google 大法好</strong>. :)</p>]]></content>
        
        <summary type="html">
            
            前言在上上篇文章 里我介绍了我的新博客系统 Solomon, 其中就讲的到了我用了 GitHub Issue 做为评论系统. 这么做有两个麻烦的地方:需要为每一篇文章创建一个 issue;评论者需要有 GitHub 帐号, 然后在登录的状态下到 issue 的页面进行评论.作为
            
        </summary>
        
        <category term="firebase"/>
        
        <category term="github"/>
        
        <category term="oauth"/>
        
    </entry>
    
    <entry>
        <title>My Telegram mini toolkits (zh-CN)</title>
        <link href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/"/>
        <id>https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2017-02-14T02:38:27+00:00</published>
        <updated>2017-02-14T02:38:27+00:00</updated>
        
        <content type="html"><![CDATA[<h3><a href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/#Abstract"></a>Abstract</h3><p>My first submission to <a href="http://matrix.sspai.com/" target="_blank">“Matrix”</a>, a private product sharing platform built by SSPai (in zh-CN). This article introduces some of my recent bots or project related to Telegram, including the following stuff:</p>
<ul>
<li><a href="https://github.com/blueset/ehForwarderBot/" target="_blank">EH Forwarder Bot</a>: an extensible tunnel bot framework.</li>
<li><a href="https://t.me/big_text_bot" target="_blank">Big Text Bot</a>: A pure text sticker Telegram inline bot. <a href="https://gist.github.com/blueset/6ee2b1dac0987a54548d673d509f3d3d" target="_blank">Source</a>.</li>
<li><a href="https://labs.1a23.com/rate" target="_blank">BankComm Rate Monitor</a>: Log, monitor, and alert for exchange rate from Bank of Communication. <a href="https://gist.github.com/blueset/40edb208fd25c384213907e2489e311f" target="_blank">Source</a>.</li>
<li><a href="https://gist.github.com/blueset/ca6dc7ec5cc7a41656ed8944e374b60f" target="_blank">Telegram Sticker Removal bot (tg-cli interface)</a>: Remove stickers from group chat with 60s TTL. <code>tg-cli</code> and normal user account required.</li>
<li><a href="https://github.com/blueset/fanfoubot" target="_blank">FanfouBot (电磁炉)</a>: A Fanfou tweet bot on Telegram (<a href="https://t.me/fanfoubot" target="_blank">@FanfouBot</a>)</li>
</ul>
<h2><a href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/#我的-Telegram-小工具集：「统一聊天平台，各种工具，和监控提醒」"></a>我的 Telegram 小工具集：「统一聊天平台，各种工具，和监控提醒」</h2><p>本文参与<a href="http://sspai.com/topic/2016" target="_blank">少数派 2016 年度征文</a>，并同步发布于<a href="http://matrix.sspai.com/p/df73aca0" target="_blank">少数派 Matrix</a>。</p>
<p>第一次来 Matrix，首先自我介绍一下吧。Eana Hufwe，留学狗，所谓独立程序员，1A23 工作室室长兼全体成员，Telegram 重度用户，平时喜欢自己搞一些有的没的各种小玩具。差不多是三年前，有同学推荐用 Telegram 之后就变得无法自拔。作为一个即时消息平台，Telegram 可能不是最安全的（肯定不是，因为还有 Signal 等一票所有会话端对端加密的其他平台），但它绝对是我目前用过的所有 IM 里面用户体验做的最好的一个。当然至于 Telegram 如何好用，目前互联网上有很多在介绍 Telegram 各种特性的文章，我就不在此赘述了。</p>
<h3><a href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/#「统一聊天平台」"></a>「统一聊天平台」</h3><p>在某一个软件里面统一所有聊天平台和社交网络一直是我的一个愿望。大概是十几年前，看到 Jabber 能用 XMPP 连接 QQ、Skype 和 Google Talk，感觉很有意思。虽然各种功能兼容的不是很完善，但是还是很有意思。到后来各大平台都在用自己的协议，甚至是封闭协议开发各种平台，类似的项目也慢慢地销声匿迹了。</p>
<p>其实若不是家里的人各种「要求」的话，我手机上的 IM 估计只会有 Telegram。不过依旧是「实在看不下去微信」（参阅<a href="https://blog.1a23.com/2015/12/15/My-belief-in-choosing-a-tool-service-to-use/">这篇博文</a>），于是乎在做完各种调研之后我启动了 EH Forwarder Bot 项目。</p>
<p><a href="https://ehforwarderbot.readthedocs.io/en/latest/" target="_blank">EH Forwarder Bot</a>（以下简称 EFB）是一个开源、可扩展的聊天平台隧道 Bot 框架，基于 Python 3，旨在让用户从一个平台上收发其他平台的消息，最终达到远程遥控其他平台账号的效果。</p>
<p>最开始启动这个项目的时候也没多想，之前开的各种 Bot 都是 EH + 用途 + bot 这样的名字（Telegram 要求所有 Bot 的用户名以 <code>bot</code> 结尾），所以这个也就用的这样的名字。最初开发这个的时候，因为本来也有考虑兼容各种平台（当时的野心是兼容所有在用的 IM：微信、WhatsApp、Facebook Messenger）。不过若是我一个人做的话，兼容起所有平台估计要几年（毕竟还是要上学的）。所以就认认真真写了文档，期待着有谁能一起来开发插件。</p>
<p>目前 EFB 能够较为稳定的收发微信消息。支持微信网页版的大部分功能，并且能够利用 Telegram Bot 的各种高级功能来进行各种管理操作。当然，网页版微信办不到的，EFB 微信从端亦办不到。现在的 EFB 基本上能够实现大部分基于微信的通讯需求，且在圈子里面小有好评。关于如何安装使用，以及如何扩展 EFB 以支持其他的平台，请参见<a href="https://ehforwarderbot.readthedocs.io/en/latest/" target="_blank">文档说明</a>。如果再有时间的话，估计我会从 Facebook Messenger 和 WhatsApp 里面选一个，向英语圈推广一下。</p>
<h3><a href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/#「监控与提醒」"></a>「监控与提醒」</h3><p>虽然对于提醒这一任务来说，市面上还有许多其他类似的服务，比如说 PushBullet 之类的，也提供了开放的接口来对接其他的服务，也不乏像 IFTTT 这样的用户友好型的联动服务。不过对于我来说 Telegram 作为我的常用客户端，提醒的比较及时，而且相比于其他的方式定制性更强。再加上我要监控的东西都是比较冷门的，也不会在 IFTTT 上面找到合适的 Recipe。（有人可能会说 IFTTT 和 Zapier 有 HTTP API 可以用啊，Telegram 的 Bot API 也是 HTTP 的，何必让中间服务捯一遍手呢。）</p>
<p>目前写了两个小脚本：首先一个是监控交行的外汇牌价的。前一阵子要换外汇交学费，就想着写一个爬虫爬这个牌价。虽然网上的各种汇率监控应该说是不胜枚举，不过毕竟自己写出来的还是比较方便定制和修改，而且「所见即所得」——看到的数字就是即时的交易数额。顺便还能把以往的数据记录下来画出曲线图。（没学过金融，不太懂这方面，不过感觉虽然整体趋势应该是统一的，单各个银行的浮动应该有所区别吧。）目前设定的的提醒频率是这样的</p>
<ul>
<li>需要密切关注的时候：每小时每越过 0.01 单位线时提醒一次</li>
<li>无需密切关注的时候：每小时每越过 0.10 单位线时提醒一次</li>
</ul>
<p>当然，爬虫自然是每五分钟从交行更新一下数据。（因为交行的数据每五分钟更新一次。）幸运的是，交行的外汇牌价页面可以直接访问（普通 GET 请求），而且看起来没有设什么限制。</p>
<p>然后顺便为了画曲线图方便，顺便写了一个<a href="https://labs.1a23.com/rate" target="_blank">简单的页面</a>来显示实时数据以及自动刷新。</p>
<p>另外一个脚本的通用性实在是有些小：在我们学校监控抢课的脚本。（我们学校的课程注册是不限名额的，只有好的上课时间需要抢）其实本来一开始是可以手工抢到理想的时间的，不过其中的经纬就不详述了，简单来说就是有一门课临时改时间，然后撞车了。目前留给我的方法是：</p>
<ul>
<li>盯着抢课页面，什么时候有人放出来了那个时间就注册上。</li>
<li>到月底放出最后四个名额的时候去抢</li>
<li>实在抢不到就只能上那个（几乎到了晚上的）课时了。</li>
</ul>
<p>可惜的是，<em>刚好放名额的那天我在飞机上</em>。虽然不是说完全赶不上，但也是ギリギリ（girigiri，在时间、数量、场景或阶段变换的最后分界的那个点上）。所以我就需要实时监视着抢课页面以防万一。不过和交行的牌价页面不同的是，学校的信息管理页面实用的是 ASP.net 构建的服务与界面，还有各种晦 (e) 涩 (xin) 的表单元素操作和 <code>__VIEWSTATE</code>。囿于时间上的限制，我没有一步步的解析整个参数传递的过程，而是直接用上了模拟浏览器操作（Selenium + PhantomJS）。虽然这种方式会导致运行效率低下，不过对于复杂的请求来说很好写。从刚开始看 Selenium 的文档开始，到做成一个能用的东西，总共用了大概 30 分钟。至于循环运行的话，和刚才的交行的爬虫一样，就直接交给系统的 Cron Job 了，每五分钟运行一次。</p>
<p>除了这两个小脚本以外，另外我还开了一个降价提醒：Skins A400。前一阵子准备买一套压缩服，看了看「S某ZDM」上面的各种文章推荐，也对 Skins A400 心里长草，不过还是太贵。于是就在<a href="https://smzdm.com" target="_blank">「S某ZDM」</a>和<a href="https://ozbargain.com" target="_blank">「某zBargain」</a>（当地的打折信息网站）开了两个监控。借用这两个网站的 RSS 消息源，然后使用了 <a href="https://www.feedrinse.com" target="_blank">FeedRinse</a> 的 RSS/Atom 订阅重组过滤服务，设定好关键词（比如说「SKINS &amp;&amp; A400 &amp;&amp; 男」）这样，然后 FeedRinse 就可以生成一个新的订阅地址，把符合筛选条件的条目列出来。对于这种偶尔才会出一条，而且需要关注的条目，我直接是在 Telegram 上面订阅的。Telegram 上面也有不少的 RSS Bot，目前我在用的是 <a href="https://github.com/iovxw" target="_blank">iovxw</a> 开发的 <a href="https://t.me/TheBlackRSSbot" target="_blank">RSSBot (@TheBlackRSSbot)</a>。用起来也不错。</p>
<p>顺便也来推荐一个可以追踪快递状态的 RSS 源：<code>https://ifttt.imlonghao.com/</code>。用法是 <code>https://ifttt.imlonghao.com/快递号?totitle=1&amp;title=订阅名称</code>。 如果不需要把快递状态写进标题的话可以去掉 <code>totitle=1&amp;</code> 的部分。记得在快件签收之后退订以节省服务器资源。利用的是快递 100 的接口，所以大部分的常见国内快递都能支持。</p>
<h2><a href="https://blog.1a23.com/2017/02/14/My-Telegram-mini-toolkits-zh-CN/#「各种小工具」"></a>「各种小工具」</h2><p>Telegram 作为一个易用、开放的即时消息平台，其一大优势就是上面的各种 Bot，在不影响正常的聊天体验的基础上，可以很好的提升消息体验，还有一些其他的小工具。在这边介绍几个我常用的：</p>
<ul>
<li>搜索类<ul>
<li><a href="https://t.me/SiftBot" target="_blank">@SiftBot</a>：一个搜索类 Bot，可以引用各种搜索结果，基于 Bing。</li>
<li><a href="https://t.me/bing" target="_blank">@bing</a>/<a href="https://t.me/pic" target="_blank">@pic</a>/<a href="https://t.me/gif" target="_blank">@gif</a>：Bing / Yandex / Giphy 图片搜索，贴纸库不够用的时候可以派上用场。</li>
<li><a href="https://t.me/letmebot" target="_blank">@LetMeBot</a>：对方不想和你说话，并向你丢出了一个搜索关键词。</li>
</ul>
</li>
<li>聊天辅助类<ul>
<li><a href="https://t.me/textemojibot" target="_blank">@TextEmojiBot</a>：输入各种文字表情（顔文字）时可用。</li>
<li><a href="https://t.me/big_text_bot" target="_blank">@big_text_bot</a>：生成大字贴纸用 Bot。（自作）</li>
<li><a href="https://t.me/like" target="_blank">@like</a>/<a href="https://t.me/vote" target="_blank">@vote</a>/<a href="https://t.me/groupagreebot" target="_blank">@groupagreebot</a>：各种用于征集意见用的 Bot，包括投票，收集信息，甚至单纯的点赞。</li>
</ul>
</li>
<li>客户端类<ul>
<li><a href="https://t.me/gmailbot" target="_blank">@GmailBot</a>：Gmail 迷你客户端，基于 Google Oauth 授权，Telegram 官方推荐，安全性未知。</li>
<li><a href="https://t.me/githubbot" target="_blank">@GithubBot</a>：GitHub Commit 和 Issue 更新提醒，基于 GitHub Oauth 授权。</li>
<li><a href="https://t.me/fanfoubot" target="_blank">@FanfouBot</a>：电磁炉，一个<a href="http://fanfou.com" target="_blank">饭否</a>发饭用 Bot。（自作）</li>
<li><a href="https://t.me/TheBlackRSSbot" target="_blank">@TheBlackRSSbot</a>：RSS 订阅。</li>
</ul>
</li>
<li>工具类<ul>
<li><a href="https://t.me/weatherman_bot" target="_blank">@Weatherman_bot</a>：天气预报，信息来源未知。</li>
<li><a href="https://t.me/airpollution_bot" target="_blank">@AirPollution_bot</a>：空气污染指数，数据来源为 aqicn.org。</li>
<li><a href="https://t.me/wolframbot" target="_blank">@WolframBot</a>：<a href="https://www.wolframalpha.com" target="_blank">WolframAlpha</a> 的非官方 Bot。</li>
</ul>
</li>
</ul>
<p>此外之前我还写了一个用来<a href="https://gist.github.com/blueset/ca6dc7ec5cc7a41656ed8944e374b60f" target="_blank">主动删除群组里面贴纸的小脚本</a>，基于 <code>tg-cli</code> 和 Telegram 一般用户账号，需要赋予该账号群管理员权限。主要是用在 EFB 的支持群里面。贴纸太多看起来总像闲聊群。</p>
<p>嗯，这篇文章大概就是这样了。希望我 2017 年能给 EFB 再写出一个模块。加油！</p>]]></content>
        
        <summary type="html">
            
            AbstractMy first submission to “Matrix”, a private product sharing platform built by SSPai (in zh-CN). This article introduces some of my r
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="Telegram"/>
        
        <category term="Matrix"/>
        
    </entry>
    
    <entry>
        <title>从 Material 主题学习开源项目管理的一点技巧</title>
        <link href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html"/>
        <id>https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-02-13T11:35:12+00:00</published>
        <updated>2017-02-13T11:35:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>我是我博客用的 Material 主题的 <code>collaborater</code> 之一。<a href="https://material.viosey.com" target="_blank">hexo-theme-material</a> 现在在 <a href="https://github.com/viosey/hexo-theme-material" target="_blank">Github</a> 有 <a href="https://github.com/viosey/hexo-theme-material/stargazers" target="_blank"><img src="https://img.shields.io/github/stars/viosey/hexo-theme-material.svg?style=flat-square" /></a> 和 <a href="https://github.com/viosey/hexo-theme-material" target="_blank"><img src="https://img.shields.io/github/contributors/viosey/hexo-theme-material.svg?style=flat-square" /></a>，即将成为 Hexo 上 star 数前三的主题。<br />现在我把我从参与这个主题里学到的开源项目的管理技巧分享出来给大家作为参考。</p><a></a><blockquote><p>本文的缩略图分别包含了 Material 主题的项目分支网络、图标，以及用主要贡献者的名字拼出来的 Material 字样。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html#Git"></a>Git</h1><p>首先，Material 主题是在 Github 上开源的，所以 Material 主题的版本管理系统自然是 Git 。<br />目前公认的是，Git 是目前、也是未来很长一段时间、甚至有可能永远的是世界上最先进的分布式版本管理系统。</p><blockquote><p>另一种著名的版本管理系统，SVN，世界上著名的集中式版本管理系统，也在向分布式发展。但可以预见的是，在未来的很长一段时间，SVN 依然不能撼动 Git 的分布式版本管理的地位。</p></blockquote><p>Git 的几大特点包括使用于分布式模式、可以记录每次文件的改动、可以实现协同开发、无需管理不同版本的不同文件。如果想查看某次改动，只需要检索日志即可。<br />下面提到的这些项目管理的技巧全部基于 Git 的特点。</p><h1><a href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html#Commit- 信息格式"></a>Commit 信息格式</h1><p>Git 的特点是可以记录你文件的往期动态改动记录。对于代码进行版本管理、代码追溯、质量管理时，检索 commit 日志是非常重要的。所以，如果你的 commit 信息是整齐和有条理的，那么就会方便很多。</p><p>（而且，如果你的 commit 信息记录整齐，那么别人对你的项目印象也会好很多。新来的人参与开发时，也能很快理清楚你过去的开发脉络，更好地融入开发）</p><p>我们的 commit 记录分别记录了提交的类型（新特性、修复还是重构）、改动部分（侧边栏、页脚、图标还是文章页面）和改动和目的。所以我们可以现在很轻松的进行 Code Review（以及精准地抓人来背锅），在发布新版本时也明确知道这个版本都干了什么。</p><blockquote><p>这是 <a href="https://github.com/viosey/typecho-theme-material" target="_blank">typecho-theme-material</a> 的 commit 日志记录。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000067.png" /></p><blockquote><p>之前只有 viosey 在开发，所有 commit 日志记录只有版本号，根本无法追溯哪一版本干了什么。后来我接坑了这个主题的开发，所以 commit 日志里简单写了这个提交干了什么。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000065.png" /></p><blockquote><p>到了开发 <a href="https://github.com/viosey/hexo-theme-material" target="_blank">hexo-theme-material</a> 时，我们从 <a href="https://github.com/viosey/hexo-theme-material/commit/40278ed1292e782cabaaec76b6d88d7a2ce8ac12" target="_blank"><code>40278ed1292e782cabaaec76b6d88d7a2ce8ac12</code></a> 开始使用了新的 commit 信息规范。这是之后的 commit 记录。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000066.png" /></p><p>想要知道我们的 commit 信息规范，可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Commit-message-format" target="_blank">hexo-theme-material - Contributing Wiki - Commit message format</a>，了解我们每一次 commit 记录的详细含义和规范。</p><h1><a href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html#Branches- 管理"></a>Branches 管理 </h1><p> 有的时候，我们不得不面临一点“危机”——新加的功能或者特性实在太过冒险，最后出了严重的问题。<br />虽然 Git 提供了 Revert 功能，可以方便的直接回归某条 commit 时的代码状态。但是有一点问题就是你之前的成果都被推倒。<br />如果不 Revert，那么在你一条条 commit 来修复 Bug 和 push 到远程仓库之前你云端的仓库上的代码都是有问题的，而且对别人的协同开发造成不必要的麻烦。</p><p>正确做法是把有风险和较大的改动都要新建一个分支进行管理，在新的分支里进行提交。当功能已经完善以后，把分支 Pull Rquest 合并回主分支。这样，就算其它分支改残了，主分支依然是合理和完美的。而且，不同的人协同开发时，可以尽量用不同的分支，互不冲突。</p><blockquote><p>从 <a href="https://github.com/viosey/hexo-theme-material/commit/7cd11ad840317991bdee7997bf66157634b17950" target="_blank"><code>7cd11ad840317991bdee7997bf66157634b17950</code></a> 开始，Material 主题的开发中，我们学习谷歌 Chrome，引入了 <code>canary</code> 的概念。在 Material 主题的仓库中，<code>master</code> 分支被高度保护，所有 PR 都必须经过 两个以上的项目参与者 Review 后才能入库，所以 <code>master</code> 分支是高度稳定的正式版本。以 <code>master</code> 为基础，我们 fork 出一份 <code>canary</code> 分支，用来存放所有未经过完善测试的代码。然后当需要作出较大改动或者重做一个新功能时，再以 <code>canary</code> 分支为基础 fork 一份新的分支进行开发，开发完毕以后再 Pull Request 合并回 <code>canary</code> 分支。当一定阶段的开发结束以后，会有项目参与者参与对 <code>canary</code> 分支的代码进行功能性测试。当验收完毕以后，<code>canary</code> 分支最后再会合并回 <code>master</code>。</p></blockquote><p>想要知道我们的 Branch 命名的含义，可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Branch-Name-Format" target="_blank">hexo-theme-material - Contributing Wiki - Branch Name Format</a>。</p><h1><a href="https://blog.nfz.moe/archives/how-to-manage-a-open-source-project-from-material.html# 更新日志"></a>更新日志 </h1><p> 当一个阶段的开发以后，我们就会推出更新日志。对于开发者，这是对过去一段时间自己开发的总结；对于用户，更新日志是他们了解你开发成果的渠道。<br />一个好的更新日志可以清楚地展现你这一段时间的成果，应该包括你修复的 Bug、你新增的 Feature、你做的改动。如果有必要，你还需要列出你的突破性变更（Breaking Changes，一般这类改动会改变用户过去的操作习惯、或者需要用户对其作出新的配置，以及其它包含不向下兼容的改动）。</p><blockquote><p>从 <a href="https://github.com/viosey/hexo-theme-material/releases/tag/1.2.5" target="_blank">1.2.5</a> 开始，Material 主题开始采用新的更新日志格式（灵感来自于我过去制作 ROM 写发包帖的经验）。然后 viosey 参考 <a href="https://github.com/angular/angular.js/blob/master/CHANGELOG.md" target="_blank">Angular Changelog</a> 完善了更新日志格式。我们用成熟了的更新日志格式发布了 <a href="https://github.com/viosey/hexo-theme-material/releases/tag/1.2.6" target="_blank">1.2.6</a>。</p></blockquote><p>如果想学习 Material 的更新日志规范，你可以阅读 <a href="https://github.com/viosey/hexo-theme-material/wiki/Change-log-format" target="_blank">hexo-theme-material - Contributing Wiki - Change log format</a>。</p>]]></content>
        
        <summary type="html">
            
            我是我博客用的 Material 主题的 collaborater 之一。hexo-theme-material 现在在 Github 有  和 ，即将成为 Hexo 上 star 数前三的主题。现在我把我从参与这个主题里学到的开源项目的管理技巧分享出来给大家作为参考。本文的缩
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="开源"/>
        
        <category term="项目管理"/>
        
        <category term="Git"/>
        
        <category term="GitHub"/>
        
    </entry>
    
    <entry>
        <title>是时候离开了——我眼中的酷安</title>
        <link href="https://blog.nfz.moe/archives/coolapk-in-my-mind.html"/>
        <id>https://blog.nfz.moe/archives/coolapk-in-my-mind.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-02-11T09:52:46+00:00</published>
        <updated>2017-02-11T09:52:46+00:00</updated>
        
        <content type="html"><![CDATA[<a></a><p>酷安曾经是一个很 Geek 的地方——至少过去是这样子的。酷安一开始就没有考虑做单纯的应用下载市场。<br />本来酷安在我眼里是一个大家可以自由交流的地方。大家都是高质量的 Android 玩家，人人都有两把刷子；用户可以和开发者自由互动，酷友可以和管理层相互玩笑，大家一起交流心得或者有 dalao 出来普及知识。。。</p><p>而如今呢？</p><p>一知半解的小白不懂装懂，深谙技巧的机油遭到排挤；开发者开始浮躁地追逐名利，在进步和在努力的却已经潜水不见；热心分享的酷友被迫删帖，打包党和病毒开始招摇过市；抄袭蔚然成风还受到庇护，维护开源和版权却遭到批判；当年叱咤风云的酷安大 V 逐渐离开，猖狂的小学生开始涌进酷安；用户对捐赠嗤之以鼻，对公益和慈善不屑一顾；使用盗版和破解版的人高高在上，坚持入正的酷友却遭到攻击；不负责任的开发者装着委屈，拒绝 HTTPS 的开发者傲然表示无所谓；收购神器拿来作恶的公司被打脸，没经历过历练的商业“团队”辱骂用户、主动下架了自己的作品。</p><blockquote><p>这一段概括了我经历过的酷安最近的几件大事，包括 <code>没有密码找回 </code>、<code> 柯震恶 </code>、<code>feemo</code> 等大 V 离开酷安，冰箱的开发者和破解者撕逼后潜水，美化版 QQ 分享被迫全部删帖，<code> 夜之浪子 </code> 暂停了他的搬运，<code> 绿色守护 </code> 被打包病毒，<code> 妮乎 </code> 不遵守开源协议抄袭，<code> 酷安小编 </code> 批判维护开源的酷友“过年吃饱了闲的”，几个宣称会黑服务器和抓包的“小学生”给妮哩招黑，<code> 奇葩小超 </code> 的 <code> 奇葩云 </code> 公益捐款被攻击，<code>xMIUI</code> 和 <code> 拾乐 </code> 发生的正版盗版之争，<code> 妮哩萌萌 </code> 用明文传输用户名和密码，<code> 一句 </code> 的开发者坚持 “HTTPS 无用论”，<code> 阻止运行 </code> 被 <code> 猎鹰网络 </code> 收购后种种丑态，<code> 花</code> 的开发团队辱骂用户、最后主动下架。</p></blockquote><p>不记得是阿酷还是小编说过，酷安就像一个社会，社会百态都会出现，所以管理层一直看淡撕逼。是的，酷安的确像一个小的社会。<br />去过隔壁乐园吗？去过葫芦侠三楼吗？我在那两个里面都逛过一圈。隔壁乐园被自欺欺人的用户和毫无意义的评论填满；葫芦侠三楼被不懂装懂、打包抄袭的猖狂小学生充斥。似乎任何一个社区，最终都会不可避免地要走这个道路，最后堕入深渊，比如现在的知乎和贴吧，比如葫芦侠和手机乐园，比如酷安。<br />酷安小编说过，“酷安一天产生上万条动态”、“难道酷安需要你们撕逼来拉流量？” 是的，酷安的确不需要；同样的，葫芦侠和乐园它们也都不需要。</p><p>不记得是哪位酷友说过，酷安本身没有变，是酷友们变了。然而，酷安的灵魂就在于那足够令酷安自豪的高质量的用户。现在用户和开发者像逃离沉船一样，从酷安流失出去。不知道会不会继续有高质量的用户加入酷友的大家庭，为酷安补充新鲜的血液。</p><p>我也无所谓再做所谓的普及和分享了。过去一个月以来我进行了两次清理、累计清理了 1100 多条动态；现在留下来 31 条动态，用来告诉大家，我至少在酷安存在过。</p><p>酷安其实在转变，酷安的用户也在转变。有的用户不适合新的酷安，就会离开，大家没必要太放在心上。</p><hr /><p>联系我的方式并没有改变。你们依旧可以在我的微博、我的博客、MAT BBS 上找得到我；我的 E-Mail、我的 Telegram、我的 QQ 也没有改变。我并不是从此杳无音信、无处可寻。<br />或许有那么一天，我还会回酷安看看，看看那个改变了我的 2016 年，也改变了我人生方向的那个酷安。</p>]]></content>
        
        <summary type="html">
            
            酷安曾经是一个很 Geek 的地方——至少过去是这样子的。酷安一开始就没有考虑做单纯的应用下载市场。本来酷安在我眼里是一个大家可以自由交流的地方。大家都是高质量的 Android 玩家，人人都有两把刷子；用户可以和开发者自由互动，酷友可以和管理层相互玩笑，大家一起交流心得或者有
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>EFB How-to: Send and Receive Messages from WeChat on Telegram (zh-CN)</title>
        <link href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/"/>
        <id>https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2017-02-05T16:00:37+00:00</published>
        <updated>2017-02-05T16:00:37+00:00</updated>
        
        <content type="html"><![CDATA[<h1><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#安装并使用-EFB：在-Telegram-收发微信消息"></a>安装并使用 EFB：在 Telegram 收发微信消息</h1><p><img src="https://images.1a23.com/di/PEBY/EFB-Blog.png" /></p>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#Abstract"></a>Abstract</h2><p>This article is a tutorial on how to install EH Forwarder Bot on a VPS server, with Telegram Master Channel and WeChat Slave Channel, alongside with simple exmaples of how to use it. Targeting WeChat power users in China, this article is written in Chinese (<code>zh-CN</code>). For installation manual in English, please visit <a href="https://ehforwarderbot.readthedocs.io/" target="_blank">the documentation</a>.</p>
<a></a>
<blockquote>
<p><strong>Update: 11 Jan 2017</strong><br />跟进了新版 Daemon 进程的启动方式。</p>
</blockquote>
<div><strong>注意！</strong><br />本教程基于 EFB v1.2 build 20170111 版本制作而成。目前最新版本为 <img src="https://img.shields.io/github/tag/blueset/ehforwarderbot.svg" />。<br />新版本的安装方式可能与旧版本不同。请参阅<a href="https://ehforwarderbot.readthedocs.io" target="_blank">官方文档</a>以获取最新安装说明。<br /></div>

<p><em>开发代号</em> EH Forwarder Bot（简称 EFB）是一个可扩展的聊天平台隧道框架，基于 Python 3。目前已内置了 Telegram 主端 (Master Channel) 和微信从端 (Slave Channel)，用来在 Telegram 收发微信消息。其他从端开发已在计划之中。同时 EFB 也配备了详尽的文档，欢迎有兴趣的朋友们开发自己的主端或从端，来支持更多的平台。EFB <a href="https://github.com/blueset/ehforwarderbot" target="_blank">在 GitHub 中开放了源代码</a>，并且<a href="https://ehforwarderbot.readthedocs.io" target="_blank">在 Read The Docs 平台上发布的开发文档</a>（英文，<code>en-US</code>）。</p>
<p>本文主要介绍了如何在一个虚拟服务器 (VPS) 中安装并配置 EFB、Telegram 主端和微信从端，以及如何使用 Telegram 主端来收发微信消息。</p>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x00-说明"></a>0x00: 说明</h2><ul>
<li>本文档基于 EFB v1.2 build 20170111 版本制作而成。较新的版本可能会有不同的安装步骤。敬请注意。</li>
<li>本教程面向具有一定背景知识的进阶用户，如有疑问，请您先在互联网上搜索（推荐 <a href="https://google.com" target="_blank">Google</a>），若仍未解决、欢迎在 <a href="https://telegram.me/efbsupport" target="_blank">EFB Telegram 支持群组</a>留言。</li>
</ul>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x01-用料"></a>0x01: 用料</h2><p>在开始之前，请准备：</p>
<ul>
<li>电脑 一台<br /><em>推荐 Linux、OS X、macOS 操作系统</em><br /><em>部分手机亦可使用，但操作会略微繁琐。</em></li>
<li>Telegram 账号 一枚</li>
<li>可用的科学上网方式 若干</li>
<li>Windows 用户需要 SSH 客户端 一枚，常用 <a href="http://www.putty.org/" target="_blank">PuTTY</a></li>
<li>墙外 VPS 一枚<br /><em>没有 VPS 的可以尝试一下 Vultr 日本，速度还不错，顺带可以搭梯子。<a href="http://www.vultr.com/?ref=6951220-3B" target="_blank">新用户赠送 $20 链接</a></em></li>
</ul>
<p><em>（才不是要假装菜谱呢）</em></p>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x02-构建环境"></a>0x02: 构建环境</h2><p>这里我们使用 Ubuntu 16.04 作为例子。CentOS、Arch 等其他发行版除去包管理器指令之外操作基本相同。（因为实在是不想再加钱开一个 VPS，所以下面的指令运行在同等版本的 Docker Image 上）</p>
<p>首先通过 SSH 客户端连接到你的 VPS。</p>
<h3><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x021-安装-Python-与非-Python-依赖"></a>0x021: 安装 Python 与非 Python 依赖</h3><p>输入以下指令。</p>
<p>注：以下安装的部分软件包可能已经预安装在你的系统中。但请注意将已安装的 Python 3 版本升级到 <strong>3.5 或以上</strong>。</p>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>sudo apt-get install python3.5 libopus0 ffmpeg libmagic1 python3-pip git nano</div></pre></td></tr></table>
<p><em>（怎么感觉包名这么奇怪呢，算了，大概这样吧，差也差不了太多。 ¯\_(ツ)_/¯）</em></p>
<h3><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x023-下载源码并安装-Python-依赖"></a>0x023: 下载源码并安装 Python 依赖</h3><table><tr><td><pre><div>1</div><div>2</div><div>3</div></pre></td><td><pre><div>git <span>clone</span> https://github.com/blueset/ehForwarderBot.git</div><div><span>cd</span> ehForwarderBot</div><div>pip3 install -r requirements.txt</div></pre></td></tr></table>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x03-配置-EFB"></a>0x03: 配置 EFB</h2><p>接下来就是进行各种必要的配置和初始化的步骤了。</p>
<h3><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x030-创建-Telegram-Bot"></a>0x030: 创建 Telegram Bot</h3><p>Telegram Bot 是 EFB（Telegram 主端）的出口，也是呈献给用户的渠道。我们在这里使用了 Telegram 官方的 Bot API，以最大化利用 Telegram Bot 所提供的各种便利功能。</p>
<p>要创建一个新的 Bot，要先向 <a href="https://telegram.me/botfather" target="_blank">@BotFather</a> 发起会话。发送指令 <code>/newbot</code> 以启动向导。期间，你需要指定这个 Bot 的名称与用户名（用户名必须以 <code>bot</code> 结尾）。完毕之后 @BotFather 会提供给你一个密钥（Token），妥善保存这个密钥。请注意，为保护您的隐私及信息安全，<strong>请不要向任何人提供你的 Bot 用户名及密钥，这可能导致聊天信息泄露等各种风险</strong>。</p>
<p>接下来还要对刚刚启用的 Bot 进行进一步的配置：允许 Bot 读取非指令信息、允许将 Bot 添加进群组、以及提供指令列表。</p>
<ul>
<li>发送 <code>/setprivacy</code> 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后选择 “Disable”.</li>
<li>发送 <code>/setjoingroups</code> 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后选择 “Enable”.</li>
<li>发送 <code>/setcommands</code> 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后发送如下内容：</li>
</ul>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div></pre></td><td><pre><div><span>link</span> - 将会话绑定到 Telegram 群组</div><div>chat - 生成会话头</div><div>recog - 回复语音消息以进行识别</div><div>extra - 获取更多功能</div></pre></td></tr></table>
<p>然后还需要获取你自己的 Telegram ID，ID 应显示为一串数字。获取你自己的 ID 有很多方式，你可以选择任意一种。下面介绍两种可能的方式。</p>
<ol>
<li><strong><a href="https://play.google.com/store/apps/details?id=org.telegram.plus" target="_blank">Plus Messenger</a></strong><br />如果你使用了 Plus Messenger 作为你的 Telegram 客户端，你可以直接打开你自己的资料页，在「自己」下面会显示你的 ID。</li>
<li><strong>通过 Bot 查询</strong><br />很多现存的 Bot 也提供了 ID 查询服务，直接向其发送特定的指令即可获得自己的数字 ID。在这里介绍一些接触过的。<ul>
<li><a href="https://t.me/get_id_bot" target="_blank">@get_id_bot</a> 发送 <code>/start</code></li>
<li><a href="https://t.me/xymbot" target="_blank">@XYMbot</a> 发送 <code>/whois</code></li>
<li><a href="https://t.me/mokubot" target="_blank">@mokubot</a> 发送 <code>/whoami</code></li>
<li><a href="https://t.me/groupbutler_bot" target="_blank">@GroupButler_Bot</a> 发送 <code>/id</code></li>
<li><a href="https://t.me/jackbot" target="_blank">@jackbot</a> 发送 <code>/me</code></li>
<li><a href="https://t.me/userinfobot" target="_blank">@userinfobot</a> 发送任意文字</li>
<li><a href="https://t.me/orzdigbot" target="_blank">@orzdigbot</a> 发送 <code>/user</code></li>
</ul>
</li>
</ol>
<p>留存你的 Telegram ID 以便后续使用。</p>
<h3><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x031-配置-EFB-和-Telegram-主端"></a>0x031: 配置 EFB 和 Telegram 主端</h3><p>这差不多就是安装过程的最后一步了。首先创建存储用文件夹并赋予其权限。回到 VPS 上 ehForwarderBot 目录。（不出意外的话你应该还在这个目录）</p>
<table><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>mkdir storage</div><div>chmod 777 storage</div></pre></td></tr></table>
<p>然后复制并编辑配置文件。</p>
<table><tr><td><pre><div>1</div><div>2</div></pre></td><td><pre><div>cp config.sample.py config.py</div><div>editor config.py</div></pre></td></tr></table>
<p>在配置文件中，<code>token</code> 后引号里面的内容替换为你之前获得的 Bot 密钥，<code>admins</code> 后方括号里面填入你自己的 Telegram ID。后面的 6 行是用来配置语音转文字功能的，不是必要功能，目前可以删除各行。如果有兴趣启用该功能的，请到各平台申请 API keys。详情请参见<a href="https://ehforwarderbot.readthedocs.io" target="_blank">文档</a> 的「ETM」章节。</p>
<blockquote>
<p><strong>注意</strong><br />配置文件 (<code>config.py</code>) 是一个 Python 文件。Python 文件有着严格的格式要求。在编辑该文档的时候请全程使用英文输入模式，并避免更改缩进。每一个括号和引号都应该在适当的地方合上。错误的格式会导致 EFB 运行失败。<br />本文件使用 4 个空格作为一个缩进级别并避免使用 Tab 字符。</p>
</blockquote>
<p>编辑好的结果应类似如下内容。<code>token</code> 和 <code>admins</code> 字段有所不同。</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div></pre></td><td><pre><div><span># ##############################</span></div><div><span>#  Configs for EH Forwarder Bot</span></div><div><span># ##############################</span></div><div><span>#</span></div><div><span>#  Basic settings</span></div><div><span># ----------------</span></div><div><span>#</span></div><div><span># Master/Slave Channels</span></div><div><span>#</span></div><div><span># Master channel:</span></div><div><span># The channel that is mainly used to view/manage messages</span></div><div><span># from slave channels.</span></div><div><span># Currently only 1 master channel is supported.</span></div><div><span>#</span></div><div><span># Slave channels:</span></div><div><span># Channels that are hosted on the server and being delivered</span></div><div><span># to and from the master channel.</span></div><div><span># You may have more than 1 slave channel.</span></div><div><span>#</span></div><div></div><div>master_channel = <span>'plugins.eh_telegram_master'</span>, <span>'TelegramChannel'</span></div><div>slave_channels = [(<span>'plugins.eh_wechat_slave'</span>, <span>'WeChatChannel'</span>)]</div><div></div><div><span>#</span></div><div><span>#  Plugin specific settings</span></div><div><span># --------------------------</span></div><div><span># Plugin specific settings should be written below in the format of:</span></div><div><span># `channel_name = {&quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;: &quot;value2&quot;}`</span></div><div><span># Please refer to docs of individual plugin for details</span></div><div><span>#</span></div><div></div><div>eh_telegram_master = {</div><div>    <span>&quot;token&quot;</span>: <span>&quot;12345678:QWFPGJLUYarstdheioZXCVBKM&quot;</span>,</div><div>    <span>&quot;admins&quot;</span>: [<span>123456789</span>]</div><div>}</div></pre></td></tr></table>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x04-启动-EFB"></a>0x04: 启动 EFB</h2><p>到目前为止，EFB 的配置工作已经完成。现在我们只需要启动它，登陆微信就大功告成了。大多数时候，启动微信需要扫描屏幕上的二维码进行授权。这时需要你的 SSH 客户端字体缩小到适当的大小以完整显示整个二维码。</p>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>python3 daemon.py start</div></pre></td></tr></table>
<p>扫描完成之后，手机上会显示「网页微信已登录」，这是因为 EFB 微信从端使用了网页版微信的接口。当终端显示：<code>Start auto replying.</code> 时，即代表登陆成功，这时候就可以按下 <code>Ctrl</code> + <code>C</code> 来隐藏输出了。</p>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x05-使用-EFB-Telegram-主端"></a>0x05: 使用 EFB Telegram 主端</h2><p>现在，在 Telegram 里面搜索你之前指定的 Bot 用户名，点击 Start（开始）即可开始与微信互通消息了。</p>
<p>在最初，所有来自微信的消息都会通过 Bot 直接发送给你，要回复其中的任意一条消息，你需要在 Telegram 中选中那条消息，选择 Reply（回复），再输入消息内容。</p>
<p>如果需要向新联系人发送消息，只需发送 <code>/chat</code> 指令，选择一个会话。之后这条消息就会变成一个「会话头」，回复这条消息就可以向指定的联系人或群组发送消息。</p>
<p>当消息过多时，来自不同会话的消息会使 Telegram 上面的会话混乱不堪。EFB 支持将来自指定会话的消息分流到一个 Telegram 群组中。</p>
<ul>
<li>在 Telegram 中新建一个空群组，并将你的 Bot 加入到这个群组中。<br />（如果找不到自己的 Bot，请尝试在桌面版中创建，并在添加成员时搜索 Bot 的用户名）</li>
<li>回到 Bot 会话，发送 <code>/link</code>，选择一个会话，并点击 “Link”</li>
<li>在弹出的列表中选择刚刚创建的空群组即可</li>
</ul>
<p>在绑定会话中，你可以像普通聊天一样直接发送消息。也可以通过指定回复的形式来 @ 其他人。</p>
<blockquote>
<p><strong>注意</strong><br />虽然 Telegram 群组中的所有人可以看到会话全文，但是<strong>只有</strong>配置文件 (<code>config.py</code>) 中指定的管理员 (<code>admins</code>) 能够以你的名义发送消息到微信。EFB 支持设置多个管理员，但只有第一个管理员（按照输入排序）能够接收到所有消息，而且这有可能造成不必要的隐私问题，敬请注意。</p>
</blockquote>
<p>以上就是 EFB Telegram 主端的基础用法。关于其他的功能（语音转文字、微信附加功能等）请参见<a href="https://ehforwarderbot.readthedocs.io" target="_blank">文档</a> 的「ETM」章节。</p>
<h2><a href="https://blog.1a23.com/2017/01/10/EFB-How-to-Send-and-Receive-Messages-from-WeChat-on-Telegram-zh-CN/#0x06-常见问题"></a>0x06: 常见问题</h2><p><strong>Q: EFB 微信从端稳定吗？</strong><br />只要保持<strong>微信手机版网络连接长期稳定</strong>，根据上游项目 ItChat 的统计，可长达数个月不掉线。</p>
<p><strong>Q: EFB 微信从端支持哪些类型的消息？</strong><br />A: EFB 微信从端理论上支持所有网页版微信支持的消息类型。即：</p>
<ul>
<li>微信→Telegram：文字、图片、视频、分享链接、表情、文档、位置、语音、名片、好友请求、系统通知</li>
<li>Telegram→微信：文字、图片、表情（以图片发送）、视频</li>
</ul>
<p>所以说，<strong>不支持红包、支付、朋友圈、转账、语音通话、视频聊天</strong>等网页版不支持的消息类型。</p>
<p><strong>Q: 有些表情收不到</strong><br />由于微信网页版的限制，部分受版权保护的表情包不能显示出来，故亦不能转发到 Telegram。</p>
<p><strong>Q: 偶尔会丢消息怎么办？</strong><br />这个是 Python 3 urllib3 的长时间网络连接出现的问题。上游项目 python-telegram-bot <a href="https://github.com/python-telegram-bot/python-telegram-bot/issues/364" target="_blank">已在着手解决这个问题</a>。预计在近期（2017 年 1 月）修复。</p>]]></content>
        
        <summary type="html">
            
            安装并使用 EFB：在 Telegram 收发微信消息 AbstractThis article is a tutorial on how to install EH Forwarder Bot on a VPS server, with Telegram Master Cha
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="EH Forwarder Bot"/>
        
        <category term="Telegram"/>
        
        <category term="WeChat"/>
        
        <category term="Tutorial"/>
        
    </entry>
    
    <entry>
        <title>Idea: Group Chat Tunneling (Sync) with EH Forwarder Bot</title>
        <link href="https://blog.1a23.com/2017/01/28/Idea-Group-Chat-Tunneling-Sync-with-EH-Forwarder-Bot/"/>
        <id>https://blog.1a23.com/2017/01/28/Idea-Group-Chat-Tunneling-Sync-with-EH-Forwarder-Bot/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2017-02-05T15:50:05+00:00</published>
        <updated>2017-02-05T15:50:05+00:00</updated>
        
        <content type="html"><![CDATA[<p>EH Forwarder Bot (EFB) is an extensible chat tunneling framework written in Python 3. <a href="https://github.com/blueset/ehForwarderBot" target="_blank">GitHub</a>.</p>
<p>EFB is mainly designed for gathering messages from many other platforms to the one platform, but also designed with other types of tunneling in mind. In this article, I’d like to introduce how EFB works now, and how to design <em>channels</em> for group chat tunneling with utilizing available channels in EFB. Here “group chat tunneling” means synchronizing messages across several groups in different platforms.</p>
<a></a>
<p>The classical model of EFB works like the following diagram:</p>
<p><img src="https://images.1a23.com/di/K96J/EFB-guide-0-0.png" /></p>
<p>Messages are collected and processed from slave channels, sent through the EFB framework to the master channel, and finally to the user. In order to ensure high compatibility among different platforms, the message is converted to the general <code>EFBMsg</code> object, parsed by respective channels, and then sent to the other platform by the respective channels.</p>
<p><img src="https://images.1a23.com/di/BP1T/EFB-guide-0-1.png" /></p>
<p>While for group chat tunneling, it’s a little bit different. When a message is sent from one channel, it should be delivered to all other channels, instead of just one on the other end. So, instead of having one chat platform as the master channel, we can have a specially designed module as the master channel, and let it process and dispatch messages.</p>
<p><img src="https://images.1a23.com/di/KQY4/EFB-guide-0-2.png" /></p>
<p>As we can see from the documentation, a master channel can get messages from slave channels and send messages to slave channels. Utilizing this feature, the “Group tunneling” master channel can fit the purpose of synchronizing messages among them.</p>
<p>A simple outline of the workflow of a slave channel can be like this:</p>
<ol>
<li>Slave channel collects message from the corresponding platform, parses it to an EFB Message object, and enqueue it to the global message queue</li>
<li>Group Tunneling Master (GTM) collects message from the global message queue, and attach the sender’s identifier to the message text.</li>
<li>GTM finds a list of corresponding slave channels and chats for it to deliver the message.</li>
<li>It collected through all the recipient slave channels for their supported message types, and check if the incoming message fits it.<ul>
<li>If the incoming message type does not fit into any of the recipient channels, the message is converted to the fallback messages type — text message, for consistent delivery.</li>
<li>For example, multimedia messages can be uploaded to servers, and a link to the corresponding file can be sent in a text message, with possibly some descriptions of the file (media type, file name, size, duration, MIME types, etc.)</li>
<li>Furthermore, you can also create a fallback message type tree while dealing with unsupported message types. A possible fallback tree is provided in the appendix.</li>
</ul>
</li>
<li>When all fallback mechanism is finished, GTM can now call the <code>send_message</code> method of each channel.</li>
<li>All recipient slave channels process and send messages to their platforms.</li>
</ol>
<h3><a href="https://blog.1a23.com/2017/01/28/Idea-Group-Chat-Tunneling-Sync-with-EH-Forwarder-Bot/#Admin-panel"></a>Admin panel</h3><p>Unlike other ordinary channels that interact with user through the chat platform, GTM does not directly interact with any chat platform, thus it has to build its own interface to interact with user, be it web, CLI or or native GUI (not recommended as most users run EFB on VPS where GUI is hardly found).</p>
<p>Examples of some features offered by the admin panel</p>
<ul>
<li>Tunneled chat grouping</li>
<li>Message type/sender filtering</li>
<li>Advanced filtering</li>
<li>Third-party media hosting</li>
<li>Fallback behaviors for un-tunneled chats</li>
</ul>
<p>Note that this is just a non-exhaustive list of possible features, you may always include any other feature that fits your need.</p>
<p>So this is just an idea, explaining one of the ways you can make a group chat tunnel with EFB framework. If you have any better idea, or you’ve met any issue in using or building with EFB, you’re always welcomed to comment below, or join the support group on Gitter or Telegram. (Links available in <a href="https://github.com/blueset/ehForwarderBot" target="_blank">GitHub Repo</a>).</p>
<h4><a href="https://blog.1a23.com/2017/01/28/Idea-Group-Chat-Tunneling-Sync-with-EH-Forwarder-Bot/#Appendix-A-possible-fallback-message-type-tree"></a>Appendix: A possible fallback message type tree</h4><p><img src="https://images.1a23.com/di/TR8S/EFB-guide-0-4.png" /></p>]]></content>
        
        <summary type="html">
            
            EH Forwarder Bot (EFB) is an extensible chat tunneling framework written in Python 3. GitHub. EFB is mainly designed for gathering messages
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="EH Forwarder Bot"/>
        
        <category term="Idea"/>
        
    </entry>
    
    <entry>
        <title>部署博客到 GitHub Pages &amp; Firebase</title>
        <link href="https://blog.poi.cat/deploy-blog-via-gh-pages-and-firebase"/>
        <id>https://blog.poi.cat/deploy-blog-via-gh-pages-and-firebase</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-02-05T13:57:17+00:00</published>
        <updated>2017-02-05T13:57:17+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>2017-02-09 更新: 新增了 Firebase 自定义域名部分</p></blockquote><h2>前言</h2><p>在上一篇里我介绍了我自己写的基于 Angular 的静态博客框架 Solomon。那么，在一个博客框架初步完成之后，下一步就是要实现博客部署。因为是静态博客，所以部署方面就省事了很多，只需要有免费静态页面搭建托管服务即可。这方面比较流行的是 <a href="https://pages.github.com/">GitHub Pages</a> ，此外 Google 新推出的 <a href="https://firebase.google.com/">Firebase</a> 也是不错的选择。不过显而易见的， Firebase 在国内的体验并不好，所以我这里只作为一个备用方案。</p><p>此外，为了避免每次更新博客都需要在有开发环境的电脑上进行，我还用了 <a href="https://travis-ci.org">Travis-CI</a> 以实现自动编译和自动部署。</p><h2>介绍</h2><p><strong>GitHub Pages</strong> 是 GitHub 推出的静态页面托管服务，可以选择 GitHub 提供的默认域名 github.io 或者是自定义域名。此外，GitHub Pages 还支持自动使用 Jekyll 生成网站。</p><blockquote><p>不过我的项目用的是 Angular ，只能直接部署 HTML 等纯静态文档了，这也是我下面选择用 Travis-CI 自动部署的原因。</p></blockquote><hr /><p><strong>Firebase</strong> 官网的介绍是：</p><blockquote><p>The tools and infrastructure you need to build better apps and grow successful businesses</p><p>构建更出色应用和成功地扩大业务所需的工具和基础架构</p></blockquote><p>简单的来说，Firebase 是一个帮助开发者构建移动应用的平台， Firebase 适用于 Android、iOS 和 Web 平台，它的功能包括 <a href="https://firebase.google.com/docs/analytics/">Firebase Analytics (用户分析的解决方案)</a>、 <a href="https://firebase.google.com/docs/database/">Realtime Database(实时数据库)</a>、 <a href="https://firebase.google.com/docs/auth/">Authentication(用户验证)</a>、 <a href="https://firebase.google.com/docs/cloud-messaging/">Cloud Messaging(云信息)</a> 等。</p><p>这里我们用到的是 Firebase 众多的功能的其中一种： <a href="https://firebase.google.com/docs/hosting/">Hosting(静态托管)</a> 。和 GitHub Pages 一样，Firebase 也提供默认域名 firebaseapp.com 和自定义域名。另外 Firebase Hosting 中内置了 SSL， 所以即使使用自定义域名也可以启用 HTTPS。</p><h2>初始化 &amp; 设置 &amp; 部署</h2><p>新建一个 GitHub Pages 的过程非常简单，只需要在你的 GitHub 上新建一个名为 <code>username.github.io</code> 的 repository。</p><blockquote><p>注意： <code>username</code> 部分必须和你的 GitHub Username 完全相同。</p></blockquote><p>然后你需要将你新建的 GitHub Pages 取回本地：</p><pre><code><span>$</span><span> git <span>clone</span> https://github.com/username/username.github.io</span>
</code></pre><p>将你的 HTML 等静态文件放进 <code>username.github.io</code>，接着运行</p><pre><code>$ git add .
$ git commit -m &quot;Initial commit&quot;
$ git push -u origin master
</code></pre><blockquote><p>还没有静态文件？运行</p><pre><code>$ echo '&lt;p&gt;Hello World!&lt;/p&gt;' &gt; index.html
</code></pre><p>生成一个吧！</p></blockquote><p>最后用浏览器打开 https://username.github.io 即可看到你的 GitHub Pages 已经部署好了。</p><hr /><p>相比 GitHub Pages，Firebase 的配置相对要繁琐一些，首先你需要登录到 Firebase 并在 Firebase Console 中新建一个 Project。</p><p><img src="https://c1.staticflickr.com/1/694/32723029306_743f988ba5_o.png" /></p><p>新建好 Project 之后，让我们转到命令行，运行如下的命令，分别安装 firebase 工具，登录到 firebasee 和初始化：</p><pre><code><span>$</span><span> npm install -g firebase-tools</span>
<span>$</span><span> firebase login</span>
<span>$</span><span> firebase init</span>
</code></pre><p><img src="https://c1.staticflickr.com/1/296/32723030316_1c948880d5_o.png" /></p><p>在初始化界面我们依次选择:</p><p>Hosting(托管) &gt; 你的项目的名字 &gt; 默认 &gt; 填写你的需要部署的文件夹的名字(Angular 项目默认是 <code>dist</code>) &gt; 默认</p><p><img src="https://c1.staticflickr.com/1/619/32723031336_cf21a7ca0e_o.png" /></p><p>完成设置之后，部署很简单了，只需要运行</p><pre><code>$ firebase deploy
</code></pre><p>即可部署到你的 firebase 上。</p><h2>自动编译</h2><p>尽管 GitHub Pages 和 Firebase 的部署都十分的简单：在本地生成文本后，只需要一行命令就可以部署。但是如我上面所说，有的时候如果我们身边没有配好开发环境的电脑的话，本地生成就成了大问题。</p><p>所幸，我们可以用 Travis-CI 提供的持续整合服务来实现自动编译和自动部署。</p><blockquote><p><strong>Travis-CI</strong> 名字中的 CI 指的是 <strong>Continuous integration</strong>(持续整合)，意思是在开发时只要有变更，就会 <strong>持续整合</strong> 进主线中。</p><p>要实现的自动整合，就需要有服务器持续的监听项目库的变化，发生变化 (例如 git commit) 时，自动运行测试和部署的脚本。</p><p>Travis-CI 提供分布式的持续集成服务，用于测试在 GitHub 上托管的代码。</p></blockquote><p>首先，登录到 Travis-CI 并且为项目开启自动编译：</p><p><img src="https://c1.staticflickr.com/1/620/32723031566_99ed10100b_o.png" /></p><p>然后，在我们的 Repo 中加入 <code>.travis.yml</code> 文件，用来描述编译的步骤。我的 <code>.travis.yml</code> 目前长这样：</p><pre><code>language: node_js
node_js:
  - &quot;6.1&quot;

branches:
  only:
    - master

before_script:
  - yarn
  - npm install -g firebase-tools
  - npm install -g angular-cli

script:
  - ng build --prod

after_success:
  - firebase deploy --token $FIREBASE_TOKEN
  - cd dist
  - git init
  - git config user.name &quot;PoiScript&quot;
  - git config user.email &quot;poiscript@gmail.com&quot;
  - git add .
  - git commit -m &quot;Committed via Travis-CI&quot;
  - git push -f -q https://PoiScript:$GITHUB_TOKEN@github.com/PoiScript/poiscript.github.io

notifications:
  email:
    on_failure: change
    on_success: change
</code></pre><p>简单的介绍一下各项配置：</p><ol><li><code>language</code>: 这里是定义你的语言，而且还可以规定你的语言的版本，例如这里是 node 6.1</li></ol><blockquote><p>选择语言版本的时候最好先到 <a href="https://docs.travis-ci.com/">Travis CI User Documentation</a> 里确定 Travis CI 是否提供。</p></blockquote><ol><li><p><code>before_script</code>: 在这里命令会在开始编译之前运行。由于我的项目用的是 yarn 所以这里我直接运行 yarn 命令安装依赖。然后我又用 npm 全局安装了 angular-cli 和 firebase-tools， 因为接下来的编译和部署会用到他们。</p></li><li><p><code>script</code>: 这里是编译的命令。<code>--prod</code> 表示生产模式。</p></li><li><p><code>after_success</code>: 这里放编译之后运行的代码，换言之就是部署的代码。具体的内容我们放到下面讲。</p></li></ol><p>写好 <code>.travis.yml</code> 之后，在之后的每一次更新里，Travis 都会帮你 clone 下来进行编译或测试。如果一切正常的话，Travis 的 Build 就会显示成 Passing。</p><h2>自动部署</h2><p>自动编译好了之后，接下来就需要 <strong>自动部署</strong> 了，为了安全起见我们当然不能直接把我的 GitHub 和 Google 密码交出去，所以我们需要 <strong>Token</strong> (令牌)。</p><p>GitHub 的 Token 是在 <a href="https://github.com/settings/tokens">Personal access tokens</a> 页面。点击 <strong>Generate New Token</strong> 之后输入这个 Token 描述(例如：Trvias-CI)，然后选择该 Token 的权限， 我们只选择一个 <strong>public_repo</strong> 。</p><p><img src="https://c1.staticflickr.com/1/664/32723032236_4dde625658_o.png" /></p><p>最后点击 <strong>Generate Token</strong> 之后，就会显示出我们生成好的 GitHub 的 Token 啦。</p><blockquote><p>注意 Personal access tokens 出现了之后要 <strong>立即复制</strong>，因为它只会出现一次。</p></blockquote><p>获得 Firebase 的 Token 则是需要在命令行里运行：</p><pre><code><span>$</span><span> firebase login:ci</span>
</code></pre><p><img src="https://c1.staticflickr.com/1/276/32723032766_5fcb4098d7_o.png" /></p><p>在浏览器里验证身份之后，就可以获得你的 Token 了。</p><p>那么 Token 应该怎么用呢？肯定是不能直接写到 <code>.travis.yml</code> 里的。所幸，Travis-CI 提供了 <strong>全局变量</strong> 的功能，在 Travis-CI 的设置界面里，我们把我们的 Token 填进去：</p><p><img src="https://c1.staticflickr.com/1/443/32723032906_3b93de2e49_o.png" /></p><p>然后在我们的就可以通过 <code>$GITHUB_TOKEN</code>，<code>$FIREBASE_TOKEN</code> 的方式获得我们的 Token 。而且如果你没有勾选 <strong>Display value in build log</strong> 的话，也不会显示在 log 里：</p><p><img src="https://c1.staticflickr.com/1/403/32764351145_e45e4c67b4_o.png" /></p><p>通过 Token 部署 Firebase 也是一样简单，只需要在 <code>after_success</code> 里添加：</p><pre><code>- firebase deploy --token $FIREBASE_TOKEN
</code></pre><p>部署到 GitHub 则是这么写:</p><pre><code>- cd dist
- git init
- git config user.name &quot;GIT_NAME&quot;
- git config user.email &quot;GIT_EMAIL&quot;
- git add .
- git commit -m &quot;Committed via Travis-CI&quot;
- git push -f -q https://username:$GITHUB_TOKEN@github.com/username/username.github.io
</code></pre><p>在 git push 的时候，切记要加上 <code>-q</code>，不然会显示出 URL 那么你的 Token 也就泄漏了。</p><h2>自定义域名</h2><p>上面提到过部署在 GitHub Pages 和 Firebase 之后，可以使用它们的默认域名 github.io 和 firebaseapp.com 。</p><p>GitHub Pages 就是 <strong>username.github.io</strong>，例如我的是 https://poiscript.github.io； Firebase 则是：<strong>项目名-编号.firebaseapp.com</strong>，像我这里的就是 https://solomon-c8973.firebaseapp.com。</p><p>Firebase 默认的域名很不好看对吧？ Google 分配怎么一个域名感觉就是逼人换域名一样，那么接下来我们就来换成我们自己的域名。</p><blockquote><p>Firebase 非常良心地为自定义域名也提供 SSL 证书 (Let's Encrypt)，而且 Firebase 也支持绑定到一级子域名，所以我建议有条件的都最好都绑定自己的域名。:)</p></blockquote><p>首先打开你的 Firebase Console，在侧边栏选择 Hosting ，然后你就可以在 Domain 这一项里看到你当前绑定的域名了。然后我们点击右上角的 Connect Domain 添加新域名：</p><p><img src="https://c2.staticflickr.com/4/3781/32674936951_c3561594f8_o.png" /></p><p>在框框里我们填入我们要添加的域名，可以使用最多一级子域名：</p><p><img src="https://c1.staticflickr.com/3/2617/32417677370_db4eed7f5b_o.png" /></p><blockquote><p>当然我们也可以选择将其重定向到我们其他的页面，例如把 <strong>fb</strong> 重定向到 <strong>firebase</strong> 等等。</p></blockquote><p>然后我们需要验证我们的域名的所有权，添加 A 记录到我们的域名的 DNS 上：</p><p><img src="https://c1.staticflickr.com/1/782/31983823993_e57d9f91ee_o.png" /></p><p>因为我这个域名是在 gandi 买的，用的也是 gandi 的 DNS，所以我接下来用 gandi 做演示。</p><p>登录之后，选择相应的域名，然后在 Zone Files 处选择 Change：</p><p><img src="https://c1.staticflickr.com/1/487/31983824193_a9fa324a0a_o.png" /></p><blockquote><p>如果你之前没有修改过默认的 Zone File 的话，需要点击上面的 Copy to edit，生成一份新的 Zone File，因为默认的 Zone File 是不可编辑的。</p><p><img src="https://c1.staticflickr.com/3/2298/31983824553_d49a5b6abd_o.png" /></p></blockquote><p>然后你需要选择一个未被使用的或者新建一个 Version ，因为正在使用的 Version 也是不可修改的：</p><p><img src="https://c1.staticflickr.com/3/2525/31983827113_f481a91585_o.png" /></p><p>接下来点击 Add 添加记录：</p><p><img src="https://c1.staticflickr.com/3/2565/31983824783_43b1254d4c_b.jpg" /></p><p>添加完之后，确认自己使用了 <strong>正确的 Zone File</strong> 和 <strong>正确的 Version</strong> 之后就算设置完了，接下来等一会确保 DNS 更新之后就可以返回之前 Firebase 的页面点击 <strong>Verfiy</strong> 了。</p><p>最后一步需要你添加一个 TXT 记录。(抱歉没有截到图)</p><p>我们继续编辑 Zone File，添加一个这样的 TXT 记录：</p><p><img src="https://c1.staticflickr.com/3/2235/31983825073_796fb53c98_o.png" /></p><blockquote><p>注意 <code>Name</code> 为 <code>@</code> ； <code>Value</code> 为 <strong>Firebase 提供给你的</strong>，前后需要加上 <strong>双引号</strong>。</p></blockquote><p>然后我们就设置完啦，只需要再等一会，等到 Firebase Console 界面显示 <strong>Connected</strong> 就表示我们的自定义域名已经成功部署了。</p><p><img src="https://c2.staticflickr.com/4/3814/31983825243_617e8257a7_o.png" /></p>]]></content>
        
        <summary type="html">
            
            2017-02-09 更新: 新增了 Firebase 自定义域名部分前言在上一篇里我介绍了我自己写的基于 Angular 的静态博客框架 Solomon。那么，在一个博客框架初步完成之后，下一步就是要实现博客部署。因为是静态博客，所以部署方面就省事了很多，只需要有免费静态页面
            
        </summary>
        
        <category term="angular"/>
        
        <category term="firebase"/>
        
        <category term="github"/>
        
    </entry>
    
    <entry>
        <title>注册Let’s Encrypt证书并开启全站HTTPS</title>
        <link href="https://blog.lirici.moe/archives/38/"/>
        <id>https://blog.lirici.moe/archives/38/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-02-05T01:39:00+00:00</published>
        <updated>2017-02-05T01:39:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/3377444093.png" /></p>
<blockquote>
<p>首先我们先了解一下什么是Let’s Encrypt</p>
</blockquote>
<p>Let’s Encrypt is a free, automated, and open certificate authority brought to you by the non-profit Internet Security Research Group (ISRG).<br />
<a href="https://letsencrypt.org/">Let’s Encrypt</a> 是一个于2015年三季度推出的数字证书认证机构，将通过旨在消除当前手动创建和安装证书的复杂过程的自动化流程，为安全网站提供免费的SSL/TLS证书。</p>
<blockquote>
<p>什么是HTTPS？</p>
</blockquote>
<p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司(Netscape)进行，并内置于其浏览器Netscape Navigator中，提供了身份验证与加密通讯方法。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。</p>
<blockquote>
<p>本文介绍的是如何在Nginx下注册安装Let’s Encrypt证书</p>
<p>我使用的是<a href="https://lnmp.org/">LNMP一键安装包</a></p>
</blockquote>
<pre><code>yum install screen
screen -S lnmp
wget -c http://soft.vpser.net/lnmp/lnmp1.3-full.tar.gz &amp;&amp; tar zxf lnmp1.3-full.tar.gz &amp;&amp; cd lnmp1.3-full &amp;&amp; ./install.sh lnmp</code></pre>
<blockquote>
<p>1.首先安装git</p>
</blockquote>
<pre><code>yum install git</code></pre>
<blockquote>
<p>2.安装Let’s Encrypt</p>
</blockquote>
<pre><code>git clone https://github.com/letsencrypt/letsencrypt
cd letsencrypt</code></pre>
<p><strong>先结束Nginx进程再配置证书</strong></p>
<pre><code>service nginx stop
./letsencrypt-auto certonly --standalone -d 你要申请的域名 -d你要申请的域名</code></pre>
<p>-d之后是你要申请证书的对应的子域名，多个子域名可以往后加，运行完后会提示你的证书和密钥保存在/etc/letsencrypt/live/下</p>
<pre><code>启动Nginx
service nginx start</code></pre>
<blockquote>
<p>最后配置Nginx</p>
</blockquote>
<p>修改usr/local/nginx/nginx.conf或usr/local/nginx/conf/yourdomain.conf文件<br />
重写server段,主要是第二个server块的ssl部分，注意你的证书路径</p>
<pre><code>server
    {
        listen 80;
        #listen [::]:80;
        server_name blog.lirici.moe;
        rewrite ^(.*) https://$server_name$1 permanent;
        index index.html index.htm index.php default.html default.htm default.php;
        root  /home/wwwroot/blog.lirici.moe;
    }

server
    {
        server_name blog.lirici.moe;
        listen 443 ssl;
        index index.html index.htm index.php;
        root  /home/wwwroot/blog.seele.tech;

        include typecho.conf;
        #error_page   404   /404.html;

        ssl_certificate /etc/letsencrypt/live/www.lirici.moe/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/www.lirici.moe/privkey.pem;
        ssl_session_timeout 1d;
        ssl_session_cache shared:SSL:50m;
        ssl_session_tickets off;
        ssl_protocols TLSv1.2;
        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';
        ssl_prefer_server_ciphers on;

        add_header Strict-Transport-Security max-age=15768000;

        location ~ [^/]\.php(/|$)
        {
            # comment try_files $uri =404; to enable pathinfo
            #try_files $uri =404;
            fastcgi_pass  unix:/tmp/php-cgi.sock;
            fastcgi_index index.php;
            include fastcgi.conf;
            include pathinfo.conf;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        access_log  /home/wwwlogs/blog.lirici.moe.log  access;
    }</code></pre>
<p><strong>大致是这样，当然你不可能照搬我的配置</strong><del>如果你不怕你的网站boom的话</del><br />
如果还有问题就在下面留言吧</p>]]></content>
        
        <summary type="html">
            
              首先我们先了解一下什么是Let’s Encrypt  Let’s Encrypt is a free, automated, and open certificate authority brought to you by the non-profit Internet S
            
        </summary>
        
    </entry>
    
    <entry>
        <title>记弃用多说牵扯出来的一堆坑</title>
        <link href="https://blog.lwl12.com/read/abandon-duoshuo-hole-log.html"/>
        <id>https://blog.lwl12.com/read/abandon-duoshuo-hole-log.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-02-03T17:32:39+00:00</published>
        <updated>2017-02-03T17:32:39+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/abandon-duoshuo-hole-log.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/02/DS201704011756.png" /></a></p><p>由于多说近期极不稳定而且严重影响站点加载速度，最终咱还是把多说撤了。</p>
<p>于是因此扯出来了一堆坑……</p>
<p><span></span></p>
<p>先送歌单，鉴于最近有人说自动播放不太友好咱就不设置自动播放喽，不过我还是觉得听歌比较带感啊←_←</p>
<div></div>
<h3>总览</h3>
<p>“关插件一时爽，DEBUG火葬场。” 这句话也许最能体现这几天的情况。<br />
在撤出多说评论后，lwl与朋友们 （如 @fly @kn007 @ClassicOldSong @Bing ）一起工作了三天时间，最后解决了如下几个问题集合<br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/02/photo_2017-02-04_00-31-29.jpg" /></p>
<ul>
<li>撤除多说后的回复以及审核通知</li>
<li>主题原生评论与强行加上去的 Ajax Load Page 功能的兼容性问题</li>
<li>多说带来的历史遗留问题</li>
</ul>
<p> </p>
<p>其中前两点调试过程各位可以移步<a href="https://blog.lwl12.com/guestbook" target="_blank">留言板</a>感受一下，然后应该就能有个大概的了解了 🙂</p>
<p>这篇文章主要是摘取几点我觉得各位也有可能遇到的问题讲讲解决方案，所以牢骚在前面发完，下面直接开始 show code.</p>
<p> </p>
<p> </p>
<h3>关于使用多说期间 User-Agent 数据的回写</h3>
<p>多说的 WordPress 插件众所周知是有一个自动往本地数据库回写的功能的，也是这个功能让不少站长很开心的入了坑。然而有一个比较坑的地方是，这个回写并不会把正确的 User-Agent 写到本地数据库，而是用一个 “Duoshuo/1.2:0000000000000000000” 这样的字符串来代替。所以如果你把多说给撤了，那么不做处理的话这些 UA 数据就是相当于丢了。</p>
<p>啊我当然不可能允许这种事发生喽，所以写了一个 Python 程序来解决这个问题。</p>
<pre><code>#!/usr/bin/python
# -*- coding: UTF-8 -*-

import sys
import MySQLdb
import requests
import json

reload(sys)
sys.setdefaultencoding('utf-8')

import requests

url = &quot;https://你的多说管理后台前缀.duoshuo.com/api/posts/list.json&quot;

querystring = {&quot;order&quot;: &quot;asc&quot;, &quot;max_depth&quot;: &quot;0&quot;,
               &quot;limit&quot;: &quot;你的总计评论数再往上加个几百保险就差不多&quot;, &quot;nonce&quot;: &quot;请自行查找本参数&quot;}

headers = {
    'cookie': &quot;duoshuo_unique=这个值……别告诉我你不会找cookie&quot;
}

response = requests.request(&quot;GET&quot;, url, headers=headers, params=querystring)
replydata = json.loads(response.text)[&quot;parentPosts&quot;]

# 打开数据库连接
db = MySQLdb.connect(&quot;数据库链接地址&quot;, &quot;用户名&quot;, &quot;密码&quot;,
                     &quot;wordpress所在库名&quot;, charset='utf8')
# 使用cursor()方法获取操作游标
cursor = db.cursor()

#如果你更改了wordpress默认表前缀，请务必修改以下的表名 wp_comments 
sql = &quot;SELECT `comment_ID`,`comment_agent` FROM `wp_comments` WHERE `comment_agent` LIKE 'duoshuo%'&quot;
cursor.execute(sql)
results = cursor.fetchall()
for row in results:
    dsid = row[1].split(&quot;:&quot;)[1]
    print str(dsid)
    print str(row[0])
    try:
        if replydata[dsid][&quot;agent&quot;]:
            print replydata[dsid][&quot;agent&quot;]
            try:
                cursor.execute(&quot;UPDATE `wp_comments` SET `comment_agent` = '&quot; + replydata[dsid][
                               &quot;agent&quot;] + &quot;' WHERE `wp_comments`.`comment_ID` = &quot; + str(row[0]) + &quot;;&quot;)
            except BaseException as x:
                print x
                db.rollback()
                exit()
    except BaseException as e:
        print e


try:
    db.commit()
except BaseException as e:
    print e
    db.rollback()
    exit()

# 关闭数据库连接
db.close()
</code></pre>
<p>以上代码里参数 nonce 的查找方法是，用 Chrome 打开 https://你站点多说域名/admin/approved/ ，打开开发者工具，切换到network选项卡，在搜索框里写上“list”然后刷新，接着左边栏应该会有一个list.json的文件，点击并在打开的右栏完整url里找到nonce参数复制到代码里即可。</p>
<p>至于其他的修改点我都一并写代码里了，使用的时候记得注意替换，如果代码执行有问题也别在评论区问（雾）</p>
<h3>评论通知</h3>
<p>其实这个大家应该都很清楚我采用的解决方案了呢，显然还是用邮件……但是现在的各类评论回复插件都不是很满足我的需求。所以咱和 @kn007 一起重新改（luan）写了一个评论回复与通过审核的通知函数。具体函数我就不贴了，这次重写主要就做了这三件微小的事情：</p>
<ul>
<li>对纯文本版本+HTML版本的多版本邮件做了一个支持</li>
<li>用一个和反正你现在在网上找不着的方法强制限定了 WordPress 的发件人（也就是 From: ) 信息</li>
<li>用一个还凑合的方法解决了 Gmail 在合并会话的时候自动识别重复内容然后强行加 <span> 破坏邮件结构的问题</span></li>
</ul>
<p>很惭愧。</p>
<p>其中前两点我使用了一个似乎比较偏门的 WordPress Action 挂载点 phpmailer_init，从而比较好的绕过了整个<del>一点用都没有辣鸡的不行七年前的BUG还留着</del>的WP_MAIL函数来做一些高级修改。这里就直接简单的贴一下代码（虽然写的时候并不简单（可能是因为我不是菊苣））。</p>
<p>多版本邮件：这个功能主要是因为我和 kn 都是使用的自建邮件服务器（这里面门道也不少，回头可能有空出一篇文章单独说说），为了保证到信率而且同时给收件人那边体验好一点。代码如下</p>
<pre><code>//Hook phpmailer init action, then force change message_type to alt.
global $phpmailer;
add_action('phpmailer_init', function (&amp;$phpmailer) use ($message_html, $message_plain) {
    $phpmailer-&gt;isHTML(true);
    $phpmailer-&gt;Body = $message_html;
    $phpmailer-&gt;AltBody = $message_plain;
    $phpmailer-&gt;CharSet = 'utf-8';
    $phpmailer-&gt;Encoding = 'base64';
});
wp_mail(&quot;$parent_comment_author &lt;$to&gt;&quot;, $subject, $message_html, $headers); //There &lt;$message_html&gt; is just for backup, you can't change content after add_action().
</code></pre>
<p>其实原理也是非常的简单，这个 action 在 WP_MAIL 里被执行的位置是发送函数的前一句，所以通过这个点插进去直接操作比 WP_MAIL 强大的多的 phpmailer 就能够实现很多高级功能。使用这个代码之后正如注释所述，实际上向 WP_MAIL 函数传递的内容就不重要了，最终是通过上方代码直接重新赋给 phpmailer 的内容进行发送。</p>
<p>这段代码是单独从完整函数里拎出来的，所以你并不能直接使用它，如果要用的话按照这个代码改改应该差不多也能用……总之可以自己钻研一下啦，这里只是介绍一下有这么个方法。</p>
<p>限定发件人这个就更简单了，强行限定的原因是因为我用 WordPress 自带的几个 filter 发现根本不管用啊，所以没办法只好用暴力一点的方案解决问题了。这个代码是可以直接用的，你改改地址扔你主题的 function.php 里就行。</p>
<pre><code>global $phpmailer;
add_action('phpmailer_init', function (&amp;$phpmailer) {
   $phpmailer-&gt;From = &quot;期待的发送邮箱地址&quot;;
   $phpmailer-&gt;FromName = &quot;发件人名称&quot;;
});
</code></pre>
<p>第三点 Gmail 这件事，是一个坑…… 可劲折腾了大概有一天之后才发现具体原因。</p>
<p>在 Gmail/Inbox 当中，会自动将主题相同的邮件合并成一个会话。当然你合并没关系，只是它们会自动将后续邮件内容和前序邮件比对，如果有内容相同的行，就加上一个样式（在 Gmail 里是变紫，在 Inbox 里更惨，会加一个折叠按钮……而且严重破坏邮件结构）</p>
<p>很好，现在知道问题了，然而尝试了很久也没办法优雅的绕过，只能用了一个土方法。我们在邮件可能重复的每一行后面加上了一个 display:none 而且颜色设置和背景一致的 span，在span里放上一个随机的五位代码，从而干扰自动检测。这个方法在本站用着挺舒服的，也没出啥问题，根本看不出来。然而 kn 的站有点小尴尬，他的站邮件前面内容太少了于是在某些客户端里显示预览（忽略html）的时候直接把干扰码显示出来……所以……是……土方法……嘛……（逃</p>
<h3>历史遗留问题？</h3>
<p>其实这个也没什么，就是之前多说评论启用了表情，然后之前 HTTPS 代理替换原 url 的操作是在 js 里操作的，多说下掉之后原有的表情就全变成 http 导致我可爱的小绿锁和安全标志掉了。如果你也有一个 https 图片反代的话，将下列代码放入正在使用主题的 function.php 中即可解决问题</p>
<pre><code>function comment_pic_https($commentdata)
{
    return preg_replace('/src=([&quot;|\'])http:\/\//', 'src=&quot;//Your_Proxy_Url/http://', $commentdata);
}
add_filter('comment_text', 'comment_pic_https');
});
</code></pre>
<p>那么这篇文章就到这里了，咱先睡觉去了…… 最后祝你身体健康（逃</p>
<p>（本来自动播放的时候应该放在这的播放器，啊放前面好丑啊）</p>
<p>-EOF-</p>]]></content>
        
        <summary type="html">
            
            由于多说近期极不稳定而且严重影响站点加载速度，最终咱还是把多说撤了。 于是因此扯出来了一堆坑……  先送歌单，鉴于最近有人说自动播放不太友好咱就不设置自动播放喽，不过我还是觉得听歌比较带感啊←_←  总览 “关插件一时爽，DEBUG火葬场。” 这句话也许最能体现这几天的情况。 
            
        </summary>
        
        <category term="程序"/>
        
        <category term="网站"/>
        
        <category term="Code"/>
        
        <category term="Mail"/>
        
        <category term="Python"/>
        
        <category term="多说"/>
        
    </entry>
    
    <entry>
        <title>为什么安装 Xposed 以后会导致卡顿</title>
        <link href="https://blog.nfz.moe/archives/why-xposed-cause-unsmooth-exprience.html"/>
        <id>https://blog.nfz.moe/archives/why-xposed-cause-unsmooth-exprience.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-02-01T15:55:12+00:00</published>
        <updated>2017-02-01T15:55:12+00:00</updated>
        
        <content type="html"><![CDATA[<p>经常有人说 Xposed 会带来卡顿的操作体验，甚至会引起掉帧等糟糕的后果。所以我再一次阅读完 Xposed  的文档以后，希望能用 <strong> 通俗的方式 </strong> 做一个回答。</p><a></a><p>Xposed 的工作原理我在 <a href="https://blog.neofelhz.space/archives/forcestopgb-lieying-brevent.html" target="_blank">《阻止运行、猎鹰网络、黑域 始末》</a> 一文中介绍 Xposed Moudule 的权限时做了简单介绍。这里我再详细地说一遍：</p><blockquote><p>Xposed 的工作原理是通过替换或劫持 <code>/system/bin/app_process</code> 控制 <code>zygote</code>（而 <code>zygote</code> 孵化了所有应用的进程，可以形象地称之为“进程之母”），使 <code>app_process</code> 在启动过程中加载 Xposed 的重要部分 <code>XposedBridge.jar</code>，这一段 Java 包含了所有的劫持方法，从而完成对 <code>Zygote</code> 进程及其创建的 <code>Dalvik 虚拟机</code> 的劫持，Xposed 在开机的时候利用 <code>XposedBridge.jar</code> 完成在原 Function 执行的前后加上自定义代码的操作，从而完成所有的 Hook Functions。</p></blockquote><p>在 Android L 时，Xposed 是通过劫持 <code>app_process</code> 来达到 hook 的目的。到了 Android M，谷歌再一次加强了系统安全性，加强了对系统底层（主要是框架 framework）的封装。所以为了实现 hook，就不得不修改 ART（Android Run Time，Android 虚拟机执行进程的方式），从而对 app_process 提供接口。这就是为什么当时 Android L 和 M 的 Xposed 憋了老久才放出来的原因。当然这一次 Android N 的 Xposed 迟迟不出来原因主要是系统安全性的增强和由于系统分区加固而可能需要另辟蹊径 Systemless 的缘故。</p><p>说了这么多，还没有说 <code>hook</code> 是什么东西。<code>hook</code>，钩子的意思。那么这个钩子拿来钩什么东西？（反正不是鱼）实际上，钩子钩的是资源，进程调用的资源。让系统本来从 APP 中读取的资源重定向到第三方的模块，这样就实现了在不修改 APP 的情况下实现了对系统资源、APP 资源的替换！从 Zygote 产生出进程开始就已经完成了劫持。这里就和模块有关了。Xposed 提供了一系列钩子，这些钩子就是接口。开发 Xposed 模块的开发者只需要找到需要替换的资源、框架，用 Xposed 的钩子实现替换即可。</p><blockquote><p>为什么钩子可以实现这个？因为 APK 在运行时会进入虚拟机（Dalvik 或者 ART），然而你在虚拟机里面劫持了原本的 Java API，制作了一个新的可供操作的 API，当然可以实现资源替换、字节码替换了。</p></blockquote><p>那么 Xposed 到底消耗不消耗系统的性能？</p><p>Android L 以后，Xposed 会在标准的运行 <code>zygote</code> 进程的基础上制作一个新的 带有 Xpsed API 的 运行环境。所以在没有用到 Xposed 的地方，原来怎么运行的程序依然按原来的方式运行。Xposed 只有在应用启动时会根据钩子执行一些替换工作。这部分执行得是非常快的，所以你是不会意识到应用启动速度的差别的，而且这部分占用的内存是很少的。这就是为什么一些改动需要重启才能生效的原因了。所以说，单纯刷入 Xposed，是并不会引起系统卡顿的。</p><p>那么为什么 Xposed 会使用户觉得卡顿了呢？当 hook 没有启用时，系统是几乎无影响的。但是你一旦安装了模块以后，hook 开始发挥作用，然后开始替换系统资源为模块自己的代码（排除流氓终结者、核心破解、XPrivacy 这类仅仅篡改了返回值的模块），比如重力工具箱要 hook 系统 Framework 和 SystemUI 的资源。而且，重力工具箱要修改的地方要更底层一些，这样才能实现不重启实时完成切换切换并生效（XnubiaUI 模块，相当于 nubiaUI 上的重力工具箱，也是对 nubiaUI 的功能、界面进行调整的 Xposed 模块，它就没有做实时生效）。在这样的设计中，相当于一次要启用大量钩子随时调用，那么在 UI 层面就有大量改动需要用到钩子。于是在这些调用中，执行速度受到了一些影响。</p><hr /><p>总结：单单安装 Xposed 是不会引起卡顿的，影响运行速度的并不是完全在于模块多少。是否影响卡顿取决于模块的功能本身，越需要经常 hook 替换资源的模块、需要替换大量资源的模块、hook 越接近系统底层的模块，最容易拖慢运行速度。此外，模块的功能实现设计、代码写得是否优雅等，都会影响到运行速度。此外，在目前富余的性能配置面前，Xposed 带来的系统卡顿固然不可忽略，但是一般人感觉是不会太明显的。更何况，在国内 BAT 毒瘤滥用广播接收器、毒瘤后台服务面前，我们还是使用 Xposed 模块来镇压毒瘤显得更为合适——不然造成的卡顿不是 Xposed Hook 所能够比拟的。</p>]]></content>
        
        <summary type="html">
            
            经常有人说 Xposed 会带来卡顿的操作体验，甚至会引起掉帧等糟糕的后果。所以我再一次阅读完 Xposed  的文档以后，希望能用  通俗的方式  做一个回答。Xposed 的工作原理我在 《阻止运行、猎鹰网络、黑域 始末》 一文中介绍 Xposed Moudule 的权限时
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Android"/>
        
        <category term="Xposed"/>
        
        <category term="卡顿"/>
        
    </entry>
    
    <entry>
        <title>Meting for Typecho 发布</title>
        <link href="https://i-meto.com/meting-typecho/"/>
        <id>https://i-meto.com/meting-typecho/</id>
        
        <author>
            <name>meto</name>
        </author>
        
        <published>2017-01-28T22:33:07+00:00</published>
        <updated>2017-01-28T22:33:07+00:00</updated>
        
        <content type="html"><![CDATA[<div><div></div>
<img src="https://ws2.sinaimg.cn/large/a15b4afegy1fc6ok5m453j22bc1ji47p" /><p>Aplayer 和 Meting 的碰撞，一个简单强大的 Typecho 音乐播放器就此诞生！</p>
<h3>下载</h3>
<ul>
<li>开源地址 <a href="https://github.com/MoePlayer/APlayer-Typecho">https://github.com/MoePlayer/APlayer-Typecho</a></li>
</ul>
<h3>更新日志</h3>
<ul>
<li><a href="https://github.com/MoePlayer/APlayer-Typecho/archive/v2.1.2.zip">2.1.2.zip</a>
<ul>
<li><strong>热插拔式的缓存系统</strong></li>
<li>支持全新 APlayer 1.7</li>
</ul>
</li>
<li><a href="https://github.com/MoePlayer/APlayer-Typecho/archive/v2.1.0.zip">2.1.0.zip</a>
<ul>
<li><strong>新增后台差量更新功能</strong></li>
<li>由 Meting 1.5 驱动的全新 API</li>
</ul>
</li>
<li><a href="https://github.com/MoePlayer/APlayer-Typecho/archive/v2.0.5.zip">2.0.5.zip</a>
<ul>
<li>修复网易云音乐的播放问题(再次)</li>
</ul>
</li>
<li><a href="https://github.com/MoePlayer/APlayer-Typecho/archive/v2.0.4.zip">2.0.4.zip</a>
<ul>
<li>修复网易云音乐的播放问题</li>
</ul>
</li>
<li><a href="https://github.com/MoePlayer/APlayer-Typecho/archive/v2.0.3.zip">2.0.3.zip</a>
<ul>
<li>重写了整个框架，效率更高，兼容性更棒</li>
<li>支持第三方 API 接口</li>
</ul>
</li>
</ul>
<h3>安装</h3>
<ol>
<li>下载压缩包</li>
<li>解压后上传到 /usr/plugins 目录</li>
<li><strong>修改文件夹名为 Meting</strong></li>
<li>后台启用插件</li>
</ol>
<h3>特性</h3>
<ul>
<li>支持国内五大音乐平台（网易云、QQ、虾米、百度、酷狗）的单曲/专辑/歌单/歌手热门播放</li>
<li>更新迅速，同步 Aplayer 和 Meting 的更新支持</li>
<li>简单易用，后台自动解析 URL 为可识别代码</li>
<li>与 Markdown 完全兼容</li>
</ul>
<h3>使用</h3>
<p>在文章编辑页面三键即可添加完毕<br />
<img src="https://ws2.sinaimg.cn/large/a15b4afegy1fc6p4tlrw2j218b0nlwjk" /><br />
详细支持列表请直接戳 Github 查看<br />
<a href="https://github.com/metowolf/Meting-Typecho-Plugin#%E6%94%AF%E6%8C%81%E5%88%97%E8%A1%A8">https://github.com/metowolf/Meting-Typecho-Plugin</a></p>
<h3>高级</h3>
<pre><code>[Meting autoplay=&quot;false&quot; order=&quot;random&quot; theme=&quot;red&quot;]
[Music server=&quot;kugou&quot; id=&quot;119859&quot; type=&quot;playlist&quot;/]
[/Meting]
</code></pre>
<p>在第一个 Meting 标签内可以手动添加高级属性</p>
<p>支持参数说明</p>
<ul>
<li>autoplay
<ul>
<li>true 自动播放</li>
<li><strong>false 不自动播放</strong></li>
</ul>
</li>
<li>order
<ul>
<li>random 随机播放</li>
<li><strong>list 列表单次</strong></li>
</ul>
</li>
<li>theme
<ul>
<li><code>#b7daff</code> 十六进制颜色代码</li>
<li>red 英文名称</li>
</ul>
</li>
</ul>
<h3>鸣谢</h3>
<table>
<thead><tr><th>项目</th><th>作者</th><th>说明</th></tr></thead>
<tbody>
<tr>
  <td><a href="https://github.com/DIYgod/APlayer">APlayer</a></td>
  <td>DIYgod</td>
  <td>a beautiful HTML5 music player</td>
</tr>
<tr>
  <td><a href="https://github.com/metowolf/MetingJS">MetingJS</a></td>
  <td>metowolf</td>
  <td>打通 APlayer 与 Meting 的桥梁</td>
</tr>
<tr>
  <td><a href="https://github.com/metowolf/Meting">Meting</a></td>
  <td>metowolf</td>
  <td>一个高效的多平台音乐 API 框架</td>
</tr>
<tr>
  <td><a href="https://github.com/zgq354/APlayer-Typecho-Plugin">APlayer-Typecho-Plugin</a></td>
  <td>zgq354</td>
  <td>参考部分代码实现</td>
</tr>
</tbody></table>
<h3>相关</h3>
<p>哈？你在用 Wordpress？赶紧试试 LWL12 酱的 <a href="https://blog.lwl12.com/read/hermit-x.html">Hermit-X</a> 吧，也是基于 Aplayer&amp;Meting 开发的哟</p>
</div>]]></content>
        
        <summary type="html">
            
             Aplayer 和 Meting 的碰撞，一个简单强大的 Typecho 音乐播放器就此诞生！ 下载  开源地址 https://github.com/MoePlayer/APlayer-Typecho  更新日志  2.1.2.zip  热插拔式的缓存系统 支持全新 APl
            
        </summary>
        
    </entry>
    
    <entry>
        <title>你好 Disqus，再见多说</title>
        <link href="https://blog.nfz.moe/archives/hello-disqus-and-goodbye-duoshuo.html"/>
        <id>https://blog.nfz.moe/archives/hello-disqus-and-goodbye-duoshuo.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-01-26T03:18:34+00:00</published>
        <updated>2017-01-26T03:18:34+00:00</updated>
        
        <content type="html"><![CDATA[<p>多说又双叒叕爆炸了！——这是我看到 <code>多说评论系统故障(9900015)，请联系客服人员</code> 报错信息时的想法。</p><a></a><blockquote><p>终于，多说关闭了。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/hello-disqus-and-goodbye-duoshuo.html# 多说"></a>多说 </h1><p> 多说是国内一款常见的社会化评论系统，常用于给没有自带评论服务的如 Hexo、Jeykll、MediaWiki 等提供评论服务，或者是为自带评论服务的如 WordPress、Typecho 等提供社会化评论服务。多说最大的优点可提供 QQ、微博、人人网、开心网、豆瓣、谷歌等一干社交媒体账号的登陆服务。但是作为国内一大评论系统，多说还是有许多不足：</p><ul><li>多说默认的样式实在太 $^[-@#(&amp;^9{ . . .</li><li>多说的垃圾评论拦截功能形同虚设，广告、色情评论实在泛滥</li><li>一段时间以来多说的服务很不稳定，经常崩坏</li><li>多说已经停止开发，最后一次更新停步于 2016 年 5 月</li><li>社交媒体的头像不支持 HTTPS（虽然这个锅应该归 BAT 毒瘤背）</li></ul><blockquote><p>虽然多说头像 HTTPS 可以用七牛或者 PHP 反代得以实现，但是毕竟是多说一大黑点。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/hello-disqus-and-goodbye-duoshuo.html#Disqus"></a>Disqus</h1><p>如果说国内有一家独大的评论系统多说，那么国外对应的就是 Disqus。与多说单纯仅提供评论服务不同，Disqus 提供一套完整的社区服务和推广功能（或许这是 Disqus 没有像多说一样面临困境的最大原因）。但是 Disqus 也有它的不足：</p><ul><li>Disqus 与多说不同，并不支持自定义样式（但是说实话，Disqus 的样式比多说的默认样式不知道高到哪里去了）</li><li>Disqus 不建议游客参加评论——Disqus 会引导游客注册 Disqus 账户，除非评论者勾选<code>I'd rather post as a guest</code></li><li>Disqus 仅提供 Facebook、Twitter 等国外社交媒体的社会化登陆方式</li><li>由于 <code>The Girl Friend Wall</code> 的存在，Disqus 在国内 <strong>开放、自由、有序</strong> 的网络环境下是不能访问的。</li></ul><h1><a href="https://blog.nfz.moe/archives/hello-disqus-and-goodbye-duoshuo.html#duoshuo2Disqus"></a>duoshuo2Disqus</h1><p>尽管多说有丰富的国内社交登陆方式以及无访问障碍，但是 Disqus 服务毕竟稳定可靠（没办法，洋大人的东西确实是好），而且有一整套完善的垃圾评论屏蔽功能（不会像多说一样极其容易被垃圾评论攻陷。而且国内也没有针对 Disqus 设计的垃圾评论机器人），所以我依旧决定迁移到 Disqus。<br />这里我直接用了现成的轮子 <a href="https://github.com/JamesPan/duoshuo-migrator" target="_blank">duoshuo-migrator</a> 转换的。这个 Python 程序可以把多说导出的备份文件转换成 Disqus 支持的 WXR 格式。具体使用方法在项目的 README 里写的很清楚了。<br />不过对之前评论过的小伙伴们表示很遗憾，你们的头像都没了. . .</p>]]></content>
        
        <summary type="html">
            
            多说又双叒叕爆炸了！——这是我看到 多说评论系统故障(9900015)，请联系客服人员 报错信息时的想法。终于，多说关闭了。多说  多说是国内一款常见的社会化评论系统，常用于给没有自带评论服务的如 Hexo、Jeykll、MediaWiki 等提供评论服务，或者是为自带评论服务
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="博客"/>
        
        <category term="评论"/>
        
        <category term="多说"/>
        
        <category term="Disqus"/>
        
    </entry>
    
    <entry>
        <title>常用Linux指令</title>
        <link href="https://blog.lirici.moe/archives/15/"/>
        <id>https://blog.lirici.moe/archives/15/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-01-24T05:32:00+00:00</published>
        <updated>2017-01-24T05:32:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/4109130947.jpg" />要知道Linux系统可不像Windows有那么易用的图形界面 <del>当然你要是装了图形界面就当我没说</del> ，你只能ssh连接你的服务器并用指令操控。<br />
本文将介绍一下Linux机常用的指令 <del>其实是我经常用的</del> </p>
<ol>
<li><code>cd 切换目录</code></li>
<li><code>cp 拷贝</code></li>
<li><code>ls 显示文件或目录</code><br />
<code>-l 列出文件详细信息l(list)</code><br />
<code>-a 列出当前目录下所有文件及目录，包括隐藏的a(all)</code></li>
<li><code>rm 删除文件</code><br />
<code>-r 递归删除，可删除子目录及文件</code><br />
<code>-f 强制删除</code><br />
<em>谨慎使用rm命令，Linux可是没有回收站的，一旦误删那就GG了</em></li>
<li><code>tar: 打包压缩</code><br />
<code>-c 归档文件</code><br />
<code>-x 解压缩文件</code><br />
<code>-z gzip压缩文件</code><br />
<code>-j bzip2压缩文件</code><br />
<code>-v 显示压缩或解压缩过程 v(view)</code><br />
<code>-f 使用档名</code></li>
<li><code>shutdown</code><br />
<code>-r 关机重启</code><br />
<code>-h 关机不重启</code><br />
<code>now 关机</code><br />
<code>halt 关机</code><br />
<code>reboot 重启</code></li>
<li><code>vim</code><br />
<code>:q    退出</code><br />
<code>:q!   强制退出</code><br />
<code>:wq   保存并退出</code><br />
<em>记住编辑完后按下Esc退出编辑模式在输入指令</em></li>
</ol>
<hr />
<p><strong>还有一些指令我就不写了，一般常用的就这些了</strong></p>]]></content>
        
        <summary type="html">
            
            要知道Linux系统可不像Windows有那么易用的图形界面 当然你要是装了图形界面就当我没说 ，你只能ssh连接你的服务器并用指令操控。 本文将介绍一下Linux机常用的指令 其实是我经常用的   cd 切换目录 cp 拷贝 ls 显示文件或目录 -l 列出文件详细信息l(l
            
        </summary>
        
    </entry>
    
    <entry>
        <title>拨开云雾见天明——解析酷安新出现的微信盗号木马</title>
        <link href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html"/>
        <id>https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2017-01-23T15:47:00+00:00</published>
        <updated>2017-01-23T15:47:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>一日，某不安好心者在酷安的 Xposed 模块 “App Setting” 的评论区发布了一条评论——“APP Setting 专业版”。一位用户下载使用后中招——微信密码泄露，账户被盗刷。</p><a></a><p>随后，酷友反应，在著名 Android 优化应用 “绿色守护” 的评论区同一个人发布了所谓 “绿色守护绿色版” 同样有涉嫌病毒的嫌疑。一时间酷安疑云四起，甚至引起了酷安的多位小编对各类修改版应用的抵制，对 QQ 美化版影响尤为巨大。<br />本人有幸在那个居心叵测的人被酷安的小编们删帖之前成功地下载到了两个样本。现在我将通过逆向这个病毒，来弄清楚这个里面到底有多少猫腻。</p><blockquote><p>另外，感谢酷友 <a href="http://www.coolapk.com/u/523048" target="_blank">DBin_K</a> 以身试毒、安装“体验”并抓包，获得了宝贵的截图和数据。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x00"></a>0x00</h1><blockquote><p>工欲善其事必先利其器。这是本人使用的工具。</p></blockquote><ul><li>ROM IDE+</li><li>MT 管理器</li><li>Packet Capture</li><li>Beyond Compare</li><li>安装包解析工具</li></ul><blockquote><p><del>这些是病毒的样本。本人已经混淆了这些 Apk 资源，确保不会再被其它不法分子反编译、用于其它非法用途！</del>不再提供病毒样本。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x01"></a>0x01</h1><p>以下是受害者酷友“阿光正传”的经历。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000012.png" /></p><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x02"></a>0x02</h1><p>以被打包过的 App Setting 为例。<br />首先使用 ROM IDE+（核心是 APkTool）对正常的 APP Setting 和被打包多的 APK Setting 进行反编译，然后使用 Beyond Compare 比对反编译出来的东西有什么区别。<br />首先可以看到 <code>AndroidManiFest.xml</code> 的区别，可以看到被打包过的 App Setting 多申请了这些权限。</p><ul><li>读取设备信息</li><li>读写短信</li><li>读取联系人</li><li>开机自动启动</li><li>震动权限</li><li>挂载文件系统</li><li>读取存储</li><li><strong>在其它应用上层显示内容</strong></li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000014.png" /></p><blockquote><p>上图中左边是被打包应用的 <code>AndroidManiFest.xml</code>，右边是正常应用的 <code>AndroidManiFest.xml</code>。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000015.png" /></p><p>除此以外还可以从第二张图里看到，被打包过的应用还额外内置了两个 Activity，分别是 <code>com.android.append.MainActivity</code> 和 <code>com.android.append.MainActivity2</code>。这两个活动所包含的包名和应用本身的包名 <code>de.robv.android.xposed.mods.appsettings</code> 并不相符。所以意味着这两个活动并没有写进打包的应用中，而是额外的独立应用。</p><blockquote><p>而且，这个应用伪装成了系统组件（这个额外的应用的包名为 com.android.append）</p></blockquote><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x03"></a>0x03</h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000016.png" /></p><p>这张图可以看到被打包的应用还新增了一个 <code>drawable</code> 文件夹，内建了一个假的微信悬浮窗和微信登陆界面的样式，可以看到微信的 icon 和登陆的界面图片，以及定义界面的 xml。随便摘录一段给大家看看。</p><pre><code>&lt;shapexmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;    <span><span><span>&lt;</span>solid</span> <span><span>android:</span>color</span><span><span>=</span><span>&quot;</span>#e5fafafa<span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>corners</span> <span><span>android:</span>radius</span><span><span>=</span><span>&quot;</span>5.0dip<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;/</span>shape</span><span>&gt;</span></span><span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://st.nfz.yecdn.com/img/blog/0000009.png" /></p><p><img src="https://p0.ssl.qhmsg.com/t01cedd34ff12d84b79.png" /></p><p>实际效果像这样（由 DBIn_K 提供截图）：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000013.png" /></p><blockquote><p>还有模有样的，不是么？</p></blockquote><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x04"></a>0x04</h1><p>从那张图里还可以看到，除了一些 smali 的不同，还有一个显著区别就是 <code>asset</code> 目录下竟然内置了一个小的 timesync.apk！<br />将它提取出来，用 MT 管理器和安装包解析工具加以分析：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000021.png" /></p><blockquote><p>原来这个就是那个 <code>com.android.append</code>。伪装应用名为 SuperSU,，以便瞒天过海。</p></blockquote><p>再对其进行反编译，查看里面到底有什么猫腻。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000019.png" /></p><p>查看里面的文件目录树可以看出来同样是内置了一套悬浮窗的样式，除此以外还内置了一套微信登录界面的样式。<br />同样只摘录一段给大家看看就行：</p><pre><code><span><span><span>&lt;</span>RelativeLayout</span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span><span>&gt;</span></span>    <span><span><span>&lt;</span>ImageView</span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>#ff393a3f<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>48.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>0.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>0.0dip<span>&quot;</span></span> <span><span>android:</span>src</span><span><span>=</span><span>&quot;</span>@drawable/wx_top<span>&quot;</span></span> <span><span>android:</span>scaleType</span><span><span>=</span><span>&quot;</span>fitStart<span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>View</span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>#00000000<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>48.0dip<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>48.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>0.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>0.0dip<span>&quot;</span></span> <span><span>android:</span>onClick</span><span><span>=</span><span>&quot;</span>btnBack_onClick<span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>18.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ffffffff<span>&quot;</span></span> <span><span>android:</span>paddingLeft</span><span><span>=</span><span>&quot;</span>60.0dip<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>48.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>3.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 解除登录限制 <span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>14.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff999999<span>&quot;</span></span> <span><span>android:</span>paddingLeft</span><span><span>=</span><span>&quot;</span>60.0dip<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>48.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>26.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 微信安全支付 <span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;/</span>RelativeLayout</span><span>&gt;</span></span><span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>16.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff999999<span>&quot;</span></span> <span><span>android:</span>gravity</span><span><span>=</span><span>&quot;</span>center_horizontal<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>40.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 请输入支付密码，以验证身份 <span>&quot;</span></span> <span>/&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有这一段：</p><pre><code><span><span><span>&lt;</span>LinearLayout</span> <span><span>android:</span>orientation</span><span><span>=</span><span>&quot;</span>horizontal<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span><span>&gt;</span></span>    <span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>16.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff353535<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>69.0dip<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>20.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>30.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 账  号 <span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>EditText</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>16.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff353535<span>&quot;</span></span> <span><span>android:</span>textColorHint</span><span><span>=</span><span>&quot;</span>#ffdddddd<span>&quot;</span></span> <span><span>android:</span>id</span><span><span>=</span><span>&quot;</span>@id/ed_wx_account<span>&quot;</span></span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>@null<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>220.0dip<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>30.0dip<span>&quot;</span></span> <span><span>android:</span>hint</span><span><span>=</span><span>&quot;</span> 微信号 / 手机号 /Email<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;/</span>LinearLayout</span><span>&gt;</span></span><span><span><span>&lt;</span>View</span> <span><span>android:</span>id</span><span><span>=</span><span>&quot;</span>@id/vw_wx_line1<span>&quot;</span></span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>#ff45c01a<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>0.5dip<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>13.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginRight</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginBottom</span><span><span>=</span><span>&quot;</span>13.0dip<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;</span>LinearLayout</span> <span><span>android:</span>orientation</span><span><span>=</span><span>&quot;</span>horizontal<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span><span>&gt;</span></span>    <span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>16.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff353535<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>69.0dip<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>20.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 密  码 <span>&quot;</span></span> <span>/&gt;</span></span>    <span><span><span>&lt;</span>EditText</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>16.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff353535<span>&quot;</span></span> <span><span>android:</span>textColorHint</span><span><span>=</span><span>&quot;</span>#ffdddddd<span>&quot;</span></span> <span><span>android:</span>id</span><span><span>=</span><span>&quot;</span>@id/ed_wx_password<span>&quot;</span></span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>@null<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>hint</span><span><span>=</span><span>&quot;</span> 密码 <span>&quot;</span></span> <span><span>android:</span>inputType</span><span><span>=</span><span>&quot;</span>textPassword<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;/</span>LinearLayout</span><span>&gt;</span></span><span><span><span>&lt;</span>View</span> <span><span>android:</span>id</span><span><span>=</span><span>&quot;</span>@id/vw_wx_line2<span>&quot;</span></span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>#ffd8d8d8<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>0.5dip<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>13.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginRight</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginBottom</span><span><span>=</span><span>&quot;</span>13.0dip<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;</span>Button</span> <span><span>android:</span>enabled</span><span><span>=</span><span>&quot;</span>false<span>&quot;</span></span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>17.0dip<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>@drawable/login_button_textcolor<span>&quot;</span></span> <span><span>android:</span>id</span><span><span>=</span><span>&quot;</span>@id/btn_wx_login<span>&quot;</span></span> <span><span>android:</span>background</span><span><span>=</span><span>&quot;</span>@drawable/login_button_background<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>fill_parent<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>47.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>layout_marginRight</span><span><span>=</span><span>&quot;</span>10.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 登录 <span>&quot;</span></span> <span><span>android:</span>onClick</span><span><span>=</span><span>&quot;</span>Button_onClick<span>&quot;</span></span> <span>/&gt;</span></span><span><span><span>&lt;</span>TextView</span> <span><span>android:</span>textSize</span><span><span>=</span><span>&quot;</span>15.0sp<span>&quot;</span></span> <span><span>android:</span>textColor</span><span><span>=</span><span>&quot;</span>#ff576b95<span>&quot;</span></span> <span><span>android:</span>layout_gravity</span><span><span>=</span><span>&quot;</span>center<span>&quot;</span></span> <span><span>android:</span>layout_width</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_height</span><span><span>=</span><span>&quot;</span>wrap_content<span>&quot;</span></span> <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&quot;</span>20.0dip<span>&quot;</span></span> <span><span>android:</span>text</span><span><span>=</span><span>&quot;</span> 登录遇到问题 ?<span>&quot;</span></span> <span>/&gt;</span></span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实际效果就像这样（由以身试毒的酷友 DBin_K 提供截图）：</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000010.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000005.png" /></p><blockquote><p>“解除登录限制”、“微信安全支付”、“请输入支付密码，以验证身份”、“登录遇到问题？” ，真的很具有迷惑性。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x05"></a>0x05</h1><p>酷友 DBin_K 还发现病毒的核心组件还申请了 root 权限，他把 su 权限以后 SuperSU 抓到些日志。这些日志都是满满的 <code>cat</code> 指令，从微信的数据文件夹 <code>/data/data/com.tencent.mm</code> 合并了很多文件到它自己的数据目录 <code>/data/user/0/com.android.append</code> 下面。具体要这些数据是为了什么还不清楚（我自己没有微信，所以没法知道它获取的这些是什么数据）</p><blockquote><p>更新：获取这些数据是为了微信跨设备登陆，具体参见 0x07。</p></blockquote><p><img src="https://st.nfz.yecdn.com/img/blog/0000020.png" /></p><p>现在来看他病毒核心的 smali，粗略一看，里面值得我们关注的主要是三个部分，一个是基于 google 开发的解析 json 的框架 gson，一个是由 Jakewharton 开发的 DiskLruCache 缓存，一个是 loopj 开发的 android-async-http。这几个就是用来把获取到的数据传回作者的服务器。<br />本来我可以直接一个一个看 smali ，直到找到他数据回源的域名，但是后来 DBin_K 直接开了抓包，拿到了数据回源的地址：<code>uu636.com/update.aspx</code>。所以我就没有继续看下去。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000007.png" /></p><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x06"></a>0x06</h1><p>现在这个病毒的原理很明显了：始作俑者专找 Xposed 和 Root 类应用下手，因为这类应用有很好的后台存活性，以便随时出来作案；然后是病毒的核心组件伪装成 SuperSU 向受害者申请 root 权限，把病毒核心注入 system/app ，并收集用户的微信的数据库；接着是由于 <code>ANdroidManiFest.xml</code> 中定义了在在其它应用显示的权限，每十分钟会弹出一个假的弹窗提示你“微信登陆已过期，需要重新登陆”，从而把受害者骗进他们那个做的非常逼真的登陆界面，直到套出用户的用户名和密码；最后这些信息会被回传给始作俑者的服务器，然后很快就会用这些信息盗刷受害者的微信钱包。同时，root 权限帮助病毒核心组件长期存活，就算受害者使用 RE 管理器删除了组件，也会不断复活。</p><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x07"></a>0x07</h1><blockquote><p>2017-01-23 更新：</p></blockquote><ol><li>根据学习软件工程的逆向大佬 iKirby 分析，获取微信的数据文件是为了实现跨设备微信登陆；</li><li>从百度贴吧可以获得的公开的资料得知，这个团伙从今年年初就已经开始作案（几次病毒的行为都高度相似），已经有将近十名受害者被骗。</li><li>查询一下这个域名的 Whois 信息可以看到，这个域名是在国内购买的，同时启用了域名 Whois 隐私保护，所以查不到域名所有人的信息。</li></ol><p><img src="https://st.nfz.yecdn.com/img/blog/0000025.png" /><br /><img src="https://st.nfz.yecdn.com/img/blog/0000026.png" /></p><p>根据全网 ping 的响应速度，的确应该是靠近国内地区的服务器。但是又找不到备案信息，所以这个服务器应该是在香港（我用我朋友在香港沙田机房的 VPS ping 了一下发现耗时是 0ms，结果不言而喻）</p><ol><li>在酷友 <a href="http://www.coolapk.com/u/554126" target="_blank">llllllllllll666</a> 和酷安的开发组成员 <a href="http://www.coolapk.com/u/346976" target="_blank">liubaoyua</a> 对病毒的逆向下获得了 java 部分。详见 0x08。</li></ol><h1><a href="https://blog.nfz.moe/archives/lets-check-and-study-wechat-trojan.html#0x08"></a>0x08</h1><p>在酷友 llllllllllll666 和酷安开发组成员 liubaoyua 的反编译下发现了几个类，大概就是这些作用：</p><ul><li>劫持微信快捷方式</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000043.png" /></p><p>代码如图，当获取到 root 权限以后木马核心会开始寻找启动器下的微信的快捷方式劫持到自己的桌面活动 <code>com.android.append.Launcher.Activity</code>，这样受害者点击微信你图标也会触发打开伪造的登陆界面。</p><ul><li>卸载微信</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000044.jpg" /></p><p>这个就简单了，仅仅只是卸载微信而已。</p><ul><li>一键变砖</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000042.png" /></p><p>这个是挂载 system 分区，然后删除 <code>system/framework/</code> 文件夹，也就是删除了系统框架，可以导致手机变砖。</p><blockquote><p>后面两个是服务端远程控制实现的，所以请各位“以身试毒”的大无畏者务必小心，小心 <strong> 被远端遥控一键变砖</strong>！！</p></blockquote>]]></content>
        
        <summary type="html">
            
            一日，某不安好心者在酷安的 Xposed 模块 “App Setting” 的评论区发布了一条评论——“APP Setting 专业版”。一位用户下载使用后中招——微信密码泄露，账户被盗刷。随后，酷友反应，在著名 Android 优化应用 “绿色守护” 的评论区同一个人发布了所
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Android"/>
        
        <category term="安全"/>
        
        <category term="病毒"/>
        
    </entry>
    
    <entry>
        <title>开始</title>
        <link href="https://blog.lirici.moe/archives/4/"/>
        <id>https://blog.lirici.moe/archives/4/</id>
        
        <author>
            <name>Lirici</name>
        </author>
        
        <published>2017-01-23T11:42:00+00:00</published>
        <updated>2017-01-23T11:42:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://blog.lirici.moe/usr/uploads/2017/07/2043685137.jpg" />一开始就是准备用typecho的，后来体验了一下WordPress <del>其实是装完typecho上HTTPS的时候出了问题</del> ，WordPress有它的优点，功能什么的都挺多的 <del>然而我根本用不着</del> 。关键是WordPress还不资瓷<strong>MARKDOWN</strong>。</p>
<hr />
<p>寒假有空就写一点教程吧</p>
<ul>
<li>如何搭建自己的贴吧云签到</li>
<li>如何在自己的vps上部署SSR<del>扶墙用</del> </li>
<li>如何搭建个人博客</li>
<li>如何利用vps下载bt</li>
</ul>
<hr />
<p>我的贴吧云签到<a href="https://sign.lirici.moe">传送门</a></p>]]></content>
        
        <summary type="html">
            
            一开始就是准备用typecho的，后来体验了一下WordPress 其实是装完typecho上HTTPS的时候出了问题 ，WordPress有它的优点，功能什么的都挺多的 然而我根本用不着 。关键是WordPress还不资瓷MARKDOWN。  寒假有空就写一点教程吧  如何搭
            
        </summary>
        
    </entry>
    
    <entry>
        <title>启用了新的数据中心</title>
        <link href="https://blog.lwl12.com/read/new-datacenter-guangzhou-a.html"/>
        <id>https://blog.lwl12.com/read/new-datacenter-guangzhou-a.html</id>
        
        <author>
            <name>lwl12</name>
        </author>
        
        <published>2017-01-21T14:05:03+00:00</published>
        <updated>2017-01-21T14:05:03+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://blog.lwl12.com/read/new-datacenter-guangzhou-a.html"><img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/01/snipaste20170121_212816-1024x576.png" /></a></p><p>启用了新的 Datacenter – Guangzhou A.<br />
新的 DNS 信息生效可能需要至多 24 小时，请耐心等待服务恢复。<br />
<span></span><br />
<img src="//blog.cdn.lwl12.com/wp-content/uploads/2017/01/snipaste20170121_212816-1024x576.png" /></p>]]></content>
        
        <summary type="html">
            
            启用了新的 Datacenter – Guangzhou A. 新的 DNS 信息生效可能需要至多 24 小时，请耐心等待服务恢复。  
            
        </summary>
        
        <category term="网站"/>
        
    </entry>
    
    <entry>
        <title>新的博客系统 Solomon</title>
        <link href="https://blog.poi.cat/introducing-solomon"/>
        <id>https://blog.poi.cat/introducing-solomon</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-01-15T16:04:11+00:00</published>
        <updated>2017-01-15T16:04:11+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>2017-02-13 更新：添加了配置文件部分</p></blockquote><h2>前言</h2><p>以前我的博客用的是 <a href="https://hexo.io/">hexo</a> 。但是我用起来感觉限制还是太多，然后又尝试了一下其他的静态博客生成器，例如：<a href="https://gohugo.io/">Hugo</a> 、<a href="https://jekyllrb.com/">Jekyll</a> 、<a href="https://ghost.org/">Ghost</a> 等，发现也不太满足我的需求。恰巧，Angular 2 发布了，于是我就萌生了自己写一个博客系统的想法。</p><p>说干就干，repo 的名字就叫 Solomon ，和我的博客同名。</p><h2>Angular 简介</h2><p>Angular 是 Google 开发的前端框架，据 <a href="https://angular.cn">Angular 中文网</a> 介绍，其有如下功能：</p><blockquote><p>Angular 特性与优点：跨平台(Cross Platform)、速度与性能(Speed and Performance)、生产率(Productivity)和完整开发故事(Full Development Story)。</p></blockquote><p>Angular 的框架如图：</p><p><img src="https://angular.io/resources/images/devguide/architecture/overview2.png" /></p><p>图源 <a href="angular.io">angular.io</a></p><p>我选择 Angular 主要有一下几方面的考虑：</p><ol><li><p>Angular 2 框架使用 Microsoft 的 TypeScript 开发，而且官方推荐使用的语言也是 TypeScript。 TypeScript 是 JavaScript 的 <strong>一个严格超集</strong> ，并且添加了 <strong>静态类型</strong> 和 <strong>面向对象编程</strong></p></li><li><p>此外，Angular 2 还集成了 Microsoft 的另外一个产品 RxJS (Reactive Extensions for JavaScript, JavaScript 的响应式扩展)</p></li><li><p>最后一点，则是 Google Developers 的 <strong>中文博客</strong> 已经正式发布，其中就包括 <a href="angular.io">Angular 中文网</a></p></li></ol><h2>配置文件</h2><p>为了实现配置文件的功能，我写了一个接口 <code>SolomonConfig</code> ：</p><pre><code><span>export</span> <span>interface</span> SolomonConfig {
  BLOG_NAME: <span>string</span>,
  RECENT_POST_LIMIT: <span>number</span>,
  RECENT_ANIME_LIMIT: <span>number</span>,
  RECENT_PROJECT_LIMIT: <span>number</span>,
  GITHUB_USERNAME: <span>string</span>,
  GITHUB_POST_REPO: <span>string</span>,
  KITSU_ID: <span>number</span>
}
</code></pre><p>使用之前需要先继承这个接口：</p><pre><code><span>export</span> <span>const</span> CONFIG: SolomonConfig = {
  BLOG_NAME: <span>'Solomon'</span>,
  RECENT_POST_LIMIT: <span>6</span>,
  RECENT_ANIME_LIMIT: <span>6</span>,
  RECENT_PROJECT_LIMIT: <span>6</span>,
  GITHUB_USERNAME: <span>'PoiScript'</span>,
  GITHUB_POST_REPO: <span>'Solomon-Post'</span>,
  KITSU_ID: <span>140033</span>
}

<span>export</span> <span>const</span> CONFIG_TOKEN = <span>new</span> OpaqueToken(<span>'config'</span>)
</code></pre><p>然后就可以通过 <code>@Inject(CONFIG_TOKEN) config: SolomonConfig</code> 来获得我们设置的 <code>config</code>，进而获得我们的配置。</p><h2>文章</h2><p>我的文章放在 <a href="https://github.com/PoiScript/Solomon-Post">一个单独的 Repository</a> 里, 主要由如下的考虑:</p><ol><li><p>我不想把文章和框架放在一起，这样有夹带私货的感觉；</p></li><li><p>方便给文章和框架使用不同的协议：框架是 MIT 协议，文章是 知识共享 署名-相同方式共享 4.0 协议；</p></li><li><p>方便以后迁移到不同的博客框架</p></li></ol><p>我的文章是通过 <strong>XHR 异步请求</strong> 获取的，传输的格式是 <strong>JSON</strong> 。理由如下</p><ol><li><p>XHR 可以实现 <strong>懒加载(lazy load)</strong></p></li><li><p>JSON 数据格式小</p></li><li><p>TypeScript(JavaScript) 可以很方便的解析 JSON</p></li></ol><blockquote><p>虽然我是用 JSON 存储了文章数据，在显示的时候用浏览器渲染，而不是像其他静态博客那样 <strong>生成 HTML 纯静态的文件</strong>。但是我的 JSON 数据是静态的而且和其他 HTML CSS JS 文件托管在一起，所以我的博客理论上讲还是一个 <strong>静态博客</strong> 。 :)</p></blockquote><p>我的文章的用 Markdown 写的, 于是我需要先将 Markdown 渲染成 HTML 格式, 然后再封装成 JSON。</p><p>于是我写了 <a href="https://github.com/PoiScript/Solomon-Post/blob/master/build.ts">一个脚本</a>, 它可以把 <code>src/markdown</code> 里的文章解析成 <code>src/json</code> 里的 JSON 文件。此外还可以生成以日期排序的 <code>archive.json</code> 和以分类信息分类好的 <code>category.json</code> 以方便检索。</p><h2>评论</h2><p>评论我用的是 <strong>GitHub Issue</strong> 。一是 issue comment 相比其他的评论系统，可以实现更多的功能，像支持部分 <strong>Markdown</strong> 和可以进行 <strong>reaction</strong> (例如点赞、点踩之类的)。二是 GitHub 提供 Issue Comment 的 <strong>API</strong> ，借此我就可以实现 <strong>自定义</strong> 评论的排版。</p><p>当然麻烦也是有的，一是评论者需要有 <strong>GitHub</strong> 账号，不过我想应该不是难事；二是每篇文章需要建一个 Issue 。</p><p>此外，在 Angular 中调用 GitHub Issue API 的时候还有一个问题，就是获取 Reaction 的时候需要加一个 <strong>Header</strong> :</p><pre><code>Accept : application/vnd.github.squirrel-girl-preview
</code></pre><p>在 Angular 中，就需要这么写:</p><pre><code>getIssueComments(): <span>Promise</span>&lt;Comment[]&gt; {
  <span>let</span> headers = <span>new</span> Headers()
  headers.append(<span>'Accept'</span>, <span>'application/vnd.github.squirrel-girl-preview'</span>)
  <span>return</span> <span>this</span>.http.get(url, {
    headers: headers
  }).toPromise()
    .then(<span><span>res</span> =&gt;</span> res.json() <span>as</span> Comment[])
}
</code></pre><blockquote><p>顺便提一下，我的评论系统中只会显示 <strong>+1</strong> 和 <strong>-1</strong> 的 Reaction，一是我觉得有这两个就够了；二是我在 <strong>Material Design Icons</strong> 里没找到另外几个比较符合 Emoji 的图标。 :(</p></blockquote><h2>搜索</h2><p>搜索我用的是 <strong>GitHub Code Search</strong> 。使用它的主要原因和上面的评论相同，因为 GitHub 提供了相应的 <strong>API，所以可以借此实现</strong> <strong>自定义</strong> 布局。</p><p>上面我提到过我的文章是用 <strong>Markdown</strong> 写的，而且也托管于 <strong>GitHub</strong> 。于是只要在 GitHub Code Search API 的参数中指定搜索特定的 repo 中后缀名为 <code>.md</code> 的文件即可实现搜索。</p><p>此外 <strong>GitHub Code Search API</strong> 还可以返回匹配的文本的上下文，借此可以实现 <strong>搜索结果的预览</strong> 。不过和上面的 Reaction 相同，开启这个特性需要 <strong>添加一个 Header</strong> ：</p><pre><code>Accept : application/vnd.github.v3.text-match+json
</code></pre><h2>后语</h2><p>最后，整个博客系统以 <a href="https://github.com/PoiScript/Solomon/blob/master/LICENSE">MIT 协议</a> 开源于 <a href="https://github.com/PoiScript/Solomon">PoiScript/Solomon</a>，目前没有写文档的打算。不过如果有人真的想用这个博客系统的话，可以在我的 <a href="https://blog.poi.cat/about">关于界面</a> 的选择任意一种联系方式联系我，我会尽力解答你的疑问。:)</p>]]></content>
        
        <summary type="html">
            
            2017-02-13 更新：添加了配置文件部分前言以前我的博客用的是 hexo 。但是我用起来感觉限制还是太多，然后又尝试了一下其他的静态博客生成器，例如：Hugo 、Jekyll 、Ghost 等，发现也不太满足我的需求。恰巧，Angular 2 发布了，于是我就萌生了自己写
            
        </summary>
        
        <category term="angular"/>
        
        <category term="blog"/>
        
    </entry>
    
    <entry>
        <title>The Making of: Lyricova Screensaver v2</title>
        <link href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/"/>
        <id>https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2017-01-07T17:07:48+00:00</published>
        <updated>2017-01-07T17:07:48+00:00</updated>
        
        <content type="html"><![CDATA[<p><img src="https://i.imgur.com/pNt9Neq.gif" /></p>
<p>It has been long since last time I post here. This time I’d like to share about how I made the Lyricova Screensaver v2: refractor from my own legacy code.</p>
<a></a>
<p><em>Project Lyricova</em> is my first blog-like system, written in 2013, based on CodeIgnitor, a PHP framework. Initially codenamed <em>Project GY</em>, from its Chinese name 歌语. It has ran as my own lyrics collection site “stably” for years. I made my <a href="https://1a23.com/lyricova/screensaver.html" target="_blank">first screensaver</a>, just simply load up lyrics on the screen, with some text animations, on top of a <code>three.js</code> official demo. With the 3D effect, and multiple concurrent timelines, it can sometimes be laggy, and resource comsuming, and the design is also not as artistic as well. So, this year I came up with my second design.</p>
<h1><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x00-Design"></a>0x00: Design</h1><p><img src="https://images.1a23.com/upload/images/ATFB.png" /></p>
<p>This was a part of my Lyricova redesign. Turns out this is the first that becomes something works. Without a reason, I’m kinda into those typing effects, especially the 上屏 (zh-CN), and 変換 (ja-JP) part of it. <em>(That’s something not really available when you type in alphabetical languages, so I decide not to translate it.)</em></p>
<p>After the design, still something is missing from the system, namely:</p>
<ul>
<li>Categories</li>
<li>Languages isolation</li>
<li>Romanization (for typing animations)</li>
</ul>
<h1><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x01-Refractor"></a>0x01: Refractor</h1><p>So let’s fix them one by one.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x010-Categories"></a>0x010: Categories</h2><p>This is also something I’ve been planning years ago. With mainly Vocaloid lyrics, I chose to use the name of Hatsune Miku Appends + Core for categories. This is actually inspired by the PV of <a href="http://www.niconico.jp/watch/sm10924943" target="_blank">The Division and Destruction of Hatsune Miku (初音ミクの分裂→破壊)</a>.</p>
<p>To assign categories to 300+ posts at once is not a easy job. What I did is write up a new page, I call it “Category roller”.</p>
<p><img src="https://images.1a23.com/di/9BNG/9BNG.png" /></p>
<p>With the screenshot, it should be easy to understand. There’s a “keyboard” at the bottom, and a card above. <code>≪</code> and <code>≫</code> for pagination, other buttons are just category toggles. Behind that is just an HTTP API, and a script keep updating the location hash (<code>window.location.hash</code>), so it’s easy for me to get back to where I stopped.</p>
<p>Back to the database, I created a <code>postmeta</code> table: a simple Post ID-key-value storage for all future post-related possible values, and of course — categories — in a JSON string.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x011-Language-isolation"></a>0x011: Language isolation</h2><blockquote>
<p><em>Not sure if I used the correct word. :/</em></p>
</blockquote>
<p>In the legacy Lyricova database structure, lyrics are stored in 3 columns of the table: <code>lyric</code>, <code>origin</code> and <code>translate</code>, which supposed to be corresponding to:</p>
<ul>
<li>The language displayed as the main one,</li>
<li>The original language of the song (empty if used as the main one), and</li>
<li>Other translated versions.</li>
</ul>
<p>Despite all data is constrained to <code>en</code>, <code>ja</code> and <code>zh</code>, many entries contains mixed languages. To apply romanization to different languages, I have to isolate them from the database.</p>
<p>The method I used is not really fool-proof, but should work in most cases. It’s just simply check for different type of characters. The priority goes as “Kana → Han → Latin”, that is:</p>
<ul>
<li><code>ja</code> if there’s Kana,</li>
<li><code>zh</code> if there’s Han characters,</li>
<li><code>en</code> otherwise.</li>
</ul>
<p><a href="https://gist.github.com/blueset/9407e9b286b30531b42b2bccb6d7e218#file-lyricproc-py" target="_blank">Source code: <code>lyricproc.py</code></a></p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x012-Romanization"></a>0x012: Romanization</h2><p>This is really the most difficult part of this whole thing, as it even involves NLP. The ideal case is that it not only correctly revert the text to the “typing string”, but also sector it as how we usually type.</p>
<p>For Japanese text, I used <a href="https://taku910.github.io/mecab/" target="_blank">MeCab</a> for the job. Aside from getting the “yomi” of each word, it also gives a value that reflects the connection between 2 words. By trial and error, a difference of <code>-1000</code> produces a pretty acceptable result for phrase grouping.</p>
<p>However, for Chinese text, <a href="https://github.com/fxsjy/jieba" target="_blank">JieBa</a> and <a href="https://github.com/mozillazg/python-pinyin" target="_blank">pypinyin</a> can generate the Pinyin string quite well, but JieBa — based on dictionary and graph scanning — doesn’t really provide a relation between words for grouping. So only the minimum word grouping is used.</p>
<p><a href="https://gist.github.com/blueset/9407e9b286b30531b42b2bccb6d7e218#file-tr-py" target="_blank">Source code: <code>tr.py</code></a></p>
<p>BTW, this script is written to support shell arguments for future uses.</p>
<p>Updating the admin panel is trivial, so I won’t talk too much about it.</p>
<h1><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x02-Screensaver"></a>0x02: Screensaver</h1><p>Like the last one, it’s still done in HTML, simply because it the most easy way to build a cross platform GUI application, especially with the spread of modern browsers. Luckily the built-in WebKit in OS X 10.11 still can handle those HTML5 features.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x020-Lyrics-Data"></a>0x020: Lyrics Data</h2><p>Although there’s API on the server where I can get all the necessary lyrics data, I can’t let it ask from the server everytime it loads. You may want to say there is Local Storage, but (there’s always a but)…</p>
<blockquote>
<p>OS X’s screensaver WebView seems to drop LocalStorage content every time it launches. (Possibly due to the sandbox mechanism.)<br />It works fine when you preview it, but not when you actually trigger it.</p>
</blockquote>
<p>As I’m not planning to install it in OS-level elsewhere, and PHP (on Apache) is always running on my laptop, I used <a href="https://github.com/fire015/flintstone" target="_blank">Flintstone</a>, a simple file based key-value storage, wrapped up in a tiny PHP script accepting GETs and POSTs.</p>
<p><a href="https://gist.github.com/blueset/9407e9b286b30531b42b2bccb6d7e218#file-storage-php" target="_blank">Source code: <code>storage.php</code></a></p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x021-Animation"></a>0x021: Animation</h2><p>It’s pretty simple for Latin scripts, and Chinese text with Pinyin string, but more works required for Japanese even with its Yomi. Inspired by <a href="http://www.otchy.net/javascript/jaticker/" target="_blank">JaTicker</a>, a Japanese typing animation jQuery plugin, I write up a logic for generating the animation sequence for any random Hiragana Yomi, in a rather natural way.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x022-Data-update"></a>0x022: Data update</h2><p>Everytime when the screensaver starts, it queries the last update timestamp from the remote server and compares with the local timestamp, if there’s anything updated, all updated entries will be loaded from server, and overwriting the local entries.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x023-Design-CSS"></a>0x023: Design (CSS)</h2><p>JS scripts has already taken care of the content change, the CSS part should be simple. The blinking cursor is done with CSS animation, everything else is in <code>flexbox</code>es. That’s all.</p>
<h2><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x024-Update-config"></a>0x024: Update config.</h2><p>Considering the sandbox issue on OS X system screensavers, I have to resort to location hash for updating the configuration. The screensaver takes a JSON object which overrides the <code>config</code> dict, which includes:</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div></pre></td><td><pre><div>{</div><div>    <span>&quot;local_storage_api&quot;</span>: <span>false</span>, <span>// False for alternate LocalStorage HTTP API</span></div><div>    <span>&quot;zh&quot;</span>: [], <span>// Category filter per language, empty for none,</span></div><div>    <span>&quot;en&quot;</span>: [<span>&quot;all&quot;</span>], <span>// &quot;all&quot; for all categories</span></div><div>    <span>&quot;ja&quot;</span>: [<span>&quot;core&quot;</span>, <span>&quot;bright&quot;</span>] <span>// or only allow certain categories</span></div><div>}</div></pre></td></tr></table>
<h1><a href="https://blog.1a23.com/2017/01/07/The-Making-of-Lyricova-Screensaver-v2/#0x03-System-screensaver"></a>0x03: System screensaver</h1><p>The screensaver wrapper I used is <a href="https://github.com/liquidx/webviewscreensaver" target="_blank">WebViewScreensaver</a> on OS X. It works pretty well here, other than the local storage problem. Remember to <code>#{&quot;local_storage_api&quot;:false}</code> to your URL.</p>]]></content>
        
        <summary type="html">
            
             It has been long since last time I post here. This time I’d like to share about how I made the Lyricova Screensaver v2: refractor from my 
            
        </summary>
        
        <category term="Designs"/>
        
        <category term="Tech"/>
        
        <category term="Web"/>
        
        <category term="HTML"/>
        
        <category term="CSS"/>
        
        <category term="PHP"/>
        
        <category term="Project Lyricova"/>
        
        <category term="Screensaver"/>
        
    </entry>
    
    <entry>
        <title>Hello World!</title>
        <link href="https://blog.poi.cat/hello-world"/>
        <id>https://blog.poi.cat/hello-world</id>
        
        <author>
            <name>PoiScript</name>
        </author>
        
        <published>2017-01-05T08:30:55+00:00</published>
        <updated>2017-01-05T08:30:55+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://youtu.be/rOU4YiuaxAM">BUMP OF CHICKEN「Hello,world!」on YouTube</a></p><blockquote><p>ハロー　どうも　僕はここ</p><p>Hello 　你好　我在这里</p><p>Hello 　你好　我在這裡</p></blockquote>]]></content>
        
        <summary type="html">
            
            BUMP OF CHICKEN「Hello,world!」on YouTubeハロー どうも 僕はここHello  你好 我在这里Hello  你好 我在這裡
            
        </summary>
        
        <category term="thought"/>
        
    </entry>
    
    <entry>
        <title>实现主站静态主题更换后，Android手机状态栏随同变色功能</title>
        <link href="https://blog.halyul.cc/2016/12/31/main-theme-changing/"/>
        <id>https://blog.halyul.cc/2016/12/31/main-theme-changing/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-01-01T02:20:38+00:00</published>
        <updated>2017-01-01T02:20:38+00:00</updated>
        
        <content type="html"><![CDATA[<p>主页都不知道给我换了多少次了，用不上了嗯。<br /><a></a></p><h2><a href="https://blog.halyul.cc/2016/12/31/main-theme-changing/#缘由"></a>缘由</h2><h3><a href="https://blog.halyul.cc/2016/12/31/main-theme-changing/#大背景"></a>大背景</h3><p>Android在KitKat时代加入了变色状态栏，而Chrome在版本v39可以通过读取网页中<code>&lt;meta name=&quot;theme-color&quot; content=&quot;#3F51B5&quot;&gt;</code> 这段位于<code>&lt;head&gt;&lt;/head&gt;</code>前的代码实现改变状态栏颜色及地址栏颜色。</p><p><img src="//img.halyul.com/images/2017/03/15/o_1b7viobs21q6h1b0h1p5v13gf1fmra.png" /><img src="https://img.halyul.com/images/2017/03/15/o_1b7vioo0s1re04bb1ld73hfgr6a.png" /></p><p>来源：<a href="http://www.androidpolice.com/2014/11/10/chrome-v39-on-lollipop-supports-custom-multitasking-headerstatus-bar-colors-with-a-simple-html-tag/" target="_blank">Chrome v39 On Lollipop Supports Custom Multitasking Header/Status Bar Colors With A Simple HTML Tag - Android Police</a></p><h3><a href="https://blog.halyul.cc/2016/12/31/main-theme-changing/#小背景"></a>小背景</h3><p>我的<a href="//halyul.cc">主站</a>网页代码中有以下几段：</p><pre><code><span>&lt;</span><span>!</span><span>--</span> jQuery Cookie <span>--</span><span>&gt;</span>    <span>&lt;</span>script src<span>=</span><span>&quot;js/jquery.cookie.js&quot;</span><span>&gt;</span><span>&lt;</span><span>/</span>script<span>&gt;</span>    <span>&lt;</span>script<span>&gt;</span>    <span>if</span> <span>(</span> $<span>.</span><span>cookie</span><span>(</span><span>'styleCookie'</span><span>)</span> <span>===</span> <span>'style-light.css'</span><span>)</span> <span>{</span>        <span>$</span><span>(</span><span>'html, body'</span><span>)</span><span>.</span><span>css</span><span>(</span><span>'background'</span><span>,</span> <span>'#eeeeee'</span><span>)</span><span>;</span><span>//用户读取到上次访问时，网站的样式为style-light.css，全站背景为白色</span>    <span>}</span> <span>else</span> <span>if</span> <span>(</span>$<span>.</span><span>cookie</span><span>(</span><span>'styleCookie'</span><span>)</span> <span>===</span> <span>'style.css'</span><span>)</span> <span>{</span>        <span>$</span><span>(</span><span>'html, body'</span><span>)</span><span>.</span><span>css</span><span>(</span><span>'background'</span><span>,</span> <span>'#222222'</span><span>)</span><span>;</span><span>//用户读取到上次访问时，网站的样式为style.css，全站背景为黑色</span>    <span>}</span>    <span>&lt;</span><span>/</span>script<span>&gt;</span>    <span>&lt;</span><span>!</span><span>--</span> jQuery Easing <span>--</span><span>&gt;</span>    <span>&lt;</span>script src<span>=</span><span>&quot;js/jquery.easing.1.3.js&quot;</span><span>&gt;</span><span>&lt;</span><span>/</span>script<span>&gt;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这几段是涉及到了主页右上角的主题变换开关——黑白风格的变换。</p><h2><a href="https://blog.halyul.cc/2016/12/31/main-theme-changing/#实现"></a>实现</h2><p>而作为Androider我，必须得实现状态栏变色啊！所以各种度娘后，找到了<a href="https://zhidao.baidu.com/question/936921982308974372.html" target="_blank">方法</a>。</p><p>我在源代码以及找到的方法的基础上，在上面的代码中添加以下代码：</p><pre><code><span>&lt;</span><span>!</span><span>--</span> jQuery Cookie <span>--</span><span>&gt;</span>    <span>&lt;</span>script src<span>=</span><span>&quot;js/jquery.cookie.js&quot;</span><span>&gt;</span><span>&lt;</span><span>/</span>script<span>&gt;</span>    <span>&lt;</span><span>!</span><span>--</span> Theme changing <span>--</span><span>&gt;</span>    <span>&lt;</span>script<span>&gt;</span>    <span>if</span> <span>(</span> $<span>.</span><span>cookie</span><span>(</span><span>'styleCookie'</span><span>)</span> <span>===</span> <span>'style-light.css'</span><span>)</span> <span>{</span>        <span>$</span><span>(</span><span>'html, body'</span><span>)</span><span>.</span><span>css</span><span>(</span><span>'background'</span><span>,</span> <span>'#eeeeee'</span><span>)</span><span>;</span><span>//用户读取到上次访问时，网站的样式为style-light.css，全站背景为白色</span>        <span>var</span> oMeta <span>=</span> document<span>.</span><span>createElement</span><span>(</span><span>'meta'</span><span>)</span><span>;</span><span>//生成一个新的 &lt;meta&gt;标签</span>        oMeta<span>.</span>name <span>=</span> <span>'theme-color'</span><span>;</span><span>//给该&lt;meta&gt;标签添加 name=&quot;theme-color&quot;属性</span>        oMeta<span>.</span>content <span>=</span> <span>'#eeeeee'</span><span>;</span><span>//给该&lt;meta&gt;标签添加 content = &quot;#eeeeee&quot;属性，状态栏颜色为白色</span>        document<span>.</span><span>getElementsByTagName</span><span>(</span><span>'head'</span><span>)</span><span>[</span><span>0</span><span>]</span><span>.</span><span>appendChild</span><span>(</span>oMeta<span>)</span><span>;</span><span>//将该&lt;meta&gt;标签放置在&lt;head&gt;&lt;/head&gt;前</span>    <span>}</span> <span>else</span> <span>if</span> <span>(</span>$<span>.</span><span>cookie</span><span>(</span><span>'styleCookie'</span><span>)</span> <span>===</span> <span>'style.css'</span><span>)</span> <span>{</span>        <span>$</span><span>(</span><span>'html, body'</span><span>)</span><span>.</span><span>css</span><span>(</span><span>'background'</span><span>,</span> <span>'#222222'</span><span>)</span><span>;</span><span>//用户读取到上次访问时，网站的样式为style.css，全站背景为黑色</span>        <span>var</span> oMeta <span>=</span> document<span>.</span><span>createElement</span><span>(</span><span>'meta'</span><span>)</span><span>;</span><span>//生成一个新的 &lt;meta&gt;标签</span>        oMeta<span>.</span>name <span>=</span> <span>'theme-color'</span><span>;</span><span>//给该&lt;meta&gt;标签添加 name=&quot;theme-color&quot;属性</span>        oMeta<span>.</span>content <span>=</span> <span>'#222222'</span><span>;</span><span>//给该&lt;meta&gt;标签添加 content = &quot;#eeeeee&quot;属性，状态栏颜色为黑色</span>        document<span>.</span><span>getElementsByTagName</span><span>(</span><span>'head'</span><span>)</span><span>[</span><span>0</span><span>]</span><span>.</span><span>appendChild</span><span>(</span>oMeta<span>)</span><span>;</span><span>//将该&lt;meta&gt;标签放置在&lt;head&gt;&lt;/head&gt;前</span>    <span>}</span>    <span>&lt;</span><span>/</span>script<span>&gt;</span>    <span>&lt;</span><span>!</span><span>--</span> jQuery Easing <span>--</span><span>&gt;</span>    <span>&lt;</span>script src<span>=</span><span>&quot;js/jquery.easing.1.3.js&quot;</span><span>&gt;</span><span>&lt;</span><span>/</span>script<span>&gt;</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中<code>oMeta</code>为变量，可以任意修改。</p></blockquote><p><strong> 由于Chrome每次加载只读取一次<code>&lt;meta&gt;</code>标签，所以更换主题后状态栏颜色必须刷新页面才能生效。</strong></p><p>然后就完成啦~</p><blockquote><p>然而这个东西卡了我3天。。。之前没有思路，甚至还将主站的主题变换功能去掉了。。。但现在终究是完成了~</p></blockquote><h2><a href="https://blog.halyul.cc/2016/12/31/main-theme-changing/#效果"></a>效果</h2><p>用户再次访问网站后，即可实现状态栏变色。</p><p><img src="https://img.halyul.com/images/2017/03/15/o_1b7vip7o71i9710d6kofcs482a.png" /><img src="https://img.halyul.com/images/2017/03/15/o_1b7vipr5g4g3tnig521disqh8a.png" /></p><p>从源代码也可以看到在</p><pre><code><span>&lt;</span><span>!</span><span>--</span> jQuery Easing <span>--</span><span>&gt;</span>    <span>&lt;</span>script src<span>=</span><span>&quot;js/jquery.easing.1.3.js&quot;</span><span>&gt;</span><span>&lt;</span><span>/</span>script<span>&gt;</span><span><span></span><span></span></span></code></pre><p>后多了一行黑色状态栏的代码</p><pre><code><span><span><span>&lt;</span>meta</span> <span>name</span><span><span>=</span><span>&quot;</span>theme-color<span>&quot;</span></span> <span>content</span><span><span>=</span><span>&quot;</span>#222222<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre><p>或是白色状态栏的代码</p><pre><code><span><span><span>&lt;</span>meta</span> <span>name</span><span><span>=</span><span>&quot;</span>theme-color<span>&quot;</span></span> <span>content</span><span><span>=</span><span>&quot;</span>#eeeeee<span>&quot;</span></span><span>&gt;</span></span><span><span></span></span></code></pre>]]></content>
        
        <summary type="html">
            
            主页都不知道给我换了多少次了，用不上了嗯。缘由大背景Android在KitKat时代加入了变色状态栏，而Chrome在版本v39可以通过读取网页中&amp;lt;meta name=&amp;quot;theme-color&amp;quot; content=&amp;quot;#3F51B5&amp;quot;&amp;
            
        </summary>
        
        <category term="技术"/>
        
        <category term="Android"/>
        
    </entry>
    
    <entry>
        <title>你好，Hexo！</title>
        <link href="https://blog.halyul.cc/2016/12/29/hello-hexo/"/>
        <id>https://blog.halyul.cc/2016/12/29/hello-hexo/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2017-01-01T01:10:53+00:00</published>
        <updated>2017-01-01T01:10:53+00:00</updated>
        
        <content type="html"><![CDATA[<p>今天终于将自己的博客建立了起来，虽然过程很曲折，但终归完成了！<br /><a></a><br />看来我要对我用到的教程全部备份一次，还要把部分资源丢到<a href="https://github.com/halyul" target="_blank">我的Github</a>上。。总觉得自己打开了一个无底洞。。</p>]]></content>
        
        <summary type="html">
            
            今天终于将自己的博客建立了起来，虽然过程很曲折，但终归完成了！看来我要对我用到的教程全部备份一次，还要把部分资源丢到我的Github上。。总觉得自己打开了一个无底洞。。
            
        </summary>
        
        <category term="杂"/>
        
        <category term="Hexo"/>
        
    </entry>
    
    <entry>
        <title>[Happy New Year] 2016 to 2017</title>
        <link href="https://itroy.cc/791"/>
        <id>https://itroy.cc/791</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2016-12-31T15:00:09+00:00</published>
        <updated>2016-12-31T15:00:09+00:00</updated>
        
        <content type="html"><![CDATA[<p>Banner 来自 <a href="https://aoaoao.me" target="_blank">树洞 – 海纳百川 ,有洞乃大</a> 。</p>
<h2>Review</h2>
<div>
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_00.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_01.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_02.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_03.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_04.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_05.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_06.png" /><br />
<img src="http://static.itroy.cc/wp-file/2016/12/2016to2017_07.png" /><br />

</div>
<p>（我好菜啊……） <img src="https://s.w.org/images/core/emoji/2.4/72x72/1f641.png" /></p>
<h2>2016 我都干啥了</h2>
<li>写一个 WordPress 主题（算是写了一个吧……）；</li>
<li>微博橙V了；</li>
<li>更改备案主体了；</li>
<li>买了一些域名；</li>
<li>主站 HTTP/2 了；</li>
<li>玩树莓派了；</li>
<li>全站 HTTPS 了；</li>
<li>换新主题了；</li>
<li>开了一堆新坑；</li>
<li>做了一个（伪）鬼畜；</li>
<li>吃上谷歌爸爸的 Google Analytics ；</li>
<li>全国青少年机器人竞赛吉林赛区竞赛一等奖了；</li>
<li>当了一周的全国中学生田径锦标赛志愿者；</li>
<li>认识了一堆人；</li>
<li>NOIP 初赛了；</li>
<li>分布式了；</li>
<li>写了个 Telegram Bot ；</li>
<li>读书观影了；</li>
<li><span>认识ta了；  <img src="https://s.w.org/images/core/emoji/2.4/72x72/1f609.png" /> </span></li>
<li>魔改了多说；</li>
<h2>2017 我想干点啥</h2>
<li>填旧坑；</li>
<li>开新坑；</li>
<li>写好个人页？</li>
<li>更新 ShortUrl？</li>
<li>做个小绿？</li>
<li>National University of Defense Technology？</li>
<li>小米6？</li>
<li>换PC？</li>
<li>换显示器？</li>
<li>用树莓派搞个（伪）智能家庭？</li>
<li>还没想好待补充？</li>
<h2>Red Pack</h2>
<p>没有红包。 <img src="https://s.w.org/images/core/emoji/2.4/72x72/1f641.png" /></p>
<p><span></span></p>
<li>bSBsZ29ycmJvICBvemVudHR5 （解密之后去掉空格 + 洲）</li>
<li>（如果你能更深一步的解出一句语句通顺的话并发给 Troy ，可获得专属红包一份~）</li>
<li>（我估计没几个人能发现有红包，能解开加密的人更少，能复原原话的人应该没有吧……）</li>
<p></p>
<p>真的没有。 <img src="https://s.w.org/images/core/emoji/2.4/72x72/1f641.png" /></p>
<p>参考链接：<a href="https://blog.lwl12.com/read/2016-year-simple-report.html" target="_blank">[LWL的自由天空 年度简报] – 纷繁与成长</a></p>
<h2>再说两句</h2>
<li>嗯……去年其实是有一个年终总结的，但是写（chao）的太烂了，所以改成未发布了……</li>
<li>希望新一年能有更多dalao同意和我交换友链，能有更多的 PV 和 UV 吧……</li>
<li>希望新一年能少出点 bug 吧……</li>
<li>希望新一年能不要辣么懒吧……</li>
<li>如果我没记错，再过 1 个小时就应该是 Blog 建立两周年了，希望新一年访问速度能更快，内容能更丰富吧……</li>
<li><del>刚才好像还想说点啥……</del></li>
<li><del>好像忘了……</del></li>
<li><del>算了，不管了……</del></li>
<h2>还有一丢丢</h2>
<p>谢谢大家陪我那么久，跟你们在一起的日子很开心。很遗憾，我就要脱团了，明年再回来，如果那时候你们还在，我们再续前缘。 没想到自己也有这么一天。 可能是累了吧，也可能是逐渐对代码丧失了兴趣。连续写了几天代码，仔细想了想，大概是需要一些短暂的休息，到了暂时退坑的时候。月有阴晴圆缺，也许我今年只能玩几行代码了。 那么，各位明年有缘再见。</p>
<p>Troy<br />
2016年12月31日</p>]]></content>
        
        <summary type="html">
            
            Banner 来自 树洞 – 海纳百川 ,有洞乃大 。 Review            （我好菜啊……）  2016 我都干啥了 写一个 WordPress 主题（算是写了一个吧……）； 微博橙V了； 更改备案主体了； 买了一些域名； 主站 HTTP/2 了； 玩树莓派了；
            
        </summary>
        
        <category term="日常"/>
        
    </entry>
    
    <entry>
        <title>Goodbye 2016</title>
        <link href="https://blog.nfz.moe/archives/good-bye-2016.html"/>
        <id>https://blog.nfz.moe/archives/good-bye-2016.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-12-31T13:32:18+00:00</published>
        <updated>2016-12-31T13:32:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>怎么说呢，过去的这一年发生了很多事情，无论是好事还是坏事。我摘出那些对我很重要的事情吧，也许其中一些甚至改变了我的人生。</p><a></a><hr /><p>对我来说今年最重要事情的是莫过于我拥有了自己的个人网站和自己的独立博客，从此我有了一个可以写属于我自己的文字的地方。<br />同时借助这个机会认识了不少技术 dalao 和菊苣。比如我博客这个主题的作者 <a href="https://viosey.com" target="_blank">Viosey</a>；建站方面给了我很多建议和帮助的 <a href="https://letitfly.me" target="_blank">guozixi</a> 和 <a href="https://blackyau.cc" target="_blank">蠢黑通行</a>；等等等等。</p><p>不得不承认因为这个我学会了很多，比如我因此学了如何 <del>正确地</del> 使用 Git 和 Github，还简单自学了一点点的 php 和 ejs，甚至还为 Material 主题的开发做了一点微小的贡献。</p><p>另一个重要的事件就是我来到了酷安。<br />不得不承认酷安的确像是一个社交平台而不是纯粹的应用市场。在这里可以和独立的个人开发者面对面平等谈话，也可以和其它折腾的 Android 爱好者交换心得，可以和酷安的小编们和开发团队 <del>PY 交易 </del> <del> 打情骂俏 </del> 友好交流，也可以发现很多深藏不露的 dalao。不得不承认，来酷安以后我的玩机水平和知识大有增长，获得了很多 Android 的资源，认识了很多搞<del> 基</del>机的 <del> 酷安基佬 </del> 酷友们，学会了如何更加彻底的对付 BAT 毒瘤。<br />我是 2016 年初来的酷安，也分享了一些自己的玩机技巧和资源，如今也把自己培养成了一个酷安小 V（500 出头的粉丝数，以及一堆活跃的、互粉的 <del> 酷安基佬 </del> 酷友们；仰望那些千粉的 dalao 中~）。</p><p>对我而言还有两件重要的事情，一件是我认识了网易云音乐（当初可能是为了找歌而且网易云的曲库比较完整吧），于是我没有像现在这样喜欢听音乐。。。音乐的确会引起人的共鸣，也是一个人与人交流的契机，而网易云和酷安一样都很看重社交。<br />还有就是我成为了中文 VOCALOID 的粉丝，自从听了那首《风中飞散的回忆》以后，就再也离不开中文 VOCALOID 了，从此我的网易云的每日推荐中就只剩下中 V 和纯音乐了。</p><p>还有就是有了一个自己微博（当初是我还在做 ROM 时用来和机油交流的，然后在微博上也认识了搞 Android 开发的菊苣们）。虽然渣浪微博吃枣药丸，但渣浪也好歹是一大社交媒体吧。现在在微博上也有了 500 粉丝，也能经常和一堆 dalao 们谈笑风生。</p><hr /><p>突然就变成碎碎念了。。。不论怎么说，我希望我的新的一年更好吧。</p>]]></content>
        
        <summary type="html">
            
            怎么说呢，过去的这一年发生了很多事情，无论是好事还是坏事。我摘出那些对我很重要的事情吧，也许其中一些甚至改变了我的人生。对我来说今年最重要事情的是莫过于我拥有了自己的个人网站和自己的独立博客，从此我有了一个可以写属于我自己的文字的地方。同时借助这个机会认识了不少技术 dalao
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>为Hexo的Material主题添加总图库以及分图库功能</title>
        <link href="https://blog.halyul.cc/2016/12/30/add-gallery/"/>
        <id>https://blog.halyul.cc/2016/12/30/add-gallery/</id>
        
        <author>
            <name>Halyul</name>
        </author>
        
        <published>2016-12-31T01:11:35+00:00</published>
        <updated>2016-12-31T01:11:35+00:00</updated>
        
        <content type="html"><![CDATA[<p>嗯现在博客换了主题这个用不上了惹。<br /><a></a></p><h2><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#起因"></a>起因</h2><p>今天将整个<a href="https://material.vss.im/" target="_blank">Material主题</a>研究了一遍，发现了这个主题自带图库，然而这个图库只能支持一个相册，想将相册分类是不可能的，故而稍加研究，自己添加了这个功能。</p><p>总图库由友情链接页面修改得来，子图库则为原图库页面。</p><h2><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#经过"></a>经过</h2><h3><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#添加总图库"></a>添加总图库</h3><h4><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#加入总图库入口"></a>加入总图库入口</h4><p>在主题文件夹下的<code>_config.yml</code>找到<code>pages</code>项，插入一行：<code>图库: &quot;/galleries/&quot;</code></p><blockquote><p>其中<code>图库</code>、<code>galleries</code>可修改。</p></blockquote><p>然后，在博客主目录的<code>source</code>文件夹中新建一个同名文件夹。</p><blockquote><p>例如我的文件夹名称为galleries。</p></blockquote><p>并新建一个<code>index.md</code>文件，加入以下代码：</p><pre><code><span>---</span>title: 图库date: 2016/12/30<span>layout: galleries<span>---</span></span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>title</code> 为网页标题，<code>图库</code>可修改，<code>galleries</code>可修改，但必须与上面的一致。</p></blockquote><p>再新建一个<code>_data</code>文件夹（不可改名）</p><h4><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#添加代码"></a>添加代码</h4><p>进入主题文件夹的<code>layout</code>文件夹中，打开<code>post.ejs</code>文件，找一个自己喜欢的位置，添加下面的代码。</p><pre><code><span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>其中第二行中<code>galleries</code>以及第三行的<code>page-galleries</code>可以修改。</p></blockquote><p>然后在<code>_widget</code>文件夹中复制<code>page-links.ejs</code>文件一份，重命名为<code>page-galleries.ejs</code>，打开并找到第83、84、86、87、89行的<br /><code>site.data.links</code>，替换为<code>site.data.galleries</code><br />，以及第87行<code>avatar</code>替换为<code>pic</code>。</p><blockquote><p><code>galleries</code>和<code>pic</code>可修改。</p></blockquote><h3><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#添加子图库"></a>添加子图库</h3><h4><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#加入子图库入口1"></a>加入子图库入口1</h4><p>进入博客主目录的<code>source/_data</code>文件夹中，新建一个<code>galleries.yml</code>文件，加入以下代码</p><pre><code><span>Name</span><span>:</span>    <span>link</span><span>:</span> http<span>:</span>//example.com/gallery1    <span>pic</span><span>:</span> http<span>:</span>//example.com/pic.png    <span>descr</span><span>:</span> <span>&quot;这是一个描述&quot;</span><span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>Name</code>修改为你的子图库名称，<code>gallery1</code>为你的子图库名称（中文未测试，这个名称后面会用到），<code>pic</code>为缩略图。</p></blockquote><h4><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#添加代码-1"></a>添加代码</h4><p>进入主题文件夹的<code>layout</code>文件夹中，打开<code>layout.ejs</code>文件，在</p><pre><code><span><span></span></span></code></pre><p>前添加以下代码</p><pre><code><span><span></span><span></span><span></span><span></span></span></code></pre><p>进入<code>_widget</code>文件夹中复制<code>page-gallery.ejs</code>文件一份，重命名为<code>page-gallery1.ejs</code>，打开并找到第25、26、28、30行<br /><code>site.data.gallery</code>，替换为<code>site.data.gallery1</code></p><blockquote><p><code>gallery1</code>均可修改，但必须与上面的一致。</p></blockquote><h4><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#加入子图库入口2"></a>加入子图库入口2</h4><p>在博客主目录的<code>source</code>文件夹中新建一个<code>gallery1</code>文件夹，并新建一个<code>index.md</code>文件，加入以下代码：</p><pre><code><span>---</span>title: 子图库date: 2016/12/30<span>layout: gallery1<span>---</span></span><span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>title</code> 为网页标题及页面左下角标题，<code>子图库</code>可修改，<code>galleries</code>可修改，但必须与上面的一致。</p></blockquote><p>进入<code>_data</code>文件夹，新建一个<code>gallery1.yml</code>文件，加入以下代码：</p><pre><code><span>Name</span><span>:</span>    <span>full_link</span><span>:</span> http<span>:</span>//example.com/pic1.png    <span>thumb_link</span><span>:</span> http<span>:</span>//example.com/pic1<span>-</span>thumb.png    <span>descr</span><span>:</span> <span>&quot;这是一个描述&quot;</span><span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>Name</code>修改为你的一张照片名称，<code>full_link</code>为你的照片的连接，<code>thumb_link</code>为该照片的缩略图。添加多张图片，只需要根据上面的格式重复填写即可。</p></blockquote><h2><a href="https://blog.halyul.cc/2016/12/30/add-gallery/#结果"></a>结果</h2><p>到这里完成了，自己去看看效果吧！<br />我的效果如下：</p><p><img src="https://img.halyul.com/images/2017/03/15/o_1b7vimbuo745scekls1vj81b8ba.png" /></p><p><img src="https://img.halyul.com/images/2017/03/15/o_1b7vimqhl7oj112vsjg5pn7vfa.png" /></p>]]></content>
        
        <summary type="html">
            
            嗯现在博客换了主题这个用不上了惹。起因今天将整个Material主题研究了一遍，发现了这个主题自带图库，然而这个图库只能支持一个相册，想将相册分类是不可能的，故而稍加研究，自己添加了这个功能。总图库由友情链接页面修改得来，子图库则为原图库页面。经过添加总图库加入总图库入口在主题
            
        </summary>
        
        <category term="技术"/>
        
        <category term="Hexo"/>
        
        <category term="教程"/>
        
    </entry>
    
    <entry>
        <title>A Fork in the Road — CM&#39;s last blog</title>
        <link href="https://blog.nfz.moe/archives/a-fork-in-the-road-cyangenmod.html"/>
        <id>https://blog.nfz.moe/archives/a-fork-in-the-road-cyangenmod.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-12-26T13:35:00+00:00</published>
        <updated>2016-12-26T13:35:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>Cyanogenmod 在他们的官网发布了最后一篇博客 <em>A Fork in the Road</em> 后，Cyanogenmod 官网和博客域名的 DNS 解析就被停了。</p><a></a><p> 所以仅有少数人读了 Cyanogenmod 这篇告别的博客。于是我将 CM 的这一篇博客转载到这里，同时衷心祝愿 Lineage OS 能够凤凰涅槃。</p><hr /><p>Last week, we released the final CM-13.0 releases, updated to the latest security patches, in anticipation of what follows.</p><p>Yesterday, Cyanogen Inc (Cyngn) announced that they were shutting down the infrastructure behind CyanogenMod (CM). This is an action that was not unpredictable given the public departure of Kondik (cyanogen himself) from the company, and with him our last remaining advocate inside Cyngn’s leadership.</p><p>In addition to infrastructure being retired, we in the CM community have lost our voice in the future direction of CM – the brand could be sold to a third party entity as it was an asset that Kondik risked to start his business and dream. Even if we were to regroup and rebuild our own infrastructure, continuing development of CM would mean to operate with the threat of sale of the brand looming over our heads. Then there is the stigma that has grown to be attached to anything named ‘Cyanogen’. Many of you reading this have been champions of clarifying that the CM product and CyngnOS were distinct, yet the stain of many PR actions from Cyngn is a hard one to remove from CM. Given CM’s reliance on Cyngn for monetary support and the shared source base, it’s not hard to understand why the confusion remains.</p><p>It will come as no surprise that this most recent action from Cyngn is definitely a death blow for CyanogenMod.</p><p>However, CM has always been more than the name and more than the infrastructure. CM has been a success based on the spirit, ingenuity and effort of its individual contributors – back when it was Kondik in his home, to the now thousands of contributors past and present.</p><p>Embracing that spirit, we the community of developers, designers, device maintainers and translators have taken the steps necessary to produce a fork of the CM source code and pending patches. This is more than just a ‘rebrand’. This fork will return to the grassroots community effort that used to define CM while maintaining the professional quality and reliability you have come to expect more recently.</p><p>CM has served the community well over its 8 long years. It has been our home, bringing together friends from all over the world to celebrate our joy of building and giving. Its apt then that on this Eve of a holiday we pay our respects. We will take pride in our Lineage as we move forward and continue to build on its legacy.</p><p>Thank you &amp; Goodbye,<br />The CyanogenMod Team</p><p><a href="https://www.cyanogenmod.org/blog/a-fork-in-the-road" target="_blank">https://www.cyanogenmod.org/blog/a-fork-in-the-road</a></p>]]></content>
        
        <summary type="html">
            
            Cyanogenmod 在他们的官网发布了最后一篇博客 A Fork in the Road 后，Cyanogenmod 官网和博客域名的 DNS 解析就被停了。 所以仅有少数人读了 Cyanogenmod 这篇告别的博客。于是我将 CM 的这一篇博客转载到这里，同时衷心祝愿 
            
        </summary>
        
        <category term="异闻堂"/>
        
        <category term="CM"/>
        
        <category term="ROM"/>
        
        <category term="Android"/>
        
        <category term="Cyangenmod"/>
        
        <category term="LineageOS"/>
        
    </entry>
    
    <entry>
        <title>Interactive 调速器有关参数分析</title>
        <link href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html"/>
        <id>https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-12-23T09:10:00+00:00</published>
        <updated>2016-12-23T09:10:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><code>Interactive</code>是目前常用的一种 CPU 调速器，其特点是 CPU 频率是根据负载实现交互式反应。但是与 <code>ondemand</code> 和<code>conserative</code>不同的是，<code>Interactive</code>拥有一些不同的参数配置方式。</p><a></a><blockquote><p>所以并不像一些人说的，什么 <code>ondemand</code> 非常敏感升频降频都快、<code>Interactive</code>升频快降频慢、<code>conserative</code>升频慢降频快。</p></blockquote><p>Interactive 可用的调速器参数有以下内容：</p><h1><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html# 负载 - 频率机制"></a>负载 - 频率机制 </h1><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#target-loads"></a>target_loads</h2><p> 这个参数的目的是根据 CPU 负载来调整频率：当 CPU 负载升高到该参数时，内核就会升高 CPU 的运行频率以便降低 CPU 负载。该参数的默认值为 90。</p><p>该参数的格式是单个固定数值，或者是频率和负载值成对出现用冒号隔开。</p><blockquote><p>比如 <code>85 1000000:90 1700000:99</code> 表示负载在 85% 以下时，CPU 频率要运行在 1GHz 以下；负载达到 90% 时，CPU 频率要运行在 1.0GHz~1.7GHz，直到 CPU 负载达到 99% 时，频率才会升到 1.7GHz 以上。</p></blockquote><p>一般地，该参数设置的越低，CPU 升频就会越快、越频繁。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#min-sample-time"></a>min_sample_time</h2><p>CPU 开始降低频率前的最小时间。也就是当负载下降到达较低的区间时还需要再经过多少时间 CPU 才开始降频（也可以简单理解成 CPU 两次降频之间的间隔值）。该值越小，对降频的反应就越敏感。该参数的默认值是 80000uS.</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#timer-rate- 和 -timer-slack"></a>timer_rate 和 timer_slack</h2><p>CPU 负载采样率。 和 <code>min_sample_time</code> 不同，<code>timer_rate</code>单纯仅仅只规定采样间隔。该设定值越小，负载采样越敏感，频率调整更为敏感，但受限于 <code>min_sample_time</code> <code>above_hispeed_delay</code> 等延迟参数。但是实际上的采样间隔可能会比设定值更长，最长时间为 <code>timer_rate</code> 和 <code>timer_slack</code> 之和。当 <code>timer_clack</code> 值为 -1 时则无上限。</p><p>调节这个参数一般不能使手机省电。比如将该值设置的较长，固然可以降低内核探看 CPU 负载的频率，节省电量，但是内核就不能及时感知到负载的下降而及时降频。这个参数的设置取决于你手机对于长线程进程的需求。</p><hr /><h1><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html# 应急反应机制"></a>应急反应机制 </h1><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#hispeed-freq"></a>hispeed_freq</h2><p> 这个参数的目的是指定面对突发的大负载做出应急的反应操作。也就是说当负载突然升高到 <code>go_hispeed_load</code> 且该核心正在运行在较低的频率时，CPU 运行频率会瞬间升高到这个参数指定的频率。这种情况一般都发生在暂时处于闲置的核心上。<code>hispeed_freq</code> 是一个理想的高性能工作频率, 假定该频率足以应对大多数高负载工作。当 CPU 运行在这个频率超过一段时间（即 <code>above_hispeed_delay</code>），CPU 才会继续升高频率。</p><p>这个参数如果设置得较低，那么应对突发的大负荷，CPU 的运行频率可能会较低而引起卡顿；如果该值设置的太高则比较容易引起发热。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#go-hispeed-load"></a>go_hispeed_load</h2><p>这个参数就是规定当 CPU 负载突然到达该值时且当前 CPU 处于闲置状态（离线亦或者是运行在较低频率），CPU 就会瞬间将频率升到 <code>hispeed_freq</code> 以便应对突发状况。该参数的默认值是 99。</p><p>一般地，这个值越低，对于突发的大负荷工作，CPU 的反应就会越敏感。如果该值设置的太高则比较容易面对一些突发负载无法立刻升频做出反应引起卡顿，设置的太低则会出现过于频繁的升频导致发热和耗电。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#above-hispeed-delay"></a>above_hispeed_delay</h2><p>这个参数是设置成当 CPU 频率运行在 <code>hispeed_freq</code> 甚至更高以后，突发的负载并没有立刻降低。当 CPU 运行在该频率的时间超过该参数的指定值后，CPU 就会进一步进行升频，以便应对大长线程的大负荷。该参数的默认值是 20000us。设置该参数时可以根据 CPU 所在的不同频率设置不同的延迟。</p><p>该参数的格式是单个固定数值，或者是频率和频率区间成对出现用冒号隔开。当参数中涉及到频率时，频率必须采用升序数列。</p><blockquote><p>比如 <code>19000 1400000:39000 1700000:19000</code> 表示当 CPU 频率在 1.4GHz 以下时 CPU 要在 <code>go_hispeed_load</code> 甚至更高的负载下运行超过 19000 us 才会进一步升频；运行频率在 1.4Ghz~1.7GHz 时延时设置为 39000us；超过 1.7GHz 时则采用 19000us 。</p></blockquote><p>当该参数设置得较小时 CPU 则会较快地升频（可能会引起卡顿），设置得较大时 CPU 可能会因为不能及时升频而引起卡顿。</p><hr /><h1><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html# 鸡血模式"></a>鸡血模式</h1><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#boost- 和 -boostpulse-duration"></a>boost 和 boostpulse_duration</h2><p><code>boost</code> 这个参数由内核写入。如果非零，立即提高所有 CPU 的频率到该 CPU 的 <code>hispeed_freq</code> 甚至更高，直到零被写入此属性，期间无论负载是否降低都不会引起频率的改变。如果为零，则会允许 CPU 频率根据负载而降低到低于 <code>hispeed_freq</code> 设定的频率。默认值为零。<br /><code>boostpulse_duration</code> 指在每次 <code>boost</code> 被写入后，CPU 的频率被提升到 <code>hispeed_freq</code> 后在该频率下运行的最低间隔。在该间隔之内，就算 <code>boost</code> 值重新设为零，CPU 仍不会降频。</p><hr /><h1><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html# 其它参数"></a>其它参数 </h1><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#io-is-busy"></a>io_is_busy</h2><p> 这个参数决定是否根据设备的存储有关的 I/O （包括数据在存储上的读写、数据库的修改、熵的增加等）而提升 CPU 频率，以便加快 I/O 性能。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#align-windows"></a>align_windows</h2><p>是否对齐所有 CPU 的计时器窗口。对齐的优点是同时评估整个簇的 CPU 以便获得对整个簇的 CPU 的负载信息。缺点是整个簇的 CPU 会同时上线和同时离线导致性能突然增加或突然下降。现在一般都不会开启。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#scaling-min-freq- 和 -scaling-max-freq"></a>scaling_min_freq 和 scaling_max_freq</h2><p>在 CPU 的设计的容许频率范围内（一般都是由内核规定）再设定一个 CPU 的运行频率区间，内核将会在这个区间内选择 CPU 的运行频率。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#ignore-hispeed-on-notif"></a>ignore_hispeed_on_notif</h2><p>如果该参数非零，则频率的改变由调度程序触发，则不应用上述与频率设定相关的逻辑（比如不再根据负载控制频率）。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#fast-ramp-down"></a>fast_ramp_down</h2><p>如果非零，则不应用 <code>min_sample_time</code>。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#max-freq-hysteresis"></a>max_freq_hysteresis</h2><p>这是 <code>interave</code> 调速器的一个扩展，保持 <code>Interactive</code> 调速器在 <code>policy-&gt; max</code> 的时间。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#use-sched-load"></a>use_sched_load</h2><p>如果该值非零，则 <code>align_windows</code> 则不会生效。</p><h2><a href="https://blog.nfz.moe/archives/cpu-governer-interative-core-ctl.html#use-migration-notif"></a>use_migration_notif</h2><p>是否在所有 CPU 之间对齐定时器窗口。</p><hr /><p>本文参考了 linux CPU 调速器机制文档和 CAF 的相关文档。</p>]]></content>
        
        <summary type="html">
            
            Interactive是目前常用的一种 CPU 调速器，其特点是 CPU 频率是根据负载实现交互式反应。但是与 ondemand 和conserative不同的是，Interactive拥有一些不同的参数配置方式。所以并不像一些人说的，什么 ondemand 非常敏感升频降频都
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Android"/>
        
        <category term="温控"/>
        
        <category term="CPU"/>
        
        <category term="Interactive"/>
        
        <category term="调速器"/>
        
    </entry>
    
    <entry>
        <title>HTTPS 常见部署问题及解决方案</title>
        <link href="https://imququ.com/post/troubleshooting-https.html"/>
        <id>https://imququ.com/post/troubleshooting-https.html</id>
        
        <published>2016-12-12T15:50:26+00:00</published>
        <updated>2016-12-12T15:50:26+00:00</updated>
        
        <content type="html"><![CDATA[<p>在最近几年里，我写了很多有关 HTTPS 和 HTTP/2 的文章，涵盖了证书申请、Nginx 编译及配置、性能优化等方方面面。在这些文章的评论中，不少读者提出了各种各样的问题，我的邮箱也经常收到类似的邮件。本文用来罗列其中有代表性、且我知道解决方案的问题。</p>
<p>为了控制篇幅，本文尽量只给出结论和引用链接，不展开讨论，如有疑问或不同意见，欢迎留言讨论。本文会持续更新，欢迎大家贡献自己遇到的问题和解决方案。</p>
<blockquote>
<p>实际上，遇到任何有关部署 HTTPS 或 HTTP/2 的问题，都推荐先用 <a href="https://www.ssllabs.com/ssltest/index.html">Qualys SSL Labs's SSL Server Test</a> 跑个测试，大部分问题都能被诊断出来。</p>
</blockquote>
<h3>申请 Let's Encrypt 证书时，一直无法验证通过</h3>
<p>这类问题一般是因为 Let's Encrypt 无法访问你的服务器，推荐尝试 <a href="https://github.com/Neilpang/acme.sh">acme.sh</a> 的 <a href="https://github.com/Neilpang/acme.sh#7-use-dns-mode">DNS 验证模式</a>，一般都能解决。 </p>
<h3>网站无法访问，提示 ERR_CERTIFICATE_TRANSPARENCY_REQUIRED</h3>
<p>使用 Chrome 53 访问使用 Symantec 证书的网站，很可能会出现这个错误提示。这个问题由 Chrome 的某个 Bug 引起，目前最好的解决方案是升级到 Chrome 最新版。相关链接：</p>
<ul>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=664177">Out of date Chrome results in ERR_CERTIFICATE_TRANSPARENCY_REQUIRED for Symantec operated sites</a>；</li>
<li><a href="https://knowledge.symantec.com/support/ssl-certificates-support/index?page=content&amp;id=ALERT2160">Warning | Certificate Transparency error with Chrome 53</a>；</li>
</ul>
<h3>浏览器提示证书有错误</h3>
<h4>检查证书链是否完整</h4>
<p>首先确保网站使用的是合法 CA 签发的有效证书，其次检查 Web Server 配置中证书的完整性（一定要包含站点证书及所有中间证书）。如果缺失了中间证书，部分浏览器能够自动获取但严重影响 TLS 握手性能；部分浏览器直接报证书错误。</p>
<blockquote>
<p><a href="https://whatsmychaincert.com/">What's My Chain Cert?</a> 这个网站可以用来检查证书链是否完整，它还可以用来生成正确的证书链。</p>
</blockquote>
<h4>检查浏览器是否支持 SNI</h4>
<p>如果只有老旧浏览器（例如 IE8 on Windows XP）提示这个错误，多半是因为你的服务器同时部署了使用不同证书的多个 HTTPS 站点，这样，不支持 SNI（Server Name Indication）的浏览器通常会获得错误的证书，从而无法访问。</p>
<p>要解决浏览器不支持 SNI 带来的问题，可以将使用不同证书的 HTTPS 站点部署在不同服务器上；还可以利用 SAN（Subject Alternative Name）机制将多个域名放入同一张证书；当然你也可以直接无视这些老旧浏览器。特别地，使用不支持 SNI 的浏览器访问商业 HTTPS CDN，基本都会因为证书错误而无法使用。</p>
<blockquote>
<p>有关 SNI 的更多说明，请看「<a href="https://imququ.com/post/sth-about-switch-to-https-2.html#toc-2">关于启用 HTTPS 的一些经验分享（二）</a>」。</p>
</blockquote>
<h4>检查系统时间</h4>
<p>如果用户电脑时间不对，也会导致浏览器提示证书有问题，这时浏览器一般都会有明确的提示，例如 Chrome 的 ERR_CERT_DATE_INVALID。</p>
<h3>启用 HTTP/2 后网站无法访问，提示 ERR_SPDY_INADEQUATE_TRANSPORT_SECURITY</h3>
<p>这个问题一般是由于 CipherSuite 配置有误造成的。建议对照「<a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_configurations">Mozilla 的推荐配置</a>、<a href="https://github.com/cloudflare/sslconfig/blob/master/conf">CloudFlare 使用的配置</a>」等权威配置修改 Nginx 的 <code>ssl_ciphers</code> 配置项。</p>
<blockquote>
<p>有关这个问题的具体原因，请看「<a href="https://imququ.com/post/why-tls-handshake-failed-with-http2-enabled.html">从启用 HTTP/2 导致网站无法访问说起</a>」。</p>
</blockquote>
<h3>网站无法访问，提示 ERR_SSL_VERSION_OR_CIPHER_MISMATCH</h3>
<p>出现这种错误，通常都是配置了不安全的 SSL 版本或者 CipherSuite —— 例如服务器只支持 SSLv3，或者 CipherSuite 只配置了 RC4 系列，使用 Chrome 访问就会得到这个提示。解决方案跟上一节一样。</p>
<p>还有一种情况会出现这种错误 —— 使用不支持 ECC 的浏览器访问只提供 ECC 证书的网站。例如在 Windows XP 中，使用 ECC 证书的网站只有 Firefox 能访问（Firefox 的 TLS 自己实现，不依赖操作系统）；Android 平台中，也需要 Android 4+ 才支持 ECC 证书。</p>
<blockquote>
<p>针对不支持 ECC 证书的浏览器，有一个完美的解决方案，请看「<a href="https://imququ.com/post/ecc-certificate.html">开始使用 ECC 证书</a>」。</p>
</blockquote>
<h3>在 Nginx 启用 HTTP/2 后，浏览器依然使用 HTTP/1.1</h3>
<p>Chrome 51+ 移除了对 NPN 的支持，只支持 ALPN，而浏览器和服务端都支持 NPN 或 ALPN，是用上 HTTP/2 的大前提。换句话说，如果服务端不支持 ALPN，Chrome 51+ 无法使用 HTTP/2。</p>
<p>OpenSSL 1.0.2 才开始支持 ALPN —— 很多主流服务器系统自带的 OpenSSL 都低于这个版本，所以推荐在编译 Web Server 时自己指定 OpenSSL 的位置。</p>
<blockquote>
<p>详见「<a href="https://imququ.com/post/enable-alpn-asap.html">为什么我们应该尽快支持 ALPN</a>」。</p>
</blockquote>
<h3>升级到 HTTPS 后，网站部分资源不加载或提示不安全</h3>
<p>记住一个原则：HTTPS 网站的所有外链资源（CSS、JS、图片、音频、字体文件、异步接口、表单 action 地址等等）都需要升级为 HTTPS，就不会遇到这个问题了。</p>
<blockquote>
<p>详见「<a href="https://imququ.com/post/sth-about-switch-to-https-3.html">关于启用 HTTPS 的一些经验分享（三）</a>」。</p>
</blockquote>
<h3>仅 Safari、iOS 各种浏览器无法访问</h3>
<p>如果你的 HTTPS 网站用 PC Chrome 和 Firefox 访问一切正常，但 macOS Safari 和 iOS 各种浏览器无法访问，有可能是 Certificate Transparency 配置有误。当然，如果你之前没有通过 TLS 扩展启用 Certificate Transparency，请跳过本小节。</p>
<p>具体症状是：通过 Wireshark 抓包分析，通常能看到名为 Illegal Parameter 的 Alert 信息；通过 <code>curl -v</code> 排查，一般能看到 Unknown SSL protocol error in connection 错误提示。</p>
<p>这时候，请进入 Nginx <code>ssl_ct_static_scts</code> 配置指定的目录，检查 SCT 文件大小是否正常，尤其要关注是否存在空文件。</p>
<blockquote>
<p>需要注意的是：根据<a href="https://groups.google.com/a/chromium.org/forum/#!msg/ct-policy/u87C79AY-E8/VM4K1v8qCgAJ">官方公告</a>，从 2016 年 12 月 1 日开始，Google 的 Aviator CT log 服务将不再接受新的证书请求。用 <a href="https://github.com/grahamedgecombe/ct-submit">ct-submit</a> 等工具手动获取 SCT 文件时，不要再使用 Aviator 服务，否则就会得到空文件。</p>
<p>更新：nginx-ct 的作者已经发布了 <a href="https://github.com/grahamedgecombe/nginx-ct/releases">v1.3.2</a>，针对零字节的 SCT 文件做了处理，不再发送。</p>
</blockquote>
<h3>将 OpenSSL 升级到 1.1.0+，IE8 无法访问</h3>
<p>造成这个问题的根本原因是 OpenSSL 1.1.0+ 默认禁用了 3DES 系列的 Cipher Suites：</p>
<blockquote>
<p>For the 1.1.0 release, which we expect to release tomorrow, we will treat triple-DES just like we are treating RC4. It is not compiled by default; you have to use “enable-weak-ssl-ciphers” as a config option. <a href="https://www.openssl.org/blog/blog/2016/08/24/sweet32/">via</a></p>
</blockquote>
<p>升级到 OpenSSL 1.1.0+ 之后，要么选择不支持 Windows XP + IE8；要么在编译时加上 <code>enable-weak-ssl-ciphers</code> 参数。例如这是我的 Nginx 编译参数：</p>
<pre><code>./configure --add-module=../ngx_brotli --add-module=../nginx-ct-1.3.2 --with-openssl=../openssl --with-openssl-opt=<span>'enable-tls1_3 enable-weak-ssl-ciphers'</span> --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module
</code></pre>
<p>本文链接：<a href="https://imququ.com/post/troubleshooting-https.html">https://imququ.com/post/troubleshooting-https.html</a>，<a href="https://imququ.com/post/troubleshooting-https.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            在最近几年里，我写了很多有关 HTTPS 和 HTTP/2 的文章，涵盖了证书申请、Nginx 编译及配置、性能优化等方方面面。在这些文章的评论中，不少读者提出了各种各样的问题，我的邮箱也经常收到类似的邮件。本文用来罗列其中有代表性、且我知道解决方案的问题。 为了控制篇幅，本文
            
        </summary>
        
    </entry>
    
    <entry>
        <title>开始使用 VeryNginx</title>
        <link href="https://imququ.com/post/use-verynginx.html"/>
        <id>https://imququ.com/post/use-verynginx.html</id>
        
        <published>2016-12-10T15:35:53+00:00</published>
        <updated>2016-12-10T15:35:53+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://github.com/alexazhou/VeryNginx">VeryNginx</a> 是一个功能强大而对人类友好的 Nginx 扩展程序，这是作者的原话。很久之前我就看到过这个项目，直到最近我才在本站试用了一把，确实好用，于是想通过本文把它介绍给更多人。</p>
<p>VeryNginx 主要由两部分组成：基于 lua-nginx-module 开发的 Lua 脚本，以及基于 HTML/CSS/JS 开发的 Web 控制面板 —— 用于生成和管理 Lua 脚本所需配置。</p>
<p>lua-nginx-module 能让 Lua 脚本直接跑在 Nginx 内部，比用 C 语言开发 Nginx 模块更容易上手，同时还能充分利用 Nginx 的非阻塞 I/O 模型，非常适合开发功能复杂、性能优异的 Web 应用。它也是大家熟知的 OpenResty 套件中一个最核心的模块。</p>
<p>VeryNginx 通过在请求的不同阶段（如 init_by_lua*/rewrite_by_lua*/access_by_lua*/log_by_lua*）执行不同 Lua 脚本，实现给请求打标签及对拥有不同标签的请求进行不同的处理的功能。除此之外，它还支持常见的统计报表展示。</p>
<h3>安装 VeryNginx</h3>
<p>VeryNginx 依赖以下三个 Nginx 模块：</p>
<ul>
<li>lua-nginx-module</li>
<li>http_stub_status_module</li>
<li>http_ssl_module</li>
</ul>
<p>如果对 Nginx 没有定制化需求，建议直接使用 VeryNginx 默认的安装脚本，它会同时装好 VeryNginx 自身和 OpenResty 套件，最为方便。具体步骤请查看<a href="https://github.com/alexazhou/VeryNginx/blob/master/readme_zh.md">官方文档</a>。</p>
<p>对于我这样喜欢各种折腾 Nginx 的人来说，修改之前的 Nginx 编译步骤，把上面三个模块加进去，也不算复杂。具体步骤后面再介绍，先来搞定 VeryNginx 工具本身。</p>
<p>这一步很简单：下载 VeryNginx 最新版代码并安装即可：</p>
<pre><code>wget https://github.com/alexazhou/VeryNginx/archive/v0.3.3.zip
unzip v0.3.3.zip

<span>cd</span> VeryNginx-0.3.3/
sudo python install.py install verynginx

<span>cd</span> ../
</code></pre>
<p>安装 VeryNginx 用到了 Python 脚本，但这个项目跟 Python 没有半毛钱关系，不信可以看下 <code>install.py</code> 中的 <code>install_verynginx</code> 方法，只做了拷贝文件和修改配置目录权限两件事。</p>
<p>VeryNginx 默认会被装到 <code>/opt/verynginx/</code> 目录，本文使用默认配置。</p>
<h3>编译 Nginx</h3>
<p>VeryNginx 依赖的 <code>http_stub_status_module</code> 和 <code>http_ssl_module</code> 只需要在 configure 时加上就可以。<code>lua-nginx-module</code> 稍微麻烦一点，它有以下依赖：</p>
<ul>
<li>LuaJIT 2.0 或 LuaJIT 2.1（推荐）或 Lua 5.1（5.2 目前不支持）；</li>
<li>ngx_devel_kit（NDK）；</li>
<li>ngx_lua 源码；</li>
</ul>
<p>下面分别来搞定它们。本文使用 Ubuntu 16.04.1 LTS，全部采用默认路径安装。如果你的环境跟我不一样，一些命令请自行调整。</p>
<h4>LuaJIT</h4>
<p>下载并安装 <a href="http://luajit.org/download.html">LuaJIT</a>：</p>
<pre><code>wget http://luajit.org/download/LuaJIT-2.1.0-beta2.zip
unzip LuaJIT-2.1.0-beta2.zip

<span>cd</span> LuaJIT-2.1.0-beta2/
make
sudo make install

<span>cd</span> ../
</code></pre>
<p>设置环境变量：</p>
<pre><code>export LUAJIT_LIB=/usr/local/lib
export LUAJIT_INC=/usr/local/include/luajit-2.1/
</code></pre><h4>ngx_devel_kit</h4>
<p>下载并解压 <a href="https://github.com/simpl/ngx_devel_kit">ngx_devel_kit</a>：</p>
<pre><code>wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.zip
unzip v0.3.0.zip
</code></pre>
<h4>ngx_lua</h4>
<p>下载并解压 <a href="https://github.com/openresty/lua-nginx-module/releases">ngx_lua</a>：</p>
<pre><code>wget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.zip
unzip v0.10.7.zip
</code></pre>
<h4>Nginx</h4>
<p>本站编译 Nginx 的详细步骤，都记录在<a href="https://imququ.com/post/my-nginx-conf.html">这篇文章</a>，可以照搬。只有 configure 要改一下：</p>
<pre><code>./configure --with-ld-opt=&quot;-Wl,-rpath,/usr/local/lib/&quot; --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.7 --add-module=../ngx_brotli --add-module=../nginx-ct-1.3.2 --with-openssl=../openssl --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_stub_status_module

make
#make install 前请务必停止已有 Nginx 服务，sudo /etc/init.d/nginx stop
sudo make install
</code></pre><p>编译并安装好 Nginx 之后，建议通过 <code>-V</code> 参数再次确认：</p>
<pre><code>/usr/<span>local</span>/nginx/sbin/nginx -V

nginx version: nginx/1.11.7
built by gcc 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4)
built with OpenSSL 1.0.2j  26 Sep 2016
TLS SNI support enabled
configure arguments: --with-ld-opt=-Wl,-rpath,/usr/<span>local</span>/lib/ --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.7 --add-module=../ngx_brotli --add-module=../nginx-ct-1.3.1 --with-openssl=../openssl --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_stub_status_module
</code></pre>
<h3>配置 VeryNginx</h3>
<p>在 Nginx 中引入 VeryNginx 的配置文件，就可以让 VeryNginx 工作起来。首先要修改的是 Nginx 的主配置，一般位于 <code>/usr/local/nginx/conf/nginx.conf</code>。</p>
<p>在主配置文件的最外层，加入以下配置：</p>
<pre><code>include /opt/verynginx/verynginx/nginx_conf/in_external.conf;
</code></pre>
<p>在主配置的 <code>http</code> 段落中，加入以下配置：</p>
<pre><code>include /opt/verynginx/verynginx/nginx_conf/in_http_block.conf;
</code></pre>
<p>在具体站点配置的 <code>server</code> 段落中，加入以下配置：</p>
<pre><code>include /opt/verynginx/verynginx/nginx_conf/in_server_block.conf;
</code></pre>
<p>加完之后，建议通过 <code>-t</code> 参数确保配置无误：</p>
<pre><code>/usr/<span>local</span>/nginx/sbin/nginx -t
</code></pre>
<p>如果提示 <code>test is successful</code>，说明配置无误，可以重启 Nginx 服务；否则请根据提示排查。</p>
<p>如果一切顺利，访问 <code>http://yourdomain.com/verynginx/index.html</code> 就可以见到 VeryNginx 的 Web 控制面板。默认用户名和密码都是 <code>verynginx</code>，登录后请务必修改。</p>
<h3>使用示例</h3>
<p>VeryNginx 使用非常简便，基本上不需要做过多说明。只是有一点需要注意：在 Web 控制面板中对任何配置项进行增删改之后，在点击页面右下角「Save」按钮之前并不会生效；点击「Reload」可还原到上一次配置。</p>
<p>VeryNginx 可以根据多种特征（Client IP、Host、UserAgent、URI、Referer、Request Args）来组合出不同的规则，用来给请求打上标记（Matcher）；可以给拥有不同标记的请求指定不同的处理动作（Custom Action）。</p>
<p>下面通过一个实际案例来演示 VeryNginx 的基本用法。</p>
<p>最近我发现某搜索引擎对本站的索引中，有大量重复内容（一共索引了 5000 多条记录，其他搜索引擎都只有几百）：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/12/site-imququ-com-in-sogou.png" /></p>
<p>一般来说，并不是说搜索引擎收录的页面越多越好，相反如果收录的不同 URL 都指向了同样的内容，很可能被判作弊，从而导致站点被降权。</p>
<p>从访问日志中，可以看到这家搜索引擎在大量抓取本站首页，并带上了一个无意义的 p 参数：</p>
<pre><code>106.120.173.72 - - [10/Dec/2016:05:50:43 +0800] <span>&quot;GET /index.html?p=142&amp;pn=7 HTTP/1.1&quot;</span> 200 6098 <span>&quot;-&quot;</span> <span>&quot;Sogou web spider/4.0(+http://www.sogou.com/docs/help/webmasters.htm#07)&quot;</span> 0.007 0.007
106.120.173.72 - - [10/Dec/2016:05:50:53 +0800] <span>&quot;GET /index.html?p=134&amp;pn=1 HTTP/1.1&quot;</span> 200 4793 <span>&quot;-&quot;</span> <span>&quot;Sogou web spider/4.0(+http://www.sogou.com/docs/help/webmasters.htm#07)&quot;</span> 0.007 0.007
106.120.173.72 - - [10/Dec/2016:05:51:03 +0800] <span>&quot;GET /index.html?p=94&amp;pn=1 HTTP/1.1&quot;</span> 200 4793 <span>&quot;-&quot;</span> <span>&quot;Sogou web spider/4.0(+http://www.sogou.com/docs/help/webmasters.htm#07)&quot;</span> 0.006 0.006
</code></pre>
<p>本站没有使用 p 参数，这样会导致 Spider 抓取的页面虽然 URL 不一样，但内容完全一样，从而导致大量重复索引。如果是 Google 出现这种情况，可以通过 Google Webmaster 告诉 Spider 忽略指定参数。但这家搜索引擎的站长平台我一直无法认证成功，所以这条路不通。</p>
<p>有了 VeryNginx，这种情况就很好处理了。首先通过 UserAgent 是否包含关键字、请求中是否存在 p 参数两个条件，对流量进行标记：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/12/very-nginx-matcher.png" /></p>
<p>然后使用「Filter」这个 Custom Action，直接将拥有这个标记的流量响应为 404：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/12/very-nginx-action.png" /></p>
<p>在 Web 控制面板保存配置后，立即生效。马上来测试一下：</p>
<pre><code>curl -I -H<span>'User-Agent: Sogou web spider/4.0(+http://www.sogou.com/docs/help/webmasters.htm#07)'</span> <span>'https://imququ.com/?p=95&amp;pn=17'</span>

HTTP/1.1 404 Not Found
Server: nginx
... ...
</code></pre>
<p>是不是很棒！通常，如果搜索引擎发现某个网址多次无法访问，就会从将其从索引库及 Spider 抓取列表中移除。</p>
<p>可以看到，使用 VeryNginx 对特定流量进行标记和干预，比直接修改 Nginx 配置方便得多，也强大得多。除了前面演示的「Filter」之外，VeryNginx 还提供了「Scheme Lock、Redirect、URI Rewrite、Browser Verify、Frequency Limit」这几个 Custom Action，其中「Browser Verify」可以用来验证发起请求的客户端是否支持 Cookie 或者 JavaScript，达到防 CC 攻击的目的。</p>
<p>大家都知道，我特别关注本站的访问速度。经过这段时间的试用，VeryNginx 在请求处理和内存占用上的表现，都令人满意。</p>
<p>本文就写到这里，如果想要了解 VeryNginx 更多细节，推荐查看<a href="https://github.com/alexazhou/VeryNginx/wiki/%E7%9B%AE%E5%BD%95">官方文档</a>。</p>
<p>本文链接：<a href="https://imququ.com/post/use-verynginx.html">https://imququ.com/post/use-verynginx.html</a>，<a href="https://imququ.com/post/use-verynginx.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            VeryNginx 是一个功能强大而对人类友好的 Nginx 扩展程序，这是作者的原话。很久之前我就看到过这个项目，直到最近我才在本站试用了一把，确实好用，于是想通过本文把它介绍给更多人。 VeryNginx 主要由两部分组成：基于 lua-nginx-module 开发的 L
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Troy’s Blog 现已更新至 WordPress 4.7</title>
        <link href="https://itroy.cc/768"/>
        <id>https://itroy.cc/768</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2016-12-10T07:38:27+00:00</published>
        <updated>2016-12-10T07:38:27+00:00</updated>
        
        <content type="html"><![CDATA[<p>Troy’s Blog 现已更新至 WordPress 4.7.</p>]]></content>
        
        <summary type="html">
            
            Troy’s Blog 现已更新至 WordPress 4.7.
            
        </summary>
        
        <category term="WordPress"/>
        
        <category term="状态"/>
        
        <category term="网站"/>
        
    </entry>
    
    <entry>
        <title>Documents from StuDocu without watermark</title>
        <link href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/"/>
        <id>https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2016-12-06T04:38:59+00:00</published>
        <updated>2016-12-06T04:38:59+00:00</updated>
        
        <content type="html"><![CDATA[<p>Trying to download some documents from <a href="https://www.studocu.com" target="_blank">StuDocu</a>, namely those past papers and slides. Even you can easily get free premium for months, but there’s always annoying watermark blocking your vision. Really I have tried to write a script to programmatically remove the watermark, but <em>PDF is Evil.</em> So, I kinda worked out a workaround, generate PDF from the webpage.<br /><a></a></p>
<h2><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x000-Load-all-the-SVG-pages"></a>0x000: Load all the SVG pages</h2><p>Since StuDocu has a pretty easy way to get a premium, and some measures for anti-scrawler, we can simply just get a premium account, open up the document, and scroll <em>slowly</em> down to load all pages. From the dev tools, we can easily see that those pages are in SVG, with base64 encoded @font-face fonts embedded.</p>
<p>Note that if you scroll too fast, you’ll miss some pages in between. It seems that the pages are loaded by your current viewport vertical offset.</p>
<h2><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x010-Convert-to-PDF"></a>0x010: Convert to PDF</h2><h3><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x011-Short-simple-documents"></a>0x011: Short, simple documents</h3><p>If it’s simple documents, of uniform common printing sizes, and a handleable number of pages, you can just use Chrome to print it out as PDF.</p>
<p>First, remove all useless elements from the web. Drop it in your OmniBar, or run it in the DevTools console.</p>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>javascript:(<span><span>function</span>(<span></span>)</span>{<span>var</span> a = <span>&quot;&quot;</span>, x = <span>document</span>.getElementsByTagName(<span>&quot;svg&quot;</span>); <span>for</span>(<span>var</span> i = <span>0</span>; i &lt; x.length; i++){a += x[i].outerHTML;} <span>document</span>.getElementsByTagName(<span>&quot;body&quot;</span>)[<span>0</span>].innerHTML = a;<span>var</span> a = <span>document</span>.getElementsByTagName(<span>&quot;svg&quot;</span>);<span>for</span> (<span>var</span> i = <span>0</span>; i &lt; a.length; i++){a[i].style.width=<span>&quot;99.8%&quot;</span>;a[i].style.height=<span>&quot;auto&quot;</span>;a[i].style.position=<span>&quot;inherit&quot;</span>;a[i].style.display=<span>&quot;block&quot;</span>;a[i].style.boxShadow=<span>&quot;0 3px 3px rgba(0,0,0,0.3)&quot;</span>;a[i].style.padding=<span>&quot;0&quot;</span>;}})()</div></pre></td></tr></table>
<p>Then print as PDF, choose the correct orientation, paper size, and don’t forget to turn on <strong>Background graphics</strong>, ant set margins to <strong>None</strong>.</p>
<p>Simple and elegant, right?</p>
<h3><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x012-All-other-documents"></a>0x012: All other documents</h3><p>But things get complicated when your browser can’t get hold on your lengthy, heavy or odd sized documents. If you are a perfectionist like me, and you’re okay with going through a detour, this is for you.</p>
<h4><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x0120-Dependencies"></a>0x0120: Dependencies</h4><p>Quite a few of stuff I have used for the detour.</p>
<ul>
<li>Python 3<ul>
<li>Beautiful Soup 3</li>
</ul>
</li>
<li>PhantomJS</li>
<li>pdftk</li>
</ul>
<p>It should be easy to install on most *nix environments.</p>
<h4><a href="https://blog.1a23.com/2016/12/06/Documents-from-StuDocu-without-watermark/#0x0121-How-to-do-it"></a>0x0121: How to do it</h4><p>Firstly, save the webpage with all the pages loaded. Save it into a new folder, and run it with the following Python script.</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div></pre></td><td><pre><div><span>import</span> bs4</div><div><span>import</span> sys</div><div><span>if</span> len(sys.argv) &lt; <span>2</span>:</div><div>    print(<span>&quot;Usage: %s file&quot;</span> % sys.argv[<span>0</span>])</div><div>    exit()</div><div>s = bs4.BeautifulSoup(open(sys.argv[<span>1</span>]))</div><div>x = s.find_all(<span>'svg'</span>)</div><div>digits = len(str(len(x)))</div><div>p = <span>&quot;Page%0{}d.svg&quot;</span>.format(digits)</div><div><span>for</span> i <span>in</span> range(len(x)):</div><div>    <span>with</span> open(p % i, <span>'w'</span>) <span>as</span> f:</div><div>        f.write(str(x[i]))</div></pre></td></tr></table>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>$ python3 html2svg.py myhtmldoc.html</div></pre></td></tr></table>
<p>Then get PhantomJS to convert each SVG to PDF. Reason why I choose PhantomJS is because only WebKit can recognize <code>@font-face</code> embed fonts, tool like <code>rsvg</code>, <code>inkscape</code>, and <code>cairosvg</code> doesn’t do it so well. PhantomJS is rather more customizable compare to <code>wkhtmltopdf</code> in term of page size.</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div></pre></td><td><pre><div><span>&quot;use strict&quot;</span>;</div><div><span>var</span> page = <span>require</span>(<span>'webpage'</span>).create(),</div><div>    system = <span>require</span>(<span>'system'</span>),</div><div>    address, output;</div><div></div><div><span>if</span> (system.args.length &lt; <span>3</span> || system.args.length &gt; <span>5</span>) {</div><div>    <span>console</span>.log(<span>'Usage: svg2pdf.js URL'</span>);</div><div>    phantom.exit(<span>1</span>);</div><div>} <span>else</span> {</div><div>    address = system.args[<span>1</span>];</div><div>    output = system.args[<span>2</span>];</div><div>    page.open(address, <span><span>function</span> (<span>status</span>) </span>{</div><div>        <span>if</span> (status !== <span>'success'</span>) {</div><div>            <span>console</span>.log(<span>'Unable to load the address!'</span>);</div><div>            phantom.exit(<span>1</span>);</div><div>        } <span>else</span> {</div><div>            <span>window</span>.setTimeout(<span><span>function</span> (<span></span>) </span>{</div><div>                <span>var</span> x = page.evaluate(<span><span>function</span>(<span></span>)</span>{</div><div>                    <span>var</span> n = <span>document</span>.querySelector(<span>'svg'</span>);</div><div>                    <span>var</span> a = n.getAttribute(<span>&quot;viewbox&quot;</span>).split(<span>/\s+|,/</span>);</div><div>                    <span>return</span> a;</div><div>                });</div><div>                page.paperSize = {</div><div>                    width: x[<span>2</span>]+<span>&quot;px&quot;</span>,</div><div>                    height: (x[<span>3</span>])+<span>&quot;px&quot;</span>,</div><div>                    margin: <span>&quot;0&quot;</span></div><div>                };</div><div>                page.render(output);</div><div>                phantom.exit();</div><div>            }, <span>200</span>);</div><div>        }</div><div>    });</div><div>}</div></pre></td></tr></table>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>$ for i in *.svg; do phantomjs svg2pdf.js ${i%%.svg}.pdf; done;</div></pre></td></tr></table>
<p>Almost all of those generated PDFs comes with blank pages behind, so we need to strip them out as well.</p>
<table><tr><td><pre><div>1</div></pre></td><td><pre><div>$ for i in *.pdf; do pdftk $i cat 1 output ${i%%.pdf}.1.pdf; done;</div></pre></td></tr></table>
<p>Then join them together<br /><table><tr><td><pre><div>1</div></pre></td><td><pre><div>$ pdftk *.1.pdf cat output output.pdf</div></pre></td></tr></table></p>
<p>This should work pretty well, I’ve tried it on several documents and all of them gives promising results.</p>
<p>Also, if anyone has worked out how to remove the watermark from the downloaded PDF programmatically, please share with us! </p>]]></content>
        
        <summary type="html">
            
            Trying to download some documents from StuDocu, namely those past papers and slides. Even you can easily get free premium for months, but t
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="StuDocu"/>
        
        <category term="PDF processing"/>
        
    </entry>
    
    <entry>
        <title>用 Flow.CI 让 Hexo 持续集成</title>
        <link href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html"/>
        <id>https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-12-01T05:40:16+00:00</published>
        <updated>2016-12-01T05:40:16+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://Flow.CI" target="_blank">Flow.CI</a> 是一个由著名移动应用公测平台 <a href="https://fir.im" target="_blank">Fir.im</a> 推出的持续集成（CI）的 saas 服务平台，感觉就是中国的 Travis.CI，作用是把你 Github 或者 Coding 上的代码拉过来，通过容器技术自动化完成代码的构建、测试、交付和部署。整个对 Flow.CI 使用下来的感受就是简洁和美观，配置方便，速度很快。</p><a></a><p>虽然内测阶段我没有拿到邀请码，但是我至少参加了公测。<del>目前 Flow.CI 依然在公测，所以依旧免费 </del> 公测早就结束了，现在要付费了。<br />跟 Daocloud 的代码构建相比，Flow.CI 是更纯粹的持续集成 / 部署平台。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 基本思路"></a>基本思路</h1><ul><li>关闭 Daocloud 持续集成功能</li><li>配置 Flow.CI 持续集成</li><li>增加触发器</li><li>在本地提交 Hexo 主项目修改的 <code>git commit</code> 进行测试。</li></ul><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 准备工作"></a>准备工作 </h1><p> 如果之前用的是 Daocloud 的持续集成服务，首先是禁用 Daocloud 的持续集成，在 Daocloud 的控制台关掉持续集成。<br />如果以后再也不用 Daocloud 了，那么建议你把 <code>daocloud.yml</code> 和<code>dockerfile</code>两个文件删除。虽然不删除也不影响部署，但是这两个配置文件并没有起任何作用。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 创建持续集成项目"></a>创建持续集成项目 </h1><p> 这一步很简单，按照 Flow.CI 控制台里面的按钮顺着点“创建项目”-&gt; 选择 CODING 代码托管库 -&gt; 选择你的用户 -&gt; 选择你的项目。完成！</p><p>这时 CODING 里面的项目会有两处变化：</p><ul><li>新增了 Flow.CI 的 webhook</li><li>新增了项目下的部署公钥（只读）</li></ul><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 创建并设置工作流"></a>创建并设置工作流 </h1><p><img src="https://st.nfz.yecdn.com/img/blog/0000035.png" /><br /> 接下来点击“创建你的第一个工作流”，开始设置部署流程。<br />由于 Hexo 的所需环境是 Node.js，所以选择 Node.js，版本选择最新的 6.6.0。</p><p>接下来就会进入到工作流定义界面。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000036.png" /></p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 触发器"></a>触发器 </h2><p> 触发器自然是选择对所有分支的 Push、对所有的 Tag 进行匹配。当然你也可以设置每天定时运行。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 初始化"></a>初始化 </h2><p> 保持默认即可，初始环境变量（Flow.CI 提供）和 Node.js 的组件版本等信息。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html#Git- 仓库克隆"></a>Git 仓库克隆 </h2><p> 保持默认即可，拉取你的仓库。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 缓存"></a>缓存 </h2><p> 保持默认即可，使用缓存可以大大加快下一次部署的速度。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 安装"></a>安装 </h2><p> 保持默认即可。使用 <code>npm install</code> 指令安装依赖项，而安装的依赖项基于你仓库中的 <code>package.json</code></p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 自定义脚本"></a>自定义脚本 </h2><p> 在左侧的工作流定义的“安装”与“测试”之间的 + 号，添加一个节点“自定义脚本”</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000037.png" /></p><p>我们的脚本要执行的有：</p><ul><li>Hexo 命令行的安装</li><li>Hexo 静态站点的生成和部署</li></ul><p>在这个节点输入以下脚本：</p><pre><code><span># 安装 Hexo 命令行工具</span>flow_cmd &quot;npm install hexo<span>-</span>cli <span>-</span>g&quot; <span>-</span><span>-</span>echo<span># 准备并安装私钥</span>flow_cmd &quot;cp .daocloud/id_rsa .&quot; <span>-</span><span>-</span>echoflow_cmd &quot;chmod 600 ./id_rsa&quot; <span>-</span><span>-</span>echoflow_cmd &quot;eval $(ssh<span>-</span>agent)&quot; <span>-</span><span>-</span>echoflow_cmd &quot;ssh<span>-</span>add ./id_rsa&quot; <span>-</span><span>-</span>echo<span># 执行 Hexo 生成和发布</span>flow_cmd &quot;hexo clean&quot; <span>-</span><span>-</span>echoflow_cmd &quot;hexo g&quot; <span>-</span><span>-</span>echoflow_cmd &quot;hexo d&quot; <span>-</span><span>-</span>echo<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 测试"></a>测试 </h2><p> 在右上角把这个节点删除。我们不需要执行 <code>npm test</code>。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 完成后"></a>完成后 </h2><p> 如果你打算让 Flow.CI 每次部署成功后都给你发邮件，可以在这里设置。默认会给你的注册时用的邮箱发邮件。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 手动测试"></a>手动测试 </h1><p> 回到构建列表，点击手动构建，选择你的分支开始构建，之后会看到整个工作流的执行过程和日志信息（绿色为成功，蓝色为正在执行，灰色为等待，红色为停止或失败）。<br />然后写一篇博客（庆祝一下你配置了 Flow.CI 嘛），然后用 <code>git commit</code> 和 <code>git push</code> 推送到你的仓库，看一下你的 Flow.CI 是否开始了自动运行。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-flow-ci.html# 小结"></a>小结 </h1><p> 本文介绍了从 Daocloud 进行持续集成 / 部署改造为 Flow.CI 进行集成 / 部署的过程，今后的使用和之前的方式一样，向仓库提交 push 就可以触发自动部署。<br />和 Daocloud 的代码构建相比，Flow.CI 的优点如下：</p><ul><li>更简单、直观的方式，更容易理解（但是并不像配置一个 yml 那样 Geek，对吧？）</li><li><del>更加丰富的触发方式（比如支持正则表达式匹配 commit 信息）</del>其实这个优势并不明显</li><li>方便地配置环境（而不需要像 Daocloud 一样，需要先生成一个带着 node.js 和 hexo 的 image，用来搭建一个 docker 作为运行环境）</li><li>控制台界面比 Daocloud 要漂亮得多（美，才是驱动开发的第一生产力！）</li></ul>]]></content>
        
        <summary type="html">
            
            Flow.CI 是一个由著名移动应用公测平台 Fir.im 推出的持续集成（CI）的 saas 服务平台，感觉就是中国的 Travis.CI，作用是把你 Github 或者 Coding 上的代码拉过来，通过容器技术自动化完成代码的构建、测试、交付和部署。整个对 Flow.CI
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="Hexo"/>
        
        <category term="持续集成"/>
        
        <category term="CI"/>
        
        <category term="Flow.CI"/>
        
    </entry>
    
    <entry>
        <title>使用 DaoCloud 让 Hexo 持续集成</title>
        <link href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html"/>
        <id>https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-11-29T12:51:00+00:00</published>
        <updated>2016-11-29T12:51:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>用 Hexo 搭建好博客，使用起来算方便，而且静态页面使用起来很方便，但是每次还要在安装了 Hexo 环境的机器上才能写文章和发布。能不能在任何地方只要新增或修改了 post 就自动生成并部署 hexo 呢？</p><a></a><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 实现思路"></a>实现思路</h1><ul><li>用 CODING 开源社区对 Hexo 项目的源码进行管理（master 分支，要配置好 Hexo 部署信息）</li><li>在 Daocloud 上进行 Hexo 环境的构建</li><li>Daocloud 通过持续集成功能自动生成静态页面</li><li>通过 FtpSync 插件上传到我的虚拟空间</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000029.jpg" /></p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 需要的东西"></a>需要的东西</h1><ul><li><a href="https://hexo.io" target="_blank">Hexo</a>——静态页面生成器</li><li><a href="https://coding.io" target="_blank">CODING.NET</a>——中国版 Github，可以拥有免费无限私有项目。</li><li><a href="https://www.daocloud.io" target="_blank">Daocloud</a>——中国版 Docker hub，而且还能持续集成。</li></ul><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 开始配置"></a>开始配置 </h1><p> 首先自然是根据 Hexo 的官方文档对 Hexo 进行基本的配置。然后是创建一个 <strong> 私有仓库 </strong> 把 Hexo 文件夹 push 到你建好的私有仓库中。</p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 通过 master 构建 Hexo 基础运行环境镜像"></a>通过 <code>master</code> 构建 Hexo 基础运行环境镜像 </h2><p> 国内貌似也没找到什么合适的、支持 Coding 的 CI 平台，最后我找到了 Daocloud。Daocloud 可以根据 dockerfile 自动构建 Docker 私有镜像并同时进行持续集成的能力。所以可以把 Hexo 及其运行环境（node.js）打包成一个镜像。</p><ol><li>编写 DockerFile。</li></ol><pre><code>#DockerfileFROM node:slimMAINTAINER 你的用户名 你的邮箱# 安装 git、ssh 等基本工具RUN apt-get update &amp;&amp; apt-get install -y git ssh-client ca-certificates --no-install-recommends &amp;&amp; rm -r /var/lib/apt/lists/*# 设置时区，不知道为什么？RUN echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone &amp;&amp; dpkg-reconfigure -f noninteractive tzdata# 只安装 Hexo 命令行工具，其他依赖项根据项目 package.json 在持续集成过程中安装RUN npm install hexo-cli -gEXPOSE 4000<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>在 Daocloud 的控制面板内的代码构建选项卡内，选择“创建新项目”<ul><li>输入你的应用名</li><li>设置代码源的地方绑定你的 Coding 或 Github，并绑定你建立好的 Repository。</li><li>开启持续集成</li><li>执行环境设在国外（The GirlFriend Wall 越来越高了，有时连 npm 都执行不了）</li></ul></li></ol><p><img src="https://st.nfz.yecdn.com/img/blog/0000030.png" /></p><ul><li>镜像选择发布在“镜像仓库”中（这个镜像仓库是私有的）</li></ul><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 通过 -DaoCloud-yml- 定义流程"></a>通过 DaoCloud.yml 定义流程</h2><pre><code><span>#Daocloud.yml</span><span>image</span><span>:</span> daocloud.io/&lt; 你的用户名 <span>&gt;</span>/&lt; 你的应用名 <span>&gt;</span><span>:</span>latest  <span>#使用已经在上一步创建好的 Hexo 基础环境镜像（并不包括博客项目源码）</span><span>install</span><span>:</span> <span>-</span> npm install<span>before_script</span><span>:</span><span>script</span><span>:</span> <span>-</span> hexo clean <span>-</span> hexo g <span>-</span> hexo d<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>yml 当中有一段 <code>before_script</code>，这个是用户自定义脚本。如果说你是在用 Github<br /> 或者 Coding 的 Pages 服务，需要把生成的静态页面 push 到你的 Repository 中，你就需要用 SSH 使 Daocloud 和 Repository 连接。配置 SSH 的具体用法见文章最后附录。</p><p>在 install 过程中才进行了 npm install，并没有在镜像构建时进行依赖项安装，这是因为依赖项安装过程根据不同用户的 Hexo 的配置和安装的功能不同而不同（<code>package.json</code>中记录的不仅仅是 Hexo 依赖项，还有用户装了的插件），并没有通用性，而且本身它就属于 build 过程，尽管花费时间稍长（平均耗时 90 秒），但是这样更科学。</p></blockquote><p>接下来是对 Daocloud 进行配置。</p><ul><li>在设置选项卡中设置用 <code>daocloud.yml</code> 定义流程。</li><li>镜像构建中两个勾都选上。</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000032.png" /></p><ul><li>触发规则按照如图所示的定义。</li></ul><p><img src="https://st.nfz.yecdn.com/img/blog/0000031.png" /></p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 大功告成"></a>大功告成 </h2><p> 之后写文章发布就是使用 <code>git commit</code> 而不是 <code>hexo g</code> 和<code>hexo d</code>了。只要提交以后，持续集成平台就会自动生成静态网页并发布。</p><h1><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 附录"></a>附录 </h1><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html# 关于 daocloud-yml"></a> 关于 daocloud.yml</h2><p>Daocloud 如今已经开始用 daocloud YAML 2.0 定义流程了（1.0 版本的 YAML 于 9 月份停用了）, 然而本篇博客中的依然是 YAML 1.0，所以请自行按照网页提示进行 YAML 升级。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000033.png" /></p><h2><a href="https://blog.nfz.moe/archives/hexo-auto-deploy-with-daocloud.html#HexoAutoBuildScript 项目"></a>HexoAutoBuildScript 项目 </h2><p> 本文提到的有关的 dockerfile 和 daocloud.yml（包括 1.0 和 2.0）开源在 Github 上，并包括更加详细的使用教程</p><ul><li><a href="https://github.com/neoFelhz/HexoAutoBuildScript" target="_blank">项目地址</a></li><li><a href="https://github.com/neoFelhz/HexoAutoBuildScript/wiki" target="_blank">使用教程</a></li></ul>]]></content>
        
        <summary type="html">
            
            用 Hexo 搭建好博客，使用起来算方便，而且静态页面使用起来很方便，但是每次还要在安装了 Hexo 环境的机器上才能写文章和发布。能不能在任何地方只要新增或修改了 post 就自动生成并部署 hexo 呢？实现思路用 CODING 开源社区对 Hexo 项目的源码进行管理（m
            
        </summary>
        
        <category term="博客栈"/>
        
        <category term="Hexo"/>
        
        <category term="持续集成"/>
        
        <category term="CI"/>
        
        <category term="DaoCloud"/>
        
    </entry>
    
    <entry>
        <title>美化多说评论框</title>
        <link href="https://itroy.cc/723"/>
        <id>https://itroy.cc/723</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2016-11-13T04:24:59+00:00</published>
        <updated>2016-11-13T04:24:59+00:00</updated>
        
        <content type="html"><![CDATA[<h2>TOP</h2>
<p>        多说样式已死，本文终结。</p>
<h2>一段话</h2>
<p>        前段时间换了个扁平化的 Blog 主题，然而感觉多说默认的样式好违和，近日魔改了一下多说的样式。</p>
<h2>美（chou）化后的效果图</h2>
<p><img src="http://static.itroy.cc/wp-file/2016/11/duoshuo_comment_box_demo.png" /></p>
<h2>另一段话</h2>
<p>        <del>路人甲 : “哇！Troy 菊苣的评论框好漂亮！求 style.css ！”</del><br />
        <del>Troy: “好哇好哇~交易之后就告诉你~”</del></p>
<p>        那么……以下是链接/内容……<br />
        <a href="https://static.itroy.cc/duoshuo/css/duoshuo.css" target="_blank">duoshuo.css</a></p>
<pre><code>@charset &quot;UTF-8&quot;;
/*!
    Name: Duoshuo Style of Material Design
    Version: 1.0.0
    Url: https://itroy.cc
    Author: Troy
    Author Url: https://itroy.cc
    Description: A material design style for Duoshuo.
    Licensed under MIT.
*/

/* 多说 */
#ds-thread {
    padding: 10px calc((100% - 700px) / 2);
    margin: 0 auto;
    background-color: #eee;
}
@media (max-width: 568px) {
    #ds-thread {
        padding-right: 15px;
        padding-left: 15px;
    }
}
@media (max-width: 740px) {
    #ds-thread {
        width: auto;
        padding-right: 20px;
        padding-left: 20px;
    }
}

/* 字体 */
#ds-thread #ds-reset .ds-textarea-wrapper textarea, #ds-thread #ds-reset .ds-textarea-wrapper .ds-hidden-text {
    font-family: &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;;
    font-size: 12px;
    letter-spacing: 1px;
}

/* 评论图标 */
#ds-thread #ds-reset ul.ds-comments-tabs .ds-service-icon {
    display: none;
}

/* 评论数量 */
#ds-thread #ds-reset .ds-comments-info {
    padding-top: 20px;
}

/* 喜欢 */
#ds-thread #ds-reset .ds-meta {
    padding-top: 20px;
}

/* 被顶起来的评论 */
#ds-thread #ds-reset #ds-hot-posts {
    margin: 8px 10px;
}

/* 头像 */
#ds-reset .ds-avatar {
    background: none;
    box-shadow: none;
}

/* 评论框 */
#ds-thread #ds-reset .ds-replybox {
    height: 100px;
    padding-left: 100px;
    margin-bottom: 50px;
    background: #fff;
    border-radius: 2px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, .2);
}

/* 评论框头像 */
#ds-thread #ds-reset .ds-replybox .ds-avatar {
    position: absolute;
    width: 100px;
    height: 100px;
    margin: 0;
    overflow: hidden;
    background: #f7f7f7;
    border-radius: 2px 0 0 2px;
}

@media (max-width: 568px) {
    #ds-thread #ds-reset .ds-replybox .ds-avatar {
        width: 50px;
        height: 50px;
    }
    #ds-reset form {
        margin-left: 12px;
    }
}
#ds-thread #ds-reset .ds-replybox .ds-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 0;
}
#ds-thread #ds-reset .ds-replybox .ds-avatar img:hover {
    width: 100%;
    height: 100%;
    border-radius: 0;
}

/* 评论头像 */
#ds-thread #ds-reset .ds-avatar img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #f7f7f7;
    transition: transform .8s ease-out;
}

/* 评论框文字区域 */
#ds-thread #ds-reset .ds-textarea-wrapper {
    position: relative;
    border: 0;
    border-bottom: none;
    overflow: hidden;
}
#ds-thread #ds-reset .ds-textarea-wrapper textarea {
    height: 50px;
    letter-spacing: 0;
    line-height: 1.5;
    font-size: 14px;
    color: #333;
}

/* 发表按钮 */
#ds-thread #ds-reset .ds-post-button {
    position: absolute;
    font-family: &quot;Material Icons&quot;;
    font-size: 28px;
    right: 20px;
    width: 56px !important;
    height: 56px;
    padding: 0;
    overflow: hidden;
    color: #fff;
    background-color: #00bcd4;
    border: 0;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    transition: .3s;
    /* Support for IE. */
    font-feature-settings: 'liga';
}
#ds-thread.ds-narrow #ds-reset .ds-post-button {
    width: 56px;
}
#ds-thread #ds-reset .ds-post-button:hover {
    background-color: #00bcd4;
    box-shadow: 0 2px 6px rgba(0,0,0,.3),0 4px 20px rgba(0,0,0,.2);
}
#ds-thread #ds-reset .ds-post-button:active {
    background-color: #00c7e1;
}

/* 评论框工具栏 */
#ds-thread #ds-reset .ds-post-toolbar {
    box-shadow: 0 0;
}
#ds-thread #ds-reset .ds-post-options {
    border: 0;
}

/* 评论信息 */
#ds-thread #ds-reset .ds-comments-info {
    border-top: 1px solid #ddd;
}

/* 隐藏分享选项 */
#ds-thread #ds-reset .ds-sync {
    display: none;
}

/* 评论数量 */
#ds-thread #ds-reset ul.ds-comments-tabs li.ds-tab a.ds-current {
    display: block;
    padding: 0;
    background: none;
    border: 0;
    font-size: 40px;
    text-align: center;
    color: #222;
}

/* 一些杂项 */
#ds-thread #ds-reset .ds-comment-body {
    padding-left: 60px;
}

/* 信息框 */
#ds-notify {
    width: 360px;
    max-width: 360px;
    height: 77px;
    padding: 0;
    right: 0 !important;
    background-color: #1f1f1f;
    border: 1px solid #484848;
    transition: .3s;
}
#ds-notify #ds-reset {
    padding: 12px;
}
#ds-notify #ds-reset ul.ds-notify-unread li a {
    color: #fff;
}

/* 信息框 logo */
#ds-notify #ds-reset a.ds-logo {
    width: 50px;
    height: 50px;
    background: url(https://static.itroy.cc/ic_info_white_48dp_2x.png);
    background-size: cover;
}

/* 信息框 文字 */
#ds-notify #ds-reset ul.ds-notify-unread {
    line-height: 1.5;
    margin-left: 60px;
}
</code></pre>
<p>        <a href="https://static.itroy.cc/duoshuo/css/duoshuo_ua.css" target="_blank">duoshuo_ua.css</a></p>
<pre><code>@charset &quot;UTF-8&quot;;
/*!
    Name: Duoshuo UA Style
    Version: 1.0.0
    Url: https://itroy.cc
    Author: Troy
    Author Url: https://itroy.cc
    Description: Duoshuo UA style.
    Licensed under MIT.
*/
span.ua {
    color: #fff;
}
.ua span {
    padding: 0 5px !important;
    border-radius: 4px;
}
.ua_other {
    background-color: #ccc !important;
}
.os_other {
    background-color: #ccc !important;
}
.ua_ie {
    background-color: #428bca !important;
}
.ua_firefox {
    background-color: #f0ad4e !important;
}
.ua_maxthon {
    background-color: #7373b9 !important;
}
.ua_ucweb {
    background-color: #ff740f !important;
}
.ua_sogou {
    background-color: #78ace9 !important;
}
.ua_2345explorer {
    background-color: #2478b8 !important;
}
.ua_2345chrome {
    background-color: #f9d024 !important;
}
.ua_mi {
    background-color: #ff4a00 !important;
}
.ua_lbbrowser {
    background-color: #fc9d2e !important;
}
.ua_chrome {
    background-color: #ee6252 !important;
}
.ua_qq {
    background-color: #3d88a8 !important;
}
.ua_apple {
    background-color: #e95620 !important;
}
.ua_opera {
    background-color: #d9534f !important;
}
.os_vista, .os_2000, .os_windows, .os_xp, .os_7, .os_8, .os_8_1 {
    background-color: #39b3d7 !important;
}
.os_android {
    background-color: #98c13d !important;
}
.os_ubuntu {
    background-color: #dd4814 !important;
}
.os_linux {
    background-color: #3a3a3a !important;
}
.os_mac {
    background-color: #666666 !important;
}
.os_unix {
    background-color: #006600 !important;
}
.os_nokia {
    background-color: #014485 !important;
}
.admin {
    background-color: #00a67c !important;
}
</code></pre>
<p>        新人渣作，有些地方可能写的很不标准很不正确，各位菊苣们轻喷……</p>
<h2>还有一段话</h2>
<p>        为了更好的美（chou）化，你还需要把多说的默认头像换成：<br />
        <img src="https://avatar.duoshuo.com/avatar-100/212/266416.jpg" /><br />
        然后再把发布按钮的文字更改为：<code>send</code>。<br />
        然后再把正在发布的文字更改为：<code>hourglass_empty</code>。<br />
        应该就这些了吧……（逃……）</p>]]></content>
        
        <summary type="html">
            
            TOP         多说样式已死，本文终结。 一段话         前段时间换了个扁平化的 Blog 主题，然而感觉多说默认的样式好违和，近日魔改了一下多说的样式。 美（chou）化后的效果图  另一段话         路人甲 : “哇！Troy 菊苣的评论框好漂亮！求
            
        </summary>
        
        <category term="WordPress"/>
        
        <category term="网站"/>
        
    </entry>
    
    <entry>
        <title>Linux/Windwos贴吧签到助手GO版部署教程</title>
        <link href="https://blackyau.cc/7.html"/>
        <id>https://blackyau.cc/7.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2016-10-30T09:38:00+00:00</published>
        <updated>2016-10-30T09:38:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>前阵子和几位小伙伴一起合租的一个VPS用来扶墙，只扶墙有点浪费的感觉。前阵子部署博客的服务商把我无名智者的贴吧签到给端了，正好趁这次机会就把kookxiang的GO版签到用上了！顺便也就写了这一篇文章，希望大家在部署的时候能够少走一些弯路。</p><p>本人的部署环境：windows7 SP1 / CentOS 6.8</p><p>&lt;h1&gt;windows端配置&lt;/h1&gt;</p><p>首先到<a href="https://github.com/kookxiang/Tieba_Sign-Go/releases">贴吧签到助手GO版GitHub页</a>下载最新版主程序，你可以通过右键 计算机-属性 来看到自己的系统是64位还是32位。Tieba_Sign-Go.x64.exe对应64位系统，Tieba_Sign-Go.x86.exe对应32位。</p><p>接下来就是获取Cookie的时候，首先在浏览器中使用隐身模式（为了防止退出账号后Cookie失效），打开<a href="https://tieba.baidu.com/">百度贴吧</a>并登录你自己的帐号。然后按一下F12打开 开发者工具，并切换到Network。在不关闭开发者工具的情况下，刷新一下页面。<br /><img src="https://blackyau.b0.upaiyun.com/blog/7/1.png" /><br />单击第一条请求并切换到Headers<img src="https://blackyau.b0.upaiyun.com/blog/7/2.png" /><br />将Cookie项目中的数值复制出来，放进一个任意名字的TXT文档。（不带&quot;Cookie:&quot;）<br />将文本中所有的&quot;冒号+空格&quot;全部使用回车替换（嫌麻烦可以用Word进行替换）<br /><img src="https://blackyau.b0.upaiyun.com/blog/7/3.png" /><br />同时在贴吧签到助手GO版主程序的同一目录中，新建一个名为cookies的文件夹。并将你刚刚，储存了cookie数值的TXT文档放置其中。<br /><img src="https://blackyau.b0.upaiyun.com/blog/7/4.png" /><br />右键主程序 发送到 桌面快捷方式，再右键桌面的快捷方式进入属性。将目标改为</p><pre><code>&quot;主程序路径&quot; -batch
例如↓
&quot;C:\Tieba_Sign-Go\Tieba_Sign-Go.x86.exe&quot; -batch
</code></pre><p>现在你就可以直接双击打开，完成签到。你还可以将本快捷方式，属性中的运行方式调整为最小化运行。并放置于开始的“启动”中。这样它就可以在每天开机的时候为你默默的签到，你也可以同时在使用 任务计划程序 在每天的指定时间为你补签。具体的设置方法我这里就不做过多的介绍了，值得一提的就是在设置 操作 的时候运行的程序要选主程序。要添加参数-batch，不能够直接运行快捷方式。</p><p>按同样的方法，你还可以在Cookies目录中添加更多帐号。同时完成更多的签到任务体验GO签到带来的迅猛速度。</p><p>&lt;h1&gt;Linux端配置&lt;/h1&gt;<br />获取Cookie的方法我就不在赘述，直接就说说部署的方法了。</p><p>首先使用<a href="http://winscp.net/eng/docs/lang:chs">WinSCP</a>将对应版本的GO签到的主程序(一般都是Tieba_Sign-Go.linux.386.bin)放置于/ROOT/tb同时和windows端的操作一样，将你获取到的Cookies都放置于cookies文件夹中。</p><pre><code>cd /ROOT/tb  //切换到/ROOT/tb目录
vi run.sh    //编辑一个脚本，用于带参数运行主程序
</code></pre><p>在run.sh中写入以下内容</p><pre><code>#!/bin/bash
/root/tb/Tieba_Sign-Go.linux.386.bin -batch
</code></pre><p>并赋予其运行权限</p><pre><code>chmod +x run.sh
chmod +x *.bin
</code></pre><p>手动运行一下脚本看看能否正常签到</p><pre><code>./run.sh
</code></pre><p>安装/配置crontab用于定时运行签到程序（以下所有指令都不要输入//及以后的文字，那是用于解释该行指令的用途）<br />首先执行以下指令启动crontab</p><pre><code>service crond start
若返回的提示没有成功启动等字样你就需要手动安装crontab
</code></pre><p>CentOS的安装方法如下</p><pre><code>yum install vixie-cron  //途中会问题Y/N你输入Y按回车就行
yum install crontabs  //同上
</code></pre><p>Ubuntu的安装方法如下</p><pre><code>apt-get install cron
</code></pre><p>安装完毕后再执行<code>service crond start</code>启动服务就行</p><pre><code>crontab -e  //本用于编辑任务，此教程用于生成配置文件
vi /etc/crontab  //编辑任务配置
</code></pre><p>在配置中最下面一行写入，用于每天2:01的时候签到。按Esc退出，输入:wq保存</p><pre><code>1  2  *  *  * root batch /root/tb/Tieba_Sign-Go.linux.386.bin
</code></pre><p>这里值得一提的是，你要看看自己服务器是用的什么时区的时间。比如我的日本VPS就比北京时间快了1小时。</p><pre><code>date -R  //查看VPS当前时间，别忘了R要大写
service crond reload  //重新载入配置
chkconfig --level 35 crond on  //加入开机启动项
</code></pre><p>就这样，你的VPS就会在你指定的时间，自动签到啦。关于时间的设置，其实还有很多可变性。你可以通过Google或百度crontab找到很多例子，我这里就不说其他的了。提前祝大家万圣节快乐！</p>]]></content>
        
        <summary type="html">
            
            前阵子和几位小伙伴一起合租的一个VPS用来扶墙，只扶墙有点浪费的感觉。前阵子部署博客的服务商把我无名智者的贴吧签到给端了，正好趁这次机会就把kookxiang的GO版签到用上了！顺便也就写了这一篇文章，希望大家在部署的时候能够少走一些弯路。本人的部署环境：windows7 SP
            
        </summary>
        
    </entry>
    
    <entry>
        <title>iOS 10 Safari 视频播放新政策</title>
        <link href="https://imququ.com/post/new-video-policies-for-ios10.html"/>
        <id>https://imququ.com/post/new-video-policies-for-ios10.html</id>
        
        <published>2016-10-07T07:20:46+00:00</published>
        <updated>2016-10-07T07:20:46+00:00</updated>
        
        <content type="html"><![CDATA[<p>随着 iOS 10 的正式发布，Safari 也迎来了大量更新，例如新增了对 ES6、CSP2.0、Shadow DOM 等功能和特性的支持。本文为大家介绍 iOS10 自带 Safari 浏览器在视频播放政策上的最新变化。首先划出重点：1）iOS 10 Safari 支持特定视频自动播放；2）iOS 10 Safari 支持视频内联播放。想了解更多细节的同学请接着往下看。</p>
<h3>之前的政策？</h3>
<p>在 iPhoneOS 3（没错，当时 iOS 还不叫 iOS）Safari 开始支持 <code>&lt;video&gt;</code> 标签时，苹果人为设置了很多限制，例如视频无法自动播放 —— 甚至连 Meta 信息预加载都被禁用。显然，这是为了避免给用户造成高额流量费用而作出的妥协，顺便还能节省用户手机电量。</p>
<p>随着视频的普及，在 iOS 8 中，苹果放宽了对 Safari 视频播放的限制：允许使用 <code>preload=&quot;metadata&quot;</code> 来预加载视频 Meta 信息。但仅此而已，Safari 中的 <code>&lt;video&gt;</code> 元素仍然无法自动播放，也无法内联播放 —— 这意味着视频只能在用户主动操作后才能播放，且播放时必须全屏。</p>
<p>至于「用户主动操作」具体指的是哪些行为，苹果官方有详细的说明：</p>
<ul>
<li>点击视频播放按钮；</li>
<li>触发 <code>touchend</code>、<code>click</code>、<code>doubleclick</code> 或 <code>keydown</code> 事件，且在事件处理函数中直接调用 <code>video.play()</code> 方法。显然，<code>button.addEventListener('click', () =&gt; { video.play(); })</code> 满足要求；而 <code>video.addEventListener('canplaythrough', () =&gt; { video.play(); })</code> 不满足要求；</li>
</ul>
<p>值得注意的是，上面讨论的是 iOS 自带 Safari 的视频播放政策。对于 iOS APP 而言，开发者在给 webview 设置 <code>mediaPlaybackRequiresUserAction</code> 和 <code>allowsInlineMediaPlayback</code> 属性之后，页面中的 <code>&lt;video&gt;</code> 标签就可以通过 <code>autoplay</code> 和 <code>webkit-playsinline</code> 属性来启用自动播放和内联播放功能。</p>
<h3>iOS 10 新政策</h3>
<p>随着视频的进一步普及，在 iOS 10 中，苹果终于进一步放松了 Safari 视频播放政策。</p>
<h4>自动播放</h4>
<p>iOS 10 Safari 允许自动播放以下两种视频：</p>
<ul>
<li>无音轨视频；</li>
<li>无声音视频（设置了 <code>muted</code> 属性）；</li>
</ul>
<p>对于这两种类型的视频，可以通过 <code>&lt;video autoplay&gt;</code> 或 <code>video.play()</code> 两种方式来自动播放，无需用户主动操作。但是，如果它们在播放时变得有声音（获取了音轨，或者 <code>muted</code> 属性被取消），Safari 会暂停播放。</p>
<p>通过 <code>&lt;video autoplay&gt;</code> 自动播放的视频元素还需要满足一个条件：在可视区域内。同样，如果它们在播放时因为页面滚动等原因导致不可见，Safari 也会暂停播放。</p>
<p>通过 <code>video.play()</code> 自动播放的视频元素无需可见。<code>video.play()</code> 返回的是 <code>Promise</code>，如果不满足自动播放条件，会触发 <code>reject</code> 行为。</p>
<h4>内联播放</h4>
<p>在 iOS 10 Safari 中，通过 <code>&lt;video playsinline&gt;</code> 可以让视频内联播放。设置了 <code>playsinline</code> 属性的视频在播放时不会自动全屏，但用户可以点击全屏按钮来手动全屏；没有设置 <code>playsinline</code> 的视频会在播放时自动全屏。无论是否设置 <code>playsinline</code> 属性，退出全屏后视频都会继续播放。</p>
<p><code>playsinline</code> 属性在 iOS 10 之前需要写成 <code>webkit-playsinline</code>，它的浏览器厂商前缀在 iOS 10 中被移除。但是目前 iOS 微信还不支持去掉前缀的写法，两个属性最好都加上。</p>
<p>显然，<code>&lt;video autoplay&gt;</code> 必须和 <code>playsinline</code> 属性一起使用。也就是说，只有默认内联播放的视频才有可能自动播放，这一点很容易理解。</p>
<h3>一些典型应用</h3>
<p>根据苹果公司的文章：GIF 相比 H.264 编码的视频，带宽占用为十二倍，电池消耗为两倍。没有声音的 <code>&lt;video&gt;</code> 元素很适合用作网页背景，取代 GIF：</p>
<pre><code><span>&lt;<span>video</span> <span>autoplay</span> <span>loop</span> <span>muted</span> <span>playsinline</span>&gt;</span>
    <span>&lt;<span>source</span> <span>src</span>=<span>&quot;image.mp4&quot;</span>&gt;</span>
    <span>&lt;<span>source</span> <span>src</span>=<span>&quot;image.webm&quot;</span> <span>onerror</span>=<span>&quot;fallback(parentNode)&quot;</span>&gt;</span>
    <span>&lt;<span>img</span> <span>src</span>=<span>&quot;image.gif&quot;</span>&gt;</span>
<span>&lt;/<span>video</span>&gt;</span>

<span>&lt;<span>script</span>&gt;</span><span>
<span><span>function</span> <span>fallback</span><span>(video)</span> </span>{
    <span>var</span> img = video.querySelector(<span>'img'</span>);
    <span>if</span> (img) {
        video.parentNode.replaceChild(img, video);
    }
}
</span><span>&lt;/<span>script</span>&gt;</span>
</code></pre>
<p>这段代码使用 <code>&lt;video&gt;</code> 来替代 GIF 动画，并考虑了降级。但在 iOS 10- Safari 中，由于视频无法自动并内联播放，体验很差。要解决这个问题，可以使用 CSS 的 Media Queries：</p>
<pre><code><span>&lt;<span>style</span>&gt;</span><span>
<span>#either-gif-or-video</span> <span>video</span> { <span>display</span>: none; }
@<span>media</span> (-webkit-video-playable-inline) {
    <span>#either-gif-or-video</span> <span>img</span> { <span>display</span>: none; }
    <span>#either-gif-or-video</span> <span>video</span> { <span>display</span>: initial; }
}
</span><span>&lt;/<span>style</span>&gt;</span>

<span>&lt;<span>div</span> <span>id</span>=<span>&quot;either-gif-or-video&quot;</span>&gt;</span>
  <span>&lt;<span>video</span> <span>src</span>=<span>&quot;image.mp4&quot;</span> <span>autoplay</span> <span>loop</span> <span>muted</span> <span>playsinline</span>&gt;</span><span>&lt;/<span>video</span>&gt;</span>
  <span>&lt;<span>img</span> <span>src</span>=<span>&quot;image.gif&quot;</span>&gt;</span>
<span>&lt;/<span>div</span>&gt;</span>
</code></pre>
<p>由于没有声音的 <code>&lt;video&gt;</code> 元素可以通过调用 <code>video.play()</code> 来自动播放，并且 <code>&lt;video&gt;</code> 元素不需要插入到 DOM 中，我们还可以使用 <code>&lt;canvas&gt;</code> 来做为视频播放的容器，这样就可以方便地修改视频画面了。示意代码如下：</p>
<pre><code><span>var</span> video;
<span>var</span> canvas;

<span><span>function</span> <span>startPlayback</span>(<span></span>) </span>{
    <span>if</span> (!video) {
        video = <span>document</span>.createElement(<span>'video'</span>);
        video.src = <span>'image.mp4'</span>;
        video.loop = <span>true</span>;
        video.addEventListener(<span>'playing'</span>, paintVideo);
    }
    video.play();
}

<span><span>function</span> <span>paintVideo</span>(<span></span>) </span>{
    <span>if</span> (!canvas) {
        canvas = <span>document</span>.createElement(<span>'canvas'</span>);
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        <span>document</span>.body.appendChild(canvas);
    }
    canvas.getContext(<span>'2d'</span>).drawImage(video, <span>0</span>, <span>0</span>, canvas.width, canvas.height);
    <span>if</span> (!video.paused) {
        requestAnimationFrame(paintVideo);
    }
}

startPlayback();
</code></pre>
<p>本文主要内容来自于 Webkit 官方博客：<a href="https://webkit.org/blog/6784/new-video-policies-for-ios/">New &lt;video&gt; Policies for iOS</a>。</p>
<p>本文链接：<a href="https://imququ.com/post/new-video-policies-for-ios10.html">https://imququ.com/post/new-video-policies-for-ios10.html</a>，<a href="https://imququ.com/post/new-video-policies-for-ios10.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            随着 iOS 10 的正式发布，Safari 也迎来了大量更新，例如新增了对 ES6、CSP2.0、Shadow DOM 等功能和特性的支持。本文为大家介绍 iOS10 自带 Safari 浏览器在视频播放政策上的最新变化。首先划出重点：1）iOS 10 Safari 支持特定
            
        </summary>
        
    </entry>
    
    <entry>
        <title>莱卡回家</title>
        <link href="https://blog.nfz.moe/archives/laikai-home.html"/>
        <id>https://blog.nfz.moe/archives/laikai-home.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-10-02T09:20:00+00:00</published>
        <updated>2016-10-02T09:20:00+00:00</updated>
        
        <content type="html"><![CDATA[<a></a><p>11 月 3 日是个特别的日子。1957 年 11 月 3 日，前苏联发射了 Sputnik-2 号卫星，这是第二颗进入地球轨道的人造卫星，也是人类发射的第一颗载有活物的卫星。消息发布后，西方世界一片哗然，在美国小得可怜的首枚人造卫星发射之前，苏联的举动彻底夯实了其航天第一强国的地位。美国中情局对此作了大量分析，纠结于苏联卫星究竟是否带了活物之间。在确信苏联发射了活狗，原已令西方震惊，但这只狗的结局，更成为后来数十年的科学悬案。<br /> 那只随 Sputnik-2 升空的三岁流浪雌性混血萨摩耶犬名叫莱卡。作为第一只进入太空的地球生物，莱卡名垂青史，但它的结局却着实悲惨。从一开始，苏联人就没打算让它回来。10 月 4 日苏联发射首枚人造卫星后一星期后，赫鲁晓夫就建议再次发射更为复杂的卫星，作为伟大十月革命 40 周年献礼，这意味着工程技术人员只有 3 周时间来设计和制造新的火箭及卫星。这次苏联决定发射生物上天。<br /> 一切为了进度， Sputnik-2 使用了 Sputnik-1 的部分备件，为了最大限度提高载荷能力，火箭的部分设备甚至也被拆除。科罗廖夫的助手鲍里斯·切尔托克在回忆中这样写道，“一切火箭技术开发的传统都被抛弃，第二颗卫星的开发根本未经详细设计，或者说根本没有设计。”卫星的大部分部件都是赶工制造的，工程师们甚至被派到工厂协助工人赶工，许多部件甚至省略了蓝图环节。紧张的工期甚至不允许工程师设计出可靠的生命保障系统，更不消说为莱卡铺就一条回家的路。</p><p> 发射升空过程中，监测系统显示莱卡的心率达到了每分钟 260 次，比平时高 3 倍，呼吸频率也超出正常水平 4～5 倍，但顽强的莱卡还是活了下来，成功进入轨道。入轨后，载荷舱头锥成功分离，但有些部件却分离失败。造成的一个恶劣后果就是，热控制系统无法正常工作。此外，一些隔热材料被撕裂，舱内温度很快升至 40 度以上。据信在死于焦躁和高热之前，莱卡顶多活了两天，西方人甚至认为只有几个小时，根本不像苏联人宣布的那样长。莱卡用自己的生命告诉人类科学家，通过合理的防护措施，人类能够在太空环境下生存。这个代价对人类而言不大，但对莱卡而言不小。<br /> 莱卡的悲惨结局，固然可以归结为当时尚不成熟的返回卫星技术，但更为重要的原因，是美苏当时心急火燎的太空竞赛，而竞赛背后，是东西方阵营意识形态的激烈冲突。但无论如何，我们起码可以给莱卡更有尊严的死亡方式，一支安乐死制剂就足以实现。遗憾的是，1957 年 11 月 3 日的那次发射，这些都没有被详尽计划。<br /> 每每看到关于莱卡的记述，我都会对身边动物平添几分敬意，提醒自己善待它们。为了人类的文明征程，它们已经付出了太多，我们不能与此同时再让他们成为我们野蛮举止的牺牲。<br /> 莱卡，回家吧。</p><p><img src="https://st.nfz.yecdn.com/img/blog/0000160.jpg" /></p>]]></content>
        
        <summary type="html">
            
            11 月 3 日是个特别的日子。1957 年 11 月 3 日，前苏联发射了 Sputnik-2 号卫星，这是第二颗进入地球轨道的人造卫星，也是人类发射的第一颗载有活物的卫星。消息发布后，西方世界一片哗然，在美国小得可怜的首枚人造卫星发射之前，苏联的举动彻底夯实了其航天第一强国
            
        </summary>
        
        <category term="自言语"/>
        
    </entry>
    
    <entry>
        <title>Eanois Default’s Design</title>
        <link href="https://blog.1a23.com/2016/10/02/Eanois-Default%E2%80%99s-Design/"/>
        <id>https://blog.1a23.com/2016/10/02/Eanois-Default%E2%80%99s-Design/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2016-10-02T01:34:09+00:00</published>
        <updated>2016-10-02T01:34:09+00:00</updated>
        
        <content type="html"><![CDATA[<p>Actually this is just to showcase the original design of the new <em>Eanois Default</em> design. Still a little different from the current implementation, but personally, it still looks a little better on the design draft, than the actual website. Although I can’t see why.</p>
<p><img src="https://images.1a23.com/upload/images/PLPR.png" /></p>
<p>By the way, today’s the 8<sup>th</sup> anniversary of 1A23.com. Yay!</p>]]></content>
        
        <summary type="html">
            
            Actually this is just to showcase the original design of the new Eanois Default design. Still a little different from the current implement
            
        </summary>
        
        <category term="Design"/>
        
        <category term="The Making of the New 1A23"/>
        
    </entry>
    
    <entry>
        <title>MicroG安装与配置</title>
        <link href="https://blackyau.cc/4.html"/>
        <id>https://blackyau.cc/4.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2016-09-30T08:27:00+00:00</published>
        <updated>2016-09-30T08:27:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>Google全家桶一直是让Android玩家们又爱又恨的组件，一方面它能够带给我们完整的Google生态圈体验、一方面又被他频繁唤醒设备造成的高耗电和全家桶的臃肿所烦恼。而现在有另外一个“不完美”的解决方案，可以让我们用上Google play、让Google全家桶能够安静的不再频繁唤醒设备。那就是<strong><a href="https://microg.org/">MicroG项目</a></strong>，又得益于这个项目为开源所以使用MicroG也可以让我们摆脱Google对Android“可远观而不可亵玩”那种开放。</p><p>安装须知</p><ul><li>需要完整的ROOT权限</li><li>需要安装xposed框架58版本以上</li><li>需要Android核心破解</li><li>需要一颗爱折腾的心</li></ul><p>安装步骤</p><p><strong>1.下载欺骗所用的xposed模块</strong></p><ul><li>打开Xposed Installer当中的“下载”搜索DisableFlagSecure（欺骗Google并使用MicroG接管GAPPS相关工作）和FakeGApps（使用MicroG定位所需模块）。</li><li>下载并安装以上两个模块，打钩后重启。</li></ul><p><strong>2.配置f-droid</strong>(用于接收MicroG组件更新)</p><ul><li>在<a href="https://f-droid.org/">f-droid.org</a>当中下载并安装应用（蓝色的Download F-Droid）</li><li>在应用主页中点击 右上角的垂直三点 -管理软件源-右上角+号</li><li>在添加新的软件源窗口中，软件源地址填写“microg.org/fdroid/repo”指纹请留空</li><li>点击添加后再点击 右上角的顺时针箭头 更新资源库</li><li>回到应用主页面将“最新”调整为“全部”，点击右上角的 放大镜 输入“nlp”，下载并安装以下所有应用<br />   GSMLocationNlpBackend<br />   LocalGsmNlpBackend<br />   LocalWifiNlpBackend<br />   MozillaNlpBackend<br />   OpenBmapNlpBackend<br /><img src="https://blackyau.b0.upaiyun.com/blog/4/1.png" /></li></ul><p><strong>3.配置MicroG</strong></p><ul><li><a href="https://microg.org/download.html">进入MicroG组件下载页</a>下载并安装microG Services Framework Proxy过后在下载安装microG Services Core（请注意先后顺序，因为先安装core部分设备可能会找不到组件）两个都安装完毕后请重启。</li><li>打开应用microG Setting将图中两个选项全部打钩<img src="https://blackyau.b0.upaiyun.com/blog/4/2.jpg" /></li><li>滑动到下方点击UnifiedNlp Settings检查一下Configure location backends选项中是否有，刚刚在配置f-droid时下载的应用。如果有的话请全部打钩并点击确定。</li><li>回到microG Setting应用主页，点击第一个Self-Check。此时应该看到</li></ul><p>第一个&quot;Signature Spoofing Support(签名欺骗支持)&quot;群组的<br />System Grants Signature Spoofing permission&lt;-(Android 6.0+)已经打勾<br />System has Signature Spoofing support&lt;-(Android 6.0+)已经打勾<br />System Spoofs Signature&lt;-已经打勾</p><p>第四个群组&quot;Network Location Provider Support(网路本地提供者支持)&quot;则会看到<br />Android Version Supported&lt;-已经打勾(低于4.0则无勾)<br />System supports location provider&lt;-已经打勾(没定位功能的装置则无勾)</p><p>第五个群组&quot;UnifiedNlp Status(模组状态)&quot;则会看到UnifiedNlp is Registered in System&lt;-没勾，需要全部设定好后重新开机才会打勾(有时就算全部设定好重开不见得会打勾= 3=)<br />Location backend(s) set up&lt;-已经打勾(若在配置MicroG第3步时没有发现组件或是组件至少没有打勾一个，此处则无勾)<br />Network-Based location enabled(定位高精确度已启用)&lt;-没勾<br />&lt;center&gt;-----若设备没有定位功能可省略-----&lt;/center&gt;</p><ul><li>启动设备的“定位服务”并选择到高精度（请勿贪图省电而选择省电，APP会不鸟你）</li><li>启动Xposed Installer到模块中打开XposedGmsCoreUuifiedNlp</li><li>点选唯一的选项&quot;Check Setting(检查设定)&quot;</li><li>若成功，会显示两行绿色(第三行若出现红色的错误提示可以忽略，因为这个提示的表示找不到你的&quot;位置&quot;)</li><li>若在第一行就出现失败，代表你可能多安装并启用了XposedUnifiedNlp，这个是程序对于已安装了官方的GAPPS才需要用到的，请取消</li></ul><p>&lt;center&gt;-----若设备没有定位功能可省略-----&lt;/center&gt;</p><ul><li>下载google play商店（可以到apkmirror中下载<a href="https://www.apkmirror.com/apk/google-inc/google-play-store/">点我可转跳到下载页</a>）</li><li>使用任何一个具有ROOT权限的文件管理器，将play商城的APK移动到/system/app目录当中，并将权限设置为如图所示<img src="https://blackyau.b0.upaiyun.com/blog/4/3.png" /></li><li>点一下该Apk文件确认可以跳出安装画面(请不要再安装一次！！！)。若可以，请重新启动。即可正常使用play商店</li></ul><p><strong>4.安装地图API支持</strong></p><ul><li>到<a href="https://github.com/microg/android_frameworks_mapsv1/releases">此处</a>下载zip包，并使用第三方Recovery刷入</li><li>若刷机失败，请解压缩刷机包，将&quot;System&quot;文件夹夹复制到根目录(/)，没意外的话档桉管理器会提示出即将覆盖资料夹(请选&quot;是&quot;将其覆盖)，然后依照刷机包内的结构目录，把文件夹的权限改为三读一写(644)。</li></ul><p><strong>已知的问题：</strong></p><ul><li>通讯录和日历仍然需要GAPPS的支持</li><li>部分应用程式若有同步功能仍然会提示&quot;Google Play 服务 版本过旧，请更新到最新版本&quot;(之类的字词)，造成软件无法进行同步(Google 云端硬盘 Gmail等等...)</li></ul><p><strong>通讯录和日历同步解决方案：</strong></p><ul><li>在<a href="http://opengapps.org/">opengapps.org</a>中下载pico版</li><li>从压缩包根目录的&quot;GApps&quot;资料夹解压缩&quot;calsync-all.tar.xz&quot;，然后再解压缩&quot;calsync-all.tar.xz&quot;，把里面唯一的APK解压出来(此文件为 Google 日历同步的APK)</li><li>从压缩包根目录的&quot;Core&quot;资料夹把&quot;googlecontactssync-all.tar.xz&quot;和&quot;googlebackuptransport-all.tar.xz&quot;解压缩出来(前者为 Google 通讯录同步 ，后者为 Google备份传输[Google Backup Transport]，每个压缩档各只有一个文件)</li><li>把 Google 通讯录同步 和 Google 日历同步放到/system/app/</li><li>再把 Google备份传输 放到 /system/priv-app</li><li>重新开机，然后尝试同步看看吧。因为XDA论坛上面有人成功了。<br />PS:下面路径都是从下载回来的压缩包路径开始讲解。注意，从这个地方下载的文件都是多重压缩包桉所制作而成的[也就是压缩包里面还有压缩包]</li></ul><p>PSS:TAR.XZ 为 TAR ，TAR为一般的压缩档。如果你使用的文件管理器无法识别此格式，请手动指定文件管理器用压缩包格式开启或是用<a href="http://coolapk.com/apk/com.rarlab.rar">其他的解压APP</a>。</p><p><strong>优点：</strong><br />1.更省电(因为不像原始 Google Play服务 那样，频频被唤醒，平均每个装置可以省电至少15%以上，待机时间平均延长20%)。<br />2.隐私保障更安全(若 Google 要求装置回传资料，microG会尝试减少传送或是传送空白的假资料)。<br />3.安装包更小{microG Ver. 0.2.4-3-g47a61d6 预览版(20160731更新)，大小仅 2.12Mb 跟 Google Play 服务 Ver. 9.4.52(270-127739847)(20160731更新)大小 51.87 Mb ，两者空间占用率差了 24.4 倍，若是没有整合 Google Play 服务 的更新到系统，占用率差距至少差了 50 倍以上}<br />4.内存占用更少(若点击 microG 的主要应用程序，其应用只有一个服务 平均内存占用率仅 9Mb，若单纯被 Google Play商店 唤醒，也平均使用约5~6Mb，相反于Google Play 服务，一出现就先吃掉你 20Mb 的内存，服务还多达4~6个)。</p><p><strong>缺点:</strong><br />1.安装步骤稍微复杂(说穿了，其实只要搞懂安装顺序。其实困难度很低)<br />2.有时Play商店不会自动开始下载App(点开 microG 再回到 Play 商店 就又可以抓了，因为我有装绿色守护把它丢到黑名单，可能有时候唤醒不到吧)<br />3.有时候最下面的状态选项会无故无勾(其实不影响 Play商店 的下载)</p><p>就这样我的MicroG安装教程就到此结束了，首先感谢参与MicroG项目的人员同时还有这一篇文章[<a href="https://www.asus.com/zentalk/tw/forum.php?mod=viewthread&amp;tid=162093">https://www.asus.com/zentalk/tw/forum.php?mod=viewthread&amp;tid=162093</a>]<a href="https://blackyau.cc/4.html#">11</a>我就是从这一篇文章得知了MicroG项目，同时本文的内容也是基于这篇文章所诞生的。</p>]]></content>
        
        <summary type="html">
            
            Google全家桶一直是让Android玩家们又爱又恨的组件，一方面它能够带给我们完整的Google生态圈体验、一方面又被他频繁唤醒设备造成的高耗电和全家桶的臃肿所烦恼。而现在有另外一个“不完美”的解决方案，可以让我们用上Google play、让Google全家桶能够安静的不
            
        </summary>
        
    </entry>
    
    <entry>
        <title>Questions</title>
        <link href="https://itroy.cc/715"/>
        <id>https://itroy.cc/715</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2016-09-13T12:27:07+00:00</published>
        <updated>2016-09-13T12:27:07+00:00</updated>
        
        <content type="html"><![CDATA[<h2>未完待续命</h2>
<h2>网页 声明 lang</h2>
<p>        <a href="https://www.zhihu.com/question/20797118" target="_blank">网页头部的声明应该是用 lang=”zh” 还是 lang=”zh-cn”？ – 知乎</a><br />
        <a href="https://www.zhihu.com/question/21980689" target="_blank">zh-cn 与 zh-hans 是什么关系、有什么区别？ – 知乎</a></p>
<h2>软件 喜爱</h2>
<p>        <a href="https://www.zhihu.com/question/20219239" target="_blank">你很喜爱的小软件有哪些？ – 知乎</a></p>
<h2>BOM UTF8</h2>
<p>        <a href="https://www.zhihu.com/question/20167122" target="_blank">「带 BOM 的 UTF-8」和「无 BOM 的 UTF-8」有什么区别？网页代码一般使用哪个？ – 知乎</a></p>
<h2>玻璃 黑色</h2>
<p>        <a href="https://www.zhihu.com/question/39207600" target="_blank">黑色的玻璃是不存在的吗？ – 知乎</a></p>
<h2>单声道 录音 双声道 播放</h2>
<p>        <a href="https://www.zhihu.com/question/32198079" target="_blank">录音时只有一个麦克风，音乐应该大多是单声道的，那为什么我们下载的音乐普遍是双声道呢？ – 知乎</a></p>
<h2>战机 飞行员 跳伞 居民区</h2>
<p>        <a href="https://www.zhihu.com/question/20636776" target="_blank">战斗机在市区上空出现严重故障到底该不该跳伞？ – 知乎</a></p>
<h2>口香糖 持久</h2>
<p>        <a href="https://www.zhihu.com/question/31376956" target="_blank">炫迈口香糖是如何做到口味持久的？ – 知乎</a></p>
<h2>动画片 口型</h2>
<p>        <a href="https://www.zhihu.com/question/26296574" target="_blank">为什么几乎所有好莱坞动画片的口型都与台词一致？ – 知乎</a></p>
<h2>二维码 容错 图片</h2>
<p>        <a href="https://www.zhihu.com/question/27751863" target="_blank">二维码在不影响扫码的情况下，哪些部分可以删除？ – 知乎</a></p>
<h2>WiFi WLAN 区别</h2>
<p>        <a href="https://www.zhihu.com/question/19821864" target="_blank">什么时候应该叫 Wi-Fi，什么时候叫 WLAN 呢？ – 知乎</a></p>
<h2>核电站 原理</h2>
<p>        <a href="https://www.zhihu.com/question/30460700" target="_blank">核电站的原理就是烧水吗？ – 知乎</a></p>]]></content>
        
        <summary type="html">
            
            未完待续命 网页 声明 lang         网页头部的声明应该是用 lang=”zh” 还是 lang=”zh-cn”？ – 知乎         zh-cn 与 zh-hans 是什么关系、有什么区别？ – 知乎 软件 喜爱         你很喜爱的小软件有哪些？ –
            
        </summary>
        
        <category term="日常"/>
        
    </entry>
    
    <entry>
        <title>Typecho部署“一言”</title>
        <link href="https://blackyau.cc/5.html"/>
        <id>https://blackyau.cc/5.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2016-09-11T06:38:00+00:00</published>
        <updated>2016-09-11T06:38:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>在Telegram闲逛的时候，看到一名大佬发了一个链接。戳进去看了看，原来是一个一言API复刻版。试了试速度还不错，正好也从来没弄过，所以今天也就把它鼓捣上了。引用方法也很简单。</p><p>对于Typecho来说，要将header.php中的head区加入以下代码</p><pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;//api.i-meto.com/hitokoto?encode=js&quot;&gt;&lt;/script&gt;
</code></pre><p>然后再将footer.php以下代码标为注释</p><pre><code>&amp;copy;
  &lt;span itemprop=&quot;copyrightYear&quot;&gt;&lt;?php echo date('Y'); ?&gt;&lt;/span&gt;
  &lt;span class=&quot;with-love&quot;&gt;
   &lt;i class=&quot;icon-next-heart fa fa-heart&quot;&gt;&lt;/i&gt;
  &lt;/span&gt;
  &lt;span class=&quot;author&quot; itemprop=&quot;copyrightHolder&quot;&gt;
  &lt;?php if ($this-&gt;options-&gt;next_name) {
      $this-&gt;options-&gt;next_name();
  } else {
      $this-&gt;options-&gt;title();
  }
  ?&gt;
  &lt;/span&gt;
</code></pre><p>然后就在注释的外面加上</p><pre><code>&lt;script&gt;hitokoto()&lt;/script&gt;
</code></pre><p>就这样我的blog底端就有高逼格的、会自动刷新的一言了</p><p><a href="https://blackyau.b0.upaiyun.com/blog/5/Typecho.zip">点我</a>可以直接下载已修改的footer.php、header.php。直接替换即可生效</p>]]></content>
        
        <summary type="html">
            
            在Telegram闲逛的时候，看到一名大佬发了一个链接。戳进去看了看，原来是一个一言API复刻版。试了试速度还不错，正好也从来没弄过，所以今天也就把它鼓捣上了。引用方法也很简单。对于Typecho来说，要将header.php中的head区加入以下代码&amp;lt;script ty
            
        </summary>
        
    </entry>
    
    <entry>
        <title>战舰世界 自动签到</title>
        <link href="https://ikk.me/archives/software/wows-auto-sign.html"/>
        <id>https://ikk.me/archives/software/wows-auto-sign.html</id>
        
        <author>
            <name>kookxiang</name>
        </author>
        
        <published>2016-09-11T03:32:00+00:00</published>
        <updated>2016-09-11T03:32:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>其实这个坑已经挖了很久了…</p>

<p>最早挖坑的时候主要是为了<a href="http://wows.kongzhong.com/ztm/fleet/" target="_blank">这个活动</a>的自动签到，然而现在这个所谓永久活动也结束了…</p>

<p>最早用 Go 实现了验证码的自动识别，这回跟着 dalao 用 python 重写了一遍，然后修改了下验证码的学习算法，让获得的样本更准确（现在验证码识别率居然近似到 100% 了）</p>

<p>因为 python 的脚本改起来比较容易，如果有新活动的话加个配置就可以实现，目前主要签到的是<a href="http://wows.kongzhong.com/ztm/unitpc/index.html" target="_blank">陆海双雄</a>的活动，等新活动出来加就是了</p>

<p>研究了下傻逼空中网的接口，现在签到的时候会自动检测是否已签到</p>

<p>用到了 PIL 来读取图片像素，然后用 requests 包发请求</p>

<p>来听歌吧~<br />
 &lt; 访问完整版以查看此播放器 &gt; </p>]]></content>
        
        <summary type="html">
            
            其实这个坑已经挖了很久了…  最早挖坑的时候主要是为了这个活动的自动签到，然而现在这个所谓永久活动也结束了…  最早用 Go 实现了验证码的自动识别，这回跟着 dalao 用 python 重写了一遍，然后修改了下验证码的学习算法，让获得的样本更准确（现在验证码识别率居然近似到
            
        </summary>
        
    </entry>
    
    <entry>
        <title>AngularJS: UI Router resolve with $resource</title>
        <link href="https://blog.1a23.com/2016/09/10/AngularJS-UI-Router-resolve-with-resource/"/>
        <id>https://blog.1a23.com/2016/09/10/AngularJS-UI-Router-resolve-with-resource/</id>
        
        <author>
            <name>Eana Hufwe</name>
        </author>
        
        <published>2016-09-10T09:26:57+00:00</published>
        <updated>2016-09-10T09:26:57+00:00</updated>
        
        <content type="html"><![CDATA[<p>Long time no see! It really has been long since last time I post on this topic. That’s because I’ve been working on the “real New 1A23”, I was rewriting the entire CMS on my own. Front-end and back-end. Anyway, this time, there’s a my solution to one of the problems I found: Compatibility between <code>ui-router</code>‘s <code>resolve</code> and <code>$resource</code>.<br /><a></a></p>
<h2><a href="https://blog.1a23.com/2016/09/10/AngularJS-UI-Router-resolve-with-resource/#0x0-What’s-happening"></a>0x0: What’s happening?</h2><p>UI-Router is a famous routing module for single-page app routing with AngularJS. In its state manager, the resolve feature allows external resources, especially AJAX requests to be loaded in dependence order before the view is rendered. However, in the <a href="https://github.com/angular-ui/ui-router/wiki" target="_blank">official documentation</a>, only examples for <code>$http</code> is given. If you tried to return a the result of <code>$resource</code> directly, you will find that the controller is actually called before the external resource is resolved. For those resource that depends on others, it will just fail silently.</p>
<h2><a href="https://blog.1a23.com/2016/09/10/AngularJS-UI-Router-resolve-with-resource/#0x1-Why-is-that-so"></a>0x1: Why is that so?</h2><p>UI-router utilising AngularJS’s Promise object to manage and process async requests, and enqueue it in a queue. For any requests that is done async-ly, it should return a promise object in the resolve tree. </p>
<h2><a href="https://blog.1a23.com/2016/09/10/AngularJS-UI-Router-resolve-with-resource/#0x2-So-how-to-solve-it"></a>0x2: So how to solve it?</h2><p>It’s simple, you can return <code>.$promise</code> from the resource request. Example code:</p>
<table><tr><td><pre><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div></pre></td><td><pre><div>$stateProvider</div><div>    .state(<span>'demo'</span>, {</div><div>        url: <span>'/demo'</span>,</div><div>        template: <span>'&lt;h1&gt;Demo page&lt;/h1&gt;'</span>,</div><div>        controller: <span>'DemoController'</span>,</div><div>        resolve: {</div><div>            post: [<span>&quot;PostAPI&quot;</span>, <span><span>function</span> (<span>PostAPI</span>) </span>{</div><div>                <span>return</span> PostAPI.get().$promise;</div><div>            },</div><div>            comments: [<span>&quot;post&quot;</span>, <span>&quot;CommentAPI&quot;</span>, funciton (post, CommentAPI) {</div><div>                <span>return</span> CommentAPI.get(post.id).$promise;</div><div>            }</div><div>     });</div></pre></td></tr></table>
<p>Yes, as simple as that. BTW, <a href="https://jitaku.io" target="_blank">Jitaku</a> works like a charm!</p>]]></content>
        
        <summary type="html">
            
            Long time no see! It really has been long since last time I post on this topic. That’s because I’ve been working on the “real New 1A23”, I 
            
        </summary>
        
        <category term="Tech"/>
        
        <category term="AngularJS"/>
        
        <category term="ui-router"/>
        
        <category term="$resource"/>
        
        <category term="The Making of the New 1A23"/>
        
    </entry>
    
    <entry>
        <title>制服火龙——为骁龙 810 降温</title>
        <link href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html"/>
        <id>https://blog.nfz.moe/archives/coding-snapdragon-810-down.html</id>
        
        <author>
            <name>neoFelhz</name>
        </author>
        
        <published>2016-08-30T09:19:00+00:00</published>
        <updated>2016-08-30T09:19:00+00:00</updated>
        
        <content type="html"><![CDATA[<blockquote><p>“高通骁龙 810 是我们的一款失败的产品”——高通工程师</p></blockquote><a></a><h1><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 骁龙 -810"></a>骁龙 810</h1><h2><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 基本参数"></a>基本参数 </h2><p> 首先给一下 Qualcomm MSM8994 Snapdragon 810 的基本参数：</p><blockquote><p>4x Quad-core 2.0 GHz ARM®Cortex™ A57 （big）@ 1.96GHz and 4x quad-core 1.5 GHz ARM®Cortex™ A53（LITTLE）@ 1.56GHz；Adreno 430 GPU；X10 LTE modem；20nm LMP。</p></blockquote><h2><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 温控数据"></a>温控数据 </h2><p> 根据高通工程师高通设定的原厂限制是核心温度达到 95℃ 的时候 A57 开始降频，105℃ 核心强制下线，115℃ 设备重启。<br />nubiaUI 来自原厂的温控二进制内的 system/bin/thermal-engine 做了优先级更高的进一步限制： GeekBench 和安兔兔类跑分类应用加入了“白名单”在 95℃ 降频，而非白名单的应用运行在 75℃就开始降频了。<br />高通吧的吧主炮神就拿 Nubia z9 max （这也正是我的主力机）做过拷机测试，测试结果是如果只有一颗 A57 进行开机的话，满载直接超过 100 度，两颗 A57 开机满载直接爆机重启。</p><blockquote><p>单个 2GHz A57 核心，满载坚持 1 分多钟后达到 105℃ 左右，没有降频，但直接就重启了。两个 2GHz A57 核心，最多不到 5 秒钟就冲到 105℃ ，然后重启。A53 核心就好多了，1.56GHz 频率下单个满载不超过 50℃，双核大约 50℃ ，四核也才 61℃ ，都过得去。<br />经过计算可知，骁龙 810 里边单个 1.56GHz A53 核心的满载功耗大约是 400-470mW ，看起来不高但经不起对比啊：海思 930 1.5GHz 350mW、2.0GHz 570mW，联发科 MT6752 1.7GHz 400mW，而且它俩都还是 28nm 。A57 就太恐怖了，2GHz 频率下单个就达到了 4.9W ，双核直接爆机没法测试——是手机处理器啊亲！20nm 工艺啊亲！ Intel Core M 都能做到 TDP 4.5W 啊！</p></blockquote><p>所以 A57 才是骁龙 810 发热的罪魁祸首。但是 A57 的性能不容小觑。用 z9 max 进行圆周率测试来测试性能——跑 1000 万位圆周率，只开 4 颗 A53，需要 72 秒，但是开着 4 颗 A53 和 2 颗 A57 只要 31 秒，A57 间断开启的话（温控限制）也只要 42 秒。</p><h1><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 一些事实"></a>一些事实 </h1><p> 我有一次有幸和高通（中国）的工程师在微信上交流过。最后结论就是：</p><ul><li>CPU 频率越高，CPU 电压越高，发热越多，越耗电</li><li>kyro 架构的 CPU 分体质（801、805、820），体质越高，相同频率电压可以更低，但一些 CPU 电压太低会重启</li><li>ARM 公版架构的 CPU 没有体质这一说法，但是仅仅只是说法不同罢了。</li><li>因为频率越高，核心间电压也要升高，所以就会越来越耗电。 </li><li>核心之间电压越高，发热越多耗电越快。</li></ul><blockquote><p> 比如一加一的内核支持 CPU 修改电压，很多加油都选择 CPU 降压解决发热（很多用户都选择每个频率降压 20-30mV）</p></blockquote><p>nubia 的内核就不支持修改电压。怎么办？<br />控制频率调整机制呗，既然电压和频率有关。<br />真正的关键并不是现在很多人认为的那样去限制最大频率，而是不要让频率升的太快。对于 CPU ，如果想要省电，那么频率就要尽可能低，升频要慢，降频要快。<br />当然对于性能的需求来说恰恰相反，追求更好的性能就要求较高的频率需求。<br />其次另外还有一个矛盾，就是在待机的时候， CPU 核心数越少越好。这个时候多核待机就耗电了。</p><blockquote><p>通俗点、简单点说就是——多核高频如尿崩，多核低频很省电，多核待机很耗电，少核高频很耗电，少核低频跑不动，少核待机不耗电。</p><p>当然，耗电大户一般都是屏幕，屏幕的功率有 50mA 左右。关掉屏幕应该就会省电多了。也可以理解关屏听音乐，虽然唤醒锁没被释放，但是耗电却比开屏少了一半。</p><p>再补充一下，虽然联发科已经被人嘲笑一核有难，九核围观，然而基于 corepilot 的异构异步多核会根据负载开关核心，虽然性能不怎么地，但是省电倒是真的。</p></blockquote><h1><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 基本思路"></a>基本思路</h1><ol><li>在待机时核心数要少，操作时核心数要多。</li><li>尽量让 CPU 运行在较低频率。</li><li>根据频率区间不同调整升频间隔，尽可能解决省电与性能的矛盾。</li></ol><h1><a href="https://blog.nfz.moe/archives/coding-snapdragon-810-down.html# 操刀，上！"></a>操刀，上！</h1><p>来我们来分析 init.qcom.post_boot.sh 脚本中 <br /> 的几个调速器有关的片段，来看看如何实现基本思路。</p><pre><code><span># ensure at most one A57 is online when thermal hotplug is disabled</span><span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu5/online<span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu6/online<span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu7/online<span># Limit A57 max freq from msm_perf module in case CPU 4 is offline</span><span>echo</span> <span>&quot;4:960000 5:960000 6:960000 7:960000&quot;</span> <span>&gt;</span> /sys/module/msm_performance/parameters/cpu_max_freq<span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是保护措施，即当 hotplug 温控机制失效的时候，仅保留一颗 A57 以防止温度过高；当控制大核心簇的 CPU4 离线的时候，就控制 A57 的最大频率防止过热。</p><pre><code><span># configure governor settings for little cluster</span><span>echo</span> <span>&quot;interactive&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_sched_load<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_migration_notif<span>echo</span> 39000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/above_hispeed_delay<span>echo</span> 95 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load<span>echo</span> 20000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_rate<span>echo</span> 960000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/io_is_busy<span>echo</span> 85 960000:90 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads<span>echo</span> 40000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time<span>echo</span> 80000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/max_freq_hysteresis<span>echo</span> 384000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq<span># online CPU4</span><span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/online<span># configure governor settings for big cluster</span><span>echo</span> <span>&quot;interactive&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_sched_load<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_migration_notif<span>echo</span> 39000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay<span>echo</span> 90 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/go_hispeed_load<span>echo</span> 20000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_rate<span>echo</span> 768000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/hispeed_freq<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/io_is_busy<span>echo</span> <span>&quot;85 1248000:95&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/target_loads<span>echo</span> 40000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/min_sample_time<span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/max_freq_hysteresis<span>echo</span> 384000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个是对 CPU 调速器的参数控制。</p><p>这些参数的含义是：</p><pre><code><span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu0/online// 暴力关核或者开核（有的 romer 就是这么优化 CPU 的，所以用户老是抱怨卡的要命）<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load// 当 CPU 负载超过 x 时升频，CM 和魔趣默认都用 99。<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq// 当 go_hispeed_load 达到或超过设定值时，CPU 调到 x 频率。<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads// 定义了前台应用程序对 CPU 的负载达到多少时进入预订频率 语法是 <span>&quot;m1 n1:m2 n2:。。。:m n:z&quot;</span> m 指的是负载值，n 指的是预设频率，z 是上限。即负载在 m1-m2 之间运行在 n1 频率，负载在 m2-m3 之间运行在 n2 频率。当负载超过 z 时，该规则不再生效（即使用内核默认的缺省数值）。<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay// 升频之间的间隔时间, 单位是微秒 语法是 <span>&quot;m1 n1:m2 n2:。。。:z&quot;</span>m 指的是时间间隔，n 指的是频率（单位为 Hz），z 是上限即频率在 n1 时间隔为 m1，n2 时间隔为 m2当频率没有被 n 定义时，间隔统一为 z<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time// 采样时间，单位微秒。（内核探看 CPU 负载的间隔时间）<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/io_is_busy// 对于 big.LITTLE 大小核架构，建议只对强劲的 CPU 开启！ 比如 615 高通默认大小核都不开，810 高通默认大小核都开。<span>echo</span> x <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq//CPU 的最低频率。建议用内核给定的最低值而不是自定义。<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据我的要求，把这些改成了。</p><pre><code><span># configure governor settings for little cluster</span><span>echo</span> <span>&quot;interactive&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_sched_load<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_migration_notif<span>echo</span> 39000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/above_hispeed_delay<span>echo</span> 99 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load<span>echo</span> 20000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_rate<span>echo</span> 960000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/io_is_busy<span>echo</span> <span>&quot;75 460800:85 960000:90&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads<span>echo</span> 40000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time<span>echo</span> 80000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/interactive/max_freq_hysteresis<span>echo</span> 384000 <span>&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq<span># online CPU4</span><span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/online <span># configure governor settings for big cluster</span><span>echo</span> <span>&quot;interactive&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_sched_load<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_migration_notif<span>echo</span> <span>&quot;19000 1400000:39000 1700000:19000&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay<span>echo</span> 99 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/go_hispeed_load<span>echo</span> 20000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_rate<span>echo</span> 960000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/hispeed_freq<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/io_is_busy<span>echo</span> <span>&quot;70 960000:80 1248000:85 1500000:90&quot;</span> <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/target_loads<span>echo</span> 40000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/min_sample_time<span>echo</span> 80000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/interactive/max_freq_hysteresis<span>echo</span> 384000 <span>&gt;</span> /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来是 core_ctl 参数。</p><blockquote><p>core_ctl 是由 /system/lib/modules/core_ctl.ko 文件控制的 CPU 控制机制，根据 CPU 的负载和温度控制 CPU 上线和离线。</p><p>在 core_ctl 的帮助下可以解决待机低负载少核与操作时负载上升时启动多核的矛盾。</p></blockquote><pre><code><span># configure core_ctl module parameters</span><span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/max_cpus<span>echo</span> 2 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/min_cpus<span>echo</span> 60 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/busy_up_thres<span>echo</span> 30 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/busy_down_thres<span>echo</span> 100 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/offline_delay_ms<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/is_big_cluster<span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/task_thres<span># ztemt:rm core_ctl module rmmod /system/lib/modules/core_ctl.ko</span><span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/task_thres<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这些意思是当平均负载大于 60 时，会有一颗 A57 上线；平均负载小于 30 时，要有 A57 离线；最多只有 4 颗 A57 上线，最少会有 2 颗 A57 在线；在 A57 离线之前至少需要 100 毫秒；A57 能承受大负载长线程。</p></blockquote><p>然而与此同时，我很痛扁一下努比亚的工程师。因为他们直接把 core_ctl 关闭了。。。core_ctl 有什么用我也说了，所以为什么要关掉呢？</p><p>于是我修改成这样——给 A53 也定义了 core_ctl，并且修改了参数，去掉了 rmmod 指令。</p><pre><code><span># core_ctl module</span><span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/max_cpus<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/min_cpus<span>echo</span> 70 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/busy_up_thres<span>echo</span> 20 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/busy_down_thres<span>echo</span> 100 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/offline_delay_ms<span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/is_big_cluster<span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu0/core_ctl/task_thres<span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/max_cpus<span>echo</span> 0 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/min_cpus<span>echo</span> 72 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/busy_up_thres<span>echo</span> 28 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/busy_down_thres<span>echo</span> 100 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/offline_delay_ms<span>echo</span> 1 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/is_big_cluster<span>echo</span> 4 <span>&gt;</span> /sys/devices/system/cpu/cpu4/core_ctl/task_thres<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>最后讲一点，有些 romer 宣称用 ondemand 调速器可以省电降温，宣称“发热 = 耗电，耗电≠发热”，这样的想法显然是错误的。ondemand 调速器的特点就是升频快降频也快，但是如果出现负载较高，而且没有调整好 ondemand 参数的阈值，就会引起频率只升不降，耗电也没法解决，而且频率较高，电压较大，功率较大，发热同样随之而来。Ondemand 如果经过参数调整，也是可以很省电的，就是把 ondemand 里面改个 powersaving 的参数，实现频率等阶梯降低 10% ，并且根据负载和所在频率梯度修改 sampling_time 就行。</p></blockquote>]]></content>
        
        <summary type="html">
            
            “高通骁龙 810 是我们的一款失败的产品”——高通工程师骁龙 810基本参数  首先给一下 Qualcomm MSM8994 Snapdragon 810 的基本参数：4x Quad-core 2.0 GHz ARM®Cortex™ A57 （big）@ 1.96GHz an
            
        </summary>
        
        <category term="实验室"/>
        
        <category term="Android"/>
        
        <category term="温控"/>
        
        <category term="骁龙 810"/>
        
        <category term="CPU"/>
        
        <category term="省电"/>
        
    </entry>
    
    <entry>
        <title>呐~生日快乐~Troy~</title>
        <link href="https://itroy.cc/712"/>
        <id>https://itroy.cc/712</id>
        
        <author>
            <name>Troy</name>
        </author>
        
        <published>2016-08-28T03:11:40+00:00</published>
        <updated>2016-08-28T03:11:40+00:00</updated>
        
        <content type="html"><![CDATA[<p>呐~生日快乐~Troy~</p>]]></content>
        
        <summary type="html">
            
            呐~生日快乐~Troy~
            
        </summary>
        
        <category term="日常"/>
        
        <category term="状态"/>
        
    </entry>
    
    <entry>
        <title>开始使用 ECC 证书</title>
        <link href="https://imququ.com/post/ecc-certificate.html"/>
        <id>https://imququ.com/post/ecc-certificate.html</id>
        
        <published>2016-08-27T15:10:18+00:00</published>
        <updated>2016-08-27T15:10:18+00:00</updated>
        
        <content type="html"><![CDATA[<p>我之前的文章多次提到 ECC 证书，但一直没有专门介绍 ECC 证书的文章，今天补上。本文包含三部分内容：1）简单介绍 ECC 证书是什么；2）介绍如何申请 ECC 证书；3）以 Nginx 为例介绍如何使用 ECC 证书。顺便说下，本站已经用上了 ECC 证书。要查看本站主要支持哪些技术特性，<a href="https://imququ.com/post/readme.html">可以点这里</a>。</p>
<h3>简单介绍</h3>
<p>HTTPS 通过 TLS 层和证书机制提供了内容加密、身份认证和数据完整性三大功能，可以有效防止数据被监听或篡改，还能抵御 MITM（中间人）攻击。TLS 在实施加密过程中，需要用到非对称密钥交换和对称内容加密两大算法。</p>
<p>对称内容加密强度非常高，加解密速度也很快，只是无法安全地生成和保管密钥。在 TLS 协议中，应用数据都是经过对称加密后传输的，传输中所使用的对称密钥，则是在握手阶段通过非对称密钥交换而来。常见的 AES-GCM、ChaCha20-Poly1305，都是对称加密算法。</p>
<p>非对称密钥交换能在不安全的数据通道中，产生只有通信双方才知道的对称加密密钥。目前最常用的密钥交换算法有 RSA 和 ECDHE：RSA 历史悠久，支持度好，但不支持 PFS（Perfect Forward Secrecy）；而 ECDHE 是使用了 ECC（椭圆曲线）的 DH（Diffie-Hellman）算法，计算速度快，支持 PFS。要了解更多 RSA 和 ECDHE 密钥交换的细节，可以阅读 Cloudflare 的<a href="https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/">这篇文章</a>。</p>
<p>只有非对称密钥交换，依然无法抵御 MITM 攻击，还得引入身份认证机制。对于大部分 HTTPS 网站来说，服务端一般通过 HTTP 应用层的帐号体系就能完成客户端身份认证；而浏览器想要验证服务端身份，需要用到服务端提供的证书。</p>
<p>浏览器会在两个步骤中用到证书：1）证书合法性校验。确保证书由合法 CA 签署，且适用于当前网站；2）使用证书提供的非对称加密公钥，完成密钥交换和服务端认证。</p>
<p>证书合法性校验的原理，简单总结如下：</p>
<ul>
<li>根据版本号、序列号、签名算法标识、发行者名称、有效期、证书主体名、证书主体公钥信息、发行商唯一标识、主体唯一标识、扩展等信息，生成 TBSCertificate（To Be Signed Certificate）信息；</li>
<li>签发数字签名：使用 HASH 函数对 TBSCertificate 计算得到消息摘要，再用 CA 的私钥进行加密，得到签名；</li>
<li>校验数字签名：使用相同的 HASH 函数对 TBSCertificate 计算得到消息摘要，与使用 CA 公钥解密签名得到内容相比较；</li>
</ul>
<p>可以看到校验证书需要同时用到签名和非对称加密算法：目前必须使用 SHA-2 做为证书签名函数（没有打 XP SP3 补丁的 IE6 不支持）；目前一般使用 RSA 算法对 TBSCertificate 进行非对称加密。可以通过 openssl 工具来查看证书签名算法：</p>
<pre><code>$ openssl x509 -in chained.pem -noout -text | grep <span>'Signature Algorithm'</span>

Signature Algorithm: sha256WithRSAEncryption
</code></pre>
<p>大部分 CA 都有证书链，浏览器对于收到的多级证书，需要从站点证书开始逐级验证，直至出现操作系统或浏览器内置的受信任 CA 根证书。</p>
<p>浏览器还需要校验当前访问的域名是否存在于证书 TBSCertificate 的 <code>Common Name</code> 或 <code>Subject Alternative Name</code> 字段之中。</p>
<p>在 RSA 密钥交换中，浏览器使用证书提供的 RSA 公钥加密相关信息，如果服务端能解密，意味着服务端拥有证书对应的私钥，同时也能算出对称加密所需密钥。密钥交换和服务端认证合并在一起。</p>
<p>在 ECDHE 密钥交换中，服务端使用证书私钥对相关信息进行签名，如果浏览器能用证书公钥验证签名，就说明服务端确实拥有对应私钥，从而完成了服务端认证。密钥交换和服务端认证是完全分开的。</p>
<p>可用于 ECDHE 数字签名的算法主要有 RSA 和 ECDSA，也就是目前密钥交换 + 签名有三种主流选择：</p>
<ul>
<li>RSA 密钥交换（无需签名）；</li>
<li>ECDHE 密钥交换、RSA 签名；</li>
<li>ECDHE 密钥交换、ECDSA 签名；</li>
</ul>
<p>以下是 Chrome 中这三种密钥交换方式的截图（截图来自于早期 Chrome，新版 Chrome 查看位置有了变化）：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/03/key_exchange.png" /></p>
<p>内置 ECDSA 公钥的证书一般被称之为 ECC 证书，内置 RSA 公钥的证书就是 RSA 证书。由于 256 位 ECC Key 在安全性上等同于 3072 位 RSA Key，加上 ECC 运算速度更快，ECDHE 密钥交换 + ECDSA 数字签名无疑是最好的选择。由于同等安全条件下，ECC 算法所需的 Key 更短，所以 ECC 证书文件体积比 RSA 证书要小一些。以下是本站的对比，可以看到左侧的 ECC 证书要小 1/3：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/ecc-certificate-vs-rsa-certificate.png" /></p>
<p>RSA 证书可以用于 RSA 密钥交换（RSA 非对称加密）或 ECDHE 密钥交换（RSA 非对称签名）；而 ECC 证书只能用于 ECDHE 密钥交换（ECDSA 非对称签名）。</p>
<p>并不是所有浏览器都支持 ECDHE 密钥交换，也就是说 ECC 证书的兼容性要差一些。例如在 Windows XP 中，使用 ECC 证书的网站只有 Firefox 能访问（Firefox 的 TLS 自己实现，不依赖操作系统）；Android 平台中，也需要 Android 4+ 才支持 ECC 证书。</p>
<p>好消息是，Nginx 1.11.0 开始提供了对 RSA/ECC 双证书的支持。它的实现原理是：分析在 TLS 握手中双方协商得到的 Cipher Suite，如果支持 ECDSA 就返回 ECC 证书，否则返回 RSA 证书。</p>
<p>也就是说，配合最新的 Nginx，我们可以使用 ECC 证书为现代浏览器提供更好的体验，同时老旧浏览器依然会得到 RSA 证书，从而保证了兼容性。这一次，鱼与熊掌可以兼得。</p>
<h3>如何申请</h3>
<p>如果你的 CA 支持签发 ECC 证书，使用以下命令生成 CSR（Certificate Signing Request，证书签名请求）文件并提交给提供商，就可以获得 ECC 证书：</p>
<pre><code>openssl ecparam -genkey -name secp256r1 | openssl ec -out ecc.key
openssl req -new -key ecc.key -out ecc.csr
</code></pre>
<p>以上命令中可供选择的算法有 secp256r1 和 secp384r1，secp521r1 已被 Chrome 和 Firefox 废弃。</p>
<p>我目前在用的 Let's Encrypt，也支持签发 ECC 证书。我使用了 <a href="https://github.com/Neilpang/acme.sh">acme.sh</a> 这个小巧的工具来签发证书，指定 <code>-k ec-256</code> 就可以将证书类型改为 ECC：</p>
<pre><code><span>&quot;/root/.acme.sh&quot;</span>/acme.sh --issue --dns dns_cx <span>-d</span> imququ.com <span>-d</span> www.imququ.com -k ec-256
</code></pre>
<p>目前 Let's Encrypt 只提供 RSA 中间证书，官方预计会在 2017 年 3 月底提供 ECC 中间证书（<a href="https://letsencrypt.org/upcoming-features/">via</a>）。</p>
<h3>如何使用</h3>
<p>有了 RSA/ECC 双证书之后，还需要安装 Nginx 1.11.x。这部分内容我之前详细写过，<a href="https://imququ.com/post/my-nginx-conf.html">请点击查看</a>。</p>
<p>一切准备妥当后，将证书配置改为双份即可：</p>
<pre><code><span>ssl_certificate</span>     example.com.rsa.crt;
<span>ssl_certificate_key</span> example.com.rsa.key;

<span>ssl_certificate</span>     example.com.ecdsa.crt;
<span>ssl_certificate_key</span> example.com.ecdsa.key;
</code></pre>
<p>问题来了！本站使用 Cloudflare 提供的 Cipher Suites 配置，在 Nginx 中配置了双证书并重启，用 Chrome 测试发现仍然没有采用 ECC 证书。这是为什么呢？</p>
<pre><code><span># https://github.com/cloudflare/sslconfig/blob/master/conf</span>
<span>ssl_ciphers</span>                 EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
<span>ssl_prefer_server_ciphers</span>   <span>on</span>;
</code></pre>
<p>研究发现，Chrome 与服务端协商到的 Cipher Suites 是 <code>ECDHE-RSA-AES128-GCM-SHA256</code>，来自于 <code>ssl_ciphers</code> 配置中的 <code>EECDH+AES128</code> 这部分。我们通过 openssl 工具看一下 <code>EECDH+AES128</code> 具体包含哪些 Cipher Suites：</p>
<pre><code>openssl ciphers -V <span>'EECDH+AES128'</span> | column -t

0xC0,0x2F  -  ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2  Kx=ECDH  Au=RSA    Enc=AESGCM(128)  Mac=AEAD
0xC0,0x2B  -  ECDHE-ECDSA-AES128-GCM-SHA256  TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AESGCM(128)  Mac=AEAD
0xC0,0x27  -  ECDHE-RSA-AES128-SHA256        TLSv1.2  Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA256
0xC0,0x23  -  ECDHE-ECDSA-AES128-SHA256      TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA256
0xC0,0x13  -  ECDHE-RSA-AES128-SHA           SSLv3    Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA1
0xC0,0x09  -  ECDHE-ECDSA-AES128-SHA         SSLv3    Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA1
</code></pre>
<p>可以看到，使用 RSA 做为签名认证算法（Au=RSA）的加密套件排到了前面，导致 Nginx 作出了错误判断。</p>
<p>知道原因就好办了，将这段配置改为 <code>EECDH+ECDSA+AES128:EECDH+aRSA+AES128</code>，再看一下：</p>
<pre><code>openssl ciphers -V <span>'EECDH+ECDSA+AES128:EECDH+aRSA+AES128'</span> | column -t

0xC0,0x2B  -  ECDHE-ECDSA-AES128-GCM-SHA256  TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AESGCM(128)  Mac=AEAD
0xC0,0x23  -  ECDHE-ECDSA-AES128-SHA256      TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA256
0xC0,0x09  -  ECDHE-ECDSA-AES128-SHA         SSLv3    Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA1
0xC0,0x2F  -  ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2  Kx=ECDH  Au=RSA    Enc=AESGCM(128)  Mac=AEAD
0xC0,0x27  -  ECDHE-RSA-AES128-SHA256        TLSv1.2  Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA256
0xC0,0x13  -  ECDHE-RSA-AES128-SHA           SSLv3    Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA1
</code></pre>
<p>这下就没问题了。</p>
<p>并不是所有加密套件都需要把 ECDSA 和 aRSA 分开写，例如 <code>EECDH+CHACHA20</code> 就不需要，ECDSA 默认就在前面：</p>
<pre><code>openssl ciphers -V <span>'EECDH+CHACHA20'</span> | column -t

0xCC,0xA9  -  ECDHE-ECDSA-CHACHA20-POLY1305  TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=ChaCha20-Poly1305  Mac=AEAD
0xCC,0xA8  -  ECDHE-RSA-CHACHA20-POLY1305    TLSv1.2  Kx=ECDH  Au=RSA    Enc=ChaCha20-Poly1305  Mac=AEAD
</code></pre>
<p>最终，我的 Cipher Suites 配置如下，供参考：</p>
<pre><code><span>ssl_ciphers</span>                EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5;
</code></pre>
<p>本文链接：<a href="https://imququ.com/post/ecc-certificate.html">https://imququ.com/post/ecc-certificate.html</a>，<a href="https://imququ.com/post/ecc-certificate.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            我之前的文章多次提到 ECC 证书，但一直没有专门介绍 ECC 证书的文章，今天补上。本文包含三部分内容：1）简单介绍 ECC 证书是什么；2）介绍如何申请 ECC 证书；3）以 Nginx 为例介绍如何使用 ECC 证书。顺便说下，本站已经用上了 ECC 证书。要查看本站主要
            
        </summary>
        
    </entry>
    
    <entry>
        <title>HTTP Alternative Services 介绍</title>
        <link href="https://imququ.com/post/http-alt-svc.html"/>
        <id>https://imququ.com/post/http-alt-svc.html</id>
        
        <published>2016-08-21T14:27:29+00:00</published>
        <updated>2016-08-21T14:27:29+00:00</updated>
        
        <content type="html"><![CDATA[<p><a href="https://tools.ietf.org/html/rfc7838">HTTP Alternative Services</a>（HTTP 替代服务）是今年上半年由 IESG 通过的一项与 HTTP 有关的新协议。估计很少有人能从名字上猜出它是用来干嘛的，本文从解决什么问题、如何使用以及真实场景下的应用三方面来介绍这份协议。</p>
<p>顺便说一下，HTTP 各种协议除了可以在 <a href="https://tools.ietf.org/">tools.ietf.org</a> 找到，还可以前往 <a href="http://httpwg.org/specs/">httpwg.org</a> 查看。后者格式更丰富，阅读体验更好，例如本文介绍的 HTTP Alternative Services 协议也可以通过<a href="http://httpwg.org/specs/rfc7838.html">这个地址</a>查看。</p>
<h3>解决什么问题</h3>
<p>在 Web 系统中，我们经常有把用户导向不同服务器的需求，例如让不同地域的用户访问离自己最近的服务器。记得我刚上网那会儿，很多网站都会提供电信 / 网通等不同二级域名，供不同运营商用户选择，这无疑增加了使用成本。当前，一般网站都使用 DNS 服务来解决这个问题：按地域、运营商等条件，将用户 DNS 请求解析到最合适的 IP。这种方案需要配置合理的 TTL（Time To Live）时间，太短会造成客户端频繁发起 DNS 查询，影响访问速度；太长则无法让 DNS 修改及时生效。</p>
<p>大型 Web 系统经常会出现某个机房流量过大，需要尽快分流给其它机房这种场景。这时候依靠修改 DNS 解析有点力不从心：一方面由于 DNS 缓存的存在，新的解析不能马上生效；另一方面由于 HTTP 的 keep-alive 机制，已连接的浏览器还会继续使用之前解析到的 IP。</p>
<p>而 HTTP Alternative Services 可以很好地解决这个问题：服务端可以将自己的替代服务地址以协议规定的方式告诉浏览器，对于支持这个协议的浏览器来说，后续请求都会使用新地址。</p>
<p>协议规定的替代服务地址由三部分组成：协议、主机名和端口。也就是说一个网站的替代服务，可以部署在不同 IP、不同端口，甚至使用不同协议。</p>
<p>不同于使用 30x 状态码进行重定向分流，<strong>HTTP Alternative Services 只改变浏览器获取资源的网络方式，上层应用不会感觉到任何变化</strong>。以下是两个示例：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/http-alt-svr-firefox.png" />（截图一：Firefox 48.0.1）</p>
<p>在截图一中，浏览器通过 TLS 加密通道发起了 HTTP/2 请求，但上层拿到的 Request URL 仍然是 <code>http://</code> 开头的地址，浏览器地址栏也仍然显示为 <code>http://</code>。</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/http-alt-svr-chrome.png" />（截图二：Chrome 54.0.2835.0 canary）</p>
<p>在截图二中，浏览器将请求发送给了服务器 444 端口，而上层拿到的 Request URL 没有任何变化。</p>
<h3>如何使用</h3>
<p>对于 HTTP/1，协议新增了一个响应头部 <code>Alt-Svc</code>，用来指定替代服务地址，它的基本格式如下：</p>
<pre><code>Alt-Svc: h2=&quot;alt.example.com:8000&quot;, h2=&quot;:443&quot;; ma=2592000; persist=1
</code></pre><p><code>h2=&quot;alt.example.com:8000&quot;</code> 这部分内容定义了替代服务使用的协议、主机名和端口，其中主机名和端口可选。多个替代服务之间用英文逗号分隔。</p>
<p><code>ma</code> 是 max-age 的缩写，单位为秒。显然，它表示浏览器在指定时间内，可以直接使用替代服务地址。</p>
<p>协议还规定，当网络发生变化时（例如从 WIFI 切到 3G），浏览器必须弃用当前所有替代服务，除非定义了 <code>persist=1</code>。</p>
<p>对于 HTTP/2，协议新增了一个 <code>ALTSVC</code> 帧，具体定义这里略过。</p>
<p>可以看到，对于 HTTP/1 来说，<code>Alt-Svc</code> 头部必须依附于首次响应，只有从第二个请求开始浏览器才会使用替代服务地址；而在 HTTP/2 中，<code>ALTSVC</code> 帧可以独立发送，浏览器从首次请求开始就能用上新地址。</p>
<p>目前只有 Firefox 完整支持了 HTTP Alternative Services 协议，以下是在 Firefox 中的测试。</p>
<p>首次访问指定地址时，服务端返回了一个 <code>Alt-Svc</code> 头部，指定了替代服务地址：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/http-alt-svr-firefox-1.png" /></p>
<p>再次访问时，浏览器就会使用替代服务地址中指定的协议、主机名和端口发起请求。这一切对上层应用透明，但发往替代服务的请求头部，会多出一个 <code>Alt-Used</code> 字段：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/http-alt-svr-firefox-2.png" /></p>
<p>需要注意的是，尽管我使用 <code>test.qgy18.com</code> 做为替代服务主机名，但浏览器在向替代服务发起请求时，仍然会使用当前页面的主机名。以下是 Wireshark 抓到的信息，SNI 依然是 <code>qgy18.com</code>：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/http-alt-svr-wireshark.png" /></p>
<p>出于安全考虑，协议提出了两点要求：1）所有替代服务必须基于 TLS 部署；2）原网站为 HTTPS 的情况下，替代服务必须使用原网站证书部署。特别地，在 Chrome 中，只有 HTTPS 原网站才能使用替代服务。</p>
<h3>真实案例</h3>
<p>Firefox 37 基于 HTTP Alternative Services 协议提出了一个非常有意思的方案：<a href="http://bitsup.blogspot.tw/2015/03/opportunistic-encryption-for-firefox.html">Opportunistic Encryption</a>（不知道怎么翻译，请读者自己意会，后续简称为 OE），我们一起来看下。</p>
<p>我们知道对于 HTTPS 而言，如果没有证书信任链校验机制，无法抵御 MITM（中间人）攻击。但 Firefox 认为，不校验证书的 TLS 网站怎么也比纯明文传输要强，对于那些短期内无法切换到 HTTPS 的网站来说，OE 提供了一种可以使用 TLS 进行传输加密，但不进行证书校验的折衷方案。</p>
<p>实施这个方案只需以下两步：</p>
<ul>
<li>部署 HTTP/2 over TLS 服务，允许使用自签名证书；</li>
<li>给网站响应头部加上：<code>Alt-Svc: h2=&quot;:443&quot;; ma=600</code>；</li>
</ul>
<p>当用户通过 <code>http://yourdomain.com</code> 访问网站时，对于能够识别 <code>Alt-Svc</code> 的浏览器来说，后续所有流量都会使用新协议（HTTP/2 over TLS）、新端口（443）。同时对于上层应用来说，URL 依然是 <code>http://yourdomain.com</code>，没有任何变化。也就是说，OE 在提升安全性和性能的同时，无需对 Web 应用代码作出任何修改。</p>
<p>但在 OE 中，用户首次访问还是走的 HTTP，响应很容易就被篡改，从而去掉 <code>Alt-Svc</code> 头部；即便是后续使用基于 TLS 部署的替代服务地址，由于浏览器不校验证书，还是很容易被攻击。所以，它只能将 HTTP 网站从<strong>极不安全</strong>提升到<strong>不安全</strong>，作用有限。</p>
<p>有趣的是，Firefox 37 推出 OE 之后，很快就被发现存在巨大的安全问题，官方不得不迅速推出 37.0.1 来禁用 OE。当然，产生问题的原因是代码实现上的疏忽，修复 Bug 后，Firefox 又重新启用了它。</p>
<p>Chrome 并不打算支持 Opportunistic Encryption，考虑 Firefox 当前的市场占有率，我个人觉得对于 OE 方案，大家了解下就可以了。</p>
<p>本文链接：<a href="https://imququ.com/post/http-alt-svc.html">https://imququ.com/post/http-alt-svc.html</a>，<a href="https://imququ.com/post/http-alt-svc.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            HTTP Alternative Services（HTTP 替代服务）是今年上半年由 IESG 通过的一项与 HTTP 有关的新协议。估计很少有人能从名字上猜出它是用来干嘛的，本文从解决什么问题、如何使用以及真实场景下的应用三方面来介绍这份协议。 顺便说一下，HTTP 各种协
            
        </summary>
        
    </entry>
    
    <entry>
        <title>谈谈 Nginx 的 HTTP/2 POST Bug</title>
        <link href="https://imququ.com/post/nginx-http2-post-bug.html"/>
        <id>https://imququ.com/post/nginx-http2-post-bug.html</id>
        
        <published>2016-08-20T06:03:03+00:00</published>
        <updated>2016-08-20T06:03:03+00:00</updated>
        
        <content type="html"><![CDATA[<p>几个月前，我发现在某些情况下，使用 Safari 无法登录我的博客后台。当时研究了一下，发现这是 Nginx 处理 HTTP/2 POST 请求的一个 Bug。由于随后发布的 Nginx 1.11.0 修复了这个 Bug，我没有再持续关注。直到今天看到 <a href="http://v2ex.com/t/300566">v2ex 这个帖子</a>，我才发现 Nginx <strong>并没有</strong>将修复代码合并到当前稳定版中。所以，<strong>如果你在使用 Nginx 1.9.15~1.10.x 部署 HTTP/2 服务，请务必看完本文</strong>。</p>
<h3>Bug 复现</h3>
<p>复现这个 Bug 需要同时满足以下几个条件：</p>
<ul>
<li>使用 Nginx 特定版本（1.9.15~1.10.x）部署 HTTP/2 服务；</li>
<li>使用特定的 HTTP/2 客户端，例如 OSX/iOS Safari、iOS 客户端、OkHttp 等（Chrome 没问题，MS IE/Edge 据说也有问题，但我没测试）；</li>
<li>只有 POST 场景才有问题（也就是说必须存在 DATA 帧）；</li>
<li>需要在建立 HTTP/2 连接后立即 POST（例如打开表单页面，再断网重连或重启 Nginx，不刷新页面直接提交）；</li>
</ul>
<p>我用 OSX 10.11.6 自带的 Safari 9.1.2 可以稳定复现这个 Bug。触发 Bug 后，Safari 会提示无法连接到服务器。如下图：</p>
<p><img src="https://st.imququ.com/static/uploads/2016/08/nginx-http2-bug.gif" /></p>
<p>如果事先开启了 Nginx 的 debug 日志，可以找到类似这样的记录：</p>
<pre><code>client sent stream with data before settings were acknowledged while processing HTTP/2 connection
</code></pre><h3>产生原因</h3>
<p>为了减少网络时延，不少 HTTP/2 客户端会在建立 HTTP/2 连接时同时发送其它帧，包括用来 POST 数据的 DATA 帧。而 Nginx 在客户端接受到 SETTINGS 帧之前，一直将初始窗口大小（initial window size）设置为 0。也就是说，客户端收到 SETTINGS 帧之前发送的 DATA 帧，会被 Nginx 以 REFUSED_STREAM 帧拒绝。而部分客户端在收到 REFUSED_STREAM 帧之后，会提示连接失败，而不是发起重试，这就是产生 Bug 的原因。</p>
<p>那么，Nginx 这个逻辑合理吗，客户端提前发送 DATA 帧符合 HTTP/2 协议规定吗？HTTP/2 协议中的「HTTP/2 Connection Preface」章节有以下描述：</p>
<blockquote>
<p>To avoid unnecessary latency, clients are permitted to send additional frames to the server immediately after sending the client connection preface, without waiting to receive the server connection preface. It is important to note, however, that the server connection preface SETTINGS frame might include parameters that necessarily alter how a client is expected to communicate with the server. Upon receiving the SETTINGS frame, the client is expected to honor any parameters established. In some configurations, it is possible for the server to transmit SETTINGS before the client sends additional frames, providing an opportunity to avoid this issue. <a href="https://http2.github.io/http2-spec/#ConnectionHeader">via</a></p>
</blockquote>
<p>出于减少时延的目的，HTTP/2 协议允许客户端在发送连接序言（connection preface）之后，立即发送其它帧，无需等待来自服务端的 SETTTINGS 帧。</p>
<p>而 Nginx 能够正常处理客户端提前发送的其它帧，唯独 DATA 帧不行。因为客户端尚未收到 SETTINGS 帧之前，Nginx 将初始窗口大小设置为 0。</p>
<p>那么 Nginx 的初始窗口大小应该设置为多少才合理呢？以下这段内容来自于 HTTP/2 协议的「Initial Flow-Control Window Size」章节：</p>
<blockquote>
<p>Prior to receiving a SETTINGS frame that sets a value for SETTINGS_INITIAL_WINDOW_SIZE, an endpoint can only use the default initial window size when sending flow-controlled frames. Similarly, the connection flow-control window is set to the default initial window size until a WINDOW_UPDATE frame is received. <a href="https://http2.github.io/http2-spec/#InitialWindowSize">via</a></p>
</blockquote>
<p>也就是说 Nginx 应该将默认的初始窗口大小设置为 64KB。</p>
<h3>如何解决</h3>
<p>我猜测 Nginx 这么做是为了减少被攻击的风险，但无论如何这不符合 HTTP/2 协议规定，也造成了特定场景下 POST 请求不可用。<strong>Nginx 在 1.11.0 中解决了这一问题</strong>，并增加了一个配置项：</p>
<blockquote>
<p>Syntax:    http2_body_preread_size size; <br />
Default:    http2_body_preread_size 64k; <br />
Context:    http, server <br />
This directive appeared in version 1.11.0. <br />
 <br />
Sets the size of the buffer per each request in which the request body may be saved before it is started to be processed. <a href="https://nginx.org/en/docs/http/ngx_http_v2_module.html#http2_body_preread_size">via</a></p>
</blockquote>
<p><code>http2_body_preread_size</code> 用来定义 Nginx 在客户端收到 SETTINGS 帧之前可以接受多大的 DATA 帧，默认为 64KB。如果将这个值设置为 0，那就跟之前版本的 Nginx 变得一样。</p>
<p>需要特别注意的是，<strong>这个 Bug 由 Nginx 1.9.15 引入，而官方表示修复方案不会被移植到当前稳定版中，也就是对于 Nginx 1.9.15~1.10.x，这个问题将始终存在</strong>。对此，Nginx 有如下解释：</p>
<blockquote>
<p>We don't backport features to the stable branch (that's what we call stable, no enhancements). It receives only critical bug fixes. If you use such new, very complicated and actively developing protocol as HTTP/2 then it's naturally that you have to stay with the mainline branch.
<a href="https://trac.nginx.org/nginx/ticket/959#comment:25">via</a></p>
</blockquote>
<p>简而言之，Nginx 认为 HTTP/2 功能本身尚未稳定，要部署 HTTP/2 就应该使用 Nginx 主线版，而不是稳定版。从更新日志来看，Nginx 最近几个主线版本也一直在修复与 HTTP/2 有关的问题，印证了这一说法。</p>
<p>HTTP/2 是一项年轻的技术，也是 HTTP 历史上最大的一次革新。在实践 HTTP/2 过程中，一定要有时刻踩坑的心理准备，更要时刻关注 HTTP/2 协议和实现者的最新动态。对于重要业务，一定要在充分测试和评估之后再推进 HTTP/2。</p>
<blockquote>
<p>Update @ 2016.10.21，Nginx 最终还是在 <a href="http://nginx.org/en/CHANGES-1.10">1.10.2</a> 也修复了这个 Bug，使用稳定版的同学可以考虑升级了。感谢 @ZE3kr 的反馈。</p>
</blockquote>
<p>本文链接：<a href="https://imququ.com/post/nginx-http2-post-bug.html">https://imququ.com/post/nginx-http2-post-bug.html</a>，<a href="https://imququ.com/post/nginx-http2-post-bug.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            几个月前，我发现在某些情况下，使用 Safari 无法登录我的博客后台。当时研究了一下，发现这是 Nginx 处理 HTTP/2 POST 请求的一个 Bug。由于随后发布的 Nginx 1.11.0 修复了这个 Bug，我没有再持续关注。直到今天看到 v2ex 这个帖子，我才
            
        </summary>
        
    </entry>
    
    <entry>
        <title>良心不易</title>
        <link href="https://blackyau.cc/guozixi.html"/>
        <id>https://blackyau.cc/guozixi.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2016-08-18T04:18:00+00:00</published>
        <updated>2016-08-18T04:18:00+00:00</updated>
        
        <content type="html"><![CDATA[<p>这个世界上的任何资源都是有限的，人们为了得到自己需要且有限的资源也会为之而奋斗。但这不是全部，依然有很多人会为了较低成本得到资源而选择捷径。</p><p>走路这么健康为什么还要坐车呢？纸质书这么有感觉为什么还要kindle呢？一个人生活这么舒适为什么还要情侣呢？科技的进步和生活的提升都是源于懒。</p><p>我们每个人都因为懒而寻找着捷径，当然不是每一个人都能够一条直线的走向终点。也许你会四处碰壁在原地旋转、也许你会通过努力慢慢找到终点。如果你足够幸运的话也许会有一位高人为你指点迷津。虽然每个人的时间都是最珍贵的资源，但总有极少部分人会在原地给他人做指路明灯。</p><p>为小白指路是很麻烦也极其费时的，也许还会因为触动到了他人的利益成为喷子的对象。在我生命中的17年间，我也看到了不少良心却在也回不来的网站。射手网、人人影视、牛博网...</p><p>而我现在也正见证着一个良心网站的崛起。<a href="https://mat.letitfly.me/">My Android Tools BBS</a>，它的背后也正是一个值得尊敬的人。禁用回复可见、需积分购买帖5天自动公开、不强制认证邮箱、坚决不出售给任何商业公司、不放置任何商业广告。每个规定都给了国内各大论坛扇了一个响亮的耳光。</p><p>为了用户的体验，而果断砍掉/限制了这些对网站运营都“很重要”的功能。我们都希望这种网站能够多起来，我们都一样这样的网站能够一直做下去。虽然我们不能给站长+1s，但是我还是希望这个世界上愿意为良心致敬的人能够多起来。</p><p>献给My Android Tools BBS站长<strong>guozixi</strong><br /><img src="https://blackyau.b0.upaiyun.com/blog/guozixi/1.png" /></p>]]></content>
        
        <summary type="html">
            
            这个世界上的任何资源都是有限的，人们为了得到自己需要且有限的资源也会为之而奋斗。但这不是全部，依然有很多人会为了较低成本得到资源而选择捷径。走路这么健康为什么还要坐车呢？纸质书这么有感觉为什么还要kindle呢？一个人生活这么舒适为什么还要情侣呢？科技的进步和生活的提升都是源于
            
        </summary>
        
    </entry>
    
    <entry>
        <title>开始使用 Docker</title>
        <link href="https://imququ.com/post/use-docker.html"/>
        <id>https://imququ.com/post/use-docker.html</id>
        
        <published>2016-08-14T07:03:49+00:00</published>
        <updated>2016-08-14T07:03:49+00:00</updated>
        
        <content type="html"><![CDATA[<p>一年前，我在《<a href="https://imququ.com/post/vagrantup.html">开始使用 Vagrant</a>》一文中写到：使用虚拟化软件安装 Linux，有着「统一线下线上环境、不受升级宿主系统的影响、容易备份和恢复」等几大优点，非常适用于搭建 WEB 开发环境。</p>
<p>但 Vagrant 这种依赖 VirtualBox/VMWare/Parallels Desktop 等软件虚拟完整操作系统的方案有几个硬伤，例如占用大量系统资源、新建或启动虚拟机不够迅速等。Docker 是操作系统级虚拟化，它虚拟出来的环境一般被称为 Docker 容器，而不是虚拟机。Docker 容器直接运行在宿主系统的操作系统内核之上，启动一个新的 Docker 容器能在秒级完成。</p>
<p>由于 Docker 轻量、快速和高效，除了用于搭建开发环境，Docker 容器也非常适合用来部署线上服务。最近我将本博客程序改用 Docker 部署，你现在看到的页面正是由 Docker 容器提供服务。本文介绍这一过程。</p>
<h3>安装 Docker</h3>
<p><a href="https://www.docker.com/products/overview#/install_the_platform">Docker 官方文档</a>详尽地列出了各个系统下的 Docker 安装说明，请直接点过去看，本文不做搬运。</p>
<p>对于 Windows/Mac 用户而言，推荐安装 Docker for Window/Mac，而不是 Docker Toolbox。前者可以直接利用宿主系统的虚拟化机制，拥有更好的性能；后者需要借助 VirtualBox 运行的 Linux 虚拟机。</p>
<h3>镜像和容器</h3>
<p>Docker 基于 Docker 镜像运行容器，通常我们所需大部分镜像都可以在 <a href="https://hub.docker.com/">hub.docker.com</a> 找到。</p>
<p>在装好 Docker 的终端中，运行以下命令就可以启动容器：</p>
<pre><code>docker run ubuntu uname <span>-a</span>
</code></pre>
<p>不出意外，可以看到这样的输出：</p>
<pre><code>Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
2f0243478e1f: Pull complete
d8909ae88469: Pull complete
820f09abed29: Pull complete
01193a8f3d88: Pull complete
Digest: sha256:8e2324f2288c26e1393b63e680ee7844202391414dbd48497e9a4fd997cd3cbf
Status: Downloaded newer image for ubuntu:latest
Linux 99bebffc2678 4.4.16-moby #1 SMP Tue Aug 9 17:20:17 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p><code>docker run</code> 命令用来从指定镜像启动容器。由于我本地没有 ubuntu 镜像，Docker 首先会从官方 Hub 下载它；然后启动容器并执行 <code>uname -a</code> 命令。这个命令是在 Docker 容器内执行，输出的是容器系统信息。</p>
<p>查看和管理 Docker 镜像及容器，主要有这些命令：</p>
<ul>
<li><code>docker images</code>：查看本地已经存在的镜像，<code>-a</code> 列出所有（默认不包括中间镜像）；</li>
<li><code>docker rmi IMAGE</code>：删除指定的镜像，<code>-f</code> 强制删除；</li>
<li><code>docker ps</code>：查看运行中的 Docker 容器，<code>-a</code> 列出所有（默认不包括未运行的容器）；</li>
<li><code>docker rm CONTAINER</code>：删除指定的容器，<code>-f</code> 强制删除；</li>
</ul>
<p>使用 Docker 的最佳实践是保持职责单一，一个容器只提供一个服务。我的博客主要有这些服务：</p>
<ul>
<li>Nginx（80/443）；</li>
<li>MySQL（3306）；</li>
<li>Memcached（11211）；</li>
<li>ElasticSearch（9200）；</li>
<li>ThinkJS（8085）；</li>
</ul>
<p>考虑到我经常折腾 Nginx，我选择把它留在宿主系统，剩余四个服务则改用 Docker 容器来运行。</p>
<h3>构建镜像</h3>
<p>我需要的 Mysql、Memcache、ElasticSearch 容器都可以使用官方镜像来运行。但我的博客系统，使用官方 Node.js 镜像存在两个问题：1）官方镜像中的 npm 是 v2，我希望换成 v3；2）官方镜像没有 libvips 库，无法安装本博客程序所依赖的 sharp npm 包。</p>
<p>遇到这种情况，可以在 Docker Hub 看看有无第三方 Docker 镜像能够满足需求，也可以构造自己的镜像。我选择后者。</p>
<p>要构建自己的 Docker 镜像，一般都会选定一个已有的镜像做为基础，再在上面增加自己的修改。我的 DockerFile 如下：</p>
<pre><code><span>FROM</span> marcbachmann/libvips
<span>MAINTAINER</span> quguangyu@gmail.com

<span>RUN</span> <span>apt-get update
</span>
<span># 修改时区</span>
<span>RUN</span> <span>ln -sf /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime
</span>
<span># 安装依赖</span>
<span>RUN</span> <span>apt-get install -y \
  python \
  curl \
  build-essential
</span>
<span># 安装 Node.js v4.x.x LTS</span>
<span>RUN</span> <span>curl <span>-s</span>L https://deb.nodesource.com/setup_4.x | bash -
</span><span>RUN</span> <span>apt-get install -y nodejs
</span>
<span># 安装 npm v3 和 pm2</span>
<span>RUN</span> <span>npm install -g npm@3 pm2
</span>
<span># 解决 npm 在 docker 下经常 rename 失败的问题。详见：</span>
<span># https://forums.docker.com/t/npm-install-doesnt-complete-inside-docker-container/12640/3</span>
<span>RUN</span> <span><span>cd</span> $(npm root -g)/npm \
  &amp;&amp; npm install fs-extra \
  &amp;&amp; sed -i <span>-e</span> s/graceful-fs/fs-extra/ <span>-e</span> s/fs\.rename/fs.move/ ./lib/utils/rename.js</span>
</code></pre>
<p>这份 DockerFile 作用是在 <code>marcbachmann/libvips</code> 镜像上增加了我需要的 Node.js，将 npm 升级到了 v3，还安装了 pm2。</p>
<p>在 DockerFile 所在目录，执行以下命令就可以构建镜像，并将其推送至 <a href="https://hub.docker.com/">Docker Hub</a>（这里略过注册和登录过程）：</p>
<pre><code>docker build -t qgy18/node .
docker push qgy18/node
</code></pre>
<h3>Docker Compose</h3>
<p>Docker Compose 是一个小工具。我们可以在一个文件里定义多个容器，使用 <code>docker-compose</code> 命令让它们全部运行就绪。Docker Compose 非常适合用来部署 WEB 系统这种需要多个容器配合工作的服务。</p>
<p>如果你使用的是 Docker for Windows/Mac，<code>docker-compose</code> 命令应该直接可用。对于 Linux 平台，请参考<a href="https://docs.docker.com/compose/install/">官方文档</a>安装 Docker Compose。</p>
<p>当前，我的博客系统目录结构如下：</p>
<pre><code>├── blog
│   ├── app
│   ├── node_modules
│   ├── package.json
│   ├── pm2.json
│   ├── view
│   └── www
├── db
│   ├── ...
│   ├── ququ_blog
│   └── sys
├── docker-compose.yml
├── esroot
│   ├── config
│   ├── data
│   └── plugins
└── shell
    ├── backup_blog_database.sh
    └── install_blog_package.sh
</code></pre><p>我将所有需要持久化存储的文件都放在了宿主系统，例如代码目录（blog），数据库文件（db），ElasticSearch 配置、插件及数据文件（esroot）。这样数据更加安全，也更易于管理。</p>
<p>shell 目录下的 <code>install_blog_package.sh</code> 用来安装博客 npm 依赖，我的宿主系统没有安装 Node.js，运行 <code>npm install</code> 也需要借助 Docker 容器，一行命令搞定：</p>
<pre><code>docker run -it --rm -v <span>&quot;<span>$PWD</span>/../blog&quot;</span>:/app -w <span>&quot;/app&quot;</span> qgy18/node npm install --registry=http://registry.npm.taobao.org --production
</code></pre>
<p>这行命令首先基于前面构建好的镜像运行了一个拥有 Node.js 和 npm3 的容器；然后将宿主系统的 <code>blog</code> 目录映射为容器的 <code>/app</code> 目录；再将容器的工作目录设置为 <code>/app</code>；最后执行 <code>npm install</code> 安装依赖。最为神奇的是，由于指定了 <code>--rm</code> 参数，这个容器在完成工作之后就会被彻底销毁，不留任何痕迹。</p>
<p>类似的，由于宿主系统不再需要安装 MySQL，备份数据库也需要在容器内完成，这时候可以使用 <code>docker exec</code> 命令在已经运行的容器内执行指令。以下是 <code>backup_blog_database.sh</code> 文件的内容：</p>
<pre><code>docker <span>exec</span> imququ_db mysqldump -uroot -p****** ququ_blog | gzip &gt; ../backup/ququblog.`date +%H`.sql.gz
</code></pre>
<p><code>docker-compose.yml</code> 文件内容如下，它定义了每个容器基于什么镜像运行，映射哪些目录，开放哪些端口：</p>
<pre><code><span>version:</span> <span>'2'</span>
<span>services:</span>
<span>  es:</span>
<span>    image:</span> elasticsearch:<span>2.3</span><span>.0</span>
<span>    container_name:</span> imququ_es
<span>    volumes:</span>
<span>      -</span> ./esroot/data/:/usr/share/elasticsearch/data
<span>      -</span> ./esroot/config/:/usr/share/elasticsearch/config
<span>      -</span> ./esroot/plugins/:/usr/share/elasticsearch/plugins
<span>    restart:</span> always
<span>    expose:</span>
<span>      -</span> <span>&quot;9200&quot;</span>

<span>  cache:</span>
<span>    image:</span> memcached:<span>1.4</span><span>.29</span>
<span>    container_name:</span> imququ_cache
<span>    restart:</span> always
<span>    expose:</span>
<span>      -</span> <span>&quot;11211&quot;</span>

<span>  db:</span>
<span>    image:</span> mysql:<span>5.7</span><span>.14</span>
<span>    container_name:</span> imququ_db
<span>    volumes:</span>
<span>      -</span> <span>&quot;./db:/var/lib/mysql&quot;</span>
<span>    restart:</span> always
<span>    environment:</span>
<span>      MYSQL_ROOT_PASSWORD:</span> ******
<span>    expose:</span>
<span>      -</span> <span>&quot;3306&quot;</span>
<span>    ports:</span>
<span>      -</span> <span>&quot;127.0.0.1:3306:3306&quot;</span>

<span>  blog:</span>
<span>    depends_on:</span>
<span>      -</span> es
<span>      -</span> cache
<span>      -</span> db
<span>    image:</span> qgy18/node
<span>    container_name:</span> imququ_blog
<span>    volumes:</span>
<span>      -</span> ./blog:/app
<span>    restart:</span> always
<span>    working_dir:</span>
      /app
<span>    entrypoint:</span>
<span>      -</span> pm2
<span>      -</span> start
<span>      -</span> pm2.json
<span>      -</span> --<span>no</span>-daemon
<span>    links:</span>
<span>      - es:</span>es
<span>      - cache:</span>cache
<span>      - db:</span>db
<span>    ports:</span>
<span>      -</span> <span>&quot;127.0.0.1:8085:8085&quot;</span>
</code></pre>
<p>在 blog 容器中，我通过 <code>links</code> 配置连接了前面几个容器。这样在代码中，就可以使用 <code>es</code> 做为 HOST 连接到 Elasticsearch 容器，使用 <code>db</code> 做为 HOST 连接到 MySQL，依此类推。</p>
<p>我定义了 db 容器的 <code>ports</code> 配置，将宿主系统的 3306 端口映射到了 db 容器内，这样我就可以在宿主系统管理 MySQL 服务。同样地，使用宿主系统的 8085 端口可以访问到 blog 容器提供的 WEB 服务。</p>
<p>通过 <code>docker-compose up -d</code> 命令就可以在后台启动所有容器。<code>docker ps</code> 可以用来查看各个容器的运行状态：</p>
<pre><code>IMAGE                 COMMAND                  PORTS                      NAMES
qgy18/node            &quot;pm2 start pm2.json -&quot;   127.0.0.1:8085-&gt;8085/tcp   imququ_blog
elasticsearch:2.3.0   &quot;/docker-entrypoint.s&quot;   9200/tcp, 9300/tcp         imququ_es
mysql:5.7.14          &quot;docker-entrypoint.sh&quot;   127.0.0.1:3306-&gt;3306/tcp   imququ_db
memcached:1.4.29      &quot;docker-entrypoint.sh&quot;   11211/tcp                  imququ_cache
</code></pre><p>本博客基于 Docker 容器运行了将近一周，非常稳定。宿主系统整体资源占用跟之前相比，也没有明显变化。前几天我把宿主系统升级到了 Ubuntu 16.04.1 LTS，博客服务没受任何影响，这种体验实在是美妙。</p>
<p>本文链接：<a href="https://imququ.com/post/use-docker.html">https://imququ.com/post/use-docker.html</a>，<a href="https://imququ.com/post/use-docker.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            一年前，我在《开始使用 Vagrant》一文中写到：使用虚拟化软件安装 Linux，有着「统一线下线上环境、不受升级宿主系统的影响、容易备份和恢复」等几大优点，非常适用于搭建 WEB 开发环境。 但 Vagrant 这种依赖 VirtualBox/VMWare/Parallel
            
        </summary>
        
    </entry>
    
    <entry>
        <title>已实现全站HTTPS安全连接</title>
        <link href="https://blackyau.cc/3.html"/>
        <id>https://blackyau.cc/3.html</id>
        
        <author>
            <name>蠢黑通行</name>
        </author>
        
        <published>2016-08-14T05:45:00+00:00</published>
        <updated>2016-08-14T05:45:00+00:00</updated>
        
        <content type="html"><![CDATA[<p><strong>现在blog使用的VPS搭建，与这个实现方法有较大的差异。会更新的</strong><br />高三开学的第一天，这个特殊的日子。本站终于实现了全站完美HTTPS加密访问，在这个人人都注重隐私的时代。我这个博客当然不能落后于别人，顺便也在这里记录一下添加HTTPS访问时遇到的问题。</p><p>首先，需要一个<a href="http://baike.baidu.com/view/1009264.htm">SSL证书</a>。我的证书是使用的<a href="https://freessl.wosign.com/">沃通DV免费SSL证书</a>，毕竟一个穷逼学生党没多少钱就用的免费的..<br />其次，因为本站是搭建于虚拟主机之上。所以导入证书和私钥都很简单，直接用Notepad++打开，把里面的内容粘贴进面板对应SSL设置的地方就行。</p><p>满怀信心在地址栏中输入了连接，打开后却没有<strong>高贵的绿色小锁</strong>。使用F12检查后，发现是<a href="https://github.com/newraina/typecho-theme-NexTPisces">我选择的主题</a>中的header.php引用了Google前端公共库没有通过HTTPS传输。而且更为捉急是，我来回更换了好几个国内的CDN库全都不支持HTTPS。当然了这种问题是阻挡不了绿色小锁对我的诱惑。</p><p>我直接将他引用的CSS，全部下载到本地修改后上传到主机。然后把header.php中引用的地址改为了主机。就这样我的博客前面就有了耀眼的绿色小锁。同时还将站点中的静态文件全部放到了<a href="https://www.qiniu.com/">七牛云储存</a>中，七牛云支持HTTPS链接还是挺不错的！最主要的是他每月有免费的10G流量，这对于我的博客绰绰有余。</p><p>对于上传的图片如何使用七牛云托管，我也通过google找到了<a href="https://www.xiaoz.me/archives/6842">解决方法</a>。设置镜像储存的镜像源为我的博客<br /><img src="https://blackyau.b0.upaiyun.com/blog/3/1.jpg" /><br />然后修改post.php中</p><pre><code>&lt;?php $this-&gt;content(); ?&gt;
</code></pre><p>其中的<a href="https://blackyau.cc为我的博客域名">https://blackyau.cc为我的博客域名</a>，https://obvrtdse2.qnssl.com为七牛云空间的域名，这个方法的原理就是七牛支持镜像存储，设置镜像源后，当你访问七牛的地址会自动从源地址获取对应文件并抓取过来，连SDK都不需要使用。<br />经过了这样一鼓捣，开学了就可以安心的写字了。<br /><img src="https://blackyau.b0.upaiyun.com/blog/3/2.png" /></p>]]></content>
        
        <summary type="html">
            
            现在blog使用的VPS搭建，与这个实现方法有较大的差异。会更新的高三开学的第一天，这个特殊的日子。本站终于实现了全站完美HTTPS加密访问，在这个人人都注重隐私的时代。我这个博客当然不能落后于别人，顺便也在这里记录一下添加HTTPS访问时遇到的问题。首先，需要一个SSL证书。
            
        </summary>
        
    </entry>
    
    <entry>
        <title>移动 WEB 通用优化策略介绍（二）</title>
        <link href="https://imququ.com/post/wpo-of-mobile-web-2.html"/>
        <id>https://imququ.com/post/wpo-of-mobile-web-2.html</id>
        
        <published>2016-08-13T16:03:49+00:00</published>
        <updated>2016-08-13T16:03:49+00:00</updated>
        
        <content type="html"><![CDATA[<p>算起来已经足足两个半月没有更新文章，这段时间过得比较忙：夜间跑步计划、卖房买房以及工作上各种事情都凑到一块了。实际上，最近也并没有忙到完全抽不出时间写博客这种地步，根本原因可能还是变懒了，这样不好。</p>
<p>几个月前，我决定开始写一系列有关「移动 WEB 通用优化」的文章，介绍「面向所有主流移动端浏览器（包括各种 APP 嵌入的通用 Webview）」的前端优化策略，本文是这个系列第二篇。</p>
<p>先来回顾下上篇文章最后的结论：</p>
<blockquote>
<p>重要的 CSS、JS、JSON 数据直接内联在 HTML 中，头部禁止出现任何外链资源。同时，尽可能减少页面传输体积。</p>
</blockquote>
<p>采用了这个策略的页面，理应能让用户在很短时间内看到主体内容，因为头部 CSS 和 JS 都内联了，不会阻塞浏览器渲染页面。在我们的认识里，浏览器会异步加载页面用到的图片，加载图片不会阻塞页面渲染，更不会阻塞 JS 执行。实际情况是这样吗？</p>
<p>本文主要讨论在移动 WEB 中，图片的加载给页面整体性能带来的影响以及优化策略。</p>
<p>我们知道，浏览器的 DOMContentLoaded 事件会在主页面加载并解析完成之后触发，不会等页面样式、图片、iframe 等子资源加载完。以下是 <a href="https://developer.mozilla.org/en/docs/Web/Events/DOMContentLoaded">MDN</a> 对它的描述：</p>
<blockquote>
<p>The DOMContentLoaded event is fired when the initial HTML document has been completely loaded and parsed, without waiting for stylesheets, images, and subframes to finish loading. </p>
</blockquote>
<p>但在实际测试中，移动端完全相同的页面，加载与不加载图片对 DOMContentLoaded 触发时机的影响却很大。以下是我们在某个移动产品中，将图片延迟加载后的 DOMContentLoaded 时间对比，可以看出明显变化：</p>
<p><img src="https://st.imququ.com/static/uploads/2015/10/dom-ready-time.png" /></p>
<p>我们只是将页面所有图片（大约十几张）进行延迟加载，就让 DOMContentLoaded 事件提前 250 毫秒触发。这是我之前没有意料到的，移动设备在网络、CPU、内存等方面的性能与 PC 相比差距很大，很多 PC 上可以忽略的问题，在移动端必须重视起来。</p>
<p>移动 WEB 要做好图片优化，无外乎两点：<strong>控制图片大小</strong>和<strong>控制图片加载</strong>。</p>
<h3>控制图片大小</h3>
<p>图片高宽越大，意味着需要越多的网络开销。常见图片格式都经过了高度压缩，尺寸越大的图片还意味着浏览器在解码过程中需要耗费更多 CPU，解码之后的位图需要占用更多内存。在移动端，我们更应该关注图片大小。</p>
<p><strong>根据 DPR（window.devicePixelRatio，设备像素比）选择合适的图片尺寸。</strong>现在的手机基本上都是高清屏，如果一味追求让图片更小而使用单倍图也不现实。这一点上，最佳实践是根据产品特性，结合用户 DPR 分布情况来选择合适的尺寸。例如在我们某个产品中：图片加载速度比图片质量更重要；用户 DPR 分布前三是：2、3、1.5。我们最终使用了 1.5 倍图，并且在图床缩放图片时，加了一点点锐化效果。最终图片体积很小，质量也尚可接受。</p>
<p><strong>处理好响应式图片（Responsive Image）。</strong>移动上很多图片宽度不是固定像素值，例如通栏 Banner 图片的宽度是跟着设备走的。对于这种场景，使用 JS 获取设备宽度，拼出最适合当前设备的图片尺寸，交给图床进行缩放，无疑能在图片体积和质量上找到最佳平衡点。但这种做法并不可取，移动设备宽度各式各样，如果裁图规格太多，容易降低 CDN 缓存命中率。图床实时处理完图片再分发到 CDN 更耗时，在移动端让图片命中 CDN 缓存也很重要。处理响应式图片的最佳实践是根据用户屏幕尺寸分布，制定出几档裁图规则，页面根据用户设备宽度使用最合适的档位，并对重要的图片（例如头部焦点图）提前预热 CDN。</p>
<blockquote>
<p>有一项名为 HTTP Client Hints 的技术，通过新增的 HTTP 请求头部字段，使得图床可以优雅地返回最合适的图片。目前这项技术在移动端尚未普及，详情请查看 <a href="https://imququ.com/post/http-client-hints.html">HTTP Client Hints 介绍</a>。</p>
</blockquote>
<p><strong>使用 WEBP 格式。</strong>有一种减少图片体积的灵丹妙药 —— 使用压缩比例更高的 WEBP 格式。《<a href="http://blog.ibireme.com/2015/11/02/mobile_image_benchmark/">移动端图片格式调研</a>》这篇文章详细地对比了各种移动端图片格式及各自适用场景。对于 WEBP 的最佳实践是只要浏览器支持就用，虽然 WEBP 解码慢于 JPG，但在同等图片质量下，WEBP 体积通常比 JPG 小很多。</p>
<p>要判断浏览器是否支持 WEBP，可以检查 HTTP 请求头部字段 <code>Accept</code> 的值是否包含 <code>webp</code>。例如这是 Chrome 给图片请求加的 <code>Accept</code>：</p>
<pre><code>Accept: image/webp,image/*,*/*;q=0.8
</code></pre><p>不是所有支持 WEBP 的浏览器都会这样处理，可以针对这种情况使用特性检测：</p>
<pre><code><span>var</span> webpImg = <span>new</span> Image;
webpImg.onload = <span><span>function</span> (<span></span>) </span>{
    <span>if</span>(webpImg.width == <span>1</span>){
        cookie(<span>'env_webp'</span>, <span>1</span>); <span>//cookie 方法需要自己实现</span>
    }
};
webpImg.src = <span>'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAgA0JaQAA3AA/vv9UAA='</span>;
</code></pre>
<p>这段示意代码的原理是：用 JS 加载 WEBP 图片，如果能触发 onload 并获取到宽度，说明当前浏览器支持 WEBP。</p>
<h3>控制图片加载</h3>
<p>我在《<a href="https://imququ.com/post/amp-project.html">AMP，来自 Google 的移动页面优化方案</a>》一文中写到：「将图片、视频等标签和第三方功能换成 AMP Components 后，AMP Runtime 可以自动处理延迟加载、按需加载等逻辑，确保页面首屏性能」。在移动浏览器打开网页，经常能感觉到明显的卡顿。造成卡顿的原因除了页面 DOM 结构复杂、CSS 过多地触发 Layout/Paint/Composite、存在复杂 JS 逻辑等等，也可能是没有控制图片的加载时机。</p>
<p>通常浏览器会并发加载 6 个同域名图片，如果做了域名散列，那很可能在打开页面后的短短几秒内，几十个图片都在加载。这些连接带来的 TCP、带宽、CPU、内存等开销，很容易让页面卡顿。所以在移动端，我们要让图片加载变得可控。</p>
<p><strong>按需加载图片。</strong>在 PC 端，我们基本都会做图片 Lazy Load，这个优化策略在移动端同样适用。由于移动端性能有限、带宽昂贵，Lazy Load 更为重要。实际上不光是图片可以做 Lazy Load，页面所有资源包括 DOM 节点都应该做成按需加载。通常在移动端，我们只加载页面可视区域及其下方一定距离内的资源。</p>
<p><strong>顺序加载图片。</strong>在 PC 端，由于硬件性能和带宽足够，并行加载更多的图片通常是最好的选择。而在移动端，人为控制图片加载顺序，例如使其从上到下、从左到右逐个加载，有时可以带来更好的体验。</p>
<p><strong>不要在页面滚定时加载图片。</strong>按需加载图片逻辑需要监听页面滚动事件，根据页面当前可视区域决定加载哪些图片。在移动端滚动页面本来就很耗费性能，如果这时候还要加载图片，非常容易造成页面卡顿。在页面滚定停止之后才开始载入图片，能有效减少这种卡顿。</p>
<p>好了，本文先就写这么多。还是老规矩，有任何问题和疑问欢迎留言讨论。Disqus 最近在国内经常无法加载，怎么处理你们都懂的。实在不行也可以给我发邮件，本站「关于」页面有我的邮箱。</p>
<p>本文链接：<a href="https://imququ.com/post/wpo-of-mobile-web-2.html">https://imququ.com/post/wpo-of-mobile-web-2.html</a>，<a href="https://imququ.com/post/wpo-of-mobile-web-2.html#comments" target="_blank">参与讨论</a></p>]]></content>
        
        <summary type="html">
            
            算起来已经足足两个半月没有更新文章，这段时间过得比较忙：夜间跑步计划、卖房买房以及工作上各种事情都凑到一块了。实际上，最近也并没有忙到完全抽不出时间写博客这种地步，根本原因可能还是变懒了，这样不好。 几个月前，我决定开始写一系列有关「移动 WEB 通用优化」的文章，介绍「面向所
            
        </summary>
        
    </entry>
    
</feed>